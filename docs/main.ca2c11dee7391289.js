(self.webpackChunknexus_meet_system=self.webpackChunknexus_meet_system||[]).push([[179],{9702:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{d:()=>O});const O={apiUrl:"https://nm-service.onrender.com/"}},5932:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{T:()=>Vt});var O=_e(4946),bt=_e(3018),St=_e(7232),f=_e(180),ze=_e(6814);function ke($t,xt){if(1&$t&&(O.TgZ(0,"div",9)(1,"div",10)(2,"div")(3,"h3",11),O._uU(4),O.qZA()()()()),2&$t){const ft=xt.$implicit;O.xp6(4),O.hij("Usuario: ",ft,"")}}let Vt=(()=>{class $t{constructor(ft,it,dt){this.entryService=ft,this.modalService=it,this.route=dt,this.eventId=0,this.usernames=[],this.errorMessage=""}ngOnInit(){this.route.params.subscribe(ft=>{this.eventId=ft.eventId,console.log("Evento Id:",this.eventId),this.entryService.getAssistant(this.eventId).subscribe(it=>{this.usernames=it.usernames,this.errorMessage=""},it=>{console.log("Error obteniendo asistentes",it),this.errorMessage="Error al obtener asistentes.",this.usernames=[]})})}closeModal(){this.modalService.closeAssistantEventModal()}static#e=this.\u0275fac=function(it){return new(it||$t)(O.Y36(bt.U),O.Y36(St.M),O.Y36(f.gz))};static#t=this.\u0275cmp=O.Xpm({type:$t,selectors:[["app-assistant"]],decls:11,vars:1,consts:[[1,"md:w-1/2","bg-gray-300","rounded-lg","p-4"],[1,"flex","items-start","justify-between","p-4","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button","data-modal-hide","defaultModal",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ml-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"bg-white","rounded-lg","shadow-md","p-4"],["class","flex items-center justify-between border-b border-gray-300 py-2",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","border-b","border-gray-300","py-2"],[1,"flex","items-center","space-x-4"],[1,"text-lg","font-semibold"]],template:function(it,dt){1&it&&(O.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),O._uU(3," Listado de Asistentes "),O.qZA(),O.TgZ(4,"button",3),O.NdJ("click",function(){return dt.closeModal()}),O.O4$(),O.TgZ(5,"svg",4),O._UZ(6,"path",5),O.qZA(),O.kcU(),O.TgZ(7,"span",6),O._uU(8,"Close modal"),O.qZA()()(),O.TgZ(9,"div",7),O.YNc(10,ke,5,1,"div",8),O.qZA()()),2&it&&(O.xp6(10),O.Q6J("ngForOf",dt.usernames))},dependencies:[ze.sg]})}return $t})()},2887:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{D:()=>xt});var O=_e(4946),bt=_e(7232),St=_e(3018),f=_e(5579),ze=_e(2482),ke=_e(95),Vt=_e(6814);function $t(ft,it){if(1&ft&&(O.TgZ(0,"option",25),O._uU(1),O.qZA()),2&ft){const dt=it.$implicit,Bt=O.oxw();O.Q6J("value",Bt.convertToNumber(dt)),O.xp6(1),O.hij(" ",dt," ")}}let xt=(()=>{class ft{constructor(dt,Bt,zt,un){this.modalService=dt,this.entryService=Bt,this.eventService=zt,this.userService=un,this.isLoggedIn=!1,this.elementsList=["1 Entrada","2 Entradas","3 Entradas","4 Entradas"],this.entryResponse={id:0,quantity:0,priceTotal:0,userId:0,eventId:0,eventName:"",qr:""}}onTicketQuantityChange(){console.log(this.entryResponse.quantity)}onSubmit(){console.log("Datos a enviar:",this.userData.id),console.log("Datos a enviar:",this.eventId.toString());const dt=new FormData;dt.append("quantity",this.entryResponse.quantity.toString()),dt.append("price_total",this.entryResponse.priceTotal.toString()),dt.append("user",this.userData.id),dt.append("event",this.eventId.toString()),console.log(dt),this.entryService.addEntry(dt).subscribe(Bt=>{console.log("Entrada comprada con \xe9xito",Bt),window.location.reload()})}detectCreditCardType(dt){const Bt=dt.target.value,zt={visa:/^4/,mastercard:/^5[1-5]/,amex:/^3[47]/,dinersclub:/^3(?:0[0-5]|6|8)/};let un="unknown";for(const Jn in zt)if(zt[Jn].test(Bt)){un=Jn;break}const jn=document.getElementById("card-icons");if(jn){const Jn=jn.getElementsByTagName("img");for(let mr=0;mr<Jn.length;mr++){const Xt=Jn[mr];Xt.style.display=Xt.id===un+"-icon"?"inline":"none"}}}ngOnInit(){console.log(this.elementsList),this.eventService.getEvent(this.eventId).subscribe(dt=>{this.event=dt,this.event.capacity>=1&&this.event.capacity<=this.elementsList.length&&(this.elementsList=this.elementsList.slice(0,this.event.capacity))}),this.userService.getCurrentUser().subscribe(dt=>{this.userData=dt,this.isLoggedIn=null!==dt,console.log(this.userData.id)},dt=>{console.error("Error al obtener el usuario actual",dt)})}closeBuyModal(){this.modalService.closeBuyModal()}convertToNumber(dt){const Bt=dt.charAt(0);return Number(Bt)}static#e=this.\u0275fac=function(Bt){return new(Bt||ft)(O.Y36(bt.M),O.Y36(St.U),O.Y36(f.P),O.Y36(ze.K))};static#t=this.\u0275cmp=O.Xpm({type:ft,selectors:[["entry-buy-entry"]],inputs:{eventId:"eventId"},decls:37,vars:2,consts:[[1,"bg-gradient-to-t","from-gray-900/80","via-blue","to-blue-950/80","p-6","rounded-lg","md:flex","md:space-x-6","justify-center","items-center"],[1,"md:w-1/2"],[1,"bg-gray-200","rounded-lg","p-4"],["src","assets/images/logo/full_logo_black.png","alt","Nexus Meet Logo",1,"h-28","mr-10px"],["enctype","multipart/form-data",1,"relative","w-full","max-w-2xl","max-h-full","bg-gray-200","rounded-lg","p-4",3,"ngSubmit"],[1,"flex","items-start","justify-between","p-4","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button","data-modal-hide","defaultModal",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ml-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-6","space-y-6"],[1,"relative","z-0","w-full","mb-6","group"],["type","text","name","email","id","floating_name","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer"],["for","floating_name",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["type","text","name","firstName","id","floating_fistname","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer"],["for","floating_fistname",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["type","text","name","firstName","id","floating_secondName","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer"],["for","floating_secondName",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["name","ticketQuantity","id","floating_ticketQuantity","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","floating_ticketQuantity",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],[1,"flex","items-center","p-6","space-x-2","border-t","border-gray-200","rounded-b","dark:border-gray-600"],["data-modal-hide","defaultModal","type","submit",1,"text-white","bg-blue-950","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800"],["data-modal-hide","defaultModal","type","button",1,"text-gray-500","bg-white","hover:bg-gray-100","focus:ring-4","focus:outline-none","focus:ring-blue-300","rounded-lg","border","border-gray-200","text-sm","font-medium","px-5","py-2.5","hover:text-gray-900","focus:z-10","dark:bg-gray-700","dark:text-gray-300","dark:border-gray-500","dark:hover:text-white","dark:hover:bg-gray-600","dark:focus:ring-gray-600",3,"click"],[3,"value"]],template:function(Bt,zt){1&Bt&&(O.TgZ(0,"div",0)(1,"div",1)(2,"div",2),O._UZ(3,"img",3),O.qZA()(),O.TgZ(4,"div",1)(5,"form",4),O.NdJ("ngSubmit",function(){return zt.onSubmit()}),O.TgZ(6,"div",5)(7,"h3",6),O._uU(8," Comprar Entradas "),O.qZA(),O.TgZ(9,"button",7),O.NdJ("click",function(){return zt.closeBuyModal()}),O.O4$(),O.TgZ(10,"svg",8),O._UZ(11,"path",9),O.qZA(),O.kcU(),O.TgZ(12,"span",10),O._uU(13,"Close modal"),O.qZA()()(),O.TgZ(14,"div",11)(15,"div",12),O._UZ(16,"input",13),O.TgZ(17,"label",14),O._uU(18,"Email del Usuario"),O.qZA()(),O.TgZ(19,"div",12),O._UZ(20,"input",15),O.TgZ(21,"label",16),O._uU(22,"Primer Nombre:"),O.qZA()(),O.TgZ(23,"div",12),O._UZ(24,"input",17),O.TgZ(25,"label",18),O._uU(26,"Segundo Nombre:"),O.qZA()(),O.TgZ(27,"div",12)(28,"select",19),O.NdJ("ngModelChange",function(jn){return zt.entryResponse.quantity=jn}),O.YNc(29,$t,2,2,"option",20),O.qZA(),O.TgZ(30,"label",21),O._uU(31,"Cantidad de Entradas"),O.qZA()()(),O.TgZ(32,"div",22)(33,"button",23),O._uU(34," Comprar "),O.qZA(),O.TgZ(35,"button",24),O.NdJ("click",function(){return zt.closeBuyModal()}),O._uU(36," Cancelar "),O.qZA()()()()()),2&Bt&&(O.xp6(28),O.Q6J("ngModel",zt.entryResponse.quantity),O.xp6(1),O.Q6J("ngForOf",zt.elementsList))},dependencies:[ke._Y,ke.YN,ke.Kr,ke.EJ,ke.JJ,ke.JL,ke.Q7,ke.On,ke.F,Vt.sg],encapsulation:2})}return ft})()},269:(yr,Qt,_e)=>{"use strict";_e.r(Qt),_e.d(Qt,{EntryModule:()=>it});var O=_e(180),bt=_e(2887),St=_e(5932),f=_e(9594),ze=_e(4946);const ke=[{path:"buy-entry",component:bt.D},{path:"qr",component:f.S},{path:"assistant",component:St.T}];let Vt=(()=>{class dt{static#e=this.\u0275fac=function(un){return new(un||dt)};static#t=this.\u0275mod=ze.oAB({type:dt});static#n=this.\u0275inj=ze.cJS({imports:[O.Bz.forChild(ke),O.Bz]})}return dt})();var $t=_e(95),xt=_e(6814),ft=_e(469);let it=(()=>{class dt{static#e=this.\u0275fac=function(un){return new(un||dt)};static#t=this.\u0275mod=ze.oAB({type:dt});static#n=this.\u0275inj=ze.cJS({imports:[Vt,ft.f,$t.u5,xt.ez]})}return dt})()},9594:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{S:()=>xt});var O=_e(4946),bt=_e(7232),St=_e(3018),f=_e(469),ze=_e(6814);function ke(ft,it){if(1&ft&&(O.TgZ(0,"p",14),O._uU(1),O.qZA()),2&ft){const dt=O.oxw();O.xp6(1),O.hij("C\xf3digo QR escaneado: ",dt.scannedValue,"")}}function Vt(ft,it){if(1&ft&&(O.TgZ(0,"p",15),O._uU(1),O.qZA()),2&ft){const dt=O.oxw();O.xp6(1),O.hij("C\xf3digo QR escaneado: ",dt.errorMessage,"")}}function $t(ft,it){if(1&ft){const dt=O.EpF();O.TgZ(0,"button",16),O.NdJ("click",function(){O.CHM(dt);const zt=O.oxw();return O.KtG(zt.updateQR())}),O._uU(1,"Aceptar"),O.qZA()}}let xt=(()=>{class ft{constructor(dt,Bt){this.modalService=dt,this.entryService=Bt,this.scannedValue="",this.errorMessage="",this.scanningEnabled=!0,this.buttonForAccept=!1}closeModal(){this.modalService.closeAttendeeModal()}ngOnInit(){console.log("Complemento QR Iniciado")}onScanSuccess(dt){this.scanningEnabled&&(this.scanningEnabled=!1,this.entryService.sendScannedValue(dt).subscribe(Bt=>{console.log(Bt.message),"Attendance already registered"===Bt.message?(this.errorMessage="\xa1La asistencia ya ha sido registrada!",this.scannedValue=""):(console.log("Valor escaneado enviado",Bt),this.scannedValue="Asistencia Registrada con \xe9xito",this.errorMessage="",this.buttonForAccept=!0)},Bt=>{console.log("Valor no escaneado",Bt),this.buttonForAccept=!0}))}onScanError(dt){console.error(dt)}updateQR(){this.scannedValue="",this.scanningEnabled=!0}static#e=this.\u0275fac=function(Bt){return new(Bt||ft)(O.Y36(bt.M),O.Y36(St.U))};static#t=this.\u0275cmp=O.Xpm({type:ft,selectors:[["app-qr"]],decls:16,vars:5,consts:[[1,"relative","w-full","max-w-2x1","mx-auto","max-h-[90vh]","overflow-y-auto"],[1,"bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"p-6","space-y-6"],[1,"flex","items-start","justify-between","p-4","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button","data-modal-hide","defaultModal",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ml-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"relative","z-0","w-full","mb-6","group"],[1,"w-full","h-full",3,"torch","tryHarder","scanSuccess","scanError"],["class","bg-green-500 text-white p-4 rounded",4,"ngIf"],["class","bg-red-500 text-white p-4 rounded",4,"ngIf"],["class"," center text-white bg-blue-950 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",3,"click",4,"ngIf"],[1,"bg-green-500","text-white","p-4","rounded"],[1,"bg-red-500","text-white","p-4","rounded"],[1,"center","text-white","bg-blue-950","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"]],template:function(Bt,zt){1&Bt&&(O.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),O._uU(5," Registrar Asistencia "),O.qZA(),O.TgZ(6,"button",5),O.NdJ("click",function(){return zt.closeModal()}),O.O4$(),O.TgZ(7,"svg",6),O._UZ(8,"path",7),O.qZA(),O.kcU(),O.TgZ(9,"span",8),O._uU(10,"Close modal"),O.qZA()()(),O.TgZ(11,"div",9)(12,"zxing-scanner",10),O.NdJ("scanSuccess",function(jn){return zt.onScanSuccess(jn)})("scanError",function(jn){return zt.onScanError(jn)}),O.qZA(),O.YNc(13,ke,2,1,"p",11),O.YNc(14,Vt,2,1,"p",12),O.YNc(15,$t,2,0,"button",13),O.qZA()()()()),2&Bt&&(O.xp6(12),O.Q6J("torch",!0)("tryHarder",!0),O.xp6(1),O.Q6J("ngIf",zt.scannedValue),O.xp6(1),O.Q6J("ngIf",zt.errorMessage),O.xp6(1),O.Q6J("ngIf",zt.buttonForAccept))},dependencies:[f.S,ze.O5],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}"]})}return ft})()},3018:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{U:()=>f});var O=_e(9702),bt=_e(4946),St=_e(9862);let f=(()=>{class ze{constructor(Vt){this.http=Vt,this.apiUrl=O.d.apiUrl}addEntry(Vt){return console.log(Vt),this.http.post(this.apiUrl+"entrys/create/",Vt)}getAssistant(Vt){return this.http.get(`${this.apiUrl}get-assitants/${Vt}`)}getListAssistant(Vt){return this.http.get(`${this.apiUrl}get-assists-by-user/${Vt}`)}sendScannedValue(Vt){return this.http.post(this.apiUrl+"qrvalue/",{scannedValue:Vt})}static#e=this.\u0275fac=function($t){return new($t||ze)(bt.LFG(St.eN))};static#t=this.\u0275prov=bt.Yz7({token:ze,factory:ze.\u0275fac,providedIn:"root"})}return ze})()},3524:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{F:()=>$t});var O=_e(2574),St=_e(8694),f=_e(4946),ze=_e(7232),ke=_e(5579),Vt=_e(95);let $t=(()=>{class xt{constructor(it,dt){this.modalService=it,this.eventService=dt,this.mapbox=O,this.selectedLocation={latitude:0,longitude:0},this.eventData={id:0,dateEventStart:new Date(""),eventName:"",eventImage:"",description:"",capacity:0,entryPrice:0,userId:0,latitude:0,longitude:0,entryType:""}}ngOnInit(){this.mapbox&&this.selectedLocation&&this.initMap()}closeModal(){this.modalService.closeRegisterEventModal()}initMap(){this.mapbox.accessToken=St.N.mapBoxToken;const it=new O.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-78.50027,-7.16378],zoom:12});it.addControl(new O.NavigationControl);let dt=null;it.on("click",Bt=>{const zt=Bt.lngLat;dt?dt.setLngLat(zt):dt=(new O.Marker).setLngLat(zt).addTo(it),this.eventData.latitude=zt.lat,this.eventData.longitude=zt.lng})}onFileSelected(it){const dt=it.target.files[0];console.log("Archivo seleccionado:",dt),this.eventData.eventImage=dt}onSubmit(){console.log("Datos a enviar:",this.eventData);const it=new FormData,dt=this.eventData.dateEventStart.toString();it.append("date_event_start",dt),it.append("event_name",this.eventData.eventName),it.append("event_image",this.eventData.eventImage),it.append("description",this.eventData.description),it.append("capacity",this.eventData.capacity.toString()),it.append("entry_price",this.eventData.entryPrice.toString()),it.append("entry_type",this.eventData.entryType.toString()),it.append("latitude",this.eventData.latitude.toString()),it.append("longitude",this.eventData.longitude.toString()),it.append("entry_type","General"),it.append("creator",this.userId.toString()),this.eventService.addEvent(it).subscribe(Bt=>{console.log("Evento creado con \xe9xito",Bt),window.location.reload()})}static#e=this.\u0275fac=function(dt){return new(dt||xt)(f.Y36(ze.M),f.Y36(ke.P))};static#t=this.\u0275cmp=f.Xpm({type:xt,selectors:[["add-event"]],inputs:{userId:"userId"},decls:46,vars:9,consts:[["enctype","multipart/form-data",1,"relative","w-full","max-w-2x1","mx-auto","max-h-[90vh]","overflow-y-auto",3,"ngSubmit"],[1,"bg-white","rounded-lg","shadow","dark:bg-gray-700"],[1,"flex","items-start","justify-between","p-4","border-b","rounded-t","dark:border-gray-600"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white"],["type","button","data-modal-hide","defaultModal",1,"text-gray-400","bg-transparent","hover:bg-gray-200","hover:text-gray-900","rounded-lg","text-sm","w-8","h-8","ml-auto","inline-flex","justify-center","items-center","dark:hover:bg-gray-600","dark:hover:text-white",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 14 14",1,"w-3","h-3"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"],[1,"sr-only"],[1,"p-6","space-y-6"],[1,"relative","z-0","w-full","mb-6","group"],["type","email","name","event_name","id","floating_name","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],["for","floating_name",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["type","datetime-local","name","date_event_start","id","floating_date","placeholder"," ","required","",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],["for","floating_date",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["for","user_avatar",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["aria-describedby","user_avatar_help","id","event_image","name","event_image","type","file",1,"block","w-full","text-sm","text-gray-900","border","border-gray-300","rounded-lg","cursor-pointer","bg-gray-50","dark:text-gray-400","focus:outline-none","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400",3,"ngModel","ngModelChange","change"],["aria-describedby","user_avatar_help","id","event_image","name","description","type","text",1,"block","w-full","text-sm","text-gray-900","border","border-gray-300","rounded-lg","cursor-pointer","bg-gray-50","dark:text-gray-400","focus:outline-none","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400",3,"ngModel","ngModelChange"],["id","map",1,"w-full","h-64","md:h-96","lg:h-80","xl:h-96"],["type","hidden","name","latitude",3,"ngModel","ngModelChange"],["type","hidden","name","longitude",3,"ngModel","ngModelChange"],["type","number","name","capacity","id","floating_email",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],["for","floating_email",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],[1,"grid","md:grid-cols-2","md:gap-6"],["type","number","name","entry_price","id","floating_phone",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],["for","floating_phone",1,"peer-focus:font-medium","absolute","text-sm","text-gray-500","dark:text-gray-400","duration-300","transform","-translate-y-6","scale-75","top-3","-z-10","origin-[0]","peer-focus:left-0","peer-focus:text-blue-600","peer-focus:dark:text-blue-500","peer-placeholder-shown:scale-100","peer-placeholder-shown:translate-y-0","peer-focus:scale-75","peer-focus:-translate-y-6"],["type","hidden","name","user_id","id","floating_company","value","1",1,"block","py-2.5","px-0","w-full","text-sm","text-gray-900","bg-transparent","border-0","border-b-2","border-gray-300","appearance-none","dark:text-white","dark:border-gray-600","dark:focus:border-blue-500","focus:outline-none","focus:ring-0","focus:border-blue-600","peer",3,"ngModel","ngModelChange"],[1,"flex","flex-col","items-center","p-6","space-y-2","border-t","border-gray-200","rounded-b","dark:border-gray-600"],["data-modal-hide","defaultModal","type","submit",1,"w-full","text-white","bg-blue-700","hover:bg-blue-800","focus:ring-4","focus:outline-none","focus:ring-blue-300","font-medium","rounded-lg","text-sm","py-2","text-center","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800"],["data-modal-hide","defaultModal","type","button",1,"w-full","text-gray-500","bg-white","hover:bg-gray-100","focus:ring-4","focus:outline-none","focus:ring-blue-300","rounded-lg","border","border-gray-200","text-sm","font-medium","py-2.5","hover:text-gray-900","focus:z-10","dark:bg-gray-700","dark:text-gray-300","dark:border-gray-500","dark:hover:text-white","dark:hover:bg-gray-600","dark:focus:ring-gray-600",3,"click"]],template:function(dt,Bt){1&dt&&(f.TgZ(0,"form",0),f.NdJ("ngSubmit",function(){return Bt.onSubmit()}),f.TgZ(1,"div",1)(2,"div",2)(3,"h3",3),f._uU(4," Registrar Evento "),f.qZA(),f.TgZ(5,"button",4),f.NdJ("click",function(){return Bt.closeModal()}),f.O4$(),f.TgZ(6,"svg",5),f._UZ(7,"path",6),f.qZA(),f.kcU(),f.TgZ(8,"span",7),f._uU(9,"Close modal"),f.qZA()()(),f.TgZ(10,"div",8)(11,"div",9)(12,"input",10),f.NdJ("ngModelChange",function(un){return Bt.eventData.eventName=un}),f.qZA(),f.TgZ(13,"label",11),f._uU(14,"Nombre del Evento"),f.qZA()(),f.TgZ(15,"div",9)(16,"input",12),f.NdJ("ngModelChange",function(un){return Bt.eventData.dateEventStart=un}),f.qZA(),f._UZ(17,"label",13),f.qZA(),f._UZ(18,"div",9),f.TgZ(19,"label",14),f._uU(20,"Imagen Referencial"),f.qZA(),f.TgZ(21,"input",15),f.NdJ("ngModelChange",function(un){return Bt.eventData.eventImage=un})("change",function(un){return Bt.onFileSelected(un)}),f.qZA(),f.TgZ(22,"label",14),f._uU(23,"Descripcion"),f.qZA(),f.TgZ(24,"input",16),f.NdJ("ngModelChange",function(un){return Bt.eventData.description=un}),f.qZA(),f.TgZ(25,"label",14),f._uU(26,"Ubicaci\xf3n"),f.qZA(),f._UZ(27,"div",17),f.TgZ(28,"input",18),f.NdJ("ngModelChange",function(un){return Bt.eventData.latitude=un}),f.qZA(),f.TgZ(29,"input",19),f.NdJ("ngModelChange",function(un){return Bt.eventData.longitude=un}),f.qZA(),f.TgZ(30,"div",9)(31,"input",20),f.NdJ("ngModelChange",function(un){return Bt.eventData.capacity=un}),f.qZA(),f.TgZ(32,"label",21),f._uU(33,"Capacidad"),f.qZA()(),f.TgZ(34,"div",22)(35,"div",9)(36,"input",23),f.NdJ("ngModelChange",function(un){return Bt.eventData.entryPrice=un}),f.qZA(),f.TgZ(37,"label",24),f._uU(38,"Precio de Entrada"),f.qZA()(),f.TgZ(39,"div",9)(40,"input",25),f.NdJ("ngModelChange",function(un){return Bt.eventData.userId=un}),f.qZA()()()(),f.TgZ(41,"div",26)(42,"button",27),f._uU(43," Registrar Evento "),f.qZA(),f.TgZ(44,"button",28),f.NdJ("click",function(){return Bt.closeModal()}),f._uU(45," Cancelar "),f.qZA()()()()),2&dt&&(f.xp6(12),f.Q6J("ngModel",Bt.eventData.eventName),f.xp6(4),f.Q6J("ngModel",Bt.eventData.dateEventStart),f.xp6(5),f.Q6J("ngModel",Bt.eventData.eventImage),f.xp6(3),f.Q6J("ngModel",Bt.eventData.description),f.xp6(4),f.Q6J("ngModel",Bt.eventData.latitude),f.xp6(1),f.Q6J("ngModel",Bt.eventData.longitude),f.xp6(2),f.Q6J("ngModel",Bt.eventData.capacity),f.xp6(5),f.Q6J("ngModel",Bt.eventData.entryPrice),f.xp6(4),f.Q6J("ngModel",Bt.eventData.userId))},dependencies:[Vt._Y,Vt.Fj,Vt.wV,Vt.JJ,Vt.JL,Vt.Q7,Vt.On,Vt.F],encapsulation:2})}return xt})()},1801:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{k:()=>ze});var O=_e(5861),bt=_e(9702),St=_e(4946),f=_e(9862);let ze=(()=>{class ke{constructor($t){this.http=$t,this.apiUrl=bt.d.apiUrl}getEventos(){var $t=this;return(0,O.Z)(function*(){try{return yield $t.http.get($t.apiUrl+"events/").toPromise()}catch(xt){return console.error("Error al obtener eventos:",xt),[]}})()}getEventosByUser($t){var xt=this;return(0,O.Z)(function*(){try{return yield xt.http.get(`${xt.apiUrl}events-by-user/${$t}`).toPromise()}catch(ft){throw console.error("Error al obtener los eventos:",ft),ft}})()}static#e=this.\u0275fac=function(xt){return new(xt||ke)(St.LFG(f.eN))};static#t=this.\u0275prov=St.Yz7({token:ke,factory:ke.\u0275fac,providedIn:"root"})}return ke})()},3990:(yr,Qt,_e)=>{"use strict";_e.r(Qt),_e.d(Qt,{EventsModule:()=>gt});var O=_e(6814),bt=_e(95),St=_e(1801),f=_e(180),ze=_e(3524),ke=_e(4946),Vt=_e(5579),$t=_e(7232),xt=_e(2887),ft=_e(2574),it=_e(8694);let dt=(()=>{class ln{constructor(){this.mapbox=ft,this.style="mapbox://styles/mapbox/streets-v11",this.zoom=10,this.mapbox.accessToken=it.N.mapBoxToken}buildMap(Yt,Kt){this.map=new ft.Map({container:"map",style:this.style,zoom:this.zoom,center:[Yt,Kt]}),this.map.addControl(new ft.NavigationControl),this.addMarker(Yt,Kt,Yt.toString())}addMarker(Yt,Kt,dn){console.log("Desde el marker"),console.log(Yt,Kt),(new ft.Marker).setLngLat([Yt,Kt]).setPopup((new ft.Popup).setHTML(dn)).addTo(this.map)}static#e=this.\u0275fac=function(Kt){return new(Kt||ln)};static#t=this.\u0275prov=ke.Yz7({token:ln,factory:ln.\u0275fac,providedIn:"root"})}return ln})(),Bt=(()=>{class ln{constructor(Yt){this.map=Yt}ngOnInit(){console.log(this.latitude,this.longitude),this.map.buildMap(this.longitude,this.latitude)}static#e=this.\u0275fac=function(Kt){return new(Kt||ln)(ke.Y36(dt))};static#t=this.\u0275cmp=ke.Xpm({type:ln,selectors:[["event-map"]],inputs:{latitude:"latitude",longitude:"longitude"},decls:1,vars:0,consts:[["id","map",1,"rounded-xl","map-container","w-auto","h-auto"]],template:function(Kt,dn){1&Kt&&ke._UZ(0,"div",0)},styles:[".map-container[_ngcontent-%COMP%] {\n    width: 100%;\n    height: 100%;\n  }"]})}return ln})();function zt(ln,Wn){if(1&ln){const Yt=ke.EpF();ke.TgZ(0,"button",22),ke.NdJ("click",function(){ke.CHM(Yt);const dn=ke.oxw();return ke.KtG(dn.openBuyModal())}),ke._uU(1," Comprar Entradas "),ke.qZA()}}function un(ln,Wn){if(1&ln&&(ke.TgZ(0,"div",23),ke._UZ(1,"entry-buy-entry",24),ke.qZA()),2&ln){const Yt=ke.oxw();ke.xp6(1),ke.Q6J("eventId",Yt.event.id)}}let jn=(()=>{class ln{constructor(Yt,Kt,dn){this.route=Yt,this.eventService=Kt,this.modalService=dn,this.message="",this.showButton=!0,this.showShop=!1,this.route.params.subscribe(kn=>{this.eventId=kn.eventId})}ngOnInit(){this.showShop=!1,this.eventService.getEvent(this.eventId).subscribe(Yt=>{this.event=Yt,this.event.capacity<=0?(this.message="Ya no hay entradas disponibles para este evento!!",this.showButton=!1):this.message=this.event.capacity.toString()})}openBuyModal(){this.modalService.openBuyModal()}closeBuyModal(){this.modalService.closeBuyModal()}static#e=this.\u0275fac=function(Kt){return new(Kt||ln)(ke.Y36(f.gz),ke.Y36(Vt.P),ke.Y36($t.M))};static#t=this.\u0275cmp=ke.Xpm({type:ln,selectors:[["app-detail-event"]],decls:62,vars:34,consts:[["id","gestionar-eventos",1,"bg-gradient-to-t","from-gray-900","via-blue","to-blue-950","min-h-screen"],[1,"flex","items-center","justify-center","min-h-screen"],[1,"bg-white","rounded-lg","p-8","m-8","md:m-8","w-full","md:w-1/2","lg:w-1/3","xl:w-1/4","flex-grow"],[1,"flex","flex-col","md:flex-row","space-y-4","md:space-y-0"],[1,"md:w-1/2","bg-gray-200","rounded-lg","p-4","h-full"],[1,"w-full","h-auto"],["alt","","srcset","",3,"src"],[1,"w-1/2","md:w-full","border-t","border-slate-950","mt-4","mb-4"],[1,"text-center","flex","font-bold"],[1,"text-center","flex","justify-center","items-center"],[1,"md:w-1/2","bg-gray-300","rounded-lg","p-4"],[1,"flex","flex-col","h-full","justify-center","items-center"],[1,"rounded","p-2"],[1,"text-4xl","text-center"],[1,"rounded","p-2","text-center"],[1,"text-lg"],[1,"w-full","lg:w-96","relative"],[1,"aspect-w-1","aspect-h-1","lg:aspect-none","lg:w-96","h-96",2,"max-width","24rem"],[3,"latitude","longitude"],["data-modal-target","buyModal","data-modal-toggle","buyModal","class","text-white bg-gradient-to-br from-blue-950 via-slate to-blue hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-pink-200 dark:focus:ring-pink-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-2 mb-2","aria-current","page",3,"click",4,"ngIf"],["id","buyModal","tabindex","-1","aria-hidden","true","class","fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center z-50",4,"ngIf"],["routerLink","","type","button",1,"text-white","bg-gradient-to-br","from-red-950","via-slate","to-red","hover:bg-gradient-to-bl","focus:ring-4","focus:outline-none","focus:ring-pink-200","dark:focus:ring-pink-800","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","mr-2","mb-2"],["data-modal-target","buyModal","data-modal-toggle","buyModal","aria-current","page",1,"text-white","bg-gradient-to-br","from-blue-950","via-slate","to-blue","hover:bg-gradient-to-bl","focus:ring-4","focus:outline-none","focus:ring-pink-200","dark:focus:ring-pink-800","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","mr-2","mb-2",3,"click"],["id","buyModal","tabindex","-1","aria-hidden","true",1,"fixed","top-0","left-0","right-0","bottom-0","flex","items-center","justify-center","z-50"],[3,"eventId"]],template:function(Kt,dn){1&Kt&&(ke.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),ke._UZ(6,"img",6),ke.qZA(),ke._UZ(7,"hr",7),ke.TgZ(8,"div")(9,"div",5)(10,"h2",8),ke._uU(11,"Detalles:"),ke.qZA()(),ke.TgZ(12,"div",5)(13,"h2",9),ke._uU(14),ke.qZA()()(),ke.TgZ(15,"div")(16,"div",5)(17,"h2",8),ke._uU(18,"Inicio del Evento:"),ke.qZA()(),ke.TgZ(19,"div",5)(20,"h2",9),ke._uU(21),ke.ALo(22,"date"),ke.ALo(23,"date"),ke.ALo(24,"date"),ke.qZA(),ke.TgZ(25,"h2",9),ke._uU(26),ke.ALo(27,"date"),ke.ALo(28,"date"),ke.qZA()()(),ke._UZ(29,"hr",7),ke.TgZ(30,"div")(31,"div",5)(32,"h2",8),ke._uU(33),ke.qZA()()(),ke.TgZ(34,"div")(35,"div",5)(36,"h2",8),ke._uU(37),ke.qZA()()()(),ke.TgZ(38,"div",10)(39,"div",11)(40,"div",12)(41,"h2",13),ke._uU(42),ke.ALo(43,"titlecase"),ke.qZA()(),ke._UZ(44,"hr",7),ke.TgZ(45,"div",14)(46,"h2",15),ke._uU(47),ke.qZA()(),ke._UZ(48,"hr",7),ke.TgZ(49,"div",12)(50,"h2",15),ke._uU(51,"Ubicaci\xf3n:"),ke.qZA()(),ke.TgZ(52,"div",16)(53,"div",17),ke._UZ(54,"event-map",18),ke.qZA()(),ke._UZ(55,"hr",7),ke.TgZ(56,"div",3),ke.YNc(57,zt,2,0,"button",19),ke.YNc(58,un,2,1,"div",20),ke.TgZ(59,"div",14)(60,"button",21),ke._uU(61," Regresar "),ke.qZA()()()()()()()()()),2&Kt&&(ke.xp6(6),ke.Q6J("src","https://nm-service.onrender.com"+dn.event.eventImage,ke.LSH),ke.xp6(8),ke.hij(" ",dn.event.description," "),ke.xp6(7),ke.lnq(" ",ke.Dn7(22,15,dn.event.dateEventStart,"dd","UTC"),"/",ke.xi3(23,19,dn.event.dateEventStart,"MMM"),"/",ke.xi3(24,22,dn.event.dateEventStart,"yyy")," "),ke.xp6(5),ke.AsE(" ",ke.Dn7(27,25,dn.event.dateEventStart,"HH","UTC"),":",ke.xi3(28,29,dn.event.dateEventStart,"m")," "),ke.xp6(7),ke.hij(" Entradas Disponibles: ",dn.message," "),ke.xp6(4),ke.hij(" Precio de Entrada: ",dn.event.entryPrice," "),ke.xp6(5),ke.hij(" ",ke.lcZ(43,32,dn.event.eventName)," "),ke.xp6(5),ke.hij(" ",dn.event.description," Lorem ipsum dolor sit amet consectetur adipisicing elit. Consectetur sed itaque obcaecati sit tenetur voluptatibus numquam iure cupiditate odio, reiciendis animi rerum nisi nostrum aspernatur, nam cum aperiam, mollitia nulla. "),ke.xp6(7),ke.Q6J("latitude",dn.event.latitude)("longitude",dn.event.longitude),ke.xp6(3),ke.Q6J("ngIf",dn.showButton),ke.xp6(1),ke.Q6J("ngIf",dn.modalService.isBuyEntryModalOpen))},dependencies:[O.O5,f.rH,xt.D,Bt,O.rS,O.uU],encapsulation:2})}return ln})();var Jn=_e(5932);const mr=[{path:"add-event",component:ze.F},{path:"detail-event/:eventId",component:jn,children:[{path:"",loadChildren:()=>Promise.resolve().then(_e.bind(_e,269)).then(ln=>ln.EntryModule)},{path:"qr",loadChildren:()=>Promise.resolve().then(_e.bind(_e,269)).then(ln=>ln.EntryModule)},{path:"assistant/:eventId",component:Jn.T}]}];let Xt=(()=>{class ln{static#e=this.\u0275fac=function(Kt){return new(Kt||ln)};static#t=this.\u0275mod=ke.oAB({type:ln});static#n=this.\u0275inj=ke.cJS({imports:[f.Bz.forChild(mr),f.Bz]})}return ln})();var rr=_e(9862),kt=_e(269);let gt=(()=>{class ln{static#e=this.\u0275fac=function(Kt){return new(Kt||ln)};static#t=this.\u0275mod=ke.oAB({type:ln});static#n=this.\u0275inj=ke.cJS({providers:[St.k],imports:[O.ez,bt.u5,Xt,kt.EntryModule,rr.JF]})}return ln})()},5579:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{P:()=>ke});var O=_e(9702),bt=_e(7398),St=_e(9862),f=_e(4946),ze=_e(1801);let ke=(()=>{class Vt{constructor(xt,ft){this.eventsDataSource=xt,this.http=ft,this.apiUrl=O.d.apiUrl,this.eventList=[]}getEvents(){this.http.get(`${this.apiUrl}events/`).pipe((0,bt.U)(xt=>xt.map(ft=>({id:ft.id,dateEventStart:new Date(ft.date_event_start),eventName:ft.event_name,eventImage:ft.event_image,description:ft.description,latitude:ft.latitude,longitude:ft.longitude,capacity:ft.capacity,entryPrice:ft.entry_price,entryType:ft.entry_type,userId:ft.userId})))).subscribe(xt=>{this.eventList=xt})}getEvent(xt){return this.http.get(`${this.apiUrl}event/${xt}`).pipe((0,bt.U)(ft=>({id:ft.id,dateEventStart:new Date(ft.date_event_start),eventName:ft.event_name,eventImage:ft.event_image,description:ft.description,latitude:ft.latitude,longitude:ft.longitude,capacity:ft.capacity,entryPrice:ft.entry_price,entryType:ft.entry_type,userId:ft.user_id})))}getEventsByUser(xt){return this.http.get(`${this.apiUrl}events-by-user/${xt}`).pipe((0,bt.U)(ft=>ft.map(it=>({id:it.id,dateEventStart:new Date(it.date_event_start),eventName:it.event_name,eventImage:it.event_image,description:it.description,latitude:it.latitude,longitude:it.longitude,capacity:it.capacity,entryPrice:it.entry_price,entryType:it.entry_type,userId:it.user_id}))))}addEvent(xt){console.log(xt);const ft=localStorage.getItem("tokenJWT"),it=new St.WM({Authorization:`Bearer ${ft}`});return this.http.post(this.apiUrl+"events/create/",xt,{headers:it})}deleteEvent(xt){return this.http.delete(`${this.apiUrl}delete-events/${xt}`)}updateEvent(xt,ft){return this.http.put(`${this.apiUrl}update_events/${xt}/`,ft)}static#e=this.\u0275fac=function(ft){return new(ft||Vt)(f.LFG(ze.k),f.LFG(St.eN))};static#t=this.\u0275prov=f.Yz7({token:Vt,factory:Vt.\u0275fac,providedIn:"root"})}return Vt})()},7232:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{M:()=>bt});var O=_e(4946);let bt=(()=>{class St{constructor(){this.isLoginModalOpen=!1,this.isAssistantModalOpen=!1,this.isAttendeeModalOpen=!1,this.isRegisterModalOpen=!1,this.isRegisterEventModalOpen=!1,this.isUpdateEventModalOpen=!1,this.isDeleteEventModalOpen=!1,this.isBuyEntryModalOpen=!1}openBuyModal(){this.isBuyEntryModalOpen=!0}closeBuyModal(){this.isBuyEntryModalOpen=!1}openLoginModal(){this.isLoginModalOpen=!0}closeLoginModal(){this.isLoginModalOpen=!1}openRegisterModal(){this.isRegisterModalOpen=!0}closeRegisterModal(){this.isRegisterModalOpen=!1}openAssistantEventModal(){this.isAssistantModalOpen=!0}closeAssistantEventModal(){this.isAssistantModalOpen=!1}openAttendeeEventModal(){this.isAttendeeModalOpen=!0}closeAttendeeModal(){this.isAttendeeModalOpen=!1}openRegisterEventModal(){this.isRegisterEventModalOpen=!0}closeRegisterEventModal(){this.isRegisterEventModalOpen=!1}openUpdateEventModal(){this.isUpdateEventModalOpen=!0}closeUpdateEventModal(){this.isUpdateEventModalOpen=!1}openDeleteEventModal(){this.isDeleteEventModalOpen=!0}closeDeleteEventModal(){this.isDeleteEventModalOpen=!1}static#e=this.\u0275fac=function(ke){return new(ke||St)};static#t=this.\u0275prov=O.Yz7({token:St,factory:St.\u0275fac,providedIn:"root"})}return St})()},6133:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{S:()=>it});var O=_e(4946),bt=_e(7232),St=_e(2482),f=_e(180),ze=_e(6814);function ke(dt,Bt){1&dt&&(O.TgZ(0,"li")(1,"a",14),O._uU(2,"Mi perfil"),O.qZA()())}function Vt(dt,Bt){if(1&dt){const zt=O.EpF();O.TgZ(0,"li")(1,"button",15),O.NdJ("click",function(){O.CHM(zt);const jn=O.oxw();return O.KtG(jn.logout())}),O._uU(2," Cerrar Sesi\xf3n "),O.qZA()()}}function $t(dt,Bt){1&dt&&(O.TgZ(0,"li")(1,"button",16),O._uU(2," Iniciar Sesi\xf3n "),O.qZA()()),2&dt&&(O.xp6(1),O.Q6J("routerLink","user/login"))}function xt(dt,Bt){1&dt&&O._UZ(0,"div",18)}function ft(dt,Bt){if(1&dt&&(O.TgZ(0,"li")(1,"button",16),O._uU(2," Registrar Usuario "),O.qZA(),O.YNc(3,xt,1,0,"div",17),O.qZA()),2&dt){const zt=O.oxw();O.xp6(1),O.Q6J("routerLink","user/register"),O.xp6(2),O.Q6J("ngIf",zt.modalService.isRegisterModalOpen)}}let it=(()=>{class dt{constructor(zt,un,jn){this.modalService=zt,this.userService=un,this.router=jn,this.isLoggedIn=!1,this.isPromotor=!1}ngOnInit(){this.userService.getCurrentUser().subscribe(zt=>{this.userData=zt,this.isLoggedIn=null!==zt,zt&&zt.userType?console.log(zt.userType):console.log("userData o userData.user_type es nulo"),this.isPromotor="Promotor"===zt.userType},zt=>{console.error("Error al obtener el usuario actual",zt)})}openLoginModal(){this.modalService.openLoginModal()}closeLoginModal(){this.modalService.closeLoginModal()}openRegisterModal(){this.modalService.openRegisterModal()}closeRegisterModal(){this.modalService.closeRegisterModal()}logout(){this.userService.logout(),localStorage.removeItem("tokenJWT"),this.isLoggedIn=!1,setTimeout(()=>{this.router.navigate([""])},700)}onLogoutClick(){this.userService.logout()}static#e=this.\u0275fac=function(un){return new(un||dt)(O.Y36(bt.M),O.Y36(St.K),O.Y36(f.F0))};static#t=this.\u0275cmp=O.Xpm({type:dt,selectors:[["shared-navbar"]],decls:25,vars:4,consts:[[1,"bg-gradient-to-r","from-gray-900","via-blue","to-blue-950"],[1,"max-w-screen-xl","flex","flex-wrap","items-center","justify-between","mx-auto","p-4"],["href","#",1,"flex","items-center"],["src","assets/images/logo/full_logo_white.png","alt","Nexus Meet Logo",1,"h-28","mr-10px"],["data-collapse-toggle","navbar-default","type","button","aria-controls","navbar-default","aria-expanded","false",1,"inline-flex","items-center","p-2","w-10","h-10","justify-center","text-sm","text-gray-500","rounded-lg","md:hidden","hover:bg-gray-100","focus:outline-none","focus:ring-2","focus:ring-gray-200","dark:text-gray-400","dark:hover:bg-gray-700","dark:focus:ring-gray-600"],[1,"sr-only"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 17 14",1,"w-5","h-5"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M1 1h15M1 7h15M1 13h15"],["id","navbar-default",1,"hidden","w-full","md:block","md:w-auto"],[1,"font-medium","flex","flex-col","p-4","md:p-0","mt-4","border","border-gray-100","bg-gradient-to-r","from-gray","to-blue-950","md:flex-row","md:space-x-8","md:mt-0","md:border-0","dark:bg-gray-800","md:dark:bg-gray-900","dark:border-gray-700"],["routerLink","/","aria-current","page",1,"block","py-2","pl-3","pr-4","text-xl","text-white","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500"],["href","#","aria-current","page",1,"block","py-2","pl-3","pr-4","text-white","text-xl","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500"],["routerLink","","aria-current","page",1,"block","py-2","pl-3","pr-4","text-white","text-xl","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500"],[4,"ngIf"],["routerLink","user/profile","aria-current","page",1,"block","py-2","pl-3","pr-4","text-xl","text-white","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500"],["aria-current","page",1,"block","py-2","pl-3","pr-4","text-white","text-xl","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500",3,"click"],["aria-current","page",1,"block","py-2","pl-3","pr-4","text-white","text-xl","bg-white-700","rounded","md:bg-transparent","md:text-white-50","md:p-0","dark:text-white","md:dark:text-blue-500",3,"routerLink"],["id","defaultModal","tabindex","-1","aria-hidden","true","class","fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center z-50",4,"ngIf"],["id","defaultModal","tabindex","-1","aria-hidden","true",1,"fixed","top-0","left-0","right-0","bottom-0","flex","items-center","justify-center","z-50"]],template:function(un,jn){1&un&&(O.TgZ(0,"header")(1,"nav",0)(2,"div",1)(3,"a",2),O._UZ(4,"img",3),O.qZA(),O.TgZ(5,"button",4)(6,"span",5),O._uU(7,"Open main menu"),O.qZA(),O.O4$(),O.TgZ(8,"svg",6),O._UZ(9,"path",7),O.qZA()(),O.kcU(),O.TgZ(10,"div",8)(11,"ul",9)(12,"li")(13,"a",10),O._uU(14,"Inicio"),O.qZA()(),O.TgZ(15,"li")(16,"a",11),O._uU(17,"Acerca De"),O.qZA()(),O.TgZ(18,"li")(19,"a",12),O._uU(20,"Eventos"),O.qZA()(),O.YNc(21,ke,3,0,"li",13),O.YNc(22,Vt,3,0,"li",13),O.YNc(23,$t,3,1,"li",13),O.YNc(24,ft,4,2,"li",13),O.qZA()()()()()),2&un&&(O.xp6(21),O.Q6J("ngIf",jn.isLoggedIn),O.xp6(1),O.Q6J("ngIf",jn.isLoggedIn),O.xp6(1),O.Q6J("ngIf",!jn.isLoggedIn),O.xp6(1),O.Q6J("ngIf",!jn.isLoggedIn))},dependencies:[ze.O5,f.rH],encapsulation:2})}return dt})()},6208:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{m:()=>ze});var O=_e(6814),bt=_e(180),St=_e(3990),f=_e(4946);let ze=(()=>{class ke{static#e=this.\u0275fac=function(xt){return new(xt||ke)};static#t=this.\u0275mod=f.oAB({type:ke});static#n=this.\u0275inj=f.cJS({imports:[O.ez,bt.Bz,St.EventsModule]})}return ke})()},2482:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{K:()=>jn});var O=_e(5861),bt=_e(9702),St=_e(9862),f=_e(9397),ze=_e(6306),ke=_e(2096),Vt=_e(7398);function $t(Jn){this.message=Jn}($t.prototype=new Error).name="InvalidCharacterError";var xt=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(Jn){var mr=String(Jn).replace(/=+$/,"");if(mr.length%4==1)throw new $t("'atob' failed: The string to be decoded is not correctly encoded.");for(var Xt,rr,kt=0,gt=0,ln="";rr=mr.charAt(gt++);~rr&&(Xt=kt%4?64*Xt+rr:rr,kt++%4)?ln+=String.fromCharCode(255&Xt>>(-2*kt&6)):0)rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(rr);return ln};function it(Jn){this.message=Jn}(it.prototype=new Error).name="InvalidTokenError";var zt=_e(4946);let un=(()=>{class Jn{constructor(Xt){this.http=Xt,this.apiUrl=bt.d.apiUrl}getUser(Xt){var rr=this;return(0,O.Z)(function*(){try{return yield rr.http.get(`${rr.apiUrl}get-user/${Xt}`).toPromise()}catch(kt){throw console.error("Error al obtener el usuario:",kt),kt}})()}static#e=this.\u0275fac=function(rr){return new(rr||Jn)(zt.LFG(St.eN))};static#t=this.\u0275prov=zt.Yz7({token:Jn,factory:Jn.\u0275fac,providedIn:"root"})}return Jn})(),jn=(()=>{class Jn{constructor(Xt,rr){this.http=Xt,this.usersDataSource=rr,this.apiUrl=bt.d.apiUrl,this.token="",this.errors=[],this.httpOptions={headers:new St.WM({"Content-Type":"application/json"})}}addUser(Xt){return this.http.post(this.apiUrl+"create-user/",Xt)}login(Xt,rr){const kt={username:Xt,password:rr},gt=new St.WM({"Content-Type":"application/json"});return this.http.post(this.apiUrl+"api/token/",kt,{headers:gt}).pipe((0,f.b)(ln=>{this.updateData(ln.access),this.showExpiredToken(ln.access),localStorage.setItem("tokenJWT",ln.access)}),(0,ze.K)(ln=>(console.error("Error al iniciar sesi\xf3n:",ln),(0,ke.of)(!1))))}showExpiredToken(Xt){try{const rr=function dt(Jn,mr){if("string"!=typeof Jn)throw new it("Invalid token specified");var Xt=!0===(mr=mr||{}).header?0:1;try{return JSON.parse(function ft(Jn){var mr=Jn.replace(/-/g,"+").replace(/_/g,"/");switch(mr.length%4){case 0:break;case 2:mr+="==";break;case 3:mr+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(xt(mr).replace(/(.)/g,function(rr,kt){var gt=kt.charCodeAt(0).toString(16).toUpperCase();return gt.length<2&&(gt="0"+gt),"%"+gt}))}catch{return xt(mr)}}(Jn.split(".")[Xt]))}catch(rr){throw new it("Invalid token specified: "+rr.message)}}(Xt),kt=new Date(0);kt.setUTCSeconds(rr.exp),console.log("Tiempo de expiraci\xf3n del token:",kt)}catch(rr){console.error("Error al decodificar el token:",rr)}}refreshToken(){this.http.post(this.apiUrl+"api/token/refresh/",JSON.stringify({token:this.token}),this.httpOptions).subscribe(Xt=>{this.updateData(Xt.token)},Xt=>{this.errors=Xt.error})}logout(){const Xt=localStorage.getItem("tokenJWT");Xt?this.http.post(this.apiUrl+"logout/",{token:Xt}).subscribe(()=>{localStorage.removeItem("tokenJWT"),this.token="",this.token_expires=new Date,this.username=""},rr=>{console.error("Error al cerrar sesi\xf3n:",rr)}):console.log("El token ha expirado")}updateData(Xt){this.token=Xt,this.errors=[];const rr=this.token.split(/\./),kt=JSON.parse(window.atob(rr[1]));this.token_expires=new Date(1e3*kt.exp),this.username=kt.username,console.log(this.token_expires)}getCurrentUser(){const Xt=localStorage.getItem("tokenJWT");if(Xt){const rr=new St.WM({Authorization:`Bearer ${Xt}`});return this.http.get(`${this.apiUrl}get-current-user/`,{headers:rr}).pipe((0,Vt.U)(kt=>({id:kt.id,lastLogin:new Date(kt.last_login),username:kt.username,firstName:kt.first_name,lastName:kt.last_name,email:kt.email,dateJoined:new Date(kt.date_joined),userType:kt.user_type,phoneNumber:kt.phone_number,address:kt.address,profilePicture:kt.profile_picture,dateOfBirth:new Date(kt.date_of_birth)})))}return console.log("Error en el token"),(0,ke.of)(null)}updateUser(Xt,rr){return this.http.put(`${this.apiUrl}update-user/${Xt}`,rr)}getUser(Xt){var rr=this;return(0,O.Z)(function*(){return yield rr.usersDataSource.getUser(Xt)})()}getEntrysByUser(Xt){return this.http.get(`${this.apiUrl}entrys/get-entrys-by-user/${Xt}`).pipe((0,Vt.U)(rr=>rr.map(kt=>({id:kt.id,quantity:kt.quantity,priceTotal:kt.price_total,userId:kt.user_id,eventId:kt.event_id,eventName:kt.event_name,qr:kt.image_qr}))))}static#e=this.\u0275fac=function(rr){return new(rr||Jn)(zt.LFG(St.eN),zt.LFG(un))};static#t=this.\u0275prov=zt.Yz7({token:Jn,factory:Jn.\u0275fac,providedIn:"root"})}return Jn})()},8694:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{N:()=>O});const O={production:!1,mapBoxToken:"pk.eyJ1Ijoic3ludGF4MjgiLCJhIjoiY2xueXhiaTljMDF5NDJrczNycHJodnVpYSJ9.Cc7yVgUjgegd0zluWDxqaw"}},1694:(yr,Qt,_e)=>{"use strict";var O=_e(6593),bt=_e(9862),St=_e(180),f=_e(4946),ze=_e(5579),ke=_e(6814);function Vt(ie,K){1&ie&&f._UZ(0,"img",18)}const $t=function(ie){return{display:ie}};let xt=(()=>{class ie{constructor(){this.hasLoaded=!1}onLoad(){setTimeout(()=>{this.hasLoaded=!0},200)}static#e=this.\u0275fac=function(Ie){return new(Ie||ie)};static#t=this.\u0275cmp=f.Xpm({type:ie,selectors:[["shared-event-card-image"]],inputs:{event:"event"},decls:26,vars:19,consts:[[1,"content-container","animate__animated","animate__fadeIn"],[1,"shadow-lg","group","relative","container","rounded-md","bg-white","max-w-sm","mx-auto"],[1,"content-div"],["alt","event.eventImage",3,"src","ngStyle","load"],["src","assets/loader.svg",4,"ngIf"],[1,"overlay"],[1,"text-content"],[1,"p-2","m-4","w-16","h-16","text-center","bg-gray-700","rounded-full","text-white","float-right","fd-cl","group-hover:opacity-25"],[1,"text-base","tracking-wide","font-bold","border-b","border-white","font-sans"],[1,"text-xs","tracking-wide","font-bold","uppercase","block","font-sans"],[1,"py-8","px-4","bg-white","rounded-b-md","fd-cl","group-hover:opacity-25"],[1,"block","text-lg","text-gray-800","font-bold","tracking-wide"],[1,"block","text-gray-600","text-sm"],[1,"absolute","fd-sh","group-hover:opacity-100"],[1,"flex","flex-col","items-center"],[1,"text-3xl","font-bold","text-white","tracking-wider","leading-relaxed","font-sans"],[1,"pt-8","text-center"],[1,"rounded-lg","p-4","bg-white","text-gray-700","font-bold","text-lg",3,"routerLink"],["src","assets/loader.svg"]],template:function(Ie,Ge){1&Ie&&(f.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"img",3),f.NdJ("load",function(){return Ge.onLoad()}),f.qZA(),f.YNc(4,Vt,1,0,"img",4),f._UZ(5,"div",5),f.TgZ(6,"div",6)(7,"div",7)(8,"span",8),f._uU(9),f.ALo(10,"date"),f.qZA(),f.TgZ(11,"span",9),f._uU(12),f.ALo(13,"date"),f.qZA()(),f.TgZ(14,"div",10)(15,"span",11),f._uU(16),f.qZA(),f.TgZ(17,"span",12),f._uU(18),f.qZA()()()(),f.TgZ(19,"div",13)(20,"div",14)(21,"span",15),f._uU(22),f.qZA(),f.TgZ(23,"div",16)(24,"button",17),f._uU(25," Ver m\xe1s "),f.qZA()()()()()()),2&Ie&&(f.xp6(3),f.Q6J("src","https://nm-service.onrender.com"+Ge.event.eventImage,f.LSH)("ngStyle",f.VKq(17,$t,Ge.hasLoaded?"":"none")),f.xp6(1),f.Q6J("ngIf",!Ge.hasLoaded),f.xp6(5),f.Oqu(f.Dn7(10,10,Ge.event.dateEventStart,"dd","UTC")),f.xp6(3),f.Oqu(f.xi3(13,14,Ge.event.dateEventStart,"MMM")),f.xp6(4),f.AsE("",Ge.event.id,". ",Ge.event.eventName,""),f.xp6(2),f.hij("",Ge.event.description," Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia inventore minus magnam provident ratione eveniet aut amet corrupti porro dicta aliquid, sequi ipsum fugit blanditiis ab cum suscipit ut quo. "),f.xp6(4),f.Oqu(Ge.event.eventName),f.xp6(2),f.Q6J("routerLink","events/detail-event/"+Ge.event.id))},dependencies:[ke.O5,ke.PC,St.rH,ke.uU],styles:[".content-container[_ngcontent-%COMP%] {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .absolute[_ngcontent-%COMP%] {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    opacity: 0;\n    transition: opacity 0.3s ease-in-out;\n    pointer-events: auto;\n    z-index: 1;\n  }\n\n  .content-div[_ngcontent-%COMP%] {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .overlay[_ngcontent-%COMP%] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-image: linear-gradient(\n      to right,\n      rgba(0, 0, 0, 0.801),\n      hsla(244, 98%, 22%, 0.801)\n    );\n    opacity: 0;\n    transition: opacity 0.3s ease-in-out;\n  }\n\n  .content-container[_ngcontent-%COMP%]:hover   .overlay[_ngcontent-%COMP%] {\n    opacity: 1;\n  }\n\n  .content-div[_ngcontent-%COMP%]:hover    + .absolute[_ngcontent-%COMP%] {\n    opacity: 1;\n    pointer-events: auto;\n  }\n\n  .content-div[_ngcontent-%COMP%]   img[_ngcontent-%COMP%] {\n    height: 260px;\n    width: 100%;\n    object-fit: cover;\n  }\n\n  .text-content[_ngcontent-%COMP%] {\n    position: relative;\n    z-index: 1;\n  }"]})}return ie})();function ft(ie,K){if(1&ie&&(f.TgZ(0,"div",2),f._UZ(1,"shared-event-card-image",3),f.qZA()),2&ie){const le=K.$implicit;f.xp6(1),f.Q6J("event",le)}}let it=(()=>{class ie{constructor(){this.eventsList=[]}static#e=this.\u0275fac=function(Ie){return new(Ie||ie)};static#t=this.\u0275cmp=f.Xpm({type:ie,selectors:[["app-list"]],inputs:{eventsList:"eventsList"},decls:2,vars:1,consts:[[1,"flex","flex-wrap","-mx-6","justify-center"],["class","w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5 px-3 py-3",4,"ngFor","ngForOf"],[1,"w-full","sm:w-1/2","md:w-1/3","lg:w-1/4","xl:w-1/5","px-3","py-3"],[3,"event"]],template:function(Ie,Ge){1&Ie&&(f.TgZ(0,"div",0),f.YNc(1,ft,2,1,"div",1),f.qZA()),2&Ie&&(f.xp6(1),f.Q6J("ngForOf",Ge.eventsList))},dependencies:[ke.sg,xt],styles:["div[_ngcontent-%COMP%]{\n    margin: 0;\n  }"]})}return ie})();var dt=_e(6133);const zt=[{path:"",component:(()=>{class ie{constructor(le){this.eventService=le,this.imageTwo="https://img.freepik.com/foto-gratis/salon-banquetes-decorado-mesa-redonda-servida-centro-mesa-hortensias-sillas-chiavari_8353-10059.jpg?w=996&t=st=1662586503~exp=1662587103~hmac=370e6bd8eb5009deede78fe2c488dcb326d8bc36f4ea119076470c47a9173916",this.imageTree="https://img.freepik.com/fotos-premium/gente-feliz-baila-concierto-fiesta-discoteca_31965-6829.jpg?w=1060"}ngOnInit(){this.eventService.getEvents()}get eventList(){return this.eventService.eventList}static#e=this.\u0275fac=function(Ie){return new(Ie||ie)(f.Y36(ze.P))};static#t=this.\u0275cmp=f.Xpm({type:ie,selectors:[["app-main-page"]],decls:12,vars:3,consts:[[1,"bg-gradient-to-b","from-gray-500","via-blue-100","to-white-950"],[1,"relative","bg-gray-600/50","rounded-lg","p-4","w-4/5","mx-auto"],["id","controls-carousel","data-carousel","static",1,"relative","w-full"],[1,"relative","h-56","overflow-hidden","rounded-lg","md:h-96"],["data-carousel-item","active",1,"hidden","duration-700","ease-in-out"],["alt","...",1,"absolute","block","w-full","-translate-x-1/2","-translate-y-1/2","top-1/2","left-1/2",3,"src"],["data-carousel-item","",1,"hidden","duration-700","ease-in-out"],["type","button","data-carousel-prev","",1,"absolute","top-0","left-0","z-30","flex","items-center","justify-center","h-full","px-4","cursor-pointer","group","focus:outline-none"],["type","button","data-carousel-next","",1,"absolute","top-0","right-0","z-30","flex","items-center","justify-center","h-full","px-4","cursor-pointer","group","focus:outline-none"],[3,"eventsList"]],template:function(Ie,Ge){1&Ie&&(f._UZ(0,"shared-navbar"),f.TgZ(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),f._UZ(6,"img",5),f.qZA(),f.TgZ(7,"div",6),f._UZ(8,"img",5),f.qZA()(),f._UZ(9,"button",7)(10,"button",8),f.qZA()(),f._UZ(11,"app-list",9),f.qZA()),2&Ie&&(f.xp6(6),f.Q6J("src",Ge.imageTwo,f.LSH),f.xp6(2),f.Q6J("src",Ge.imageTree,f.LSH),f.xp6(3),f.Q6J("eventsList",Ge.eventList))},dependencies:[it,dt.S],encapsulation:2})}return ie})()},{path:"user",loadChildren:()=>_e.e(331).then(_e.bind(_e,331)).then(ie=>ie.UsersModule)},{path:"events",loadChildren:()=>Promise.resolve().then(_e.bind(_e,3990)).then(ie=>ie.EventsModule)},{path:"**",redirectTo:""}];let un=(()=>{class ie{static#e=this.\u0275fac=function(Ie){return new(Ie||ie)};static#t=this.\u0275mod=f.oAB({type:ie});static#n=this.\u0275inj=f.cJS({imports:[St.Bz.forRoot(zt,{useHash:!0}),St.Bz]})}return ie})();const Jn=function(){function ie(K,le){void 0===le&&(le=[]),this._eventType=K,this._eventFunctions=le}return ie.prototype.init=function(){var K=this;this._eventFunctions.forEach(function(le){typeof window<"u"&&window.addEventListener(K._eventType,le)})},ie}();var mr=function(){return mr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},mr.apply(this,arguments)},Xt={alwaysOpen:!1,activeClasses:"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white",inactiveClasses:"text-gray-500 dark:text-gray-400",onOpen:function(){},onClose:function(){},onToggle:function(){}},rr=function(){function ie(K,le){void 0===K&&(K=[]),void 0===le&&(le=Xt),this._items=K,this._options=mr(mr({},Xt),le),this._init()}return ie.prototype._init=function(){var K=this;this._items.length&&this._items.map(function(le){le.active&&K.open(le.id),le.triggerEl.addEventListener("click",function(){K.toggle(le.id)})})},ie.prototype.getItem=function(K){return this._items.filter(function(le){return le.id===K})[0]},ie.prototype.open=function(K){var le,Ie,Ge=this,yt=this.getItem(K);this._options.alwaysOpen||this._items.map(function(vn){var Sn,re;vn!==yt&&((Sn=vn.triggerEl.classList).remove.apply(Sn,Ge._options.activeClasses.split(" ")),(re=vn.triggerEl.classList).add.apply(re,Ge._options.inactiveClasses.split(" ")),vn.targetEl.classList.add("hidden"),vn.triggerEl.setAttribute("aria-expanded","false"),vn.active=!1,vn.iconEl&&vn.iconEl.classList.remove("rotate-180"))}),(le=yt.triggerEl.classList).add.apply(le,this._options.activeClasses.split(" ")),(Ie=yt.triggerEl.classList).remove.apply(Ie,this._options.inactiveClasses.split(" ")),yt.triggerEl.setAttribute("aria-expanded","true"),yt.targetEl.classList.remove("hidden"),yt.active=!0,yt.iconEl&&yt.iconEl.classList.add("rotate-180"),this._options.onOpen(this,yt)},ie.prototype.toggle=function(K){var le=this.getItem(K);le.active?this.close(K):this.open(K),this._options.onToggle(this,le)},ie.prototype.close=function(K){var le,Ie,Ge=this.getItem(K);(le=Ge.triggerEl.classList).remove.apply(le,this._options.activeClasses.split(" ")),(Ie=Ge.triggerEl.classList).add.apply(Ie,this._options.inactiveClasses.split(" ")),Ge.targetEl.classList.add("hidden"),Ge.triggerEl.setAttribute("aria-expanded","false"),Ge.active=!1,Ge.iconEl&&Ge.iconEl.classList.remove("rotate-180"),this._options.onClose(this,Ge)},ie}();function kt(){document.querySelectorAll("[data-accordion]").forEach(function(ie){var K=ie.getAttribute("data-accordion"),le=ie.getAttribute("data-active-classes"),Ie=ie.getAttribute("data-inactive-classes"),Ge=[];ie.querySelectorAll("[data-accordion-target]").forEach(function(yt){if(yt.closest("[data-accordion]")===ie){var vn={id:yt.getAttribute("data-accordion-target"),triggerEl:yt,targetEl:document.querySelector(yt.getAttribute("data-accordion-target")),iconEl:yt.querySelector("[data-accordion-icon]"),active:"true"===yt.getAttribute("aria-expanded")};Ge.push(vn)}}),new rr(Ge,{alwaysOpen:"open"===K,activeClasses:le||Xt.activeClasses,inactiveClasses:Ie||Xt.inactiveClasses})})}typeof window<"u"&&(window.Accordion=rr,window.initAccordions=kt);var ln=function(){return ln=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},ln.apply(this,arguments)},Wn={onCollapse:function(){},onExpand:function(){},onToggle:function(){}},Yt=function(){function ie(K,le,Ie){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=Wn),this._targetEl=K,this._triggerEl=le,this._options=ln(ln({},Wn),Ie),this._visible=!1,this._init()}return ie.prototype._init=function(){var K=this;this._triggerEl&&(this._visible=this._triggerEl.hasAttribute("aria-expanded")?"true"===this._triggerEl.getAttribute("aria-expanded"):!this._targetEl.classList.contains("hidden"),this._triggerEl.addEventListener("click",function(){K.toggle()}))},ie.prototype.collapse=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onCollapse(this)},ie.prototype.expand=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onExpand(this)},ie.prototype.toggle=function(){this._visible?this.collapse():this.expand(),this._options.onToggle(this)},ie}();function Kt(){document.querySelectorAll("[data-collapse-toggle]").forEach(function(ie){var K=ie.getAttribute("data-collapse-toggle"),le=document.getElementById(K);le?new Yt(le,ie):console.error('The target element with id "'.concat(K,'" does not exist. Please check the data-collapse-toggle attribute.'))})}typeof window<"u"&&(window.Collapse=Yt,window.initCollapses=Kt);var kn=function(){return kn=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},kn.apply(this,arguments)},di={defaultPosition:0,indicators:{items:[],activeClasses:"bg-white dark:bg-gray-800",inactiveClasses:"bg-white/50 dark:bg-gray-800/50 hover:bg-white dark:hover:bg-gray-800"},interval:3e3,onNext:function(){},onPrev:function(){},onChange:function(){}},xo=function(){function ie(K,le){void 0===K&&(K=[]),void 0===le&&(le=di),this._items=K,this._options=kn(kn(kn({},di),le),{indicators:kn(kn({},di.indicators),le.indicators)}),this._activeItem=this.getItem(this._options.defaultPosition),this._indicators=this._options.indicators.items,this._intervalDuration=this._options.interval,this._intervalInstance=null,this._init()}return ie.prototype._init=function(){var K=this;this._items.map(function(le){le.el.classList.add("absolute","inset-0","transition-transform","transform")}),this._getActiveItem()?this.slideTo(this._getActiveItem().position):this.slideTo(0),this._indicators.map(function(le,Ie){le.el.addEventListener("click",function(){K.slideTo(Ie)})})},ie.prototype.getItem=function(K){return this._items[K]},ie.prototype.slideTo=function(K){var le=this._items[K];this._rotate({left:0===le.position?this._items[this._items.length-1]:this._items[le.position-1],middle:le,right:le.position===this._items.length-1?this._items[0]:this._items[le.position+1]}),this._setActiveItem(le),this._intervalInstance&&(this.pause(),this.cycle()),this._options.onChange(this)},ie.prototype.next=function(){var K=this._getActiveItem();this.slideTo((K.position===this._items.length-1?this._items[0]:this._items[K.position+1]).position),this._options.onNext(this)},ie.prototype.prev=function(){var K=this._getActiveItem();this.slideTo((0===K.position?this._items[this._items.length-1]:this._items[K.position-1]).position),this._options.onPrev(this)},ie.prototype._rotate=function(K){this._items.map(function(le){le.el.classList.add("hidden")}),K.left.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),K.left.el.classList.add("-translate-x-full","z-10"),K.middle.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-10"),K.middle.el.classList.add("translate-x-0","z-20"),K.right.el.classList.remove("-translate-x-full","translate-x-full","translate-x-0","hidden","z-20"),K.right.el.classList.add("translate-x-full","z-10")},ie.prototype.cycle=function(){var K=this;typeof window<"u"&&(this._intervalInstance=window.setInterval(function(){K.next()},this._intervalDuration))},ie.prototype.pause=function(){clearInterval(this._intervalInstance)},ie.prototype._getActiveItem=function(){return this._activeItem},ie.prototype._setActiveItem=function(K){var le,Ie,Ge=this;this._activeItem=K;var yt=K.position;this._indicators.length&&(this._indicators.map(function(vn){var Sn,re;vn.el.setAttribute("aria-current","false"),(Sn=vn.el.classList).remove.apply(Sn,Ge._options.indicators.activeClasses.split(" ")),(re=vn.el.classList).add.apply(re,Ge._options.indicators.inactiveClasses.split(" "))}),(le=this._indicators[yt].el.classList).add.apply(le,this._options.indicators.activeClasses.split(" ")),(Ie=this._indicators[yt].el.classList).remove.apply(Ie,this._options.indicators.inactiveClasses.split(" ")),this._indicators[yt].el.setAttribute("aria-current","true"))},ie}();function xr(){document.querySelectorAll("[data-carousel]").forEach(function(ie){var K=ie.getAttribute("data-carousel-interval"),le="slide"===ie.getAttribute("data-carousel"),Ie=[],Ge=0;ie.querySelectorAll("[data-carousel-item]").length&&Array.from(ie.querySelectorAll("[data-carousel-item]")).map(function(ue,X){Ie.push({position:X,el:ue}),"active"===ue.getAttribute("data-carousel-item")&&(Ge=X)});var yt=[];ie.querySelectorAll("[data-carousel-slide-to]").length&&Array.from(ie.querySelectorAll("[data-carousel-slide-to]")).map(function(ue){yt.push({position:parseInt(ue.getAttribute("data-carousel-slide-to")),el:ue})});var vn=new xo(Ie,{defaultPosition:Ge,indicators:{items:yt},interval:K||di.interval});le&&vn.cycle();var Sn=ie.querySelector("[data-carousel-next]"),re=ie.querySelector("[data-carousel-prev]");Sn&&Sn.addEventListener("click",function(){vn.next()}),re&&re.addEventListener("click",function(){vn.prev()})})}typeof window<"u"&&(window.Carousel=xo,window.initCarousels=xr);var Zr=function(){return Zr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},Zr.apply(this,arguments)},Ln={transition:"transition-opacity",duration:300,timing:"ease-out",onHide:function(){}},Ir=function(){function ie(K,le,Ie){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=Ln),this._targetEl=K,this._triggerEl=le,this._options=Zr(Zr({},Ln),Ie),this._init()}return ie.prototype._init=function(){var K=this;this._triggerEl&&this._triggerEl.addEventListener("click",function(){K.hide()})},ie.prototype.hide=function(){var K=this;this._targetEl.classList.add(this._options.transition,"duration-".concat(this._options.duration),this._options.timing,"opacity-0"),setTimeout(function(){K._targetEl.classList.add("hidden")},this._options.duration),this._options.onHide(this,this._targetEl)},ie}();function At(){document.querySelectorAll("[data-dismiss-target]").forEach(function(ie){var K=ie.getAttribute("data-dismiss-target"),le=document.querySelector(K);le?new Ir(le,ie):console.error('The dismiss element with id "'.concat(K,'" does not exist. Please check the data-dismiss-target attribute.'))})}function Zt(ie){if(null==ie)return window;if("[object Window]"!==ie.toString()){var K=ie.ownerDocument;return K&&K.defaultView||window}return ie}function mt(ie){return ie instanceof Zt(ie).Element||ie instanceof Element}function rn(ie){return ie instanceof Zt(ie).HTMLElement||ie instanceof HTMLElement}function _n(ie){return!(typeof ShadowRoot>"u")&&(ie instanceof Zt(ie).ShadowRoot||ie instanceof ShadowRoot)}typeof window<"u"&&(window.Dismiss=Ir,window.initDismisses=At);var gr=Math.max,Qn=Math.min,tr=Math.round;function ir(){var ie=navigator.userAgentData;return null!=ie&&ie.brands&&Array.isArray(ie.brands)?ie.brands.map(function(K){return K.brand+"/"+K.version}).join(" "):navigator.userAgent}function nn(){return!/^((?!chrome|android).)*safari/i.test(ir())}function Oi(ie,K,le){void 0===K&&(K=!1),void 0===le&&(le=!1);var Ie=ie.getBoundingClientRect(),Ge=1,yt=1;K&&rn(ie)&&(Ge=ie.offsetWidth>0&&tr(Ie.width)/ie.offsetWidth||1,yt=ie.offsetHeight>0&&tr(Ie.height)/ie.offsetHeight||1);var Sn=(mt(ie)?Zt(ie):window).visualViewport,re=!nn()&&le,ue=(Ie.left+(re&&Sn?Sn.offsetLeft:0))/Ge,X=(Ie.top+(re&&Sn?Sn.offsetTop:0))/yt,be=Ie.width/Ge,qe=Ie.height/yt;return{width:be,height:qe,top:X,right:ue+be,bottom:X+qe,left:ue,x:ue,y:X}}function Gn(ie){var K=Zt(ie);return{scrollLeft:K.pageXOffset,scrollTop:K.pageYOffset}}function qr(ie){return ie?(ie.nodeName||"").toLowerCase():null}function Ci(ie){return((mt(ie)?ie.ownerDocument:ie.document)||window.document).documentElement}function Ni(ie){return Oi(Ci(ie)).left+Gn(ie).scrollLeft}function fr(ie){return Zt(ie).getComputedStyle(ie)}function Ai(ie){var K=fr(ie);return/auto|scroll|overlay|hidden/.test(K.overflow+K.overflowY+K.overflowX)}function Pr(ie,K,le){void 0===le&&(le=!1);var Ie=rn(K),Ge=rn(K)&&function wr(ie){var K=ie.getBoundingClientRect(),le=tr(K.width)/ie.offsetWidth||1,Ie=tr(K.height)/ie.offsetHeight||1;return 1!==le||1!==Ie}(K),yt=Ci(K),vn=Oi(ie,Ge,le),Sn={scrollLeft:0,scrollTop:0},re={x:0,y:0};return(Ie||!Ie&&!le)&&(("body"!==qr(K)||Ai(yt))&&(Sn=function vi(ie){return ie!==Zt(ie)&&rn(ie)?function Pi(ie){return{scrollLeft:ie.scrollLeft,scrollTop:ie.scrollTop}}(ie):Gn(ie)}(K)),rn(K)?((re=Oi(K,!0)).x+=K.clientLeft,re.y+=K.clientTop):yt&&(re.x=Ni(yt))),{x:vn.left+Sn.scrollLeft-re.x,y:vn.top+Sn.scrollTop-re.y,width:vn.width,height:vn.height}}function xi(ie){var K=Oi(ie),le=ie.offsetWidth,Ie=ie.offsetHeight;return Math.abs(K.width-le)<=1&&(le=K.width),Math.abs(K.height-Ie)<=1&&(Ie=K.height),{x:ie.offsetLeft,y:ie.offsetTop,width:le,height:Ie}}function _r(ie){return"html"===qr(ie)?ie:ie.assignedSlot||ie.parentNode||(_n(ie)?ie.host:null)||Ci(ie)}function Rr(ie){return["html","body","#document"].indexOf(qr(ie))>=0?ie.ownerDocument.body:rn(ie)&&Ai(ie)?ie:Rr(_r(ie))}function ur(ie,K){var le;void 0===K&&(K=[]);var Ie=Rr(ie),Ge=Ie===(null==(le=ie.ownerDocument)?void 0:le.body),yt=Zt(Ie),vn=Ge?[yt].concat(yt.visualViewport||[],Ai(Ie)?Ie:[]):Ie,Sn=K.concat(vn);return Ge?Sn:Sn.concat(ur(_r(vn)))}function Mo(ie){return["table","td","th"].indexOf(qr(ie))>=0}function Ho(ie){return rn(ie)&&"fixed"!==fr(ie).position?ie.offsetParent:null}function Xi(ie){for(var K=Zt(ie),le=Ho(ie);le&&Mo(le)&&"static"===fr(le).position;)le=Ho(le);return le&&("html"===qr(le)||"body"===qr(le)&&"static"===fr(le).position)?K:le||function qt(ie){var K=/firefox/i.test(ir());if(/Trident/i.test(ir())&&rn(ie)&&"fixed"===fr(ie).position)return null;var Ge=_r(ie);for(_n(Ge)&&(Ge=Ge.host);rn(Ge)&&["html","body"].indexOf(qr(Ge))<0;){var yt=fr(Ge);if("none"!==yt.transform||"none"!==yt.perspective||"paint"===yt.contain||-1!==["transform","perspective"].indexOf(yt.willChange)||K&&"filter"===yt.willChange||K&&yt.filter&&"none"!==yt.filter)return Ge;Ge=Ge.parentNode}return null}(ie)||K}var si="top",po="bottom",Jr="right",wo="left",nr="auto",Bs=[si,po,Jr,wo],Ue="start",ge="end",Re="viewport",Oe="popper",wt=Bs.reduce(function(ie,K){return ie.concat([K+"-"+Ue,K+"-"+ge])},[]),st=[].concat(Bs,[nr]).reduce(function(ie,K){return ie.concat([K,K+"-"+Ue,K+"-"+ge])},[]),xn=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Bn(ie){var K=new Map,le=new Set,Ie=[];function Ge(yt){le.add(yt.name),[].concat(yt.requires||[],yt.requiresIfExists||[]).forEach(function(Sn){if(!le.has(Sn)){var re=K.get(Sn);re&&Ge(re)}}),Ie.push(yt)}return ie.forEach(function(yt){K.set(yt.name,yt)}),ie.forEach(function(yt){le.has(yt.name)||Ge(yt)}),Ie}function Lr(ie){var K;return function(){return K||(K=new Promise(function(le){Promise.resolve().then(function(){K=void 0,le(ie())})})),K}}var zi={placement:"bottom",modifiers:[],strategy:"absolute"};function Ji(){for(var ie=arguments.length,K=new Array(ie),le=0;le<ie;le++)K[le]=arguments[le];return!K.some(function(Ie){return!(Ie&&"function"==typeof Ie.getBoundingClientRect)})}function _t(ie){void 0===ie&&(ie={});var le=ie.defaultModifiers,Ie=void 0===le?[]:le,Ge=ie.defaultOptions,yt=void 0===Ge?zi:Ge;return function(Sn,re,ue){void 0===ue&&(ue=yt);var X={placement:"bottom",orderedModifiers:[],options:Object.assign({},zi,yt),modifiersData:{},elements:{reference:Sn,popper:re},attributes:{},styles:{}},be=[],qe=!1,On={state:X,setOptions:function(Ti){var ki="function"==typeof Ti?Ti(X.options):Ti;Br(),X.options=Object.assign({},yt,X.options,ki),X.scrollParents={reference:mt(Sn)?ur(Sn):Sn.contextElement?ur(Sn.contextElement):[],popper:ur(re)};var eo=function Mr(ie){var K=Bn(ie);return xn.reduce(function(le,Ie){return le.concat(K.filter(function(Ge){return Ge.phase===Ie}))},[])}(function hi(ie){var K=ie.reduce(function(le,Ie){var Ge=le[Ie.name];return le[Ie.name]=Ge?Object.assign({},Ge,Ie,{options:Object.assign({},Ge.options,Ie.options),data:Object.assign({},Ge.data,Ie.data)}):Ie,le},{});return Object.keys(K).map(function(le){return K[le]})}([].concat(Ie,X.options.modifiers)));return X.orderedModifiers=eo.filter(function(Qr){return Qr.enabled}),function lr(){X.orderedModifiers.forEach(function(ii){var ki=ii.options,Qr=ii.effect;if("function"==typeof Qr){var Gr=Qr({state:X,name:ii.name,instance:On,options:void 0===ki?{}:ki});be.push(Gr||function(){})}})}(),On.update()},forceUpdate:function(){if(!qe){var Ti=X.elements,ki=Ti.reference,eo=Ti.popper;if(Ji(ki,eo)){X.rects={reference:Pr(ki,Xi(eo),"fixed"===X.options.strategy),popper:xi(eo)},X.reset=!1,X.placement=X.options.placement,X.orderedModifiers.forEach(function(Uo){return X.modifiersData[Uo.name]=Object.assign({},Uo.data)});for(var Qr=0;Qr<X.orderedModifiers.length;Qr++)if(!0!==X.reset){var Gr=X.orderedModifiers[Qr],Bi=Gr.fn,Bo=Gr.options;"function"==typeof Bi&&(X=Bi({state:X,options:void 0===Bo?{}:Bo,name:Gr.name,instance:On})||X)}else X.reset=!1,Qr=-1}}},update:Lr(function(){return new Promise(function(ii){On.forceUpdate(),ii(X)})}),destroy:function(){Br(),qe=!0}};if(!Ji(Sn,re))return On;function Br(){be.forEach(function(ii){return ii()}),be=[]}return On.setOptions(ue).then(function(ii){!qe&&ue.onFirstUpdate&&ue.onFirstUpdate(ii)}),On}}var ct={passive:!0};function In(ie){return ie.split("-")[0]}function zn(ie){return ie.split("-")[1]}function br(ie){return["top","bottom"].indexOf(ie)>=0?"x":"y"}function Sr(ie){var re,K=ie.reference,le=ie.element,Ie=ie.placement,Ge=Ie?In(Ie):null,yt=Ie?zn(Ie):null,vn=K.x+K.width/2-le.width/2,Sn=K.y+K.height/2-le.height/2;switch(Ge){case si:re={x:vn,y:K.y-le.height};break;case po:re={x:vn,y:K.y+K.height};break;case Jr:re={x:K.x+K.width,y:Sn};break;case wo:re={x:K.x-le.width,y:Sn};break;default:re={x:K.x,y:K.y}}var ue=Ge?br(Ge):null;if(null!=ue){var X="y"===ue?"height":"width";switch(yt){case Ue:re[ue]=re[ue]-(K[X]/2-le[X]/2);break;case ge:re[ue]=re[ue]+(K[X]/2-le[X]/2)}}return re}var _o={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Vi(ie){var K,le=ie.popper,Ie=ie.popperRect,Ge=ie.placement,yt=ie.variation,vn=ie.offsets,Sn=ie.position,re=ie.gpuAcceleration,ue=ie.adaptive,X=ie.roundOffsets,be=ie.isFixed,qe=vn.x,On=void 0===qe?0:qe,lr=vn.y,Br=void 0===lr?0:lr,ii="function"==typeof X?X({x:On,y:Br}):{x:On,y:Br};On=ii.x,Br=ii.y;var Ti=vn.hasOwnProperty("x"),ki=vn.hasOwnProperty("y"),eo=wo,Qr=si,Gr=window;if(ue){var Bi=Xi(le),Bo="clientHeight",zo="clientWidth";Bi===Zt(le)&&"static"!==fr(Bi=Ci(le)).position&&"absolute"===Sn&&(Bo="scrollHeight",zo="scrollWidth"),(Ge===si||(Ge===wo||Ge===Jr)&&yt===ge)&&(Qr=po,Br-=(be&&Bi===Gr&&Gr.visualViewport?Gr.visualViewport.height:Bi[Bo])-Ie.height,Br*=re?1:-1),Ge!==wo&&(Ge!==si&&Ge!==po||yt!==ge)||(eo=Jr,On-=(be&&Bi===Gr&&Gr.visualViewport?Gr.visualViewport.width:Bi[zo])-Ie.width,On*=re?1:-1)}var vo,qs=Object.assign({position:Sn},ue&&_o),sa=!0===X?function Jo(ie,K){var Ie=ie.y,Ge=K.devicePixelRatio||1;return{x:tr(ie.x*Ge)/Ge||0,y:tr(Ie*Ge)/Ge||0}}({x:On,y:Br},Zt(le)):{x:On,y:Br};return On=sa.x,Br=sa.y,Object.assign({},qs,re?((vo={})[Qr]=ki?"0":"",vo[eo]=Ti?"0":"",vo.transform=(Gr.devicePixelRatio||1)<=1?"translate("+On+"px, "+Br+"px)":"translate3d("+On+"px, "+Br+"px, 0)",vo):((K={})[Qr]=ki?Br+"px":"",K[eo]=Ti?On+"px":"",K.transform="",K))}var ka={left:"right",right:"left",bottom:"top",top:"bottom"};function Go(ie){return ie.replace(/left|right|bottom|top/g,function(K){return ka[K]})}var Qs={start:"end",end:"start"};function Fn(ie){return ie.replace(/start|end/g,function(K){return Qs[K]})}function bo(ie,K){var le=K.getRootNode&&K.getRootNode();if(ie.contains(K))return!0;if(le&&_n(le)){var Ie=K;do{if(Ie&&ie.isSameNode(Ie))return!0;Ie=Ie.parentNode||Ie.host}while(Ie)}return!1}function ws(ie){return Object.assign({},ie,{left:ie.x,top:ie.y,right:ie.x+ie.width,bottom:ie.y+ie.height})}function $o(ie,K,le){return K===Re?ws(function Hr(ie,K){var le=Zt(ie),Ie=Ci(ie),Ge=le.visualViewport,yt=Ie.clientWidth,vn=Ie.clientHeight,Sn=0,re=0;if(Ge){yt=Ge.width,vn=Ge.height;var ue=nn();(ue||!ue&&"fixed"===K)&&(Sn=Ge.offsetLeft,re=Ge.offsetTop)}return{width:yt,height:vn,x:Sn+Ni(ie),y:re}}(ie,le)):mt(K)?function Vr(ie,K){var le=Oi(ie,!1,"fixed"===K);return le.top=le.top+ie.clientTop,le.left=le.left+ie.clientLeft,le.bottom=le.top+ie.clientHeight,le.right=le.left+ie.clientWidth,le.width=ie.clientWidth,le.height=ie.clientHeight,le.x=le.left,le.y=le.top,le}(K,le):ws(function kr(ie){var K,le=Ci(ie),Ie=Gn(ie),Ge=null==(K=ie.ownerDocument)?void 0:K.body,yt=gr(le.scrollWidth,le.clientWidth,Ge?Ge.scrollWidth:0,Ge?Ge.clientWidth:0),vn=gr(le.scrollHeight,le.clientHeight,Ge?Ge.scrollHeight:0,Ge?Ge.clientHeight:0),Sn=-Ie.scrollLeft+Ni(ie),re=-Ie.scrollTop;return"rtl"===fr(Ge||le).direction&&(Sn+=gr(le.clientWidth,Ge?Ge.clientWidth:0)-yt),{width:yt,height:vn,x:Sn,y:re}}(Ci(ie)))}function Ii(ie){return Object.assign({},{top:0,right:0,bottom:0,left:0},ie)}function gs(ie,K){return K.reduce(function(le,Ie){return le[Ie]=ie,le},{})}function ji(ie,K){void 0===K&&(K={});var Ie=K.placement,Ge=void 0===Ie?ie.placement:Ie,yt=K.strategy,vn=void 0===yt?ie.strategy:yt,Sn=K.boundary,re=void 0===Sn?"clippingParents":Sn,ue=K.rootBoundary,X=void 0===ue?Re:ue,be=K.elementContext,qe=void 0===be?Oe:be,On=K.altBoundary,lr=void 0!==On&&On,Br=K.padding,ii=void 0===Br?0:Br,Ti=Ii("number"!=typeof ii?ii:gs(ii,Bs)),eo=ie.rects.popper,Qr=ie.elements[lr?qe===Oe?"reference":Oe:qe],Gr=function as(ie,K,le,Ie){var Ge="clippingParents"===K?function fa(ie){var K=ur(_r(ie)),Ie=["absolute","fixed"].indexOf(fr(ie).position)>=0&&rn(ie)?Xi(ie):ie;return mt(Ie)?K.filter(function(Ge){return mt(Ge)&&bo(Ge,Ie)&&"body"!==qr(Ge)}):[]}(ie):[].concat(K),yt=[].concat(Ge,[le]),Sn=yt.reduce(function(re,ue){var X=$o(ie,ue,Ie);return re.top=gr(X.top,re.top),re.right=Qn(X.right,re.right),re.bottom=Qn(X.bottom,re.bottom),re.left=gr(X.left,re.left),re},$o(ie,yt[0],Ie));return Sn.width=Sn.right-Sn.left,Sn.height=Sn.bottom-Sn.top,Sn.x=Sn.left,Sn.y=Sn.top,Sn}(mt(Qr)?Qr:Qr.contextElement||Ci(ie.elements.popper),re,X,vn),Bi=Oi(ie.elements.reference),Bo=Sr({reference:Bi,element:eo,strategy:"absolute",placement:Ge}),zo=ws(Object.assign({},eo,Bo)),Wo=qe===Oe?zo:Bi,Uo={top:Gr.top-Wo.top+Ti.top,bottom:Wo.bottom-Gr.bottom+Ti.bottom,left:Gr.left-Wo.left+Ti.left,right:Wo.right-Gr.right+Ti.right},qs=ie.modifiersData.offset;if(qe===Oe&&qs){var sa=qs[Ge];Object.keys(Uo).forEach(function(vo){var Cs=[Jr,po].indexOf(vo)>=0?1:-1,As=[si,po].indexOf(vo)>=0?"y":"x";Uo[vo]+=sa[As]*Cs})}return Uo}function ea(ie,K,le){return gr(ie,Qn(K,le))}function Qo(ie,K,le){return void 0===le&&(le={x:0,y:0}),{top:ie.top-K.height-le.y,right:ie.right-K.width+le.x,bottom:ie.bottom-K.height+le.y,left:ie.left-K.width-le.x}}function qa(ie){return[si,Jr,po,wo].some(function(K){return ie[K]>=0})}var Ea=_t({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function an(ie){var K=ie.state,le=ie.instance,Ie=ie.options,Ge=Ie.scroll,yt=void 0===Ge||Ge,vn=Ie.resize,Sn=void 0===vn||vn,re=Zt(K.elements.popper),ue=[].concat(K.scrollParents.reference,K.scrollParents.popper);return yt&&ue.forEach(function(X){X.addEventListener("scroll",le.update,ct)}),Sn&&re.addEventListener("resize",le.update,ct),function(){yt&&ue.forEach(function(X){X.removeEventListener("scroll",le.update,ct)}),Sn&&re.removeEventListener("resize",le.update,ct)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function Ui(ie){var K=ie.state;K.modifiersData[ie.name]=Sr({reference:K.rects.reference,element:K.rects.popper,strategy:"absolute",placement:K.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function ro(ie){var K=ie.state,le=ie.options,Ie=le.gpuAcceleration,Ge=void 0===Ie||Ie,yt=le.adaptive,vn=void 0===yt||yt,Sn=le.roundOffsets,re=void 0===Sn||Sn,ue={placement:In(K.placement),variation:zn(K.placement),popper:K.elements.popper,popperRect:K.rects.popper,gpuAcceleration:Ge,isFixed:"fixed"===K.options.strategy};null!=K.modifiersData.popperOffsets&&(K.styles.popper=Object.assign({},K.styles.popper,Vi(Object.assign({},ue,{offsets:K.modifiersData.popperOffsets,position:K.options.strategy,adaptive:vn,roundOffsets:re})))),null!=K.modifiersData.arrow&&(K.styles.arrow=Object.assign({},K.styles.arrow,Vi(Object.assign({},ue,{offsets:K.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:re})))),K.attributes.popper=Object.assign({},K.attributes.popper,{"data-popper-placement":K.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function Et(ie){var K=ie.state;Object.keys(K.elements).forEach(function(le){var Ie=K.styles[le]||{},Ge=K.attributes[le]||{},yt=K.elements[le];!rn(yt)||!qr(yt)||(Object.assign(yt.style,Ie),Object.keys(Ge).forEach(function(vn){var Sn=Ge[vn];!1===Sn?yt.removeAttribute(vn):yt.setAttribute(vn,!0===Sn?"":Sn)}))})},effect:function vr(ie){var K=ie.state,le={popper:{position:K.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(K.elements.popper.style,le.popper),K.styles=le,K.elements.arrow&&Object.assign(K.elements.arrow.style,le.arrow),function(){Object.keys(K.elements).forEach(function(Ie){var Ge=K.elements[Ie],yt=K.attributes[Ie]||{},Sn=Object.keys(K.styles.hasOwnProperty(Ie)?K.styles[Ie]:le[Ie]).reduce(function(re,ue){return re[ue]="",re},{});!rn(Ge)||!qr(Ge)||(Object.assign(Ge.style,Sn),Object.keys(yt).forEach(function(re){Ge.removeAttribute(re)}))})}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function Gs(ie){var K=ie.state,Ie=ie.name,Ge=ie.options.offset,yt=void 0===Ge?[0,0]:Ge,vn=st.reduce(function(X,be){return X[be]=function ai(ie,K,le){var Ie=In(ie),Ge=[wo,si].indexOf(Ie)>=0?-1:1,yt="function"==typeof le?le(Object.assign({},K,{placement:ie})):le,vn=yt[0],Sn=yt[1];return vn=vn||0,Sn=(Sn||0)*Ge,[wo,Jr].indexOf(Ie)>=0?{x:Sn,y:vn}:{x:vn,y:Sn}}(be,K.rects,yt),X},{}),Sn=vn[K.placement],ue=Sn.y;null!=K.modifiersData.popperOffsets&&(K.modifiersData.popperOffsets.x+=Sn.x,K.modifiersData.popperOffsets.y+=ue),K.modifiersData[Ie]=vn}},{name:"flip",enabled:!0,phase:"main",fn:function Ll(ie){var K=ie.state,le=ie.options,Ie=ie.name;if(!K.modifiersData[Ie]._skip){for(var Ge=le.mainAxis,yt=void 0===Ge||Ge,vn=le.altAxis,Sn=void 0===vn||vn,re=le.fallbackPlacements,ue=le.padding,X=le.boundary,be=le.rootBoundary,qe=le.altBoundary,On=le.flipVariations,lr=void 0===On||On,Br=le.allowedAutoPlacements,ii=K.options.placement,Ti=In(ii),eo=re||(Ti!==ii&&lr?function Za(ie){if(In(ie)===nr)return[];var K=Go(ie);return[Fn(ie),K,Fn(K)]}(ii):[Go(ii)]),Qr=[ii].concat(eo).reduce(function(ys,el){return ys.concat(In(el)===nr?function ko(ie,K){void 0===K&&(K={});var Ge=K.boundary,yt=K.rootBoundary,vn=K.padding,Sn=K.flipVariations,re=K.allowedAutoPlacements,ue=void 0===re?st:re,X=zn(K.placement),be=X?Sn?wt:wt.filter(function(lr){return zn(lr)===X}):Bs,qe=be.filter(function(lr){return ue.indexOf(lr)>=0});0===qe.length&&(qe=be);var On=qe.reduce(function(lr,Br){return lr[Br]=ji(ie,{placement:Br,boundary:Ge,rootBoundary:yt,padding:vn})[In(Br)],lr},{});return Object.keys(On).sort(function(lr,Br){return On[lr]-On[Br]})}(K,{placement:el,boundary:X,rootBoundary:be,padding:ue,flipVariations:lr,allowedAutoPlacements:Br}):el)},[]),Gr=K.rects.reference,Bi=K.rects.popper,Bo=new Map,zo=!0,Wo=Qr[0],Uo=0;Uo<Qr.length;Uo++){var qs=Qr[Uo],sa=In(qs),vo=zn(qs)===Ue,Cs=[si,po].indexOf(sa)>=0,As=Cs?"width":"height",aa=ji(K,{placement:qs,boundary:X,rootBoundary:be,altBoundary:qe,padding:ue}),to=Cs?vo?Jr:wo:vo?po:si;Gr[As]>Bi[As]&&(to=Go(to));var Ka=Go(to),Oo=[];if(yt&&Oo.push(aa[sa]<=0),Sn&&Oo.push(aa[to]<=0,aa[Ka]<=0),Oo.every(function(ys){return ys})){Wo=qs,zo=!1;break}Bo.set(qs,Oo)}if(zo)for(var Kl=function(el){var fl=Qr.find(function(yl){var xl=Bo.get(yl);if(xl)return xl.slice(0,el).every(function(sc){return sc})});if(fl)return Wo=fl,"break"},Qa=lr?3:1;Qa>0&&"break"!==Kl(Qa);Qa--);K.placement!==Wo&&(K.modifiersData[Ie]._skip=!0,K.placement=Wo,K.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function ul(ie){var K=ie.state,le=ie.options,Ie=ie.name,Ge=le.mainAxis,yt=void 0===Ge||Ge,vn=le.altAxis,Sn=void 0!==vn&&vn,qe=le.tether,On=void 0===qe||qe,lr=le.tetherOffset,Br=void 0===lr?0:lr,ii=ji(K,{boundary:le.boundary,rootBoundary:le.rootBoundary,padding:le.padding,altBoundary:le.altBoundary}),Ti=In(K.placement),ki=zn(K.placement),eo=!ki,Qr=br(Ti),Gr=function ba(ie){return"x"===ie?"y":"x"}(Qr),Bi=K.modifiersData.popperOffsets,Bo=K.rects.reference,zo=K.rects.popper,Wo="function"==typeof Br?Br(Object.assign({},K.rects,{placement:K.placement})):Br,Uo="number"==typeof Wo?{mainAxis:Wo,altAxis:Wo}:Object.assign({mainAxis:0,altAxis:0},Wo),qs=K.modifiersData.offset?K.modifiersData.offset[K.placement]:null,sa={x:0,y:0};if(Bi){if(yt){var vo,Cs="y"===Qr?si:wo,As="y"===Qr?po:Jr,aa="y"===Qr?"height":"width",to=Bi[Qr],Ka=to+ii[Cs],Oo=to-ii[As],Ja=On?-zo[aa]/2:0,Kl=ki===Ue?Bo[aa]:zo[aa],Qa=ki===Ue?-zo[aa]:-Bo[aa],jl=K.elements.arrow,ys=On&&jl?xi(jl):{width:0,height:0},el=K.modifiersData["arrow#persistent"]?K.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},fl=el[Cs],yl=el[As],xl=ea(0,Bo[aa],ys[aa]),sc=eo?Bo[aa]/2-Ja-xl-fl-Uo.mainAxis:Kl-xl-fl-Uo.mainAxis,wc=eo?-Bo[aa]/2+Ja+xl+yl+Uo.mainAxis:Qa+xl+yl+Uo.mainAxis,pl=K.elements.arrow&&Xi(K.elements.arrow),ga=pl?"y"===Qr?pl.clientTop||0:pl.clientLeft||0:0,wl=null!=(vo=qs?.[Qr])?vo:0,bl=to+wc-wl,El=ea(On?Qn(Ka,to+sc-wl-ga):Ka,to,On?gr(Oo,bl):Oo);Bi[Qr]=El,sa[Qr]=El-to}if(Sn){var Ta,te=Bi[Gr],fe="y"===Gr?"height":"width",He=te+ii["x"===Qr?si:wo],Gt=te-ii["x"===Qr?po:Jr],Ut=-1!==[si,wo].indexOf(Ti),pr=null!=(Ta=qs?.[Gr])?Ta:0,io=Ut?He:te-Bo[fe]-zo[fe]-pr+Uo.altAxis,Hi=Ut?te+Bo[fe]+zo[fe]-pr-Uo.altAxis:Gt,wi=On&&Ut?function cl(ie,K,le){var Ie=ea(ie,K,le);return Ie>le?le:Ie}(io,te,Hi):ea(On?io:He,te,On?Hi:Gt);Bi[Gr]=wi,sa[Gr]=wi-te}K.modifiersData[Ie]=sa}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function Vl(ie){var K,le=ie.state,Ie=ie.name,Ge=ie.options,yt=le.elements.arrow,vn=le.modifiersData.popperOffsets,Sn=In(le.placement),re=br(Sn),X=[wo,Jr].indexOf(Sn)>=0?"height":"width";if(yt&&vn){var be=function(K,le){return Ii("number"!=typeof(K="function"==typeof K?K(Object.assign({},le.rects,{placement:le.placement})):K)?K:gs(K,Bs))}(Ge.padding,le),qe=xi(yt),On="y"===re?si:wo,lr="y"===re?po:Jr,Br=le.rects.reference[X]+le.rects.reference[re]-vn[re]-le.rects.popper[X],ii=vn[re]-le.rects.reference[re],Ti=Xi(yt),ki=Ti?"y"===re?Ti.clientHeight||0:Ti.clientWidth||0:0,Bi=ki/2-qe[X]/2+(Br/2-ii/2),Bo=ea(be[On],Bi,ki-qe[X]-be[lr]);le.modifiersData[Ie]=((K={})[re]=Bo,K.centerOffset=Bo-Bi,K)}},effect:function dl(ie){var K=ie.state,Ie=ie.options.element,Ge=void 0===Ie?"[data-popper-arrow]":Ie;null!=Ge&&("string"==typeof Ge&&!(Ge=K.elements.popper.querySelector(Ge))||bo(K.elements.popper,Ge)&&(K.elements.arrow=Ge))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function hl(ie){var K=ie.state,le=ie.name,Ie=K.rects.reference,Ge=K.rects.popper,yt=K.modifiersData.preventOverflow,vn=ji(K,{elementContext:"reference"}),Sn=ji(K,{altBoundary:!0}),re=Qo(vn,Ie),ue=Qo(Sn,Ge,yt),X=qa(re),be=qa(ue);K.modifiersData[le]={referenceClippingOffsets:re,popperEscapeOffsets:ue,isReferenceHidden:X,hasPopperEscaped:be},K.attributes.popper=Object.assign({},K.attributes.popper,{"data-popper-reference-hidden":X,"data-popper-escaped":be})}}]}),zr=function(){return zr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},zr.apply(this,arguments)},ti=function(ie,K,le){if(le||2===arguments.length)for(var yt,Ie=0,Ge=K.length;Ie<Ge;Ie++)(yt||!(Ie in K))&&(yt||(yt=Array.prototype.slice.call(K,0,Ie)),yt[Ie]=K[Ie]);return ie.concat(yt||Array.prototype.slice.call(K))},Ri={placement:"bottom",triggerType:"click",offsetSkidding:0,offsetDistance:10,delay:300,ignoreClickOutsideClass:!1,onShow:function(){},onHide:function(){},onToggle:function(){}},es=function(){function ie(K,le,Ie){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=Ri),this._targetEl=K,this._triggerEl=le,this._options=zr(zr({},Ri),Ie),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return ie.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},ie.prototype._setupEventListeners=function(){var K=this,le=this._getTriggerEvents();"click"===this._options.triggerType&&le.showEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){K.toggle()})}),"hover"===this._options.triggerType&&(le.showEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){"click"===Ie?K.toggle():setTimeout(function(){K.show()},K._options.delay)}),K._targetEl.addEventListener(Ie,function(){K.show()})}),le.hideEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){setTimeout(function(){K._targetEl.matches(":hover")||K.hide()},K._options.delay)}),K._targetEl.addEventListener(Ie,function(){setTimeout(function(){K._triggerEl.matches(":hover")||K.hide()},K._options.delay)})}))},ie.prototype._createPopperInstance=function(){return Ea(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[this._options.offsetSkidding,this._options.offsetDistance]}}]})},ie.prototype._setupClickOutsideListener=function(){var K=this;this._clickOutsideEventListener=function(le){K._handleClickOutside(le,K._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._handleClickOutside=function(K,le){var Ie=K.target,Ge=this._options.ignoreClickOutsideClass,yt=!1;Ge&&document.querySelectorAll(".".concat(Ge)).forEach(function(Sn){Sn.contains(Ie)&&(yt=!0)}),Ie!==le&&!le.contains(Ie)&&!this._triggerEl.contains(Ie)&&!yt&&this.isVisible()&&this.hide()},ie.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":return{showEvents:["mouseenter","click"],hideEvents:["mouseleave"]};case"click":default:return{showEvents:["click"],hideEvents:[]};case"none":return{showEvents:[],hideEvents:[]}}},ie.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},ie.prototype.isVisible=function(){return this._visible},ie.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._targetEl.classList.add("block"),this._popperInstance.setOptions(function(K){return zr(zr({},K),{modifiers:ti(ti([],K.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},ie.prototype.hide=function(){this._targetEl.classList.remove("block"),this._targetEl.classList.add("hidden"),this._popperInstance.setOptions(function(K){return zr(zr({},K),{modifiers:ti(ti([],K.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._visible=!1,this._removeClickOutsideListener(),this._options.onHide(this)},ie}();function Qi(){document.querySelectorAll("[data-dropdown-toggle]").forEach(function(ie){var K=ie.getAttribute("data-dropdown-toggle"),le=document.getElementById(K);if(le){var Ie=ie.getAttribute("data-dropdown-placement"),Ge=ie.getAttribute("data-dropdown-offset-skidding"),yt=ie.getAttribute("data-dropdown-offset-distance"),vn=ie.getAttribute("data-dropdown-trigger"),Sn=ie.getAttribute("data-dropdown-delay"),re=ie.getAttribute("data-dropdown-ignore-click-outside-class");new es(le,ie,{placement:Ie||Ri.placement,triggerType:vn||Ri.triggerType,offsetSkidding:Ge?parseInt(Ge):Ri.offsetSkidding,offsetDistance:yt?parseInt(yt):Ri.offsetDistance,delay:Sn?parseInt(Sn):Ri.delay,ignoreClickOutsideClass:re||Ri.ignoreClickOutsideClass})}else console.error('The dropdown element with id "'.concat(K,'" does not exist. Please check the data-dropdown-toggle attribute.'))})}typeof window<"u"&&(window.Dropdown=es,window.initDropdowns=Qi);var Fa=function(){return Fa=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},Fa.apply(this,arguments)},Fo={placement:"center",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-40",backdrop:"dynamic",closable:!0,onHide:function(){},onShow:function(){},onToggle:function(){}},Ba=function(){function ie(K,le){void 0===K&&(K=null),void 0===le&&(le=Fo),this._targetEl=K,this._options=Fa(Fa({},Fo),le),this._isHidden=!0,this._backdropEl=null,this._init()}return ie.prototype._init=function(){var K=this;this._targetEl&&this._getPlacementClasses().map(function(le){K._targetEl.classList.add(le)})},ie.prototype._createBackdrop=function(){var K;if(this._isHidden){var le=document.createElement("div");le.setAttribute("modal-backdrop",""),(K=le.classList).add.apply(K,this._options.backdropClasses.split(" ")),document.querySelector("body").append(le),this._backdropEl=le}},ie.prototype._destroyBackdropEl=function(){this._isHidden||document.querySelector("[modal-backdrop]").remove()},ie.prototype._setupModalCloseEventListeners=function(){var K=this;"dynamic"===this._options.backdrop&&(this._clickOutsideEventListener=function(le){K._handleOutsideClick(le.target)},this._targetEl.addEventListener("click",this._clickOutsideEventListener,!0)),this._keydownEventListener=function(le){"Escape"===le.key&&K.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._removeModalCloseEventListeners=function(){"dynamic"===this._options.backdrop&&this._targetEl.removeEventListener("click",this._clickOutsideEventListener,!0),document.body.removeEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._handleOutsideClick=function(K){(K===this._targetEl||K===this._backdropEl&&this.isVisible())&&this.hide()},ie.prototype._getPlacementClasses=function(){switch(this._options.placement){case"top-left":return["justify-start","items-start"];case"top-center":return["justify-center","items-start"];case"top-right":return["justify-end","items-start"];case"center-left":return["justify-start","items-center"];case"center":default:return["justify-center","items-center"];case"center-right":return["justify-end","items-center"];case"bottom-left":return["justify-start","items-end"];case"bottom-center":return["justify-center","items-end"];case"bottom-right":return["justify-end","items-end"]}},ie.prototype.toggle=function(){this._isHidden?this.show():this.hide(),this._options.onToggle(this)},ie.prototype.show=function(){this.isHidden&&(this._targetEl.classList.add("flex"),this._targetEl.classList.remove("hidden"),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._createBackdrop(),this._isHidden=!1,document.body.classList.add("overflow-hidden"),this._options.closable&&this._setupModalCloseEventListeners(),this._options.onShow(this))},ie.prototype.hide=function(){this.isVisible&&(this._targetEl.classList.add("hidden"),this._targetEl.classList.remove("flex"),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._destroyBackdropEl(),this._isHidden=!0,document.body.classList.remove("overflow-hidden"),this._options.closable&&this._removeModalCloseEventListeners(),this._options.onHide(this))},ie.prototype.isVisible=function(){return!this._isHidden},ie.prototype.isHidden=function(){return this._isHidden},ie}(),Ca=function(ie,K){return K.some(function(le){return le.id===ie})?K.find(function(le){return le.id===ie}):null};function mi(){var ie=[];document.querySelectorAll("[data-modal-target]").forEach(function(K){var le=K.getAttribute("data-modal-target"),Ie=document.getElementById(le);if(Ie){var Ge=Ie.getAttribute("data-modal-placement"),yt=Ie.getAttribute("data-modal-backdrop");Ca(le,ie)||ie.push({id:le,object:new Ba(Ie,{placement:Ge||Fo.placement,backdrop:yt||Fo.backdrop})})}else console.error("Modal with id ".concat(le," does not exist. Are you sure that the data-modal-target attribute points to the correct modal id?."))}),document.querySelectorAll("[data-modal-toggle]").forEach(function(K){var le=K.getAttribute("data-modal-toggle"),Ie=document.getElementById(le);if(Ie){var Ge=Ie.getAttribute("data-modal-placement"),yt=Ie.getAttribute("data-modal-backdrop"),vn=Ca(le,ie);vn||(vn={id:le,object:new Ba(Ie,{placement:Ge||Fo.placement,backdrop:yt||Fo.backdrop})},ie.push(vn)),K.addEventListener("click",function(){vn.object.toggle()})}else console.error("Modal with id ".concat(le," does not exist. Are you sure that the data-modal-toggle attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-show]").forEach(function(K){var le=K.getAttribute("data-modal-show");if(document.getElementById(le)){var Ge=Ca(le,ie);Ge?K.addEventListener("click",function(){Ge.object.isHidden&&Ge.object.show()}):console.error("Modal with id ".concat(le," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(le," does not exist. Are you sure that the data-modal-show attribute points to the correct modal id?"))}),document.querySelectorAll("[data-modal-hide]").forEach(function(K){var le=K.getAttribute("data-modal-hide");if(document.getElementById(le)){var Ge=Ca(le,ie);Ge?K.addEventListener("click",function(){Ge.object.isVisible&&Ge.object.hide()}):console.error("Modal with id ".concat(le," has not been initialized. Please initialize it using the data-modal-target attribute."))}else console.error("Modal with id ".concat(le," does not exist. Are you sure that the data-modal-hide attribute points to the correct modal id?"))})}typeof window<"u"&&(window.Modal=Ba,window.initModals=mi);var Dr=function(){return Dr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},Dr.apply(this,arguments)},ni={placement:"left",bodyScrolling:!1,backdrop:!0,edge:!1,edgeOffset:"bottom-[60px]",backdropClasses:"bg-gray-900 bg-opacity-50 dark:bg-opacity-80 fixed inset-0 z-30",onShow:function(){},onHide:function(){},onToggle:function(){}},cs=function(){function ie(K,le){void 0===K&&(K=null),void 0===le&&(le=ni),this._targetEl=K,this._options=Dr(Dr({},ni),le),this._visible=!1,this._init()}return ie.prototype._init=function(){var K=this;this._targetEl&&(this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.classList.add("transition-transform")),this._getPlacementClasses(this._options.placement).base.map(function(le){K._targetEl.classList.add(le)}),document.addEventListener("keydown",function(le){"Escape"===le.key&&K.isVisible()&&K.hide()})},ie.prototype.hide=function(){var K=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(le){K._targetEl.classList.remove(le)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(le){K._targetEl.classList.add(le)})):(this._getPlacementClasses(this._options.placement).active.map(function(le){K._targetEl.classList.remove(le)}),this._getPlacementClasses(this._options.placement).inactive.map(function(le){K._targetEl.classList.add(le)})),this._targetEl.setAttribute("aria-hidden","true"),this._targetEl.removeAttribute("aria-modal"),this._targetEl.removeAttribute("role"),this._options.bodyScrolling||document.body.classList.remove("overflow-hidden"),this._options.backdrop&&this._destroyBackdropEl(),this._visible=!1,this._options.onHide(this)},ie.prototype.show=function(){var K=this;this._options.edge?(this._getPlacementClasses(this._options.placement+"-edge").active.map(function(le){K._targetEl.classList.add(le)}),this._getPlacementClasses(this._options.placement+"-edge").inactive.map(function(le){K._targetEl.classList.remove(le)})):(this._getPlacementClasses(this._options.placement).active.map(function(le){K._targetEl.classList.add(le)}),this._getPlacementClasses(this._options.placement).inactive.map(function(le){K._targetEl.classList.remove(le)})),this._targetEl.setAttribute("aria-modal","true"),this._targetEl.setAttribute("role","dialog"),this._targetEl.removeAttribute("aria-hidden"),this._options.bodyScrolling||document.body.classList.add("overflow-hidden"),this._options.backdrop&&this._createBackdrop(),this._visible=!0,this._options.onShow(this)},ie.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},ie.prototype._createBackdrop=function(){var K,le=this;if(!this._visible){var Ie=document.createElement("div");Ie.setAttribute("drawer-backdrop",""),(K=Ie.classList).add.apply(K,this._options.backdropClasses.split(" ")),document.querySelector("body").append(Ie),Ie.addEventListener("click",function(){le.hide()})}},ie.prototype._destroyBackdropEl=function(){this._visible&&document.querySelector("[drawer-backdrop]").remove()},ie.prototype._getPlacementClasses=function(K){switch(K){case"top":return{base:["top-0","left-0","right-0"],active:["transform-none"],inactive:["-translate-y-full"]};case"right":return{base:["right-0","top-0"],active:["transform-none"],inactive:["translate-x-full"]};case"bottom":return{base:["bottom-0","left-0","right-0"],active:["transform-none"],inactive:["translate-y-full"]};case"left":default:return{base:["left-0","top-0"],active:["transform-none"],inactive:["-translate-x-full"]};case"bottom-edge":return{base:["left-0","top-0"],active:["transform-none"],inactive:["translate-y-full",this._options.edgeOffset]}}},ie.prototype.isHidden=function(){return!this._visible},ie.prototype.isVisible=function(){return this._visible},ie}(),ts=function(ie,K){if(K.some(function(le){return le.id===ie}))return K.find(function(le){return le.id===ie})};function Co(){var ie=[];document.querySelectorAll("[data-drawer-target]").forEach(function(K){var le=K.getAttribute("data-drawer-target"),Ie=document.getElementById(le);if(Ie){var Ge=K.getAttribute("data-drawer-placement"),yt=K.getAttribute("data-drawer-body-scrolling"),vn=K.getAttribute("data-drawer-backdrop"),Sn=K.getAttribute("data-drawer-edge"),re=K.getAttribute("data-drawer-edge-offset");ts(le,ie)||ie.push({id:le,object:new cs(Ie,{placement:Ge||ni.placement,bodyScrolling:yt?"true"===yt:ni.bodyScrolling,backdrop:vn?"true"===vn:ni.backdrop,edge:Sn?"true"===Sn:ni.edge,edgeOffset:re||ni.edgeOffset})})}else console.error("Drawer with id ".concat(le," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-toggle]").forEach(function(K){var le=K.getAttribute("data-drawer-toggle");if(document.getElementById(le)){var Ge=ts(le,ie);Ge?K.addEventListener("click",function(){Ge.object.toggle()}):console.error("Drawer with id ".concat(le," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(le," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))}),document.querySelectorAll("[data-drawer-dismiss], [data-drawer-hide]").forEach(function(K){var le=K.getAttribute("data-drawer-dismiss")?K.getAttribute("data-drawer-dismiss"):K.getAttribute("data-drawer-hide");if(document.getElementById(le)){var Ge=ts(le,ie);Ge?K.addEventListener("click",function(){Ge.object.hide()}):console.error("Drawer with id ".concat(le," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(le," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id"))}),document.querySelectorAll("[data-drawer-show]").forEach(function(K){var le=K.getAttribute("data-drawer-show");if(document.getElementById(le)){var Ge=ts(le,ie);Ge?K.addEventListener("click",function(){Ge.object.show()}):console.error("Drawer with id ".concat(le," has not been initialized. Please initialize it using the data-drawer-target attribute."))}else console.error("Drawer with id ".concat(le," not found. Are you sure that the data-drawer-target attribute points to the correct drawer id?"))})}typeof window<"u"&&(window.Drawer=cs,window.initDrawers=Co);var Fr=function(){return Fr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},Fr.apply(this,arguments)},Ws={defaultTabId:null,activeClasses:"text-blue-600 hover:text-blue-600 dark:text-blue-500 dark:hover:text-blue-500 border-blue-600 dark:border-blue-500",inactiveClasses:"dark:border-transparent text-gray-500 hover:text-gray-600 dark:text-gray-400 border-gray-100 hover:border-gray-300 dark:border-gray-700 dark:hover:text-gray-300",onShow:function(){}},ta=function(){function ie(K,le){void 0===K&&(K=[]),void 0===le&&(le=Ws),this._items=K,this._activeTab=le?this.getTab(le.defaultTabId):null,this._options=Fr(Fr({},Ws),le),this._init()}return ie.prototype._init=function(){var K=this;this._items.length&&(this._activeTab||this._setActiveTab(this._items[0]),this.show(this._activeTab.id,!0),this._items.map(function(le){le.triggerEl.addEventListener("click",function(){K.show(le.id)})}))},ie.prototype.getActiveTab=function(){return this._activeTab},ie.prototype._setActiveTab=function(K){this._activeTab=K},ie.prototype.getTab=function(K){return this._items.filter(function(le){return le.id===K})[0]},ie.prototype.show=function(K,le){var Ie,Ge,yt=this;void 0===le&&(le=!1);var vn=this.getTab(K);vn===this._activeTab&&!le||(this._items.map(function(Sn){var re,ue;Sn!==vn&&((re=Sn.triggerEl.classList).remove.apply(re,yt._options.activeClasses.split(" ")),(ue=Sn.triggerEl.classList).add.apply(ue,yt._options.inactiveClasses.split(" ")),Sn.targetEl.classList.add("hidden"),Sn.triggerEl.setAttribute("aria-selected","false"))}),(Ie=vn.triggerEl.classList).add.apply(Ie,this._options.activeClasses.split(" ")),(Ge=vn.triggerEl.classList).remove.apply(Ge,this._options.inactiveClasses.split(" ")),vn.triggerEl.setAttribute("aria-selected","true"),vn.targetEl.classList.remove("hidden"),this._setActiveTab(vn),this._options.onShow(this,vn))},ie}();function Or(){document.querySelectorAll("[data-tabs-toggle]").forEach(function(ie){var K=[],le=null;ie.querySelectorAll('[role="tab"]').forEach(function(Ie){var Ge="true"===Ie.getAttribute("aria-selected"),yt={id:Ie.getAttribute("data-tabs-target"),triggerEl:Ie,targetEl:document.querySelector(Ie.getAttribute("data-tabs-target"))};K.push(yt),Ge&&(le=yt.id)}),new ta(K,{defaultTabId:le})})}typeof window<"u"&&(window.Tabs=ta,window.initTabs=Or);var ms=function(){return ms=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},ms.apply(this,arguments)},Xr=function(ie,K,le){if(le||2===arguments.length)for(var yt,Ie=0,Ge=K.length;Ie<Ge;Ie++)(yt||!(Ie in K))&&(yt||(yt=Array.prototype.slice.call(K,0,Ie)),yt[Ie]=K[Ie]);return ie.concat(yt||Array.prototype.slice.call(K))},lo={placement:"top",triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},na=function(){function ie(K,le,Ie){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=lo),this._targetEl=K,this._triggerEl=le,this._options=ms(ms({},lo),Ie),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return ie.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},ie.prototype._setupEventListeners=function(){var K=this,le=this._getTriggerEvents();le.showEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){K.show()})}),le.hideEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){K.hide()})})},ie.prototype._createPopperInstance=function(){return Ea(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,8]}}]})},ie.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]}}},ie.prototype._setupKeydownListener=function(){var K=this;this._keydownEventListener=function(le){"Escape"===le.key&&K.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._setupClickOutsideListener=function(){var K=this;this._clickOutsideEventListener=function(le){K._handleClickOutside(le,K._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._handleClickOutside=function(K,le){var Ie=K.target;Ie!==le&&!le.contains(Ie)&&!this._triggerEl.contains(Ie)&&this.isVisible()&&this.hide()},ie.prototype.isVisible=function(){return this._visible},ie.prototype.toggle=function(){this.isVisible()?this.hide():this.show()},ie.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(K){return ms(ms({},K),{modifiers:Xr(Xr([],K.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},ie.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(K){return ms(ms({},K),{modifiers:Xr(Xr([],K.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},ie}();function Da(){document.querySelectorAll("[data-tooltip-target]").forEach(function(ie){var K=ie.getAttribute("data-tooltip-target"),le=document.getElementById(K);if(le){var Ie=ie.getAttribute("data-tooltip-trigger"),Ge=ie.getAttribute("data-tooltip-placement");new na(le,ie,{placement:Ge||lo.placement,triggerType:Ie||lo.triggerType})}else console.error('The tooltip element with id "'.concat(K,'" does not exist. Please check the data-tooltip-target attribute.'))})}typeof window<"u"&&(window.Tooltip=na,window.initTooltips=Da);var ns=function(){return ns=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},ns.apply(this,arguments)},Xa=function(ie,K,le){if(le||2===arguments.length)for(var yt,Ie=0,Ge=K.length;Ie<Ge;Ie++)(yt||!(Ie in K))&&(yt||(yt=Array.prototype.slice.call(K,0,Ie)),yt[Ie]=K[Ie]);return ie.concat(yt||Array.prototype.slice.call(K))},_s={placement:"top",offset:10,triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},Us=function(){function ie(K,le,Ie){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=_s),this._targetEl=K,this._triggerEl=le,this._options=ns(ns({},_s),Ie),this._popperInstance=this._createPopperInstance(),this._visible=!1,this._init()}return ie.prototype._init=function(){this._triggerEl&&this._setupEventListeners()},ie.prototype._setupEventListeners=function(){var K=this,le=this._getTriggerEvents();le.showEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){K.show()}),K._targetEl.addEventListener(Ie,function(){K.show()})}),le.hideEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){setTimeout(function(){K._targetEl.matches(":hover")||K.hide()},100)}),K._targetEl.addEventListener(Ie,function(){setTimeout(function(){K._triggerEl.matches(":hover")||K.hide()},100)})})},ie.prototype._createPopperInstance=function(){return Ea(this._triggerEl,this._targetEl,{placement:this._options.placement,modifiers:[{name:"offset",options:{offset:[0,this._options.offset]}}]})},ie.prototype._getTriggerEvents=function(){switch(this._options.triggerType){case"hover":default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]}}},ie.prototype._setupKeydownListener=function(){var K=this;this._keydownEventListener=function(le){"Escape"===le.key&&K.hide()},document.body.addEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._removeKeydownListener=function(){document.body.removeEventListener("keydown",this._keydownEventListener,!0)},ie.prototype._setupClickOutsideListener=function(){var K=this;this._clickOutsideEventListener=function(le){K._handleClickOutside(le,K._targetEl)},document.body.addEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._removeClickOutsideListener=function(){document.body.removeEventListener("click",this._clickOutsideEventListener,!0)},ie.prototype._handleClickOutside=function(K,le){var Ie=K.target;Ie!==le&&!le.contains(Ie)&&!this._triggerEl.contains(Ie)&&this.isVisible()&&this.hide()},ie.prototype.isVisible=function(){return this._visible},ie.prototype.toggle=function(){this.isVisible()?this.hide():this.show(),this._options.onToggle(this)},ie.prototype.show=function(){this._targetEl.classList.remove("opacity-0","invisible"),this._targetEl.classList.add("opacity-100","visible"),this._popperInstance.setOptions(function(K){return ns(ns({},K),{modifiers:Xa(Xa([],K.modifiers,!0),[{name:"eventListeners",enabled:!0}],!1)})}),this._setupClickOutsideListener(),this._setupKeydownListener(),this._popperInstance.update(),this._visible=!0,this._options.onShow(this)},ie.prototype.hide=function(){this._targetEl.classList.remove("opacity-100","visible"),this._targetEl.classList.add("opacity-0","invisible"),this._popperInstance.setOptions(function(K){return ns(ns({},K),{modifiers:Xa(Xa([],K.modifiers,!0),[{name:"eventListeners",enabled:!1}],!1)})}),this._removeClickOutsideListener(),this._removeKeydownListener(),this._visible=!1,this._options.onHide(this)},ie}();function ra(){document.querySelectorAll("[data-popover-target]").forEach(function(ie){var K=ie.getAttribute("data-popover-target"),le=document.getElementById(K);if(le){var Ie=ie.getAttribute("data-popover-trigger"),Ge=ie.getAttribute("data-popover-placement"),yt=ie.getAttribute("data-popover-offset");new Us(le,ie,{placement:Ge||_s.placement,offset:yt?parseInt(yt):_s.offset,triggerType:Ie||_s.triggerType})}else console.error('The popover element with id "'.concat(K,'" does not exist. Please check the data-popover-target attribute.'))})}typeof window<"u"&&(window.Popover=Us,window.initPopovers=ra);var Wr=function(){return Wr=Object.assign||function(ie){for(var K,le=1,Ie=arguments.length;le<Ie;le++)for(var Ge in K=arguments[le])Object.prototype.hasOwnProperty.call(K,Ge)&&(ie[Ge]=K[Ge]);return ie},Wr.apply(this,arguments)},vl={triggerType:"hover",onShow:function(){},onHide:function(){},onToggle:function(){}},Ya=function(){function ie(K,le,Ie,Ge){void 0===K&&(K=null),void 0===le&&(le=null),void 0===Ie&&(Ie=null),void 0===Ge&&(Ge=vl),this._parentEl=K,this._triggerEl=le,this._targetEl=Ie,this._options=Wr(Wr({},vl),Ge),this._visible=!1,this._init()}return ie.prototype._init=function(){var K=this;if(this._triggerEl){var le=this._getTriggerEventTypes(this._options.triggerType);le.showEvents.forEach(function(Ie){K._triggerEl.addEventListener(Ie,function(){K.show()}),K._targetEl.addEventListener(Ie,function(){K.show()})}),le.hideEvents.forEach(function(Ie){K._parentEl.addEventListener(Ie,function(){K._parentEl.matches(":hover")||K.hide()})})}},ie.prototype.hide=function(){this._targetEl.classList.add("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","false"),this._visible=!1,this._options.onHide(this)},ie.prototype.show=function(){this._targetEl.classList.remove("hidden"),this._triggerEl&&this._triggerEl.setAttribute("aria-expanded","true"),this._visible=!0,this._options.onShow(this)},ie.prototype.toggle=function(){this._visible?this.hide():this.show()},ie.prototype.isHidden=function(){return!this._visible},ie.prototype.isVisible=function(){return this._visible},ie.prototype._getTriggerEventTypes=function(K){switch(K){case"hover":default:return{showEvents:["mouseenter","focus"],hideEvents:["mouseleave","blur"]};case"click":return{showEvents:["click","focus"],hideEvents:["focusout","blur"]};case"none":return{showEvents:[],hideEvents:[]}}},ie}();function za(){document.querySelectorAll("[data-dial-init]").forEach(function(ie){var K=ie.querySelector("[data-dial-toggle]");if(K){var le=K.getAttribute("data-dial-toggle"),Ie=document.getElementById(le);if(Ie){var Ge=K.getAttribute("data-dial-trigger");new Ya(ie,K,Ie,{triggerType:Ge||vl.triggerType})}else console.error("Dial with id ".concat(le," does not exist. Are you sure that the data-dial-toggle attribute points to the correct modal id?"))}else console.error("Dial with id ".concat(ie.id," does not have a trigger element. Are you sure that the data-dial-toggle attribute exists?"))})}function vs(){kt(),Kt(),xr(),At(),Qi(),mi(),Co(),Or(),Da(),ra(),za()}typeof window<"u"&&(window.Dial=Ya,window.initDials=za),typeof window<"u"&&(window.initFlowbite=vs),new Jn("load",[kt,Kt,xr,At,Qi,mi,Co,Or,Da,ra,za]).init();let Zs=(()=>{class ie{constructor(){this.imageLogoBlack="assets/images/logo/full_logo_black.png",this.title="nexus-meet-system"}ngOnInit(){vs()}static#e=this.\u0275fac=function(Ie){return new(Ie||ie)};static#t=this.\u0275cmp=f.Xpm({type:ie,selectors:[["app-root"]],decls:2,vars:0,template:function(Ie,Ge){1&Ie&&(f.TgZ(0,"div"),f._UZ(1,"router-outlet"),f.qZA())},dependencies:[St.lC]})}return ie})();var us=_e(6208);let ri=(()=>{class ie{static#e=this.\u0275fac=function(Ie){return new(Ie||ie)};static#t=this.\u0275mod=f.oAB({type:ie,bootstrap:[Zs]});static#n=this.\u0275inj=f.cJS({imports:[O.b2,un,bt.JF,us.m]})}return ie})();O.q6().bootstrapModule(ri).catch(ie=>console.error(ie))},2574:function(yr){yr.exports=function(){"use strict";var Qt,_e,O;function bt(f,ze){if(Qt)if(_e){var ke="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Qt+")(sharedChunk); ("+_e+")(sharedChunk); self.onerror = null;",Vt={};Qt(Vt),O=ze(Vt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([ke],{type:"text/javascript"})))}else _e=ze;else Qt=ze}return bt(0,function(f){var ze=typeof self<"u"?self:{},ke="2.15.0";let Vt;const $t={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Vt){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Vt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Vt=o}}return Vt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!$t.API_URL)return null;try{const o=new URL($t.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xt={supported:!1,testSupport:function(o){!dt&&it&&(Bt?zt(o):ft=o)}};let ft,it,dt=!1,Bt=!1;function zt(o){const t=o.createTexture();o.bindTexture(o.TEXTURE_2D,t);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,it),o.isContextLost())return;xt.supported=!0}catch{}o.deleteTexture(t),dt=!0}ze.document&&(it=ze.document.createElement("img"),it.onload=function(){ft&&zt(ft),ft=null,Bt=!0},it.onerror=function(){dt=!0,ft=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const un="01";function jn(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Jn=mr;function mr(o,t,l,h){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(h-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=t,this.p2x=l,this.p2y=h}mr.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,t){if(void 0===t&&(t=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,h=0;h<8;h++){var m=this.sampleCurveX(l)-o;if(Math.abs(m)<t)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=m/x}var C=0,D=1;for(l=o,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-o)<t));h++)o>m?C=l:D=l,l=.5*(D-C)+C;return l},solve:function(o,t){return this.sampleCurveY(this.solveCurveX(o,t))}};var Xt=jn(Jn),rr=kt;function kt(o,t){this.x=o,this.y=t}kt.prototype={clone:function(){return new kt(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,t){return this.clone()._rotateAround(o,t)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var t=o.x-this.x,l=o.y-this.y;return t*t+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult:function(o){var t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var t=Math.cos(o),l=Math.sin(o),h=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=h,this},_rotateAround:function(o,t){var l=Math.cos(o),h=Math.sin(o),m=t.y+h*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-h*(this.y-t.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},kt.convert=function(o){return o instanceof kt?o:Array.isArray(o)?new kt(o[0],o[1]):o};var gt=jn(rr);const ln=Math.PI/180,Wn=180/Math.PI;function Yt(o){return o*ln}function Kt(o){return o*Wn}const dn=[[0,0],[1,0],[1,1],[0,1]];function kn(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,l=t*o;return 4*(o<.5?l:3*(o-t)+l-.75)}function di(o,t,l,h){const m=new Xt(o,t,l,h);return function(x){return m.solve(x)}}const xo=di(.25,.1,.25,1);function xr(o,t,l){return Math.min(l,Math.max(t,o))}function Vn(o,t,l){return(l=xr((l-o)/(t-o),0,1))*l*(3-2*l)}function Zr(o,t,l){const h=l-t,m=((o-t)%h+h)%h+t;return m===t?l:m}function Ln(o,t,l){if(!o.length)return l(null,[]);let h=o.length;const m=new Array(o.length);let x=null;o.forEach((C,D)=>{t(C,(M,P)=>{M&&(x=M),m[D]=P,0==--h&&l(x,m)})})}function Ir(o){const t=[];for(const l in o)t.push(o[l]);return t}function At(o,...t){for(const l of t)for(const h in l)o[h]=l[h];return o}let Nt=1;function Zt(){return Nt++}function mt(){return function o(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function rn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function _n(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function gr(o,t){o.forEach(l=>{t[l]&&(t[l]=t[l].bind(t))})}function Qn(o,t){return-1!==o.indexOf(t,o.length-t.length)}function tr(o,t,l){const h={};for(const m in o)h[m]=t.call(l||this,o[m],m,o);return h}function ir(o,t,l){const h={};for(const m in o)t.call(l||this,o[m],m,o)&&(h[m]=o[m]);return h}function nn(o){return Array.isArray(o)?o.map(nn):"object"==typeof o&&o?tr(o,nn):o}const Oi={};function Gn(o){Oi[o]||(typeof console<"u"&&console.warn(o),Oi[o]=!0)}function Pi(o,t,l){return(l.y-o.y)*(t.x-o.x)>(t.y-o.y)*(l.x-o.x)}function vi(o){let t=0;for(let l,h,m=0,x=o.length,C=x-1;m<x;C=m++)l=o[m],h=o[C],t+=(h.x-l.x)*(l.y+h.y);return t}function qr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ci(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,m,x)=>{const C=m||x;return t[h]=!C||C.toLowerCase(),""}),t["max-age"]){const l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t}let Ni=null;function fr(o){if(null==Ni){const t=o.navigator?o.navigator.userAgent:null;Ni=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ni}function Ai(o){try{const t=ze[o];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function wr(o,t){return[o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]]}const Pr="mapbox-tiles";let Rr,ur,xi=500,_r=50;function Mo(){try{return ze.caches}catch{}}function Ho(){Mo()&&!Rr&&(Rr=ze.caches.open(Pr))}function qt(o){const t=o.indexOf("?");if(t<0)return o;const h=function(m){const x=m.indexOf("?");return x>0?m.slice(x+1).split("&"):[]}(o).filter(m=>{const x=m.split("=");return"language"===x[0]||"worldview"===x[0]});return h.length?`${o.slice(0,t)}?${h.join("&")}`:o.slice(0,t)}let Xi=1/0;const si={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(si);class po extends Error{constructor(t,l,h){401===l&&wt(h)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Jr=qr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ze.location.protocol?ze.parent:ze).location.href,wo=function(o,t){if(!(/^file:/.test(l=o.url)||/^file:/.test(Jr())&&!/^\w+:/.test(l))){if(ze.fetch&&ze.Request&&ze.AbortController&&ze.Request.prototype.hasOwnProperty("signal"))return function(h,m){const x=new ze.AbortController,C=new ze.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Jr(),referrerPolicy:h.referrerPolicy,signal:x.signal});let D=!1,M=!1;const P=(U=C.url).indexOf("sku=")>0&&wt(U);var U;"json"===h.type&&C.headers.set("Accept","application/json");const G=(ne,ae,pe)=>{if(M)return;if(ne&&"SecurityError"!==ne.message&&Gn(ne.toString()),ae&&pe)return Y(ae);const Ee=Date.now();ze.fetch(C).then(Pe=>{if(Pe.ok){const We=P?Pe.clone():null;return Y(Pe,We,Ee)}return m(new po(Pe.statusText,Pe.status,h.url))}).catch(Pe=>{"AbortError"!==Pe.name&&m(new Error(`${Pe.message} ${h.url}`))})},Y=(ne,ae,pe)=>{("arrayBuffer"===h.type?ne.arrayBuffer():"json"===h.type?ne.json():ne.text()).then(Ee=>{M||(ae&&pe&&function(Pe,We,Le){if(Ho(),!Rr)return;const $e={status:We.status,statusText:We.statusText,headers:new ze.Headers};We.headers.forEach((Ft,Rt)=>$e.headers.set(Rt,Ft));const et=Ci(We.headers.get("Cache-Control")||"");if(et["no-store"])return;et["max-age"]&&$e.headers.set("Expires",new Date(Le+1e3*et["max-age"]).toUTCString());const Xe=$e.headers.get("Expires");Xe&&(new Date(Xe).getTime()-Le<42e4||function(Ft,Rt){if(void 0===ur)try{new Response(new ReadableStream),ur=!0}catch{ur=!1}ur?Rt(Ft.body):Ft.blob().then(Rt)}(We,Ft=>{const Rt=new ze.Response(Ft,$e);Ho(),Rr&&Rr.then(tn=>tn.put(qt(Pe.url),Rt)).catch(tn=>Gn(tn.message))}))}(C,ae,pe),D=!0,m(null,Ee,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(Ee=>{M||m(new Error(Ee.message))})};return P?function(ne,ae){if(Ho(),!Rr)return ae(null);const pe=qt(ne.url);Rr.then(Ee=>{Ee.match(pe).then(Pe=>{const We=function(Le){if(!Le)return!1;const $e=new Date(Le.headers.get("Expires")||0),et=Ci(Le.headers.get("Cache-Control")||"");return $e>Date.now()&&!et["no-cache"]}(Pe);Ee.delete(pe),We&&Ee.put(pe,Pe.clone()),ae(null,Pe,We)}).catch(ae)}).catch(ae)}(C,G):G(null,null),{cancel:()=>{M=!0,D||x.abort()}}}(o,t);if(qr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,t,void 0,!0)}var l;return function(h,m){const x=new ze.XMLHttpRequest;x.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(x.responseType="arraybuffer");for(const C in h.headers)x.setRequestHeader(C,h.headers[C]);return"json"===h.type&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials="include"===h.credentials,x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||0===x.status)&&null!==x.response){let C=x.response;if("json"===h.type)try{C=JSON.parse(x.response)}catch(D){return m(D)}m(null,C,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else m(new po(x.statusText,x.status,h.url))},x.send(h.body),{cancel:()=>x.abort()}}(o,t)},nr=function(o,t){return wo(At(o,{type:"arrayBuffer"}),t)};function Bs(o){const t=ze.document.createElement("a");return t.href=o,t.protocol===ze.document.location.protocol&&t.host===ze.document.location.host}const Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,ve;ge=[],ve=0;const Re=function(o,t){if(xt.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ve>=$t.MAX_PARALLEL_IMAGE_REQUESTS){const x={requestParameters:o,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(x),x}ve++;let l=!1;const h=()=>{if(!l)for(l=!0,ve--;ge.length&&ve<$t.MAX_PARALLEL_IMAGE_REQUESTS;){const x=ge.shift(),{requestParameters:C,callback:D,cancelled:M}=x;M||(x.cancel=Re(C,D).cancel)}},m=nr(o,(x,C,D,M)=>{h(),x?t(x):C&&(ze.createImageBitmap?function(P,U){const G=new ze.Blob([new Uint8Array(P)],{type:"image/png"});ze.createImageBitmap(G).then(Y=>{U(null,Y)}).catch(Y=>{U(new Error(`Could not load image because of ${Y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(C,(P,U)=>t(P,U,D,M)):function(P,U){const G=new ze.Image,Y=ze.URL;G.onload=()=>{U(null,G),Y.revokeObjectURL(G.src),G.onload=null,ze.requestAnimationFrame(()=>{G.src=Ue})},G.onerror=()=>U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ne=new ze.Blob([new Uint8Array(P)],{type:"image/png"});G.src=P.byteLength?Y.createObjectURL(ne):Ue}(C,(P,U)=>t(P,U,D,M)))});return{cancel:()=>{m.cancel(),h()}}},Oe="NO_ACCESS_TOKEN";function rt(o){return 0===o.indexOf("mapbox:")}function wt(o){return $t.API_URL_REGEX.test(o)}function st(o){return $t.API_CDN_URL_REGEX.test(o)}function Ye(o){return $t.API_STYLE_REGEX.test(o)&&!Dt(o)}function Dt(o){return $t.API_SPRITE_REGEX.test(o)}const pn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mn(o){const t=o.match(pn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ze(o){const t=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${t}`}const lt="mapbox.eventData";function De(o){if(!o)return null;const t=o.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(ze.atob(t[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ke{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const l=De($t.ACCESS_TOKEN);let h="";return h=l&&l.u?ze.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(m,x)=>String.fromCharCode(+("0x"+x)))):$t.ACCESS_TOKEN||"",t?`${lt}.${t}:${h}`:`${lt}:${h}`}fetchEventData(){const t=Ai("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const m=ze.localStorage.getItem(l);m&&(this.eventData=JSON.parse(m));const x=ze.localStorage.getItem(h);x&&(this.anonId=x)}catch{Gn("Unable to read from LocalStorage")}}saveEventData(){const t=Ai("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{ze.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&ze.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Gn("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,l,h,m){if(!$t.EVENTS_URL)return;const x=Mn($t.EVENTS_URL);x.params.push(`access_token=${m||$t.ACCESS_TOKEN||""}`);const C={event:this.type,created:new Date(t).toISOString()},D=l?At(C,l):C,M={url:Ze(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};var U;this.pendingRequest=(U=P=>{this.pendingRequest=null,h(P),this.saveEventData(),this.processRequests(m)},wo(At(M,{method:"POST"}),U))}queueRequest(t,l){this.queue.push(t),this.processRequests(l)}}const Tt=new class extends Ke{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,t){$t.EVENTS_URL&&$t.ACCESS_TOKEN&&Array.isArray(o)&&o.some(l=>rt(l)||wt(l))&&this.queueRequest(Date.now(),t)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=De($t.ACCESS_TOKEN),l=t?t.u:$t.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;_n(this.anonId)||(this.anonId=mt(),h=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),C=new Date(m),D=(m-this.eventData.lastSuccess)/864e5;h=h||D>=1||D<-1||x.getDate()!==C.getDate()}else h=!0;h?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ke,skuId:un,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=m,this.eventData.tokenU=l)},o):this.processRequests()}},xn=Tt.postTurnstileEvent.bind(Tt),Bn=new class extends Ke{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,t,l,h){this.skuToken=t,this.errorCb=h,$t.EVENTS_URL&&(l||$t.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},l):this.errorCb(new Error(Oe)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),_n(this.anonId)||(this.anonId=mt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ke,skuId:un,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},o))}},Mr=Bn.postMapLoadEvent.bind(Bn),Lr=new class extends Ke{constructor(){super("gljs.performance")}postPerformanceEvent(o,t){$t.EVENTS_URL&&(o||$t.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:l}=this.queue.shift(),h=function(m){const x=ze.performance.getEntriesByType("resource"),C=ze.performance.getEntriesByType("mark"),D=function(Y){const ne={};if(Y)for(const ae in Y)if("other"!==ae)for(const pe of Y[ae]){const Ee=`${ae}ResolveRangeMin`,Pe=`${ae}ResolveRangeMax`,We=`${ae}RequestCount`,Le=`${ae}RequestCachedCount`;ne[Ee]=Math.min(ne[Ee]||1/0,pe.startTime),ne[Pe]=Math.max(ne[Pe]||-1/0,pe.responseEnd);const $e=et=>{void 0===ne[et]&&(ne[et]=0),++ne[et]};void 0!==pe.transferSize&&0===pe.transferSize&&$e(Le),$e(We)}return ne}(function(Y,ne){const ae={};if(Y)for(const pe of Y){const Ee=ne(pe);void 0===ae[Ee]&&(ae[Ee]=[]),ae[Ee].push(pe)}return ae}(x,an)),M=ze.devicePixelRatio,P=ze.navigator.connection||ze.navigator.mozConnection||ze.navigator.webkitConnection,U={counters:[],metadata:[],attributes:[]},G=(Y,ne,ae)=>{null!=ae&&Y.push({name:ne,value:ae.toString()})};for(const Y in D)G(U.counters,Y,D[Y]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(G(U.counters,"interactionRangeMin",m.interactionRange[0]),G(U.counters,"interactionRangeMax",m.interactionRange[1])),C)for(const Y of Object.keys(Je)){const ne=Je[Y],ae=C.find(pe=>pe.name===ne);ae&&G(U.counters,ne,ae.startTime)}return G(U.counters,"visibilityHidden",m.visibilityHidden),G(U.attributes,"style",function(Y){if(Y)for(const ne of Y){const ae=ne.name.split("?")[0];if(Ye(ae)){const pe=ae.split("/").slice(-2);if(2===pe.length)return`mapbox://styles/${pe[0]}/${pe[1]}`}}}(x)),G(U.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),G(U.attributes,"fogEnabled",m.fogEnabled?"true":"false"),G(U.attributes,"projection",m.projection),G(U.attributes,"zoom",m.zoom),G(U.metadata,"devicePixelRatio",M),G(U.metadata,"connectionEffectiveType",P?P.effectiveType:void 0),G(U.metadata,"navigatorUserAgent",ze.navigator.userAgent),G(U.metadata,"screenWidth",ze.screen.width),G(U.metadata,"screenHeight",ze.screen.height),G(U.metadata,"windowWidth",ze.innerWidth),G(U.metadata,"windowHeight",ze.innerHeight),G(U.metadata,"mapWidth",m.width/M),G(U.metadata,"mapHeight",m.height/M),G(U.metadata,"webglRenderer",m.renderer),G(U.metadata,"webglVendor",m.vendor),G(U.metadata,"sdkVersion",ke),G(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(l);for(const m of h.metadata);for(const m of h.counters);for(const m of h.attributes);this.postEvent(t,h,()=>{},o)}},hi=Lr.postPerformanceEvent.bind(Lr),zi=new class extends Ke{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,t,l,h){if(!$t.API_URL||!$t.SESSION_PATH)return;const m=Mn($t.API_URL+$t.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${h||$t.ACCESS_TOKEN||""}`);const x={url:Ze(m),headers:{"Content-Type":"text/plain"}};var D;this.pendingRequest=(D=C=>{this.pendingRequest=null,l(C),this.saveEventData(),this.processRequests(h)},wo(At(x,{method:"GET"}),D))}getSessionAPI(o,t,l,h){this.skuToken=t,this.errorCb=h,$t.SESSION_PATH&&$t.API_URL&&(l||$t.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},l):this.errorCb(new Error(Oe)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||this.getSession(l,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},o)}},Ji=zi.getSessionAPI.bind(zi),_t=new Set,Je={create:"create",load:"load",fullLoad:"fullLoad"},ct={mark(o){ze.performance.mark(o)},measure(o,t,l){ze.performance.measure(o,t,l)}};function an(o){const t=o.name.split("?")[0];return st(t)&&t.includes("mapbox-gl.js")?"javascript":st(t)&&t.includes("mapbox-gl.css")?"css":$t.API_FONTS_REGEX.test(t)?"fontRange":Dt(t)?"sprite":Ye(t)?"style":$t.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const en=ze.performance;function In(o){const t=o?o.url.toString():void 0;return en.getEntriesByName(t)}let zn,br,Sr,Ui;const Fi={now:()=>void 0!==Sr?Sr:ze.performance.now(),setNow(o){Sr=o},restoreNow(){Sr=void 0},frame(o){const t=ze.requestAnimationFrame(o);return{cancel:()=>ze.cancelAnimationFrame(t)}},getImageData(o,t=0){const{width:l,height:h}=o;Ui||(Ui=ze.document.createElement("canvas"));const m=Ui.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(l>Ui.width||h>Ui.height)&&(Ui.width=l,Ui.height=h),m.clearRect(-t,-t,l+2*t,h+2*t),m.drawImage(o,0,0,l,h),m.getImageData(-t,-t,l+2*t,h+2*t)},resolveURL:o=>(zn||(zn=ze.document.createElement("a")),zn.href=o,zn.href),get devicePixelRatio(){return ze.devicePixelRatio},get prefersReducedMotion(){return!!ze.matchMedia&&(null==br&&(br=ze.matchMedia("(prefers-reduced-motion: reduce)")),br.matches)}};function _o(o,t,l){l[o]&&-1!==l[o].indexOf(t)||(l[o]=l[o]||[],l[o].push(t))}function Jo(o,t,l){if(l&&l[o]){const h=l[o].indexOf(t);-1!==h&&l[o].splice(h,1)}}class Vi{constructor(t,l={}){At(this,l),this.type=t}}class ro extends Vi{constructor(t,l={}){super("error",At({error:t},l))}}class yi{on(t,l){return this._listeners=this._listeners||{},_o(t,l,this._listeners),this}off(t,l){return Jo(t,l,this._listeners),Jo(t,l,this._oneTimeListeners),this}once(t,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},_o(t,l,this._oneTimeListeners),this):new Promise(h=>this.once(t,h))}fire(t,l){"string"==typeof t&&(t=new Vi(t,l||{}));const h=t.type;if(this.listens(h)){t.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const D of m)D.call(this,t);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const D of x)Jo(h,D,this._oneTimeListeners),D.call(this,t);const C=this._eventedParent;C&&(At(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),C.fire(t))}else t instanceof ro&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var Et=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function vr(o,...t){for(const l of t)for(const h in l)o[h]=l[h];return o}function Cr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function ai(o){if(Array.isArray(o))return o.map(ai);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const l in o)t[l]=ai(o[l]);return t}return Cr(o)}class Gs extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}var Zn=Gs;class ka{constructor(t,l=[]){this.parent=t,this.bindings={};for(const[h,m]of l)this.bindings[h]=m}concat(t){return new ka(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Go=ka;const Qs={kind:"null"},Fn={kind:"number"},Hr={kind:"string"},kr={kind:"boolean"},bo={kind:"color"},ws={kind:"object"},Vr={kind:"value"},$o={kind:"collator"},fa={kind:"formatted"},as={kind:"resolvedImage"};function ls(o,t){return{kind:"array",itemType:o,N:t}}function Ii(o){if("array"===o.kind){const t=Ii(o.itemType);return"number"==typeof o.N?`array<${t}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${t}>`}return o.kind}const gs=[Qs,Fn,Hr,kr,bo,fa,ws,ls(Vr),as];function ji(o,t){if("error"===t.kind)return null;if("array"===o.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ji(o.itemType,t.itemType))&&("number"!=typeof o.N||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if("value"===o.kind)for(const l of gs)if(!ji(l,t))return null}return`Expected ${Ii(o)} but found ${Ii(t)} instead.`}function ko(o,t){return t.some(l=>l.kind===o.kind)}function Za(o,t){return t.some(l=>"null"===l?null===o:"array"===l?Array.isArray(o):"object"===l?o&&!Array.isArray(o)&&"object"==typeof o:l===typeof o)}var Ll,Yl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ba(o){return(o=Math.round(o))<0?0:o>255?255:o}function ea(o){return ba("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function cl(o){return(t="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:t>1?1:t;var t}function ul(o,t,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?o+(t-o)*l*6:2*l<1?t:3*l<2?o+(t-o)*(2/3-l)*6:o}try{Ll={}.parseCSSColor=function(o){var t,l=o.replace(/ /g,"").toLowerCase();if(l in Yl)return Yl[l].slice();if("#"===l[0])return 4===l.length?(t=parseInt(l.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===l.length&&(t=parseInt(l.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var h=l.indexOf("("),m=l.indexOf(")");if(-1!==h&&m+1===l.length){var x=l.substr(0,h),C=l.substr(h+1,m-(h+1)).split(","),D=1;switch(x){case"rgba":if(4!==C.length)return null;D=cl(C.pop());case"rgb":return 3!==C.length?null:[ea(C[0]),ea(C[1]),ea(C[2]),D];case"hsla":if(4!==C.length)return null;D=cl(C.pop());case"hsl":if(3!==C.length)return null;var M=(parseFloat(C[0])%360+360)%360/360,P=cl(C[1]),U=cl(C[2]),G=U<=.5?U*(P+1):U+P-U*P,Y=2*U-G;return[ba(255*ul(Y,G,M+1/3)),ba(255*ul(Y,G,M)),ba(255*ul(Y,G,M-1/3)),D];default:return null}}return null}}catch{}class Di{constructor(t,l,h,m=1){this.r=t,this.g=l,this.b=h,this.a=m}static parse(t){if(!t)return;if(t instanceof Di)return t;if("string"!=typeof t)return;const l=Ll(t);return l?new Di(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[t,l,h,m]=this.toArray();return`rgba(${Math.round(t)},${Math.round(l)},${Math.round(h)},${m})`}toArray(){const{r:t,g:l,b:h,a:m}=this;return 0===m?[0,0,0,0]:[255*t/m,255*l/m,255*h/m,m]}toArray01(){const{r:t,g:l,b:h,a:m}=this;return 0===m?[0,0,0,0]:[t/m,l/m,h/m,m]}toArray01PremultipliedAlpha(){const{r:t,g:l,b:h,a:m}=this;return[t,l,h,m]}}Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1),Di.blue=new Di(0,0,1,1);var Eo=Di;class Vl{constructor(t,l,h){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dl{constructor(t,l,h,m,x){this.text=t.normalize?t.normalize():t,this.image=l,this.scale=h,this.fontStack=m,this.textColor=x}}class bs{constructor(t){this.sections=t}static fromString(t){return new bs([new dl(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof bs?t:bs.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const l of this.sections){if(l.image){t.push(["image",l.image.name]);continue}t.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),t.push(h)}return t}}class Qo{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Qo({name:t,available:!1}):null}serialize(){return["image",this.name]}}function qa(o,t,l,h){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[o,t,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[o,t,l,h]:[o,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hl(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Eo||o instanceof Vl||o instanceof bs||o instanceof Qo)return!0;if(Array.isArray(o)){for(const t of o)if(!hl(t))return!1;return!0}if("object"==typeof o){for(const t in o)if(!hl(o[t]))return!1;return!0}return!1}function go(o){if(null===o)return Qs;if("string"==typeof o)return Hr;if("boolean"==typeof o)return kr;if("number"==typeof o)return Fn;if(o instanceof Eo)return bo;if(o instanceof Vl)return $o;if(o instanceof bs)return fa;if(o instanceof Qo)return as;if(Array.isArray(o)){const t=o.length;let l;for(const h of o){const m=go(h);if(l){if(l===m)continue;l=Vr;break}l=m}return ls(l||Vr,t)}return ws}function $s(o){const t=typeof o;return null===o?"":"string"===t||"number"===t||"boolean"===t?String(o):o instanceof Eo||o instanceof bs||o instanceof Qo?o.toString():JSON.stringify(o)}class Ea{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(2!==t.length)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!hl(t[1]))return l.error("invalid value");const h=t[1];let m=go(h);const x=l.expectedType;return"array"!==m.kind||0!==m.N||!x||"array"!==x.kind||"number"==typeof x.N&&0!==x.N||(m=x),new Ea(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Eo?["rgba"].concat(this.value.toArray()):this.value instanceof bs?this.value.serialize():this.value}}var zr=Ea,ti=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const Ri={string:Hr,number:Fn,boolean:kr,object:ws};class es{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let h,m=1;const x=t[0];if("array"===x){let D,M;if(t.length>2){const P=t[1];if("string"!=typeof P||!(P in Ri)||"object"===P)return l.error('The item type argument of "array" must be one of string, number, boolean',1);D=Ri[P],m++}else D=Vr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=t[2],m++}h=ls(D,M)}else h=Ri[x];const C=[];for(;m<t.length;m++){const D=l.parse(t[m],m,Vr);if(!D)return null;C.push(D)}return new es(h,C)}evaluate(t){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(t);if(!ji(this.type,go(h)))return h;if(l===this.args.length-1)throw new ti(`Expected value to be of type ${Ii(this.type)}, but found ${Ii(go(h))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,l=[t.kind];if("array"===t.kind){const h=t.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const m=t.N;("number"==typeof m||this.args.length>1)&&l.push(m)}}return l.concat(this.args.map(h=>h.serialize()))}}var Qi=es;class pa{constructor(t){this.type=fa,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const h=t[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const m=[];let x=!1;for(let C=1;C<=t.length-1;++C){const D=t[C];if(x&&"object"==typeof D&&!Array.isArray(D)){x=!1;let M=null;if(D["font-scale"]&&(M=l.parse(D["font-scale"],1,Fn),!M))return null;let P=null;if(D["text-font"]&&(P=l.parse(D["text-font"],1,ls(Hr)),!P))return null;let U=null;if(D["text-color"]&&(U=l.parse(D["text-color"],1,bo),!U))return null;const G=m[m.length-1];G.scale=M,G.font=P,G.textColor=U}else{const M=l.parse(t[C],1,Vr);if(!M)return null;const P=M.type.kind;if("string"!==P&&"value"!==P&&"null"!==P&&"resolvedImage"!==P)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:M,scale:null,font:null,textColor:null})}}return new pa(m)}evaluate(t){return new bs(this.sections.map(l=>{const h=l.content.evaluate(t);return go(h)===as?new dl("",h,null,null,null):new dl($s(h),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null)}))}eachChild(t){for(const l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const l of this.sections){t.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),t.push(h)}return t}}class Fa{constructor(t){this.type=as,this.input=t}static parse(t,l){if(2!==t.length)return l.error("Expected two arguments.");const h=l.parse(t[1],1,Hr);return h?new Fa(h):l.error("No image name provided.")}evaluate(t){const l=this.input.evaluate(t),h=Qo.fromString(l);return h&&t.availableImages&&(h.available=t.availableImages.indexOf(l)>-1),h}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Fo={"to-boolean":kr,"to-color":bo,"to-number":Fn,"to-string":Hr};class Ba{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const h=t[0];if(("to-boolean"===h||"to-string"===h)&&2!==t.length)return l.error("Expected one argument.");const m=Fo[h],x=[];for(let C=1;C<t.length;C++){const D=l.parse(t[C],C,Vr);if(!D)return null;x.push(D)}return new Ba(m,x)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let l,h;for(const m of this.args){if(l=m.evaluate(t),h=null,l instanceof Eo)return l;if("string"==typeof l){const x=t.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:qa(l[0],l[1],l[2],l[3]),!h))return new Eo(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ti(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(t),null===l)return 0;const m=Number(l);if(!isNaN(m))return m}throw new ti(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?bs.fromString($s(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Qo.fromString($s(this.args[0].evaluate(t))):$s(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new pa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Fa(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(l=>{t.push(l.serialize())}),t}}var Ca=Ba;const mi=["Unknown","Point","LineString","Polygon"];var er=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?mi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*t-o[0])+this.featureDistanceData.bearing[1]*(h*t-o[1])}return 0}parseColor(o){let t=this._parseColorCache[o];return t||(t=this._parseColorCache[o]=Eo.parse(o)),t}};class Dr{constructor(t,l,h,m){this.name=t,this.type=l,this._evaluate=h,this.args=m}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,l){const h=t[0],m=Dr.definitions[h];if(!m)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(m)?m[0]:m.type,C=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=C.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let M=null;for(const[P,U]of D){M=new oa(l.registry,l.path,null,l.scope);const G=[];let Y=!1;for(let ne=1;ne<t.length;ne++){const ae=t[ne],pe=Array.isArray(P)?P[ne-1]:P.type,Ee=M.parse(ae,1+G.length,pe);if(!Ee){Y=!0;break}G.push(Ee)}if(!Y)if(Array.isArray(P)&&P.length!==G.length)M.error(`Expected ${P.length} arguments, but found ${G.length} instead.`);else{for(let ne=0;ne<G.length;ne++){const ae=Array.isArray(P)?P[ne]:P.type,pe=G[ne];M.concat(ne+1).checkSubtype(ae,pe.type)}if(0===M.errors.length)return new Dr(h,x,U,G)}}if(1===D.length)l.errors.push(...M.errors);else{const P=(D.length?D:C).map(([G])=>{return Y=G,Array.isArray(Y)?`(${Y.map(Ii).join(", ")})`:`(${Ii(Y.type)}...)`;var Y}).join(" | "),U=[];for(let G=1;G<t.length;G++){const Y=l.parse(t[G],1+U.length);if(!Y)return null;U.push(Ii(Y.type))}l.error(`Expected arguments of type ${P}, but found (${U.join(", ")}) instead.`)}return null}static register(t,l){Dr.definitions=l;for(const h in l)t[h]=Dr}}var ni=Dr;class cs{constructor(t,l,h){this.type=$o,this.locale=h,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(2!==t.length)return l.error("Expected one argument.");const h=t[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const m=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,kr);if(!m)return null;const x=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,kr);if(!x)return null;let C=null;return h.locale&&(C=l.parse(h.locale,1,Hr),!C)?null:new cs(m,x,C)}evaluate(t){return new Vl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const ts=8192;function Co(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function Aa(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Fr(o,t){const l=(180+o[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,m=Math.pow(2,t.z);return[Math.round(l*m*ts),Math.round(h*m*ts)]}function Ws(o,t,l){const h=o[0]-t[0],m=o[1]-t[1],x=o[0]-l[0],C=o[1]-l[1];return h*C-x*m==0&&h*x<=0&&m*C<=0}function ta(o,t){let l=!1;for(let C=0,D=t.length;C<D;C++){const M=t[C];for(let P=0,U=M.length;P<U-1;P++){if(Ws(o,M[P],M[P+1]))return!1;(m=M[P])[1]>(h=o)[1]!=(x=M[P+1])[1]>h[1]&&h[0]<(x[0]-m[0])*(h[1]-m[1])/(x[1]-m[1])+m[0]&&(l=!l)}}var h,m,x;return l}function Or(o,t){for(let l=0;l<t.length;l++)if(ta(o,t[l]))return!0;return!1}function zs(o,t,l,h){const m=h[0]-l[0],x=h[1]-l[1],C=(o[0]-l[0])*x-m*(o[1]-l[1]),D=(t[0]-l[0])*x-m*(t[1]-l[1]);return C>0&&D<0||C<0&&D>0}function ms(o,t,l){for(const P of l)for(let U=0;U<P.length-1;++U)if((D=[(C=P[U+1])[0]-(x=P[U])[0],C[1]-x[1]])[0]*(M=[(m=t)[0]-(h=o)[0],m[1]-h[1]])[1]-D[1]*M[0]!=0&&zs(h,m,x,C)&&zs(x,C,h,m))return!0;var h,m,x,C,D,M;return!1}function Xr(o,t){for(let l=0;l<o.length;++l)if(!ta(o[l],t))return!1;for(let l=0;l<o.length-1;++l)if(ms(o[l],o[l+1],t))return!1;return!0}function lo(o,t){for(let l=0;l<t.length;l++)if(Xr(o,t[l]))return!0;return!1}function na(o,t,l){const h=[];for(let m=0;m<o.length;m++){const x=[];for(let C=0;C<o[m].length;C++){const D=Fr(o[m][C],l);Co(t,D),x.push(D)}h.push(x)}return h}function Da(o,t,l){const h=[];for(let m=0;m<o.length;m++){const x=na(o[m],t,l);h.push(x)}return h}function Es(o,t,l,h){if(o[0]<l[0]||o[0]>l[2]){const m=.5*h;let x=o[0]-l[0]>m?-h:l[0]-o[0]>m?h:0;0===x&&(x=o[0]-l[2]>m?-h:l[2]-o[0]>m?h:0),o[0]+=x}Co(t,o)}function ns(o,t,l,h){const m=Math.pow(2,h.z)*ts,x=[h.x*ts,h.y*ts],C=[];if(!o)return C;for(const D of o)for(const M of D){const P=[M.x+x[0],M.y+x[1]];Es(P,t,l,m),C.push(P)}return C}function Xa(o,t,l,h){const m=Math.pow(2,h.z)*ts,x=[h.x*ts,h.y*ts],C=[];if(!o)return C;for(const M of o){const P=[];for(const U of M){const G=[U.x+x[0],U.y+x[1]];Co(t,G),P.push(G)}C.push(P)}if(t[2]-t[0]<=m/2){(D=t)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const M of C)for(const P of M)Es(P,t,l,m)}var D;return C}class _s{constructor(t,l){this.type=kr,this.geojson=t,this.geometries=l}static parse(t,l){if(2!==t.length)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hl(t[1])){const h=t[1];if("FeatureCollection"===h.type)for(let m=0;m<h.features.length;++m){const x=h.features[m].geometry.type;if("Polygon"===x||"MultiPolygon"===x)return new _s(h,h.features[m].geometry)}else if("Feature"===h.type){const m=h.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new _s(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new _s(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=l.canonicalID();if(!C)return!1;if("Polygon"===h.type){const D=na(h.coordinates,x,C),M=ns(l.geometry(),m,x,C);if(!Aa(m,x))return!1;for(const P of M)if(!ta(P,D))return!1}if("MultiPolygon"===h.type){const D=Da(h.coordinates,x,C),M=ns(l.geometry(),m,x,C);if(!Aa(m,x))return!1;for(const P of M)if(!Or(P,D))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(l,h){const m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=l.canonicalID();if(!C)return!1;if("Polygon"===h.type){const D=na(h.coordinates,x,C),M=Xa(l.geometry(),m,x,C);if(!Aa(m,x))return!1;for(const P of M)if(!Xr(P,D))return!1}if("MultiPolygon"===h.type){const D=Da(h.coordinates,x,C),M=Xa(l.geometry(),m,x,C);if(!Aa(m,x))return!1;for(const P of M)if(!lo(P,D))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Us=_s;function ra(o){if(o instanceof ni&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Us)return!1;let t=!0;return o.eachChild(l=>{t&&!ra(l)&&(t=!1)}),t}function ia(o){if(o instanceof ni&&"feature-state"===o.name)return!1;let t=!0;return o.eachChild(l=>{t&&!ia(l)&&(t=!1)}),t}function Wr(o,t){if(o instanceof ni&&t.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(h=>{l&&!Wr(h,t)&&(l=!1)}),l}class vl{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(2!==t.length||"string"!=typeof t[1])return l.error("'var' expression requires exactly one string literal argument.");const h=t[1];return l.scope.has(h)?new vl(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ya=vl;class za{constructor(t,l=[],h,m=new Go,x=[]){this.registry=t,this.path=l,this.key=l.map(C=>`[${C}]`).join(""),this.scope=m,this.errors=x,this.expectedType=h}parse(t,l,h,m,x={}){return l?this.concat(l,h,m)._parse(t,x):this._parse(t,x)}_parse(t,l){function h(m,x,C){return"assert"===C?new Qi(x,[m]):"coerce"===C?new Ca(x,[m]):m}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=t[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[m];if(x){let C=x.parse(t,this);if(!C)return null;if(this.expectedType){const D=this.expectedType,M=C.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==M.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==M.kind&&"string"!==M.kind){if(this.checkSubtype(D,M))return null}else C=h(C,D,l.typeAnnotation||"coerce");else C=h(C,D,l.typeAnnotation||"assert")}if(!(C instanceof zr)&&"resolvedImage"!==C.type.kind&&vs(C)){const D=new er;try{C=new zr(C.type,C.evaluate(D))}catch(M){return this.error(M.message),null}}return C}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,h){const m="number"==typeof t?this.path.concat(t):this.path,x=h?this.scope.concat(h):this.scope;return new za(this.registry,m,l||null,x,this.errors)}error(t,...l){const h=`${this.key}${l.map(m=>`[${m}]`).join("")}`;this.errors.push(new Zn(h,t))}checkSubtype(t,l){const h=ji(t,l);return h&&this.error(h),h}}var oa=za;function vs(o){if(o instanceof Ya)return vs(o.boundExpression);if(o instanceof ni&&"error"===o.name||o instanceof cs||o instanceof Us)return!1;const t=o instanceof Ca||o instanceof Qi;let l=!0;return o.eachChild(h=>{l=t?l&&vs(h):l&&h instanceof zr}),!!l&&ra(o)&&Wr(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ua(o,t){const l=o.length-1;let h,m,x=0,C=l,D=0;for(;x<=C;)if(D=Math.floor((x+C)/2),h=o[D],m=o[D+1],h<=t){if(D===l||t<m)return D;x=D+1}else{if(!(h>t))throw new ti("Input is not a number.");C=D-1}return 0}class Zs{constructor(t,l,h){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(const[m,x]of h)this.labels.push(m),this.outputs.push(x)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(t[1],1,Fn);if(!h)return null;const m=[];let x=null;l.expectedType&&"value"!==l.expectedType.kind&&(x=l.expectedType);for(let C=1;C<t.length;C+=2){const D=1===C?-1/0:t[C],M=t[C+1],P=C,U=C+1;if("number"!=typeof D)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(m.length&&m[m.length-1][0]>=D)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const G=l.parse(M,U,x);if(!G)return null;x=x||G.type,m.push([D,G])}return new Zs(x,h,m)}evaluate(t){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(t);const m=this.input.evaluate(t);if(m<=l[0])return h[0].evaluate(t);const x=l.length;return m>=l[x-1]?h[x-1].evaluate(t):h[Ua(l,m)].evaluate(t)}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&t.push(this.labels[l]),t.push(this.outputs[l].serialize());return t}}var us=Zs;function ri(o,t,l){return o*(1-l)+t*l}var ie=Object.freeze({__proto__:null,array:function(o,t,l){return o.map((h,m)=>ri(h,t[m],l))},color:function(o,t,l){return new Eo(ri(o.r,t.r,l),ri(o.g,t.g,l),ri(o.b,t.b,l),ri(o.a,t.a,l))},number:ri});const K=.95047,Ie=4/29,Ge=6/29,yt=3*Ge*Ge,vn=Ge*Ge*Ge,Sn=Math.PI/180,re=180/Math.PI;function ue(o){return o>vn?Math.pow(o,1/3):o/yt+Ie}function X(o){return o>Ge?o*o*o:yt*(o-Ie)}function be(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function qe(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function On(o){const t=qe(o.r),l=qe(o.g),h=qe(o.b),m=ue((.4124564*t+.3575761*l+.1804375*h)/K),x=ue((.2126729*t+.7151522*l+.072175*h)/1);return{l:116*x-16,a:500*(m-x),b:200*(x-ue((.0193339*t+.119192*l+.9503041*h)/1.08883)),alpha:o.a}}function lr(o){let t=(o.l+16)/116,l=isNaN(o.a)?t:t+o.a/500,h=isNaN(o.b)?t:t-o.b/200;return t=1*X(t),l=K*X(l),h=1.08883*X(h),new Eo(be(3.2404542*l-1.5371385*t-.4985314*h),be(-.969266*l+1.8760108*t+.041556*h),be(.0556434*l-.2040259*t+1.0572252*h),o.alpha)}function Br(o,t,l){const h=t-o;return o+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const ii={forward:On,reverse:lr,interpolate:function(o,t,l){return{l:ri(o.l,t.l,l),a:ri(o.a,t.a,l),b:ri(o.b,t.b,l),alpha:ri(o.alpha,t.alpha,l)}}},Ti={forward:function(o){const{l:t,a:l,b:h}=On(o),m=Math.atan2(h,l)*re;return{h:m<0?m+360:m,c:Math.sqrt(l*l+h*h),l:t,alpha:o.a}},reverse:function(o){const t=o.h*Sn,l=o.c;return lr({l:o.l,a:Math.cos(t)*l,b:Math.sin(t)*l,alpha:o.alpha})},interpolate:function(o,t,l){return{h:Br(o.h,t.h,l),c:ri(o.c,t.c,l),l:ri(o.l,t.l,l),alpha:ri(o.alpha,t.alpha,l)}}};var ki=Object.freeze({__proto__:null,hcl:Ti,lab:ii});class eo{constructor(t,l,h,m,x){this.type=t,this.operator=l,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[C,D]of x)this.labels.push(C),this.outputs.push(D)}static interpolationFactor(t,l,h,m){let x=0;if("exponential"===t.name)x=Qr(l,t.base,h,m);else if("linear"===t.name)x=Qr(l,1,h,m);else if("cubic-bezier"===t.name){const C=t.controlPoints;x=new Xt(C[0],C[1],C[2],C[3]).solve(Qr(l,1,h,m))}return x}static parse(t,l){let[h,m,x,...C]=t;if(!Array.isArray(m)||0===m.length)return l.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const P=m[1];if("number"!=typeof P)return l.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:P}}else{if("cubic-bezier"!==m[0])return l.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const P=m.slice(1);if(4!==P.length||P.some(U=>"number"!=typeof U||U<0||U>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,Fn),!x)return null;const D=[];let M=null;"interpolate-hcl"===h||"interpolate-lab"===h?M=bo:l.expectedType&&"value"!==l.expectedType.kind&&(M=l.expectedType);for(let P=0;P<C.length;P+=2){const U=C[P],G=C[P+1],Y=P+3,ne=P+4;if("number"!=typeof U)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(D.length&&D[D.length-1][0]>=U)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const ae=l.parse(G,ne,M);if(!ae)return null;M=M||ae.type,D.push([U,ae])}return"number"===M.kind||"color"===M.kind||"array"===M.kind&&"number"===M.itemType.kind&&"number"==typeof M.N?new eo(M,h,m,x,D):l.error(`Type ${Ii(M)} is not interpolatable.`)}evaluate(t){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(t);const m=this.input.evaluate(t);if(m<=l[0])return h[0].evaluate(t);const x=l.length;if(m>=l[x-1])return h[x-1].evaluate(t);const C=Ua(l,m),D=eo.interpolationFactor(this.interpolation,m,l[C],l[C+1]),M=h[C].evaluate(t),P=h[C+1].evaluate(t);return"interpolate"===this.operator?ie[this.type.kind.toLowerCase()](M,P,D):"interpolate-hcl"===this.operator?Ti.reverse(Ti.interpolate(Ti.forward(M),Ti.forward(P),D)):ii.reverse(ii.interpolate(ii.forward(M),ii.forward(P),D))}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,t,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Qr(o,t,l,h){const m=h-l,x=o-l;return 0===m?0:1===t?x/m:(Math.pow(t,x)-1)/(Math.pow(t,m)-1)}var Gr=eo;class Bi{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expectected at least one argument.");let h=null;const m=l.expectedType;m&&"value"!==m.kind&&(h=m);const x=[];for(const D of t.slice(1)){const M=l.parse(D,1+x.length,h,void 0,{typeAnnotation:"omit"});if(!M)return null;h=h||M.type,x.push(M)}const C=m&&x.some(D=>ji(m,D.type));return new Bi(C?Vr:h,x)}evaluate(t){let l,h=null,m=0;for(const x of this.args){if(m++,h=x.evaluate(t),h&&h instanceof Qo&&!h.available&&(l||(l=h),h=null,m===this.args.length))return l;if(null!==h)break}return h}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(l=>{t.push(l.serialize())}),t}}var Bo=Bi;class zo{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const h=[];for(let x=1;x<t.length-1;x+=2){const C=t[x];if("string"!=typeof C)return l.error(`Expected string, but found ${typeof C} instead.`,x);if(/[^a-zA-Z0-9_]/.test(C))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const D=l.parse(t[x+1],x+1);if(!D)return null;h.push([C,D])}const m=l.parse(t[t.length-1],t.length-1,l.expectedType,h);return m?new zo(h,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[l,h]of this.bindings)t.push(l,h.serialize());return t.push(this.result.serialize()),t}}var Wo=zo;class Uo{constructor(t,l,h){this.type=t,this.index=l,this.input=h}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,Fn),m=l.parse(t[2],2,ls(l.expectedType||Vr));return h&&m?new Uo(m.type.itemType,h,m):null}evaluate(t){const l=this.index.evaluate(t),h=this.input.evaluate(t);if(l<0)throw new ti(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new ti(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new ti(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var qs=Uo;class sa{constructor(t,l){this.type=kr,this.needle=t,this.haystack=l}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,Vr),m=l.parse(t[2],2,Vr);return h&&m?ko(h.type,[kr,Hr,Fn,Qs,Vr])?new sa(h,m):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(h.type)} instead`):null}evaluate(t){const l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(null==h)return!1;if(!Za(l,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(go(l))} instead.`);if(!Za(h,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${Ii(go(h))} instead.`);return h.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var vo=sa;class Cs{constructor(t,l,h){this.type=Fn,this.needle=t,this.haystack=l,this.fromIndex=h}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,Vr),m=l.parse(t[2],2,Vr);if(!h||!m)return null;if(!ko(h.type,[kr,Hr,Fn,Qs,Vr]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(h.type)} instead`);if(4===t.length){const x=l.parse(t[3],3,Fn);return x?new Cs(h,m,x):null}return new Cs(h,m)}evaluate(t){const l=this.needle.evaluate(t),h=this.haystack.evaluate(t);if(!Za(l,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(go(l))} instead.`);if(!Za(h,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${Ii(go(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(t);return h.indexOf(l,m)}return h.indexOf(l)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var As=Cs;class aa{constructor(t,l,h,m,x,C){this.inputType=t,this.type=l,this.input=h,this.cases=m,this.outputs=x,this.otherwise=C}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let h,m;l.expectedType&&"value"!==l.expectedType.kind&&(m=l.expectedType);const x={},C=[];for(let P=2;P<t.length-1;P+=2){let U=t[P];const G=t[P+1];Array.isArray(U)||(U=[U]);const Y=l.concat(P);if(0===U.length)return Y.error("Expected at least one branch label.");for(const ae of U){if("number"!=typeof ae&&"string"!=typeof ae)return Y.error("Branch labels must be numbers or strings.");if("number"==typeof ae&&Math.abs(ae)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ae&&Math.floor(ae)!==ae)return Y.error("Numeric branch labels must be integer values.");if(h){if(Y.checkSubtype(h,go(ae)))return null}else h=go(ae);if(void 0!==x[String(ae)])return Y.error("Branch labels must be unique.");x[String(ae)]=C.length}const ne=l.parse(G,P,m);if(!ne)return null;m=m||ne.type,C.push(ne)}const D=l.parse(t[1],1,Vr);if(!D)return null;const M=l.parse(t[t.length-1],t.length-1,m);return M?"value"!==D.type.kind&&l.concat(1).checkSubtype(h,D.type)?null:new aa(h,m,D,x,C,M):null}evaluate(t){const l=this.input.evaluate(t);return(go(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],m={};for(const C of l){const D=m[this.cases[C]];void 0===D?(m[this.cases[C]]=h.length,h.push([this.cases[C],[C]])):h[D][1].push(C)}const x=C=>"number"===this.inputType.kind?Number(C):C;for(const[C,D]of h)t.push(1===D.length?x(D[0]):D.map(x)),t.push(this.outputs[C].serialize());return t.push(this.otherwise.serialize()),t}}var to=aa;class Ka{constructor(t,l,h){this.type=t,this.branches=l,this.otherwise=h}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const m=[];for(let C=1;C<t.length-1;C+=2){const D=l.parse(t[C],C,kr);if(!D)return null;const M=l.parse(t[C+1],C+1,h);if(!M)return null;m.push([D,M]),h=h||M.type}const x=l.parse(t[t.length-1],t.length-1,h);return x?new Ka(h,m,x):null}evaluate(t){for(const[l,h]of this.branches)if(l.evaluate(t))return h.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[l,h]of this.branches)t(l),t(h);t(this.otherwise)}outputDefined(){return this.branches.every(([t,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(l=>{t.push(l.serialize())}),t}}var Oo=Ka;class Ja{constructor(t,l,h,m){this.type=t,this.input=l,this.beginIndex=h,this.endIndex=m}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const h=l.parse(t[1],1,Vr),m=l.parse(t[2],2,Fn);if(!h||!m)return null;if(!ko(h.type,[ls(Vr),Hr,Vr]))return l.error(`Expected first argument to be of type array or string, but found ${Ii(h.type)} instead`);if(4===t.length){const x=l.parse(t[3],3,Fn);return x?new Ja(h.type,h,m,x):null}return new Ja(h.type,h,m)}evaluate(t){const l=this.input.evaluate(t),h=this.beginIndex.evaluate(t);if(!Za(l,["string","array"]))throw new ti(`Expected first argument to be of type array or string, but found ${Ii(go(l))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(t);return l.slice(h,m)}return l.slice(h)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Kl=Ja;function Qa(o,t){return"=="===o||"!="===o?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function jl(o,t,l,h){return 0===h.compare(t,l)}function ys(o,t,l){const h="=="!==o&&"!="!==o;return class aw{constructor(x,C,D){this.type=kr,this.lhs=x,this.rhs=C,this.collator=D,this.hasUntypedArgument="value"===x.type.kind||"value"===C.type.kind}static parse(x,C){if(3!==x.length&&4!==x.length)return C.error("Expected two or three arguments.");const D=x[0];let M=C.parse(x[1],1,Vr);if(!M)return null;if(!Qa(D,M.type))return C.concat(1).error(`"${D}" comparisons are not supported for type '${Ii(M.type)}'.`);let P=C.parse(x[2],2,Vr);if(!P)return null;if(!Qa(D,P.type))return C.concat(2).error(`"${D}" comparisons are not supported for type '${Ii(P.type)}'.`);if(M.type.kind!==P.type.kind&&"value"!==M.type.kind&&"value"!==P.type.kind)return C.error(`Cannot compare types '${Ii(M.type)}' and '${Ii(P.type)}'.`);h&&("value"===M.type.kind&&"value"!==P.type.kind?M=new Qi(P.type,[M]):"value"!==M.type.kind&&"value"===P.type.kind&&(P=new Qi(M.type,[P])));let U=null;if(4===x.length){if("string"!==M.type.kind&&"string"!==P.type.kind&&"value"!==M.type.kind&&"value"!==P.type.kind)return C.error("Cannot use collator to compare non-string types.");if(U=C.parse(x[3],3,$o),!U)return null}return new aw(M,P,U)}evaluate(x){const C=this.lhs.evaluate(x),D=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){const M=go(C),P=go(D);if(M.kind!==P.kind||"string"!==M.kind&&"number"!==M.kind)throw new ti(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${P.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const M=go(C),P=go(D);if("string"!==M.kind||"string"!==P.kind)return t(x,C,D)}return this.collator?l(x,C,D,this.collator.evaluate(x)):t(x,C,D)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}serialize(){const x=[o];return this.eachChild(C=>{x.push(C.serialize())}),x}}}const el=ys("==",function(o,t,l){return t===l},jl),fl=ys("!=",function(o,t,l){return t!==l},function(o,t,l,h){return!jl(0,t,l,h)}),yl=ys("<",function(o,t,l){return t<l},function(o,t,l,h){return h.compare(t,l)<0}),xl=ys(">",function(o,t,l){return t>l},function(o,t,l,h){return h.compare(t,l)>0}),sc=ys("<=",function(o,t,l){return t<=l},function(o,t,l,h){return h.compare(t,l)<=0}),wc=ys(">=",function(o,t,l){return t>=l},function(o,t,l,h){return h.compare(t,l)>=0});class pl{constructor(t,l,h,m,x,C){this.type=Hr,this.number=t,this.locale=l,this.currency=h,this.unit=m,this.minFractionDigits=x,this.maxFractionDigits=C}static parse(t,l){if(3!==t.length)return l.error("Expected two arguments.");const h=l.parse(t[1],1,Fn);if(!h)return null;const m=t[2];if("object"!=typeof m||Array.isArray(m))return l.error("NumberFormat options argument must be an object.");let x=null;if(m.locale&&(x=l.parse(m.locale,1,Hr),!x))return null;let C=null;if(m.currency&&(C=l.parse(m.currency,1,Hr),!C))return null;let D=null;if(m.unit&&(D=l.parse(m.unit,1,Hr),!D))return null;let M=null;if(m["min-fraction-digits"]&&(M=l.parse(m["min-fraction-digits"],1,Fn),!M))return null;let P=null;return m["max-fraction-digits"]&&(P=l.parse(m["max-fraction-digits"],1,Fn),!P)?null:new pl(h,x,C,D,M,P)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ga{constructor(t){this.type=Fn,this.input=t}static parse(t,l){if(2!==t.length)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);const h=l.parse(t[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${Ii(h.type)} instead.`):new ga(h):null}evaluate(t){const l=this.input.evaluate(t);if("string"==typeof l||Array.isArray(l))return l.length;throw new ti(`Expected value to be of type string or array, but found ${Ii(go(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(l=>{t.push(l.serialize())}),t}}const wl={"==":el,"!=":fl,">":xl,"<":yl,">=":wc,"<=":sc,array:Qi,at:qs,boolean:Qi,case:Oo,coalesce:Bo,collator:cs,format:pa,image:Fa,in:vo,"index-of":As,interpolate:Gr,"interpolate-hcl":Gr,"interpolate-lab":Gr,length:ga,let:Wo,literal:zr,match:to,number:Qi,"number-format":pl,object:Qi,slice:Kl,step:us,string:Qi,"to-boolean":Ca,"to-color":Ca,"to-number":Ca,"to-string":Ca,var:Ya,within:Us};function bc(o,[t,l,h,m]){t=t.evaluate(o),l=l.evaluate(o),h=h.evaluate(o);const x=m?m.evaluate(o):1,C=qa(t,l,h,x);if(C)throw new ti(C);return new Eo(t/255*x,l/255*x,h/255*x,x)}function bl(o,t){return o in t}function El(o,t){const l=t[o];return void 0===l?null:l}function Ta(o){return{type:o}}ni.register(wl,{error:[{kind:"error"},[Hr],(o,[t])=>{throw new ti(t.evaluate(o))}],typeof:[Hr,[Vr],(o,[t])=>Ii(go(t.evaluate(o)))],"to-rgba":[ls(Fn,4),[bo],(o,[t])=>t.evaluate(o).toArray()],rgb:[bo,[Fn,Fn,Fn],bc],rgba:[bo,[Fn,Fn,Fn,Fn],bc],has:{type:kr,overloads:[[[Hr],(o,[t])=>bl(t.evaluate(o),o.properties())],[[Hr,ws],(o,[t,l])=>bl(t.evaluate(o),l.evaluate(o))]]},get:{type:Vr,overloads:[[[Hr],(o,[t])=>El(t.evaluate(o),o.properties())],[[Hr,ws],(o,[t,l])=>El(t.evaluate(o),l.evaluate(o))]]},"feature-state":[Vr,[Hr],(o,[t])=>El(t.evaluate(o),o.featureState||{})],properties:[ws,[],o=>o.properties()],"geometry-type":[Hr,[],o=>o.geometryType()],id:[Vr,[],o=>o.id()],zoom:[Fn,[],o=>o.globals.zoom],pitch:[Fn,[],o=>o.globals.pitch||0],"distance-from-center":[Fn,[],o=>o.distanceFromCenter()],"heatmap-density":[Fn,[],o=>o.globals.heatmapDensity||0],"line-progress":[Fn,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Fn,[],o=>o.globals.skyRadialProgress||0],accumulated:[Vr,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[Fn,Ta(Fn),(o,t)=>{let l=0;for(const h of t)l+=h.evaluate(o);return l}],"*":[Fn,Ta(Fn),(o,t)=>{let l=1;for(const h of t)l*=h.evaluate(o);return l}],"-":{type:Fn,overloads:[[[Fn,Fn],(o,[t,l])=>t.evaluate(o)-l.evaluate(o)],[[Fn],(o,[t])=>-t.evaluate(o)]]},"/":[Fn,[Fn,Fn],(o,[t,l])=>t.evaluate(o)/l.evaluate(o)],"%":[Fn,[Fn,Fn],(o,[t,l])=>t.evaluate(o)%l.evaluate(o)],ln2:[Fn,[],()=>Math.LN2],pi:[Fn,[],()=>Math.PI],e:[Fn,[],()=>Math.E],"^":[Fn,[Fn,Fn],(o,[t,l])=>Math.pow(t.evaluate(o),l.evaluate(o))],sqrt:[Fn,[Fn],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[Fn,[Fn],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[Fn,[Fn],(o,[t])=>Math.log(t.evaluate(o))],log2:[Fn,[Fn],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[Fn,[Fn],(o,[t])=>Math.sin(t.evaluate(o))],cos:[Fn,[Fn],(o,[t])=>Math.cos(t.evaluate(o))],tan:[Fn,[Fn],(o,[t])=>Math.tan(t.evaluate(o))],asin:[Fn,[Fn],(o,[t])=>Math.asin(t.evaluate(o))],acos:[Fn,[Fn],(o,[t])=>Math.acos(t.evaluate(o))],atan:[Fn,[Fn],(o,[t])=>Math.atan(t.evaluate(o))],min:[Fn,Ta(Fn),(o,t)=>Math.min(...t.map(l=>l.evaluate(o)))],max:[Fn,Ta(Fn),(o,t)=>Math.max(...t.map(l=>l.evaluate(o)))],abs:[Fn,[Fn],(o,[t])=>Math.abs(t.evaluate(o))],round:[Fn,[Fn],(o,[t])=>{const l=t.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[Fn,[Fn],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[Fn,[Fn],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[kr,[Hr,Vr],(o,[t,l])=>o.properties()[t.value]===l.value],"filter-id-==":[kr,[Vr],(o,[t])=>o.id()===t.value],"filter-type-==":[kr,[Hr],(o,[t])=>o.geometryType()===t.value],"filter-<":[kr,[Hr,Vr],(o,[t,l])=>{const h=o.properties()[t.value],m=l.value;return typeof h==typeof m&&h<m}],"filter-id-<":[kr,[Vr],(o,[t])=>{const l=o.id(),h=t.value;return typeof l==typeof h&&l<h}],"filter->":[kr,[Hr,Vr],(o,[t,l])=>{const h=o.properties()[t.value],m=l.value;return typeof h==typeof m&&h>m}],"filter-id->":[kr,[Vr],(o,[t])=>{const l=o.id(),h=t.value;return typeof l==typeof h&&l>h}],"filter-<=":[kr,[Hr,Vr],(o,[t,l])=>{const h=o.properties()[t.value],m=l.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[kr,[Vr],(o,[t])=>{const l=o.id(),h=t.value;return typeof l==typeof h&&l<=h}],"filter->=":[kr,[Hr,Vr],(o,[t,l])=>{const h=o.properties()[t.value],m=l.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[kr,[Vr],(o,[t])=>{const l=o.id(),h=t.value;return typeof l==typeof h&&l>=h}],"filter-has":[kr,[Vr],(o,[t])=>t.value in o.properties()],"filter-has-id":[kr,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[kr,[ls(Hr)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[kr,[ls(Vr)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[kr,[Hr,ls(Vr)],(o,[t,l])=>l.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[kr,[Hr,ls(Vr)],(o,[t,l])=>function(h,m,x,C){for(;x<=C;){const D=x+C>>1;if(m[D]===h)return!0;m[D]>h?C=D-1:x=D+1}return!1}(o.properties()[t.value],l.value,0,l.value.length-1)],all:{type:kr,overloads:[[[kr,kr],(o,[t,l])=>t.evaluate(o)&&l.evaluate(o)],[Ta(kr),(o,t)=>{for(const l of t)if(!l.evaluate(o))return!1;return!0}]]},any:{type:kr,overloads:[[[kr,kr],(o,[t,l])=>t.evaluate(o)||l.evaluate(o)],[Ta(kr),(o,t)=>{for(const l of t)if(l.evaluate(o))return!0;return!1}]]},"!":[kr,[kr],(o,[t])=>!t.evaluate(o)],"is-supported-script":[kr,[Hr],(o,[t])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(t.evaluate(o))}],upcase:[Hr,[Hr],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Hr,[Hr],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Hr,Ta(Vr),(o,t)=>t.map(l=>$s(l.evaluate(o))).join("")],"resolved-locale":[Hr,[$o],(o,[t])=>t.evaluate(o).resolvedLocale()]});var j=wl;function me(o){return{result:"success",value:o}}function te(o){return{result:"error",value:o}}function fe(o){return"data-driven"===o["property-type"]}function He(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Gt(o){return!!o.expression&&o.expression.interpolated}function Ut(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function pr(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function io(o){return o}function Hi(o,t){const l="color"===t.type,h=o.stops&&"object"==typeof o.stops[0][0],m=h||!(h||void 0!==o.property),x=o.type||(Gt(t)?"exponential":"interval");if(l&&((o=vr({},o)).stops&&(o.stops=o.stops.map(P=>[P[0],Eo.parse(P[1])])),o.default=Eo.parse(o.default?o.default:t.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!ki[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let C,D,M;if("exponential"===x)C=bi;else if("interval"===x)C=Ao;else if("categorical"===x){C=Yr,D=Object.create(null);for(const P of o.stops)D[P[0]]=P[1];M=typeof o.stops[0][0]}else{if("identity"!==x)throw new Error(`Unknown function type "${x}"`);C=ds}if(h){const P={},U=[];for(let ne=0;ne<o.stops.length;ne++){const ae=o.stops[ne],pe=ae[0].zoom;void 0===P[pe]&&(P[pe]={zoom:pe,type:o.type,property:o.property,default:o.default,stops:[]},U.push(pe)),P[pe].stops.push([ae[0].value,ae[1]])}const G=[];for(const ne of U)G.push([P[ne].zoom,Hi(P[ne],t)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:Gr.interpolationFactor.bind(void 0,Y),zoomStops:G.map(ne=>ne[0]),evaluate:({zoom:ne},ae)=>bi({stops:G,base:o.base},t,ne).evaluate(ne,ae)}}if(m){const P="exponential"===x?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:Gr.interpolationFactor.bind(void 0,P),zoomStops:o.stops.map(U=>U[0]),evaluate:({zoom:U})=>C(o,t,U,D,M)}}return{kind:"source",evaluate(P,U){const G=U&&U.properties?U.properties[o.property]:void 0;return void 0===G?wi(o.default,t.default):C(o,t,G,D,M)}}}function wi(o,t,l){return void 0!==o?o:void 0!==t?t:void 0!==l?l:void 0}function Yr(o,t,l,h,m){return wi(typeof l===m?h[l]:void 0,o.default,t.default)}function Ao(o,t,l){if("number"!==Ut(l))return wi(o.default,t.default);const h=o.stops.length;if(1===h||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[h-1][0])return o.stops[h-1][1];const m=Ua(o.stops.map(x=>x[0]),l);return o.stops[m][1]}function bi(o,t,l){const h=void 0!==o.base?o.base:1;if("number"!==Ut(l))return wi(o.default,t.default);const m=o.stops.length;if(1===m||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[m-1][0])return o.stops[m-1][1];const x=Ua(o.stops.map(U=>U[0]),l),C=function(U,G,Y,ne){const ae=ne-Y,pe=U-Y;return 0===ae?0:1===G?pe/ae:(Math.pow(G,pe)-1)/(Math.pow(G,ae)-1)}(l,h,o.stops[x][0],o.stops[x+1][0]),D=o.stops[x][1],M=o.stops[x+1][1];let P=ie[t.type]||io;if(o.colorSpace&&"rgb"!==o.colorSpace){const U=ki[o.colorSpace];P=(G,Y)=>U.reverse(U.interpolate(U.forward(G),U.forward(Y),C))}return"function"==typeof D.evaluate?{evaluate(...U){const G=D.evaluate.apply(void 0,U),Y=M.evaluate.apply(void 0,U);if(void 0!==G&&void 0!==Y)return P(G,Y,C)}}:P(D,M,C)}function ds(o,t,l){return"color"===t.type?l=Eo.parse(l):"formatted"===t.type?l=bs.fromString(l.toString()):"resolvedImage"===t.type?l=Qo.fromString(l.toString()):Ut(l)===t.type||"enum"===t.type&&t.values[l]||(l=void 0),wi(l,o.default,t.default)}class tl{constructor(t,l){var h;this.expression=t,this._warningHistory={},this._evaluator=new er,this._defaultValue=l?"color"===(h=l).type&&(pr(h.default)||Array.isArray(h.default))?new Eo(0,0,0,0):"color"===h.type?Eo.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(t,l,h,m,x,C,D,M){return this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(t,l,h,m,x,C,D,M){this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=M||null;try{const P=this.expression.evaluate(this._evaluator);if(null==P||"number"==typeof P&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new ti(`Expected value to be one of ${Object.keys(this._enumValues).map(U=>JSON.stringify(U)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(P.message)),this._defaultValue}}}function ma(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in j}function Sa(o,t){const l=new oa(j,[],t?function(m){const x={color:bo,string:Hr,number:Fn,enum:Hr,boolean:kr,formatted:fa,resolvedImage:as};return"array"===m.type?ls(x[m.value]||Vr,m.length):x[m.type]}(t):void 0),h=l.parse(o,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return h?me(new tl(h,t)):te(l.errors)}class Os{constructor(t,l){this.kind=t,this._styleExpression=l,this.isStateDependent="constant"!==t&&!ia(l.expression)}evaluateWithoutErrorHandling(t,l,h,m,x,C){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,m,x,C)}evaluate(t,l,h,m,x,C){return this._styleExpression.evaluate(t,l,h,m,x,C)}}class nl{constructor(t,l,h,m){this.kind=t,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==t&&!ia(l.expression),this.interpolationType=m}evaluateWithoutErrorHandling(t,l,h,m,x,C){return this._styleExpression.evaluateWithoutErrorHandling(t,l,h,m,x,C)}evaluate(t,l,h,m,x,C){return this._styleExpression.evaluate(t,l,h,m,x,C)}interpolationFactor(t,l,h){return this.interpolationType?Gr.interpolationFactor(this.interpolationType,t,l,h):0}}function Ia(o,t){if("error"===(o=Sa(o,t)).result)return o;const l=o.value.expression,h=ra(l);if(!h&&!fe(t))return te([new Zn("","data expressions not supported")]);const m=Wr(l,["zoom","pitch","distance-from-center"]);if(!m&&!He(t))return te([new Zn("","zoom expressions not supported")]);const x=qc(l);return x||m?x instanceof Zn?te([x]):x instanceof Gr&&!Gt(t)?te([new Zn("",'"interpolate" expressions cannot be used with this property')]):me(x?new nl(h?"camera":"composite",o.value,x.labels,x instanceof Gr?x.interpolation:void 0):new Os(h?"constant":"source",o.value)):te([new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rl{constructor(t,l){this._parameters=t,this._specification=l,vr(this,Hi(this._parameters,this._specification))}static deserialize(t){return new rl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function qc(o){let t=null;if(o instanceof Wo)t=qc(o.result);else if(o instanceof Bo){for(const l of o.args)if(t=qc(l),t)break}else(o instanceof us||o instanceof Gr)&&o.input instanceof ni&&"zoom"===o.input.name&&(t=o);return t instanceof Zn||o.eachChild(l=>{const h=qc(l);h instanceof Zn?t=h:!t&&h?t=new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&h&&t!==h&&(t=new Zn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Hn{constructor(t,l,h,m){this.message=(t?`${t}: `:"")+h,m&&(this.identifier=m),null!=l&&l.__line__&&(this.line=l.__line__)}}function Cl(o){const t=o.key,l=o.value,h=o.valueSpec||{},m=o.objectElementValidators||{},x=o.style,C=o.styleSpec;let D=[];const M=Ut(l);if("object"!==M)return[new Hn(t,l,`object expected, ${M} found`)];for(const P in l){const U=P.split(".")[0];let G;m[U]?G=m[U]:h[U]?G=Ct:m["*"]?G=m["*"]:h["*"]&&(G=Ct),G?D=D.concat(G({key:(t&&`${t}.`)+P,value:l[P],valueSpec:h[U]||h["*"],style:x,styleSpec:C,object:l,objectKey:P},l)):D.push(new Hn(t,l[P],`unknown property "${P}"`))}for(const P in h)m[P]||h[P].required&&void 0===h[P].default&&void 0===l[P]&&D.push(new Hn(t,l,`missing required property "${P}"`));return D}function Xc(o){const t=o.value,l=o.valueSpec,h=o.style,m=o.styleSpec,x=o.key,C=o.arrayElementValidator||Ct;if("array"!==Ut(t))return[new Hn(x,t,`array expected, ${Ut(t)} found`)];if(l.length&&t.length!==l.length)return[new Hn(x,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new Hn(x,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let D={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};m.$version<7&&(D.function=l.function),"object"===Ut(l.value)&&(D=l.value);let M=[];for(let P=0;P<t.length;P++)M=M.concat(C({array:t,arrayIndex:P,value:t[P],valueSpec:D,style:h,styleSpec:m,key:`${x}[${P}]`}));return M}function ac(o){const t=o.key,l=o.value,h=o.valueSpec;let m=Ut(l);if("number"===m&&l!=l&&(m="NaN"),"number"!==m)return[new Hn(t,l,`number expected, ${m} found`)];if("minimum"in h){let x=h.minimum;if("array"===Ut(h.minimum)&&(x=h.minimum[o.arrayIndex]),l<x)return[new Hn(t,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in h){let x=h.maximum;if("array"===Ut(h.maximum)&&(x=h.maximum[o.arrayIndex]),l>x)return[new Hn(t,l,`${l} is greater than the maximum value ${x}`)]}return[]}function Yi(o){const t=o.valueSpec,l=Cr(o.value.type);let h,m,x,C={};const D="categorical"!==l&&void 0===o.value.property,M=!D,P="array"===Ut(o.value.stops)&&"array"===Ut(o.value.stops[0])&&"object"===Ut(o.value.stops[0][0]),U=Cl({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(ne){if("identity"===l)return[new Hn(ne.key,ne.value,'identity function may not have a "stops" property')];let ae=[];const pe=ne.value;return ae=ae.concat(Xc({key:ne.key,value:pe,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:G})),"array"===Ut(pe)&&0===pe.length&&ae.push(new Hn(ne.key,pe,"array must have at least one stop")),ae},default:function(ne){return Ct({key:ne.key,value:ne.value,valueSpec:t,style:ne.style,styleSpec:ne.styleSpec})}}});return"identity"===l&&D&&U.push(new Hn(o.key,o.value,'missing required property "property"')),"identity"===l||o.value.stops||U.push(new Hn(o.key,o.value,'missing required property "stops"')),"exponential"===l&&o.valueSpec.expression&&!Gt(o.valueSpec)&&U.push(new Hn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!fe(o.valueSpec)?U.push(new Hn(o.key,o.value,"property functions not supported")):D&&!He(o.valueSpec)&&U.push(new Hn(o.key,o.value,"zoom functions not supported"))),"categorical"!==l&&!P||void 0!==o.value.property||U.push(new Hn(o.key,o.value,'"property" property is required')),U;function G(ne){let ae=[];const pe=ne.value,Ee=ne.key;if("array"!==Ut(pe))return[new Hn(Ee,pe,`array expected, ${Ut(pe)} found`)];if(2!==pe.length)return[new Hn(Ee,pe,`array length 2 expected, length ${pe.length} found`)];if(P){if("object"!==Ut(pe[0]))return[new Hn(Ee,pe,`object expected, ${Ut(pe[0])} found`)];if(void 0===pe[0].zoom)return[new Hn(Ee,pe,"object stop key must have zoom")];if(void 0===pe[0].value)return[new Hn(Ee,pe,"object stop key must have value")];const Pe=Cr(pe[0].zoom);if("number"!=typeof Pe)return[new Hn(Ee,pe[0].zoom,"stop zoom values must be numbers")];if(x&&x>Pe)return[new Hn(Ee,pe[0].zoom,"stop zoom values must appear in ascending order")];Pe!==x&&(x=Pe,m=void 0,C={}),ae=ae.concat(Cl({key:`${Ee}[0]`,value:pe[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:ac,value:Y}}))}else ae=ae.concat(Y({key:`${Ee}[0]`,value:pe[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},pe));return ma(ai(pe[1]))?ae.concat([new Hn(`${Ee}[1]`,pe[1],"expressions are not allowed in function stops.")]):ae.concat(Ct({key:`${Ee}[1]`,value:pe[1],valueSpec:t,style:ne.style,styleSpec:ne.styleSpec}))}function Y(ne,ae){const pe=Ut(ne.value),Ee=Cr(ne.value),Pe=null!==ne.value?ne.value:ae;if(h){if(pe!==h)return[new Hn(ne.key,Pe,`${pe} stop domain type must match previous stop domain type ${h}`)]}else h=pe;if("number"!==pe&&"string"!==pe&&"boolean"!==pe&&"number"!=typeof Ee&&"string"!=typeof Ee&&"boolean"!=typeof Ee)return[new Hn(ne.key,Pe,"stop domain value must be a number, string, or boolean")];if("number"!==pe&&"categorical"!==l){let We=`number expected, ${pe} found`;return fe(t)&&void 0===l&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Hn(ne.key,Pe,We)]}return"categorical"!==l||"number"!==pe||"number"==typeof Ee&&isFinite(Ee)&&Math.floor(Ee)===Ee?"categorical"!==l&&"number"===pe&&"number"==typeof Ee&&"number"==typeof m&&void 0!==m&&Ee<m?[new Hn(ne.key,Pe,"stop domain values must appear in ascending order")]:(m=Ee,"categorical"===l&&Ee in C?[new Hn(ne.key,Pe,"stop domain values must be unique")]:(C[Ee]=!0,[])):[new Hn(ne.key,Pe,`integer expected, found ${String(Ee)}`)]}}function $r(o){const t=("property"===o.expressionContext?Ia:Sa)(ai(o.value),o.valueSpec);if("error"===t.result)return t.value.map(h=>new Hn(`${o.key}${h.key}`,o.value,h.message));const l=t.value.expression||t.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!l.outputDefined())return[new Hn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!ia(l))return[new Hn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return Ec(l,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Wr(l,["zoom","feature-state"]))return[new Hn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!ra(l))return[new Hn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ec(o,t){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)l.delete(m);if(0===l.size)return[];const h=[];return o instanceof ni&&l.has(o.name)?[new Hn(t.key,t.value,`["${o.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(o.eachChild(m=>{h.push(...Ec(m,t))}),h)}function il(o){const t=o.key,l=o.value,h=o.valueSpec,m=[];return Array.isArray(h.values)?-1===h.values.indexOf(Cr(l))&&m.push(new Hn(t,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(Cr(l))&&m.push(new Hn(t,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),m}function du(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!du(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Yc(o,t="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};du(o)||(o=Al(o));const l=o;let h=!0;try{h=function(P){if(!Hl(P))return P;let U=ai(P);return Xs(U),U=Do(U),U}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const m=Et[`filter_${t}`],x=Sa(h,m);let C=null;if("error"===x.result)throw new Error(x.value.map(P=>`${P.key}: ${P.message}`).join(", "));C=(P,U,G)=>x.value.evaluate(P,U,{},G);let D=null,M=null;if(h!==l){const P=Sa(l,m);if("error"===P.result)throw new Error(P.value.map(U=>`${U.key}: ${U.message}`).join(", "));D=(U,G,Y,ne,ae)=>P.value.evaluate(U,G,{},Y,void 0,void 0,ne,ae),M=!ra(P.value.expression)}return{filter:C,dynamicFilter:D||void 0,needGeometry:Ds(h),needFeature:!!M}}function Do(o){if(!Array.isArray(o))return o;const t=function(l){if(la.has(l[0]))for(let h=1;h<l.length;h++)if(Hl(l[h]))return!0;return l}(o);return!0===t?t:t.map(l=>Do(l))}function Xs(o){let t=!1;const l=[];if("case"===o[0]){for(let h=1;h<o.length-1;h+=2)t=t||Hl(o[h]),l.push(o[h+1]);l.push(o[o.length-1])}else if("match"===o[0]){t=t||Hl(o[1]);for(let h=2;h<o.length-1;h+=2)l.push(o[h+1]);l.push(o[o.length-1])}else if("step"===o[0]){t=t||Hl(o[1]);for(let h=1;h<o.length-1;h+=2)l.push(o[h+1])}t&&(o.length=0,o.push("any",...l));for(let h=1;h<o.length;h++)Xs(o[h])}function Hl(o){if(!Array.isArray(o))return!1;if("pitch"===(t=o[0])||"distance-from-center"===t)return!0;var t;for(let l=1;l<o.length;l++)if(Hl(o[l]))return!0;return!1}const la=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Kc(o,t){return o<t?-1:o>t?1:0}function Ds(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let t=1;t<o.length;t++)if(Ds(o[t]))return!0;return!1}function Al(o){if(!o)return!0;const t=o[0];return o.length<=1?"any"!==t:"=="===t?_a(o[1],o[2],"=="):"!="===t?hu(_a(o[1],o[2],"==")):"<"===t||">"===t||"<="===t||">="===t?_a(o[1],o[2],t):"any"===t?(l=o.slice(1),["any"].concat(l.map(Al))):"all"===t?["all"].concat(o.slice(1).map(Al)):"none"===t?["all"].concat(o.slice(1).map(Al).map(hu)):"in"===t?cd(o[1],o.slice(2)):"!in"===t?hu(cd(o[1],o.slice(2))):"has"===t?ud(o[1]):"!has"===t?hu(ud(o[1])):"within"!==t||o;var l}function _a(o,t,l){switch(o){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,o,t]}}function cd(o,t){if(0===t.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(l=>typeof l!=typeof t[0])?["filter-in-large",o,["literal",t.sort(Kc)]]:["filter-in-small",o,["literal",t]]}}function ud(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function hu(o){return["!",o]}function Va(o){return du(ai(o.value))?$r(vr({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):lc(o)}function lc(o){const t=o.value,l=o.key;if("array"!==Ut(t))return[new Hn(l,t,`array expected, ${Ut(t)} found`)];const h=o.styleSpec;let m,x=[];if(t.length<1)return[new Hn(l,t,"filter array must have at least 1 element")];switch(x=x.concat(il({key:`${l}[0]`,value:t[0],valueSpec:h.filter_operator,style:o.style,styleSpec:o.styleSpec})),Cr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Cr(t[1])&&x.push(new Hn(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&x.push(new Hn(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=Ut(t[1]),"string"!==m&&x.push(new Hn(`${l}[1]`,t[1],`string expected, ${m} found`)));for(let C=2;C<t.length;C++)m=Ut(t[C]),"$type"===Cr(t[1])?x=x.concat(il({key:`${l}[${C}]`,value:t[C],valueSpec:h.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&x.push(new Hn(`${l}[${C}]`,t[C],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let C=1;C<t.length;C++)x=x.concat(lc({key:`${l}[${C}]`,value:t[C],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":m=Ut(t[1]),2!==t.length?x.push(new Hn(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==m&&x.push(new Hn(`${l}[1]`,t[1],`string expected, ${m} found`));break;case"within":m=Ut(t[1]),2!==t.length?x.push(new Hn(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==m&&x.push(new Hn(`${l}[1]`,t[1],`object expected, ${m} found`))}return x}function dd(o,t){const l=o.key,h=o.style,m=o.styleSpec,x=o.value,C=o.objectKey,D=m[`${t}_${o.layerType}`];if(!D)return[];const M=C.match(/^(.*)-transition$/);if("paint"===t&&M&&D[M[1]]&&D[M[1]].transition)return Ct({key:l,value:x,valueSpec:m.transition,style:h,styleSpec:m});const P=o.valueSpec||D[C];if(!P)return[new Hn(l,x,`unknown property "${C}"`)];let U;if("string"===Ut(x)&&fe(P)&&!P.tokens&&(U=/^{([^}]+)}$/.exec(x))){const Y=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new Hn(l,x,`"${C}" does not support interpolation syntax\nUse an identity property function instead: ${Y}.`)]}const G=[];return"symbol"===o.layerType&&("text-field"===C&&h&&!h.glyphs&&G.push(new Hn(l,x,'use of "text-field" requires a style "glyphs" property')),"text-font"===C&&pr(ai(x))&&"identity"===Cr(x.type)&&G.push(new Hn(l,x,'"text-font" does not support identity functions'))),G.concat(Ct({key:o.key,value:x,valueSpec:P,style:h,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:C}))}function cc(o){return dd(o,"paint")}function gl(o){return dd(o,"layout")}function hd(o){let t=[];const l=o.value,h=o.key,m=o.style,x=o.styleSpec;l.type||l.ref||t.push(new Hn(h,l,'either "type" or "ref" is required'));let C=Cr(l.type);const D=Cr(l.ref);if(l.id){const M=Cr(l.id);for(let P=0;P<o.arrayIndex;P++){const U=m.layers[P];Cr(U.id)===M&&t.push(new Hn(h,l.id,`duplicate layer id "${l.id}", previously used at line ${U.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&t.push(new Hn(h,l[P],`"${P}" is prohibited for ref layers`))}),m.layers.forEach(P=>{Cr(P.id)===D&&(M=P)}),M?M.ref?t.push(new Hn(h,l.ref,"ref cannot reference another ref layer")):C=Cr(M.type):"string"==typeof D&&t.push(new Hn(h,l.ref,`ref layer "${D}" not found`))}else if("background"!==C&&"sky"!==C)if(l.source){const M=m.sources&&m.sources[l.source],P=M&&Cr(M.type);M?"vector"===P&&"raster"===C?t.push(new Hn(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===P&&"raster"!==C?t.push(new Hn(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==P||l["source-layer"]?"raster-dem"===P&&"hillshade"!==C?t.push(new Hn(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==C||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===P&&M.lineMetrics||t.push(new Hn(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Hn(h,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new Hn(h,l.source,`source "${l.source}" not found`))}else t.push(new Hn(h,l,'missing required property "source"'));return t=t.concat(Cl({key:h,value:l,valueSpec:x.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ct({key:`${h}.type`,value:l.type,valueSpec:x.layer.type,style:o.style,styleSpec:o.styleSpec,object:l,objectKey:"type"}),filter:M=>Va(vr({layerType:C},M)),layout:M=>Cl({layer:l,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>gl(vr({layerType:C},P))}}),paint:M=>Cl({layer:l,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":P=>cc(vr({layerType:C},P))}})}})),t}function Dl(o){const t=o.value,l=o.key,h=Ut(t);return"string"!==h?[new Hn(l,t,`string expected, ${h} found`)]:[]}const ei={promoteId:function({key:o,value:t}){if("string"===Ut(t))return Dl({key:o,value:t});{const l=[];for(const h in t)l.push(...Dl({key:`${o}.${h}`,value:t[h]}));return l}}};function Nl(o){const t=o.value,l=o.key,h=o.styleSpec,m=o.style;if(!t.type)return[new Hn(l,t,'"type" is required')];const x=Cr(t.type);let C;switch(x){case"vector":case"raster":case"raster-dem":return C=Cl({key:l,value:t,valueSpec:h[`source_${x.replace("-","_")}`],style:o.style,styleSpec:h,objectElementValidators:ei}),C;case"geojson":if(C=Cl({key:l,value:t,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:ei}),t.cluster)for(const D in t.clusterProperties){const[M,P]=t.clusterProperties[D],U="string"==typeof M?[M,["accumulated"],["get",D]]:M;C.push(...$r({key:`${l}.${D}.map`,value:P,expressionContext:"cluster-map"})),C.push(...$r({key:`${l}.${D}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return C;case"video":return Cl({key:l,value:t,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Cl({key:l,value:t,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new Hn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return il({key:`${l}.type`,value:t.type,valueSpec:{values:Vd(h)},style:m,styleSpec:h})}}function Vd(o){return o.source.reduce((t,l)=>{const h=o[l];return"enum"===h.type.type&&(t=t.concat(Object.keys(h.type.values))),t},[])}function Ru(o){const t=o.value,l=o.styleSpec,h=l.light,m=o.style;let x=[];const C=Ut(t);if(void 0===t)return x;if("object"!==C)return x=x.concat([new Hn("light",t,`object expected, ${C} found`)]),x;for(const D in t){const M=D.match(/^(.*)-transition$/);x=x.concat(M&&h[M[1]]&&h[M[1]].transition?Ct({key:D,value:t[D],valueSpec:l.transition,style:m,styleSpec:l}):h[D]?Ct({key:D,value:t[D],valueSpec:h[D],style:m,styleSpec:l}):[new Hn(D,t[D],`unknown property "${D}"`)])}return x}function Cc(o){const t=o.value,l=o.key,h=o.style,m=o.styleSpec,x=m.terrain;let C=[];const D=Ut(t);if(void 0===t)return C;if("object"!==D)return C=C.concat([new Hn("terrain",t,`object expected, ${D} found`)]),C;for(const M in t){const P=M.match(/^(.*)-transition$/);C=C.concat(P&&x[P[1]]&&x[P[1]].transition?Ct({key:M,value:t[M],valueSpec:m.transition,style:h,styleSpec:m}):x[M]?Ct({key:M,value:t[M],valueSpec:x[M],style:h,styleSpec:m}):[new Hn(M,t[M],`unknown property "${M}"`)])}if(t.source){const M=h.sources&&h.sources[t.source],P=M&&Cr(M.type);M?"raster-dem"!==P&&C.push(new Hn(l,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):C.push(new Hn(l,t.source,`source "${t.source}" not found`))}else C.push(new Hn(l,t,'terrain is missing required property "source"'));return C}function fd(o){const t=o.value,l=o.style,h=o.styleSpec,m=h.fog;let x=[];const C=Ut(t);if(void 0===t)return x;if("object"!==C)return x=x.concat([new Hn("fog",t,`object expected, ${C} found`)]),x;for(const D in t){const M=D.match(/^(.*)-transition$/);x=x.concat(M&&m[M[1]]&&m[M[1]].transition?Ct({key:D,value:t[D],valueSpec:h.transition,style:l,styleSpec:h}):m[D]?Ct({key:D,value:t[D],valueSpec:m[D],style:l,styleSpec:h}):[new Hn(D,t[D],`unknown property "${D}"`)])}return x}const Lu={"*":()=>[],array:Xc,boolean:function(o){const t=o.value,l=o.key,h=Ut(t);return"boolean"!==h?[new Hn(l,t,`boolean expected, ${h} found`)]:[]},number:ac,color:function(o){const t=o.key,l=o.value,h=Ut(l);return"string"!==h?[new Hn(t,l,`color expected, ${h} found`)]:null===Ll(l)?[new Hn(t,l,`color expected, "${l}" found`)]:[]},enum:il,filter:Va,function:Yi,layer:hd,object:Cl,source:Nl,light:Ru,terrain:Cc,fog:fd,string:Dl,formatted:function(o){return 0===Dl(o).length?[]:$r(o)},resolvedImage:function(o){return 0===Dl(o).length?[]:$r(o)},projection:function(o){const t=o.value,l=o.styleSpec,h=l.projection,m=o.style;let x=[];const C=Ut(t);if("object"===C)for(const D in t)x=x.concat(Ct({key:D,value:t[D],valueSpec:h[D],style:m,styleSpec:l}));else"string"!==C&&(x=x.concat([new Hn("projection",t,`object or string expected, ${C} found`)]));return x}};function Ct(o){const t=o.value,l=o.valueSpec,h=o.styleSpec;return l.expression&&pr(Cr(t))?Yi(o):l.expression&&ma(ai(t))?$r(o):l.type&&Lu[l.type]?Lu[l.type](o):Cl(vr({},o,{valueSpec:l.type?h[l.type]:l}))}function pd(o){const t=o.value,l=o.key,h=Dl(o);return h.length||(-1===t.indexOf("{fontstack}")&&h.push(new Hn(l,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&h.push(new Hn(l,t,'"glyphs" url must include a "{range}" token'))),h}function Fe(o,t=Et){return ca(Ct({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,objectElementValidators:{glyphs:pd,"*":()=>[]}}))}const Ah=o=>ca(cc(o)),Dh=o=>ca(gl(o));function ca(o){return o.slice().sort((t,l)=>t.line&&l.line?t.line-l.line:0)}function hn(o,t){let l=!1;if(t&&t.length)for(const h of t)o.fire(new ro(new Error(h.message))),l=!0;return l}var no=Tl,ja=3;function Tl(o,t,l){var h=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var m=new Int32Array(this.arrayBuffer);o=m[0],this.d=(t=m[1])+2*(l=m[2]);for(var x=0;x<this.d*this.d;x++){var C=m[ja+x],D=m[ja+x+1];h.push(C===D?null:m.subarray(C,D))}var M=m[ja+h.length+1];this.keys=m.subarray(m[ja+h.length],M),this.bboxes=m.subarray(M),this.insert=this._insertReadonly}else{this.d=t+2*l;for(var P=0;P<this.d*this.d;P++)h.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=o,this.padding=l,this.scale=t/o,this.uid=0;var U=l/t*o;this.min=-U,this.max=o+U}Tl.prototype.insert=function(o,t,l,h,m){this._forEachCell(t,l,h,m,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(t),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)},Tl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Tl.prototype._insertCell=function(o,t,l,h,m,x){this.cells[m].push(x)},Tl.prototype.query=function(o,t,l,h,m){var x=this.min,C=this.max;if(o<=x&&t<=x&&C<=l&&C<=h&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(o,t,l,h,this._queryCell,D,{},m),D},Tl.prototype._queryCell=function(o,t,l,h,m,x,C,D){var M=this.cells[m];if(null!==M)for(var P=this.keys,U=this.bboxes,G=0;G<M.length;G++){var Y=M[G];if(void 0===C[Y]){var ne=4*Y;(D?D(U[ne+0],U[ne+1],U[ne+2],U[ne+3]):o<=U[ne+2]&&t<=U[ne+3]&&l>=U[ne+0]&&h>=U[ne+1])?(C[Y]=!0,x.push(P[Y])):C[Y]=!1}}},Tl.prototype._forEachCell=function(o,t,l,h,m,x,C,D){for(var M=this._convertToCellCoord(o),P=this._convertToCellCoord(t),U=this._convertToCellCoord(l),G=this._convertToCellCoord(h),Y=M;Y<=U;Y++)for(var ne=P;ne<=G;ne++){var ae=this.d*ne+Y;if((!D||D(this._convertFromCellCoord(Y),this._convertFromCellCoord(ne),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ne+1)))&&m.call(this,o,t,l,h,ae,x,C,D))return}},Tl.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Tl.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Tl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,t=ja+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var m=new Int32Array(t+l+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=t,C=0;C<o.length;C++){var D=o[C];m[ja+C]=x,m.set(D,x),x+=D.length}return m[ja+o.length]=x,m.set(this.keys,x),m[ja+o.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer};var hs=jn(no);const Ac={};function Kn(o,t,l={}){Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Ac[t]={klass:o,omit:l.omit||[]}}Kn(Object,"Object"),hs.serialize=function(o,t){const l=o.toArrayBuffer();return t&&t.push(l),{buffer:l}},hs.deserialize=function(o){return new hs(o.buffer)},Object.defineProperty(hs,"name",{value:"Grid"}),Kn(hs,"Grid"),Kn(Eo,"Color"),Kn(Error,"Error"),Kn(po,"AJAXError"),Kn(Qo,"ResolvedImage"),Kn(rl,"StylePropertyFunction"),Kn(tl,"StyleExpression",{omit:["_evaluator"]}),Kn(nl,"ZoomDependentExpression"),Kn(Os,"ZoomConstantExpression"),Kn(ni,"CompoundExpression",{omit:["_evaluate"]});for(const o in j)Ac[j[o]._classRegistryKey]||Kn(j[o],`Expression${o}`);function ml(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Ma(o){return ze.ImageBitmap&&o instanceof ze.ImageBitmap}function Jl(o,t){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(ml(o)||Ma(o))return t&&t.push(o),o;if(ArrayBuffer.isView(o)){const l=o;return t&&t.push(l.buffer),l}if(o instanceof ze.ImageData)return t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const l=[];for(const h of o)l.push(Jl(h,t));return l}if("object"==typeof o){const l=o.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const m=l.serialize?l.serialize(o,t):{};if(!l.serialize){for(const x in o)o.hasOwnProperty(x)&&(Ac[h].omit.indexOf(x)>=0||(m[x]=Jl(o[x],t)));o instanceof Error&&(m.message=o.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(m.$name=h),m}throw new Error("can't serialize object of type "+typeof o)}function co(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||ml(o)||Ma(o)||ArrayBuffer.isView(o)||o instanceof ze.ImageData)return o;if(Array.isArray(o))return o.map(co);if("object"==typeof o){const t=o.$name||"Object",{klass:l}=Ac[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(o);const h=Object.create(l.prototype);for(const m of Object.keys(o))"$name"!==m&&(h[m]=co(o[m]));return h}throw new Error("can't deserialize object of type "+typeof o)}const $n={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function fu(o){for(const t of o)if(pu(t.charCodeAt(0)))return!0;return!1}function Ha(o){for(const t of o)if(!kl(t.charCodeAt(0)))return!1;return!0}function kl(o){return!($n.Arabic(o)||$n["Arabic Supplement"](o)||$n["Arabic Extended-A"](o)||$n["Arabic Presentation Forms-A"](o)||$n["Arabic Presentation Forms-B"](o))}function pu(o){return!(746!==o&&747!==o&&(o<4352||!($n["Bopomofo Extended"](o)||$n.Bopomofo(o)||$n["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||$n["CJK Compatibility Ideographs"](o)||$n["CJK Compatibility"](o)||$n["CJK Radicals Supplement"](o)||$n["CJK Strokes"](o)||!(!$n["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||$n["CJK Unified Ideographs Extension A"](o)||$n["CJK Unified Ideographs"](o)||$n["Enclosed CJK Letters and Months"](o)||$n["Hangul Compatibility Jamo"](o)||$n["Hangul Jamo Extended-A"](o)||$n["Hangul Jamo Extended-B"](o)||$n["Hangul Jamo"](o)||$n["Hangul Syllables"](o)||$n.Hiragana(o)||$n["Ideographic Description Characters"](o)||$n.Kanbun(o)||$n["Kangxi Radicals"](o)||$n["Katakana Phonetic Extensions"](o)||$n.Katakana(o)&&12540!==o||!(!$n["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!$n["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||$n["Unified Canadian Aboriginal Syllabics"](o)||$n["Unified Canadian Aboriginal Syllabics Extended"](o)||$n["Vertical Forms"](o)||$n["Yijing Hexagram Symbols"](o)||$n["Yi Syllables"](o)||$n["Yi Radicals"](o))))}function Dc(o){return!(pu(o)||(t=o,$n["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||$n["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||$n["Letterlike Symbols"](t)||$n["Number Forms"](t)||$n["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||$n["Control Pictures"](t)&&9251!==t||$n["Optical Character Recognition"](t)||$n["Enclosed Alphanumerics"](t)||$n["Geometric Shapes"](t)||$n["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||$n["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||$n["CJK Symbols and Punctuation"](t)||$n.Katakana(t)||$n["Private Use Area"](t)||$n["CJK Compatibility Forms"](t)||$n["Small Form Variants"](t)||$n["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Gl(o){return o>=1424&&o<=2303||$n["Arabic Presentation Forms-A"](o)||$n["Arabic Presentation Forms-B"](o)}function Th(o,t){return!(!t&&Gl(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||$n.Khmer(o))}function B(o){for(const t of o)if(Gl(t.charCodeAt(0)))return!0;return!1}const $="deferred",F="loading",q="loaded";let se=null,_="unavailable",i=null;const g=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(_="error"),se&&se(o)};function y(){A.fire(new Vi("pluginStateChange",{pluginStatus:_,pluginURL:i}))}const A=new yi,T=function(){return _},N=function(){if(_!==$||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=F,y(),i&&nr({url:i},o=>{o?g(o):(_=q,y())})},k={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===q||null!=k.applyArabicShaping,isLoading:()=>_===F,setState(o){_=o.pluginStatus,i=o.pluginURL},isParsed:()=>null!=k.applyArabicShaping&&null!=k.processBidirectionalText&&null!=k.processStyledBidirectionalText,getPluginURL:()=>i};class H{constructor(t,l){this.zoom=t,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(l,h){for(const m of l)if(!Th(m.charCodeAt(0),h))return!1;return!0}(t,k.isLoaded())}}class Q{constructor(t,l){this.property=t,this.value=l,this.expression=function(h,m){if(pr(h))return new rl(h,m);if(ma(h)){const x=Ia(h,m);if("error"===x.result)throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));return x.value}{let x=h;return"string"==typeof h&&"color"===m.type&&(x=Eo.parse(h)),{kind:"constant",evaluate:()=>x}}}(void 0===l?t.specification.default:l,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,l,h){return this.property.possiblyEvaluate(this,t,l,h)}}class J{constructor(t){this.property=t,this.value=new Q(t,void 0)}transitioned(t,l){return new ye(this.property,this.value,l,At({},t.transition,this.transition),t.now)}untransitioned(){return new ye(this.property,this.value,null,{},0)}}class de{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return nn(this._values[t].value.value)}setValue(t,l){this._values.hasOwnProperty(t)||(this._values[t]=new J(this._values[t].property)),this._values[t].value=new Q(this._values[t].property,null===l?void 0:nn(l))}getTransition(t){return nn(this._values[t].transition)}setTransition(t,l){this._values.hasOwnProperty(t)||(this._values[t]=new J(this._values[t].property)),this._values[t].transition=nn(l)||void 0}serialize(){const t={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(t[l]=h);const m=this.getTransition(l);void 0!==m&&(t[`${l}-transition`]=m)}return t}transitioned(t,l){const h=new Ae(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(t,l._values[m]);return h}untransitioned(){const t=new Ae(this._properties);for(const l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class ye{constructor(t,l,h,m,x){const C=m.delay||0,D=m.duration||0;x=x||0,this.property=t,this.value=l,this.begin=x+C,this.end=this.begin+D,t.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(t,l,h){const m=t.now||0,x=this.value.possiblyEvaluate(t,l,h),C=this.prior;if(C){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return C.possiblyEvaluate(t,l,h);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(t,l,h),x,kn(D))}}return x}}class Ae{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,h){const m=new Me(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].possiblyEvaluate(t,l,h);return m}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class we{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return nn(this._values[t].value)}setValue(t,l){this._values[t]=new Q(this._values[t].property,null===l?void 0:nn(l))}serialize(){const t={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(t[l]=h)}return t}possiblyEvaluate(t,l,h){const m=new Me(this._properties);for(const x of Object.keys(this._values))m._values[x]=this._values[x].possiblyEvaluate(t,l,h);return m}}class Se{constructor(t,l,h){this.property=t,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,l,h,m){return this.property.evaluate(this.value,this.parameters,t,l,h,m)}}class Me{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class he{constructor(t){this.specification=t}possiblyEvaluate(t,l){return t.expression.evaluate(l)}interpolate(t,l,h){const m=ie[this.specification.type];return m?m(t,l,h):t}}class Te{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,h,m){return new Se(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(l,null,{},h,m)}:t.expression,l)}interpolate(t,l,h){if("constant"!==t.value.kind||"constant"!==l.value.kind)return t;if(void 0===t.value.value||void 0===l.value.value)return new Se(this,{kind:"constant",value:void 0},t.parameters);const m=ie[this.specification.type];return m?new Se(this,{kind:"constant",value:m(t.value.value,l.value.value,h)},t.parameters):t}evaluate(t,l,h,m,x,C){return"constant"===t.kind?t.value:t.evaluate(l,h,m,x,C)}}class Be{constructor(t){this.specification=t}possiblyEvaluate(t,l,h,m){return!!t.expression.evaluate(l,null,{},h,m)}interpolate(){return!1}}class Ve{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new H(0,{});for(const h in t){const m=t[h];m.specification.overridable&&this.overridableProperties.push(h);const x=this.defaultPropertyValues[h]=new Q(m,void 0),C=this.defaultTransitionablePropertyValues[h]=new J(m);this.defaultTransitioningPropertyValues[h]=C.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=x.possiblyEvaluate(l)}}}function tt(o,t){return 256*(o=xr(Math.floor(o),0,255))+xr(Math.floor(t),0,255)}Kn(Te,"DataDrivenProperty"),Kn(he,"DataConstantProperty"),Kn(Be,"ColorRampProperty");const Qe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nt{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function pt(o,t=1){let l=0,h=0;return{members:o.map(m=>{const x=Qe[m.type].BYTES_PER_ELEMENT,C=l=Lt(l,Math.max(t,x)),D=m.components||1;return h=Math.max(h,x),l+=x*D,{name:m.name,type:m.type,components:D,offset:C}}),size:Lt(l,Math.max(h,t)),alignment:t}}function Lt(o,t){return Math.ceil(o/t)*t}class En extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const m=2*t;return this.int16[m+0]=l,this.int16[m+1]=h,t}}En.prototype.bytesPerElement=4,Kn(En,"StructArrayLayout2i4");class Ot extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,l,h)}emplace(t,l,h,m){const x=3*t;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=m,t}}Ot.prototype.bytesPerElement=6,Kn(Ot,"StructArrayLayout3i6");class sn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,m)}emplace(t,l,h,m,x){const C=4*t;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=m,this.int16[C+3]=x,t}}sn.prototype.bytesPerElement=8,Kn(sn,"StructArrayLayout4i8");class jt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D){const M=this.length;return this.resize(M+1),this.emplace(M,t,l,h,m,x,C,D)}emplace(t,l,h,m,x,C,D,M){const P=6*t,U=12*t,G=3*t;return this.int16[P+0]=l,this.int16[P+1]=h,this.uint8[U+4]=m,this.uint8[U+5]=x,this.uint8[U+6]=C,this.uint8[U+7]=D,this.float32[G+2]=M,t}}jt.prototype.bytesPerElement=12,Kn(jt,"StructArrayLayout2i4ub1f12");class yn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,m)}emplace(t,l,h,m,x){const C=4*t;return this.float32[C+0]=l,this.float32[C+1]=h,this.float32[C+2]=m,this.float32[C+3]=x,t}}yn.prototype.bytesPerElement=16,Kn(yn,"StructArrayLayout4f16");class It extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,l,h,m,x)}emplace(t,l,h,m,x,C){const D=6*t,M=3*t;return this.uint16[D+0]=l,this.uint16[D+1]=h,this.uint16[D+2]=m,this.uint16[D+3]=x,this.float32[M+2]=C,t}}It.prototype.bytesPerElement=12,Kn(It,"StructArrayLayout4ui1f12");class on extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,m)}emplace(t,l,h,m,x){const C=4*t;return this.uint16[C+0]=l,this.uint16[C+1]=h,this.uint16[C+2]=m,this.uint16[C+3]=x,t}}on.prototype.bytesPerElement=8,Kn(on,"StructArrayLayout4ui8");class Cn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C){const D=this.length;return this.resize(D+1),this.emplace(D,t,l,h,m,x,C)}emplace(t,l,h,m,x,C,D){const M=6*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=m,this.int16[M+3]=x,this.int16[M+4]=C,this.int16[M+5]=D,t}}Cn.prototype.bytesPerElement=12,Kn(Cn,"StructArrayLayout6i12");class gn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D,M,P,U,G,Y){const ne=this.length;return this.resize(ne+1),this.emplace(ne,t,l,h,m,x,C,D,M,P,U,G,Y)}emplace(t,l,h,m,x,C,D,M,P,U,G,Y,ne){const ae=12*t;return this.int16[ae+0]=l,this.int16[ae+1]=h,this.int16[ae+2]=m,this.int16[ae+3]=x,this.uint16[ae+4]=C,this.uint16[ae+5]=D,this.uint16[ae+6]=M,this.uint16[ae+7]=P,this.int16[ae+8]=U,this.int16[ae+9]=G,this.int16[ae+10]=Y,this.int16[ae+11]=ne,t}}gn.prototype.bytesPerElement=24,Kn(gn,"StructArrayLayout4i4ui4i24");class An extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C){const D=this.length;return this.resize(D+1),this.emplace(D,t,l,h,m,x,C)}emplace(t,l,h,m,x,C,D){const M=10*t,P=5*t;return this.int16[M+0]=l,this.int16[M+1]=h,this.int16[M+2]=m,this.float32[P+2]=x,this.float32[P+3]=C,this.float32[P+4]=D,t}}An.prototype.bytesPerElement=20,Kn(An,"StructArrayLayout3i3f20");class Er extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}Er.prototype.bytesPerElement=4,Kn(Er,"StructArrayLayout1ul4");class Kr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D,M,P,U,G,Y,ne){const ae=this.length;return this.resize(ae+1),this.emplace(ae,t,l,h,m,x,C,D,M,P,U,G,Y,ne)}emplace(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae){const pe=20*t,Ee=10*t;return this.int16[pe+0]=l,this.int16[pe+1]=h,this.int16[pe+2]=m,this.int16[pe+3]=x,this.int16[pe+4]=C,this.float32[Ee+3]=D,this.float32[Ee+4]=M,this.float32[Ee+5]=P,this.float32[Ee+6]=U,this.int16[pe+14]=G,this.uint32[Ee+8]=Y,this.uint16[pe+18]=ne,this.uint16[pe+19]=ae,t}}Kr.prototype.bytesPerElement=40,Kn(Kr,"StructArrayLayout5i4f1i1ul2ui40");class sr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D){const M=this.length;return this.resize(M+1),this.emplace(M,t,l,h,m,x,C,D)}emplace(t,l,h,m,x,C,D,M){const P=8*t;return this.int16[P+0]=l,this.int16[P+1]=h,this.int16[P+2]=m,this.int16[P+4]=x,this.int16[P+5]=C,this.int16[P+6]=D,this.int16[P+7]=M,t}}sr.prototype.bytesPerElement=16,Kn(sr,"StructArrayLayout3i2i2i16");class Nr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,l,h,m,x)}emplace(t,l,h,m,x,C){const D=4*t,M=8*t;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=m,this.int16[M+6]=x,this.int16[M+7]=C,t}}Nr.prototype.bytesPerElement=16,Kn(Nr,"StructArrayLayout2f1f2i16");class _i extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,m)}emplace(t,l,h,m,x){const C=12*t,D=3*t;return this.uint8[C+0]=l,this.uint8[C+1]=h,this.float32[D+1]=m,this.float32[D+2]=x,t}}_i.prototype.bytesPerElement=12,Kn(_i,"StructArrayLayout2ub2f12");class oi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,l,h)}emplace(t,l,h,m){const x=3*t;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=m,t}}oi.prototype.bytesPerElement=12,Kn(oi,"StructArrayLayout3f12");class dr extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,t,l,h)}emplace(t,l,h,m){const x=3*t;return this.uint16[x+0]=l,this.uint16[x+1]=h,this.uint16[x+2]=m,t}}dr.prototype.bytesPerElement=6,Kn(dr,"StructArrayLayout3ui6");class Gi extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et)}emplace(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et,Xe){const Ft=30*t,Rt=15*t,tn=60*t;return this.int16[Ft+0]=l,this.int16[Ft+1]=h,this.int16[Ft+2]=m,this.float32[Rt+2]=x,this.float32[Rt+3]=C,this.uint16[Ft+8]=D,this.uint16[Ft+9]=M,this.uint32[Rt+5]=P,this.uint32[Rt+6]=U,this.uint32[Rt+7]=G,this.uint16[Ft+16]=Y,this.uint16[Ft+17]=ne,this.uint16[Ft+18]=ae,this.float32[Rt+10]=pe,this.float32[Rt+11]=Ee,this.uint8[tn+48]=Pe,this.uint8[tn+49]=We,this.uint8[tn+50]=Le,this.uint32[Rt+13]=$e,this.int16[Ft+28]=et,this.uint8[tn+58]=Xe,t}}Gi.prototype.bytesPerElement=60,Kn(Gi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class oo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn,bn){const Pn=this.length;return this.resize(Pn+1),this.emplace(Pn,t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn,bn)}emplace(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee,Pe,We,Le,$e,et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn,bn,Pn){const Jt=38*t,qn=19*t;return this.int16[Jt+0]=l,this.int16[Jt+1]=h,this.int16[Jt+2]=m,this.float32[qn+2]=x,this.float32[qn+3]=C,this.int16[Jt+8]=D,this.int16[Jt+9]=M,this.int16[Jt+10]=P,this.int16[Jt+11]=U,this.int16[Jt+12]=G,this.int16[Jt+13]=Y,this.uint16[Jt+14]=ne,this.uint16[Jt+15]=ae,this.uint16[Jt+16]=pe,this.uint16[Jt+17]=Ee,this.uint16[Jt+18]=Pe,this.uint16[Jt+19]=We,this.uint16[Jt+20]=Le,this.uint16[Jt+21]=$e,this.uint16[Jt+22]=et,this.uint16[Jt+23]=Xe,this.uint16[Jt+24]=Ft,this.uint16[Jt+25]=Rt,this.uint16[Jt+26]=tn,this.uint16[Jt+27]=Dn,this.uint16[Jt+28]=Ht,this.uint32[qn+15]=cn,this.float32[qn+16]=fn,this.float32[qn+17]=bn,this.float32[qn+18]=Pn,t}}oo.prototype.bytesPerElement=76,Kn(oo,"StructArrayLayout3i2f6i15ui1ul3f76");class uo extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}uo.prototype.bytesPerElement=4,Kn(uo,"StructArrayLayout1f4");class To extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,h,m,x){const C=this.length;return this.resize(C+1),this.emplace(C,t,l,h,m,x)}emplace(t,l,h,m,x,C){const D=5*t;return this.float32[D+0]=l,this.float32[D+1]=h,this.float32[D+2]=m,this.float32[D+3]=x,this.float32[D+4]=C,t}}To.prototype.bytesPerElement=20,Kn(To,"StructArrayLayout5f20");class Oa extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,h,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,l,h,m)}emplace(t,l,h,m,x){const C=6*t;return this.uint32[3*t+0]=l,this.uint16[C+2]=h,this.uint16[C+3]=m,this.uint16[C+4]=x,t}}Oa.prototype.bytesPerElement=12,Kn(Oa,"StructArrayLayout1ul3ui12");class ua extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const m=2*t;return this.uint16[m+0]=l,this.uint16[m+1]=h,t}}ua.prototype.bytesPerElement=4,Kn(ua,"StructArrayLayout2ui4");class Fl extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}Fl.prototype.bytesPerElement=2,Kn(Fl,"StructArrayLayout1ui2");class da extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,l)}emplace(t,l,h){const m=2*t;return this.float32[m+0]=l,this.float32[m+1]=h,t}}da.prototype.bytesPerElement=8,Kn(da,"StructArrayLayout2f8");class rs extends nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}rs.prototype.size=40;class ho extends Kr{get(t){return new rs(this,t)}}Kn(ho,"CollisionBoxArray");class $i extends nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}$i.prototype.size=60;class Ps extends Gi{get(t){return new $i(this,t)}}Kn(Ps,"PlacedSymbolArray");class va extends nt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}va.prototype.size=76;class Po extends oo{get(t){return new va(this,t)}}Kn(Po,"SymbolInstanceArray");class ol extends uo{getoffsetX(t){return this.float32[1*t+0]}}Kn(ol,"GlyphOffsetArray");class Nu extends En{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Kn(Nu,"SymbolLineVertexArray");class Tc extends nt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Tc.prototype.size=12;class gu extends Oa{get(t){return new Tc(this,t)}}Kn(gu,"FeatureIndexArray");class Ql extends ua{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Kn(Ql,"FillExtrusionCentroidArray");const Sc=pt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ec=pt([{name:"a_dash",components:4,type:"Uint16"}]);var tc={exports:{}},md=function(o,t){var l,h,m,x,C,D,M,P;for(h=o.length-(l=3&o.length),m=t,C=3432918353,D=461845907,P=0;P<h;)M=255&o.charCodeAt(P)|(255&o.charCodeAt(++P))<<8|(255&o.charCodeAt(++P))<<16|(255&o.charCodeAt(++P))<<24,++P,m=27492+(65535&(x=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&o.charCodeAt(P+2))<<16;case 2:M^=(255&o.charCodeAt(P+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&o.charCodeAt(P)))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295}return m^=o.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},fs=function(o,t){for(var l,h=o.length,m=t^h,x=0;h>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(x)|(255&o.charCodeAt(++x))<<8|(255&o.charCodeAt(++x))<<16|(255&o.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:m^=(255&o.charCodeAt(x+2))<<16;case 2:m^=(255&o.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&o.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};tc.exports=md,tc.exports.murmur3=md,tc.exports.murmur2=fs;var Ga=jn(tc.exports);class Fu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,h,m){this.ids.push(Ic(t)),this.positions.push(l,h,m)}getPositions(t){const l=Ic(t);let h=0,m=this.ids.length-1;for(;h<m;){const C=h+m>>1;this.ids[C]>=l?m=C:h=C+1}const x=[];for(;this.ids[h]===l;)x.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return x}static serialize(t,l){const h=new Float64Array(t.ids),m=new Uint32Array(t.positions);return jd(h,m,0,h.length-1),l&&l.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(t){const l=new Fu;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function Ic(o){const t=+o;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ga(String(o))}function jd(o,t,l,h){for(;l<h;){const m=o[l+h>>1];let x=l-1,C=h+1;for(;;){do{x++}while(o[x]<m);do{C--}while(o[C]>m);if(x>=C)break;Sh(o,x,C),Sh(t,3*x,3*C),Sh(t,3*x+1,3*C+1),Sh(t,3*x+2,3*C+2)}C-l<h-C?(jd(o,t,l,C),l=C+1):(jd(o,t,C+1,h),h=C)}}function Sh(o,t,l){const h=o[t];o[t]=o[l],o[l]=h}Kn(Fu,"FeaturePositionMap");class Mc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,l),this.initialized=!0),!!this.location}}class Oc extends Mc{constructor(t){super(t),this.current=0}set(t,l,h){this.fetchUniformLocation(t,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Bu extends Mc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,l,h){this.fetchUniformLocation(t,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class zu extends Mc{constructor(t){super(t),this.current=Eo.transparent}set(t,l,h){this.fetchUniformLocation(t,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const _d=new Float32Array(16),ap=new Float32Array(9),vd=new Float32Array(4);function mu(o){return[tt(255*o.r,255*o.g),tt(255*o.b,255*o.a)]}class Ih{constructor(t,l,h){this.value=t,this.uniformNames=l.map(m=>`u_${m}`),this.type=h}setUniform(t,l,h,m,x){l.set(t,x,m.constantOr(this.value))}getBinding(t,l){return"color"===this.type?new zu(t):new Oc(t)}}class Uu{constructor(t,l){this.uniformNames=l.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,l,h,m,x){const C="u_pattern"===x||"u_dash"===x?this.pattern:"u_pixel_ratio"===x?this.pixelRatio:null;C&&l.set(t,x,C)}getBinding(t,l){return"u_pattern"===l||"u_dash"===l?new Bu(t):new Oc(t)}}class Jc{constructor(t,l,h,m){this.expression=t,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,l,h,m,x,C){const D=this.paintVertexArray.length,M=this.expression.evaluate(new H(0),l,{},x,m,C);this.paintVertexArray.resize(t),this._setPaintValue(D,t,M)}updatePaintArray(t,l,h,m,x){const C=this.expression.evaluate({zoom:0},h,m,void 0,x);this._setPaintValue(t,l,C)}_setPaintValue(t,l,h){if("color"===this.type){const m=mu(h);for(let x=t;x<l;x++)this.paintVertexArray.emplace(x,m[0],m[1])}else{for(let m=t;m<l;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pc{constructor(t,l,h,m,x,C){this.expression=t,this.uniformNames=l.map(D=>`u_${D}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(t,l,h,m,x,C){const D=this.expression.evaluate(new H(this.zoom),l,{},x,m,C),M=this.expression.evaluate(new H(this.zoom+1),l,{},x,m,C),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,D,M)}updatePaintArray(t,l,h,m,x){const C=this.expression.evaluate({zoom:this.zoom},h,m,void 0,x),D=this.expression.evaluate({zoom:this.zoom+1},h,m,void 0,x);this._setPaintValue(t,l,C,D)}_setPaintValue(t,l,h,m){if("color"===this.type){const x=mu(h),C=mu(m);for(let D=t;D<l;D++)this.paintVertexArray.emplace(D,x[0],x[1],C[0],C[1])}else{for(let x=t;x<l;x++)this.paintVertexArray.emplace(x,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l,h,m,x){const C=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,D=xr(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);l.set(t,x,D)}getBinding(t,l){return new Oc(t)}}class _u{constructor(t,l,h,m,x){this.expression=t,this.layerId=x,this.paintVertexAttributes=("array"===h?ec:Sc).members;for(let C=0;C<l.length;++C);this.paintVertexArray=new m}populatePaintArray(t,l,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(m,t,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(t,l,h,m,x,C){this._setPaintValues(t,l,h.patterns&&h.patterns[this.layerId],C)}_setPaintValues(t,l,h,m){if(!m||!h)return;const x=m[h];if(!x)return;const{tl:C,br:D,pixelRatio:M}=x;for(let P=t;P<l;P++)this.paintVertexArray.emplace(P,C[0],C[1],D[0],D[1],M)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vu{constructor(t,l,h=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const x in t.paint._values){if(!h(x))continue;const C=t.paint.get(x);if(!(C instanceof Se&&fe(C.property.specification)))continue;const D=Gd(x,t.type),M=C.value,P=C.property.specification.type,U=!!C.property.useIntegerZoom,G="line-dasharray"===x||x.endsWith("pattern"),Y="line-dasharray"===x&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==M.kind||Y)if("source"===M.kind||Y||G){const ne=ha(x,P,"source");this.binders[x]=G?new _u(M,D,P,ne,t.id):new Jc(M,D,P,ne),m.push(`/a_${x}`)}else{const ne=ha(x,P,"composite");this.binders[x]=new Pc(M,D,P,U,l,ne),m.push(`/z_${x}`)}else this.binders[x]=G?new Uu(M.value,D):new Ih(M.value,D,P),m.push(`/u_${x}`)}this.cacheKey=m.sort().join("")}getMaxValue(t){const l=this.binders[t];return l instanceof Jc||l instanceof Pc?l.maxValue:0}populatePaintArrays(t,l,h,m,x,C){for(const D in this.binders){const M=this.binders[D];(M instanceof Jc||M instanceof Pc||M instanceof _u)&&M.populatePaintArray(t,l,h,m,x,C)}}setConstantPatternPositions(t){for(const l in this.binders){const h=this.binders[l];h instanceof Uu&&h.setConstantPatternPositions(t)}}updatePaintArrays(t,l,h,m,x,C){let D=!1;for(const M in t){const P=l.getPositions(M);for(const U of P){const G=h.feature(U.index);for(const Y in this.binders){const ne=this.binders[Y];if((ne instanceof Jc||ne instanceof Pc||ne instanceof _u)&&!0===ne.expression.isStateDependent){const ae=m.paint.get(Y);ne.expression=ae.value,ne.updatePaintArray(U.start,U.end,G,t[M],x,C),D=!0}}}}return D}defines(){const t=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Ih||h instanceof Uu)&&t.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return t}getBinderAttributes(){const t=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Jc||h instanceof Pc||h instanceof _u)for(let m=0;m<h.paintVertexAttributes.length;m++)t.push(h.paintVertexAttributes[m].name)}return t}getBinderUniforms(){const t=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Ih||h instanceof Uu||h instanceof Pc)for(const m of h.uniformNames)t.push(m)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ih||m instanceof Uu||m instanceof Pc)for(const x of m.uniformNames)l.push({name:x,property:h,binding:m.getBinding(t,x)})}return l}setUniforms(t,l,h,m,x){for(const{name:C,property:D,binding:M}of h)this.binders[D].setUniform(t,M,x,m.get(D),C)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const l=this.binders[t];(l instanceof Jc||l instanceof Pc||l instanceof _u)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const l in this.binders){const h=this.binders[l];(h instanceof Jc||h instanceof Pc||h instanceof _u)&&h.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const l=this.binders[t];(l instanceof Jc||l instanceof Pc||l instanceof _u)&&l.destroy()}}}class Hd{constructor(t,l,h=(()=>!0)){this.programConfigurations={};for(const m of t)this.programConfigurations[m.id]=new Vu(m,l,h);this.needsUpload=!1,this._featureMap=new Fu,this._bufferOffset=0}populatePaintArrays(t,l,h,m,x,C,D){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(t,l,m,x,C,D);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,h,m,x){for(const C of h)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(t,this._featureMap,l,C,m,x)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const km={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Gd(o,t){return km[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}const _g={"line-pattern":{source:It,composite:It},"fill-pattern":{source:It,composite:It},"fill-extrusion-pattern":{source:It,composite:It},"line-dasharray":{source:on,composite:on}},Fm={color:{source:da,composite:yn},number:{source:uo,composite:da}};function ha(o,t,l){const h=_g[o];return h&&h[l]||Fm[t][l]}Kn(Ih,"ConstantBinder"),Kn(Uu,"PatternConstantBinder"),Kn(Jc,"SourceExpressionBinder"),Kn(_u,"PatternCompositeBinder"),Kn(Pc,"CompositeExpressionBinder"),Kn(Vu,"ProgramConfiguration",{omit:["_buffers"]}),Kn(Hd,"ProgramConfigurationSet");const Ki="-transition";class Sl extends yi{constructor(t,l){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),l.layout&&(this._unevaluatedLayout=new we(l.layout)),l.paint)){this._transitionablePaint=new de(l.paint);for(const h in t.paint)this.setPaintProperty(h,t.paint[h],{validate:!1});for(const h in t.layout)this.setLayoutProperty(h,t.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Me(l.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,l,h={}){null!=l&&this._validate(Dh,`layers.${this.id}.layout.${t}`,t,l,h)||("visibility"!==t?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return Qn(t,Ki)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,h={}){if(null!=l&&this._validate(Ah,`layers.${this.id}.paint.${t}`,t,l,h))return!1;if(Qn(t,Ki))return this._transitionablePaint.setTransition(t.slice(0,-11),l||void 0),!1;{const m=this._transitionablePaint._values[t],x=m.value.isDataDriven(),C=m.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);const D=this._transitionablePaint._values[t].value,M=D.isDataDriven(),P=Qn(t,"pattern")||"line-dasharray"===t;return M||x||P||this._handleOverridablePaintPropertyUpdate(t,C,D)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,l,h){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ir(t,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(t,l,h,m,x={}){return(!x||!1!==x.validate)&&hn(this,t.call(Fe,{key:l,layerType:this.type,objectKey:h,value:m,styleSpec:Et,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const l=this.paint.get(t);if(l instanceof Se&&fe(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const lp=pt([{name:"a_pos",components:2,type:"Int16"}],4),nc=pt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class So{constructor(t=[]){this.segments=t}prepareSegment(t,l,h,m){let x=this.segments[this.segments.length-1];return t>So.MAX_VERTEX_ARRAY_LENGTH&&Gn(`Max vertices per segment is ${So.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!x||x.vertexLength+t>So.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==m&&(x.sortKey=m),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const t of this.segments)for(const l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,h,m){return new So([{vertexOffset:t,primitiveOffset:l,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}So.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Kn(So,"SegmentVector");var Tr=8192;class uc{constructor(t,l){t&&(l?this.setSouthWest(t).setNorthEast(l):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof yo?new yo(t.lng,t.lat):yo.convert(t),this}setSouthWest(t){return this._sw=t instanceof yo?new yo(t.lng,t.lat):yo.convert(t),this}extend(t){const l=this._sw,h=this._ne;let m,x;if(t instanceof yo)m=t,x=t;else{if(!(t instanceof uc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(uc.convert(t)):this.extend(yo.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(yo.convert(t)):this;if(m=t._sw,x=t._ne,!m||!x)return this}return l||h?(l.lng=Math.min(m.lng,l.lng),l.lat=Math.min(m.lat,l.lat),h.lng=Math.max(x.lng,h.lng),h.lat=Math.max(x.lat,h.lat)):(this._sw=new yo(m.lng,m.lat),this._ne=new yo(x.lng,x.lat)),this}getCenter(){return new yo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yo(this.getWest(),this.getNorth())}getSouthEast(){return new yo(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:l,lat:h}=yo.convert(t);let m=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(t){return!t||t instanceof uc?t:new uc(t)}}var Qc=1e-6,Bl=typeof Float32Array<"u"?Float32Array:Array;function yf(){var o=new Bl(9);return Bl!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function cp(o,t,l){var h=t[0],m=t[1],x=t[2],C=t[3],D=t[4],M=t[5],P=t[6],U=t[7],G=t[8],Y=l[0],ne=l[1],ae=l[2],pe=l[3],Ee=l[4],Pe=l[5],We=l[6],Le=l[7],$e=l[8];return o[0]=Y*h+ne*C+ae*P,o[1]=Y*m+ne*D+ae*U,o[2]=Y*x+ne*M+ae*G,o[3]=pe*h+Ee*C+Pe*P,o[4]=pe*m+Ee*D+Pe*U,o[5]=pe*x+Ee*M+Pe*G,o[6]=We*h+Le*C+$e*P,o[7]=We*m+Le*D+$e*U,o[8]=We*x+Le*M+$e*G,o}function Rc(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Wi(o,t){var l=t[0],h=t[1],m=t[2],x=t[3],C=t[4],D=t[5],M=t[6],P=t[7],U=t[8],G=t[9],Y=t[10],ne=t[11],ae=t[12],pe=t[13],Ee=t[14],Pe=t[15],We=l*D-h*C,Le=l*M-m*C,$e=l*P-x*C,et=h*M-m*D,Xe=h*P-x*D,Ft=m*P-x*M,Rt=U*pe-G*ae,tn=U*Ee-Y*ae,Dn=U*Pe-ne*ae,Ht=G*Ee-Y*pe,cn=G*Pe-ne*pe,fn=Y*Pe-ne*Ee,bn=We*fn-Le*cn+$e*Ht+et*Dn-Xe*tn+Ft*Rt;return bn?(o[0]=(D*fn-M*cn+P*Ht)*(bn=1/bn),o[1]=(m*cn-h*fn-x*Ht)*bn,o[2]=(pe*Ft-Ee*Xe+Pe*et)*bn,o[3]=(Y*Xe-G*Ft-ne*et)*bn,o[4]=(M*Dn-C*fn-P*tn)*bn,o[5]=(l*fn-m*Dn+x*tn)*bn,o[6]=(Ee*$e-ae*Ft-Pe*Le)*bn,o[7]=(U*Ft-Y*$e+ne*Le)*bn,o[8]=(C*cn-D*Dn+P*Rt)*bn,o[9]=(h*Dn-l*cn-x*Rt)*bn,o[10]=(ae*Xe-pe*$e+Pe*We)*bn,o[11]=(G*$e-U*Xe-ne*We)*bn,o[12]=(D*tn-C*Ht-M*Rt)*bn,o[13]=(l*Ht-h*tn+m*Rt)*bn,o[14]=(pe*Le-ae*et-Ee*We)*bn,o[15]=(U*et-G*Le+Y*We)*bn,o):null}function eu(o,t,l){var h=t[0],m=t[1],x=t[2],C=t[3],D=t[4],M=t[5],P=t[6],U=t[7],G=t[8],Y=t[9],ne=t[10],ae=t[11],pe=t[12],Ee=t[13],Pe=t[14],We=t[15],Le=l[0],$e=l[1],et=l[2],Xe=l[3];return o[0]=Le*h+$e*D+et*G+Xe*pe,o[1]=Le*m+$e*M+et*Y+Xe*Ee,o[2]=Le*x+$e*P+et*ne+Xe*Pe,o[3]=Le*C+$e*U+et*ae+Xe*We,o[4]=(Le=l[4])*h+($e=l[5])*D+(et=l[6])*G+(Xe=l[7])*pe,o[5]=Le*m+$e*M+et*Y+Xe*Ee,o[6]=Le*x+$e*P+et*ne+Xe*Pe,o[7]=Le*C+$e*U+et*ae+Xe*We,o[8]=(Le=l[8])*h+($e=l[9])*D+(et=l[10])*G+(Xe=l[11])*pe,o[9]=Le*m+$e*M+et*Y+Xe*Ee,o[10]=Le*x+$e*P+et*ne+Xe*Pe,o[11]=Le*C+$e*U+et*ae+Xe*We,o[12]=(Le=l[12])*h+($e=l[13])*D+(et=l[14])*G+(Xe=l[15])*pe,o[13]=Le*m+$e*M+et*Y+Xe*Ee,o[14]=Le*x+$e*P+et*ne+Xe*Pe,o[15]=Le*C+$e*U+et*ae+Xe*We,o}function dc(o,t,l){var h,m,x,C,D,M,P,U,G,Y,ne,ae,pe=l[0],Ee=l[1],Pe=l[2];return t===o?(o[12]=t[0]*pe+t[4]*Ee+t[8]*Pe+t[12],o[13]=t[1]*pe+t[5]*Ee+t[9]*Pe+t[13],o[14]=t[2]*pe+t[6]*Ee+t[10]*Pe+t[14],o[15]=t[3]*pe+t[7]*Ee+t[11]*Pe+t[15]):(m=t[1],x=t[2],C=t[3],D=t[4],M=t[5],P=t[6],U=t[7],G=t[8],Y=t[9],ne=t[10],ae=t[11],o[0]=h=t[0],o[1]=m,o[2]=x,o[3]=C,o[4]=D,o[5]=M,o[6]=P,o[7]=U,o[8]=G,o[9]=Y,o[10]=ne,o[11]=ae,o[12]=h*pe+D*Ee+G*Pe+t[12],o[13]=m*pe+M*Ee+Y*Pe+t[13],o[14]=x*pe+P*Ee+ne*Pe+t[14],o[15]=C*pe+U*Ee+ae*Pe+t[15]),o}function yd(o,t,l){var h=l[0],m=l[1],x=l[2];return o[0]=t[0]*h,o[1]=t[1]*h,o[2]=t[2]*h,o[3]=t[3]*h,o[4]=t[4]*m,o[5]=t[5]*m,o[6]=t[6]*m,o[7]=t[7]*m,o[8]=t[8]*x,o[9]=t[9]*x,o[10]=t[10]*x,o[11]=t[11]*x,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function Mh(o,t,l){var h=Math.sin(l),m=Math.cos(l),x=t[4],C=t[5],D=t[6],M=t[7],P=t[8],U=t[9],G=t[10],Y=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=x*m+P*h,o[5]=C*m+U*h,o[6]=D*m+G*h,o[7]=M*m+Y*h,o[8]=P*m-x*h,o[9]=U*m-C*h,o[10]=G*m-D*h,o[11]=Y*m-M*h,o}function $d(o,t,l){var h=Math.sin(l),m=Math.cos(l),x=t[0],C=t[1],D=t[2],M=t[3],P=t[8],U=t[9],G=t[10],Y=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=x*m-P*h,o[1]=C*m-U*h,o[2]=D*m-G*h,o[3]=M*m-Y*h,o[8]=x*h+P*m,o[9]=C*h+U*m,o[10]=D*h+G*m,o[11]=M*h+Y*m,o}function up(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Wd(o,t,l){var h,m,x,C=l[0],D=l[1],M=l[2],P=Math.hypot(C,D,M);return P<Qc?null:(C*=P=1/P,D*=P,M*=P,h=Math.sin(t),m=Math.cos(t),o[0]=C*C*(x=1-m)+m,o[1]=D*C*x+M*h,o[2]=M*C*x-D*h,o[3]=0,o[4]=C*D*x-M*h,o[5]=D*D*x+m,o[6]=M*D*x+C*h,o[7]=0,o[8]=C*M*x+D*h,o[9]=D*M*x-C*h,o[10]=M*M*x+m,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var Bm=eu;function xf(){var o=new Bl(3);return Bl!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function dp(o){var t=new Bl(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function xd(o){return Math.hypot(o[0],o[1],o[2])}function vu(o,t,l){var h=new Bl(3);return h[0]=o,h[1]=t,h[2]=l,h}function tu(o,t,l){return o[0]=t[0]+l[0],o[1]=t[1]+l[1],o[2]=t[2]+l[2],o}function Zd(o,t,l){return o[0]=t[0]-l[0],o[1]=t[1]-l[1],o[2]=t[2]-l[2],o}function vg(o,t,l){return o[0]=t[0]*l[0],o[1]=t[1]*l[1],o[2]=t[2]*l[2],o}function yu(o,t,l){return o[0]=Math.min(t[0],l[0]),o[1]=Math.min(t[1],l[1]),o[2]=Math.min(t[2],l[2]),o}function Oh(o,t,l){return o[0]=Math.max(t[0],l[0]),o[1]=Math.max(t[1],l[1]),o[2]=Math.max(t[2],l[2]),o}function $l(o,t,l){return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o}function ju(o,t,l,h){return o[0]=t[0]+l[0]*h,o[1]=t[1]+l[1]*h,o[2]=t[2]+l[2]*h,o}function Pa(o,t){var l=t[0],h=t[1],m=t[2],x=l*l+h*h+m*m;return x>0&&(x=1/Math.sqrt(x)),o[0]=t[0]*x,o[1]=t[1]*x,o[2]=t[2]*x,o}function Il(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function wf(o,t,l){var h=t[0],m=t[1],x=t[2],C=l[0],D=l[1],M=l[2];return o[0]=m*M-x*D,o[1]=x*C-h*M,o[2]=h*D-m*C,o}function Ts(o,t,l){var h=t[0],m=t[1],x=t[2],C=l[3]*h+l[7]*m+l[11]*x+l[15];return o[0]=(l[0]*h+l[4]*m+l[8]*x+l[12])/(C=C||1),o[1]=(l[1]*h+l[5]*m+l[9]*x+l[13])/C,o[2]=(l[2]*h+l[6]*m+l[10]*x+l[14])/C,o}function Hu(o,t,l){var h=l[0],m=l[1],x=l[2],C=t[0],D=t[1],M=t[2],P=m*M-x*D,U=x*C-h*M,G=h*D-m*C,Y=m*G-x*U,ne=x*P-h*G,ae=h*U-m*P,pe=2*l[3];return U*=pe,G*=pe,ne*=2,ae*=2,o[0]=C+(P*=pe)+(Y*=2),o[1]=D+U+ne,o[2]=M+G+ae,o}var nu,Wl=Zd,yg=vg,hp=xd;function fp(o,t,l){return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o[3]=t[3]*l,o}function xg(o,t){var l=t[0],h=t[1],m=t[2],x=t[3],C=l*l+h*h+m*m+x*x;return C>0&&(C=1/Math.sqrt(C)),o[0]=l*C,o[1]=h*C,o[2]=m*C,o[3]=x*C,o}function Lc(o,t,l){var h=t[0],m=t[1],x=t[2],C=t[3];return o[0]=l[0]*h+l[4]*m+l[8]*x+l[12]*C,o[1]=l[1]*h+l[5]*m+l[9]*x+l[13]*C,o[2]=l[2]*h+l[6]*m+l[10]*x+l[14]*C,o[3]=l[3]*h+l[7]*m+l[11]*x+l[15]*C,o}function bf(){var o=new Bl(4);return Bl!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function pp(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function wd(o,t,l){l*=.5;var h=t[0],m=t[1],x=t[2],C=t[3],D=Math.sin(l),M=Math.cos(l);return o[0]=h*M+C*D,o[1]=m*M+x*D,o[2]=x*M-m*D,o[3]=C*M-h*D,o}function Ph(o,t,l){l*=.5;var h=t[0],m=t[1],x=t[2],C=t[3],D=Math.sin(l),M=Math.cos(l);return o[0]=h*M-x*D,o[1]=m*M+C*D,o[2]=x*M+h*D,o[3]=C*M-m*D,o}xf(),nu=new Bl(4),Bl!=Float32Array&&(nu[0]=0,nu[1]=0,nu[2]=0,nu[3]=0);var wg=xg;xf(),vu(1,0,0),vu(0,1,0),bf(),bf(),yf();const gp=pt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:bg}=gp,Ef=pt([{name:"a_pos_3",components:3,type:"Int16"}]);var Rh=pt([{name:"a_pos",type:"Int16",components:2}]);class Cf{constructor(t,l){this.pos=t,this.dir=l}intersectsPlane(t,l,h){const m=Il(l,this.dir);if(Math.abs(m)<1e-6)return!1;const x=((t[0]-this.pos[0])*l[0]+(t[1]-this.pos[1])*l[1]+(t[2]-this.pos[2])*l[2])/m;return h[0]=this.pos[0]+this.dir[0]*x,h[1]=this.pos[1]+this.dir[1]*x,h[2]=this.pos[2]+this.dir[2]*x,!0}closestPointOnSphere(t,l,h){if(pe=(ne=this.pos)[0],Ee=ne[1],Pe=ne[2],We=(ae=t)[0],Le=ae[1],$e=ae[2],Math.abs(pe-We)<=Qc*Math.max(1,Math.abs(pe),Math.abs(We))&&Math.abs(Ee-Le)<=Qc*Math.max(1,Math.abs(Ee),Math.abs(Le))&&Math.abs(Pe-$e)<=Qc*Math.max(1,Math.abs(Pe),Math.abs($e))||0===l)return h[0]=h[1]=h[2]=0,!1;var ne,ae,pe,Ee,Pe,We,Le,$e;const[m,x,C]=this.dir,D=this.pos[0]-t[0],M=this.pos[1]-t[1],P=this.pos[2]-t[2],U=m*m+x*x+C*C,G=2*(D*m+M*x+P*C),Y=G*G-4*U*(D*D+M*M+P*P-l*l);if(Y<0){const ne=Math.max(-G/2,0),ae=D+m*ne,pe=M+x*ne,Ee=P+C*ne,Pe=Math.hypot(ae,pe,Ee);return h[0]=ae*l/Pe,h[1]=pe*l/Pe,h[2]=Ee*l/Pe,!1}{const ne=(-G-Math.sqrt(Y))/(2*U);if(ne<0){const ae=Math.hypot(D,M,P);return h[0]=D*l/ae,h[1]=M*l/ae,h[2]=P*l/ae,!1}return h[0]=D+m*ne,h[1]=M+x*ne,h[2]=P+C*ne,!0}}}class Af{constructor(t,l,h,m,x){this.TL=t,this.TR=l,this.BR=h,this.BL=m,this.horizon=x}static fromInvProjectionMatrix(t,l,h){const m=[-1,1,1],x=[1,1,1],C=[1,-1,1],D=[-1,-1,1],M=Ts(m,m,t),P=Ts(x,x,t),U=Ts(C,C,t),G=Ts(D,D,t);return new Af(M,P,U,G,l/h)}}class Gu{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,h,m){const x=Math.pow(2,h),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const P=Lc([],M,t),U=1/P[3]/l*x;return(G=P)[0]=(Y=P)[0]*(ne=[U,U,m?1/P[3]:U,U])[0],G[1]=Y[1]*ne[1],G[2]=Y[2]*ne[2],G[3]=Y[3]*ne[3],G;var G,Y,ne}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const P=Pa([],wf([],Wl([],C[M[0]],C[M[1]]),Wl([],C[M[2]],C[M[1]]))),U=-Il(P,C[M[1]]);return P.concat(U)});return new Gu(C,D)}}class Ml{static fromPoints(t){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const m of t)yu(l,l,m),Oh(h,h,m);return new Ml(l,h)}static applyTransform(t,l){const h=t.getCorners();for(let m=0;m<h.length;++m)Ts(h[m],h[m],l);return Ml.fromPoints(h)}constructor(t,l){this.min=t,this.max=l,this.center=$l([],tu([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],h=dp(this.min),m=dp(this.max);for(let x=0;x<l.length;x++)h[x]=l[x]?this.min[x]:this.center[x],m[x]=l[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new Ml(h,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,l=this.max;return[[t[0],t[1],t[2]],[l[0],t[1],t[2]],[l[0],l[1],t[2]],[t[0],l[1],t[2]],[t[0],t[1],l[2]],[l[0],t[1],l[2]],[l[0],l[1],l[2]],[t[0],l[1],l[2]]]}intersects(t){const l=this.getCorners();let h=!0;for(let m=0;m<t.planes.length;m++){const x=t.planes[m];let C=0;for(let D=0;D<l.length;D++)C+=Il(x,l[D])+x[3]>=0;if(0===C)return 0;C!==l.length&&(h=!1)}if(h)return 2;for(let m=0;m<3;m++){let x=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const M=t.points[D][m]-this.min[m];x=Math.min(x,M),C=Math.max(C,M)}if(C<0||x>this.max[m]-this.min[m])return 0}return 1}}const qd=5,$u=6,rc=Tr/Math.PI/2,is=16383,$a=[64,32,16],Zo=-rc,qo=rc,Ra=[new Ml([Zo,Zo,Zo],[qo,qo,qo]),new Ml([Zo,Zo,Zo],[0,0,qo]),new Ml([0,Zo,Zo],[qo,0,qo]),new Ml([Zo,0,Zo],[0,qo,qo]),new Ml([0,0,Zo],[qo,qo,qo])];function Wu(o){return o*rc/ya}function Df(o,t,l,h=!0){const m=$l([],o._camera.position,o.worldSize),x=[t,l,1,1];Lc(x,x,o.pixelMatrixInverse),fp(x,x,1/x[3]);const C=Pa([],Wl([],x,m)),D=o.globeMatrix,M=[D[12],D[13],D[14]],P=Wl([],M,m),U=xd(P),G=Pa([],P),Y=o.worldSize/(2*Math.PI),ne=Il(G,C),ae=Math.asin(Y/U);if(ae<Math.acos(ne)){if(!h)return null;const Dn=[],Ht=[];$l(Dn,C,U/ne),Pa(Ht,Wl(Ht,Dn,P)),Pa(C,tu(C,P,$l(C,Ht,Math.tan(ae)*U)))}const pe=[];new Cf(m,C).closestPointOnSphere(M,Y,pe);const Ee=Pa([],wr(D,0)),Pe=Pa([],wr(D,1)),We=Pa([],wr(D,2)),Le=Il(Ee,pe),$e=Il(Pe,pe),et=Il(We,pe),Xe=Kt(Math.asin(-$e/Y));let Ft=Kt(Math.atan2(Le,et));Ft=o.center.lng+function(Dn,Ht){const cn=(Ht-Dn+180)%360-180;return cn<-180?cn+360:cn}(o.center.lng,Ft);const Rt=hc(Ft),tn=xr(Vs(Xe),0,1);return new Eu(Rt,tn)}class mp{constructor(t,l,h){this.a=Wl([],t,h),this.b=Wl([],l,h),this.center=h;const m=Pa([],this.a),x=Pa([],this.b);this.angle=Math.acos(Il(m,x))}}function Lh(o,t){if(0===o.angle)return null;let l;return l=0===o.a[t]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[t]/o.a[t]/Math.sin(o.angle)-1/Math.tan(o.angle)),l<0||l>1?null:function(h,m,x,C){const D=Math.sin(x);return h*(Math.sin((1-C)*x)/D)+m*(Math.sin(C*x)/D)}(o.a[t],o.b[t],o.angle,xr(l,0,1))+o.center[t]}function sl(o){if(o.z<=1)return Ra[o.z+2*o.y+o.x];const t=Sf(wu(o));return Ml.fromPoints(t)}function xu(o,t,l){return $l(o,o,1-l),ju(o,o,t,l)}function Tf(o,t){const l=bu(t.zoom);if(0===l)return sl(o);const h=wu(o),m=Sf(h),x=hc(h.getWest())*t.worldSize,C=hc(h.getEast())*t.worldSize,D=Vs(h.getNorth())*t.worldSize,M=Vs(h.getSouth())*t.worldSize,P=[x,D,0],U=[C,D,0],G=[x,M,0],Y=[C,M,0],ne=Wi([],t.globeMatrix);return Ts(P,P,ne),Ts(U,U,ne),Ts(G,G,ne),Ts(Y,Y,ne),m[0]=xu(m[0],G,l),m[1]=xu(m[1],Y,l),m[2]=xu(m[2],U,l),m[3]=xu(m[3],P,l),Ml.fromPoints(m)}function Xd(o,t,l){for(const h of o)Ts(h,h,t),$l(h,h,l)}function wu({x:o,y:t,z:l}){const h=1/(1<<l),m=new yo(Rs(o*h),La((t+1)*h)),x=new yo(Rs((o+1)*h),La(t*h));return new uc(m,x)}function Sf(o){const t=Yt(o.getNorth()),l=Yt(o.getSouth()),h=Math.cos(t),m=Math.cos(l),x=Math.sin(t),C=Math.sin(l),D=o.getWest(),M=o.getEast();return[bd(m,C,D),bd(m,C,M),bd(h,x,M),bd(h,x,D)]}function bd(o,t,l,h=rc){return l=Yt(l),[o*Math.sin(l)*h,-t*h,o*Math.cos(l)*h]}function Ed(o,t,l){return bd(Math.cos(Yt(o)),Math.sin(Yt(o)),t,l)}function Cd(o,t,l,h){const m=1<<l.z,x=(o/Tr+l.x)/m;return Ed(La((t/Tr+l.y)/m),Rs(x),h)}function Ad({min:o,max:t}){return is/Math.max(t[0]-o[0],t[1]-o[1],t[2]-o[2])}const _p=new Float64Array(16);function Yd(o){const t=Ad(o),l=up(_p,[t,t,t]);return dc(l,l,((h=[])[0]=-(m=o.min)[0],h[1]=-m[1],h[2]=-m[2],h));var h,m}function If(o){const t=(h=o.min,(l=_p)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const m=1/Ad(o);return yd(t,t,[m,m,m])}function Zi(o,t,l,h,m){const x=function(M){const P=Tr/(2*Math.PI);return M/(2*Math.PI)/P}(l),C=[o,t,-l/(2*Math.PI)],D=Rc(new Float64Array(16));return dc(D,D,C),yd(D,D,[x,x,x]),Mh(D,D,Yt(-m)),$d(D,D,Yt(-h)),D}function bu(o){return Vn(qd,$u,o)}function Mf(o,t){const l=Ed(t.lat,t.lng);return C=(m=Zd([],function(ae){const pe=Ed(ae._center.lat,ae._center.lng);let Ee=wf([],vu(0,1,0),pe);const Pe=Wd([],-ae.angle,pe);Ee=Ts(Ee,Ee,Pe),Wd(Pe,-ae._pitch,Ee);const We=Pa([],pe);return $l(We,We,Wu(ae.cameraToCenterDistance/ae.pixelsPerMeter)),Ts(We,We,Pe),tu([],pe,We)}(o),l))[0],D=m[1],M=m[2],P=(x=l)[0],U=x[1],G=x[2],ne=(Y=Math.sqrt(C*C+D*D+M*M)*Math.sqrt(P*P+U*U+G*G))&&Il(m,x)/Y,Math.acos(Math.min(Math.max(ne,-1),1));var m,x,C,D,M,P,U,G,Y,ne}function _l(o,t){return Mf(o,t)>Math.PI/2*1.01}const Nh=Yt(85),vp=Math.cos(Nh),kh=Math.sin(Nh),ya=6371008.8,Nc=2*Math.PI*ya;class ru{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ru(Zr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const l=Math.PI/180,h=this.lat*l,m=t.lat*l,x=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((t.lng-this.lng)*l);return ya*Math.acos(Math.min(x,1))}toBounds(t=0){const l=360*t/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new uc(new ru(this.lng-h,this.lat-l),new ru(this.lng+h,this.lat+l))}toEcef(t){const l=Wu(t);return Ed(this.lat,this.lng,rc+l)}static convert(t){if(t instanceof ru)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new ru(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new ru(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var yo=ru;function or(o){return Nc*Math.cos(o*Math.PI/180)}function hc(o){return(180+o)/360}function Vs(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ic(o,t){return o/or(t)}function Rs(o){return 360*o-180}function La(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Eg(o,t){return o*or(La(t))}const al=85.051129;function Fh(o){return 1/Math.cos(o*Math.PI/180)}class Eu{constructor(t,l,h=0){this.x=+t,this.y=+l,this.z=+h}static fromLngLat(t,l=0){const h=yo.convert(t);return new Eu(hc(h.lng),Vs(h.lat),ic(l,h.lat))}toLngLat(){return new yo(Rs(this.x),La(this.y))}toAltitude(){return Eg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nc*Fh(La(this.y))}}function Of(o,t,l,h,m,x,C,D,M){const P=(t+h)/2,U=(l+m)/2,G=new gt(P,U);D(G),function(Y,ne,ae,pe,Ee,Pe){const We=ae-Ee,Le=pe-Pe;return Math.abs((pe-ne)*We-(ae-Y)*Le)/Math.hypot(We,Le)}(G.x,G.y,x.x,x.y,C.x,C.y)>=M?(Of(o,t,l,P,U,x,G,D,M),Of(o,P,U,h,m,G,C,D,M)):o.push(C)}function Zu(o,t,l){let h=o[0],m=h.x,x=h.y;t(h);const C=[h];for(let D=1;D<o.length;D++){const M=o[D],{x:P,y:U}=M;t(M),Of(C,m,x,P,U,h,M,t,l),m=P,x=U,h=M}return C}function Pf(o,t,l,h){if(h(t,l)){const m=t.add(l)._mult(.5);Pf(o,t,m,h),Pf(o,m,l,h)}else o.push(l)}function Cg(o,t){let l=o[0];const h=[l];for(let m=1;m<o.length;m++){const x=o[m];Pf(h,l,x,t),l=x}return h}const Bh=Math.pow(2,14)-1,Rf=-Bh-1;function zh(o,t){const l=Math.round(o.x*t),h=Math.round(o.y*t);return o.x=xr(l,Rf,Bh),o.y=xr(h,Rf,Bh),(l<o.x||l>o.x+1||h<o.y||h>o.y+1)&&Gn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function zl(o,t,l){const h=o.loadGeometry(),m=o.extent,x=Tr/m;if(t&&l&&l.projection.isReprojectedInTileSpace){const C=1<<t.z,{scale:D,x:M,y:P,projection:U}=l,G=Y=>{const ne=Rs((t.x+Y.x/m)/C),ae=La((t.y+Y.y/m)/C),pe=U.project(ne,ae);Y.x=(pe.x*D-M)*m,Y.y=(pe.y*D-P)*m};for(let Y=0;Y<h.length;Y++)if(1!==o.type)h[Y]=Zu(h[Y],G,1);else{const ne=[];for(const ae of h[Y])ae.x<0||ae.x>=m||ae.y<0||ae.y>=m||(G(ae),ne.push(ae));h[Y]=ne}}for(const C of h)for(const D of C)zh(D,x);return h}function kc(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?zl(o):[]}}function Kd(o,t,l,h,m){o.emplaceBack(2*t+(h+1)/2,2*l+(m+1)/2)}function Dd(o,t,l){o.emplaceBack(t.x,t.y,t.z,16384*l[0],16384*l[1],16384*l[2])}class Fc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new En,this.indexArray=new dr,this.segments=new So,this.programConfigurations=new Hd(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h,m){const x=this.layers[0],C=[];let D=null;"circle"===x.type&&(D=x.layout.get("circle-sort-key"));for(const{feature:P,id:U,index:G,sourceLayerIndex:Y}of t){const ne=this.layers[0]._featureFilter.needGeometry,ae=kc(P,ne);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),ae,h))continue;const pe=D?D.evaluate(ae,{},h):void 0,Ee={id:U,properties:P.properties,type:P.type,sourceLayerIndex:Y,index:G,geometry:ne?ae.geometry:zl(P,h,m),patterns:{},sortKey:pe};C.push(Ee)}D&&C.sort((P,U)=>P.sortKey-U.sortKey);let M=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new Cn,M=m.projection);for(const P of C){const{geometry:U,index:G,sourceLayerIndex:Y}=P,ne=t[G].feature;this.addFeature(P,U,G,l.availableImages,h,M),l.featureIndex.insert(ne,U,G,Y,this.index)}}update(t,l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,nc.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,l,h,m,x,C){for(const D of l)for(const M of D){const P=M.x,U=M.y;if(P<0||P>=Tr||U<0||U>=Tr)continue;if(C){const ne=C.projectTilePoint(P,U,x),ae=C.upVector(x,P,U),pe=this.globeExtVertexArray;Dd(pe,ne,ae),Dd(pe,ne,ae),Dd(pe,ne,ae),Dd(pe,ne,ae)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Y=G.vertexLength;Kd(this.layoutVertexArray,P,U,-1,-1),Kd(this.layoutVertexArray,P,U,1,-1),Kd(this.layoutVertexArray,P,U,1,1),Kd(this.layoutVertexArray,P,U,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+2,Y+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,{},m,x)}}function yp(o,t){for(let l=0;l<o.length;l++)if(iu(t,o[l]))return!0;for(let l=0;l<t.length;l++)if(iu(o,t[l]))return!0;return!!Uh(o,t)}function Cu(o,t,l){return!!iu(o,t)||!!Vh(t,o,l)}function Jd(o,t){if(1===o.length)return jh(t,o[0]);for(let l=0;l<t.length;l++){const h=t[l];for(let m=0;m<h.length;m++)if(iu(o,h[m]))return!0}for(let l=0;l<o.length;l++)if(jh(t,o[l]))return!0;for(let l=0;l<t.length;l++)if(Uh(o,t[l]))return!0;return!1}function oc(o,t,l){if(o.length>1){if(Uh(o,t))return!0;for(let h=0;h<t.length;h++)if(Vh(t[h],o,l))return!0}for(let h=0;h<o.length;h++)if(Vh(o[h],t,l))return!0;return!1}function Uh(o,t){if(0===o.length||0===t.length)return!1;for(let l=0;l<o.length-1;l++){const h=o[l],m=o[l+1];for(let x=0;x<t.length-1;x++)if(Bc(h,m,t[x],t[x+1]))return!0}return!1}function Bc(o,t,l,h){return Pi(o,l,h)!==Pi(t,l,h)&&Pi(o,t,l)!==Pi(o,t,h)}function Vh(o,t,l){const h=l*l;if(1===t.length)return o.distSqr(t[0])<h;for(let m=1;m<t.length;m++)if(qu(o,t[m-1],t[m])<h)return!0;return!1}function qu(o,t,l){const h=t.distSqr(l);if(0===h)return o.distSqr(t);const m=((o.x-t.x)*(l.x-t.x)+(o.y-t.y)*(l.y-t.y))/h;return o.distSqr(m<0?t:m>1?l:l.sub(t)._mult(m)._add(t))}function jh(o,t){let l,h,m,x=!1;for(let C=0;C<o.length;C++){l=o[C];for(let D=0,M=l.length-1;D<l.length;M=D++)h=l[D],m=l[M],h.y>t.y!=m.y>t.y&&t.x<(m.x-h.x)*(t.y-h.y)/(m.y-h.y)+h.x&&(x=!x)}return x}function iu(o,t){let l=!1;for(let h=0,m=o.length-1;h<o.length;m=h++){const x=o[h],C=o[m];x.y>t.y!=C.y>t.y&&t.x<(C.x-x.x)*(t.y-x.y)/(C.y-x.y)+x.x&&(l=!l)}return l}function Lf(o,t,l,h,m){for(const C of o)if(t<=C.x&&l<=C.y&&h>=C.x&&m>=C.y)return!0;const x=[new gt(t,l),new gt(t,m),new gt(h,m),new gt(h,l)];if(o.length>2)for(const C of x)if(iu(o,C))return!0;for(let C=0;C<o.length-1;C++)if(Ag(o[C],o[C+1],x))return!0;return!1}function Ag(o,t,l){const h=l[0],m=l[2];if(o.x<h.x&&t.x<h.x||o.x>m.x&&t.x>m.x||o.y<h.y&&t.y<h.y||o.y>m.y&&t.y>m.y)return!1;const x=Pi(o,t,l[0]);return x!==Pi(o,t,l[1])||x!==Pi(o,t,l[2])||x!==Pi(o,t,l[3])}function Au(o,t,l){const h=t.paint.get(o).value;return"constant"===h.kind?h.value:l.programConfigurations.get(t.id).getMaxValue(o)}function Qd(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Du(o,t,l,h,m){if(!t[0]&&!t[1])return o;const x=gt.convert(t)._mult(m);"viewport"===l&&x._rotate(-h);const C=[];for(let D=0;D<o.length;D++)C.push(o[D].sub(x));return C}function eh(o,t,l,h){const m=gt.convert(o)._mult(h);return"viewport"===t&&m._rotate(-l),m}Kn(Fc,"CircleBucket",{omit:["layers"]});const th=new Ve({"circle-sort-key":new Te(Et.layout_circle["circle-sort-key"])});var Dg={paint:new Ve({"circle-radius":new Te(Et.paint_circle["circle-radius"]),"circle-color":new Te(Et.paint_circle["circle-color"]),"circle-blur":new Te(Et.paint_circle["circle-blur"]),"circle-opacity":new Te(Et.paint_circle["circle-opacity"]),"circle-translate":new he(Et.paint_circle["circle-translate"]),"circle-translate-anchor":new he(Et.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(Et.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(Et.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Te(Et.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Te(Et.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Te(Et.paint_circle["circle-stroke-opacity"])}),layout:th};function Tg(o,t,l,h,m,x,C,D,M){if(x&&o.queryGeometry.isAboveHorizon)return!1;x&&(M*=o.pixelToTileUnitsFactor);const P=o.tileID.canonical,U=l.projection.upVectorScale(P,l.center.lat,l.worldSize).metersToTile;for(const G of t)for(const Y of G){const ne=Y.add(D),ae=m&&l.elevation?l.elevation.exaggeration()*m.getElevationAt(ne.x,ne.y,!0):0,pe=l.projection.projectTilePoint(ne.x,ne.y,P);if(ae>0){const Le=l.projection.upVector(P,ne.x,ne.y);pe.x+=Le[0]*U*ae,pe.y+=Le[1]*U*ae,pe.z+=Le[2]*U*ae}const Ee=x?ne:Hh(pe.x,pe.y,pe.z,h),Pe=x?o.tilespaceRays.map(Le=>Sg(Le,ae)):o.queryGeometry.screenGeometry,We=Lc([],[pe.x,pe.y,pe.z,1],h);if(!C&&x?M*=We[3]/l.cameraToCenterDistance:C&&!x&&(M*=l.cameraToCenterDistance/We[3]),x){const Le=La((Y.y/Tr+P.y)/(1<<P.z));M/=l.projection.pixelsPerMeter(Le,1)/ic(1,Le)}if(Cu(Pe,Ee,M))return!0}return!1}function Hh(o,t,l,h){const m=Lc([],[o,t,l,1],h);return new gt(m[0]/m[3],m[1]/m[3])}const xp=vu(0,0,0),Gh=vu(0,0,1);function Sg(o,t){const l=xf();return xp[2]=t,o.intersectsPlane(xp,Gh,l),new gt(l[0],l[1])}class wp extends Fc{}function $h(o,{width:t,height:l},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==t*l*h)throw new RangeError("mismatched image size")}else m=new Uint8Array(t*l*h);return o.width=t,o.height=l,o.data=m,o}function Nf(o,t,l){const{width:h,height:m}=t;h===o.width&&m===o.height||(Xu(o,t,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,h),height:Math.min(o.height,m)},l),o.width=h,o.height=m,o.data=t.data)}function Xu(o,t,l,h,m,x){if(0===m.width||0===m.height)return t;if(m.width>o.width||m.height>o.height||l.x>o.width-m.width||l.y>o.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>t.width||m.height>t.height||h.x>t.width-m.width||h.y>t.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const C=o.data,D=t.data;for(let M=0;M<m.height;M++){const P=((l.y+M)*o.width+l.x)*x,U=((h.y+M)*t.width+h.x)*x;for(let G=0;G<m.width*x;G++)D[U+G]=C[P+G]}return t}Kn(wp,"HeatmapBucket",{omit:["layers"]});class Zl{constructor(t,l){$h(this,t,1,l)}resize(t){Nf(this,new Zl(t),1)}clone(){return new Zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,m,x){Xu(t,l,h,m,x,1)}}class Ol{constructor(t,l){$h(this,t,4,l)}resize(t){Nf(this,new Ol(t),4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ol({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,h,m,x){Xu(t,l,h,m,x,4)}}Kn(Zl,"AlphaImage"),Kn(Ol,"RGBAImage");var Tu={paint:new Ve({"heatmap-radius":new Te(Et.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Te(Et.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(Et.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Be(Et.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(Et.paint_heatmap["heatmap-opacity"])})};function os(o){const t={},l=o.resolution||256,h=o.clips?o.clips.length:1,m=o.image||new Ol({width:l,height:h}),x=(C,D,M)=>{t[o.evaluationKey]=M;const P=o.expression.evaluate(t);m.data[C+D+0]=Math.floor(255*P.r/P.a),m.data[C+D+1]=Math.floor(255*P.g/P.a),m.data[C+D+2]=Math.floor(255*P.b/P.a),m.data[C+D+3]=Math.floor(255*P.a)};if(o.clips)for(let C=0,D=0;C<h;++C,D+=4*l)for(let M=0,P=0;M<l;M++,P+=4){const U=M/(l-1),{start:G,end:Y}=o.clips[C];x(D,P,G*(1-U)+Y*U)}else for(let C=0,D=0;C<l;C++,D+=4)x(0,D,C/(l-1));return m}var Ls={paint:new Ve({"hillshade-illumination-direction":new he(Et.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(Et.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(Et.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(Et.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(Et.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(Et.paint_hillshade["hillshade-accent-color"])})};const nh=pt([{name:"a_pos",components:2,type:"Int16"}],4),{members:rh}=nh;var zc={exports:{}};function ih(o,t,l){l=l||2;var h,m,x,C,D,M,P,U=t&&t.length,G=U?t[0]*l:o.length,Y=Ig(o,0,G,l,!0),ne=[];if(!Y||Y.next===Y.prev)return ne;if(U&&(Y=function(pe,Ee,Pe,We){var Le,$e,et,Xe=[];for(Le=0,$e=Ee.length;Le<$e;Le++)(et=Ig(pe,Ee[Le]*We,Le<$e-1?Ee[Le+1]*We:pe.length,We,!1))===et.next&&(et.steiner=!0),Xe.push(ou(et));for(Xe.sort(Td),Le=0;Le<Xe.length;Le++)Pe=zm(Xe[Le],Pe);return Pe}(o,t,Y,l)),o.length>80*l){h=x=o[0],m=C=o[1];for(var ae=l;ae<G;ae+=l)(D=o[ae])<h&&(h=D),(M=o[ae+1])<m&&(m=M),D>x&&(x=D),M>C&&(C=M);P=0!==(P=Math.max(x-h,C-m))?32767/P:0}return Wh(Y,ne,l,h,m,P,0),ne}function Ig(o,t,l,h,m){var x,C;if(m===u(o,t,l,h)>0)for(x=t;x<l;x+=h)C=e(x,o[x],o[x+1],C);else for(x=l-h;x>=t;x-=h)C=e(x,o[x],o[x+1],C);return C&&Ju(C,C.next)&&(n(C),C=C.next),C}function Yu(o,t){if(!o)return o;t||(t=o);var l,h=o;do{if(l=!1,h.steiner||!Ju(h,h.next)&&0!==ps(h.prev,h,h.next))h=h.next;else{if(n(h),(h=t=h.prev)===h.next)break;l=!0}}while(l||h!==t);return t}function Wh(o,t,l,h,m,x,C){if(o){!C&&x&&function(U,G,Y,ne){var ae=U;do{0===ae.z&&(ae.z=Pg(ae.x,ae.y,G,Y,ne)),ae.prevZ=ae.prev,ae.nextZ=ae.next,ae=ae.next}while(ae!==U);ae.prevZ.nextZ=null,ae.prevZ=null,function(pe){var Ee,Pe,We,Le,$e,et,Xe,Ft,Rt=1;do{for(Pe=pe,pe=null,$e=null,et=0;Pe;){for(et++,We=Pe,Xe=0,Ee=0;Ee<Rt&&(Xe++,We=We.nextZ);Ee++);for(Ft=Rt;Xe>0||Ft>0&&We;)0!==Xe&&(0===Ft||!We||Pe.z<=We.z)?(Le=Pe,Pe=Pe.nextZ,Xe--):(Le=We,We=We.nextZ,Ft--),$e?$e.nextZ=Le:pe=Le,Le.prevZ=$e,$e=Le;Pe=We}$e.nextZ=null,Rt*=2}while(et>1)}(ae)}(o,h,m,x);for(var D,M,P=o;o.prev!==o.next;)if(D=o.prev,M=o.next,x?Mg(o,h,m,x):bp(o))t.push(D.i/l|0),t.push(o.i/l|0),t.push(M.i/l|0),n(o),o=M.next,P=M.next;else if((o=M)===P){C?1===C?Wh(o=Zh(Yu(o),t,l),t,l,h,m,x,2):2===C&&kf(o,t,l,h,m,x):Wh(Yu(o),t,l,h,m,x,1);break}}}function bp(o){var t=o.prev,l=o,h=o.next;if(ps(t,l,h)>=0)return!1;for(var m=t.x,x=l.x,C=h.x,D=t.y,M=l.y,P=h.y,U=m<x?m<C?m:C:x<C?x:C,G=D<M?D<P?D:P:M<P?M:P,Y=m>x?m>C?m:C:x>C?x:C,ne=D>M?D>P?D:P:M>P?M:P,ae=h.next;ae!==t;){if(ae.x>=U&&ae.x<=Y&&ae.y>=G&&ae.y<=ne&&Ku(m,D,x,M,C,P,ae.x,ae.y)&&ps(ae.prev,ae,ae.next)>=0)return!1;ae=ae.next}return!0}function Mg(o,t,l,h){var m=o.prev,x=o,C=o.next;if(ps(m,x,C)>=0)return!1;for(var D=m.x,M=x.x,P=C.x,U=m.y,G=x.y,Y=C.y,ne=D<M?D<P?D:P:M<P?M:P,ae=U<G?U<Y?U:Y:G<Y?G:Y,pe=D>M?D>P?D:P:M>P?M:P,Ee=U>G?U>Y?U:Y:G>Y?G:Y,Pe=Pg(ne,ae,t,l,h),We=Pg(pe,Ee,t,l,h),Le=o.prevZ,$e=o.nextZ;Le&&Le.z>=Pe&&$e&&$e.z<=We;){if(Le.x>=ne&&Le.x<=pe&&Le.y>=ae&&Le.y<=Ee&&Le!==m&&Le!==C&&Ku(D,U,M,G,P,Y,Le.x,Le.y)&&ps(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,$e.x>=ne&&$e.x<=pe&&$e.y>=ae&&$e.y<=Ee&&$e!==m&&$e!==C&&Ku(D,U,M,G,P,Y,$e.x,$e.y)&&ps($e.prev,$e,$e.next)>=0))return!1;$e=$e.nextZ}for(;Le&&Le.z>=Pe;){if(Le.x>=ne&&Le.x<=pe&&Le.y>=ae&&Le.y<=Ee&&Le!==m&&Le!==C&&Ku(D,U,M,G,P,Y,Le.x,Le.y)&&ps(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;$e&&$e.z<=We;){if($e.x>=ne&&$e.x<=pe&&$e.y>=ae&&$e.y<=Ee&&$e!==m&&$e!==C&&Ku(D,U,M,G,P,Y,$e.x,$e.y)&&ps($e.prev,$e,$e.next)>=0)return!1;$e=$e.nextZ}return!0}function Zh(o,t,l){var h=o;do{var m=h.prev,x=h.next.next;!Ju(m,x)&&qh(m,h,h.next,x)&&Sd(m,x)&&Sd(x,m)&&(t.push(m.i/l|0),t.push(h.i/l|0),t.push(x.i/l|0),n(h),n(h.next),h=o=x),h=h.next}while(h!==o);return Yu(h)}function kf(o,t,l,h,m,x){var C=o;do{for(var D=C.next.next;D!==C.prev;){if(C.i!==D.i&&Ep(C,D)){var M=s(C,D);return C=Yu(C,C.next),M=Yu(M,M.next),Wh(C,t,l,h,m,x,0),void Wh(M,t,l,h,m,x,0)}D=D.next}C=C.next}while(C!==o)}function Td(o,t){return o.x-t.x}function zm(o,t){var l=function(m,x){var C,D=x,M=m.x,P=m.y,U=-1/0;do{if(P<=D.y&&P>=D.next.y&&D.next.y!==D.y){var G=D.x+(P-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(G<=M&&G>U&&(U=G,C=D.x<D.next.x?D:D.next,G===M))return C}D=D.next}while(D!==x);if(!C)return null;var Y,ne=C,ae=C.x,pe=C.y,Ee=1/0;D=C;do{M>=D.x&&D.x>=ae&&M!==D.x&&Ku(P<pe?M:U,P,ae,pe,P<pe?U:M,P,D.x,D.y)&&(Y=Math.abs(P-D.y)/(M-D.x),Sd(D,m)&&(Y<Ee||Y===Ee&&(D.x>C.x||D.x===C.x&&Og(C,D)))&&(C=D,Ee=Y)),D=D.next}while(D!==ne);return C}(o,t);if(!l)return t;var h=s(l,o);return Yu(h,h.next),Yu(l,l.next)}function Og(o,t){return ps(o.prev,o,t.prev)<0&&ps(t.next,o,o.next)<0}function Pg(o,t,l,h,m){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-l)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-h)*m|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ou(o){var t=o,l=o;do{(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next}while(t!==o);return l}function Ku(o,t,l,h,m,x,C,D){return(m-C)*(t-D)>=(o-C)*(x-D)&&(o-C)*(h-D)>=(l-C)*(t-D)&&(l-C)*(x-D)>=(m-C)*(h-D)}function Ep(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(l,h){var m=l;do{if(m.i!==l.i&&m.next.i!==l.i&&m.i!==h.i&&m.next.i!==h.i&&qh(m,m.next,l,h))return!0;m=m.next}while(m!==l);return!1}(o,t)&&(Sd(o,t)&&Sd(t,o)&&function(l,h){var m=l,x=!1,C=(l.x+h.x)/2,D=(l.y+h.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&C<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next}while(m!==l);return x}(o,t)&&(ps(o.prev,o,t.prev)||ps(o,t.prev,t))||Ju(o,t)&&ps(o.prev,o,o.next)>0&&ps(t.prev,t,t.next)>0)}function ps(o,t,l){return(t.y-o.y)*(l.x-t.x)-(t.x-o.x)*(l.y-t.y)}function Ju(o,t){return o.x===t.x&&o.y===t.y}function qh(o,t,l,h){var m=oh(ps(o,t,l)),x=oh(ps(o,t,h)),C=oh(ps(l,h,o)),D=oh(ps(l,h,t));return m!==x&&C!==D||!(0!==m||!Qu(o,l,t))||!(0!==x||!Qu(o,h,t))||!(0!==C||!Qu(l,o,h))||!(0!==D||!Qu(l,t,h))}function Qu(o,t,l){return t.x<=Math.max(o.x,l.x)&&t.x>=Math.min(o.x,l.x)&&t.y<=Math.max(o.y,l.y)&&t.y>=Math.min(o.y,l.y)}function oh(o){return o>0?1:o<0?-1:0}function Sd(o,t){return ps(o.prev,o,o.next)<0?ps(o,t,o.next)>=0&&ps(o,o.prev,t)>=0:ps(o,t,o.prev)<0||ps(o,o.next,t)<0}function s(o,t){var l=new a(o.i,o.x,o.y),h=new a(t.i,t.x,t.y),m=o.next,x=t.prev;return o.next=t,t.prev=o,l.next=m,m.prev=l,h.next=l,l.prev=h,x.next=h,h.prev=x,h}function e(o,t,l,h){var m=new a(o,t,l);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function n(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function a(o,t,l){this.i=o,this.x=t,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function u(o,t,l,h){for(var m=0,x=t,C=l-h;x<l;x+=h)m+=(o[C]-o[x])*(o[x+1]+o[C+1]),C=x;return m}zc.exports=ih,zc.exports.default=ih,ih.deviation=function(o,t,l,h){var m=t&&t.length,x=Math.abs(u(o,0,m?t[0]*l:o.length,l));if(m)for(var C=0,D=t.length;C<D;C++)x-=Math.abs(u(o,t[C]*l,C<D-1?t[C+1]*l:o.length,l));var M=0;for(C=0;C<h.length;C+=3){var P=h[C]*l,U=h[C+1]*l,G=h[C+2]*l;M+=Math.abs((o[P]-o[G])*(o[U+1]-o[P+1])-(o[P]-o[U])*(o[G+1]-o[P+1]))}return 0===x&&0===M?0:Math.abs((M-x)/x)},ih.flatten=function(o){for(var t=o[0][0].length,l={vertices:[],holes:[],dimensions:t},h=0,m=0;m<o.length;m++){for(var x=0;x<o[m].length;x++)for(var C=0;C<t;C++)l.vertices.push(o[m][x][C]);m>0&&l.holes.push(h+=o[m-1].length)}return l};var p=jn(zc.exports);function w(o,t,l,h,m){E(o,t,l||0,h||o.length-1,m||R)}function E(o,t,l,h,m){for(;h>l;){if(h-l>600){var x=h-l+1,C=t-l+1,D=Math.log(x),M=.5*Math.exp(2*D/3),P=.5*Math.sqrt(D*M*(x-M)/x)*(C-x/2<0?-1:1);E(o,t,Math.max(l,Math.floor(t-C*M/x+P)),Math.min(h,Math.floor(t+(x-C)*M/x+P)),m)}var U=o[t],G=l,Y=h;for(I(o,l,t),m(o[h],U)>0&&I(o,l,h);G<Y;){for(I(o,G,Y),G++,Y--;m(o[G],U)<0;)G++;for(;m(o[Y],U)>0;)Y--}0===m(o[l],U)?I(o,l,Y):I(o,++Y,h),Y<=t&&(l=Y+1),t<=Y&&(h=Y-1)}}function I(o,t,l){var h=o[t];o[t]=o[l],o[l]=h}function R(o,t){return o<t?-1:o>t?1:0}function V(o,t){const l=o.length;if(l<=1)return[o];const h=[];let m,x;for(let C=0;C<l;C++){const D=vi(o[C]);0!==D&&(o[C].area=Math.abs(D),void 0===x&&(x=D<0),x===D<0?(m&&h.push(m),m=[o[C]]):m.push(o[C]))}if(m&&h.push(m),t>1)for(let C=0;C<h.length;C++)h[C].length<=t||(w(h[C],t,1,h[C].length-1,W),h[C]=h[C].slice(0,t));return h}function W(o,t){return t.area-o.area}function ee(o,t,l){const h=l.patternDependencies;let m=!1;for(const x of t){const C=x.paint.get(`${o}-pattern`);C.isConstant()||(m=!0);const D=C.constantOr(null);D&&(m=!0,h[D]=!0)}return m}function oe(o,t,l,h,m){const x=m.patternDependencies;for(const C of t){const D=C.paint.get(`${o}-pattern`).value;if("constant"!==D.kind){let M=D.evaluate({zoom:h},l,{},m.availableImages);M=M&&M.name?M.name:M,x[M]=!0,l.patterns[C.id]=M}}return l}class Ce{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new En,this.indexArray=new dr,this.indexArray2=new ua,this.programConfigurations=new Hd(t.layers,t.zoom),this.segments=new So,this.segments2=new So,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=t.projection}populate(t,l,h,m){this.hasPattern=ee("fill",this.layers,l);const x=this.layers[0].layout.get("fill-sort-key"),C=[];for(const{feature:D,id:M,index:P,sourceLayerIndex:U}of t){const G=this.layers[0]._featureFilter.needGeometry,Y=kc(D,G);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),Y,h))continue;const ne=x?x.evaluate(Y,{},h,l.availableImages):void 0,ae={id:M,properties:D.properties,type:D.type,sourceLayerIndex:U,index:P,geometry:G?Y.geometry:zl(D,h,m),patterns:{},sortKey:ne};C.push(ae)}x&&C.sort((D,M)=>D.sortKey-M.sortKey);for(const D of C){const{geometry:M,index:P,sourceLayerIndex:U}=D;if(this.hasPattern){const G=oe("fill",this.layers,D,this.zoom,l);this.patternFeatures.push(G)}else this.addFeature(D,M,P,h,{},l.availableImages);l.featureIndex.insert(t[P].feature,M,P,U,this.index)}}update(t,l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h,m)}addFeatures(t,l,h,m,x){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,l,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,rh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,h,m,x,C=[]){for(const D of V(l,500)){let M=0;for(const ae of D)M+=ae.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),U=P.vertexLength,G=[],Y=[];for(const ae of D){if(0===ae.length)continue;ae!==D[0]&&Y.push(G.length/2);const pe=this.segments2.prepareSegment(ae.length,this.layoutVertexArray,this.indexArray2),Ee=pe.vertexLength;this.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),this.indexArray2.emplaceBack(Ee+ae.length-1,Ee),G.push(ae[0].x),G.push(ae[0].y);for(let Pe=1;Pe<ae.length;Pe++)this.layoutVertexArray.emplaceBack(ae[Pe].x,ae[Pe].y),this.indexArray2.emplaceBack(Ee+Pe-1,Ee+Pe),G.push(ae[Pe].x),G.push(ae[Pe].y);pe.vertexLength+=ae.length,pe.primitiveLength+=ae.length}const ne=p(G,Y);for(let ae=0;ae<ne.length;ae+=3)this.indexArray.emplaceBack(U+ne[ae],U+ne[ae+1],U+ne[ae+2]);P.vertexLength+=M,P.primitiveLength+=ne.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,x,C,m)}}Kn(Ce,"FillBucket",{omit:["layers","patternFeatures"]});const Ne=new Ve({"fill-sort-key":new Te(Et.layout_fill["fill-sort-key"])});var ot={paint:new Ve({"fill-antialias":new he(Et.paint_fill["fill-antialias"]),"fill-opacity":new Te(Et.paint_fill["fill-opacity"]),"fill-color":new Te(Et.paint_fill["fill-color"]),"fill-outline-color":new Te(Et.paint_fill["fill-outline-color"]),"fill-translate":new he(Et.paint_fill["fill-translate"]),"fill-translate-anchor":new he(Et.paint_fill["fill-translate-anchor"]),"fill-pattern":new Te(Et.paint_fill["fill-pattern"])}),layout:Ne};const ut=pt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),at=pt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pt=pt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Wt}=ut;var wn={},Un=rr,Xn=hr;function hr(o,t,l,h,m){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=h,this._values=m,o.readFields(Ei,this,t)}function Ei(o,t,l){1==o?t.id=l.readVarint():2==o?function(h,m){for(var x=h.readVarint()+h.pos;h.pos<x;){var C=m._keys[h.readVarint()],D=m._values[h.readVarint()];m.properties[C]=D}}(l,t):3==o?t.type=l.readVarint():4==o&&(t._geometry=l.pos)}function fi(o){for(var t,l,h=0,m=0,x=o.length,C=x-1;m<x;C=m++)h+=((l=o[C]).x-(t=o[m]).x)*(t.y+l.y);return h}hr.types=["Unknown","Point","LineString","Polygon"],hr.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var t,l=o.readVarint()+o.pos,h=1,m=0,x=0,C=0,D=[];o.pos<l;){if(m<=0){var M=o.readVarint();h=7&M,m=M>>3}if(m--,1===h||2===h)x+=o.readSVarint(),C+=o.readSVarint(),1===h&&(t&&D.push(t),t=[]),t.push(new Un(x,C));else{if(7!==h)throw new Error("unknown command "+h);t&&t.push(t[0].clone())}}return t&&D.push(t),D},hr.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var t=o.readVarint()+o.pos,l=1,h=0,m=0,x=0,C=1/0,D=-1/0,M=1/0,P=-1/0;o.pos<t;){if(h<=0){var U=o.readVarint();l=7&U,h=U>>3}if(h--,1===l||2===l)(m+=o.readSVarint())<C&&(C=m),m>D&&(D=m),(x+=o.readSVarint())<M&&(M=x),x>P&&(P=x);else if(7!==l)throw new Error("unknown command "+l)}return[C,M,D,P]},hr.prototype.toGeoJSON=function(o,t,l){var h,m,x=this.extent*Math.pow(2,l),C=this.extent*o,D=this.extent*t,M=this.loadGeometry(),P=hr.types[this.type];function U(ne){for(var ae=0;ae<ne.length;ae++){var pe=ne[ae];ne[ae]=[360*(pe.x+C)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+D)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<M.length;h++)G[h]=M[h][0];U(M=G);break;case 2:for(h=0;h<M.length;h++)U(M[h]);break;case 3:for(M=function(ne){var ae=ne.length;if(ae<=1)return[ne];for(var pe,Ee,Pe=[],We=0;We<ae;We++){var Le=fi(ne[We]);0!==Le&&(void 0===Ee&&(Ee=Le<0),Ee===Le<0?(pe&&Pe.push(pe),pe=[ne[We]]):pe.push(ne[We]))}return pe&&Pe.push(pe),Pe}(M),h=0;h<M.length;h++)for(m=0;m<M[h].length;m++)U(M[h][m])}1===M.length?M=M[0]:P="Multi"+P;var Y={type:"Feature",geometry:{type:P,coordinates:M},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var xa=Xn,so=xs;function xs(o,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(fc,this,t),this.length=this._features.length}function fc(o,t,l){15===o?t.version=l.readVarint():1===o?t.name=l.readString():5===o?t.extent=l.readVarint():2===o?t._features.push(l.pos):3===o?t._keys.push(l.readString()):4===o&&t._values.push(function(h){for(var m=null,x=h.readVarint()+h.pos;h.pos<x;){var C=h.readVarint()>>3;m=1===C?h.readString():2===C?h.readFloat():3===C?h.readDouble():4===C?h.readVarint64():5===C?h.readVarint():6===C?h.readSVarint():7===C?h.readBoolean():null}return m}(l))}xs.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var t=this._pbf.readVarint()+this._pbf.pos;return new xa(this._pbf,t,this.extent,this._keys,this._values)};var ed=so;function Xh(o,t,l){if(3===o){var h=new ed(l,l.readVarint()+l.pos);h.length&&(t[h.name]=h)}}var sh=wn.VectorTile=function(o,t){this.layers=o.readFields(Xh,{},t)},Id=wn.VectorTileFeature=Xn;function Cp(o,t,l,h){const m=[],x=0===h?(C,D,M,P,U,G)=>{C.push(new gt(G,M+(G-D)/(P-D)*(U-M)))}:(C,D,M,P,U,G)=>{C.push(new gt(D+(G-M)/(U-M)*(P-D),G))};for(const C of o){const D=[];for(const M of C){if(M.length<=2)continue;const P=[];for(let Y=0;Y<M.length-1;Y++){const ne=M[Y].x,ae=M[Y].y,pe=M[Y+1].x,Ee=M[Y+1].y,Pe=0===h?ne:ae,We=0===h?pe:Ee;Pe<t?We>t&&x(P,ne,ae,pe,Ee,t):Pe>l?We<l&&x(P,ne,ae,pe,Ee,l):P.push(M[Y]),We<t&&Pe>=t&&x(P,ne,ae,pe,Ee,t),We>l&&Pe<=l&&x(P,ne,ae,pe,Ee,l)}let U=M[M.length-1];const G=0===h?U.x:U.y;G>=t&&G<=l&&P.push(U),P.length&&(U=P[P.length-1],P[0].x===U.x&&P[0].y===U.y||P.push(P[0]),D.push(P))}D.length&&m.push(D)}return m}wn.VectorTileLayer=so;const c_=Id.types,Um=Math.pow(2,13);function Md(o,t,l,h,m,x,C,D){o.emplaceBack((t<<1)+C,(l<<1)+x,(Math.floor(h*Um)<<1)+m,Math.round(D))}function Ff(o,t,l){o.emplaceBack(t.x,t.y,t.z,16384*l[0],16384*l[1],16384*l[2])}class Ap{constructor(){this.acc=new gt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new gt(t.x,t.y),this.max=new gt(t.x,t.y))}append(t,l){this.currentPolyCount.edges++,this.acc._add(t);const h=this.min,m=this.max;t.x<h.x?h.x=t.x:t.x>m.x&&(m.x=t.x),t.y<h.y?h.y=t.y:t.y>m.y&&(m.y=t.y),((0===t.x||t.x===Tr)&&t.x===l.x)!=((0===t.y||t.y===Tr)&&t.y===l.y)&&this.processBorderOverlap(t,l),l.x<0!=t.x<0&&this.addBorderIntersection(0,ri(l.y,t.y,(0-l.x)/(t.x-l.x))),l.x>Tr!=t.x>Tr&&this.addBorderIntersection(1,ri(l.y,t.y,(Tr-l.x)/(t.x-l.x))),l.y<0!=t.y<0&&this.addBorderIntersection(2,ri(l.x,t.x,(0-l.y)/(t.y-l.y))),l.y>Tr!=t.y>Tr&&this.addBorderIntersection(3,ri(l.x,t.x,(Tr-l.y)/(t.y-l.y)))}addBorderIntersection(t,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[t];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(t,l){if(t.x===l.x){if(t.y===l.y)return;const h=0===t.x?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,t.y)}else{const h=0===t.y?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,t.x)}}centroid(){const t=this.polyCount.reduce((l,h)=>l+h.edges,0);return 0!==t?this.acc.div(t)._round():new gt(0,0)}span(){return new gt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,l)=>t+ +(l[0]!==Number.MAX_VALUE),0)}}class Bf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new sn,this.centroidVertexArray=new Ql,this.indexArray=new dr,this.programConfigurations=new Hd(t.layers,t.zoom),this.segments=new So,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=t.enableTerrain}populate(t,l,h,m){this.features=[],this.hasPattern=ee("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(x){const C=Math.exp(Math.PI*(1-x.y/(1<<x.z)*2));return 80150034*C/(C*C+1)/Tr/(1<<x.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:x,id:C,index:D,sourceLayerIndex:M}of t){const P=this.layers[0]._featureFilter.needGeometry,U=kc(x,P);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),U,h))continue;const G={id:C,sourceLayerIndex:M,index:D,geometry:P?U.geometry:zl(x,h,m),properties:x.properties,type:x.type,patterns:{}},Y=this.layoutVertexArray.length;this.hasPattern?this.features.push(oe("fill-extrusion",this.layers,G,this.zoom,l)):this.addFeature(G,G.geometry,D,h,{},l.availableImages,m),l.featureIndex.insert(x,G.geometry,D,M,this.index,Y)}this.sortBorders()}addFeatures(t,l,h,m,x){for(const C of this.features){const{geometry:D}=C;this.addFeature(C,D,C.index,l,h,m,x)}this.sortBorders()}update(t,l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wt),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Pt.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,at.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,h,m,x,C,D){const M=[new gt(0,0),new gt(Tr,Tr)],P=D.projection,U="globe"===P.name,G=this.enableTerrain&&!U?new Ap:null,Y="Polygon"===c_[t.type];U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cn);const ne=V(l,500);for(let Pe=ne.length-1;Pe>=0;Pe--){const We=ne[Pe];(0===We.length||(ae=We[0]).every(Le=>Le.x<=0)||ae.every(Le=>Le.x>=Tr)||ae.every(Le=>Le.y<=0)||ae.every(Le=>Le.y>=Tr))&&ne.splice(Pe,1)}var ae;let pe;if(U)pe=Gm(ne,M,m);else{pe=[];for(const Pe of ne)pe.push({polygon:Pe,bounds:M})}const Ee=Y?this.edgeRadius:0;for(const{polygon:Pe,bounds:We}of pe){let Le=0,$e=0;for(const Xe of Pe)Y&&!Xe[0].equals(Xe[Xe.length-1])&&Xe.push(Xe[0]),$e+=Y?Xe.length-1:Xe.length;const et=this.segments.prepareSegment((Y?5:4)*$e,this.layoutVertexArray,this.indexArray);if(Y){const Xe=[],Ft=[];Le=et.vertexLength;for(const tn of Pe){let Dn,Ht;tn.length&&tn!==Pe[0]&&Ft.push(Xe.length/2),Dn=tn[1].sub(tn[0])._perp()._unit();for(let cn=1;cn<tn.length;cn++){const fn=tn[cn],bn=tn[cn===tn.length-1?1:cn+1];let{x:Pn,y:Jt}=fn;if(Ee){Ht=bn.sub(fn)._perp()._unit();const qn=Dn.add(Ht)._unit(),ar=Ee*Math.min(4,1/(Dn.x*qn.x+Dn.y*qn.y));Pn+=ar*qn.x,Jt+=ar*qn.y,Dn=Ht}Md(this.layoutVertexArray,Pn,Jt,0,0,1,1,0),et.vertexLength++,Xe.push(fn.x,fn.y),U&&Ff(this.layoutVertexExtArray,P.projectTilePoint(Pn,Jt,m),P.upVector(m,Pn,Jt))}}const Rt=p(Xe,Ft);for(let tn=0;tn<Rt.length;tn+=3)this.indexArray.emplaceBack(Le+Rt[tn],Le+Rt[tn+2],Le+Rt[tn+1]),et.primitiveLength++}for(const Xe of Pe){G&&Xe.length&&G.startRing(Xe[0]);let Ft,Rt,tn,Dn=Xe.length>4&&Rg(Xe[Xe.length-2],Xe[0],Xe[1]),Ht=Ee?u_(Xe[Xe.length-2],Xe[0],Xe[1],Ee):0;Rt=Xe[1].sub(Xe[0])._perp()._unit();let cn=!0;for(let fn=1,bn=0;fn<Xe.length;fn++){let Pn=Xe[fn-1],Jt=Xe[fn];const qn=Xe[fn===Xe.length-1?1:fn+1];if(G&&Y&&G.currentPolyCount.top++,Dp(Jt,Pn,We)){Ee&&(Rt=qn.sub(Jt)._perp()._unit(),cn=!cn);continue}G&&G.append(Jt,Pn);const ar=Jt.sub(Pn)._perp(),Yn=ar.x/(Math.abs(ar.x)+Math.abs(ar.y)),li=ar.y>0?1:0,Rn=Pn.dist(Jt);if(bn+Rn>32768&&(bn=0),Ee){tn=qn.sub(Jt)._perp()._unit();let ui=Vm(Pn,Jt,qn,ah(Rt,tn),Ee);isNaN(ui)&&(ui=0);const jr=Jt.sub(Pn)._unit();Pn=Pn.add(jr.mult(Ht))._round(),Jt=Jt.add(jr.mult(-ui))._round(),Ht=ui,Rt=tn}const Ar=et.vertexLength,ci=Xe.length>4&&Rg(Pn,Jt,qn);let qi=jm(bn,Dn,cn);if(Md(this.layoutVertexArray,Pn.x,Pn.y,Yn,li,0,0,qi),Md(this.layoutVertexArray,Pn.x,Pn.y,Yn,li,0,1,qi),bn+=Rn,qi=jm(bn,ci,!cn),Dn=ci,Md(this.layoutVertexArray,Jt.x,Jt.y,Yn,li,0,0,qi),Md(this.layoutVertexArray,Jt.x,Jt.y,Yn,li,0,1,qi),et.vertexLength+=4,this.indexArray.emplaceBack(Ar+0,Ar+1,Ar+2),this.indexArray.emplaceBack(Ar+1,Ar+3,Ar+2),et.primitiveLength+=2,Ee){const ui=Le+(1===fn?Xe.length-2:fn-2),jr=1===fn?Le:ui+1;if(this.indexArray.emplaceBack(Ar+1,ui,Ar+3),this.indexArray.emplaceBack(ui,jr,Ar+3),et.primitiveLength+=2,void 0===Ft&&(Ft=Ar),!Dp(qn,Xe[fn],We)){const ss=fn===Xe.length-1?Ft:et.vertexLength;this.indexArray.emplaceBack(Ar+2,Ar+3,ss),this.indexArray.emplaceBack(Ar+3,ss+1,ss),this.indexArray.emplaceBack(Ar+3,jr,ss+1),et.primitiveLength+=3}cn=!cn}if(U){const ui=this.layoutVertexExtArray,jr=P.projectTilePoint(Pn.x,Pn.y,m),ss=P.projectTilePoint(Jt.x,Jt.y,m),pi=P.upVector(m,Pn.x,Pn.y),gi=P.upVector(m,Jt.x,Jt.y);Ff(ui,jr,pi),Ff(ui,jr,pi),Ff(ui,ss,gi),Ff(ui,ss,gi)}}Y&&(Le+=Xe.length-1)}}if(G&&G.polyCount.length>0){if(G.borders){G.vertexArrayOffset=this.centroidVertexArray.length;const Pe=G.borders,We=this.featuresOnBorder.push(G)-1;for(let Le=0;Le<4;Le++)Pe[Le][0]!==Number.MAX_VALUE&&this.borders[Le].push(We)}this.encodeCentroid(G.borders?void 0:G.centroid(),G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,x,C,m)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((l,h)=>this.featuresOnBorder[l].borders[t][0]-this.featuresOnBorder[h].borders[t][0])}encodeCentroid(t,l,h=!0){let m,x;if(t)if(0!==t.y){const D=l.span()._mult(this.tileToMeter);m=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(D.x/10)),x=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(D.y/10))}else m=Math.ceil(7*(t.x+450)),x=0;else m=0,x=+h;let C=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const D of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*D.edges+D.top);for(let M=0;M<D.top;M++)this.centroidVertexArray.emplace(C++,m,x);for(let M=0;M<2*D.edges;M++)this.centroidVertexArray.emplace(C++,0,x),this.centroidVertexArray.emplace(C++,m,x)}}}function ah(o,t){const l=o.add(t)._unit();return o.x*l.x+o.y*l.y}function u_(o,t,l,h){const m=t.sub(o)._perp()._unit(),x=l.sub(t)._perp()._unit();return Vm(o,t,l,ah(m,x),h)}function Vm(o,t,l,h,m){const x=Math.sqrt(1-h*h);return Math.min(o.dist(t)/3,t.dist(l)/3,m*x/h)}function Dp(o,t,l){return o.x<l[0].x&&t.x<l[0].x||o.x>l[1].x&&t.x>l[1].x||o.y<l[0].y&&t.y<l[0].y||o.y>l[1].y&&t.y>l[1].y}function Rg(o,t,l){if(o.x<0||o.x>=Tr||t.x<0||t.x>=Tr||l.x<0||l.x>=Tr)return!1;const h=l.sub(t),m=h.perp(),x=o.sub(t);return(h.x*x.x+h.y*x.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(x.x*x.x+x.y*x.y))>-.866&&m.x*x.x+m.y*x.y<0}function jm(o,t,l){const h=t?2|o:-3&o;return l?1|h:-2&h}function Hm(){const o=Math.PI/32,t=Math.tan(o),l=ya;return l*Math.sqrt(1+2*t*t)-l}function Gm(o,t,l){const h=1<<l.z,m=Rs(l.x/h),x=Rs((l.x+1)/h),C=La(l.y/h),D=La((l.y+1)/h);return function(M,P,U,G,Y=0,ne){const ae=[];if(!M.length||!U||!G)return ae;const pe=(Xe,Ft)=>{for(const Rt of Xe)ae.push({polygon:Rt,bounds:Ft})},Ee=Math.ceil(Math.log2(U)),Pe=Math.ceil(Math.log2(G)),We=Ee-Pe,Le=[];for(let Xe=0;Xe<Math.abs(We);Xe++)Le.push(We>0?0:1);for(let Xe=0;Xe<Math.min(Ee,Pe);Xe++)Le.push(0),Le.push(1);let $e=M;if($e=Cp($e,P[0].y-Y,P[1].y+Y,1),$e=Cp($e,P[0].x-Y,P[1].x+Y,0),!$e.length)return ae;const et=[];for(Le.length?et.push({polygons:$e,bounds:P,depth:0}):pe($e,P);et.length;){const Xe=et.pop(),Ft=Xe.depth,Rt=Le[Ft],tn=Xe.bounds[0],Dn=Xe.bounds[1],Ht=0===Rt?tn.x:tn.y,cn=0===Rt?Dn.x:Dn.y,fn=ne?ne(Rt,Ht,cn):.5*(Ht+cn),bn=Cp(Xe.polygons,Ht-Y,fn+Y,Rt),Pn=Cp(Xe.polygons,fn-Y,cn+Y,Rt);if(bn.length){const Jt=[tn,new gt(0===Rt?fn:Dn.x,1===Rt?fn:Dn.y)];Le.length>Ft+1?et.push({polygons:bn,bounds:Jt,depth:Ft+1}):pe(bn,Jt)}if(Pn.length){const Jt=[new gt(0===Rt?fn:tn.x,1===Rt?fn:tn.y),Dn];Le.length>Ft+1?et.push({polygons:Pn,bounds:Jt,depth:Ft+1}):pe(Pn,Jt)}}return ae}(o,t,Math.ceil((x-m)/11.25),Math.ceil((C-D)/11.25),1,(M,P,U)=>{if(0===M)return.5*(P+U);{const G=La((l.y+P/Tr)/h);return(Vs(.5*(La((l.y+U/Tr)/h)+G))*h-l.y)*Tr}})}Kn(Bf,"FillExtrusionBucket",{omit:["layers","features"]}),Kn(Ap,"PartMetadata");const d_=new Ve({"fill-extrusion-edge-radius":new he(Et["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var $m={paint:new Ve({"fill-extrusion-opacity":new he(Et["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Te(Et["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(Et["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(Et["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Te(Et["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Te(Et["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Te(Et["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(Et["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(Et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(Et["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new he(Et["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:d_};function h_(o,t,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[o*h-2*Math.PI*6378137/2,t*h-2*Math.PI*6378137/2]}class Lg{constructor(t,l,h){this.z=t,this.x=l,this.y=h,this.key=td(0,t,t,l,h)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l){const h=(C=this.y,D=this.z,M=h_(256*(x=this.x),256*(C=Math.pow(2,D)-C-1),D),P=h_(256*(x+1),256*(C+1),D),M[0]+","+M[1]+","+P[0]+","+P[1]),m=function(x,C,D){let M,P="";for(let U=x;U>0;U--)M=1<<U-1,P+=(C&M?1:0)+(D&M?2:0);return P}(this.z,this.x,this.y);var x,C,D,M,P;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yh{constructor(t,l){this.wrap=t,this.canonical=l,this.key=td(t,l.z,l.z,l.x,l.y)}}class Si{constructor(t,l,h,m,x){this.overscaledZ=t,this.wrap=l,this.canonical=new Lg(h,+m,+x),this.key=0===l&&t===h?this.canonical.key:td(l,t,h,m,x)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const l=this.canonical.z-t;return t>this.canonical.z?new Si(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Si(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(t,l=!0){if(this.overscaledZ===t&&l)return this.key;if(t>this.canonical.z)return td(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-t;return td(this.wrap*+l,t,t,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const l=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new Si(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new Si(l,this.wrap,l,h,m),new Si(l,this.wrap,l,h+1,m),new Si(l,this.wrap,l,h,m+1),new Si(l,this.wrap,l,h+1,m+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Si(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Si(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function td(o,t,l,h,m){const x=1<<Math.min(l,22);let C=x*(m%x)+h%x;return o&&l<22&&(C+=x*x*((o<0?-2*o-1:2*o)%(1<<2*(22-l)))),16*(32*C+l)+(t-l)}Kn(Lg,"CanonicalTileID"),Kn(Si,"OverscaledTileID",{omit:["projMatrix"]});class lh extends gt{constructor(t,l,h){super(t,l),this.z=h}}function Kh(o,t){return o.x*t.x+o.y*t.y}function Tp(o,t){if(1===o.length){let l=0;const h=t[l++];let m;for(;!m||h.equals(m);)if(m=t[l++],!m)return 1/0;for(;l<t.length;l++){const x=t[l],C=o[0],D=m.sub(h),M=x.sub(h),P=C.sub(h),U=Kh(D,D),G=Kh(D,M),Y=Kh(M,M),ne=Kh(P,D),ae=Kh(P,M),pe=U*Y-G*G,Ee=(Y*ne-G*ae)/pe,Pe=(U*ae-G*ne)/pe,We=h.z*(1-Ee-Pe)+m.z*Ee+x.z*Pe;if(isFinite(We))return We}return 1/0}{let l=1/0;for(const h of t)l=Math.min(l,h.z);return l}}function Sp(o,t,l,h,m,x,C,D){const M=C*m.getElevationAt(o,t,!0,!0),P=0!==x[0],U=P?0===x[1]?C*(x[0]/7-450):C*function(G,Y,ne){const ae=Math.floor(Y[0]/8),pe=Math.floor(Y[1]/8),Ee=10*(Y[0]-8*ae),Pe=10*(Y[1]-8*pe),We=G.getElevationAt(ae,pe,!0,!0),Le=G.getMeterToDEM(ne),$e=Math.floor(.5*(Ee*Le-1)),et=Math.floor(.5*(Pe*Le-1)),Xe=G.tileCoordToPixel(ae,pe),Ft=2*$e+1,Rt=2*et+1,tn=(ar=Ft,Yn=Rt,[(Pn=G).getElevationAtPixel(Jt=Xe.x-$e,qn=Xe.y-et,!0),Pn.getElevationAtPixel(Jt+Yn,qn,!0),Pn.getElevationAtPixel(Jt,qn+Yn,!0),Pn.getElevationAtPixel(Jt+ar,qn+Yn,!0)]),Dn=Math.abs(tn[0]-tn[1]),Ht=Math.abs(tn[2]-tn[3]),cn=Math.abs(tn[0]-tn[2])+Math.abs(tn[1]-tn[3]),fn=Math.min(.25,.5*Le*(Dn+Ht)/Ft),bn=Math.min(.25,.5*Le*cn/Rt);var Pn,Jt,qn,ar,Yn;return We+Math.max(fn*Ee,bn*Pe)}(m,x,D):M;return{base:M+(0===l)?-1:l,top:P?Math.max(U+h,M+l+2):M+h}}const f_=pt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Wm}=f_,Zm=pt([{name:"a_packed",components:4,type:"Float32"}]),{members:Ip}=Zm,Uv=Id.types,Ng=Math.cos(Math.PI/180*37.5);class Mp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new jt,this.layoutVertexArray2=new yn,this.indexArray=new dr,this.programConfigurations=new Hd(t.layers,t.zoom),this.segments=new So,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,h,m){this.hasPattern=ee("line",this.layers,l);const x=this.layers[0].layout.get("line-sort-key"),C=[];for(const{feature:U,id:G,index:Y,sourceLayerIndex:ne}of t){const ae=this.layers[0]._featureFilter.needGeometry,pe=kc(U,ae);if(!this.layers[0]._featureFilter.filter(new H(this.zoom),pe,h))continue;const Ee=x?x.evaluate(pe,{},h):void 0,Pe={id:G,properties:U.properties,type:U.type,sourceLayerIndex:ne,index:Y,geometry:ae?pe.geometry:zl(U,h,m),patterns:{},sortKey:Ee};C.push(Pe)}x&&C.sort((U,G)=>U.sortKey-G.sortKey);const{lineAtlas:D,featureIndex:M}=l,P=this.addConstantDashes(D);for(const U of C){const{geometry:G,index:Y,sourceLayerIndex:ne}=U;if(P&&this.addFeatureDashes(U,D),this.hasPattern){const ae=oe("line",this.layers,U,this.zoom,l);this.patternFeatures.push(ae)}else this.addFeature(U,G,Y,h,D.positions,l.availableImages);M.insert(t[Y].feature,G,Y,ne,this.index)}}addConstantDashes(t){let l=!1;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==x.kind)l=!0;else{const C=x.value,D=m.value;if(!D)continue;t.addDash(D,C)}}return l}addFeatureDashes(t,l){const h=this.zoom;for(const m of this.layers){const x=m.paint.get("line-dasharray").value,C=m.layout.get("line-cap").value;if("constant"===x.kind&&"constant"===C.kind)continue;let D,M;if("constant"===x.kind){if(D=x.value,!D)continue}else D=x.evaluate({zoom:h},t);M="constant"===C.kind?C.value:C.evaluate({zoom:h},t),l.addDash(D,M),t.patterns[m.id]=l.getKey(D,M)}}update(t,l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,h,m)}addFeatures(t,l,h,m,x){for(const C of this.patternFeatures)this.addFeature(C,C.geometry,C.index,l,h,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ip)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,h,m,x,C){const D=this.layers[0].layout,M=D.get("line-join").evaluate(t,{}),P=D.get("line-cap").evaluate(t,{}),U=D.get("line-miter-limit"),G=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const Y of l)this.addLine(Y,t,M,P,U,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,h,x,C,m)}addLine(t,l,h,m,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<t.length-1;Pe++)this.totalDistance+=t[Pe].dist(t[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===Uv[l.type];let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let P=0;for(;P<M-1&&t[P].equals(t[P+1]);)P++;if(M<(D?3:2))return;"bevel"===h&&(x=1.05);const U=this.overscaling<=16?15*Tr/(512*this.overscaling):0,G=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let Y,ne,ae,pe,Ee;this.e1=this.e2=-1,D&&(Y=t[M-2],Ee=t[P].sub(Y)._unit()._perp());for(let Pe=P;Pe<M;Pe++){if(ae=Pe===M-1?D?t[P+1]:void 0:t[Pe+1],ae&&t[Pe].equals(ae))continue;Ee&&(pe=Ee),Y&&(ne=Y),Y=t[Pe],Ee=ae?ae.sub(Y)._unit()._perp():pe,pe=pe||Ee;let We=pe.add(Ee);0===We.x&&0===We.y||We._unit();const Le=pe.x*Ee.x+pe.y*Ee.y,$e=We.x*Ee.x+We.y*Ee.y,et=0!==$e?1/$e:1/0,Xe=2*Math.sqrt(2-2*$e),Ft=$e<Ng&&ne&&ae,Rt=pe.x*Ee.y-pe.y*Ee.x>0;if(Ft&&Pe>P){const Ht=Y.dist(ne);if(Ht>2*U){const cn=Y.sub(Y.sub(ne)._mult(U/Ht)._round());this.updateDistance(ne,cn),this.addCurrentVertex(cn,pe,0,0,G),ne=cn}}const tn=ne&&ae;let Dn=tn?h:D?"butt":m;if(tn&&"round"===Dn&&(et<C?Dn="miter":et<=2&&(Dn="fakeround")),"miter"===Dn&&et>x&&(Dn="bevel"),"bevel"===Dn&&(et>2&&(Dn="flipbevel"),et<x&&(Dn="miter")),ne&&this.updateDistance(ne,Y),"miter"===Dn)We._mult(et),this.addCurrentVertex(Y,We,0,0,G);else if("flipbevel"===Dn){if(et>100)We=Ee.mult(-1);else{const Ht=et*pe.add(Ee).mag()/pe.sub(Ee).mag();We._perp()._mult(Ht*(Rt?-1:1))}this.addCurrentVertex(Y,We,0,0,G),this.addCurrentVertex(Y,We.mult(-1),0,0,G)}else if("bevel"===Dn||"fakeround"===Dn){const Ht=-Math.sqrt(et*et-1),cn=Rt?Ht:0,fn=Rt?0:Ht;if(ne&&this.addCurrentVertex(Y,pe,cn,fn,G),"fakeround"===Dn){const bn=Math.round(180*Xe/Math.PI/20);for(let Pn=1;Pn<bn;Pn++){let Jt=Pn/bn;if(.5!==Jt){const ar=Jt-.5;Jt+=Jt*ar*(Jt-1)*((1.0904+Le*(Le*(3.55645-1.43519*Le)-3.2452))*ar*ar+(.848013+Le*(.215638*Le-1.06021)))}const qn=Ee.sub(pe)._mult(Jt)._add(pe)._unit()._mult(Rt?-1:1);this.addHalfVertex(Y,qn.x,qn.y,!1,Rt,0,G)}}ae&&this.addCurrentVertex(Y,Ee,-cn,-fn,G)}else if("butt"===Dn)this.addCurrentVertex(Y,We,0,0,G);else if("square"===Dn){const Ht=ne?1:-1;ne||this.addCurrentVertex(Y,We,Ht,Ht,G),this.addCurrentVertex(Y,We,0,0,G),ne&&this.addCurrentVertex(Y,We,Ht,Ht,G)}else"round"===Dn&&(ne&&(this.addCurrentVertex(Y,pe,0,0,G),this.addCurrentVertex(Y,pe,1,1,G,!0)),ae&&(this.addCurrentVertex(Y,Ee,-1,-1,G,!0),this.addCurrentVertex(Y,Ee,0,0,G)));if(Ft&&Pe<M-1){const Ht=Y.dist(ae);if(Ht>2*U){const cn=Y.add(ae.sub(Y)._mult(U/Ht)._round());this.updateDistance(Y,cn),this.addCurrentVertex(cn,Ee,0,0,G),Y=cn}}}}addCurrentVertex(t,l,h,m,x,C=!1){const D=l.y*m-l.x,M=-l.y-l.x*m;this.addHalfVertex(t,l.x+l.y*h,l.y-l.x*h,C,!1,h,x),this.addHalfVertex(t,D,M,C,!0,-m,x)}addHalfVertex({x:t,y:l},h,m,x,C,D,M){this.layoutVertexArray.emplaceBack((t<<1)+(x?1:0),(l<<1)+(C?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const P=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),M.primitiveLength++),C?this.e2=P:this.e1=P}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}}Kn(Mp,"LineBucket",{omit:["layers","patternFeatures"]});const kg=new Ve({"line-cap":new Te(Et.layout_line["line-cap"]),"line-join":new Te(Et.layout_line["line-join"]),"line-miter-limit":new he(Et.layout_line["line-miter-limit"]),"line-round-limit":new he(Et.layout_line["line-round-limit"]),"line-sort-key":new Te(Et.layout_line["line-sort-key"])});var Fg={paint:new Ve({"line-opacity":new Te(Et.paint_line["line-opacity"]),"line-color":new Te(Et.paint_line["line-color"]),"line-translate":new he(Et.paint_line["line-translate"]),"line-translate-anchor":new he(Et.paint_line["line-translate-anchor"]),"line-width":new Te(Et.paint_line["line-width"]),"line-gap-width":new Te(Et.paint_line["line-gap-width"]),"line-offset":new Te(Et.paint_line["line-offset"]),"line-blur":new Te(Et.paint_line["line-blur"]),"line-dasharray":new Te(Et.paint_line["line-dasharray"]),"line-pattern":new Te(Et.paint_line["line-pattern"]),"line-gradient":new Be(Et.paint_line["line-gradient"]),"line-trim-offset":new he(Et.paint_line["line-trim-offset"])}),layout:kg};const Bg=new class extends Te{possiblyEvaluate(o,t){return t=new H(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(o,t)}evaluate(o,t,l,h){return t=At({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(o,t,l,h)}}(Fg.paint.properties["line-width"].specification);function Od(o,t){return t>0?t+2*o:o}Bg.useIntegerZoom=!0;const p_=pt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),zg=pt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Op=pt([{name:"a_projected_pos",components:4,type:"Float32"}],4);pt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const g_=pt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ug=pt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zf=pt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Su=pt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);pt([{name:"triangle",components:3,type:"Uint16"}]),pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),pt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pt([{type:"Float32",name:"offsetX"}]),pt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wa=24;const pc=128;function Vg(o,t){const{expression:l}=t;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new H(o+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:m}=l;let x=0;for(;x<h.length&&h[x]<=o;)x++;x=Math.max(0,x-1);let C=x;for(;C<h.length&&h[C]<o+1;)C++;C=Math.min(h.length-1,C);const D=h[x],M=h[C];return"composite"===l.kind?{kind:"composite",minZoom:D,maxZoom:M,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:M,minSize:l.evaluate(new H(D)),maxSize:l.evaluate(new H(M)),interpolationType:m}}}function Pp(o,{uSize:t,uSizeT:l},{lowerSize:h,upperSize:m}){return"source"===o.kind?h/pc:"composite"===o.kind?ri(h/pc,m/pc,l):t}function ch(o,t){let l=0,h=0;if("constant"===o.kind)h=o.layoutSize;else if("source"!==o.kind){const{interpolationType:m,minZoom:x,maxZoom:C}=o,D=m?xr(Gr.interpolationFactor(m,t,x,C),0,1):0;"camera"===o.kind?h=ri(o.minSize,o.maxSize,D):l=D}return{uSizeT:l,uSize:h}}var Jh=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:pc,evaluateSizeForFeature:Pp,evaluateSizeForZoom:ch,getSizeData:Vg});function m_(o,t,l){return o.sections.forEach(h=>{h.text=function(m,x,C){const D=x.layout.get("text-transform").evaluate(C,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),k.applyArabicShaping&&(m=k.applyArabicShaping(m)),m}(h.text,t,l)}),o}const Uf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function __(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function jg(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Hg=Ro,qm=function(o,t,l,h,m){var x,C,D=8*m-h-1,M=(1<<D)-1,P=M>>1,U=-7,G=l?m-1:0,Y=l?-1:1,ne=o[t+G];for(G+=Y,x=ne&(1<<-U)-1,ne>>=-U,U+=D;U>0;x=256*x+o[t+G],G+=Y,U-=8);for(C=x&(1<<-U)-1,x>>=-U,U+=h;U>0;C=256*C+o[t+G],G+=Y,U-=8);if(0===x)x=1-P;else{if(x===M)return C?NaN:1/0*(ne?-1:1);C+=Math.pow(2,h),x-=P}return(ne?-1:1)*C*Math.pow(2,x-h)},Gg=function(o,t,l,h,m,x){var C,D,M,P=8*x-m-1,U=(1<<P)-1,G=U>>1,Y=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,ne=h?0:x-1,ae=h?1:-1,pe=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(D=isNaN(t)?1:0,C=U):(C=Math.floor(Math.log(t)/Math.LN2),t*(M=Math.pow(2,-C))<1&&(C--,M*=2),(t+=C+G>=1?Y/M:Y*Math.pow(2,1-G))*M>=2&&(C++,M/=2),C+G>=U?(D=0,C=U):C+G>=1?(D=(t*M-1)*Math.pow(2,m),C+=G):(D=t*Math.pow(2,G-1)*Math.pow(2,m),C=0));m>=8;o[l+ne]=255&D,ne+=ae,D/=256,m-=8);for(C=C<<m|D,P+=m;P>0;o[l+ne]=255&C,ne+=ae,C/=256,P-=8);o[l+ne-ae]|=128*pe};function Ro(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Ro.Varint=0,Ro.Fixed64=1,Ro.Bytes=2,Ro.Fixed32=5;var Xm=4294967296,v_=1/Xm,Ym=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function nd(o){return o.type===Ro.Bytes?o.readVarint()+o.pos:o.pos+1}function y_(o,t,l){var h=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(h);for(var m=l.pos-1;m>=o;m--)l.buf[m+h]=l.buf[m]}function Rp(o,t){for(var l=0;l<o.length;l++)t.writeVarint(o[l])}function x_(o,t){for(var l=0;l<o.length;l++)t.writeSVarint(o[l])}function $g(o,t){for(var l=0;l<o.length;l++)t.writeFloat(o[l])}function Wg(o,t){for(var l=0;l<o.length;l++)t.writeDouble(o[l])}function Qh(o,t){for(var l=0;l<o.length;l++)t.writeBoolean(o[l])}function Zg(o,t){for(var l=0;l<o.length;l++)t.writeFixed32(o[l])}function qg(o,t){for(var l=0;l<o.length;l++)t.writeSFixed32(o[l])}function jf(o,t){for(var l=0;l<o.length;l++)t.writeFixed64(o[l])}function Lp(o,t){for(var l=0;l<o.length;l++)t.writeSFixed64(o[l])}function rd(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+16777216*o[t+3]}function Pd(o,t,l){o[l]=t,o[l+1]=t>>>8,o[l+2]=t>>>16,o[l+3]=t>>>24}function Np(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+(o[t+3]<<24)}Ro.prototype={destroy:function(){this.buf=null},readFields:function(o,t,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),m=h>>3,x=this.pos;this.type=7&h,o(m,t,this),this.pos===x&&this.skip(h)}return t},readMessage:function(o,t){return this.readFields(o,t,this.readVarint()+this.pos)},readFixed32:function(){var o=rd(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Np(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=rd(this.buf,this.pos)+rd(this.buf,this.pos+4)*Xm;return this.pos+=8,o},readSFixed64:function(){var o=rd(this.buf,this.pos)+Np(this.buf,this.pos+4)*Xm;return this.pos+=8,o},readFloat:function(){var o=qm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=qm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var t,l,h=this.buf;return t=127&(l=h[this.pos++]),l<128?t:(t|=(127&(l=h[this.pos++]))<<7,l<128?t:(t|=(127&(l=h[this.pos++]))<<14,l<128?t:(t|=(127&(l=h[this.pos++]))<<21,l<128?t:function(m,x,C){var D,M,P=C.buf;if(D=(112&(M=P[C.pos++]))>>4,M<128||(D|=(127&(M=P[C.pos++]))<<3,M<128)||(D|=(127&(M=P[C.pos++]))<<10,M<128)||(D|=(127&(M=P[C.pos++]))<<17,M<128)||(D|=(127&(M=P[C.pos++]))<<24,M<128)||(D|=(1&(M=P[C.pos++]))<<31,M<128))return function Vf(o,t,l){return l?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}(m,D,x);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(l=h[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,t=this.pos;return this.pos=o,o-t>=12&&Ym?Ym.decode(this.buf.subarray(t,o)):function(l,h,m){for(var x="",C=h;C<m;){var D,M,P,U=l[C],G=null,Y=U>239?4:U>223?3:U>191?2:1;if(C+Y>m)break;1===Y?U<128&&(G=U):2===Y?128==(192&(D=l[C+1]))&&(G=(31&U)<<6|63&D)<=127&&(G=null):3===Y?(M=l[C+2],128==(192&(D=l[C+1]))&&128==(192&M)&&((G=(15&U)<<12|(63&D)<<6|63&M)<=2047||G>=55296&&G<=57343)&&(G=null)):4===Y&&(M=l[C+2],P=l[C+3],128==(192&(D=l[C+1]))&&128==(192&M)&&128==(192&P)&&((G=(15&U)<<18|(63&D)<<12|(63&M)<<6|63&P)<=65535||G>=1114112)&&(G=null)),null===G?(G=65533,Y=1):G>65535&&(G-=65536,x+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),x+=String.fromCharCode(G),C+=Y}return x}(this.buf,t,o)},readBytes:function(){var o=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,o);return this.pos=o,t},readPackedVarint:function(o,t){if(this.type!==Ro.Bytes)return o.push(this.readVarint(t));var l=nd(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(t));return o},readPackedSVarint:function(o){if(this.type!==Ro.Bytes)return o.push(this.readSVarint());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Ro.Bytes)return o.push(this.readBoolean());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Ro.Bytes)return o.push(this.readFloat());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Ro.Bytes)return o.push(this.readDouble());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Ro.Bytes)return o.push(this.readFixed32());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Ro.Bytes)return o.push(this.readSFixed32());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Ro.Bytes)return o.push(this.readFixed64());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Ro.Bytes)return o.push(this.readSFixed64());var t=nd(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed64());return o},skip:function(o){var t=7&o;if(t===Ro.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ro.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ro.Fixed32)this.pos+=4;else{if(t!==Ro.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(o,t){this.writeVarint(o<<3|t)},realloc:function(o){for(var t=this.length||16;t<this.pos+o;)t*=2;if(t!==this.length){var l=new Uint8Array(t);l.set(this.buf),this.buf=l,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Pd(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Pd(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Pd(this.buf,-1&o,this.pos),Pd(this.buf,Math.floor(o*v_),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Pd(this.buf,-1&o,this.pos),Pd(this.buf,Math.floor(o*v_),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(t,l){var h,m,x,D;if(t>=0?(h=t%4294967296|0,m=t/4294967296|0):(m=~(-t/4294967296),4294967295^(h=~(-t%4294967296))?h=h+1|0:(h=0,m=m+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),x=h,(D=l).buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,x>>>=7,D.buf[D.pos++]=127&x|128,D.buf[D.pos]=127&(x>>>=7),function(x,C){var D=(7&x)<<4;C.buf[C.pos++]|=D|((x>>>=3)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x|((x>>>=7)?128:0),x&&(C.buf[C.pos++]=127&x)))))}(m,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var t=this.pos;this.pos=function(h,m,x){for(var C,D,M=0;M<m.length;M++){if((C=m.charCodeAt(M))>55295&&C<57344){if(!D){C>56319||M+1===m.length?(h[x++]=239,h[x++]=191,h[x++]=189):D=C;continue}if(C<56320){h[x++]=239,h[x++]=191,h[x++]=189,D=C;continue}C=D-55296<<10|C-56320|65536,D=null}else D&&(h[x++]=239,h[x++]=191,h[x++]=189,D=null);C<128?h[x++]=C:(C<2048?h[x++]=C>>6|192:(C<65536?h[x++]=C>>12|224:(h[x++]=C>>18|240,h[x++]=C>>12&63|128),h[x++]=C>>6&63|128),h[x++]=63&C|128)}return x}(this.buf,o,this.pos);var l=this.pos-t;l>=128&&y_(t,l,this),this.pos=t-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),Gg(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Gg(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var t=o.length;this.writeVarint(t),this.realloc(t);for(var l=0;l<t;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,t){this.pos++;var l=this.pos;o(t,this);var h=this.pos-l;h>=128&&y_(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(o,t,l){this.writeTag(o,Ro.Bytes),this.writeRawMessage(t,l)},writePackedVarint:function(o,t){t.length&&this.writeMessage(o,Rp,t)},writePackedSVarint:function(o,t){t.length&&this.writeMessage(o,x_,t)},writePackedBoolean:function(o,t){t.length&&this.writeMessage(o,Qh,t)},writePackedFloat:function(o,t){t.length&&this.writeMessage(o,$g,t)},writePackedDouble:function(o,t){t.length&&this.writeMessage(o,Wg,t)},writePackedFixed32:function(o,t){t.length&&this.writeMessage(o,Zg,t)},writePackedSFixed32:function(o,t){t.length&&this.writeMessage(o,qg,t)},writePackedFixed64:function(o,t){t.length&&this.writeMessage(o,jf,t)},writePackedSFixed64:function(o,t){t.length&&this.writeMessage(o,Lp,t)},writeBytesField:function(o,t){this.writeTag(o,Ro.Bytes),this.writeBytes(t)},writeFixed32Field:function(o,t){this.writeTag(o,Ro.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(o,t){this.writeTag(o,Ro.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(o,t){this.writeTag(o,Ro.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(o,t){this.writeTag(o,Ro.Fixed64),this.writeSFixed64(t)},writeVarintField:function(o,t){this.writeTag(o,Ro.Varint),this.writeVarint(t)},writeSVarintField:function(o,t){this.writeTag(o,Ro.Varint),this.writeSVarint(t)},writeStringField:function(o,t){this.writeTag(o,Ro.Bytes),this.writeString(t)},writeFloatField:function(o,t){this.writeTag(o,Ro.Fixed32),this.writeFloat(t)},writeDoubleField:function(o,t){this.writeTag(o,Ro.Fixed64),this.writeDouble(t)},writeBooleanField:function(o,t){this.writeVarintField(o,!!t)}};var uh=jn(Hg);const Km=3;function Xg(o,t,l){t.glyphs=[],1===o&&l.readMessage(Hf,t)}function Hf(o,t,l){if(3===o){const{id:h,bitmap:m,width:x,height:C,left:D,top:M,advance:P}=l.readMessage(w_,{});t.glyphs.push({id:h,bitmap:new Zl({width:x+2*Km,height:C+2*Km},m),metrics:{width:x,height:C,left:D,top:M,advance:P}})}else 4===o?t.ascender=l.readSVarint():5===o&&(t.descender=l.readSVarint())}function w_(o,t,l){1===o?t.id=l.readVarint():2===o?t.bitmap=l.readBytes():3===o?t.width=l.readVarint():4===o?t.height=l.readVarint():5===o?t.left=l.readSVarint():6===o?t.top=l.readSVarint():7===o&&(t.advance=l.readVarint())}const Yg=Km;function Kg(o){let t=0,l=0;for(const C of o)t+=C.w*C.h,l=Math.max(l,C.w);o.sort((C,D)=>D.h-C.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}];let m=0,x=0;for(const C of o)for(let D=h.length-1;D>=0;D--){const M=h[D];if(!(C.w>M.w||C.h>M.h)){if(C.x=M.x,C.y=M.y,x=Math.max(x,C.y+C.h),m=Math.max(m,C.x+C.w),C.w===M.w&&C.h===M.h){const P=h.pop();D<h.length&&(h[D]=P)}else C.h===M.h?(M.x+=C.w,M.w-=C.w):C.w===M.w?(M.y+=C.h,M.h-=C.h):(h.push({x:M.x+C.w,y:M.y,w:M.w-C.w,h:C.h}),M.y+=C.h,M.h-=C.h);break}}return{w:m,h:x,fill:t/(m*x)||0}}const ql=1;class Gf{constructor(t,{pixelRatio:l,version:h,stretchX:m,stretchY:x,content:C}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=m,this.stretchY=x,this.content=C,this.version=h}get tl(){return[this.paddedRect.x+ql,this.paddedRect.y+ql]}get br(){return[this.paddedRect.x+this.paddedRect.w-ql,this.paddedRect.y+this.paddedRect.h-ql]}get displaySize(){return[(this.paddedRect.w-2*ql)/this.pixelRatio,(this.paddedRect.h-2*ql)/this.pixelRatio]}}class Jg{constructor(t,l){const h={},m={};this.haveRenderCallbacks=[];const x=[];this.addImages(t,h,x),this.addImages(l,m,x);const{w:C,h:D}=Kg(x),M=new Ol({width:C||1,height:D||1});for(const P in t){const U=t[P],G=h[P].paddedRect;Ol.copy(U.data,M,{x:0,y:0},{x:G.x+ql,y:G.y+ql},U.data)}for(const P in l){const U=l[P],G=m[P].paddedRect,Y=G.x+ql,ne=G.y+ql,ae=U.data.width,pe=U.data.height;Ol.copy(U.data,M,{x:0,y:0},{x:Y,y:ne},U.data),Ol.copy(U.data,M,{x:0,y:pe-1},{x:Y,y:ne-1},{width:ae,height:1}),Ol.copy(U.data,M,{x:0,y:0},{x:Y,y:ne+pe},{width:ae,height:1}),Ol.copy(U.data,M,{x:ae-1,y:0},{x:Y-1,y:ne},{width:1,height:pe}),Ol.copy(U.data,M,{x:0,y:0},{x:Y+ae,y:ne},{width:1,height:pe})}this.image=M,this.iconPositions=h,this.patternPositions=m}addImages(t,l,h){for(const m in t){const x=t[m],C={x:0,y:0,w:x.data.width+2*ql,h:x.data.height+2*ql};h.push(C),l[m]=new Gf(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(t,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in t.updatedImages)this.patchUpdatedImage(this.iconPositions[h],t.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h),l)}patchUpdatedImage(t,l,h){if(!t||!l||t.version===l.version)return;t.version=l.version;const[m,x]=t.tl;h.update(l.data,void 0,{x:m,y:x})}}Kn(Gf,"ImagePosition"),Kn(Jg,"ImageAtlas");const gc={horizontal:1,vertical:2,horizontalOnly:3},Jm=-17;class kp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,l){const h=new kp;return h.scale=t||1,h.fontStack=l,h}static forImage(t){const l=new kp;return l.imageName=t,l}}class ef{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,l){const h=new ef;for(let m=0;m<t.sections.length;m++){const x=t.sections[m];x.image?h.addImageSection(x):h.addTextSection(x,l)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(l,h){let m="";for(let x=0;x<l.length;x++){const C=l.charCodeAt(x+1)||null,D=l.charCodeAt(x-1)||null;m+=!h&&(C&&Dc(C)&&!Uf[l[x+1]]||D&&Dc(D)&&!Uf[l[x-1]])||!Uf[l[x]]?l[x]:Uf[l[x]]}return m}(this.text,t)}trim(){let t=0;for(let h=0;h<this.text.length&&nf[this.text.charCodeAt(h)];h++)t++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=t&&nf[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(t,l),this.sectionIndex=this.sectionIndex.slice(t,l)}substring(t,l){const h=new ef;return h.text=this.text.substring(t,l),h.sectionIndex=this.sectionIndex.slice(t,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,l)=>Math.max(t,this.sections[l].scale),0)}addTextSection(t,l){this.text+=t.text,this.sections.push(kp.forText(t.scale,t.fontStack||l));const h=this.sections.length-1;for(let m=0;m<t.text.length;++m)this.sectionIndex.push(h)}addImageSection(t){const l=t.image?t.image.name:"";if(0===l.length)return void Gn("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(kp.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Gn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tf(o,t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae){const pe=ef.fromFeature(o,m);G===gc.vertical&&pe.verticalizePunctuation(Y);let Ee=[];const Pe=function(Xe,Ft,Rt,tn,Dn,Ht){if(!Xe)return[];const cn=[],fn=function(qn,ar,Yn,li,Rn,Ar){let ci=0;for(let qi=0;qi<qn.length();qi++){const ui=qn.getSection(qi);ci+=Qg(qn.getCharCode(qi),ui,li,Rn,ar,Ar)}return ci/Math.max(1,Math.ceil(ci/Yn))}(Xe,Ft,Rt,tn,Dn,Ht),bn=Xe.text.indexOf("\u200b")>=0;let Pn=0;for(let qn=0;qn<Xe.length();qn++){const ar=Xe.getSection(qn),Yn=Xe.getCharCode(qn);if(nf[Yn]||(Pn+=Qg(Yn,ar,tn,Dn,Ft,Ht)),qn<Xe.length()-1){const li=!((Jt=Yn)<11904||!($n["Bopomofo Extended"](Jt)||$n.Bopomofo(Jt)||$n["CJK Compatibility Forms"](Jt)||$n["CJK Compatibility Ideographs"](Jt)||$n["CJK Compatibility"](Jt)||$n["CJK Radicals Supplement"](Jt)||$n["CJK Strokes"](Jt)||$n["CJK Symbols and Punctuation"](Jt)||$n["CJK Unified Ideographs Extension A"](Jt)||$n["CJK Unified Ideographs"](Jt)||$n["Enclosed CJK Letters and Months"](Jt)||$n["Halfwidth and Fullwidth Forms"](Jt)||$n.Hiragana(Jt)||$n["Ideographic Description Characters"](Jt)||$n["Kangxi Radicals"](Jt)||$n["Katakana Phonetic Extensions"](Jt)||$n.Katakana(Jt)||$n["Vertical Forms"](Jt)||$n["Yi Radicals"](Jt)||$n["Yi Syllables"](Jt)));(b_[Yn]||li||ar.imageName)&&cn.push(Qm(qn+1,Pn,fn,cn,Bp(Yn,Xe.getCharCode(qn+1),li&&bn),!1))}}var Jt;return em(Qm(Xe.length(),Pn,fn,cn,0,!0))}(pe,P,x,t,h,ne),{processBidirectionalText:We,processStyledBidirectionalText:Le}=k;if(We&&1===pe.sections.length){const Xe=We(pe.toString(),Pe);for(const Ft of Xe){const Rt=new ef;Rt.text=Ft,Rt.sections=pe.sections;for(let tn=0;tn<Ft.length;tn++)Rt.sectionIndex.push(0);Ee.push(Rt)}}else if(Le){const Xe=Le(pe.text,pe.sectionIndex,Pe);for(const Ft of Xe){const Rt=new ef;Rt.text=Ft[0],Rt.sectionIndex=Ft[1],Rt.sections=pe.sections,Ee.push(Rt)}}else Ee=function(Xe,Ft){const Rt=[],tn=Xe.text;let Dn=0;for(const Ht of Ft)Rt.push(Xe.substring(Dn,Ht)),Dn=Ht;return Dn<tn.length&&Rt.push(Xe.substring(Dn,tn.length)),Rt}(pe,Pe);const $e=[],et={positionedLines:$e,text:pe.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:G,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Xe,Ft,Rt,tn,Dn,Ht,cn,fn,bn,Pn,Jt,qn){let ar=0,Yn=0,li=0;const Rn="right"===fn?1:"left"===fn?0:.5;let Ar=!1;for(const pi of Dn){const gi=pi.getSections();for(const Vo of gi){if(Vo.imageName)continue;const Xo=Ft[Vo.fontStack];if(Xo&&(Ar=void 0!==Xo.ascender&&void 0!==Xo.descender,!Ar))break}if(!Ar)break}let ci=0;for(const pi of Dn){pi.trim();const gi=pi.getMaxScale(),Vo=(gi-1)*wa,Xo={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[ci]=Xo;const jo=Xo.positionedGlyphs;let Lo=0;if(!pi.length()){Yn+=Ht,++ci;continue}let Ss=0,Ks=0;for(let No=0;No<pi.length();No++){const Na=pi.getSection(No),Ns=pi.getSectionIndex(No),ks=pi.getCharCode(No);let fo=Na.scale,js=null,Yo=null,Hs=null,Is=wa,Io=0;const Fs=!(bn===gc.horizontal||!Jt&&!pu(ks)||Jt&&(nf[ks]||(qi=ks,$n.Arabic(qi)||$n["Arabic Supplement"](qi)||$n["Arabic Extended-A"](qi)||$n["Arabic Presentation Forms-A"](qi)||$n["Arabic Presentation Forms-B"](qi))));if(Na.imageName){const ll=tn[Na.imageName];if(!ll)continue;Hs=Na.imageName,Xe.iconsInText=Xe.iconsInText||!0,Yo=ll.paddedRect;const Ko=ll.displaySize;fo=fo*wa/qn,js={width:Ko[0],height:Ko[1],left:ql,top:-Yg,advance:Fs?Ko[1]:Ko[0],localGlyph:!1},Io=Ar?-js.height*fo:Jm+gi*wa-Ko[1]*fo,Is=js.advance;const yc=(Fs?Ko[0]:Ko[1])*fo-wa*gi;yc>0&&yc>Lo&&(Lo=yc)}else{const ll=Rt[Na.fontStack];if(!ll)continue;ll[ks]&&(Yo=ll[ks]);const Ko=Ft[Na.fontStack];if(!Ko)continue;const yc=Ko.glyphs[ks];if(!yc)continue;if(js=yc.metrics,Is=8203!==ks?wa:0,Ar){const cu=void 0!==Ko.ascender?Math.abs(Ko.ascender):0,Ou=void 0!==Ko.descender?Math.abs(Ko.descender):0,Pu=(cu+Ou)*fo;Ss<Pu&&(Ss=Pu,Ks=(cu-Ou)/2*fo),Io=-cu*fo}else Io=Jm+(gi-fo)*wa}Fs?(Xe.verticalizable=!0,jo.push({glyph:ks,imageName:Hs,x:ar,y:Yn+Io,vertical:Fs,scale:fo,localGlyph:js.localGlyph,fontStack:Na.fontStack,sectionIndex:Ns,metrics:js,rect:Yo}),ar+=Is*fo+Pn):(jo.push({glyph:ks,imageName:Hs,x:ar,y:Yn+Io,vertical:Fs,scale:fo,localGlyph:js.localGlyph,fontStack:Na.fontStack,sectionIndex:Ns,metrics:js,rect:Yo}),ar+=js.advance*fo+Pn)}0!==jo.length&&(li=Math.max(ar-Pn,li),Ar?nm(jo,Rn,Lo,Ks,Ht*gi/2):nm(jo,Rn,Lo,0,Ht/2)),ar=0;const Js=Ht*gi+Lo;Xo.lineOffset=Math.max(Lo,Vo),Yn+=Js,++ci}var qi;const ui=Yn,{horizontalAlign:jr,verticalAlign:ss}=tm(cn);(function(pi,gi,Vo,Xo,jo,Lo){const Ss=(gi-Vo)*jo,Ks=-Lo*Xo;for(const Js of pi)for(const No of Js.positionedGlyphs)No.x+=Ss,No.y+=Ks})(Xe.positionedLines,Rn,jr,ss,li,ui),Xe.top+=-ss*ui,Xe.bottom=Xe.top+ui,Xe.left+=-jr*li,Xe.right=Xe.left+li,Xe.hasBaseline=Ar}(et,t,l,h,Ee,C,D,M,G,P,Y,ae),!function(Xe){for(const Ft of Xe)if(0!==Ft.positionedGlyphs.length)return!1;return!0}($e)&&et}const nf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},b_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Qg(o,t,l,h,m,x){if(t.imageName){const C=h[t.imageName];return C?C.displaySize[0]*t.scale*wa/x+m:0}{const C=l[t.fontStack],D=C&&C.glyphs[o];return D?D.metrics.advance*t.scale+m:0}}function Fp(o,t,l,h){const m=Math.pow(o-t,2);return h?o<t?m/2:2*m:m+Math.abs(l)*l}function Bp(o,t,l){let h=0;return 10===o&&(h-=1e4),l&&(h+=150),40!==o&&65288!==o||(h+=50),41!==t&&65289!==t||(h+=50),h}function Qm(o,t,l,h,m,x){let C=null,D=Fp(t,l,m,x);for(const M of h){const P=Fp(t-M.x,l,m,x)+M.badness;P<=D&&(C=M,D=P)}return{index:o,x:t,priorBreak:C,badness:D}}function em(o){return o?em(o.priorBreak).concat(o.index):[]}function tm(o){let t=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function nm(o,t,l,h,m){if(!(t||l||h||m))return;const x=o.length-1,C=o[x],D=(C.x+C.metrics.advance*C.scale)*t;for(let M=0;M<=x;M++)o[M].x-=D,o[M].y+=l+h+m}function Vv(o,t,l){const{horizontalAlign:h,verticalAlign:m}=tm(l),x=t[0]-o.displaySize[0]*h,C=t[1]-o.displaySize[1]*m;return{image:o,top:C,bottom:C+o.displaySize[1],left:x,right:x+o.displaySize[0]}}function e0(o,t,l,h,m,x){const C=o.image;let D;if(C.content){const Ee=C.content,Pe=C.pixelRatio||1;D=[Ee[0]/Pe,Ee[1]/Pe,C.displaySize[0]-Ee[2]/Pe,C.displaySize[1]-Ee[3]/Pe]}const M=t.left*x,P=t.right*x;let U,G,Y,ne;"width"===l||"both"===l?(ne=m[0]+M-h[3],G=m[0]+P+h[1]):(ne=m[0]+(M+P-C.displaySize[0])/2,G=ne+C.displaySize[0]);const ae=t.top*x,pe=t.bottom*x;return"height"===l||"both"===l?(U=m[1]+ae-h[0],Y=m[1]+pe+h[2]):(U=m[1]+(ae+pe-C.displaySize[1])/2,Y=U+C.displaySize[1]),{image:C,top:U,right:G,bottom:Y,left:ne,collisionPadding:D}}class Uc extends gt{constructor(t,l,h,m,x){super(t,l),this.angle=m,this.z=h,void 0!==x&&(this.segment=x)}clone(){return new Uc(this.x,this.y,this.z,this.angle,this.segment)}}function t0(o,t,l,h,m){if(void 0===t.segment)return!0;let x=t,C=t.segment+1,D=0;for(;D>-l/2;){if(C--,C<0)return!1;D-=o[C].dist(x),x=o[C]}D+=o[C].dist(o[C+1]),C++;const M=[];let P=0;for(;D<l/2;){const U=o[C],G=o[C+1];if(!G)return!1;let Y=o[C-1].angleTo(U)-U.angleTo(G);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:D,angleDelta:Y}),P+=Y;D-M[0].distance>h;)P-=M.shift().angleDelta;if(P>m)return!1;C++,D+=U.dist(G)}return!0}function dh(o){let t=0;for(let l=0;l<o.length-1;l++)t+=o[l].dist(o[l+1]);return t}function rf(o,t,l){return o?.6*t*l:0}function n0(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function r0(o,t,l,h,m,x){const C=rf(l,m,x),D=n0(l,h)*x;let M=0;const P=dh(o)/2;for(let U=0;U<o.length-1;U++){const G=o[U],Y=o[U+1],ne=G.dist(Y);if(M+ne>P){const ae=(P-M)/ne,pe=ri(G.x,Y.x,ae),Ee=ri(G.y,Y.y,ae),Pe=new Uc(pe,Ee,0,Y.angleTo(G),U);return!C||t0(o,Pe,D,C,t)?Pe:void 0}M+=ne}}function E_(o,t,l,h,m,x,C,D,M){const P=rf(h,x,C),U=n0(h,m),G=U*C,Y=0===o[0].x||o[0].x===M||0===o[0].y||o[0].y===M;return t-G<t/4&&(t=G+t/4),o0(o,Y?t/2*D%t:(U/2+2*x)*C*D%t,t,P,l,G,Y,!1,M)}function o0(o,t,l,h,m,x,C,D,M){const P=x/2,U=dh(o);let G=0,Y=t-l,ne=[];for(let ae=0;ae<o.length-1;ae++){const pe=o[ae],Ee=o[ae+1],Pe=pe.dist(Ee),We=Ee.angleTo(pe);for(;Y+l<G+Pe;){Y+=l;const Le=(Y-G)/Pe,$e=ri(pe.x,Ee.x,Le),et=ri(pe.y,Ee.y,Le);if($e>=0&&$e<M&&et>=0&&et<M&&Y-P>=0&&Y+P<=U){const Xe=new Uc($e,et,0,We,ae);Xe._round(),h&&!t0(o,Xe,x,h,m)||ne.push(Xe)}}G+=Pe}return D||ne.length||C||(ne=o0(o,G/2,l,h,m,x,C,!0,M)),ne}function s0(o,t,l,h,m){const x=[];for(let C=0;C<o.length;C++){const D=o[C];let M;for(let P=0;P<D.length-1;P++){let U=D[P],G=D[P+1];U.x<t&&G.x<t||(U.x<t?U=new gt(t,U.y+(t-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x<t&&(G=new gt(t,U.y+(t-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y<l&&G.y<l||(U.y<l?U=new gt(U.x+(l-U.y)/(G.y-U.y)*(G.x-U.x),l)._round():G.y<l&&(G=new gt(U.x+(l-U.y)/(G.y-U.y)*(G.x-U.x),l)._round()),U.x>=h&&G.x>=h||(U.x>=h?U=new gt(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x>=h&&(G=new gt(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y>=m&&G.y>=m||(U.y>=m?U=new gt(U.x+(m-U.y)/(G.y-U.y)*(G.x-U.x),m)._round():G.y>=m&&(G=new gt(U.x+(m-U.y)/(G.y-U.y)*(G.x-U.x),m)._round()),M&&U.equals(M[M.length-1])||(M=[U],x.push(M)),M.push(G)))))}}return x}Kn(Uc,"Anchor");const sf=1e20;function a0(o,t,l,h,m,x,C,D,M){for(let P=t;P<t+h;P++)zp(o,l*x+P,x,m,C,D,M);for(let P=l;P<l+m;P++)zp(o,P*x+t,1,h,C,D,M)}function zp(o,t,l,h,m,x,C){x[0]=0,C[0]=-sf,C[1]=sf,m[0]=o[t];for(let D=1,M=0,P=0;D<h;D++){m[D]=o[t+D*l];const U=D*D;do{const G=x[M];P=(m[D]-m[G]+U-G*G)/(D-G)/2}while(P<=C[M]&&--M>-1);M++,x[M]=D,C[M]=P,C[M+1]=sf}for(let D=0,M=0;D<h;D++){for(;C[M+1]<D;)M++;const P=x[M],U=D-P;o[t+D*l]=m[P]+U*U}}const Iu=2,$f={none:0,ideographs:1,all:2};class hh{constructor(t,l,h){this.requestManager=t,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,l){const h=[];for(const m in t)for(const x of t[m])h.push({stack:m,id:x});Ln(h,({stack:m,id:x},C)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=D.glyphs[x];if(void 0!==M)return void C(null,{stack:m,id:x,glyph:M});if(M=this._tinySDF(D,m,x),M)return D.glyphs[x]=M,void C(null,{stack:m,id:x,glyph:M});const P=Math.floor(x/256);if(256*P>65535)return void C(new Error("glyphs > 65535 not supported"));if(D.ranges[P])return void C(null,{stack:m,id:x,glyph:M});let U=D.requests[P];U||(U=D.requests[P]=[],hh.loadGlyphRange(m,P,this.url,this.requestManager,(G,Y)=>{if(Y){D.ascender=Y.ascender,D.descender=Y.descender;for(const ne in Y.glyphs)this._doesCharSupportLocalGlyph(+ne)||(D.glyphs[+ne]=Y.glyphs[+ne]);D.ranges[P]=!0}for(const ne of U)ne(G,Y);delete D.requests[P]})),U.push((G,Y)=>{G?C(G):Y&&C(null,{stack:m,id:x,glyph:Y.glyphs[x]||null})})},(m,x)=>{if(m)l(m);else if(x){const C={};for(const{stack:D,id:M,glyph:P}of x)void 0===C[D]&&(C[D]={}),void 0===C[D].glyphs&&(C[D].glyphs={}),C[D].glyphs[M]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},C[D].ascender=this.entries[D].ascender,C[D].descender=this.entries[D].descender;l(null,C)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==$f.none&&(this.localGlyphMode===$f.all?!!this.localFontFamily:!!this.localFontFamily&&($n["CJK Unified Ideographs"](t)||$n["Hangul Syllables"](t)||$n.Hiragana(t)||$n.Katakana(t)||$n["CJK Symbols and Punctuation"](t)))}_tinySDF(t,l,h){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(h))return;let x=t.tinySDF;if(!x){let pe="400";/bold/i.test(l)?pe="900":/medium/i.test(l)?pe="500":/light/i.test(l)&&(pe="200"),x=t.tinySDF=new hh.TinySDF({fontFamily:m,fontWeight:pe,fontSize:24*Iu,buffer:3*Iu,radius:8*Iu}),x.fontWeight=pe}if(this.localGlyphs[x.fontWeight][h])return this.localGlyphs[x.fontWeight][h];const C=String.fromCharCode(h),{data:D,width:M,height:P,glyphWidth:U,glyphHeight:G,glyphLeft:Y,glyphTop:ne,glyphAdvance:ae}=x.draw(C);return this.localGlyphs[x.fontWeight][h]={id:h,bitmap:new Zl({width:M,height:P},D),metrics:{width:U/Iu,height:G/Iu,left:Y/Iu,top:ne/Iu-27,advance:ae/Iu,localGlyph:!0}}}}hh.loadGlyphRange=function(o,t,l,h,m){const x=256*t,C=x+255,D=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",o).replace("{range}",`${x}-${C}`),si.Glyphs);nr(D,(M,P)=>{if(M)m(M);else if(P){const U={},G=new uh(P).readFields(Xg,{});for(const Y of G.glyphs)U[Y.id]=Y;m(null,{glyphs:U,ascender:G.ascender,descender:G.descender})}})},hh.TinySDF=class{constructor({fontSize:o=24,buffer:t=3,radius:l=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:x="normal",fontStyle:C="normal"}={}){this.buffer=t,this.cutoff=h,this.radius=l;const D=this.size=o+4*t,M=this._createCanvas(D),P=this.ctx=M.getContext("2d",{willReadFrequently:!0});P.font=`${C} ${x} ${o}px ${m}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(o){const t=document.createElement("canvas");return t.width=t.height=o,t}draw(o){const{width:t,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:x}=this.ctx.measureText(o),C=Math.ceil(l),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-m))),M=Math.min(this.size-this.buffer,C+Math.ceil(h)),P=D+2*this.buffer,U=M+2*this.buffer,G=Math.max(P*U,0),Y=new Uint8ClampedArray(G),ne={data:Y,width:P,height:U,glyphWidth:D,glyphHeight:M,glyphTop:C,glyphLeft:0,glyphAdvance:t};if(0===D||0===M)return ne;const{ctx:ae,buffer:pe,gridInner:Ee,gridOuter:Pe}=this;ae.clearRect(pe,pe,D,M),ae.fillText(o,pe,pe+C);const We=ae.getImageData(pe,pe,D,M);Pe.fill(sf,0,G),Ee.fill(0,0,G);for(let Le=0;Le<M;Le++)for(let $e=0;$e<D;$e++){const et=We.data[4*(Le*D+$e)+3]/255;if(0===et)continue;const Xe=(Le+pe)*P+$e+pe;if(1===et)Pe[Xe]=0,Ee[Xe]=sf;else{const Ft=.5-et;Pe[Xe]=Ft>0?Ft*Ft:0,Ee[Xe]=Ft<0?Ft*Ft:0}}a0(Pe,0,0,P,U,P,this.f,this.v,this.z),a0(Ee,pe,pe,D,M,P,this.f,this.v,this.z);for(let Le=0;Le<G;Le++){const $e=Math.sqrt(Pe[Le])-Math.sqrt(Ee[Le]);Y[Le]=Math.round(255-255*($e/this.radius+this.cutoff))}return ne}};const af=ql;function l0(o,t,l,h){const m=[],x=o.image,C=x.pixelRatio,D=x.paddedRect.w-2*af,M=x.paddedRect.h-2*af,P=o.right-o.left,U=o.bottom-o.top,G=x.stretchX||[[0,D]],Y=x.stretchY||[[0,M]],ne=(Ht,cn)=>Ht+cn[1]-cn[0],ae=G.reduce(ne,0),pe=Y.reduce(ne,0),Ee=D-ae,Pe=M-pe;let We=0,Le=ae,$e=0,et=pe,Xe=0,Ft=Ee,Rt=0,tn=Pe;if(x.content&&h){const Ht=x.content;We=Wf(G,0,Ht[0]),$e=Wf(Y,0,Ht[1]),Le=Wf(G,Ht[0],Ht[2]),et=Wf(Y,Ht[1],Ht[3]),Xe=Ht[0]-We,Rt=Ht[1]-$e,Ft=Ht[2]-Ht[0]-Le,tn=Ht[3]-Ht[1]-et}const Dn=(Ht,cn,fn,bn)=>{const Pn=Zf(Ht.stretch-We,Le,P,o.left),Jt=Up(Ht.fixed-Xe,Ft,Ht.stretch,ae),qn=Zf(cn.stretch-$e,et,U,o.top),ar=Up(cn.fixed-Rt,tn,cn.stretch,pe),Yn=Zf(fn.stretch-We,Le,P,o.left),li=Up(fn.fixed-Xe,Ft,fn.stretch,ae),Rn=Zf(bn.stretch-$e,et,U,o.top),Ar=Up(bn.fixed-Rt,tn,bn.stretch,pe),ci=new gt(Pn,qn),qi=new gt(Yn,qn),ui=new gt(Yn,Rn),jr=new gt(Pn,Rn),ss=new gt(Jt/C,ar/C),pi=new gt(li/C,Ar/C),gi=t*Math.PI/180;if(gi){const jo=Math.sin(gi),Lo=Math.cos(gi),Ss=[Lo,-jo,jo,Lo];ci._matMult(Ss),qi._matMult(Ss),jr._matMult(Ss),ui._matMult(Ss)}const Vo=Ht.stretch+Ht.fixed,Xo=cn.stretch+cn.fixed;return{tl:ci,tr:qi,bl:jr,br:ui,tex:{x:x.paddedRect.x+af+Vo,y:x.paddedRect.y+af+Xo,w:fn.stretch+fn.fixed-Vo,h:bn.stretch+bn.fixed-Xo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ss,pixelOffsetBR:pi,minFontScaleX:Ft/C/P,minFontScaleY:tn/C/U,isSDF:l}};if(h&&(x.stretchX||x.stretchY)){const Ht=c0(G,Ee,ae),cn=c0(Y,Pe,pe);for(let fn=0;fn<Ht.length-1;fn++){const bn=Ht[fn],Pn=Ht[fn+1];for(let Jt=0;Jt<cn.length-1;Jt++)m.push(Dn(bn,cn[Jt],Pn,cn[Jt+1]))}}else m.push(Dn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:M+1}));return m}function Wf(o,t,l){let h=0;for(const m of o)h+=Math.max(t,Math.min(l,m[1]))-Math.max(t,Math.min(l,m[0]));return h}function c0(o,t,l){const h=[{fixed:-af,stretch:0}];for(const[m,x]of o){const C=h[h.length-1];h.push({fixed:m-C.stretch,stretch:C.stretch}),h.push({fixed:m-C.stretch,stretch:C.stretch+(x-m)})}return h.push({fixed:t+af,stretch:l}),h}function Zf(o,t,l,h){return o/t*l+h}function Up(o,t,l,h){return o-t*l/h}function C_(o,t,l,h){const m=t+o.positionedLines[h].lineOffset;return 0===h?l+m/2:l+(m+(t+o.positionedLines[h-1].lineOffset))/2}class jv{constructor(t=[],l=u0){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:l,compare:h}=this,m=l[t];for(;t>0;){const x=t-1>>1,C=l[x];if(h(m,C)>=0)break;l[t]=C,t=x}l[t]=m}_down(t){const{data:l,compare:h}=this,m=this.length>>1,x=l[t];for(;t<m;){let C=1+(t<<1),D=l[C];const M=C+1;if(M<this.length&&h(l[M],D)<0&&(C=M,D=l[M]),h(D,x)>=0)break;l[t]=D,t=C}l[t]=x}}function u0(o,t){return o<t?-1:o>t?1:0}function d0(o,t=1,l=!1){let h=1/0,m=1/0,x=-1/0,C=-1/0;const D=o[0];for(let ne=0;ne<D.length;ne++){const ae=D[ne];(!ne||ae.x<h)&&(h=ae.x),(!ne||ae.y<m)&&(m=ae.y),(!ne||ae.x>x)&&(x=ae.x),(!ne||ae.y>C)&&(C=ae.y)}const M=Math.min(x-h,C-m);let P=M/2;const U=new jv([],su);if(0===M)return new gt(h,m);for(let ne=h;ne<x;ne+=M)for(let ae=m;ae<C;ae+=M)U.push(new fh(ne+P,ae+P,P,o));let G=function(ne){let ae=0,pe=0,Ee=0;const Pe=ne[0];for(let We=0,Le=Pe.length,$e=Le-1;We<Le;$e=We++){const et=Pe[We],Xe=Pe[$e],Ft=et.x*Xe.y-Xe.x*et.y;pe+=(et.x+Xe.x)*Ft,Ee+=(et.y+Xe.y)*Ft,ae+=3*Ft}return new fh(pe/ae,Ee/ae,0,ne)}(o),Y=U.length;for(;U.length;){const ne=U.pop();(ne.d>G.d||!G.d)&&(G=ne,l&&console.log("found best %d after %d probes",Math.round(1e4*ne.d)/1e4,Y)),ne.max-G.d<=t||(P=ne.h/2,U.push(new fh(ne.p.x-P,ne.p.y-P,P,o)),U.push(new fh(ne.p.x+P,ne.p.y-P,P,o)),U.push(new fh(ne.p.x-P,ne.p.y+P,P,o)),U.push(new fh(ne.p.x+P,ne.p.y+P,P,o)),Y+=4)}return l&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${G.d}`)),G.p}function su(o,t){return t.max-o.max}class fh{constructor(t,l,h,m){this.p=new gt(t,l),this.h=h,this.d=function(x,C){let D=!1,M=1/0;for(let P=0;P<C.length;P++){const U=C[P];for(let G=0,Y=U.length,ne=Y-1;G<Y;ne=G++){const ae=U[G],pe=U[ne];ae.y>x.y!=pe.y>x.y&&x.x<(pe.x-ae.x)*(x.y-ae.y)/(pe.y-ae.y)+ae.x&&(D=!D),M=Math.min(M,qu(x,ae,pe))}}return(D?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const qf=7,Xf=Number.POSITIVE_INFINITY,Rd=Math.sqrt(2);function Vp(o,[t,l]){let h=0,m=0;if(l===Xf){t<0&&(t=0);const x=t/Rd;switch(o){case"top-right":case"top-left":m=x-qf;break;case"bottom-right":case"bottom-left":m=-x+qf;break;case"bottom":m=-t+qf;break;case"top":m=t-qf}switch(o){case"top-right":case"bottom-right":h=-x;break;case"top-left":case"bottom-left":h=x;break;case"left":h=t;break;case"right":h=-t}}else{switch(t=Math.abs(t),l=Math.abs(l),o){case"top-right":case"top-left":case"top":m=l-qf;break;case"bottom-right":case"bottom-left":case"bottom":m=-l+qf}switch(o){case"top-right":case"bottom-right":case"right":h=-t;break;case"top-left":case"bottom-left":case"left":h=t}}return[h,m]}function A_(o,t,l,h,m,x,C,D,M,P){o.createArrays(),o.tilePixelRatio=Tr/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const U=o.layers[0].layout,G=o.layers[0]._unevaluatedLayout._values,Y={};if("composite"===o.textSizeData.kind){const{minZoom:pe,maxZoom:Ee}=o.textSizeData;Y.compositeTextSizes=[G["text-size"].possiblyEvaluate(new H(pe),D),G["text-size"].possiblyEvaluate(new H(Ee),D)]}if("composite"===o.iconSizeData.kind){const{minZoom:pe,maxZoom:Ee}=o.iconSizeData;Y.compositeIconSizes=[G["icon-size"].possiblyEvaluate(new H(pe),D),G["icon-size"].possiblyEvaluate(new H(Ee),D)]}Y.layoutTextSize=G["text-size"].possiblyEvaluate(new H(M+1),D),Y.layoutIconSize=G["icon-size"].possiblyEvaluate(new H(M+1),D),Y.textMaxSize=G["text-size"].possiblyEvaluate(new H(18),D);const ne="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),ae=U.get("text-size");for(const pe of o.features){const Ee=U.get("text-font").evaluate(pe,{},D).join(","),Pe=ae.evaluate(pe,{},D),We=Y.layoutTextSize.evaluate(pe,{},D),Le=(Y.layoutIconSize.evaluate(pe,{},D),{horizontal:{},vertical:void 0}),$e=pe.text;let et,Xe=[0,0];if($e){const tn=$e.toString(),Dn=U.get("text-letter-spacing").evaluate(pe,{},D)*wa,Ht=U.get("text-line-height").evaluate(pe,{},D)*wa,cn=Ha(tn)?Dn:0,fn=U.get("text-anchor").evaluate(pe,{},D),bn=U.get("text-variable-anchor");if(!bn){const Yn=U.get("text-radial-offset").evaluate(pe,{},D);Xe=Yn?Vp(fn,[Yn*wa,Xf]):U.get("text-offset").evaluate(pe,{},D).map(li=>li*wa)}let Pn=ne?"center":U.get("text-justify").evaluate(pe,{},D);const Jt="point"===U.get("symbol-placement"),qn=Jt?U.get("text-max-width").evaluate(pe,{},D)*wa:1/0,ar=Yn=>{o.allowVerticalPlacement&&fu(tn)&&(Le.vertical=tf($e,t,l,m,Ee,qn,Ht,fn,Yn,cn,Xe,gc.vertical,!0,We,Pe))};if(!ne&&bn){const Yn="auto"===Pn?bn.map(Rn=>h0(Rn)):[Pn];let li=!1;for(let Rn=0;Rn<Yn.length;Rn++){const Ar=Yn[Rn];if(!Le.horizontal[Ar])if(li)Le.horizontal[Ar]=Le.horizontal[0];else{const ci=tf($e,t,l,m,Ee,qn,Ht,"center",Ar,cn,Xe,gc.horizontal,!1,We,Pe);ci&&(Le.horizontal[Ar]=ci,li=1===ci.positionedLines.length)}}ar("left")}else{if("auto"===Pn&&(Pn=h0(fn)),Jt||U.get("text-writing-mode").indexOf("horizontal")>=0||!fu(tn)){const Yn=tf($e,t,l,m,Ee,qn,Ht,fn,Pn,cn,Xe,gc.horizontal,!1,We,Pe);Yn&&(Le.horizontal[Pn]=Yn)}ar(Jt?"left":Pn)}}let Ft=!1;if(pe.icon&&pe.icon.name){const tn=h[pe.icon.name];tn&&(et=Vv(m[pe.icon.name],U.get("icon-offset").evaluate(pe,{},D),U.get("icon-anchor").evaluate(pe,{},D)),Ft=tn.sdf,void 0===o.sdfIcons?o.sdfIcons=tn.sdf:o.sdfIcons!==tn.sdf&&Gn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tn.pixelRatio!==o.pixelRatio||0!==U.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Rt=f0(Le.horizontal)||Le.vertical;o.iconsInText||(o.iconsInText=!!Rt&&Rt.iconsInText),(Rt||et)&&D_(o,pe,Le,et,h,Y,We,0,Xe,Ft,C,D,P)}x&&o.generateCollisionDebugBuffers(M,o.collisionBoxArray)}function h0(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function D_(o,t,l,h,m,x,C,D,M,P,U,G,Y){let ne=x.textMaxSize.evaluate(t,{},G);void 0===ne&&(ne=C);const ae=o.layers[0].layout,pe=ae.get("icon-offset").evaluate(t,{},G),Ee=f0(l.horizontal)||l.vertical,Pe="globe"===Y.name,We=wa,Le=C/We,$e=o.tilePixelRatio*ne/We,et=(fn=o.overscaling,o.zoom>18&&fn>2&&(fn>>=1),Math.max(Tr/(512*fn),1)*ae.get("symbol-spacing")),Xe=ae.get("text-padding")*o.tilePixelRatio,Ft=ae.get("icon-padding")*o.tilePixelRatio,Rt=Yt(ae.get("text-max-angle")),tn="map"===ae.get("text-rotation-alignment")&&"point"!==ae.get("symbol-placement"),Dn="map"===ae.get("icon-rotation-alignment")&&"point"!==ae.get("symbol-placement"),Ht=ae.get("symbol-placement"),cn=et/2;var fn;const bn=ae.get("icon-text-fit");let Pn;h&&"none"!==bn&&(o.allowVerticalPlacement&&l.vertical&&(Pn=e0(h,l.vertical,bn,ae.get("icon-text-fit-padding"),pe,Le)),Ee&&(h=e0(h,Ee,bn,ae.get("icon-text-fit-padding"),pe,Le)));const Jt=(qn,ar,Yn)=>{if(ar.x<0||ar.x>=Tr||ar.y<0||ar.y>=Tr)return;let li=null;if(Pe){const{x:Rn,y:Ar,z:ci}=Y.projectTilePoint(ar.x,ar.y,Yn);li={anchor:new Uc(Rn,Ar,ci,0,void 0),up:Y.upVector(Yn,ar.x,ar.y)}}!function(Rn,Ar,ci,qi,ui,jr,ss,pi,gi,Vo,Xo,jo,Lo,Ss,Ks,Js,No,Na,Ns,ks,fo,js,Yo,Hs,Is){const Io=Rn.addToLineVertexArray(Ar,qi);let Fs,ll,Ko,yc,cu,Ou,Pu,yh=0,xh=0,wh=0,bh=0,kd=-1,Fd=-1;const uu={};let wm=Ga("");const Bd=ci?ci.anchor:Ar;let sg=0,ag=0;if(void 0===gi._unevaluatedLayout.getValue("text-radial-offset")?[sg,ag]=gi.layout.get("text-offset").evaluate(fo,{},Is).map(Xl=>Xl*wa):(sg=gi.layout.get("text-radial-offset").evaluate(fo,{},Is)*wa,ag=Xf),Rn.allowVerticalPlacement&&ui.vertical){const Xl=ui.vertical;if(Ks)Ou=Wa(Xl),pi&&(Pu=Wa(pi));else{const Ul=gi.layout.get("text-rotate").evaluate(fo,{},Is)+90;Ko=im(Vo,Bd,Ar,Xo,jo,Lo,Xl,Ss,Ul,Js),pi&&(yc=im(Vo,Bd,Ar,Xo,jo,Lo,pi,Na,Ul))}}if(jr){const Xl=gi.layout.get("icon-rotate").evaluate(fo,{},Is),Ul="none"!==gi.layout.get("icon-text-fit"),np=l0(jr,Xl,Yo,Ul),U0=pi?l0(pi,Xl,Yo,Ul):void 0;ll=im(Vo,Bd,Ar,Xo,jo,Lo,jr,Na,Xl),yh=4*np.length;const N_=Rn.iconSizeData;let Eh=null;"source"===N_.kind?(Eh=[pc*gi.layout.get("icon-size").evaluate(fo,{},Is)],Eh[0]>Pl&&Gn(`${Rn.layerIds[0]}: Value for "icon-size" is >= ${ph}. Reduce your "icon-size".`)):"composite"===N_.kind&&(Eh=[pc*js.compositeIconSizes[0].evaluate(fo,{},Is),pc*js.compositeIconSizes[1].evaluate(fo,{},Is)],(Eh[0]>Pl||Eh[1]>Pl)&&Gn(`${Rn.layerIds[0]}: Value for "icon-size" is >= ${ph}. Reduce your "icon-size".`)),Rn.addSymbols(Rn.icon,np,Eh,ks,Ns,fo,!1,ci,Ar,Io.lineStartIndex,Io.lineLength,-1,Hs,Is),kd=Rn.icon.placedSymbolArray.length-1,U0&&(xh=4*U0.length,Rn.addSymbols(Rn.icon,U0,Eh,ks,Ns,fo,gc.vertical,ci,Ar,Io.lineStartIndex,Io.lineLength,-1,Hs,Is),Fd=Rn.icon.placedSymbolArray.length-1)}for(const Xl in ui.horizontal){const Ul=ui.horizontal[Xl];Fs||(wm=Ga(Ul.text),Ks?cu=Wa(Ul):Fs=im(Vo,Bd,Ar,Xo,jo,Lo,Ul,Ss,gi.layout.get("text-rotate").evaluate(fo,{},Is),Js));const np=1===Ul.positionedLines.length;if(wh+=rm(Rn,ci,Ar,Ul,ss,gi,Ks,fo,Js,Io,ui.vertical?gc.horizontal:gc.horizontalOnly,np?Object.keys(ui.horizontal):[Xl],uu,kd,js,Hs,Is),np)break}ui.vertical&&(bh+=rm(Rn,ci,Ar,ui.vertical,ss,gi,Ks,fo,Js,Io,gc.vertical,["vertical"],uu,Fd,js,Hs,Is));let sd=-1;const lg=(Xl,Ul)=>Xl?Math.max(Xl,Ul):Ul;sd=lg(cu,sd),sd=lg(Ou,sd),sd=lg(Pu,sd);const z0=sd>-1?1:0;Rn.glyphOffsetArray.length>=Ld.MAX_GLYPHS&&Gn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==fo.sortKey&&Rn.addToSortKeyRanges(Rn.symbolInstances.length,fo.sortKey),Rn.symbolInstances.emplaceBack(Bd.x,Bd.y,Bd.z,Ar.x,Ar.y,uu.right>=0?uu.right:-1,uu.center>=0?uu.center:-1,uu.left>=0?uu.left:-1,uu.vertical>=0?uu.vertical:-1,kd,Fd,wm,void 0!==Fs?Fs:Rn.collisionBoxArray.length,void 0!==Fs?Fs+1:Rn.collisionBoxArray.length,void 0!==Ko?Ko:Rn.collisionBoxArray.length,void 0!==Ko?Ko+1:Rn.collisionBoxArray.length,void 0!==ll?ll:Rn.collisionBoxArray.length,void 0!==ll?ll+1:Rn.collisionBoxArray.length,yc||Rn.collisionBoxArray.length,yc?yc+1:Rn.collisionBoxArray.length,Xo,wh,bh,yh,xh,z0,0,sg,ag,sd)}(o,ar,li,qn,l,h,m,Pn,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,Xe,tn,M,0,Ft,Dn,pe,t,x,P,U,G)};if("line"===Ht)for(const qn of s0(t.geometry,0,0,Tr,Tr)){const ar=E_(qn,et,Rt,l.vertical||Ee,h,We,$e,o.overscaling,Tr);for(const Yn of ar)Ee&&T_(o,Ee.text,cn,Yn)||Jt(qn,Yn,G)}else if("line-center"===Ht){for(const qn of t.geometry)if(qn.length>1){const ar=r0(qn,Rt,l.vertical||Ee,h,We,$e);ar&&Jt(qn,ar,G)}}else if("Polygon"===t.type)for(const qn of V(t.geometry,0)){const ar=d0(qn,16);Jt(qn[0],new Uc(ar.x,ar.y,0,0,void 0),G)}else if("LineString"===t.type)for(const qn of t.geometry)Jt(qn,new Uc(qn[0].x,qn[0].y,0,0,void 0),G);else if("Point"===t.type)for(const qn of t.geometry)for(const ar of qn)Jt([ar],new Uc(ar.x,ar.y,0,0,void 0),G)}const ph=255,Pl=ph*pc;function rm(o,t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae,pe,Ee){const Pe=function($e,et,Xe,Ft,Rt,tn,Dn,Ht){const cn=[];if(0===et.positionedLines.length)return cn;const fn=Ft.layout.get("text-rotate").evaluate(tn,{})*Math.PI/180,bn=function(Yn){const li=Yn[0],Rn=Yn[1],Ar=li*Rn;return Ar>0?[li,-Rn]:Ar<0?[-li,Rn]:0===li?[Rn,li]:[Rn,-li]}(Xe);let Pn=Math.abs(et.top-et.bottom);for(const Yn of et.positionedLines)Pn-=Yn.lineOffset;const Jt=et.positionedLines.length,qn=Pn/Jt;let ar=et.top-Xe[1];for(let Yn=0;Yn<Jt;++Yn){const li=et.positionedLines[Yn];ar=C_(et,qn,ar,Yn);for(const Rn of li.positionedGlyphs){if(!Rn.rect)continue;const Ar=Rn.rect||{};let ci=Yg+1,qi=!0,ui=1,jr=0;if(Rn.imageName){const Yo=Dn[Rn.imageName];if(!Yo)continue;if(Yo.sdf){Gn("SDF images are not supported in formatted text and will be ignored.");continue}qi=!1,ui=Yo.pixelRatio,ci=ql/ui}const ss=(Rt||Ht)&&Rn.vertical,pi=Rn.metrics.advance*Rn.scale/2,gi=Rn.metrics,Vo=Rn.rect;if(null===Vo)continue;Ht&&et.verticalizable&&(jr=Rn.imageName?pi-Rn.metrics.width*Rn.scale/2:0);const Xo=Rt?[Rn.x+pi,Rn.y]:[0,0];let jo=[0,0],Lo=[0,0],Ss=!1;Rt||(ss?(Lo=[Rn.x+pi+bn[0],Rn.y+bn[1]-jr],Ss=!0):jo=[Rn.x+pi+Xe[0],Rn.y+Xe[1]-jr]);const Ks=Vo.w*Rn.scale/(ui*(Rn.localGlyph?Iu:1)),Js=Vo.h*Rn.scale/(ui*(Rn.localGlyph?Iu:1));let No,Na,Ns,ks;if(ss){const Yo=Rn.y-ar,Hs=new gt(-pi,pi-Yo),Is=-Math.PI/2,Io=new gt(...Lo);No=new gt(-pi+jo[0],jo[1]),No._rotateAround(Is,Hs)._add(Io),No.x+=-Yo+pi,No.y-=(gi.left-ci)*Rn.scale;const Fs=Rn.imageName?gi.advance*Rn.scale:wa*Rn.scale,ll=String.fromCharCode(Rn.glyph);__(ll)?No.x+=(1-ci)*Rn.scale:jg(ll)?No.x+=Fs-gi.height*Rn.scale+(-ci-1)*Rn.scale:No.x+=Rn.imageName||gi.width+2*ci===Vo.w&&gi.height+2*ci===Vo.h?(Fs-Js)/2:(Fs-(gi.height+2*ci)*Rn.scale)/2,Na=new gt(No.x,No.y-Ks),Ns=new gt(No.x+Js,No.y),ks=new gt(No.x+Js,No.y-Ks)}else{const Yo=(gi.left-ci)*Rn.scale-pi+jo[0],Hs=(-gi.top-ci)*Rn.scale+jo[1],Is=Yo+Ks,Io=Hs+Js;No=new gt(Yo,Hs),Na=new gt(Is,Hs),Ns=new gt(Yo,Io),ks=new gt(Is,Io)}if(fn){let Yo;Yo=Rt?new gt(0,0):Ss?new gt(bn[0],bn[1]):new gt(Xe[0],Xe[1]),No._rotateAround(fn,Yo),Na._rotateAround(fn,Yo),Ns._rotateAround(fn,Yo),ks._rotateAround(fn,Yo)}const fo=new gt(0,0),js=new gt(0,0);cn.push({tl:No,tr:Na,bl:Ns,br:ks,tex:Ar,writingMode:et.writingMode,glyphOffset:Xo,sectionIndex:Rn.sectionIndex,isSDF:qi,pixelOffsetTL:fo,pixelOffsetBR:js,minFontScaleX:0,minFontScaleY:0})}}return cn}(0,h,M,x,C,D,m,o.allowVerticalPlacement),We=o.textSizeData;let Le=null;"source"===We.kind?(Le=[pc*x.layout.get("text-size").evaluate(D,{},Ee)],Le[0]>Pl&&Gn(`${o.layerIds[0]}: Value for "text-size" is >= ${ph}. Reduce your "text-size".`)):"composite"===We.kind&&(Le=[pc*ae.compositeTextSizes[0].evaluate(D,{},Ee),pc*ae.compositeTextSizes[1].evaluate(D,{},Ee)],(Le[0]>Pl||Le[1]>Pl)&&Gn(`${o.layerIds[0]}: Value for "text-size" is >= ${ph}. Reduce your "text-size".`)),o.addSymbols(o.text,Pe,Le,M,C,D,U,t,l,P.lineStartIndex,P.lineLength,ne,pe,Ee);for(const $e of G)Y[$e]=o.text.placedSymbolArray.length-1;return 4*Pe.length}function f0(o){for(const t in o)return o[t];return null}function im(o,t,l,h,m,x,C,D,M,P){let U=C.top,G=C.bottom,Y=C.left,ne=C.right;const ae=C.collisionPadding;if(ae&&(Y-=ae[0],U-=ae[1],ne+=ae[2],G+=ae[3]),M){const pe=new gt(Y,U),Ee=new gt(ne,U),Pe=new gt(Y,G),We=new gt(ne,G),Le=Yt(M);let $e=new gt(0,0);P&&($e=new gt(P[0],P[1])),pe._rotateAround(Le,$e),Ee._rotateAround(Le,$e),Pe._rotateAround(Le,$e),We._rotateAround(Le,$e),Y=Math.min(pe.x,Ee.x,Pe.x,We.x),ne=Math.max(pe.x,Ee.x,Pe.x,We.x),U=Math.min(pe.y,Ee.y,Pe.y,We.y),G=Math.max(pe.y,Ee.y,Pe.y,We.y)}return o.emplaceBack(t.x,t.y,t.z,l.x,l.y,Y,U,ne,G,D,h,m,x),o.length-1}function Wa(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const t=o.bottom-o.top;return t>0?Math.max(10,t):null}function T_(o,t,l,h){const m=o.compareText;if(t in m){const x=m[t];for(let C=x.length-1;C>=0;C--)if(h.dist(x[C])<l)return!0}else m[t]=[];return m[t].push(h),!1}function jp(o,t){const l=o.fovAboveCenter,h=o.elevation?o.elevation.getMinElevationBelowMSL()*t:0,m=(o._camera.position[2]*o.worldSize-h)/Math.cos(o._pitch),x=Math.sin(l)*m/Math.sin(Math.max(Math.PI/2-o._pitch-l,.01)),C=Math.sin(o._pitch)*x+m;return Math.min(1.01*C,m*(1/o._horizonShift))}function gh(o,t){if(!t.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:t};const l=Math.pow(2,-o.z),h=o.x*l,m=(o.x+1)*l,x=o.y*l,C=(o.y+1)*l,D=Rs(h),M=Rs(m),P=La(x),U=La(C),G=t.project(D,P),Y=t.project(M,P),ne=t.project(M,U),ae=t.project(D,U);let pe=Math.min(G.x,Y.x,ne.x,ae.x),Ee=Math.min(G.y,Y.y,ne.y,ae.y),Pe=Math.max(G.x,Y.x,ne.x,ae.x),We=Math.max(G.y,Y.y,ne.y,ae.y);const Le=l/16;function $e(Xe,Ft,Rt,tn,Dn,Ht){const cn=(Rt+Dn)/2,fn=(tn+Ht)/2,bn=t.project(Rs(cn),La(fn)),Pn=Math.max(0,pe-bn.x,Ee-bn.y,bn.x-Pe,bn.y-We);pe=Math.min(pe,bn.x),Pe=Math.max(Pe,bn.x),Ee=Math.min(Ee,bn.y),We=Math.max(We,bn.y),Pn>Le&&($e(Xe,bn,Rt,tn,cn,fn),$e(bn,Ft,cn,fn,Dn,Ht))}$e(G,Y,h,x,m,x),$e(Y,ne,m,x,m,C),$e(ne,ae,m,C,h,C),$e(ae,G,h,C,h,x),pe-=Le,Ee-=Le,Pe+=Le,We+=Le;const et=1/Math.max(Pe-pe,We-Ee);return{scale:et,x:pe*et,y:Ee*et,x2:Pe*et,y2:We*et,projection:t}}const S_=Rc(new Float32Array(16));class Mu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,l){return{x:0,y:0,z:0}}unproject(t,l){return new yo(0,0)}projectTilePoint(t,l,h){return{x:t,y:l,z:0}}locationPoint(t,l,h=!0){return t._coordinatePoint(t.locationCoordinate(l),h)}pixelsPerMeter(t,l){return ic(1,t)*l}pixelSpaceConversion(t,l,h){return 1}farthestPixelDistance(t){return jp(t,t.pixelsPerMeter)}pointCoordinate(t,l,h,m){const x=t.horizonLineFromTop(!1),C=new gt(l,Math.max(x,h));return t.rayIntersectionCoordinate(t.pointRayIntersection(C,m))}pointCoordinate3D(t,l,h){const m=new gt(l,h);if(t.elevation)return t.elevation.pointCoordinate(m);{const x=this.pointCoordinate(t,m.x,m.y,0);return[x.x,x.y,x.z]}}isPointAboveHorizon(t,l){if(t.elevation)return!this.pointCoordinate3D(t,l.x,l.y);const h=t.horizonLineFromTop();return l.y<h}createInversionMatrix(t,l){return S_}createTileMatrix(t,l,h){let m,x,C;const D=h.canonical,M=Rc(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=gh(D,this);m=1,x=P.x+h.wrap*P.scale,C=P.y,yd(M,M,[m/P.scale,m/P.scale,t.pixelsPerMeter/l])}else m=l/t.zoomScale(D.z),x=(D.x+Math.pow(2,D.z)*h.wrap)*m,C=D.y*m;return dc(M,M,[x,C,0]),yd(M,M,[m/Tr,m/Tr,1]),M}upVector(t,l,h){return[0,0,1]}upVectorScale(t,l,h){return{metersToTile:1}}}class p0 extends Mu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[l,h]=this.parallels=t.parallels||[29.5,45.5],m=Math.sin(Yt(l));this.n=(m+Math.sin(Yt(h)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(t,l){const{n:h,c:m,r0:x}=this,C=Yt(t-this.center[0]),D=Yt(l),M=Math.sqrt(m-2*h*Math.sin(D))/h;return{x:M*Math.sin(C*h),y:M*Math.cos(C*h)-x,z:0}}unproject(t,l){const{n:h,c:m,r0:x}=this,C=x+l;let D=Math.atan2(t,Math.abs(C))*Math.sign(C);C*h<0&&(D-=Math.PI*Math.sign(t)*Math.sign(C));const M=Yt(this.center[0])*h;D=Zr(D,-Math.PI-M,Math.PI-M);const P=xr(Kt(D/h)+this.center[0],-180,180),U=Math.asin(xr((m-(t*t+C*C)*h*h)/(2*h),-1,1)),G=xr(Kt(U),-al,al);return new yo(P,G)}}const lf=1.340264,Yf=-.081106,cf=893e-6,uf=.003796,Hp=Math.sqrt(3)/2;class I_ extends Mu{project(t,l){l=l/180*Math.PI,t=t/180*Math.PI;const h=Math.asin(Hp*Math.sin(l)),m=h*h,x=m*m*m;return{x:.5*(t*Math.cos(h)/(Hp*(lf+3*Yf*m+x*(7*cf+9*uf*m)))/Math.PI+.5),y:1-.5*(h*(lf+Yf*m+x*(cf+uf*m))/Math.PI+1),z:0}}unproject(t,l){t=(2*t-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,m=h*h,x=m*m*m;for(let U,G,Y,ne=0;ne<12&&(G=h*(lf+Yf*m+x*(cf+uf*m))-l,Y=lf+3*Yf*m+x*(7*cf+9*uf*m),U=G/Y,h=xr(h-U,-Math.PI/3,Math.PI/3),m=h*h,x=m*m*m,!(Math.abs(U)<1e-12));++ne);const C=Hp*t*(lf+3*Yf*m+x*(7*cf+9*uf*m))/Math.cos(h),D=Math.asin(Math.sin(h)/Hp),M=xr(180*C/Math.PI,-180,180),P=xr(180*D/Math.PI,-al,al);return new yo(M,P)}}class M_ extends Mu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,l){return{x:.5+t/360,y:.5-l/360,z:0}}unproject(t,l){const h=360*(t-.5),m=xr(360*(.5-l),-al,al);return new yo(h,m)}}const mh=Math.PI/2;function id(o){return Math.tan((mh+o)/2)}class od extends Mu{constructor(t){super(t),this.center=t.center||[0,30];const[l,h]=this.parallels=t.parallels||[30,30];let m=Yt(l),x=Yt(h);this.southernCenter=m+x<0,this.southernCenter&&(m=-m,x=-x);const C=Math.cos(m),D=id(m);this.n=m===x?Math.sin(m):Math.log(C/Math.cos(x))/Math.log(id(x)/D),this.f=C*Math.pow(id(m),this.n)/this.n}project(t,l){l=Yt(l),this.southernCenter&&(l=-l),t=Yt(t-this.center[0]);const h=1e-6,{n:m,f:x}=this;x>0?l<-mh+h&&(l=-mh+h):l>mh-h&&(l=mh-h);const C=x/Math.pow(id(l),m);let D=C*Math.sin(m*t),M=x-C*Math.cos(m*t);return D=.5*(D/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:D,y:this.southernCenter?M:1-M,z:0}}unproject(t,l){t=(2*t-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f:m}=this,x=m-l,C=Math.sign(x),D=Math.sign(h)*Math.sqrt(t*t+x*x);let M=Math.atan2(t,Math.abs(x))*C;x*h<0&&(M-=Math.PI*Math.sign(t)*C);const P=xr(Kt(M/h)+this.center[0],-180,180),U=xr(Kt(2*Math.atan(Math.pow(m/D,1/h))-mh),-al,al);return new yo(P,this.southernCenter?-U:U)}}class _h extends Mu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,l){return{x:hc(t),y:Vs(l),z:0}}unproject(t,l){const h=Rs(t),m=La(l);return new yo(h,m)}}const g0=Yt(al);class O_ extends Mu{project(t,l){const h=(l=Yt(l))*l,m=h*h;return{x:.5*((t=Yt(t))*(.8707-.131979*h+m*(m*(.003971*h-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+m*(.028874*h-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(t,l){t=(2*t-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,m=25,x=0,C=h*h;do{C=h*h;const P=C*C;x=(h*(1.007226+C*(.015085+P*(.028874*C-.044475-.005916*P)))-l)/(1.007226+C*(.045255+P*(.259866*C-.311325-.005916*11*P))),h=xr(h-x,-g0,g0)}while(Math.abs(x)>1e-6&&--m>0);C=h*h;const D=xr(Kt(t/(.8707+C*(C*(C*C*C*(.003971-.001529*C)-.013791)-.131979))),-180,180),M=Kt(h);return new yo(D,M)}}const om=Yt(al);class m0 extends Mu{project(t,l){l=Yt(l),t=Yt(t);const h=Math.cos(l),m=2/Math.PI,x=Math.acos(h*Math.cos(t/2)),C=Math.sin(x)/x,D=.5*(t*m+2*h*Math.sin(t/2)/C)||0,M=.5*(l+Math.sin(l)/C)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(t,l){let h=t=(2*t-.5)*Math.PI,m=l=(2*(1-l)-1)*Math.PI,x=25;const C=1e-6;let D=0,M=0;do{const P=Math.cos(m),U=Math.sin(m),G=2*U*P,Y=U*U,ne=P*P,ae=Math.cos(h/2),pe=Math.sin(h/2),Ee=2*ae*pe,Pe=pe*pe,We=1-ne*ae*ae,Le=We?1/We:0,$e=We?Math.acos(P*ae)*Math.sqrt(1/We):0,et=.5*(2*$e*P*pe+2*h/Math.PI)-t,Xe=.5*($e*U+m)-l,Ft=.5*Le*(ne*Pe+$e*P*ae*Y)+1/Math.PI,Rt=Le*(Ee*G/4-$e*U*pe),tn=.125*Le*(G*pe-$e*U*ne*Ee),Dn=.5*Le*(Y*ae+$e*Pe*P)+.5,Ht=Rt*tn-Dn*Ft;D=(Xe*Rt-et*Dn)/Ht,M=(et*tn-Xe*Ft)/Ht,h=xr(h-D,-Math.PI,Math.PI),m=xr(m-M,-om,om)}while((Math.abs(D)>C||Math.abs(M)>C)&&--x>0);return new yo(Kt(h),Kt(m))}}class Gp extends Mu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Yt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,l){const{scale:h,cosPhi:m}=this;return{x:Yt(t)*m*h+.5,y:-Math.sin(Yt(l))/m*h+.5,z:0}}unproject(t,l){const{scale:h,cosPhi:m}=this,x=-(l-.5)/h,C=xr(Kt((t-.5)/h)/m,-180,180),D=Math.asin(xr(x*m,-1,1)),M=xr(Kt(D),-al,al);return new yo(C,M)}}class Kf extends _h{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,l,h){const m=Cd(t,l,h);return Ts(m,m,Yd(sl(h))),{x:m[0],y:m[1],z:m[2]}}locationPoint(t,l){const h=Ed(l.lat,l.lng),m=Pa([],h),x=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(l),t._centerAltitude):t._centerAltitude;ju(h,h,m,ic(1,0)*Tr*x);const C=Rc(new Float64Array(16));return eu(C,t.pixelMatrix,t.globeMatrix),Ts(h,h,C),new gt(h[0],h[1])}pixelsPerMeter(t,l){return ic(1,0)*l}pixelSpaceConversion(t,l,h){const m=ic(1,t)*l,x=ri(ic(1,45)*l,m,h);return this.pixelsPerMeter(t,l)/x}createTileMatrix(t,l,h){const m=If(sl(h.canonical));return eu(new Float64Array(16),t.globeMatrix,m)}createInversionMatrix(t,l){const{center:h}=t,m=Yd(sl(l));return $d(m,m,Yt(h.lng)),Mh(m,m,Yt(h.lat)),yd(m,m,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(t,l,h,m){return Df(t,l,h,!0)||new Eu(0,0)}pointCoordinate3D(t,l,h){const m=this.pointCoordinate(t,l,h,0);return[m.x,m.y,m.z]}isPointAboveHorizon(t,l){return!Df(t,l.x,l.y,!1)}farthestPixelDistance(t){const l=function(m,x){const C=m.cameraToCenterDistance,D=m._centerAltitude*x,M=m._camera,P=m._camera.forward(),U=tu([],$l([],P,-C),[0,0,D]),G=m.worldSize/(2*Math.PI),Y=[0,0,-G],ne=m.width/m.height,ae=Math.tan(m.fovAboveCenter),pe=$l([],M.up(),ae),Ee=$l([],M.right(),ae*ne),Pe=Pa([],tu([],tu([],P,pe),Ee)),We=[];let Le;if(new Cf(U,Pe).closestPointOnSphere(Y,G,We)){const $e=tu([],We,Y),et=Wl([],$e,U);Le=Math.cos(m.fovAboveCenter)*xd(et)}else{const $e=Wl([],U,Y),et=Wl([],Y,U);Pa(et,et);const Xe=xd($e)-G;Le=Math.sqrt(Xe*(Xe+2*G));const Ft=Math.acos(Le/(G+Xe))-Math.acos(Il(P,et));Le*=Math.cos(Ft)}return 1.01*Le}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),h=bu(t.zoom);if(h>0){const m=jp(t,ic(1,t.center.lat)*t.worldSize),x=t.worldSize/(2*Math.PI),C=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ri(l,m+x*(1-Math.cos(C)),Math.pow(h,10))}return l}upVector(t,l,h){return Cd(l,h,t,1)}upVectorScale(t){return{metersToTile:Wu(Ad(sl(t)))}}}function Jf(o){const t=o.parallels,l=!!t&&Math.abs(t[0]+t[1])<.01;switch(o.name){case"mercator":return new _h(o);case"equirectangular":return new M_(o);case"naturalEarth":return new O_(o);case"equalEarth":return new I_(o);case"winkelTripel":return new m0(o);case"albers":return l?new Gp(o):new p0(o);case"lambertConformalConic":return l?new Gp(o):new od(o);case"globe":return new Kf(o)}throw new Error(`Invalid projection name: ${o.name}`)}const _0=Id.types,v0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $p(o,t,l,h,m,x,C,D,M,P,U,G,Y){const ne=D?Math.min(Pl,Math.round(D[0])):0,ae=D?Math.min(Pl,Math.round(D[1])):0;o.emplaceBack(t,l,Math.round(32*h),Math.round(32*m),x,C,(ne<<1)+(M?1:0),ae,16*P,16*U,256*G,256*Y)}function Wp(o,t,l,h,m,x,C){o.emplaceBack(t,l,h,m,x,C)}function Zp(o,t,l,h,m){o.emplaceBack(t,l,h,m),o.emplaceBack(t,l,h,m),o.emplaceBack(t,l,h,m),o.emplaceBack(t,l,h,m)}function P_(o){for(const t of o.sections)if(B(t.text))return!0;return!1}class qp{constructor(t){this.layoutVertexArray=new gn,this.indexArray=new dr,this.programConfigurations=t,this.segments=new So,this.dynamicLayoutVertexArray=new yn,this.opacityVertexArray=new Er,this.placedSymbolArray=new Ps,this.globeExtVertexArray=new An}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,l,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,p_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Op.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,v0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,zg.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Kn(qp,"SymbolBuffers");class y0{constructor(t,l,h){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new h,this.segments=new So,this.collisionVertexArray=new _i,this.collisionVertexArrayExt=new oi}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g_.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Ug.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Kn(y0,"CollisionBuffers");class Ld{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(C=>C.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rc([]),this.placementViewportMatrix=Rc([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vg(this.zoom,l["text-size"]),this.iconSizeData=Vg(this.zoom,l["icon-size"]);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),x=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==x&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===x||"auto"===x&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(C=>gc[C]),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new qp(new Hd(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qp(new Hd(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ol,this.lineVertexArray=new Nu,this.symbolInstances=new Po}calculateGlyphDependencies(t,l,h,m,x){for(let C=0;C<t.length;C++)if(l[t.charCodeAt(C)]=!0,m&&x){const D=Uf[t.charAt(C)];D&&(l[D.charCodeAt(0)]=!0)}}populate(t,l,h,m){const x=this.layers[0],C=x.layout,D="globe"===this.projection.name,M=C.get("text-font"),P=C.get("text-field"),U=C.get("icon-image"),G=("constant"!==P.value.kind||P.value.value instanceof bs&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&("constant"!==M.value.kind||M.value.value.length>0),Y="constant"!==U.value.kind||!!U.value.value||Object.keys(U.parameters).length>0,ne=C.get("symbol-sort-key");if(this.features=[],!G&&!Y)return;const ae=l.iconDependencies,pe=l.glyphDependencies,Ee=l.availableImages,Pe=new H(this.zoom);for(const{feature:We,id:Le,index:$e,sourceLayerIndex:et}of t){const Xe=x._featureFilter.needGeometry,Ft=kc(We,Xe);if(!x._featureFilter.filter(Pe,Ft,h))continue;if(Xe||(Ft.geometry=zl(We,h,m)),D&&1!==We.type&&h.z<=5){const Ht=Ft.geometry,cn=.98078528056,fn=(bn,Pn)=>Il(Cd(bn.x,bn.y,h,1),Cd(Pn.x,Pn.y,h,1))<cn;for(let bn=0;bn<Ht.length;bn++)Ht[bn]=Cg(Ht[bn],fn)}let Rt,tn;if(G){const Ht=x.getValueAndResolveTokens("text-field",Ft,h,Ee),cn=bs.factory(Ht);P_(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===T()||this.hasRTLText&&k.isParsed())&&(Rt=m_(cn,x,Ft))}if(Y){const Ht=x.getValueAndResolveTokens("icon-image",Ft,h,Ee);tn=Ht instanceof Qo?Ht:Qo.fromString(Ht)}if(!Rt&&!tn)continue;const Dn=this.sortFeaturesByKey?ne.evaluate(Ft,{},h):void 0;if(this.features.push({id:Le,text:Rt,icon:tn,index:$e,sourceLayerIndex:et,geometry:Ft.geometry,properties:We.properties,type:_0[We.type],sortKey:Dn}),tn&&(ae[tn.name]=!0),Rt){const Ht=M.evaluate(Ft,{},h).join(","),cn="map"===C.get("text-rotation-alignment")&&"point"!==C.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(gc.vertical)>=0;for(const fn of Rt.sections)if(fn.image)ae[fn.image.name]=!0;else{const bn=fu(Rt.toString()),Pn=fn.fontStack||Ht,Jt=pe[Pn]=pe[Pn]||{};this.calculateGlyphDependencies(fn.text,Jt,cn,this.allowVerticalPlacement,bn)}}}"line"===C.get("symbol-placement")&&(this.features=function(We){const Le={},$e={},et=[];let Xe=0;function Ft(Ht){et.push(We[Ht]),Xe++}function Rt(Ht,cn,fn){const bn=$e[Ht];return delete $e[Ht],$e[cn]=bn,et[bn].geometry[0].pop(),et[bn].geometry[0]=et[bn].geometry[0].concat(fn[0]),bn}function tn(Ht,cn,fn){const bn=Le[cn];return delete Le[cn],Le[Ht]=bn,et[bn].geometry[0].shift(),et[bn].geometry[0]=fn[0].concat(et[bn].geometry[0]),bn}function Dn(Ht,cn,fn){const bn=fn?cn[0][cn[0].length-1]:cn[0][0];return`${Ht}:${bn.x}:${bn.y}`}for(let Ht=0;Ht<We.length;Ht++){const cn=We[Ht],fn=cn.geometry,bn=cn.text?cn.text.toString():null;if(!bn){Ft(Ht);continue}const Pn=Dn(bn,fn),Jt=Dn(bn,fn,!0);if(Pn in $e&&Jt in Le&&$e[Pn]!==Le[Jt]){const qn=tn(Pn,Jt,fn),ar=Rt(Pn,Jt,et[qn].geometry);delete Le[Pn],delete $e[Jt],$e[Dn(bn,et[ar].geometry,!0)]=ar,et[qn].geometry=null}else Pn in $e?Rt(Pn,Jt,fn):Jt in Le?tn(Pn,Jt,fn):(Ft(Ht),Le[Pn]=Xe-1,$e[Jt]=Xe-1)}return et.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((We,Le)=>We.sortKey-Le.sortKey)}update(t,l,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,h,m),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,h,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Jf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){const h=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:m,y:x}of l)this.lineVertexArray.emplaceBack(m,x);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(t,l,h,m,x,C,D,M,P,U,G,Y,ne,ae){const pe=t.indexArray,Ee=t.layoutVertexArray,Pe=t.globeExtVertexArray,We=t.segments.prepareSegment(4*l.length,Ee,pe,this.canOverlap?C.sortKey:void 0),Le=this.glyphOffsetArray.length,$e=We.vertexLength,et=this.allowVerticalPlacement&&D===gc.vertical?Math.PI/2:0,Xe=C.text&&C.text.sections;for(let Rt=0;Rt<l.length;Rt++){const{tl:tn,tr:Dn,bl:Ht,br:cn,tex:fn,pixelOffsetTL:bn,pixelOffsetBR:Pn,minFontScaleX:Jt,minFontScaleY:qn,glyphOffset:ar,isSDF:Yn,sectionIndex:li}=l[Rt],Rn=We.vertexLength,Ar=ar[1];if($p(Ee,P.x,P.y,tn.x,Ar+tn.y,fn.x,fn.y,h,Yn,bn.x,bn.y,Jt,qn),$p(Ee,P.x,P.y,Dn.x,Ar+Dn.y,fn.x+fn.w,fn.y,h,Yn,Pn.x,bn.y,Jt,qn),$p(Ee,P.x,P.y,Ht.x,Ar+Ht.y,fn.x,fn.y+fn.h,h,Yn,bn.x,Pn.y,Jt,qn),$p(Ee,P.x,P.y,cn.x,Ar+cn.y,fn.x+fn.w,fn.y+fn.h,h,Yn,Pn.x,Pn.y,Jt,qn),M){const{x:ci,y:qi,z:ui}=M.anchor,[jr,ss,pi]=M.up;Wp(Pe,ci,qi,ui,jr,ss,pi),Wp(Pe,ci,qi,ui,jr,ss,pi),Wp(Pe,ci,qi,ui,jr,ss,pi),Wp(Pe,ci,qi,ui,jr,ss,pi),Zp(t.dynamicLayoutVertexArray,ci,qi,ui,et)}else Zp(t.dynamicLayoutVertexArray,P.x,P.y,P.z,et);pe.emplaceBack(Rn,Rn+1,Rn+2),pe.emplaceBack(Rn+1,Rn+2,Rn+3),We.vertexLength+=4,We.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ar[0]),Rt!==l.length-1&&li===l[Rt+1].sectionIndex||t.programConfigurations.populatePaintArrays(Ee.length,C,C.index,{},ne,ae,Xe&&Xe[li])}const Ft=M?M.anchor:P;t.placedSymbolArray.emplaceBack(Ft.x,Ft.y,Ft.z,P.x,P.y,Le,this.glyphOffsetArray.length-Le,$e,U,G,P.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],D,0,!1,0,Y,0)}_commitLayoutVertex(t,l,h,m,x,C,D){t.emplaceBack(l,h,m,x,C,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(t,l,h,m,x,C,D){const M=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),P=M.vertexLength,U=D.tileAnchorX,G=D.tileAnchorY;for(let ne=0;ne<4;ne++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-t.padding,-t.padding),h.collisionVertexArrayExt.emplaceBack(l,t.padding,-t.padding),h.collisionVertexArrayExt.emplaceBack(l,t.padding,t.padding),h.collisionVertexArrayExt.emplaceBack(l,-t.padding,t.padding),this._commitLayoutVertex(h.layoutVertexArray,m,x,C,U,G,new gt(t.x1,t.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,x,C,U,G,new gt(t.x2,t.y1)),this._commitLayoutVertex(h.layoutVertexArray,m,x,C,U,G,new gt(t.x2,t.y2)),this._commitLayoutVertex(h.layoutVertexArray,m,x,C,U,G,new gt(t.x1,t.y2)),M.vertexLength+=4;const Y=h.indexArray;Y.emplaceBack(P,P+1),Y.emplaceBack(P+1,P+2),Y.emplaceBack(P+2,P+3),Y.emplaceBack(P+3,P),M.primitiveLength+=4}_addTextDebugCollisionBoxes(t,l,h,m,x,C){for(let D=m;D<x;D++){const M=h.get(D),P=this.getSymbolInstanceTextSize(t,C,l,D);this._addCollisionDebugVertices(M,P,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,C)}}_addIconDebugCollisionBoxes(t,l,h,m,x,C){for(let D=m;D<x;D++){const M=h.get(D),P=this.getSymbolInstanceIconSize(t,l,C.placedIconSymbolIndex);this._addCollisionDebugVertices(M,P,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,C)}}generateCollisionDebugBuffers(t,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new y0(sr,zf.members,ua),this.iconCollisionBox=new y0(sr,zf.members,ua);const h=ch(this.iconSizeData,t),m=ch(this.textSizeData,t);for(let x=0;x<this.symbolInstances.length;x++){const C=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(m,t,l,C.textBoxStartIndex,C.textBoxEndIndex,C),this._addTextDebugCollisionBoxes(m,t,l,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._addIconDebugCollisionBoxes(h,t,l,C.iconBoxStartIndex,C.iconBoxEndIndex,C),this._addIconDebugCollisionBoxes(h,t,l,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C)}}getSymbolInstanceTextSize(t,l,h,m){const x=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:m),C=Pp(this.textSizeData,t,x)/wa;return this.tilePixelRatio*C}getSymbolInstanceIconSize(t,l,h){const m=this.icon.placedSymbolArray.get(h),x=Pp(this.iconSizeData,t,m);return this.tilePixelRatio*x}_commitDebugCollisionVertexUpdate(t,l,h){t.emplaceBack(l,-h,-h),t.emplaceBack(l,h,-h),t.emplaceBack(l,h,h),t.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(t,l,h,m,x,C){for(let D=m;D<x;D++){const M=h.get(D),P=this.getSymbolInstanceTextSize(t,C,l,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,M.padding)}}_updateIconDebugCollisionBoxes(t,l,h,m,x,C){for(let D=m;D<x;D++){const M=h.get(D),P=this.getSymbolInstanceIconSize(t,l,C);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,M.padding)}}updateCollisionDebugBuffers(t,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=ch(this.iconSizeData,t),m=ch(this.textSizeData,t);for(let x=0;x<this.symbolInstances.length;x++){const C=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,t,l,C.textBoxStartIndex,C.textBoxEndIndex,C),this._updateTextDebugCollisionBoxes(m,t,l,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C),this._updateIconDebugCollisionBoxes(h,t,l,C.iconBoxStartIndex,C.iconBoxEndIndex,C.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,t,l,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,l,h,m,x,C,D,M,P){const U={};if(l<h){const{x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e,featureIndex:et}=t.get(l);U.textBox={x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e},U.textFeatureIndex=et}if(m<x){const{x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e,featureIndex:et}=t.get(m);U.verticalTextBox={x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e},U.verticalTextFeatureIndex=et}if(C<D){const{x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e,featureIndex:et}=t.get(C);U.iconBox={x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e},U.iconFeatureIndex=et}if(M<P){const{x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e,featureIndex:et}=t.get(M);U.verticalIconBox={x1:G,y1:Y,x2:ne,y2:ae,padding:pe,projectedAnchorX:Ee,projectedAnchorY:Pe,projectedAnchorZ:We,tileAnchorX:Le,tileAnchorY:$e},U.verticalIconFeatureIndex=et}return U}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){const h=t.placedSymbolArray.get(l),m=h.vertexStartIndex+4*h.numGlyphs;for(let x=h.vertexStartIndex;x<m;x+=4)t.indexArray.emplaceBack(x,x+1,x+2),t.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(t),h=Math.cos(t),m=[],x=[],C=[];for(let D=0;D<this.symbolInstances.length;++D){C.push(D);const M=this.symbolInstances.get(D);m.push(0|Math.round(l*M.tileAnchorX+h*M.tileAnchorY)),x.push(M.featureIndex)}return C.sort((D,M)=>m[D]-m[M]||x[M]-x[D]),C}addToSortKeyRanges(t,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:x,leftJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:P}=h;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&x!==m&&this.addIndicesForPlacedSymbol(this.text,x),C>=0&&C!==x&&C!==m&&this.addIndicesForPlacedSymbol(this.text,C),D>=0&&this.addIndicesForPlacedSymbol(this.text,D),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Kn(Ld,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ld.MAX_GLYPHS=65535,Ld.addDynamicAttributes=Zp;const Hv=new Ve({"symbol-placement":new he(Et.layout_symbol["symbol-placement"]),"symbol-spacing":new he(Et.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(Et.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Te(Et.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(Et.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new he(Et.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(Et.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(Et.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(Et.layout_symbol["icon-rotation-alignment"]),"icon-size":new Te(Et.layout_symbol["icon-size"]),"icon-text-fit":new he(Et.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new he(Et.layout_symbol["icon-text-fit-padding"]),"icon-image":new Te(Et.layout_symbol["icon-image"]),"icon-rotate":new Te(Et.layout_symbol["icon-rotate"]),"icon-padding":new he(Et.layout_symbol["icon-padding"]),"icon-keep-upright":new he(Et.layout_symbol["icon-keep-upright"]),"icon-offset":new Te(Et.layout_symbol["icon-offset"]),"icon-anchor":new Te(Et.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(Et.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(Et.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(Et.layout_symbol["text-rotation-alignment"]),"text-field":new Te(Et.layout_symbol["text-field"]),"text-font":new Te(Et.layout_symbol["text-font"]),"text-size":new Te(Et.layout_symbol["text-size"]),"text-max-width":new Te(Et.layout_symbol["text-max-width"]),"text-line-height":new Te(Et.layout_symbol["text-line-height"]),"text-letter-spacing":new Te(Et.layout_symbol["text-letter-spacing"]),"text-justify":new Te(Et.layout_symbol["text-justify"]),"text-radial-offset":new Te(Et.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(Et.layout_symbol["text-variable-anchor"]),"text-anchor":new Te(Et.layout_symbol["text-anchor"]),"text-max-angle":new he(Et.layout_symbol["text-max-angle"]),"text-writing-mode":new he(Et.layout_symbol["text-writing-mode"]),"text-rotate":new Te(Et.layout_symbol["text-rotate"]),"text-padding":new he(Et.layout_symbol["text-padding"]),"text-keep-upright":new he(Et.layout_symbol["text-keep-upright"]),"text-transform":new Te(Et.layout_symbol["text-transform"]),"text-offset":new Te(Et.layout_symbol["text-offset"]),"text-allow-overlap":new he(Et.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(Et.layout_symbol["text-ignore-placement"]),"text-optional":new he(Et.layout_symbol["text-optional"])});var x0={paint:new Ve({"icon-opacity":new Te(Et.paint_symbol["icon-opacity"]),"icon-color":new Te(Et.paint_symbol["icon-color"]),"icon-halo-color":new Te(Et.paint_symbol["icon-halo-color"]),"icon-halo-width":new Te(Et.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Te(Et.paint_symbol["icon-halo-blur"]),"icon-translate":new he(Et.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(Et.paint_symbol["icon-translate-anchor"]),"text-opacity":new Te(Et.paint_symbol["text-opacity"]),"text-color":new Te(Et.paint_symbol["text-color"],{runtimeType:bo,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Te(Et.paint_symbol["text-halo-color"]),"text-halo-width":new Te(Et.paint_symbol["text-halo-width"]),"text-halo-blur":new Te(Et.paint_symbol["text-halo-blur"]),"text-translate":new he(Et.paint_symbol["text-translate"]),"text-translate-anchor":new he(Et.paint_symbol["text-translate-anchor"])}),layout:Hv};class sm{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Qs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Kn(sm,"FormatSectionOverride",{omit:["defaultValue"]});class Qf extends Sl{constructor(t){super(t,x0)}recalculate(t,l){super.recalculate(t,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const x of h)m.indexOf(x)<0&&m.push(x);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,l,h,m){const x=this.layout.get(t).evaluate(l,{},h,m),C=this._unevaluatedLayout._values[t];return C.isDataDriven()||ma(C.value)||!x?x:(D=l.properties,x.replace(/{([^{}]+)}/g,(P,U)=>U in D?String(D[U]):""));var D}createBucket(t){return new Ld(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of x0.paint.overridableProperties){if(!Qf.hasPaintOverride(this.layout,t))continue;const l=this.paint.get(t),h=new sm(l),m=new tl(h,l.property.specification);let x=null;x="constant"===l.value.kind||"source"===l.value.kind?new Os("source",m):new nl("composite",m,l.value.zoomStops,l.value._interpolationType),this.paint._values[t]=new Se(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Qf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){const h=t.get("text-field"),m=x0.paint.properties[l];let x=!1;const C=D=>{for(const M of D)if(m.overrides&&m.overrides.hasOverride(M))return void(x=!0)};if("constant"===h.value.kind&&h.value.value instanceof bs)C(h.value.value.sections);else if("source"===h.value.kind){const D=P=>{x||(P instanceof zr&&go(P.value)===fa?C(P.value.sections):P instanceof pa?C(P.sections):P.eachChild(D))},M=h.value;M._styleExpression&&D(M._styleExpression.expression)}return x}getProgramConfiguration(t){return new Vu(this,t)}}var Gv={paint:new Ve({"background-color":new he(Et.paint_background["background-color"]),"background-pattern":new he(Et.paint_background["background-pattern"]),"background-opacity":new he(Et.paint_background["background-opacity"])})},Xp={paint:new Ve({"raster-opacity":new he(Et.paint_raster["raster-opacity"]),"raster-hue-rotate":new he(Et.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(Et.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(Et.paint_raster["raster-brightness-max"]),"raster-saturation":new he(Et.paint_raster["raster-saturation"]),"raster-contrast":new he(Et.paint_raster["raster-contrast"]),"raster-resampling":new he(Et.paint_raster["raster-resampling"]),"raster-fade-duration":new he(Et.paint_raster["raster-fade-duration"])})};class w0 extends Sl{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var b0={paint:new Ve({"sky-type":new he(Et.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(Et.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(Et.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(Et.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(Et.paint_sky["sky-gradient-radius"]),"sky-gradient":new Be(Et.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(Et.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(Et.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(Et.paint_sky["sky-opacity"])})};function am(o,t,l){const h=[0,0,1],m=pp([]);return Ph(m,m,l?-Yt(o)+Math.PI:Yt(o)),wd(m,m,-Yt(t)),Hu(h,h,m),Pa(h,h)}const E0={circle:class extends Sl{constructor(o){super(o,Dg)}createBucket(o){return new Fc(o)}queryRadius(o){const t=o;return Au("circle-radius",this,t)+Au("circle-stroke-width",this,t)+Qd(this.paint.get("circle-translate"))}queryIntersectsFeature(o,t,l,h,m,x,C,D){const M=eh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,o.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(t,l)+this.paint.get("circle-stroke-width").evaluate(t,l);return Tg(o,h,x,C,D,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),M,P)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Vu(this,o)}},heatmap:class extends Sl{createBucket(o){return new wp(o)}constructor(o){super(o,Tu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=os({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Au("heatmap-radius",this,o)}queryIntersectsFeature(o,t,l,h,m,x,C,D){const M=this.paint.get("heatmap-radius").evaluate(t,l);return Tg(o,h,x,C,D,!0,!0,new gt(0,0),M)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Vu(this,o)}},hillshade:class extends Sl{constructor(o){super(o,Ls)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Sl{constructor(o){super(o,ot)}getProgramIds(){const o=this.paint.get("fill-pattern"),t=o&&o.constantOr(1),l=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(o){return new Vu(this,o)}recalculate(o,t){super.recalculate(o,t);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Ce(o)}queryRadius(){return Qd(this.paint.get("fill-translate"))}queryIntersectsFeature(o,t,l,h,m,x){return!o.queryGeometry.isAboveHorizon&&Jd(Du(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,o.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends Sl{constructor(o){super(o,$m)}createBucket(o){return new Bf(o)}queryRadius(){return Qd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Vu(this,o)}queryIntersectsFeature(o,t,l,h,m,x,C,D,M){const P=eh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,o.pixelToTileUnitsFactor),U=this.paint.get("fill-extrusion-height").evaluate(t,l),G=this.paint.get("fill-extrusion-base").evaluate(t,l),Y=[0,0],ne=D&&x.elevation,ae=x.elevation?x.elevation.exaggeration():1,pe=o.tile.getBucket(this);if(ne&&pe instanceof Bf){const $e=pe.centroidVertexArray,et=M+1;et<$e.length&&(Y[0]=$e.geta_centroid_pos0(et),Y[1]=$e.geta_centroid_pos1(et))}if(0===Y[0]&&1===Y[1])return!1;"globe"===x.projection.name&&(h=Gm([h],[new gt(0,0),new gt(Tr,Tr)],o.tileID.canonical).map($e=>$e.polygon).flat());const Ee=ne?D:null,[Pe,We]=(et=h,Xe=G,Ft=U,Rt=P,tn=C,Dn=Ee,Ht=Y,cn=ae,fn=x.center.lat,"globe"===($e=x).projection.name?function(Pn,Jt,qn,ar,Yn,li,Rn,Ar,ci,qi,ui){const jr=[],ss=[],pi=Pn.projection.upVectorScale(ui,Pn.center.lat,Pn.worldSize).metersToTile,gi=[0,0,0,1],Vo=[0,0,0,1],Xo=(Lo,Ss,Ks,Js)=>{Lo[0]=Ss,Lo[1]=Ks,Lo[2]=Js,Lo[3]=1},jo=Hm();qn>0&&(qn+=jo),ar+=jo;for(const Lo of Jt){const Ss=[],Ks=[];for(const Js of Lo){const No=Js.x+Yn.x,Na=Js.y+Yn.y,Ns=Pn.projection.projectTilePoint(No,Na,ui),ks=Pn.projection.upVector(ui,Js.x,Js.y);let fo=qn,js=ar;if(Rn){const Yo=Sp(No,Na,qn,ar,Rn,Ar,ci,qi);fo+=Yo.base,js+=Yo.top}0!==qn?Xo(gi,Ns.x+ks[0]*pi*fo,Ns.y+ks[1]*pi*fo,Ns.z+ks[2]*pi*fo):Xo(gi,Ns.x,Ns.y,Ns.z),Xo(Vo,Ns.x+ks[0]*pi*js,Ns.y+ks[1]*pi*js,Ns.z+ks[2]*pi*js),Ts(gi,gi,li),Ts(Vo,Vo,li),Ss.push(new lh(gi[0],gi[1],gi[2])),Ks.push(new lh(Vo[0],Vo[1],Vo[2]))}jr.push(Ss),ss.push(Ks)}return[jr,ss]}($e,et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn,o.tileID.canonical):Dn?function(Pn,Jt,qn,ar,Yn,li,Rn,Ar,ci){const qi=[],ui=[],jr=[0,0,0,1];for(const ss of Pn){const pi=[],gi=[];for(const Vo of ss){const Xo=Vo.x+ar.x,jo=Vo.y+ar.y,Lo=Sp(Xo,jo,Jt,qn,li,Rn,Ar,ci);jr[0]=Xo,jr[1]=jo,jr[2]=Lo.base,jr[3]=1,Lc(jr,jr,Yn),jr[3]=Math.max(jr[3],1e-5);const Ss=new lh(jr[0]/jr[3],jr[1]/jr[3],jr[2]/jr[3]);jr[0]=Xo,jr[1]=jo,jr[2]=Lo.top,jr[3]=1,Lc(jr,jr,Yn),jr[3]=Math.max(jr[3],1e-5);const Ks=new lh(jr[0]/jr[3],jr[1]/jr[3],jr[2]/jr[3]);pi.push(Ss),gi.push(Ks)}qi.push(pi),ui.push(gi)}return[qi,ui]}(et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn):function(Pn,Jt,qn,ar,Yn){const li=[],Rn=[],Ar=Yn[8]*Jt,ci=Yn[9]*Jt,qi=Yn[10]*Jt,ui=Yn[11]*Jt,jr=Yn[8]*qn,ss=Yn[9]*qn,pi=Yn[10]*qn,gi=Yn[11]*qn;for(const Vo of Pn){const Xo=[],jo=[];for(const Lo of Vo){const Ss=Lo.x+ar.x,Ks=Lo.y+ar.y,Js=Yn[0]*Ss+Yn[4]*Ks+Yn[12],No=Yn[1]*Ss+Yn[5]*Ks+Yn[13],Na=Yn[2]*Ss+Yn[6]*Ks+Yn[14],Ns=Yn[3]*Ss+Yn[7]*Ks+Yn[15],ks=Js+Ar,fo=No+ci,js=Na+qi,Yo=Math.max(Ns+ui,1e-5),Hs=Js+jr,Is=No+ss,Io=Na+pi,Fs=Math.max(Ns+gi,1e-5);Xo.push(new lh(ks/Yo,fo/Yo,js/Yo)),jo.push(new lh(Hs/Fs,Is/Fs,Io/Fs))}li.push(Xo),Rn.push(jo)}return[li,Rn]}(et,Xe,Ft,Rt,tn)),Le=o.queryGeometry;var $e,et,Xe,Ft,Rt,tn,Dn,Ht,cn,fn;return function($e,et,Xe){let Ft=1/0;Jd(Xe,et)&&(Ft=Tp(Xe,et[0]));for(let Rt=0;Rt<et.length;Rt++){const tn=et[Rt],Dn=$e[Rt];for(let Ht=0;Ht<tn.length-1;Ht++){const cn=tn[Ht],fn=[cn,tn[Ht+1],Dn[Ht+1],Dn[Ht],cn];yp(Xe,fn)&&(Ft=Math.min(Ft,Tp(Xe,fn)))}}return Ft!==1/0&&Ft}(Pe,We,Le.isPointQuery()?Le.screenBounds:Le.screenGeometry)}},line:class extends Sl{constructor(o){super(o,Fg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,t){super.recalculate(o,t),this.paint._values["line-floorwidth"]=Bg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Mp(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Vu(this,o)}queryRadius(o){const t=o,l=Od(Au("line-width",this,t),Au("line-gap-width",this,t)),h=Au("line-offset",this,t);return l/2+Math.abs(h)+Qd(this.paint.get("line-translate"))}queryIntersectsFeature(o,t,l,h,m,x){if(o.queryGeometry.isAboveHorizon)return!1;const C=Du(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,o.pixelToTileUnitsFactor),D=o.pixelToTileUnitsFactor/2*Od(this.paint.get("line-width").evaluate(t,l),this.paint.get("line-gap-width").evaluate(t,l)),M=this.paint.get("line-offset").evaluate(t,l);return M&&(h=function(P,U){const G=[],Y=new gt(0,0);for(let ne=0;ne<P.length;ne++){const ae=P[ne],pe=[];for(let Ee=0;Ee<ae.length;Ee++){const Pe=ae[Ee],We=ae[Ee+1],Le=0===Ee?Y:Pe.sub(ae[Ee-1])._unit()._perp(),$e=Ee===ae.length-1?Y:We.sub(Pe)._unit()._perp(),et=Le._add($e)._unit();et._mult(1/(et.x*$e.x+et.y*$e.y)),pe.push(et._mult(U)._add(Pe))}G.push(pe)}return G}(h,M*o.pixelToTileUnitsFactor)),function(P,U,G){for(let Y=0;Y<U.length;Y++){const ne=U[Y];if(P.length>=3)for(let ae=0;ae<ne.length;ae++)if(iu(P,ne[ae]))return!0;if(oc(P,ne,G))return!0}return!1}(C,h,D)}isTileClipped(){return!0}},symbol:Qf,background:class extends Sl{constructor(o){super(o,Gv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Sl{constructor(o){super(o,Xp)}getProgramIds(){return["raster"]}},sky:class extends Sl{constructor(o){super(o,b0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=os({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(o,t){if("atmosphere"===this.paint.get("sky-type")){const h=this.paint.get("sky-atmosphere-sun"),m=!h,x=o.style.light,C=x.properties.get("position");return m&&"viewport"===x.properties.get("anchor")&&Gn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?am(C.azimuthal,90-C.polar,t):am(h[0],90-h[1],t)}const l=this.paint.get("sky-gradient-center");return am(l[0],90-l[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class df{constructor(t,l,h,m){this.context=t,this.format=h,this.texture=t.gl.createTexture(),this.update(l,m)}update(t,l,h){const{width:m,height:x}=t,{context:C}=this,{gl:D}=C,{HTMLImageElement:M,HTMLCanvasElement:P,HTMLVideoElement:U,ImageData:G,ImageBitmap:Y}=ze;if(D.bindTexture(D.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!l||!1!==l.premultiply)),h||this.size&&this.size[0]===m&&this.size[1]===x){const{x:ne,y:ae}=h||{x:0,y:0};t instanceof M||t instanceof P||t instanceof U||t instanceof G||Y&&t instanceof Y?D.texSubImage2D(D.TEXTURE_2D,0,ne,ae,D.RGBA,D.UNSIGNED_BYTE,t):D.texSubImage2D(D.TEXTURE_2D,0,ne,ae,m,x,D.RGBA,D.UNSIGNED_BYTE,t.data)}else this.size=[m,x],t instanceof M||t instanceof P||t instanceof U||t instanceof G||Y&&t instanceof Y?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,t):D.texImage2D(D.TEXTURE_2D,0,this.format,m,x,0,this.format,D.UNSIGNED_BYTE,t.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&D.generateMipmap(D.TEXTURE_2D)}bind(t,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?t===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:t),this.filter=t),l!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Li{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class C0{constructor(){this.tasks={},this.taskQueue=[],gr(["process"],this),this.invoker=new Li(this.process),this.nextId=0}add(t,l){const h=this.nextId++,m=function({type:x,isSymbolTile:C,zoom:D}){return D=D||0,"message"===x?0:"maybePrepare"!==x||C?"parseTile"!==x||C?"parseTile"===x&&C?300-D:"maybePrepare"===x&&C?400-D:500:200-D:100-D}(l);if(0===m){qr();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:t,metadata:l,priority:m,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){qr();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const l=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let t=null,l=1/0;for(let m=0;m<this.taskQueue.length;m++){const x=this.tasks[this.taskQueue[m]];x.priority<l&&(l=x.priority,t=m)}if(null===t)return null;const h=this.taskQueue[t];return this.taskQueue.splice(t,1),h}remove(){this.invoker.remove()}}class lm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){const h=t[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const hf=["tile","layer","source","sourceLayer","state"];class cm{constructor(t,l,h,m,x){this.type="Feature",this._vectorTileFeature=t,this._z=l,this._x=h,this._y=m,this.properties=t.properties,this.id=x}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const l of hf)void 0!==this[l]&&(t[l]=this[l]);return t}}const _c=new Uint16Array(8184);for(let o=0;o<2046;o++){let t=o+2,l=0,h=0,m=0,x=0,C=0,D=0;for(1&t?m=x=C=32:l=h=D=32;(t>>=1)>1;){const P=l+m>>1,U=h+x>>1;1&t?(m=l,x=h,l=C,h=D):(l=m,h=x,m=C,x=D),C=P,D=U}const M=4*o;_c[M+0]=l,_c[M+1]=h,_c[M+2]=m,_c[M+3]=x}const jc=new Uint16Array(2178),Hc=new Uint8Array(1089),ep=new Uint16Array(1089);function Yp(o){return 0===o?-.03125:32===o?.03125:0}var Kp=pt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Jp={type:2,extent:Tr,loadGeometry:()=>[[new gt(0,0),new gt(Tr+1,0),new gt(Tr+1,Tr+1),new gt(0,Tr+1),new gt(0,0)]]};class Qp{constructor(t,l,h,m,x){this.tileID=t,this.uid=Zt(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const l=t+this.timeAdded;l<Fi.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=gh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,l,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,x){const C={};if(!x)return C;for(const D of m){const M=D.layerIds.map(P=>x.getLayer(P)).filter(Boolean);if(0!==M.length){D.layers=M,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(P=>M.filter(U=>U.id===P)[0]));for(const P of M)C[P.id]=D}}return C}(t.buckets,l.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const x=this.buckets[m];if(x instanceof Ld){if(this.hasSymbolBuckets=!0,!h)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const x=this.buckets[m];if(x instanceof Ld&&x.hasRTLText){this.hasRTLText=!0,k.isLoading()||k.isLoaded()||"deferred"!==T()||N();break}}this.queryPadding=0;for(const m in this.buckets){const x=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(m).queryRadius(x))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new ho}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const h in this.buckets){const m=this.buckets[h];m.uploadPending()&&m.upload(t)}const l=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new df(t,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new df(t,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new df(t,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,l,h,m,x,C,D,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:D,transform:C,params:x,tileTransform:this.tileTransform},t,l,h):{}}querySourceFeatures(t,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),x=l?l.sourceLayer:"",C=m._geojsonTileLayer||m[x];if(!C)return;const D=Yc(l&&l.filter),{z:M,x:P,y:U}=this.tileID.canonical,G={z:M,x:P,y:U};for(let Y=0;Y<C.length;Y++){const ne=C.feature(Y);if(D.needGeometry){const Ee=kc(ne,!0);if(!D.filter(new H(this.tileID.overscaledZ),Ee,this.tileID.canonical))continue}else if(!D.filter(new H(this.tileID.overscaledZ),ne))continue;const ae=h.getId(ne,x),pe=new cm(ne,M,P,U,ae);pe.tile=G,t.push(pe)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const h=Ci(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(l)if(this.expirationTime<l)m=!0;else{const x=this.expirationTime-l;x?this.expirationTime=h+Math.max(x,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),m=l.style.listImages();for(const x in this.buckets){if(!l.style.hasLayer(x))continue;const C=this.buckets[x],D=C.layers[0].sourceLayer||"_geojsonTileLayer",M=h[D],P=t[D];if(!M||!P||0===Object.keys(P).length)continue;if(C.update(P,M,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),C instanceof Mp||C instanceof Ce){const G=l.style._getSourceCache(C.layers[0].source);l._terrain&&l._terrain.enabled&&G&&C.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(G.id,this.tileID)}const U=l&&l.style&&l.style.getLayer(x);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(C)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Fi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Fi.now()+t}setTexture(t,l){const h=l.context,m=h.gl;this.texture=this.texture||l.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new df(h,t,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,l){const h={};for(const m of l)h[m]=!0;this.dependencies[t]=h}hasDependency(t,l){for(const h of t){const m=this.dependencies[h];if(m)for(const x of l)if(m[x])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const h=zl(Jp,this.tileID.canonical,this.tileTransform)[0],m=new En,x=new Fl;for(let C=0;C<h.length;C++){const{x:D,y:M}=h[C];m.emplaceBack(D,M),x.emplaceBack(C)}x.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(x),this._tileDebugBuffer=t.createVertexBuffer(m,Rh.members),this._tileDebugSegments=So.simpleSegment(0,0,m.length,x.length)}_makeTileBoundsBuffers(t,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const h=zl(Jp,this.tileID.canonical,this.tileTransform)[0];let m,x;if(this.isRaster){const C=function(D,M){const P=gh(D,M),U=Math.pow(2,D.z);for(let Ee=0;Ee<33;Ee++)for(let Pe=0;Pe<33;Pe++){const We=Rs((D.x+(Pe+Yp(Pe))/32)/U),Le=La((D.y+(Ee+Yp(Ee))/32)/U),$e=M.project(We,Le),et=33*Ee+Pe;jc[2*et+0]=Math.round(($e.x*P.scale-P.x)*Tr),jc[2*et+1]=Math.round(($e.y*P.scale-P.y)*Tr)}Hc.fill(0),ep.fill(0);for(let Ee=2045;Ee>=0;Ee--){const Pe=4*Ee,We=_c[Pe+0],Le=_c[Pe+1],$e=_c[Pe+2],et=_c[Pe+3],Xe=We+$e>>1,Ft=Le+et>>1,Rt=Xe+Ft-Le,tn=Ft+We-Xe,Dn=33*Le+We,Ht=33*et+$e,cn=33*Ft+Xe,fn=Math.hypot((jc[2*Dn+0]+jc[2*Ht+0])/2-jc[2*cn+0],(jc[2*Dn+1]+jc[2*Ht+1])/2-jc[2*cn+1])>=16;Hc[cn]=Hc[cn]||(fn?1:0),Ee<1022&&(Hc[cn]=Hc[cn]||Hc[33*(Le+tn>>1)+(We+Rt>>1)]||Hc[33*(et+tn>>1)+($e+Rt>>1)])}const G=new sn,Y=new dr;let ne=0;function ae(Ee,Pe){const We=33*Pe+Ee;return 0===ep[We]&&(G.emplaceBack(jc[2*We+0],jc[2*We+1],Ee*Tr/32,Pe*Tr/32),ep[We]=++ne),ep[We]-1}function pe(Ee,Pe,We,Le,$e,et){const Xe=Ee+We>>1,Ft=Pe+Le>>1;if(Math.abs(Ee-$e)+Math.abs(Pe-et)>1&&Hc[33*Ft+Xe])pe($e,et,Ee,Pe,Xe,Ft),pe(We,Le,$e,et,Xe,Ft);else{const Rt=ae(Ee,Pe),tn=ae(We,Le),Dn=ae($e,et);Y.emplaceBack(Rt,tn,Dn)}}return pe(0,0,32,32,32,0),pe(32,32,0,0,0,32),{vertices:G,indices:Y}}(this.tileID.canonical,l);m=C.vertices,x=C.indices}else{m=new sn,x=new dr;for(const{x:D,y:M}of h)m.emplaceBack(D,M,0,0);const C=p(m.int16,void 0,4);for(let D=0;D<C.length;D+=3)x.emplaceBack(C[D],C[D+1],C[D+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,Kp.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(x),this._tileBoundsSegments=So.simpleSegment(0,0,m.length,x.length)}_makeGlobeTileDebugBuffers(t,l){const h=l.projection;if(!h||"globe"!==h.name||l.freezeTileCoverage)return;const m=this.tileID.canonical,x=Yd(Tf(m,l)),C=bu(l.zoom);let D;C>0&&(D=Wi(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,l,x,D,C),this._makeGlobeTileDebugTextBuffer(t,m,l,x,D,C)}_globePoint(t,l,h,m,x,C,D){let M=Cd(t,l,h);if(C){const P=1<<h.z,U=hc(m.center.lng),G=Vs(m.center.lat),Y=(h.x+.5)/P-U;let ne=0;Y>.5?ne=-1:Y<-.5&&(ne=1);let ae=(t/Tr+h.x)/P+ne,pe=(l/Tr+h.y)/P;ae=(ae-U)*m._pixelsPerMercatorPixel+U,pe=(pe-G)*m._pixelsPerMercatorPixel+G;const Ee=[ae*m.worldSize,pe*m.worldSize,0];Ts(Ee,Ee,C),M=xu(M,Ee,D)}return Ts(M,M,x)}_makeGlobeTileDebugBorderBuffer(t,l,h,m,x,C){const D=new En,M=new Fl,P=new Ot,U=(Y,ne,ae,pe,Ee)=>{const Pe=(ae-Y)/(Ee-1),We=(pe-ne)/(Ee-1),Le=D.length;for(let $e=0;$e<Ee;$e++){const et=Y+$e*Pe,Xe=ne+$e*We;D.emplaceBack(et,Xe);const Ft=this._globePoint(et,Xe,l,h,m,x,C);P.emplaceBack(Ft[0],Ft[1],Ft[2]),M.emplaceBack(Le+$e)}},G=Tr;U(0,0,G,0,16),U(G,0,G,G,16),U(G,G,0,G,16),U(0,G,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(M),this._tileDebugBuffer=t.createVertexBuffer(D,Rh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,Ef.members),this._tileDebugSegments=So.simpleSegment(0,0,D.length,M.length)}_makeGlobeTileDebugTextBuffer(t,l,h,m,x,C){const D=Tr/4,M=new En,P=new dr,U=new Ot,G=25;P.reserve(32),M.reserve(G),U.reserve(G);const Y=(ne,ae)=>G*ne+ae;for(let ne=0;ne<G;ne++){const ae=ne*D;for(let pe=0;pe<G;pe++){const Ee=pe*D;M.emplaceBack(Ee,ae);const Pe=this._globePoint(Ee,ae,l,h,m,x,C);U.emplaceBack(Pe[0],Pe[1],Pe[2])}}for(let ne=0;ne<4;ne++)for(let ae=0;ae<4;ae++){const pe=Y(ne,ae),Ee=Y(ne,ae+1),Pe=Y(ne+1,ae),We=Y(ne+1,ae+1);P.emplaceBack(pe,Ee,Pe),P.emplaceBack(Pe,Ee,We)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(M,Rh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(U,Ef.members),this._tileDebugTextSegments=So.simpleSegment(0,0,G,32)}}class um{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,h){const m=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},At(this.stateChanges[t][m],h),null===this.deletedStates[t]){this.deletedStates[t]={};for(const x in this.state[t])x!==m&&(this.deletedStates[t][x]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][m]){this.deletedStates[t][m]={};for(const x in this.state[t][m])h[x]||(this.deletedStates[t][m][x]=null)}else for(const x in h)this.deletedStates[t]&&this.deletedStates[t][m]&&null===this.deletedStates[t][m][x]&&delete this.deletedStates[t][m][x]}removeFeatureState(t,l,h){if(null===this.deletedStates[t])return;const m=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&void 0!==l)null!==this.deletedStates[t][m]&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(void 0!==l)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,l){const h=String(l),m=At({},(this.state[t]||{})[h],(this.stateChanges[t]||{})[h]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const x=this.deletedStates[t][l];if(null===x)return{};for(const C in x)delete m[C]}return m}initializeTileState(t,l){t.setFeatureState(this.state,l)}coalesceChanges(t,l){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const x={};for(const C in this.stateChanges[m])this.state[m][C]||(this.state[m][C]={}),At(this.state[m][C],this.stateChanges[m][C]),x[C]=this.state[m][C];h[m]=x}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const x={};if(null===this.deletedStates[m])for(const C in this.state[m])x[C]={},this.state[m][C]={};else for(const C in this.deletedStates[m]){if(null===this.deletedStates[m][C])this.state[m][C]={};else if(this.state[m][C])for(const D of Object.keys(this.deletedStates[m][C]))delete this.state[m][C][D];x[C]=this.state[m][C]}h[m]=h[m]||{},At(h[m],x)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const m in t)t[m].setFeatureState(h,l)}}class A0{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,l){const h=this.toIdx(t,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(t,l){return this.leaves[this.toIdx(t,l)]}toIdx(t,l){return l*this.size+t}}function D0(o,t,l,h){let m=0,x=Number.MAX_VALUE;for(let C=0;C<3;C++)if(Math.abs(h[C])<1e-15){if(l[C]<o[C]||l[C]>t[C])return null}else{const D=1/h[C];let M=(o[C]-l[C])*D,P=(t[C]-l[C])*D;if(M>P){const U=M;M=P,P=U}if(M>m&&(m=M),P<x&&(x=P),m>x)return null}return m}function T0(o,t,l,h,m,x,C,D,M,P,U){const G=h-o,Y=m-t,ne=x-l,ae=C-o,pe=D-t,Ee=M-l,Pe=U[1]*Ee-U[2]*pe,We=U[2]*ae-U[0]*Ee,Le=U[0]*pe-U[1]*ae,$e=G*Pe+Y*We+ne*Le;if(Math.abs($e)<1e-15)return null;const et=1/$e,Xe=P[0]-o,Ft=P[1]-t,Rt=P[2]-l,tn=(Xe*Pe+Ft*We+Rt*Le)*et;if(tn<0||tn>1)return null;const Dn=Ft*ne-Rt*Y,Ht=Rt*G-Xe*ne,cn=Xe*Y-Ft*G,fn=(U[0]*Dn+U[1]*Ht+U[2]*cn)*et;return fn<0||tn+fn>1?null:(ae*Dn+pe*Ht+Ee*cn)*et}function dm(o,t,l){return(o-t)/(l-t)}function S0(o,t,l,h,m,x,C,D,M){const P=1<<l,U=x-h,G=C-m,Y=(o+1)/P*U+h,ne=(t+0)/P*G+m,ae=(t+1)/P*G+m;D[0]=(o+0)/P*U+h,D[1]=ne,M[0]=Y,M[1]=ae}class I0{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(x){const C=Math.ceil(Math.log2(x.dim/8)),D=[];let M=Math.ceil(Math.pow(2,C));const P=1/M,U=(ne,ae,pe,Ee,Pe)=>{const We=Ee?1:0,Le=(ne+1)*pe-We,$e=ae*pe,et=(ae+1)*pe-We;Pe[0]=ne*pe,Pe[1]=$e,Pe[2]=Le,Pe[3]=et};let G=new A0(M);const Y=[];for(let ne=0;ne<M*M;ne++){U(ne%M,Math.floor(ne/M),P,!1,Y);const ae=Nd(Y[0],Y[1],x),pe=Nd(Y[2],Y[1],x),Ee=Nd(Y[2],Y[3],x),Pe=Nd(Y[0],Y[3],x);G.minimums.push(Math.min(ae,pe,Ee,Pe)),G.maximums.push(Math.max(ae,pe,Ee,Pe)),G.leaves.push(1)}for(D.push(G),M/=2;M>=1;M/=2){const ne=D[D.length-1];G=new A0(M);for(let ae=0;ae<M*M;ae++){U(ae%M,Math.floor(ae/M),2,!0,Y);const pe=ne.getElevation(Y[0],Y[1]),Ee=ne.getElevation(Y[2],Y[1]),Pe=ne.getElevation(Y[2],Y[3]),We=ne.getElevation(Y[0],Y[3]),Le=ne.isLeaf(Y[0],Y[1]),$e=ne.isLeaf(Y[2],Y[1]),et=ne.isLeaf(Y[2],Y[3]),Xe=ne.isLeaf(Y[0],Y[3]),Ft=Math.min(pe.min,Ee.min,Pe.min,We.min),Rt=Math.max(pe.max,Ee.max,Pe.max,We.max),tn=Le&&$e&&et&&Xe;G.maximums.push(Rt),G.minimums.push(Ft),G.leaves.push(Rt-Ft<=5&&tn?1:0)}D.push(G)}return D}(this.dem),h=l.length-1,m=l[h];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(t,l,h,m,x,C,D=1){return D0([t,l,-100],[h,m,this.maximums[0]*D],x,C)}raycast(t,l,h,m,x,C,D=1){if(!this.nodeCount)return null;const M=this.raycastRoot(t,l,h,m,x,C,D);if(null==M)return null;const P=[],U=[],G=[],Y=[],ne=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;ne.length>0;){const{idx:ae,t:pe,nodex:Ee,nodey:Pe,depth:We}=ne.pop();if(this.leaves[ae]){S0(Ee,Pe,We,t,l,h,m,G,Y);const $e=1<<We,et=(Ee+0)/$e,Xe=(Ee+1)/$e,Ft=(Pe+0)/$e,Rt=(Pe+1)/$e,tn=Nd(et,Ft,this.dem)*D,Dn=Nd(Xe,Ft,this.dem)*D,Ht=Nd(Xe,Rt,this.dem)*D,cn=Nd(et,Rt,this.dem)*D,fn=T0(G[0],G[1],tn,Y[0],G[1],Dn,Y[0],Y[1],Ht,x,C),bn=T0(Y[0],Y[1],Ht,G[0],Y[1],cn,G[0],G[1],tn,x,C),Pn=Math.min(null!==fn?fn:Number.MAX_VALUE,null!==bn?bn:Number.MAX_VALUE);if(Pn!==Number.MAX_VALUE)return Pn;{const Jt=ju([],x,C,pe);if(M0(tn,Dn,cn,Ht,dm(Jt[0],G[0],Y[0]),dm(Jt[1],G[1],Y[1]))>=Jt[2])return pe}continue}let Le=0;for(let $e=0;$e<this._siblingOffset.length;$e++){S0((Ee<<1)+this._siblingOffset[$e][0],(Pe<<1)+this._siblingOffset[$e][1],We+1,t,l,h,m,G,Y),G[2]=-100,Y[2]=this.maximums[this.childOffsets[ae]+$e]*D;const et=D0(G,Y,x,C);if(null!=et){const Xe=et;P[$e]=Xe;let Ft=!1;for(let Rt=0;Rt<Le&&!Ft;Rt++)Xe>=P[U[Rt]]&&(U.splice(Rt,0,$e),Ft=!0);Ft||(U[Le]=$e),Le++}}for(let $e=0;$e<Le;$e++){const et=U[$e];ne.push({idx:this.childOffsets[ae]+et,t:P[et],nodex:(Ee<<1)+this._siblingOffset[et][0],nodey:(Pe<<1)+this._siblingOffset[et][1],depth:We+1})}}return null}_addNode(t,l,h){return this.minimums.push(t),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(t,l,h,m,x){if(1===t[m].isLeaf(l,h))return;this.childOffsets[x]||(this.childOffsets[x]=this.nodeCount);const C=m-1,D=t[C];let M=0,P=0;for(let U=0;U<this._siblingOffset.length;U++){const G=2*l+this._siblingOffset[U][0],Y=2*h+this._siblingOffset[U][1],ne=D.getElevation(G,Y),ae=D.isLeaf(G,Y),pe=this._addNode(ne.min,ne.max,ae);ae&&(M|=1<<U),P||(P=pe)}for(let U=0;U<this._siblingOffset.length;U++)M&1<<U||this._construct(t,2*l+this._siblingOffset[U][0],2*h+this._siblingOffset[U][1],C,P+U)}}function M0(o,t,l,h,m,x){return ri(ri(o,l,x),ri(t,h,x),m)}function Nd(o,t,l){const h=l.dim,m=xr(o*h-.5,0,h-1),x=xr(t*h-.5,0,h-1),C=Math.floor(m),D=Math.floor(x),M=Math.min(C+1,h-1),P=Math.min(D+1,h-1);return M0(l.get(C,D),l.get(M,D),l.get(C,P),l.get(M,P),m-C,x-D)}const hm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function O0(o,t,l){return(256*o*256+256*t+l)/10-1e4}function R_(o,t,l){return 256*o+t+l/256-32768}class eg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,l,h,m=!1,x=!1){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return Gn(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const C=this.dim=l.height-2,D=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=m,!m){for(let M=0;M<C;M++)D[this._idx(-1,M)]=D[this._idx(0,M)],D[this._idx(C,M)]=D[this._idx(C-1,M)],D[this._idx(M,-1)]=D[this._idx(M,0)],D[this._idx(M,C)]=D[this._idx(M,C-1)];D[this._idx(-1,-1)]=D[this._idx(0,0)],D[this._idx(C,-1)]=D[this._idx(C-1,0)],D[this._idx(-1,C)]=D[this._idx(0,C-1)],D[this._idx(C,C)]=D[this._idx(C-1,C-1)],x&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new I0(this)}get(t,l,h=!1){h&&(t=xr(t,-1,this.dim),l=xr(l,-1,this.dim));const m=4*this._idx(t,l);return("terrarium"===this.encoding?R_:O0)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(t){return hm[t]}get unpackVector(){return hm[this.encoding]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}static pack(t,l){const h=[0,0,0,0],m=eg.getUnpackVector(l);let x=Math.floor((t+m[3])/m[2]);return h[2]=x%256,x=Math.floor(x/256),h[1]=x%256,x=Math.floor(x/256),h[0]=x,h}getPixels(){return new Ol({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,l,h){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let m=l*this.dim,x=l*this.dim+this.dim,C=h*this.dim,D=h*this.dim+this.dim;switch(l){case-1:m=x-1;break;case 1:x=m+1}switch(h){case-1:C=D-1;break;case 1:D=C+1}const M=-l*this.dim,P=-h*this.dim;for(let U=C;U<D;U++)for(let G=m;G<x;G++){const Y=4*this._idx(G,U),ne=4*this._idx(G+M,U+P);this.pixels[Y+0]=t.pixels[ne+0],this.pixels[Y+1]=t.pixels[ne+1],this.pixels[Y+2]=t.pixels[ne+2],this.pixels[Y+3]=t.pixels[ne+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Kn(eg,"DEMData"),Kn(I0,"DemMinMaxQuadTree",{omit:["dem"]});class vc{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,h){const m=t.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const x={value:l,timeout:void 0};if(void 0!==h&&(x.timeout=setTimeout(()=>{this.remove(t,x)},h)),this.data[m].push(x),this.order.push(m),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const h=t.wrapped().key,m=void 0===l?0:this.data[h].indexOf(l),x=this.data[h][m];return this.data[h].splice(m,1),x.timeout&&clearTimeout(x.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(x.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||l.push(m);for(const h of l)this.remove(h.value.tileID,h)}}class ff{constructor(t,l,h){this.func=t,this.mask=l,this.range=h}}ff.ReadOnly=!1,ff.ReadWrite=!0,ff.disabled=new ff(519,ff.ReadOnly,[0,1]);class P0{constructor(t,l,h,m,x,C){this.test=t,this.ref=l,this.mask=h,this.fail=m,this.depthFail=x,this.pass=C}}P0.disabled=new P0({func:519,mask:0},0,0,7680,7680,7680);class Gc{constructor(t,l,h){this.blendFunction=t,this.blendColor=l,this.mask=h}}Gc.Replace=[1,0],Gc.disabled=new Gc(Gc.Replace,Eo.transparent,[!1,!1,!1,!1]),Gc.unblended=new Gc(Gc.Replace,Eo.transparent,[!0,!0,!0,!0]),Gc.alphaBlended=new Gc([1,771],Eo.transparent,[!0,!0,!0,!0]);class au{constructor(t,l,h){this.enable=t,this.mode=l,this.frontFace=h}}au.disabled=new au(!1,1029,2305),au.backCCW=new au(!0,1029,2305),au.backCW=new au(!0,1029,2304),au.frontCW=new au(!0,1028,2304),au.frontCCW=new au(!0,1028,2305);class vh extends yi{constructor(t,l,h){super(),this.id=t,this._onlySymbols=h,l.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new vc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new um,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const l=this._tiles[t];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,l){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,l)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(t),h.prepare(this.map.style.imageManager)}}getIds(){return Ir(this._tiles).map(t=>t.tileID).sort(gm).map(t=>t.key)}getRenderableIds(t){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,t)&&l.push(this._tiles[h]);return t?l.sort((h,m)=>{const x=h.tileID,C=m.tileID,D=new gt(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),M=new gt(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||M.y-D.y||M.x-D.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(gm).map(h=>h.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,l){const h=this._tiles[t];h&&("loading"!==h.state&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,t,l)))}_tileLoaded(t,l,h,m){if(m)if(t.state="errored",404!==m.status)this._source.fire(new ro(m,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Fi.now(),"expired"===h&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Vi("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const l=this.getRenderableIds();for(let m=0;m<l.length;m++){const x=l[m];if(t.neighboringTiles&&t.neighboringTiles[x]){const C=this.getTileByID(x);h(t,C),h(C,t)}}function h(m,x){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let C=x.tileID.canonical.x-m.tileID.canonical.x;const D=x.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),P=x.tileID.key;0===C&&0===D||Math.abs(D)>1||(Math.abs(C)>1&&(1===Math.abs(C+M)?C+=M:1===Math.abs(C-M)&&(C-=M)),x.dem&&m.dem&&(m.dem.backfillBorder(x.dem,C,D),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,h,m){for(const x in this._tiles){let C=this._tiles[x];if(m[x]||!C.hasData()||C.tileID.overscaledZ<=l||C.tileID.overscaledZ>h)continue;let D=C.tileID;for(;C&&C.tileID.overscaledZ>l+1;){const P=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[P.key],C&&C.hasData()&&(D=P)}let M=D;for(;M.overscaledZ>l;)if(M=M.scaledTo(M.overscaledZ-1),t[M.key]){m[D.key]=D;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=t.overscaledZ-1;h>=l;h--){const m=t.scaledTo(h),x=this._getLoadedTile(m);if(x)return x}}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,l){l=l||this._source.tileSize;const h=Math.ceil(t.width/l)+1,m=Math.ceil(t.height/l)+1,x=Math.floor(h*m*5),C="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,x):x,D="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(D)}handleWrapJump(t){const l=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,l){const h={};for(const m in this._tiles){const x=this._tiles[m];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),h[x.tileID.key]=x}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,l,h){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let m;this.updateCacheSize(t,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new Si(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(m=t.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(D=>this._source.hasTile(D)))):m=[];const x=this._updateRetainedTiles(m);if(R0(this._source.type)&&0!==m.length){const D={},M={},P=Object.keys(x);for(const G of P){const Y=x[G],ne=this._tiles[G];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=Fi.now())continue;const ae=this.findLoadedParent(Y,Math.max(Y.overscaledZ-vh.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),D[ae.tileID.key]=ae.tileID),M[G]=Y}const U=m[m.length-1].overscaledZ;for(const G in this._tiles){const Y=this._tiles[G];if(x[G]||!Y.hasData())continue;let ne=Y.tileID;for(;ne.overscaledZ>U;){ne=ne.scaledTo(ne.overscaledZ-1);const ae=this._tiles[ne.key];if(ae&&ae.hasData()&&M[ne.key]){x[G]=Y.tileID;break}}}for(const G in D)x[G]||(this._coveredTiles[G]=!0,x[G]=D[G])}for(const D in x)this._tiles[D].clearFadeHold();const C=function(D,M){const P=[];for(const U in D)U in M||P.push(U);return P}(this._tiles,x);for(const D of C){const M=this._tiles[D];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const l={};if(0===t.length)return l;const h={},m=t.reduce((P,U)=>Math.min(P,U.overscaledZ),1/0),x=t[0].overscaledZ,C=Math.max(x-vh.maxOverzooming,this._source.minzoom),D=Math.max(x+vh.maxUnderzooming,this._source.minzoom),M={};for(const P of t){const U=this._addTile(P);l[P.key]=P,U.hasData()||m<this._source.maxzoom&&(M[P.key]=P)}this._retainLoadedChildren(M,m,D,l);for(const P of t){let U=this._tiles[P.key];if(U.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const Y=P.children(this._source.maxzoom)[0],ne=this.getTile(Y);if(ne&&ne.hasData()){l[Y.key]=Y;continue}}else{const Y=P.children(this._source.maxzoom);if(l[Y[0].key]&&l[Y[1].key]&&l[Y[2].key]&&l[Y[3].key])continue}let G=U.wasRequested();for(let Y=P.overscaledZ-1;Y>=C;--Y){const ne=P.scaledTo(Y);if(h[ne.key]||(h[ne.key]=!0,U=this.getTile(ne),!U&&G&&(U=this._addTile(ne)),U&&(l[ne.key]=ne,G=U.wasRequested(),U.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}l.push(m.key);const x=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(x),h)break;m=x}for(const x of l)this._loadedParentTiles[x]=h}}_addTile(t){let l=this._tiles[t.key];if(l)return l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const h=!!l;if(!h){const m=this.map?this.map.painter:null;l=new Qp(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,t.key,l.state))}return l?(l.uses++,this._tiles[t.key]=l,h||this._source.fire(new Vi("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=l.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,l,h){const m=[],x=this.transform;if(!x)return m;const C="globe"===x.projection.name,D=hc(x.center.lng);for(const M in this._tiles){const P=this._tiles[M];if(h&&P.clearQueryDebugViz(),P.holdingForFade())continue;let U;if(C){const G=P.tileID.canonical;if(0===G.z){const Y=[Math.abs(xr(D,...tp(G,-1))-D),Math.abs(xr(D,...tp(G,1))-D)];U=[0,2*Y.indexOf(Math.min(...Y))-1]}else{const Y=[Math.abs(xr(D,...tp(G,-1))-D),Math.abs(xr(D,...tp(G,0))-D),Math.abs(xr(D,...tp(G,1))-D)];U=[Y.indexOf(Math.min(...Y))-1]}}else U=[0];for(const G of U){const Y=t.containsTile(P,x,l,G);Y&&m.push(Y)}}return m}getVisibleCoordinates(t){const l=this.getRenderableIds(t).map(h=>this._tiles[h].tileID);for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(R0(this._source.type))for(const t in this._tiles){const l=this._tiles[t];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Fi.now())return!0}return!1}setFeatureState(t,l,h){this._state.updateState(t=t||"_geojsonTileLayer",l,h)}removeFeatureState(t,l,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,h)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,h){const m=this._tiles[t];m&&m.setDependencies(l,h)}reloadTilesForDependencies(t,l){for(const h in this._tiles)this._tiles[h].hasDependency(t,l)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,l))}_preloadTiles(t,l){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(t,l))};return void this._source.on("data",D)}const h=new Map,m=Array.isArray(t)?t:[t],x=this.map.painter.terrain,C=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const D of m){const M=D.coveringTiles({tileSize:C,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of M)h.set(P.key,P);this.usedForTerrain&&D.updateElevation(!1)}Ln(Array.from(h.values()),(D,M)=>{const P=new Qp(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,U=>{"raster-dem"===this._source.type&&P.dem&&this._backfillDEM(P),M(U,P)})},l)}}function gm(o,t){const l=Math.abs(2*o.wrap)-+(o.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return o.overscaledZ-t.overscaledZ||h-l||t.canonical.y-o.canonical.y||t.canonical.x-o.canonical.x}function R0(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function tp(o,t){const l=1<<o.z;return[o.x/l+t,(o.x+1)/l+t]}vh.maxOverzooming=10,vh.maxUnderzooming=3;class pf{constructor(t,l,h){this._demTile=t,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(t,l,h){const m=h||t.findDEMTileFor(l);if(!m||!m.dem)return;const x=m.dem,C=m.tileID,D=1<<l.canonical.z-C.canonical.z;return new pf(m,m.tileSize/Tr/D,[(l.canonical.x/D-C.canonical.x)*x.dim,(l.canonical.y/D-C.canonical.y)*x.dim])}tileCoordToPixel(t,l){const h=l*this._scale+this._offset[1],m=Math.floor(t*this._scale+this._offset[0]),x=Math.floor(h);return new gt(m,x)}getElevationAt(t,l,h,m){const x=t*this._scale+this._offset[0],C=l*this._scale+this._offset[1],D=Math.floor(x),M=Math.floor(C),P=this._dem;return m=!!m,h?ri(ri(P.get(D,M,m),P.get(D,M+1,m),C-M),ri(P.get(D+1,M,m),P.get(D+1,M+1,m),C-M),x-D):P.get(D,M,m)}getElevationAtPixel(t,l,h){return this._dem.get(t,l,!!h)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ic(1,t)*this._dem.stride}}class L0{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new hs(Tr,16,0),this.featureIndexArray=new gu,this.promoteId=l}insert(t,l,h,m,x,C=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,x,C);const M=this.grid;for(let P=0;P<l.length;P++){const U=l[P],G=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<U.length;Y++){const ne=U[Y];G[0]=Math.min(G[0],ne.x),G[1]=Math.min(G[1],ne.y),G[2]=Math.max(G[2],ne.x),G[3]=Math.max(G[3],ne.y)}G[0]<Tr&&G[1]<Tr&&G[2]>=0&&G[3]>=0&&M.insert(D,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new sh(new uh(this.rawTileData)).layers,this.sourceLayerCoder=new lm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,l,h,m){this.loadVTLayers();const x=t.params||{},C=Yc(x.filter),D=t.tileResult,M=t.transform,P=D.bufferedTilespaceBounds,U=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(ae,pe,Ee,Pe)=>Lf(D.bufferedTilespaceGeometry,ae,pe,Ee,Pe));U.sort(L_);let G=null;M.elevation&&U.length>0&&(G=pf.create(M.elevation,this.tileID));const Y={};let ne;for(let ae=0;ae<U.length;ae++){const pe=U[ae];if(pe===ne)continue;ne=pe;const Ee=this.featureIndexArray.get(pe);let Pe=null;this.loadMatchingFeature(Y,Ee,C,x.layers,x.availableImages,l,h,m,(We,Le,$e,et=0)=>(Pe||(Pe=zl(We,this.tileID.canonical,t.tileTransform)),Le.queryIntersectsFeature(D,We,$e,Pe,this.z,t.transform,t.pixelPosMatrix,G,et)))}return Y}loadMatchingFeature(t,l,h,m,x,C,D,M,P){const{featureIndex:U,bucketIndex:G,sourceLayerIndex:Y,layoutVertexArrayOffset:ne}=l,ae=this.bucketLayerIDs[G];if(m&&!function(We,Le){for(let $e=0;$e<We.length;$e++)if(Le.indexOf(We[$e])>=0)return!0;return!1}(m,ae))return;const pe=this.sourceLayerCoder.decode(Y),Ee=this.vtLayers[pe].feature(U);if(h.needGeometry){const We=kc(Ee,!0);if(!h.filter(new H(this.tileID.overscaledZ),We,this.tileID.canonical))return}else if(!h.filter(new H(this.tileID.overscaledZ),Ee))return;const Pe=this.getId(Ee,pe);for(let We=0;We<ae.length;We++){const Le=ae[We];if(m&&m.indexOf(Le)<0)continue;const $e=C[Le];if(!$e)continue;let et={};void 0!==Pe&&M&&(et=M.getState($e.sourceLayer||"_geojsonTileLayer",Pe));const Xe=At({},D[Le]);Xe.paint=N0(Xe.paint,$e.paint,Ee,et,x),Xe.layout=N0(Xe.layout,$e.layout,Ee,et,x);const Ft=!P||P(Ee,$e,et,ne);if(!Ft)continue;const Rt=new cm(Ee,this.z,this.x,this.y,Pe);Rt.layer=Xe;let tn=t[Le];void 0===tn&&(tn=t[Le]=[]),tn.push({featureIndex:U,feature:Rt,intersectionZ:Ft})}}lookupSymbolFeatures(t,l,h,m,x,C,D,M){const P={};this.loadVTLayers();const U=Yc(x);for(const G of t)this.loadMatchingFeature(P,{bucketIndex:h,sourceLayerIndex:m,featureIndex:G,layoutVertexArrayOffset:0},U,C,D,M,l);return P}loadFeature(t){const{featureIndex:l,sourceLayerIndex:h}=t;this.loadVTLayers();const m=this.sourceLayerCoder.decode(h),x=this.vtFeatures[m];if(x[l])return x[l];const C=this.vtLayers[m].feature(l);return x[l]=C,C}hasLayer(t){for(const l of this.bucketLayerIDs)for(const h of l)if(t===h)return!0;return!1}getId(t,l){let h=t.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=m&&(h=t.properties[m]),"boolean"==typeof h&&(h=Number(h))}return h}}function N0(o,t,l,h,m){return tr(o,(x,C)=>{const D=t instanceof Me?t.get(C):null;return D&&D.evaluate?D.evaluate(l,h,m):D})}function L_(o,t){return t-o}Kn(L0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class k0{constructor(t,l){this.width=t,this.height=l,this.nextRow=0,this.image=new Zl({width:t,height:l}),this.positions={},this.uploaded=!1}getDash(t,l){const h=this.getKey(t,l);return this.positions[h]}trim(){const t=this.width,l=this.height=rn(this.nextRow);this.image.resize({width:t,height:l})}getKey(t,l){return t.join(",")+l}getDashRanges(t,l,h){const m=[];let x=t.length%2==1?-t[t.length-1]*h:0,C=t[0]*h,D=!0;m.push({left:x,right:C,isDash:D,zeroLength:0===t[0]});let M=t[0];for(let P=1;P<t.length;P++){D=!D;const U=t[P];x=M*h,M+=U,C=M*h,m.push({left:x,right:C,isDash:D,zeroLength:0===U})}return m}addRoundDash(t,l,h){const m=l/2;for(let x=-h;x<=h;x++){const C=this.width*(this.nextRow+h+x);let D=0,M=t[D];for(let P=0;P<this.width;P++){P/M.right>1&&(M=t[++D]);const U=Math.abs(P-M.left),G=Math.abs(P-M.right),Y=Math.min(U,G);let ne;const ae=x/h*(m+1);if(M.isDash){const pe=m-Math.abs(ae);ne=Math.sqrt(Y*Y+pe*pe)}else ne=m-Math.sqrt(Y*Y+ae*ae);this.image.data[C+P]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(t,l){for(let M=t.length-1;M>=0;--M){const P=t[M],U=t[M+1];P.zeroLength?t.splice(M,1):U&&U.isDash===P.isDash&&(U.left=P.left,t.splice(M,1))}const h=t[0],m=t[t.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const x=this.width*this.nextRow;let C=0,D=t[C];for(let M=0;M<this.width;M++){M/D.right>1&&(D=t[++C]);const P=Math.abs(M-D.left),U=Math.abs(M-D.right),G=Math.min(P,U);this.image.data[x+M]=Math.max(0,Math.min(255,(D.isDash?G:-G)+l+128))}}addDash(t,l){const h=this.getKey(t,l);if(this.positions[h])return this.positions[h];const m="round"===l,x=m?7:0,C=2*x+1;if(this.nextRow+C>this.height)return Gn("LineAtlas out of space"),null;0===t.length&&t.push(1);let D=0;for(let U=0;U<t.length;U++)t[U]<0&&(Gn("Negative value is found in line dasharray, replacing values with 0"),t[U]=0),D+=t[U];if(0!==D){const U=this.width/D,G=this.getDashRanges(t,this.width,U);m?this.addRoundDash(G,U,x):this.addRegularDash(G,"square"===l?.5*U:0)}const M=this.nextRow+x;this.nextRow+=C;const P={tl:[M,x],br:[D,0]};return this.positions[h]=P,P}}Kn(k0,"LineAtlas");const F0=1*Iu;class lu{constructor(t){const l={},h=[];for(const D in t){const M=t[D],P=l[D]={};for(const U in M.glyphs){const G=M.glyphs[+U];if(!G||0===G.bitmap.width||0===G.bitmap.height)continue;const Y=G.metrics.localGlyph?F0:1,ne={x:0,y:0,w:G.bitmap.width+2*Y,h:G.bitmap.height+2*Y};h.push(ne),P[U]=ne}}const{w:m,h:x}=Kg(h),C=new Zl({width:m||1,height:x||1});for(const D in t){const M=t[D];for(const P in M.glyphs){const U=M.glyphs[+P];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const G=l[D][P],Y=U.metrics.localGlyph?F0:1;Zl.copy(U.bitmap,C,{x:0,y:0},{x:G.x+Y,y:G.y+Y},U.bitmap)}}this.image=C,this.positions=l}}Kn(lu,"GlyphAtlas");class mm{constructor(t){this.tileID=new Si(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=gh(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,l,h,m,x){this.status="parsing",this.data=t,this.collisionBoxArray=new ho;const C=new lm(Object.keys(t.layers).sort()),D=new L0(this.tileID,this.promoteId);D.bucketLayerIDs=[];const M={},P=new k0(256,256),U={featureIndex:D,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:P,availableImages:h},G=l.familiesBySource[this.source];for(const et in G){const Xe=t.layers[et];if(!Xe)continue;let Ft=!1,Rt=!1;for(const Ht of G[et])"symbol"===Ht[0].type?Ft=!0:Rt=!0;if(!0===this.isSymbolTile&&!Ft||!1===this.isSymbolTile&&!Rt)continue;1===Xe.version&&Gn(`Vector tile source "${this.source}" layer "${et}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const tn=C.encode(et),Dn=[];for(let Ht=0;Ht<Xe.length;Ht++){const cn=Xe.feature(Ht),fn=D.getId(cn,et);Dn.push({feature:cn,id:fn,index:Ht,sourceLayerIndex:tn})}for(const Ht of G[et]){const cn=Ht[0];void 0!==this.isSymbolTile&&"symbol"===cn.type!==this.isSymbolTile||cn.minzoom&&this.zoom<Math.floor(cn.minzoom)||cn.maxzoom&&this.zoom>=cn.maxzoom||"none"!==cn.visibility&&(_m(Ht,this.zoom,h),(M[cn.id]=cn.createBucket({index:D.bucketLayerIDs.length,layers:Ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(Dn,U,this.tileID.canonical,this.tileTransform),D.bucketLayerIDs.push(Ht.map(fn=>fn.id)))}}let Y,ne,ae,pe;P.trim();const Ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Pe=()=>{if(Y)return x(Y);if(ne&&ae&&pe){const et=new lu(ne),Xe=new Jg(ae,pe);for(const Ft in M){const Rt=M[Ft];Rt instanceof Ld?(_m(Rt.layers,this.zoom,h),A_(Rt,ne,et.positions,ae,Xe.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):Rt.hasPattern&&(Rt instanceof Mp||Rt instanceof Ce||Rt instanceof Bf)&&(_m(Rt.layers,this.zoom,h),Rt.addFeatures(U,this.tileID.canonical,Xe.patternPositions,h,this.tileTransform))}this.status="done",x(null,{buckets:Ir(M).filter(Ft=>!Ft.isEmpty()),featureIndex:D,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:et.image,lineAtlas:P,imageAtlas:Xe,glyphMap:this.returnDependencies?ne:null,iconMap:this.returnDependencies?ae:null,glyphPositions:this.returnDependencies?et.positions:null})}},We=tr(U.glyphDependencies,et=>Object.keys(et).map(Number));Object.keys(We).length?m.send("getGlyphs",{uid:this.uid,stacks:We},(et,Xe)=>{Y||(Y=et,ne=Xe,Pe())},void 0,!1,Ee):ne={};const Le=Object.keys(U.iconDependencies);Le.length?m.send("getImages",{icons:Le,source:this.source,tileID:this.tileID,type:"icons"},(et,Xe)=>{Y||(Y=et,ae=Xe,Pe())},void 0,!1,Ee):ae={};const $e=Object.keys(U.patternDependencies);$e.length?m.send("getImages",{icons:$e,source:this.source,tileID:this.tileID,type:"patterns"},(et,Xe)=>{Y||(Y=et,pe=Xe,Pe())},void 0,!1,Ee):pe={},Pe()}}function _m(o,t,l){const h=new H(t);for(const m of o)m.recalculate(h,l)}class vm{constructor(t){this.entries={},this.scheduler=t}request(t,l,h,m){const x=this.entries[t]=this.entries[t]||{callbacks:[]};if(x.result){const[C,D]=x.result;return this.scheduler?this.scheduler.add(()=>{m(C,D)},l):m(C,D),()=>{}}return x.callbacks.push(m),x.cancel||(x.cancel=h((C,D)=>{x.result=[C,D];for(const M of x.callbacks)this.scheduler?this.scheduler.add(()=>{M(C,D)},l):M(C,D);setTimeout(()=>delete this.entries[t],3e3)})),()=>{x.result||(x.callbacks=x.callbacks.filter(C=>C!==m),x.callbacks.length||(x.cancel(),delete this.entries[t]))}}}function B0(o,t,l){const h=JSON.stringify(o.request);return o.data&&(this.deduped.entries[h]={result:[null,o.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},m=>{const x=nr(o.request,(C,D,M,P)=>{C?m(C):D&&m(null,{vectorTile:l?void 0:new sh(new uh(D)),rawData:D,cacheControl:M,expires:P})});return()=>{x.cancel(),m()}},t)}const ym=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ng{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(t,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const m=h>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const x=ym[15&h];if(!x)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(t,2,1),[D]=new Uint32Array(t,4,1);return new ng(D,C,x,t)}constructor(t,l=64,h=Float64Array,m){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const x=ym.indexOf(this.ArrayType),C=2*t*this.ArrayType.BYTES_PER_ELEMENT,D=t*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-D%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+D+M,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+C+D+M),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+D+M,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=t)}add(t,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=t,this.coords[this._pos++]=l,h}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:C,nodeSize:D}=this,M=[0,x.length-1,0],P=[];for(;M.length;){const U=M.pop()||0,G=M.pop()||0,Y=M.pop()||0;if(G-Y<=D){for(let Ee=Y;Ee<=G;Ee++){const Pe=C[2*Ee],We=C[2*Ee+1];Pe>=t&&Pe<=h&&We>=l&&We<=m&&P.push(x[Ee])}continue}const ne=Y+G>>1,ae=C[2*ne],pe=C[2*ne+1];ae>=t&&ae<=h&&pe>=l&&pe<=m&&P.push(x[ne]),(0===U?t<=ae:l<=pe)&&(M.push(Y),M.push(ne-1),M.push(1-U)),(0===U?h>=ae:m>=pe)&&(M.push(ne+1),M.push(G),M.push(1-U))}return P}within(t,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:x,nodeSize:C}=this,D=[0,m.length-1,0],M=[],P=h*h;for(;D.length;){const U=D.pop()||0,G=D.pop()||0,Y=D.pop()||0;if(G-Y<=C){for(let Ee=Y;Ee<=G;Ee++)xm(x[2*Ee],x[2*Ee+1],t,l)<=P&&M.push(m[Ee]);continue}const ne=Y+G>>1,ae=x[2*ne],pe=x[2*ne+1];xm(ae,pe,t,l)<=P&&M.push(m[ne]),(0===U?t-h<=ae:l-h<=pe)&&(D.push(Y),D.push(ne-1),D.push(1-U)),(0===U?t+h>=ae:l+h>=pe)&&(D.push(ne+1),D.push(G),D.push(1-U))}return M}}function gf(o,t,l,h,m,x){if(m-h<=l)return;const C=h+m>>1;rg(o,t,C,h,m,x),gf(o,t,l,h,C-1,1-x),gf(o,t,l,C+1,m,1-x)}function rg(o,t,l,h,m,x){for(;m>h;){if(m-h>600){const P=m-h+1,U=l-h+1,G=Math.log(P),Y=.5*Math.exp(2*G/3),ne=.5*Math.sqrt(G*Y*(P-Y)/P)*(U-P/2<0?-1:1);rg(o,t,l,Math.max(h,Math.floor(l-U*Y/P+ne)),Math.min(m,Math.floor(l+(P-U)*Y/P+ne)),x)}const C=t[2*l+x];let D=h,M=m;for(ig(o,t,h,l),t[2*m+x]>C&&ig(o,t,h,m);D<M;){for(ig(o,t,D,M),D++,M--;t[2*D+x]<C;)D++;for(;t[2*M+x]>C;)M--}t[2*h+x]===C?ig(o,t,h,M):(M++,ig(o,t,M,m)),M<=l&&(h=M+1),l<=M&&(m=M-1)}}function ig(o,t,l,h){og(o,l,h),og(t,2*l,2*h),og(t,2*l+1,2*h+1)}function og(o,t,l){const h=o[t];o[t]=o[l],o[l]=h}function xm(o,t,l,h){const m=o-l,x=t-h;return m*m+x*x}f.ARRAY_TYPE=Bl,f.AUTH_ERR_MSG=Oe,f.Aabb=Ml,f.Actor=class{constructor(o,t,l){this.target=o,this.parent=t,this.mapId=l,this.callbacks={},this.cancelCallbacks={},gr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qr()?o:ze,this.scheduler=new C0}send(o,t,l,h,m=!1,x){const C=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=x,this.callbacks[C]=l);const D=fr(this.globalScope)?void 0:[];return this.target.postMessage({id:C,type:o,hasCallback:!!l,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:Jl(t,D)},D),{cancel:()=>{l&&delete this.callbacks[C],this.target.postMessage({id:C,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(o){const t=o.data,l=t.id;if(l&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(t.mustQueue||qr()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,t),h&&h.metadata||{type:"message"})}else this.processTask(l,t)}processTask(o,t){if("<response>"===t.type){const l=this.callbacks[o];delete this.callbacks[o],l&&(t.error?l(co(t.error)):l(null,co(t.data)))}else{const l=fr(this.globalScope)?void 0:[],h=t.hasCallback?(x,C)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:x?Jl(x):null,data:Jl(C,l)},l)}:x=>{},m=co(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,m,h);else if(this.parent.getWorkerSource){const x=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,x[0],m.source)[x[1]](m,h)}else h(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Lg,f.Color=Eo,f.ColorMode=Gc,f.CullFaceMode=au,f.DEMData=eg,f.DataConstantProperty=he,f.DedupedRequest=vm,f.DepthMode=ff,f.EXTENT=Tr,f.Elevation=class{isDataAvailableAtPoint(o){const t=this._source();if(this.isUsingMockSource()||!t||o.y<0||o.y>1)return!1;const l=t.getSource().maxzoom,h=1<<l,m=Math.floor(o.x),x=Math.floor((o.x-m)*h),C=Math.floor(o.y*h),D=this.findDEMTileFor(new Si(l,m,l,x,C));return!(!D||!D.dem)}getAtPointOrZero(o,t=0){return this.getAtPoint(o,t)||0}getAtPoint(o,t,l=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const h=this._source();if(!h||o.y<0||o.y>1)return t;const m=h.getSource().maxzoom,x=1<<m,C=Math.floor(o.x),D=o.x-C,M=new Si(m,C,m,Math.floor(D*x),Math.floor(o.y*x)),P=this.findDEMTileFor(M);if(!P||!P.dem)return t;const U=P.dem,G=1<<P.tileID.canonical.z,Y=(D*G-P.tileID.canonical.x)*U.dim,ne=(o.y*G-P.tileID.canonical.y)*U.dim,ae=Math.floor(Y),pe=Math.floor(ne);return(l?this.exaggeration():1)*ri(ri(U.get(ae,pe),U.get(ae,pe+1),ne-pe),ri(U.get(ae+1,pe),U.get(ae+1,pe+1),ne-pe),Y-ae)}getAtTileOffset(o,t,l){const h=1<<o.canonical.z;return this.getAtPointOrZero(new Eu(o.wrap+(o.canonical.x+t/Tr)/h,(o.canonical.y+l/Tr)/h))}getAtTileOffsetFunc(o,t,l,h){return m=>{const x=this.getAtTileOffset(o,m.x,m.y),C=h.upVector(o.canonical,m.x,m.y);return $l(C,C,x*h.upVectorScale(o.canonical,t,l).metersToTile),C}}getForTilePoints(o,t,l,h){if(this.isUsingMockSource())return!1;const m=pf.create(this,o,h);return!!m&&(t.forEach(x=>{x[2]=this.exaggeration()*m.getElevationAt(x[0],x[1],l)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(o);if(!t||!t.dem)return null;const l=t.dem.tree,h=t.tileID,m=1<<o.canonical.z-h.canonical.z;let x=o.canonical.x/m-h.canonical.x,C=o.canonical.y/m-h.canonical.y,D=0;for(let M=0;M<o.canonical.z-h.canonical.z&&!l.leaves[D];M++){x*=2,C*=2;const P=2*Math.floor(C)+Math.floor(x);D=l.childOffsets[D]+P,x%=1,C%=1}return{min:this.exaggeration()*l.minimums[D],max:this.exaggeration()*l.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,t,l){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=ro,f.EvaluationParameters=H,f.Event=Vi,f.Evented=yi,f.FillExtrusionBucket=Bf,f.Frustum=Gu,f.FrustumCorners=Af,f.GLOBE_RADIUS=rc,f.GLOBE_SCALE_MATCH_LATITUDE=45,f.GLOBE_ZOOM_THRESHOLD_MAX=$u,f.GLOBE_ZOOM_THRESHOLD_MIN=qd,f.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,t){const l=new En,h=new dr,m=[],x=o+1+2,C=t[0]+1,D=t[0]+1+(1+t.length),M=(P,U,G)=>{let Y=P===x-1?P-2:0===P?P:P-1;return Y+=G?24575:0,[Y,U]};for(let P=0;P<x;++P)l.emplaceBack(...M(P,0,!0));for(let P=0;P<C;++P)for(let U=0;U<x;++U)l.emplaceBack(...M(U,P,(0===U||U===x-1)&&!0));for(let P=0;P<t.length;++P){const U=t[P];for(let G=0;G<x;++G)l.emplaceBack(...M(G,U,!0))}for(let P=0;P<t.length;++P){const U=h.length,G=t[P]+1+2,Y=new dr;for(let pe=0;pe<G-1;pe++){const Ee=pe===G-2,Pe=Ee?x*(D-t.length+P-pe):x;for(let We=0;We<x-1;We++){const Le=pe*x+We;0===pe||Ee||0===We||We===x-2?(Y.emplaceBack(Le+1,Le,Le+Pe),Y.emplaceBack(Le+Pe,Le+Pe+1,Le+1)):(h.emplaceBack(Le+1,Le,Le+Pe),h.emplaceBack(Le+Pe,Le+Pe+1,Le+1))}}const ne=So.simpleSegment(0,U,l.length,h.length-U);for(let pe=0;pe<Y.uint16.length;pe+=3)h.emplaceBack(Y.uint16[pe],Y.uint16[pe+1],Y.uint16[pe+2]);const ae=So.simpleSegment(0,U,l.length,h.length-U);m.push({withoutSkirts:ne,withSkirts:ae})}return{vertices:l,indices:h,segments:m}}_createGrid(o){const t=this._fillGridMeshWithLods(64,$a);this._gridSegments=t.segments,this._gridBuffer=o.createVertexBuffer(t.vertices,Rh.members),this._gridIndexBuffer=o.createIndexBuffer(t.indices,!0)}_createPoles(o){const t=new dr;for(let m=0;m<=64;m++)t.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(t,!0);const l=new To,h=new To;this._poleSegments=[];for(let m=0,x=0;m<qd;m++){const C=360/(1<<m);l.emplaceBack(0,-rc,0,.5,0),h.emplaceBack(0,-rc,0,.5,1);for(let D=0;D<=64;D++){const M=D/64,P=ri(0,C,M),[U,G,Y]=bd(vp,kh,P,rc);l.emplaceBack(U,G,Y,M,0),h.emplaceBack(U,G,Y,M,1)}this._poleSegments.push(So.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(l,bg,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(h,bg,!1)}getGridBuffers(o,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,t){if(!this._wireframeSegments){const l=new ua,h=64,m=h+1+2,x=1;this._wireframeSegments=[];for(let C=0,D=0;C<$a.length;C++){const M=$a[C];for(let U=x;U<M+x;U++)for(let G=x;G<h+x;G++){const Y=U*m+G;l.emplaceBack(Y,Y+1),l.emplaceBack(Y,Y+m),l.emplaceBack(Y,Y+m+1)}const P=M*h*3;this._wireframeSegments.push(So.simpleSegment(0,D,(M+1)*m,P)),D+=P}this._wireframeIndexBuffer=o.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},f.GlyphManager=hh,f.ImagePosition=Gf,f.KDBush=ng,f.LivePerformanceUtils=ct,f.LngLat=yo,f.LngLatBounds=uc,f.LocalGlyphMode=$f,f.MAX_MERCATOR_LATITUDE=al,f.MercatorCoordinate=Eu,f.ONE_EM=wa,f.OverscaledTileID=Si,f.PerformanceMarkers=Je,f.Point=gt,f.Properties=Ve,f.RGBAImage=Ol,f.Ray=Cf,f.RequestManager=class{constructor(o,t,l){this._transformRequestFn=o,this._customAccessToken=t,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const o=function(){let t="";for(let l=0;l<10;l++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",un,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,t){return this._transformRequestFn&&this._transformRequestFn(o,t)||{url:o}}normalizeStyleURL(o,t){if(!rt(o))return o;const l=Mn(o);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||t)}normalizeGlyphsURL(o,t){if(!rt(o))return o;const l=Mn(o);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||t)}normalizeSourceURL(o,t,l,h){if(!rt(o))return o;const m=Mn(o);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),l&&m.params.push(`language=${l}`),h&&m.params.push(`worldview=${h}`),this._makeAPIURL(m,this._customAccessToken||t)}normalizeSpriteURL(o,t,l,h){const m=Mn(o);return rt(o)?(m.path=`/styles/v1${m.path}/sprite${t}${l}`,this._makeAPIURL(m,this._customAccessToken||h)):(m.path+=`${t}${l}`,Ze(m))}normalizeTileURL(o,t,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!rt(o))return o;const h=Mn(o);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||l&&"raster"!==h.authority&&512===l?"@2x":""}${xt.supported?".webp":"$1"}`),"raster"===h.authority?h.path=`/${$t.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${$t.TILE_URL_VERSION}${h.path}`);const m=this._customAccessToken||function(x){for(const C of x){const D=C.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(h.params)||$t.ACCESS_TOKEN;return $t.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,m)}canonicalizeTileURL(o,t){const l=Mn(o);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return o;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${$t.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${$t.TILE_URL_VERSION}/`,"")}`;let m=l.params;return t&&(m=m.filter(x=>!x.match(/^access_token=/))),m.length&&(h+=`?${m.join("&")}`),h}canonicalizeTileset(o,t){const l=!!t&&rt(t),h=[];for(const m of o.tiles||[])wt(m)?h.push(this.canonicalizeTileURL(m,l)):h.push(m);return h}_makeAPIURL(o,t){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",h=Mn($t.API_URL);if(o.protocol=h.protocol,o.authority=h.authority,"http"===o.protocol){const m=o.params.indexOf("secure");m>=0&&o.params.splice(m,1)}if("/"!==h.path&&(o.path=`${h.path}${o.path}`),!$t.REQUIRE_ACCESS_TOKEN)return Ze(o);if(t=t||$t.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return o.params=o.params.filter(m=>-1===m.indexOf("access_token")),o.params.push(`access_token=${t||""}`),Ze(o)}},f.ResourceType=si,f.SegmentVector=So,f.SourceCache=vh,f.StencilMode=P0,f.StructArrayLayout1ui2=Fl,f.StructArrayLayout2f1f2i16=Nr,f.StructArrayLayout2i4=En,f.StructArrayLayout2ui4=ua,f.StructArrayLayout3f12=oi,f.StructArrayLayout3ui6=dr,f.StructArrayLayout4i8=sn,f.StructArrayLayout5f20=To,f.Texture=df,f.Tile=Qp,f.Transitionable=de,f.Uniform1f=Oc,f.Uniform1i=class extends Mc{constructor(o){super(o),this.current=0}set(o,t,l){this.fetchUniformLocation(o,t)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},f.Uniform2f=class extends Mc{constructor(o){super(o),this.current=[0,0]}set(o,t,l){this.fetchUniformLocation(o,t)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},f.Uniform3f=class extends Mc{constructor(o){super(o),this.current=[0,0,0]}set(o,t,l){this.fetchUniformLocation(o,t)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},f.Uniform4f=Bu,f.UniformColor=zu,f.UniformMatrix2f=class extends Mc{constructor(o){super(o),this.current=vd}set(o,t,l){if(this.fetchUniformLocation(o,t))for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},f.UniformMatrix3f=class extends Mc{constructor(o){super(o),this.current=ap}set(o,t,l){if(this.fetchUniformLocation(o,t))for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},f.UniformMatrix4f=class extends Mc{constructor(o){super(o),this.current=_d}set(o,t,l){if(this.fetchUniformLocation(o,t)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},f.UnwrappedTileID=Yh,f.ValidationError=Hn,f.VectorTileFeature=Id,f.VectorTileWorkerSource=class extends yi{constructor(o,t,l,h,m){super(),this.actor=o,this.layerIndex=t,this.availableImages=l,this.loadVectorData=m||B0,this.loading={},this.loaded={},this.deduped=new vm(o.scheduler),this.isSpriteLoaded=h,this.scheduler=o.scheduler}loadTile(o,t){const l=o.uid,h=o&&o.request,m=h&&h.collectResourceTiming,x=this.loading[l]=new mm(o);x.abort=this.loadVectorData(o,(C,D)=>{const M=!this.loading[l];if(delete this.loading[l],M||C||!D)return x.status="done",M||(this.loaded[l]=x),t(C);const P=D.rawData,U={};D.expires&&(U.expires=D.expires),D.cacheControl&&(U.cacheControl=D.cacheControl),x.vectorTile=D.vectorTile||new sh(new uh(P));const G=()=>{x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,(Y,ne)=>{if(Y||!ne)return t(Y);const ae={};if(m){const pe=In(h);pe.length>0&&(ae.resourceTiming=JSON.parse(JSON.stringify(pe)))}t(null,At({rawTileData:P.slice(0)},ne,U,ae))})};this.isSpriteLoaded?G():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(G,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):G()}),this.loaded=this.loaded||{},this.loaded[l]=x})}reloadTile(o,t){const l=this.loaded,h=o.uid,m=this;if(l&&l[h]){const x=l[h];x.showCollisionBoxes=o.showCollisionBoxes,x.enableTerrain=!!o.enableTerrain,x.projection=o.projection,x.tileTransform=gh(o.tileID.canonical,o.projection);const C=(D,M)=>{const P=x.reloadCallback;P&&(delete x.reloadCallback,x.parse(x.vectorTile,m.layerIndex,this.availableImages,m.actor,P)),t(D,M)};"parsing"===x.status?x.reloadCallback=C:"done"===x.status&&(x.vectorTile?x.parse(x.vectorTile,this.layerIndex,this.availableImages,this.actor,C):C())}}abortTile(o,t){const l=o.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),t()}removeTile(o,t){const l=this.loaded,h=o.uid;l&&l[h]&&delete l[h],t()}},f.WritingMode=gc,f.ZoomDependentExpression=nl,f.add=tu,f.addDynamicAttributes=Zp,f.adjoint=function(o,t){var l=t[0],h=t[1],m=t[2],x=t[3],C=t[4],D=t[5],M=t[6],P=t[7],U=t[8];return o[0]=C*U-D*P,o[1]=m*P-h*U,o[2]=h*D-m*C,o[3]=D*M-x*U,o[4]=l*U-m*M,o[5]=m*x-l*D,o[6]=x*P-C*M,o[7]=h*M-l*P,o[8]=l*C-h*x,o},f.asyncAll=Ln,f.bezier=di,f.bindAll=gr,f.boundsAttributes=Kp,f.bufferConvexPolygon=function(o,t){const l=[];for(let h=0;h<o.length;h++){const m=Zr(h-1,-1,o.length-1),x=Zr(h+1,-1,o.length-1),C=o[h],D=o[x],M=o[m].sub(C).unit(),P=D.sub(C).unit(),U=P.angleWithSep(M.x,M.y),G=M.add(P).unit().mult(-1*t/Math.sin(U/2));l.push(C.add(G))}return l},f.cacheEntryPossiblyAdded=function(o){Xi++,Xi>_r&&(o.getActor().send("enforceCacheSizeLimit",xi),Xi=0)},f.calculateGlobeLabelMatrix=function(o,t){const{x:l,y:h}=o.point,m=Zi(l,h,o.worldSize/o._pixelsPerMercatorPixel,0,0);return eu(m,m,If(sl(t)))},f.calculateGlobeMatrix=function(o){const{x:t,y:l}=o.point,{lng:h,lat:m}=o._center;return Zi(t,l,o.worldSize,h,m)},f.calculateGlobeMercatorMatrix=function(o){const t=o.pixelsPerMeter,l=t/ic(1,o.center.lat),h=Rc(new Float64Array(16));return dc(h,h,[o.point.x,o.point.y,0]),yd(h,h,[l,l,t]),Float32Array.from(h)},f.circumferenceAtLatitude=or,f.clamp=xr,f.clearTileCache=function(o){if(!Mo())return;const t=ze.caches.delete(Pr);o&&t.catch(o).then(()=>o())},f.clipLine=s0,f.clone=function(o){var t=new Bl(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},f.clone$1=nn,f.collisionCircleLayout=Su,f.config=$t,f.conjugate=function(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[3]=t[3],o},f.create=function(){var o=new Bl(16);return Bl!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},f.create$1=yf,f.createExpression=Sa,f.createLayout=pt,f.createStyleLayer=function(o){return"custom"===o.type?new w0(o):new E0[o.type](o)},f.cross=wf,f.degToRad=Yt,f.distance=function(o,t){return Math.hypot(t[0]-o[0],t[1]-o[1],t[2]-o[2])},f.div=function(o,t,l){return o[0]=t[0]/l[0],o[1]=t[1]/l[1],o[2]=t[2]/l[2],o},f.dot=Il,f.earthRadius=ya,f.ease=xo,f.easeCubicInOut=kn,f.ecefToLatLng=function([o,t,l]){const h=Math.hypot(o,t,l),m=Math.atan2(o,l),x=.5*Math.PI-Math.acos(-t/h);return new yo(Kt(m),Kt(x))},f.emitValidationErrors=hn,f.endsWith=Qn,f.enforceCacheSizeLimit=function(o){Ho(),Rr&&Rr.then(t=>{t.keys().then(l=>{for(let h=0;h<l.length-o;h++)t.delete(l[h])})})},f.evaluateSizeForFeature=Pp,f.evaluateSizeForZoom=ch,f.evaluateVariableOffset=Vp,f.evented=A,f.exactEquals=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]},f.exactEquals$1=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]},f.exported=Fi,f.exported$1=xt,f.extend=At,f.extend$1=vr,f.fillExtrusionHeightLift=Hm,f.filterObject=ir,f.fromMat4=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[4],o[4]=t[5],o[5]=t[6],o[6]=t[8],o[7]=t[9],o[8]=t[10],o},f.fromQuat=function(o,t){var l=t[0],h=t[1],m=t[2],x=t[3],C=l+l,D=h+h,M=m+m,P=l*C,U=h*C,G=h*D,Y=m*C,ne=m*D,ae=m*M,pe=x*C,Ee=x*D,Pe=x*M;return o[0]=1-G-ae,o[1]=U+Pe,o[2]=Y-Ee,o[3]=0,o[4]=U-Pe,o[5]=1-P-ae,o[6]=ne+pe,o[7]=0,o[8]=Y+Ee,o[9]=ne-pe,o[10]=1-P-G,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.fromRotation=function(o,t){var l=Math.sin(t),h=Math.cos(t);return o[0]=h,o[1]=l,o[2]=0,o[3]=-l,o[4]=h,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},f.fromScaling=up,f.furthestTileCorner=function(o){const t=Math.round((o+45+360)%360/90)%4;return dn[t]},f.getAABBPointSquareDist=function(o,t,l){let h=0;for(let m=0;m<2;++m){const x=l?l[m]:0;o[m]>x&&(h+=(o[m]-x)*(o[m]-x)),t[m]<x&&(h+=(x-t[m])*(x-t[m]))}return h},f.getAnchorAlignment=tm,f.getAnchorJustification=h0,f.getBounds=function(o){let t=1/0,l=1/0,h=-1/0,m=-1/0;for(const x of o)t=Math.min(t,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),m=Math.max(m,x.y);return{min:new gt(t,l),max:new gt(h,m)}},f.getColumn=wr,f.getDefaultExportFromCjs=jn,f.getGridMatrix=function(o,t,l,h){const m=t.getNorth(),x=t.getSouth(),C=t.getWest(),D=t.getEast(),M=1<<o.z,P=D-C,U=m-x,G=P/64,Y=-U/$a[l],ne=[0,G,0,Y,0,0,m,C,0];if(o.z>0){const ae=180/h;cp(ne,ne,[ae/P+1,0,0,0,ae/U+1,0,-.5*ae/G,.5*ae/Y,1])}return ne[2]=M,ne[5]=o.x,ne[8]=o.y,ne},f.getImage=Re,f.getJSON=function(o,t){return wo(At(o,{type:"json"}),t)},f.getLatitudinalLod=function(o){const t=al-5;o=xr(o,-t,t)/t*90;const l=Math.pow(Math.abs(Math.sin(Yt(o))),3);return Math.round(l*($a.length-1))},f.getMapSessionAPI=Ji,f.getPerformanceMeasurement=In,f.getProjection=Jf,f.getRTLTextPluginStatus=T,f.getReferrer=Jr,f.getTilePoint=function(o,{x:t,y:l},h=0){return new gt(((t-h)*o.scale-o.x)*Tr,(l*o.scale-o.y)*Tr)},f.getTileVec3=function(o,t,l=0){return vu(((t.x-l)*o.scale-o.x)*Tr,(t.y*o.scale-o.y)*Tr,Eg(t.z,t.y))},f.getVideo=function(o,t){const l=ze.document.createElement("video");l.muted=!0,l.onloadstart=function(){t(null,l)};for(let h=0;h<o.length;h++){const m=ze.document.createElement("source");Bs(o[h])||(l.crossOrigin="Anonymous"),m.src=o[h],l.appendChild(m)}return{cancel:()=>{}}},f.globeCenterToScreenPoint=function(o){const t=[0,0,0],l=Rc(new Float64Array(16));return eu(l,o.pixelMatrix,o.globeMatrix),Ts(t,t,l),new gt(t[0],t[1])},f.globeDenormalizeECEF=If,f.globeECEFOrigin=function(o,t){const l=[0,0,0];return Ts(l,l,Yd(sl(t.canonical))),Ts(l,l,o),l},f.globeMetersToEcef=Wu,f.globeNormalizeECEF=Yd,f.globePixelsToTileUnits=function(o,t){return Tr/(512*Math.pow(2,o))*Ad(sl(t))},f.globePoleMatrixForTile=function(o,t,l){const h=Rc(new Float64Array(16)),m=(t/(1<<o)-.5)*Math.PI*2;return $d(h,l.globeMatrix,m),Float32Array.from(h)},f.globeTileBounds=sl,f.globeTiltAtLngLat=Mf,f.globeToMercatorTransition=bu,f.globeUseCustomAntiAliasing=function(o,t,l){const h=bu(l.zoom),m=o.style.map._antialias,x=!!t.extStandardDerivatives,C=t.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===h&&!m&&!C&&x},f.identity=Rc,f.identity$1=pp,f.invert=Wi,f.isFullscreen=function(){return!!ze.document.fullscreenElement||!!ze.document.webkitFullscreenElement},f.isLngLatBehindGlobe=_l,f.isMapAuthenticated=function(o){return _t.has(o)},f.isMapboxURL=rt,f.isSafariWithAntialiasingBug=function(o){const t=o.navigator?o.navigator.userAgent:null;return!!fr(o)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=La,f.latLngToECEF=Ed,f.len=hp,f.length=xd,f.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},f.lngFromMercatorX=Rs,f.loadVectorTile=B0,f.makeRequest=wo,f.mapValue=function(o,t,l,h,m){return xr((o-t)/(l-t)*(m-h)+h,h,m)},f.mercatorScale=Fh,f.mercatorXfromLng=hc,f.mercatorYfromLat=Vs,f.mercatorZfromAltitude=ic,f.mul=Bm,f.mul$1=yg,f.multiply=eu,f.multiply$1=cp,f.multiply$2=vg,f.nextPowerOfTwo=rn,f.normalize=Pa,f.normalize$1=wg,f.normalize$2=xg,f.number=ri,f.ortho=function(o,t,l,h,m,x,C){var D=1/(t-l),M=1/(h-m),P=1/(x-C);return o[0]=-2*D,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(t+l)*D,o[13]=(m+h)*M,o[14]=(C+x)*P,o[15]=1,o},f.pbf=Hg,f.perspective=function(o,t,l,h,m){var x,C=1/Math.tan(t/2);return o[0]=C/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=C,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=m&&m!==1/0?(o[10]=(m+h)*(x=1/(h-m)),o[14]=2*m*h*x):(o[10]=-1,o[14]=-2*h),o},f.pick=function(o,t){const l={};for(let h=0;h<t.length;h++){const m=t[h];m in o&&(l[m]=o[m])}return l},f.plugin=k,f.pointGeometry=rr,f.polesInViewport=function(o){const t=Rc(new Float64Array(16));eu(t,o.pixelMatrix,o.globeMatrix);const l=[0,Zo,0],h=[0,qo,0];return Ts(l,l,t),Ts(h,h,t),[l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!_l(o,new yo(o.center.lat,90)),h[0]>0&&h[0]<=o.width&&h[1]>0&&h[1]<=o.height&&!_l(o,new yo(o.center.lat,-90))]},f.polygonContainsPoint=iu,f.polygonIntersectsBox=Lf,f.polygonIntersectsPolygon=yp,f.polygonizeBounds=function(o,t,l=0,h=!0){const m=new gt(l,l),x=o.sub(m),C=t.add(m),D=[x,new gt(C.x,x.y),C,new gt(x.x,C.y)];return h&&D.push(x.clone()),D},f.posAttributes=Rh,f.postMapLoadEvent=Mr,f.postPerformanceEvent=hi,f.postTurnstileEvent=xn,f.potpack=Kg,f.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},f.radToDeg=Kt,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(o){return o({pluginStatus:_,pluginURL:i}),A.on("pluginStateChange",o),o},f.removeAuthState=function(o){_t.delete(o)},f.renderColorRamp=os,f.resample=Zu,f.rotateX=Mh,f.rotateX$1=wd,f.rotateY=$d,f.rotateY$1=Ph,f.rotateZ=function(o,t,l){var h=Math.sin(l),m=Math.cos(l),x=t[0],C=t[1],D=t[2],M=t[3],P=t[4],U=t[5],G=t[6],Y=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=x*m+P*h,o[1]=C*m+U*h,o[2]=D*m+G*h,o[3]=M*m+Y*h,o[4]=P*m-x*h,o[5]=U*m-C*h,o[6]=G*m-D*h,o[7]=Y*m-M*h,o},f.rotateZ$1=function(o,t,l){l*=.5;var h=t[0],m=t[1],x=t[2],C=t[3],D=Math.sin(l),M=Math.cos(l);return o[0]=h*M+m*D,o[1]=m*M-h*D,o[2]=x*M+C*D,o[3]=C*M-x*D,o},f.scale=yd,f.scale$1=fp,f.scale$2=$l,f.scaleAndAdd=ju,f.set=function(o,t,l,h){return o[0]=t,o[1]=l,o[2]=h,o},f.setCacheLimits=function(o,t){xi=o,_r=t},f.setColumn=function(o,t,l){o[4*t+0]=l[0],o[4*t+1]=l[1],o[4*t+2]=l[2],o[4*t+3]=l[3]},f.setRTLTextPlugin=function(o,t,l=!1){if(_===$||_===F||_===q)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=Fi.resolveURL(o),_=$,se=t,y(),l||N()},f.smoothstep=Vn,f.spec=Et,f.squaredLength=function(o){var t=o[0],l=o[1],h=o[2];return t*t+l*l+h*h},f.storeAuthState=function(o,t){t?_t.add(o):_t.delete(o)},f.sub=Wl,f.subtract=Zd,f.symbolSize=Jh,f.tileAABB=function(o,t,l,h,m,x,C,D,M){if("globe"===M.name)return function mo(o,t,l){const h=t/o.worldSize,m=o.globeMatrix;if(l.z<=1){const Rt=sl(l).getCorners();return Xd(Rt,m,h),Ml.fromPoints(Rt)}const x=wu(l),C=Sf(x);Xd(C,m,h);const D=Number.MAX_VALUE,M=[-D,-D,-D],P=[D,D,D];if(x.contains(o.center)){for(const Dn of C)yu(P,P,Dn),Oh(M,M,Dn);M[2]=0;const Rt=o.point,tn=[Rt.x*h,Rt.y*h,0];return yu(P,P,tn),Oh(M,M,tn),new Ml(P,M)}const U=[m[12]*h,m[13]*h,m[14]*h],G=x.getCenter(),Y=xr(o.center.lat,-al,al),ne=xr(G.lat,-al,al),ae=hc(o.center.lng),pe=Vs(Y);let Ee=ae-hc(G.lng);const Pe=pe-Vs(ne);Ee>.5?Ee-=1:Ee<-.5&&(Ee+=1);let We=0;Math.abs(Ee)>Math.abs(Pe)?We=Ee>=0?1:3:(We=Pe>=0?0:2,ju(U,U,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(Yt(Pe>=0?x.getSouth():x.getNorth()))*rc));const Le=C[We],$e=C[(We+1)%4],et=new mp(Le,$e,U),Xe=[Lh(et,0)||Le[0],Lh(et,1)||Le[1],Lh(et,2)||Le[2]],Ft=bu(o.zoom);if(Ft>0){const Rt=function({x:Dn,y:Ht,z:cn},fn,bn,Pn,Jt){const qn=1/(1<<cn);let ar=Dn*qn,Yn=ar+qn,li=Ht*qn,Rn=li+qn,Ar=0;const ci=(ar+Yn)/2-Pn;return ci>.5?Ar=-1:ci<-.5&&(Ar=1),ar=((ar+Ar)*fn-(Pn*=fn))*bn+Pn,Yn=((Yn+Ar)*fn-Pn)*bn+Pn,li=(li*fn-(Jt*=fn))*bn+Jt,Rn=(Rn*fn-Jt)*bn+Jt,[[ar,Rn,0],[Yn,Rn,0],[Yn,li,0],[ar,li,0]]}(l,t,o._pixelsPerMercatorPixel,ae,pe);for(let Dn=0;Dn<C.length;Dn++)xu(C[Dn],Rt[Dn],Ft);const tn=tu([],Rt[We],Rt[(We+1)%4]);$l(tn,tn,.5),xu(Xe,tn,Ft)}for(const Rt of C)yu(P,P,Rt),Oh(M,M,Rt);return P[2]=Math.min(Le[2],$e[2]),yu(P,P,Xe),Oh(M,M,Xe),new Ml(P,M)}(o,t,new Lg(l,h,m));const P=gh({z:l,x:h,y:m},M);return new Ml([(x+P.x/P.scale)*t,t*(P.y/P.scale),C],[(x+P.x2/P.scale)*t,t*(P.y2/P.scale),D])},f.tileCornersToBounds=wu,f.tileTransform=gh,f.transformMat3=function(o,t,l){var h=t[0],m=t[1],x=t[2];return o[0]=h*l[0]+m*l[3]+x*l[6],o[1]=h*l[1]+m*l[4]+x*l[7],o[2]=h*l[2]+m*l[5]+x*l[8],o},f.transformMat4=Ts,f.transformMat4$1=Lc,f.transformQuat=Hu,f.transitionTileAABBinECEF=Tf,f.translate=dc,f.transpose=function(o,t){if(o===t){var l=t[1],h=t[2],m=t[5];o[1]=t[3],o[2]=t[6],o[3]=l,o[5]=t[7],o[6]=h,o[7]=m}else o[0]=t[0],o[1]=t[3],o[2]=t[6],o[3]=t[1],o[4]=t[4],o[5]=t[7],o[6]=t[2],o[7]=t[5],o[8]=t[8];return o},f.triggerPluginCompletionEvent=g,f.uniqueId=Zt,f.updateGlobeVertexNormal=function(o,t,l,h,m){const x=5*t+2;o.float32[x+0]=l,o.float32[x+1]=h,o.float32[x+2]=m},f.validateCustomStyleLayer=function(o){const t=[],l=o.id;return void 0===l&&t.push({message:`layers.${l}: missing required property "id"`}),void 0===o.render&&t.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},f.validateFilter=o=>ca(Va(o)),f.validateFog=o=>ca(fd(o)),f.validateLayer=o=>ca(hd(o)),f.validateLight=o=>ca(Ru(o)),f.validateSource=o=>ca(Nl(o)),f.validateStyle=Fe,f.validateTerrain=o=>ca(Cc(o)),f.values=Ir,f.vectorTile=wn,f.version=ke,f.warnOnce=Gn,f.window=ze,f.wrap=Zr}),bt(0,function(f){function ze(Ue){if("number"==typeof Ue||"boolean"==typeof Ue||"string"==typeof Ue||null==Ue)return JSON.stringify(Ue);if(Array.isArray(Ue)){let ve="[";for(const Re of Ue)ve+=`${ze(Re)},`;return`${ve}]`}let ge="{";for(const ve of Object.keys(Ue).sort())ge+=`${ve}:${ze(Ue[ve])},`;return`${ge}}`}function ke(Ue){let ge="";for(const ve of f.refProperties)ge+=`/${ze(Ue[ve])}`;return ge}class Vt{constructor(ge){this.keyCache={},ge&&this.replace(ge)}replace(ge){this._layerConfigs={},this._layers={},this.update(ge,[])}update(ge,ve){for(const Oe of ge)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=f.createStyleLayer(Oe)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of ve)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Re=function(Oe,rt){const wt={};for(let Ye=0;Ye<Oe.length;Ye++){const Dt=rt&&rt[Oe[Ye].id]||ke(Oe[Ye]);rt&&(rt[Oe[Ye].id]=Dt);let pn=wt[Dt];pn||(pn=wt[Dt]=[]),pn.push(Oe[Ye])}const st=[];for(const Ye in wt)st.push(wt[Ye]);return st}(f.values(this._layerConfigs),this.keyCache);for(const Oe of Re){const rt=Oe.map(Mn=>this._layers[Mn.id]),wt=rt[0];if("none"===wt.visibility)continue;const st=wt.source||"";let Ye=this.familiesBySource[st];Ye||(Ye=this.familiesBySource[st]={});const Dt=wt.sourceLayer||"_geojsonTileLayer";let pn=Ye[Dt];pn||(pn=Ye[Dt]=[]),pn.push(rt)}}}class $t{loadTile(ge,ve){const{uid:Re,encoding:Oe,rawImageData:rt,padding:wt,buildQuadTree:st}=ge,Ye=f.window.ImageBitmap&&rt instanceof f.window.ImageBitmap?this.getImageData(rt,wt):rt;ve(null,new f.DEMData(Re,Ye,Oe,wt<1,st))}getImageData(ge,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ge.width,ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ge.width,this.offscreenCanvas.height=ge.height,this.offscreenCanvasContext.drawImage(ge,0,0,ge.width,ge.height);const Re=this.offscreenCanvasContext.getImageData(-ve,-ve,ge.width+2*ve,ge.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Re}}function xt(Ue,ge){if(0!==Ue.length){ft(Ue[0],ge);for(var ve=1;ve<Ue.length;ve++)ft(Ue[ve],!ge)}}function ft(Ue,ge){for(var ve=0,Re=0,Oe=0,rt=Ue.length,wt=rt-1;Oe<rt;wt=Oe++){var st=(Ue[Oe][0]-Ue[wt][0])*(Ue[wt][1]+Ue[Oe][1]),Ye=ve+st;Re+=Math.abs(ve)>=Math.abs(st)?ve-Ye+st:st-Ye+ve,ve=Ye}ve+Re>=0!=!!ge&&Ue.reverse()}var it=f.getDefaultExportFromCjs(function Ue(ge,ve){var Re,Oe=ge&&ge.type;if("FeatureCollection"===Oe)for(Re=0;Re<ge.features.length;Re++)Ue(ge.features[Re],ve);else if("GeometryCollection"===Oe)for(Re=0;Re<ge.geometries.length;Re++)Ue(ge.geometries[Re],ve);else if("Feature"===Oe)Ue(ge.geometry,ve);else if("Polygon"===Oe)xt(ge.coordinates,ve);else if("MultiPolygon"===Oe)for(Re=0;Re<ge.coordinates.length;Re++)xt(ge.coordinates[Re],ve);return ge});const dt=f.VectorTileFeature.prototype.toGeoJSON;var Bt={exports:{}},zt=f.pointGeometry,un=f.vectorTile.VectorTileFeature,jn=Jn;function Jn(Ue,ge){this.options=ge||{},this.features=Ue,this.length=Ue.length}function mr(Ue,ge){this.id="number"==typeof Ue.id?Ue.id:void 0,this.type=Ue.type,this.rawGeometry=1===Ue.type?[Ue.geometry]:Ue.geometry,this.properties=Ue.tags,this.extent=ge||4096}Jn.prototype.feature=function(Ue){return new mr(this.features[Ue],this.options.extent)},mr.prototype.loadGeometry=function(){var Ue=this.rawGeometry;this.geometry=[];for(var ge=0;ge<Ue.length;ge++){for(var ve=Ue[ge],Re=[],Oe=0;Oe<ve.length;Oe++)Re.push(new zt(ve[Oe][0],ve[Oe][1]));this.geometry.push(Re)}return this.geometry},mr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ue=this.geometry,ge=1/0,ve=-1/0,Re=1/0,Oe=-1/0,rt=0;rt<Ue.length;rt++)for(var wt=Ue[rt],st=0;st<wt.length;st++){var Ye=wt[st];ge=Math.min(ge,Ye.x),ve=Math.max(ve,Ye.x),Re=Math.min(Re,Ye.y),Oe=Math.max(Oe,Ye.y)}return[ge,Re,ve,Oe]},mr.prototype.toGeoJSON=un.prototype.toGeoJSON;var Xt=f.pbf,rr=jn;function kt(Ue){var ge=new Xt;return function(ve,Re){for(var Oe in ve.layers)Re.writeMessage(3,gt,ve.layers[Oe])}(Ue,ge),ge.finish()}function gt(Ue,ge){var ve;ge.writeVarintField(15,Ue.version||1),ge.writeStringField(1,Ue.name||""),ge.writeVarintField(5,Ue.extent||4096);var Re={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<Ue.length;ve++)Re.feature=Ue.feature(ve),ge.writeMessage(2,ln,Re);var Oe=Re.keys;for(ve=0;ve<Oe.length;ve++)ge.writeStringField(3,Oe[ve]);var rt=Re.values;for(ve=0;ve<rt.length;ve++)ge.writeMessage(4,kn,rt[ve])}function ln(Ue,ge){var ve=Ue.feature;void 0!==ve.id&&ge.writeVarintField(1,ve.id),ge.writeMessage(2,Wn,Ue),ge.writeVarintField(3,ve.type),ge.writeMessage(4,dn,ve)}function Wn(Ue,ge){var ve=Ue.feature,Re=Ue.keys,Oe=Ue.values,rt=Ue.keycache,wt=Ue.valuecache;for(var st in ve.properties){var Ye=ve.properties[st],Dt=rt[st];if(null!==Ye){void 0===Dt&&(Re.push(st),rt[st]=Dt=Re.length-1),ge.writeVarint(Dt);var pn=typeof Ye;"string"!==pn&&"boolean"!==pn&&"number"!==pn&&(Ye=JSON.stringify(Ye));var Mn=pn+":"+Ye,Ze=wt[Mn];void 0===Ze&&(Oe.push(Ye),wt[Mn]=Ze=Oe.length-1),ge.writeVarint(Ze)}}}function Yt(Ue,ge){return(ge<<3)+(7&Ue)}function Kt(Ue){return Ue<<1^Ue>>31}function dn(Ue,ge){for(var ve=Ue.loadGeometry(),Re=Ue.type,Oe=0,rt=0,wt=ve.length,st=0;st<wt;st++){var Ye=ve[st],Dt=1;1===Re&&(Dt=Ye.length),ge.writeVarint(Yt(1,Dt));for(var pn=3===Re?Ye.length-1:Ye.length,Mn=0;Mn<pn;Mn++){1===Mn&&1!==Re&&ge.writeVarint(Yt(2,pn-1));var Ze=Ye[Mn].x-Oe,lt=Ye[Mn].y-rt;ge.writeVarint(Kt(Ze)),ge.writeVarint(Kt(lt)),Oe+=Ze,rt+=lt}3===Re&&ge.writeVarint(Yt(7,1))}}function kn(Ue,ge){var ve=typeof Ue;"string"===ve?ge.writeStringField(1,Ue):"boolean"===ve?ge.writeBooleanField(7,Ue):"number"===ve&&(Ue%1!=0?ge.writeDoubleField(3,Ue):Ue<0?ge.writeSVarintField(6,Ue):ge.writeVarintField(5,Ue))}Bt.exports=kt,Bt.exports.fromVectorTileJs=kt,Bt.exports.fromGeojsonVt=function(Ue,ge){ge=ge||{};var ve={};for(var Re in Ue)ve[Re]=new rr(Ue[Re].features,ge),ve[Re].name=Re,ve[Re].version=ge.version,ve[Re].extent=ge.extent;return kt({layers:ve})},Bt.exports.GeoJSONWrapper=rr;var di=f.getDefaultExportFromCjs(Bt.exports);const xo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},xr=Math.fround||(Vn=new Float32Array(1),Ue=>(Vn[0]=+Ue,Vn[0]));var Vn;const Zr=3,Ln=5,Ir=6;class At{constructor(ge){this.options=Object.assign(Object.create(xo),ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ge){const{log:ve,minZoom:Re,maxZoom:Oe}=this.options;ve&&console.time("total time");const rt=`prepare ${ge.length} points`;ve&&console.time(rt),this.points=ge;const wt=[];for(let Ye=0;Ye<ge.length;Ye++){const Dt=ge[Ye];if(!Dt.geometry)continue;const[pn,Mn]=Dt.geometry.coordinates,Ze=xr(mt(pn)),lt=xr(rn(Mn));wt.push(Ze,lt,1/0,Ye,-1,1),this.options.reduce&&wt.push(0)}let st=this.trees[Oe+1]=this._createTree(wt);ve&&console.timeEnd(rt);for(let Ye=Oe;Ye>=Re;Ye--){const Dt=+Date.now();st=this.trees[Ye]=this._createTree(this._cluster(st,Ye)),ve&&console.log("z%d: %d clusters in %dms",Ye,st.numItems,+Date.now()-Dt)}return ve&&console.timeEnd("total time"),this}getClusters(ge,ve){let Re=((ge[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,ge[1]));let rt=180===ge[2]?180:((ge[2]+180)%360+360)%360-180;const wt=Math.max(-90,Math.min(90,ge[3]));if(ge[2]-ge[0]>=360)Re=-180,rt=180;else if(Re>rt){const Mn=this.getClusters([Re,Oe,180,wt],ve),Ze=this.getClusters([-180,Oe,rt,wt],ve);return Mn.concat(Ze)}const st=this.trees[this._limitZoom(ve)],Ye=st.range(mt(Re),rn(wt),mt(rt),rn(Oe)),Dt=st.data,pn=[];for(const Mn of Ye){const Ze=this.stride*Mn;pn.push(Dt[Ze+Ln]>1?Nt(Dt,Ze,this.clusterProps):this.points[Dt[Ze+Zr]])}return pn}getChildren(ge){const ve=this._getOriginId(ge),Re=this._getOriginZoom(ge),Oe="No cluster with the specified id.",rt=this.trees[Re];if(!rt)throw new Error(Oe);const wt=rt.data;if(ve*this.stride>=wt.length)throw new Error(Oe);const st=this.options.radius/(this.options.extent*Math.pow(2,Re-1)),Ye=rt.within(wt[ve*this.stride],wt[ve*this.stride+1],st),Dt=[];for(const pn of Ye){const Mn=pn*this.stride;wt[Mn+4]===ge&&Dt.push(wt[Mn+Ln]>1?Nt(wt,Mn,this.clusterProps):this.points[wt[Mn+Zr]])}if(0===Dt.length)throw new Error(Oe);return Dt}getLeaves(ge,ve,Re){const Oe=[];return this._appendLeaves(Oe,ge,ve=ve||10,Re=Re||0,0),Oe}getTile(ge,ve,Re){const Oe=this.trees[this._limitZoom(ge)],rt=Math.pow(2,ge),{extent:wt,radius:st}=this.options,Ye=st/wt,Dt=(Re-Ye)/rt,pn=(Re+1+Ye)/rt,Mn={features:[]};return this._addTileFeatures(Oe.range((ve-Ye)/rt,Dt,(ve+1+Ye)/rt,pn),Oe.data,ve,Re,rt,Mn),0===ve&&this._addTileFeatures(Oe.range(1-Ye/rt,Dt,1,pn),Oe.data,rt,Re,rt,Mn),ve===rt-1&&this._addTileFeatures(Oe.range(0,Dt,Ye/rt,pn),Oe.data,-1,Re,rt,Mn),Mn.features.length?Mn:null}getClusterExpansionZoom(ge){let ve=this._getOriginZoom(ge)-1;for(;ve<=this.options.maxZoom;){const Re=this.getChildren(ge);if(ve++,1!==Re.length)break;ge=Re[0].properties.cluster_id}return ve}_appendLeaves(ge,ve,Re,Oe,rt){const wt=this.getChildren(ve);for(const st of wt){const Ye=st.properties;if(Ye&&Ye.cluster?rt+Ye.point_count<=Oe?rt+=Ye.point_count:rt=this._appendLeaves(ge,Ye.cluster_id,Re,Oe,rt):rt<Oe?rt++:ge.push(st),ge.length===Re)break}return rt}_createTree(ge){const ve=new f.KDBush(ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Re=0;Re<ge.length;Re+=this.stride)ve.add(ge[Re],ge[Re+1]);return ve.finish(),ve.data=ge,ve}_addTileFeatures(ge,ve,Re,Oe,rt,wt){for(const st of ge){const Ye=st*this.stride,Dt=ve[Ye+Ln]>1;let pn,Mn,Ze;if(Dt)pn=Zt(ve,Ye,this.clusterProps),Mn=ve[Ye],Ze=ve[Ye+1];else{const Ke=this.points[ve[Ye+Zr]];pn=Ke.properties;const[Tt,xn]=Ke.geometry.coordinates;Mn=mt(Tt),Ze=rn(xn)}const lt={type:1,geometry:[[Math.round(this.options.extent*(Mn*rt-Re)),Math.round(this.options.extent*(Ze*rt-Oe))]],tags:pn};let De;De=Dt||this.options.generateId?ve[Ye+Zr]:this.points[ve[Ye+Zr]].id,void 0!==De&&(lt.id=De),wt.features.push(lt)}}_limitZoom(ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+ge),this.options.maxZoom+1))}_cluster(ge,ve){const{radius:Re,extent:Oe,reduce:rt,minPoints:wt}=this.options,st=Re/(Oe*Math.pow(2,ve)),Ye=ge.data,Dt=[],pn=this.stride;for(let Mn=0;Mn<Ye.length;Mn+=pn){if(Ye[Mn+2]<=ve)continue;Ye[Mn+2]=ve;const Ze=Ye[Mn],lt=Ye[Mn+1],De=ge.within(Ye[Mn],Ye[Mn+1],st),Ke=Ye[Mn+Ln];let Tt=Ke;for(const xn of De){const Bn=xn*pn;Ye[Bn+2]>ve&&(Tt+=Ye[Bn+Ln])}if(Tt>Ke&&Tt>=wt){let xn,Bn=Ze*Ke,Mr=lt*Ke,Lr=-1;const hi=((Mn/pn|0)<<5)+(ve+1)+this.points.length;for(const zi of De){const Ji=zi*pn;if(Ye[Ji+2]<=ve)continue;Ye[Ji+2]=ve;const _t=Ye[Ji+Ln];Bn+=Ye[Ji]*_t,Mr+=Ye[Ji+1]*_t,Ye[Ji+4]=hi,rt&&(xn||(xn=this._map(Ye,Mn,!0),Lr=this.clusterProps.length,this.clusterProps.push(xn)),rt(xn,this._map(Ye,Ji)))}Ye[Mn+4]=hi,Dt.push(Bn/Tt,Mr/Tt,1/0,hi,-1,Tt),rt&&Dt.push(Lr)}else{for(let xn=0;xn<pn;xn++)Dt.push(Ye[Mn+xn]);if(Tt>1)for(const xn of De){const Bn=xn*pn;if(!(Ye[Bn+2]<=ve)){Ye[Bn+2]=ve;for(let Mr=0;Mr<pn;Mr++)Dt.push(Ye[Bn+Mr])}}}}return Dt}_getOriginId(ge){return ge-this.points.length>>5}_getOriginZoom(ge){return(ge-this.points.length)%32}_map(ge,ve,Re){if(ge[ve+Ln]>1){const wt=this.clusterProps[ge[ve+Ir]];return Re?Object.assign({},wt):wt}const Oe=this.points[ge[ve+Zr]].properties,rt=this.options.map(Oe);return Re&&rt===Oe?Object.assign({},rt):rt}}function Nt(Ue,ge,ve){return{type:"Feature",id:Ue[ge+Zr],properties:Zt(Ue,ge,ve),geometry:{type:"Point",coordinates:[(Re=Ue[ge],360*(Re-.5)),_n(Ue[ge+1])]}};var Re}function Zt(Ue,ge,ve){const Re=Ue[ge+Ln],Oe=Re>=1e4?`${Math.round(Re/1e3)}k`:Re>=1e3?Math.round(Re/100)/10+"k":Re,rt=Ue[ge+Ir],wt=-1===rt?{}:Object.assign({},ve[rt]);return Object.assign(wt,{cluster:!0,cluster_id:Ue[ge+Zr],point_count:Re,point_count_abbreviated:Oe})}function mt(Ue){return Ue/360+.5}function rn(Ue){const ge=Math.sin(Ue*Math.PI/180),ve=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return ve<0?0:ve>1?1:ve}function _n(Ue){const ge=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(ge))/Math.PI-90}function gr(Ue,ge,ve,Re){for(var Oe,rt=Re,wt=ve-ge>>1,st=ve-ge,Ye=Ue[ge],Dt=Ue[ge+1],pn=Ue[ve],Mn=Ue[ve+1],Ze=ge+3;Ze<ve;Ze+=3){var lt=Qn(Ue[Ze],Ue[Ze+1],Ye,Dt,pn,Mn);if(lt>rt)Oe=Ze,rt=lt;else if(lt===rt){var De=Math.abs(Ze-wt);De<st&&(Oe=Ze,st=De)}}rt>Re&&(Oe-ge>3&&gr(Ue,ge,Oe,Re),Ue[Oe+2]=rt,ve-Oe>3&&gr(Ue,Oe,ve,Re))}function Qn(Ue,ge,ve,Re,Oe,rt){var wt=Oe-ve,st=rt-Re;if(0!==wt||0!==st){var Ye=((Ue-ve)*wt+(ge-Re)*st)/(wt*wt+st*st);Ye>1?(ve=Oe,Re=rt):Ye>0&&(ve+=wt*Ye,Re+=st*Ye)}return(wt=Ue-ve)*wt+(st=ge-Re)*st}function tr(Ue,ge,ve,Re){var Oe={id:void 0===Ue?null:Ue,type:ge,geometry:ve,tags:Re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(rt){var wt=rt.geometry,st=rt.type;if("Point"===st||"MultiPoint"===st||"LineString"===st)ir(rt,wt);else if("Polygon"===st||"MultiLineString"===st)for(var Ye=0;Ye<wt.length;Ye++)ir(rt,wt[Ye]);else if("MultiPolygon"===st)for(Ye=0;Ye<wt.length;Ye++)for(var Dt=0;Dt<wt[Ye].length;Dt++)ir(rt,wt[Ye][Dt])}(Oe),Oe}function ir(Ue,ge){for(var ve=0;ve<ge.length;ve+=3)Ue.minX=Math.min(Ue.minX,ge[ve]),Ue.minY=Math.min(Ue.minY,ge[ve+1]),Ue.maxX=Math.max(Ue.maxX,ge[ve]),Ue.maxY=Math.max(Ue.maxY,ge[ve+1])}function nn(Ue,ge,ve,Re){if(ge.geometry){var Oe=ge.geometry.coordinates,rt=ge.geometry.type,wt=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),st=[],Ye=ge.id;if(ve.promoteId?Ye=ge.properties[ve.promoteId]:ve.generateId&&(Ye=Re||0),"Point"===rt)Oi(Oe,st);else if("MultiPoint"===rt)for(var Dt=0;Dt<Oe.length;Dt++)Oi(Oe[Dt],st);else if("LineString"===rt)Gn(Oe,st,wt,!1);else if("MultiLineString"===rt){if(ve.lineMetrics){for(Dt=0;Dt<Oe.length;Dt++)Gn(Oe[Dt],st=[],wt,!1),Ue.push(tr(Ye,"LineString",st,ge.properties));return}Pi(Oe,st,wt,!1)}else if("Polygon"===rt)Pi(Oe,st,wt,!0);else{if("MultiPolygon"!==rt){if("GeometryCollection"===rt){for(Dt=0;Dt<ge.geometry.geometries.length;Dt++)nn(Ue,{id:Ye,geometry:ge.geometry.geometries[Dt],properties:ge.properties},ve,Re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Dt=0;Dt<Oe.length;Dt++){var pn=[];Pi(Oe[Dt],pn,wt,!0),st.push(pn)}}Ue.push(tr(Ye,rt,st,ge.properties))}}function Oi(Ue,ge){ge.push(vi(Ue[0])),ge.push(qr(Ue[1])),ge.push(0)}function Gn(Ue,ge,ve,Re){for(var Oe,rt,wt=0,st=0;st<Ue.length;st++){var Ye=vi(Ue[st][0]),Dt=qr(Ue[st][1]);ge.push(Ye),ge.push(Dt),ge.push(0),st>0&&(wt+=Re?(Oe*Dt-Ye*rt)/2:Math.sqrt(Math.pow(Ye-Oe,2)+Math.pow(Dt-rt,2))),Oe=Ye,rt=Dt}var pn=ge.length-3;ge[2]=1,gr(ge,0,pn,ve),ge[pn+2]=1,ge.size=Math.abs(wt),ge.start=0,ge.end=ge.size}function Pi(Ue,ge,ve,Re){for(var Oe=0;Oe<Ue.length;Oe++){var rt=[];Gn(Ue[Oe],rt,ve,Re),ge.push(rt)}}function vi(Ue){return Ue/360+.5}function qr(Ue){var ge=Math.sin(Ue*Math.PI/180),ve=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return ve<0?0:ve>1?1:ve}function Ci(Ue,ge,ve,Re,Oe,rt,wt,st){if(Re/=ge,rt>=(ve/=ge)&&wt<Re)return Ue;if(wt<ve||rt>=Re)return null;for(var Ye=[],Dt=0;Dt<Ue.length;Dt++){var pn=Ue[Dt],Mn=pn.geometry,Ze=pn.type,lt=0===Oe?pn.minX:pn.minY,De=0===Oe?pn.maxX:pn.maxY;if(lt>=ve&&De<Re)Ye.push(pn);else if(!(De<ve||lt>=Re)){var Ke=[];if("Point"===Ze||"MultiPoint"===Ze)Ni(Mn,Ke,ve,Re,Oe);else if("LineString"===Ze)fr(Mn,Ke,ve,Re,Oe,!1,st.lineMetrics);else if("MultiLineString"===Ze)wr(Mn,Ke,ve,Re,Oe,!1);else if("Polygon"===Ze)wr(Mn,Ke,ve,Re,Oe,!0);else if("MultiPolygon"===Ze)for(var Tt=0;Tt<Mn.length;Tt++){var xn=[];wr(Mn[Tt],xn,ve,Re,Oe,!0),xn.length&&Ke.push(xn)}if(Ke.length){if(st.lineMetrics&&"LineString"===Ze){for(Tt=0;Tt<Ke.length;Tt++)Ye.push(tr(pn.id,Ze,Ke[Tt],pn.tags));continue}"LineString"!==Ze&&"MultiLineString"!==Ze||(1===Ke.length?(Ze="LineString",Ke=Ke[0]):Ze="MultiLineString"),"Point"!==Ze&&"MultiPoint"!==Ze||(Ze=3===Ke.length?"Point":"MultiPoint"),Ye.push(tr(pn.id,Ze,Ke,pn.tags))}}}return Ye.length?Ye:null}function Ni(Ue,ge,ve,Re,Oe){for(var rt=0;rt<Ue.length;rt+=3){var wt=Ue[rt+Oe];wt>=ve&&wt<=Re&&(ge.push(Ue[rt]),ge.push(Ue[rt+1]),ge.push(Ue[rt+2]))}}function fr(Ue,ge,ve,Re,Oe,rt,wt){for(var st,Ye,Dt=Ai(Ue),pn=0===Oe?xi:_r,Mn=Ue.start,Ze=0;Ze<Ue.length-3;Ze+=3){var lt=Ue[Ze],De=Ue[Ze+1],Ke=Ue[Ze+2],Tt=Ue[Ze+3],xn=Ue[Ze+4],Bn=0===Oe?lt:De,Mr=0===Oe?Tt:xn,Lr=!1;wt&&(st=Math.sqrt(Math.pow(lt-Tt,2)+Math.pow(De-xn,2))),Bn<ve?Mr>ve&&(Ye=pn(Dt,lt,De,Tt,xn,ve),wt&&(Dt.start=Mn+st*Ye)):Bn>Re?Mr<Re&&(Ye=pn(Dt,lt,De,Tt,xn,Re),wt&&(Dt.start=Mn+st*Ye)):Pr(Dt,lt,De,Ke),Mr<ve&&Bn>=ve&&(Ye=pn(Dt,lt,De,Tt,xn,ve),Lr=!0),Mr>Re&&Bn<=Re&&(Ye=pn(Dt,lt,De,Tt,xn,Re),Lr=!0),!rt&&Lr&&(wt&&(Dt.end=Mn+st*Ye),ge.push(Dt),Dt=Ai(Ue)),wt&&(Mn+=st)}var hi=Ue.length-3;lt=Ue[hi],De=Ue[hi+1],Ke=Ue[hi+2],(Bn=0===Oe?lt:De)>=ve&&Bn<=Re&&Pr(Dt,lt,De,Ke),hi=Dt.length-3,rt&&hi>=3&&(Dt[hi]!==Dt[0]||Dt[hi+1]!==Dt[1])&&Pr(Dt,Dt[0],Dt[1],Dt[2]),Dt.length&&ge.push(Dt)}function Ai(Ue){var ge=[];return ge.size=Ue.size,ge.start=Ue.start,ge.end=Ue.end,ge}function wr(Ue,ge,ve,Re,Oe,rt){for(var wt=0;wt<Ue.length;wt++)fr(Ue[wt],ge,ve,Re,Oe,rt,!1)}function Pr(Ue,ge,ve,Re){Ue.push(ge),Ue.push(ve),Ue.push(Re)}function xi(Ue,ge,ve,Re,Oe,rt){var wt=(rt-ge)/(Re-ge);return Ue.push(rt),Ue.push(ve+(Oe-ve)*wt),Ue.push(1),wt}function _r(Ue,ge,ve,Re,Oe,rt){var wt=(rt-ve)/(Oe-ve);return Ue.push(ge+(Re-ge)*wt),Ue.push(rt),Ue.push(1),wt}function Rr(Ue,ge){for(var ve=[],Re=0;Re<Ue.length;Re++){var Oe,rt=Ue[Re],wt=rt.type;if("Point"===wt||"MultiPoint"===wt||"LineString"===wt)Oe=ur(rt.geometry,ge);else if("MultiLineString"===wt||"Polygon"===wt){Oe=[];for(var st=0;st<rt.geometry.length;st++)Oe.push(ur(rt.geometry[st],ge))}else if("MultiPolygon"===wt)for(Oe=[],st=0;st<rt.geometry.length;st++){for(var Ye=[],Dt=0;Dt<rt.geometry[st].length;Dt++)Ye.push(ur(rt.geometry[st][Dt],ge));Oe.push(Ye)}ve.push(tr(rt.id,wt,Oe,rt.tags))}return ve}function ur(Ue,ge){var ve=[];ve.size=Ue.size,void 0!==Ue.start&&(ve.start=Ue.start,ve.end=Ue.end);for(var Re=0;Re<Ue.length;Re+=3)ve.push(Ue[Re]+ge,Ue[Re+1],Ue[Re+2]);return ve}function Mo(Ue,ge){if(Ue.transformed)return Ue;var ve,Re,Oe,rt=1<<Ue.z,wt=Ue.x,st=Ue.y;for(ve=0;ve<Ue.features.length;ve++){var Ye=Ue.features[ve],Dt=Ye.geometry,pn=Ye.type;if(Ye.geometry=[],1===pn)for(Re=0;Re<Dt.length;Re+=2)Ye.geometry.push(Ho(Dt[Re],Dt[Re+1],ge,rt,wt,st));else for(Re=0;Re<Dt.length;Re++){var Mn=[];for(Oe=0;Oe<Dt[Re].length;Oe+=2)Mn.push(Ho(Dt[Re][Oe],Dt[Re][Oe+1],ge,rt,wt,st));Ye.geometry.push(Mn)}}return Ue.transformed=!0,Ue}function Ho(Ue,ge,ve,Re,Oe,rt){return[Math.round(ve*(Ue*Re-Oe)),Math.round(ve*(ge*Re-rt))]}function qt(Ue,ge,ve,Re,Oe){for(var rt=ge===Oe.maxZoom?0:Oe.tolerance/((1<<ge)*Oe.extent),wt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:Re,z:ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<Ue.length;st++){wt.numFeatures++,Xi(wt,Ue[st],rt,Oe);var Ye=Ue[st].minX,Dt=Ue[st].minY,pn=Ue[st].maxX,Mn=Ue[st].maxY;Ye<wt.minX&&(wt.minX=Ye),Dt<wt.minY&&(wt.minY=Dt),pn>wt.maxX&&(wt.maxX=pn),Mn>wt.maxY&&(wt.maxY=Mn)}return wt}function Xi(Ue,ge,ve,Re){var Oe=ge.geometry,rt=ge.type,wt=[];if("Point"===rt||"MultiPoint"===rt)for(var st=0;st<Oe.length;st+=3)wt.push(Oe[st]),wt.push(Oe[st+1]),Ue.numPoints++,Ue.numSimplified++;else if("LineString"===rt)si(wt,Oe,Ue,ve,!1,!1);else if("MultiLineString"===rt||"Polygon"===rt)for(st=0;st<Oe.length;st++)si(wt,Oe[st],Ue,ve,"Polygon"===rt,0===st);else if("MultiPolygon"===rt)for(var Ye=0;Ye<Oe.length;Ye++){var Dt=Oe[Ye];for(st=0;st<Dt.length;st++)si(wt,Dt[st],Ue,ve,!0,0===st)}if(wt.length){var pn=ge.tags||null;if("LineString"===rt&&Re.lineMetrics){for(var Mn in pn={},ge.tags)pn[Mn]=ge.tags[Mn];pn.mapbox_clip_start=Oe.start/Oe.size,pn.mapbox_clip_end=Oe.end/Oe.size}var Ze={geometry:wt,type:"Polygon"===rt||"MultiPolygon"===rt?3:"LineString"===rt||"MultiLineString"===rt?2:1,tags:pn};null!==ge.id&&(Ze.id=ge.id),Ue.features.push(Ze)}}function si(Ue,ge,ve,Re,Oe,rt){var wt=Re*Re;if(Re>0&&ge.size<(Oe?wt:Re))ve.numPoints+=ge.length/3;else{for(var st=[],Ye=0;Ye<ge.length;Ye+=3)(0===Re||ge[Ye+2]>wt)&&(ve.numSimplified++,st.push(ge[Ye]),st.push(ge[Ye+1])),ve.numPoints++;Oe&&function(Dt,pn){for(var Mn=0,Ze=0,lt=Dt.length,De=lt-2;Ze<lt;De=Ze,Ze+=2)Mn+=(Dt[Ze]-Dt[De])*(Dt[Ze+1]+Dt[De+1]);if(Mn>0===pn)for(Ze=0,lt=Dt.length;Ze<lt/2;Ze+=2){var Ke=Dt[Ze],Tt=Dt[Ze+1];Dt[Ze]=Dt[lt-2-Ze],Dt[Ze+1]=Dt[lt-1-Ze],Dt[lt-2-Ze]=Ke,Dt[lt-1-Ze]=Tt}}(st,rt),Ue.push(st)}}function po(Ue,ge){var ve=(ge=this.options=function(Oe,rt){for(var wt in rt)Oe[wt]=rt[wt];return Oe}(Object.create(this.options),ge)).debug;if(ve&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");var Oe,rt,wt,st,Ye,Dt,Re=function(Oe,rt){var wt=[];if("FeatureCollection"===Oe.type)for(var st=0;st<Oe.features.length;st++)nn(wt,Oe.features[st],rt,st);else nn(wt,"Feature"===Oe.type?Oe:{geometry:Oe},rt);return wt}(Ue,ge);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),st=Oe=Re,Ye=Ci(Oe,1,-1-(wt=(rt=ge).buffer/rt.extent),wt,0,-1,2,rt),Dt=Ci(Oe,1,1-wt,2+wt,0,-1,2,rt),(Ye||Dt)&&(st=Ci(Oe,1,-wt,1+wt,0,-1,2,rt)||[],Ye&&(st=Rr(Ye,1).concat(st)),Dt&&(st=st.concat(Rr(Dt,-1)))),(Re=st).length&&this.splitTile(Re,0,0,0),ve&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Jr(Ue,ge,ve){return 32*((1<<Ue)*ve+ge)+Ue}function wo(Ue,ge){const ve=Ue.tileID.canonical;if(!this._geoJSONIndex)return ge(null,null);const Re=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Re)return ge(null,null);const Oe=new class{constructor(wt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=wt.length,this._features=wt}feature(wt){return new class{constructor(st){this._feature=st,this.extent=f.EXTENT,this.type=st.type,this.properties=st.tags,"id"in st&&!isNaN(st.id)&&(this.id=parseInt(st.id,10))}loadGeometry(){if(1===this._feature.type){const st=[];for(const Ye of this._feature.geometry)st.push([new f.Point(Ye[0],Ye[1])]);return st}{const st=[];for(const Ye of this._feature.geometry){const Dt=[];for(const pn of Ye)Dt.push(new f.Point(pn[0],pn[1]));st.push(Dt)}return st}}toGeoJSON(st,Ye,Dt){return dt.call(this,st,Ye,Dt)}}(this._features[wt])}}(Re.features);let rt=di(Oe);0===rt.byteOffset&&rt.byteLength===rt.buffer.byteLength||(rt=new Uint8Array(rt)),ge(null,{vectorTile:Oe,rawData:rt.buffer})}po.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},po.prototype.splitTile=function(Ue,ge,ve,Re,Oe,rt,wt){for(var st=[Ue,ge,ve,Re],Ye=this.options,Dt=Ye.debug;st.length;){Re=st.pop(),ve=st.pop(),ge=st.pop(),Ue=st.pop();var pn=1<<ge,Mn=Jr(ge,ve,Re),Ze=this.tiles[Mn];if(!Ze&&(Dt>1&&console.time("creation"),Ze=this.tiles[Mn]=qt(Ue,ge,ve,Re,Ye),this.tileCoords.push({z:ge,x:ve,y:Re}),Dt)){Dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,ve,Re,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var lt="z"+ge;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Ze.source=Ue,Oe){if(ge===Ye.maxZoom||ge===Oe)continue;var De=1<<Oe-ge;if(ve!==Math.floor(rt/De)||Re!==Math.floor(wt/De))continue}else if(ge===Ye.indexMaxZoom||Ze.numPoints<=Ye.indexMaxPoints)continue;if(Ze.source=null,0!==Ue.length){Dt>1&&console.time("clipping");var Ke,Tt,xn,Bn,Mr,Lr,hi=.5*Ye.buffer/Ye.extent,zi=.5-hi,Ji=.5+hi,_t=1+hi;Ke=Tt=xn=Bn=null,Mr=Ci(Ue,pn,ve-hi,ve+Ji,0,Ze.minX,Ze.maxX,Ye),Lr=Ci(Ue,pn,ve+zi,ve+_t,0,Ze.minX,Ze.maxX,Ye),Ue=null,Mr&&(Ke=Ci(Mr,pn,Re-hi,Re+Ji,1,Ze.minY,Ze.maxY,Ye),Tt=Ci(Mr,pn,Re+zi,Re+_t,1,Ze.minY,Ze.maxY,Ye),Mr=null),Lr&&(xn=Ci(Lr,pn,Re-hi,Re+Ji,1,Ze.minY,Ze.maxY,Ye),Bn=Ci(Lr,pn,Re+zi,Re+_t,1,Ze.minY,Ze.maxY,Ye),Lr=null),Dt>1&&console.timeEnd("clipping"),st.push(Ke||[],ge+1,2*ve,2*Re),st.push(Tt||[],ge+1,2*ve,2*Re+1),st.push(xn||[],ge+1,2*ve+1,2*Re),st.push(Bn||[],ge+1,2*ve+1,2*Re+1)}}},po.prototype.getTile=function(Ue,ge,ve){var Re=this.options,Oe=Re.extent,rt=Re.debug;if(Ue<0||Ue>24)return null;var wt=1<<Ue,st=Jr(Ue,ge=(ge%wt+wt)%wt,ve);if(this.tiles[st])return Mo(this.tiles[st],Oe);rt>1&&console.log("drilling down to z%d-%d-%d",Ue,ge,ve);for(var Ye,Dt=Ue,pn=ge,Mn=ve;!Ye&&Dt>0;)Dt--,pn=Math.floor(pn/2),Mn=Math.floor(Mn/2),Ye=this.tiles[Jr(Dt,pn,Mn)];return Ye&&Ye.source?(rt>1&&console.log("found parent tile z%d-%d-%d",Dt,pn,Mn),rt>1&&console.time("drilling down"),this.splitTile(Ye.source,Dt,pn,Mn,Ue,ge,ve),rt>1&&console.timeEnd("drilling down"),this.tiles[st]?Mo(this.tiles[st],Oe):null):null};class nr extends f.VectorTileWorkerSource{constructor(ge,ve,Re,Oe,rt){super(ge,ve,Re,Oe,wo),rt&&(this.loadGeoJSON=rt)}loadData(ge,ve){const Re=ge&&ge.request,Oe=Re&&Re.collectResourceTiming;this.loadGeoJSON(ge,(rt,wt)=>{if(rt||!wt)return ve(rt);if("object"!=typeof wt)return ve(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));{it(wt,!0);try{if(ge.filter){const Ye=f.createExpression(ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ye.result)throw new Error(Ye.value.map(pn=>`${pn.key}: ${pn.message}`).join(", "));wt={type:"FeatureCollection",features:wt.features.filter(pn=>Ye.value.evaluate({zoom:0},pn))}}this._geoJSONIndex=ge.cluster?new At(function({superclusterOptions:Ye,clusterProperties:Dt}){if(!Dt||!Ye)return Ye;const pn={},Mn={},Ze={accumulated:null,zoom:0},lt={properties:null},De=Object.keys(Dt);for(const Ke of De){const[Tt,xn]=Dt[Ke],Bn=f.createExpression(xn),Mr=f.createExpression("string"==typeof Tt?[Tt,["accumulated"],["get",Ke]]:Tt);pn[Ke]=Bn.value,Mn[Ke]=Mr.value}return Ye.map=Ke=>{lt.properties=Ke;const Tt={};for(const xn of De)Tt[xn]=pn[xn].evaluate(Ze,lt);return Tt},Ye.reduce=(Ke,Tt)=>{lt.properties=Tt;for(const xn of De)Ze.accumulated=Ke[xn],Ke[xn]=Mn[xn].evaluate(Ze,lt)},Ye}(ge)).load(wt.features):new po(Ye=wt,ge.geojsonVtOptions)}catch(Ye){return ve(Ye)}this.loaded={};const st={};if(Oe){const Ye=f.getPerformanceMeasurement(Re);Ye&&(st.resourceTiming={},st.resourceTiming[ge.source]=JSON.parse(JSON.stringify(Ye)))}ve(null,st)}var Ye})}reloadTile(ge,ve){const Re=this.loaded;return Re&&Re[ge.uid]?super.reloadTile(ge,ve):this.loadTile(ge,ve)}loadGeoJSON(ge,ve){if(ge.request)f.getJSON(ge.request,ve);else{if("string"!=typeof ge.data)return ve(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));try{return ve(null,JSON.parse(ge.data))}catch{return ve(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ge,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(ge.clusterId))}catch(Re){ve(Re)}}getClusterChildren(ge,ve){try{ve(null,this._geoJSONIndex.getChildren(ge.clusterId))}catch(Re){ve(Re)}}getClusterLeaves(ge,ve){try{ve(null,this._geoJSONIndex.getLeaves(ge.clusterId,ge.limit,ge.offset))}catch(Re){ve(Re)}}}class Bs{constructor(ge){this.self=ge,this.actor=new f.Actor(ge,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:nr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ve,Re)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Re},this.self.registerRTLTextPlugin=ve=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=ve.applyArabicShaping,f.plugin.processBidirectionalText=ve.processBidirectionalText,f.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}}clearCaches(ge,ve,Re){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge],Re()}checkIfReady(ge,ve,Re){Re()}setReferrer(ge,ve){this.referrer=ve}spriteLoaded(ge,ve){this.isSpriteLoaded[ge]=ve;for(const Re in this.workerSources[ge]){const Oe=this.workerSources[ge][Re];for(const rt in Oe)Oe[rt]instanceof f.VectorTileWorkerSource&&(Oe[rt].isSpriteLoaded=ve,Oe[rt].fire(new f.Event("isSpriteLoaded")))}}setImages(ge,ve,Re){this.availableImages[ge]=ve;for(const Oe in this.workerSources[ge]){const rt=this.workerSources[ge][Oe];for(const wt in rt)rt[wt].availableImages=ve}Re()}enableTerrain(ge,ve,Re){this.terrain=ve,Re()}setProjection(ge,ve){this.projections[ge]=f.getProjection(ve)}setLayers(ge,ve,Re){this.getLayerIndex(ge).replace(ve),Re()}updateLayers(ge,ve,Re){this.getLayerIndex(ge).update(ve.layers,ve.removedIds),Re()}loadTile(ge,ve,Re){const Oe=this.enableTerrain?f.extend({enableTerrain:this.terrain},ve):ve;Oe.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,ve.type,ve.source).loadTile(Oe,Re)}loadDEMTile(ge,ve,Re){const Oe=this.enableTerrain?f.extend({buildQuadTree:this.terrain},ve):ve;this.getDEMWorkerSource(ge,ve.source).loadTile(Oe,Re)}reloadTile(ge,ve,Re){const Oe=this.enableTerrain?f.extend({enableTerrain:this.terrain},ve):ve;Oe.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,ve.type,ve.source).reloadTile(Oe,Re)}abortTile(ge,ve,Re){this.getWorkerSource(ge,ve.type,ve.source).abortTile(ve,Re)}removeTile(ge,ve,Re){this.getWorkerSource(ge,ve.type,ve.source).removeTile(ve,Re)}removeSource(ge,ve,Re){if(!this.workerSources[ge]||!this.workerSources[ge][ve.type]||!this.workerSources[ge][ve.type][ve.source])return;const Oe=this.workerSources[ge][ve.type][ve.source];delete this.workerSources[ge][ve.type][ve.source],void 0!==Oe.removeSource?Oe.removeSource(ve,Re):Re()}loadWorkerSource(ge,ve,Re){try{this.self.importScripts(ve.url),Re()}catch(Oe){Re(Oe.toString())}}syncRTLPluginState(ge,ve,Re){try{f.plugin.setState(ve);const Oe=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=Oe){this.self.importScripts(Oe);const rt=f.plugin.isParsed();Re(rt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),rt)}}catch(Oe){Re(Oe.toString())}}getAvailableImages(ge){let ve=this.availableImages[ge];return ve||(ve=[]),ve}getLayerIndex(ge){let ve=this.layerIndexes[ge];return ve||(ve=this.layerIndexes[ge]=new Vt),ve}getWorkerSource(ge,ve,Re){return this.workerSources[ge]||(this.workerSources[ge]={}),this.workerSources[ge][ve]||(this.workerSources[ge][ve]={}),this.workerSources[ge][ve][Re]||(this.workerSources[ge][ve][Re]=new this.workerSourceTypes[ve]({send:(rt,wt,st,Ye,Dt,pn)=>{this.actor.send(rt,wt,st,ge,Dt,pn)},scheduler:this.actor.scheduler},this.getLayerIndex(ge),this.getAvailableImages(ge),this.isSpriteLoaded[ge])),this.workerSources[ge][ve][Re]}getDEMWorkerSource(ge,ve){return this.demWorkerSources[ge]||(this.demWorkerSources[ge]={}),this.demWorkerSources[ge][ve]||(this.demWorkerSources[ge][ve]=new $t),this.demWorkerSources[ge][ve]}enforceCacheSizeLimit(ge,ve){f.enforceCacheSizeLimit(ve)}getWorkerPerformanceMetrics(ge,ve,Re){Re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Bs(self)),Bs}),bt(0,function(f){function ze(_,i){if(Array.isArray(_)){if(!Array.isArray(i)||_.length!==i.length)return!1;for(let g=0;g<_.length;g++)if(!ze(_[g],i[g]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==i){if("object"!=typeof i||Object.keys(_).length!==Object.keys(i).length)return!1;for(const g in _)if(!ze(_[g],i[g]))return!1;return!0}return _===i}var ke=Vt;function Vt(_){return i=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,A,T=new Blob([""],{type:"text/javascript"}),N=URL.createObjectURL(T);try{A=new Worker(N),y=!0}catch{y=!1}return A&&A.terminate(),URL.revokeObjectURL(N),y}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var y=document.createElement("canvas");y.width=y.height=1;var A=y.getContext("2d");if(!A)return!1;var T=A.getImageData(0,0,1,1);return T&&T.width===y.width}()||(void 0===$t[g=i&&i.failIfMajorPerformanceCaveat]&&($t[g]=function(y){var A,N,k,H,T=(N=y,k=document.createElement("canvas"),(H=Object.create(Vt.webGLContextAttributes)).failIfMajorPerformanceCaveat=N,k.getContext("webgl",H)||k.getContext("experimental-webgl",H));if(!T)return!1;try{A=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!A||T.isContextLost())&&(T.shaderSource(A,"void main() {}"),T.compileShader(A),!0===T.getShaderParameter(A,T.COMPILE_STATUS))}(g)),!$t[g]||document.documentMode));var i,g}var $t={};function xt(_,i,g){const y=f.window.document.createElement(_);return void 0!==i&&(y.className=i),g&&g.appendChild(y),y}function ft(_,i,g){const y=f.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const A of Object.keys(i))y.setAttributeNS(null,A,i[A]);return g&&g.appendChild(y),y}Vt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const it=f.window.document&&f.window.document.documentElement.style,dt=it&&void 0!==it.userSelect?"userSelect":"WebkitUserSelect";let Bt;function zt(){it&&dt&&(Bt=it[dt],it[dt]="none")}function un(){it&&dt&&(it[dt]=Bt)}function jn(_){_.preventDefault(),_.stopPropagation(),f.window.removeEventListener("click",jn,!0)}function Jn(){f.window.addEventListener("click",jn,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",jn,!0)},0)}function mr(_,i){const g=_.getBoundingClientRect();return kt(_,g,i)}function Xt(_,i){const g=_.getBoundingClientRect(),y=[];for(let A=0;A<i.length;A++)y.push(kt(_,g,i[A]));return y}function rr(_){return void 0!==f.window.InstallTrigger&&2===_.button&&_.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function kt(_,i,g){const y=_.offsetWidth===i.width?1:_.offsetWidth/i.width;return new f.Point((g.clientX-i.left)*y,(g.clientY-i.top)*y)}function gt(_,i){var g=i[0],y=i[1],A=i[2],T=i[3],N=g*T-A*y;return N?(_[0]=T*(N=1/N),_[1]=-y*N,_[2]=-A*N,_[3]=g*N,_):null}function ln(_){const{userImage:i}=_;return!!(i&&i.render&&i.render())&&(_.data.replace(new Uint8Array(i.data.buffer)),!0)}class Wn extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:g,callback:y}of this.requestors)this._notify(g,y);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,g){this._validate(i,g)&&(this.images[i]=g)}_validate(i,g){let y=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),y=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),y=!1),this._validateContent(g.content,g)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),y=!1),y}_validateStretch(i,g){if(!i)return!0;let y=0;for(const A of i){if(A[0]<y||A[1]<A[0]||g<A[1])return!1;y=A[1]}return!0}_validateContent(i,g){return!(i&&(4!==i.length||i[0]<0||g.data.width<i[0]||i[1]<0||g.data.height<i[1]||i[2]<0||g.data.width<i[2]||i[3]<0||g.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,g){g.version=this.images[i].version+1,this.images[i]=g,this.updatedImages[i]=!0}removeImage(i){const g=this.images[i];delete this.images[i],delete this.patterns[i],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,g){let y=!0;if(!this.isLoaded())for(const A of i)this.images[A]||(y=!1);this.isLoaded()||y?this._notify(i,g):this.requestors.push({ids:i,callback:g})}_notify(i,g){const y={};for(const A of i){this.images[A]||this.fire(new f.Event("styleimagemissing",{id:A}));const T=this.images[A];T?y[A]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!(!T.userImage||!T.userImage.render)}:f.warnOnce(`Image "${A}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,y)}getPixelSize(){const{width:i,height:g}=this.atlasImage;return{width:i,height:g}}getPattern(i){const g=this.patterns[i],y=this.getImage(i);if(!y)return null;if(g&&g.position.version===y.version)return g.position;if(g)g.position.version=y.version;else{const A={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new f.ImagePosition(A,y);this.patterns[i]={bin:A,position:T}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const g=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(i,this.atlasImage,g.RGBA),this.atlasTexture&&this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const T in this.patterns)i.push(this.patterns[T].bin);const{w:g,h:y}=f.potpack(i),A=this.atlasImage;A.resize({width:g||1,height:y||1});for(const T in this.patterns){const{bin:N}=this.patterns[T],k=N.x+1,H=N.y+1,Q=this.images[T].data,J=Q.width,de=Q.height;f.RGBAImage.copy(Q,A,{x:0,y:0},{x:k,y:H},{width:J,height:de}),f.RGBAImage.copy(Q,A,{x:0,y:de-1},{x:k,y:H-1},{width:J,height:1}),f.RGBAImage.copy(Q,A,{x:0,y:0},{x:k,y:H+de},{width:J,height:1}),f.RGBAImage.copy(Q,A,{x:J-1,y:0},{x:k-1,y:H},{width:1,height:de}),f.RGBAImage.copy(Q,A,{x:0,y:0},{x:k+J,y:H},{width:1,height:de})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const g of i){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const y=this.images[g];ln(y)&&this.updateImage(g,y)}}}const Yt=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(_,i){return function([g,y,A]){const T=f.degToRad(y+90),N=f.degToRad(A);return{x:g*Math.cos(T)*Math.sin(N),y:g*Math.sin(T)*Math.sin(N),z:g*Math.cos(N),azimuthal:y,polar:A}}(_.expression.evaluate(i))}interpolate(_,i,g){return{x:f.number(_.x,i.x,g),y:f.number(_.y,i.y,g),z:f.number(_.z,i.z,g),azimuthal:f.number(_.azimuthal,i.azimuthal,g),polar:f.number(_.polar,i.polar,g)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)});class Kt extends f.Evented{constructor(i){super(),this._transitionable=new f.Transitionable(Yt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,g={}){if(!this._validate(f.validateLight,i,g))for(const y in i){const A=i[y];f.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),A):this._transitionable.setValue(y,A)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,g,y){return(!y||!1!==y.validate)&&f.emitValidationErrors(this,i.call(f.validateStyle,f.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const dn=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)});let kn=class extends f.Evented{constructor(_,i){super(),this._transitionable=new f.Transitionable(dn),this.set(_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(_){for(const i in _){const g=_[i];f.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),g):this._transitionable.setValue(i,g)}}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}};function di(_,i,g,y){const A=f.smoothstep(45,65,g),[T,N]=xo(_,y),k=f.length(i);let H=1-Math.min(1,Math.exp((k-T)/(N-T)*-6));return H*=H*H,H=Math.min(1,1.00747*H),H*A*_.alpha}function xo(_,i){const g=.5/Math.tan(.5*i);return[_.range[0]+g,_.range[1]+g]}const xr=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"high-color":new f.DataConstantProperty(f.spec.fog["high-color"]),"space-color":new f.DataConstantProperty(f.spec.fog["space-color"]),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"]),"star-intensity":new f.DataConstantProperty(f.spec.fog["star-intensity"])});class Vn extends f.Evented{constructor(i,g){super(),this._transitionable=new f.Transitionable(xr),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const i=this._transform,g="globe"===i.projection.name,y=f.globeToMercatorTransition(i.zoom),A=this.properties.get("range"),T=[.5,3];return{range:g?[f.number(T[0],A[0],y),f.number(T[1],A[1],y)]:A,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,g={}){if(!this._validate(f.validateFog,i,g)){for(const y of Object.keys(f.spec.fog))i&&void 0===i[y]&&(i[y]=f.spec.fog[y].default);for(const y in i){const A=i[y];f.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-11),A):this._transitionable.setValue(y,A)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:f.smoothstep(45,65,i))*g.a}getOpacityAtLatLng(i,g){return this._transform.projection.supportsFog?function(y,A,T){const N=f.MercatorCoordinate.fromLngLat(A),k=T.elevation?T.elevation.getAtPointOrZero(N):0,H=[N.x,N.y,k];return f.transformMat4(H,H,T.mercatorFogMatrix),di(y,H,T.pitch,T._fov)}(this.state,i,g):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?xo(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,g,y){return(!y||!1!==y.validate)&&f.emitValidationErrors(this,i.call(f.validateStyle,f.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class Zr{constructor(i,g){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const y=this.workerPool.acquire(this.id);for(let A=0;A<y.length;A++){const T=new Zr.Actor(y[A],g,this.id);T.name=`Worker ${A}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,g,y){f.asyncAll(this.actors,(A,T)=>{A.send(i,g,T)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ln(_,i,g){return i*(f.EXTENT/(_.tileSize*Math.pow(2,g-_.tileID.overscaledZ)))}Zr.Actor=f.Actor;class Ir{constructor(i,g,y,A){this.screenBounds=i,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,A)}static createFromScreenPoints(i,g){let y,A;if(i instanceof f.Point||"number"==typeof i[0]){const T=f.Point.convert(i);y=[T],A=g.isPointAboveHorizon(T)}else{const T=f.Point.convert(i[0]),N=f.Point.convert(i[1]);y=[T,N],A=f.polygonizeBounds(T,N).every(k=>g.isPointAboveHorizon(k))}return new Ir(y,g.getCameraPoint(),A,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const g=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.Point(1,1)):this.screenBounds[1],A=f.polygonizeBounds(g,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<y.x?A.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?A[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(A[3]=this.cameraPoint)),f.bufferConvexPolygon(A,i)}bufferedCameraGeometryGlobe(i){const g=this.screenBounds[0],y=1===this.screenBounds.length?this.screenBounds[0].add(new f.Point(1,1)):this.screenBounds[1],A=f.polygonizeBounds(g,y,i),T=this.cameraPoint.clone();switch(3*((T.y>g.y)+(T.y>y.y))+((T.x>g.x)+(T.x>y.x))){case 0:A[0]=T,A[4]=T.clone();break;case 1:A.splice(1,0,T);break;case 2:A[1]=T;break;case 3:A.splice(4,0,T);break;case 5:A.splice(2,0,T);break;case 6:A[3]=T;break;case 7:A.splice(3,0,T);break;case 8:A[2]=T}return A}containsTile(i,g,y,A=0){const T=i.queryPadding/g._pixelsPerMercatorPixel+1,N=y?this._bufferedCameraMercator(T,g):this._bufferedScreenMercator(T,g);let k=i.tileID.wrap+(N.unwrapped?A:0);const H=N.polygon.map(Me=>f.getTilePoint(i.tileTransform,Me,k));if(!f.polygonIntersectsBox(H,0,0,f.EXTENT,f.EXTENT))return;k=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?A:0);const Q=this.screenGeometryMercator.polygon.map(Me=>f.getTileVec3(i.tileTransform,Me,k)),J=Q.map(Me=>new f.Point(Me[0],Me[1])),de=g.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),ye=f.getTileVec3(i.tileTransform,de,k),Ae=Q.map(Me=>{const he=f.sub(Me,Me,ye);return f.normalize(he,he),new f.Ray(ye,he)}),we=Ln(i,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:J,tilespaceRays:Ae,bufferedTilespaceGeometry:H,bufferedTilespaceBounds:(Se=f.getBounds(H),Se.min.x=f.clamp(Se.min.x,0,f.EXTENT),Se.min.y=f.clamp(Se.min.y,0,f.EXTENT),Se.max.x=f.clamp(Se.max.x,0,f.EXTENT),Se.max.y=f.clamp(Se.max.y,0,f.EXTENT),Se),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:we};var Se}_bufferedScreenMercator(i,g){const y=Zt(i);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let A;return A="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),g):{polygon:this.bufferedScreenGeometry(i).map(T=>g.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=A,A}}_bufferedCameraMercator(i,g){const y=Zt(i);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let A;return A="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),g):{polygon:this.bufferedCameraGeometry(i).map(T=>g.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=A,A}}_projectAndResample(i,g){const y=function(T,N){const k=f.multiply([],N.pixelMatrix,N.globeMatrix),H=[0,-f.GLOBE_RADIUS,0,1],Q=[0,f.GLOBE_RADIUS,0,1],J=[0,0,0,1];f.transformMat4$1(H,H,k),f.transformMat4$1(Q,Q,k),f.transformMat4$1(J,J,k);const de=new f.Point(H[0]/H[3],H[1]/H[3]),ye=new f.Point(Q[0]/Q[3],Q[1]/Q[3]),Ae=f.polygonContainsPoint(T,de)&&H[3]<J[3],we=f.polygonContainsPoint(T,ye)&&Q[3]<J[3];if(!Ae&&!we)return null;const Se=function(nt,vt,pt){for(let Lt=1;Lt<nt.length;Lt++){const En=Nt(vt.pointCoordinate3D(nt[Lt-1]).x),Ot=Nt(vt.pointCoordinate3D(nt[Lt]).x);if(pt<0){if(En<Ot)return{idx:Lt,t:-En/(Ot-1-En)}}else if(Ot<En)return{idx:Lt,t:(1-En)/(Ot+1-En)}}return null}(T,N,Ae?-1:1);if(!Se)return null;const{idx:Me,t:he}=Se;let Te=Me>1?At(T.slice(0,Me),N):[],Be=Me<T.length?At(T.slice(Me),N):[];Te=Te.map(nt=>new f.Point(Nt(nt.x),nt.y)),Be=Be.map(nt=>new f.Point(Nt(nt.x),nt.y));const Ve=[...Te];0===Ve.length&&Ve.push(Be[Be.length-1]);const tt=f.number(Ve[Ve.length-1].y,(0===Be.length?Te[0]:Be[0]).y,he);let Qe;return Qe=Ae?[new f.Point(0,tt),new f.Point(0,0),new f.Point(1,0),new f.Point(1,tt)]:[new f.Point(1,tt),new f.Point(1,1),new f.Point(0,1),new f.Point(0,tt)],Ve.push(...Qe),0===Be.length?Ve.push(Te[0]):Ve.push(...Be),{polygon:Ve.map(nt=>new f.MercatorCoordinate(nt.x,nt.y)),unwrapped:!1}}(i,g);if(y)return y;const A=function(T,N){let k=!1,H=-1/0,Q=0;for(let de=0;de<T.length-1;de++)T[de].x>H&&(H=T[de].x,Q=de);for(let de=0;de<T.length-1;de++){const ye=(Q+de)%(T.length-1),Ae=T[ye],we=T[ye+1];Math.abs(Ae.x-we.x)>.5&&(Ae.x<we.x?(Ae.x+=1,0===ye&&(T[T.length-1].x+=1)):(we.x+=1,ye+1===T.length-1&&(T[0].x+=1)),k=!0)}const J=f.mercatorXfromLng(N.center.lng);return k&&J<Math.abs(J-1)&&T.forEach(de=>{de.x-=1}),{polygon:T,unwrapped:k}}(At(i,g).map(T=>new f.Point(Nt(T.x),T.y)),g);return{polygon:A.polygon.map(T=>new f.MercatorCoordinate(T.x,T.y)),unwrapped:A.unwrapped}}}function At(_,i){return f.resample(_,g=>{const y=i.pointCoordinate3D(g);g.x=y.x,g.y=y.y},1/256)}function Nt(_){return _<0?1+_%1:_%1}function Zt(_){return 100*_|0}function mt(_,i,g,y,A){const T=function(N,k){if(N)return A(N);if(k){_.url&&k.tiles&&_.tiles&&delete _.tiles;const H=f.pick(f.extend(k,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(H.vectorLayers=k.vector_layers,H.vectorLayerIds=H.vectorLayers.map(Q=>Q.id)),H.tiles=i.canonicalizeTileset(H,_.url),A(null,H)}};return _.url?f.getJSON(i.transformRequest(i.normalizeSourceURL(_.url,null,g,y),f.ResourceType.Source),T):f.exported.frame(()=>T(null,_))}class rn{constructor(i,g,y){this.bounds=f.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=g||0,this.maxzoom=y||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const g=Math.pow(2,i.z),y=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*g),A=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*g),T=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*g),N=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*g);return i.x>=y&&i.x<T&&i.y>=A&&i.y<N}}class _n{constructor(i,g,y){this.context=i;const A=i.gl;this.buffer=A.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qn{constructor(i,g,y,A){this.length=g.length,this.attributes=y,this.itemSize=g.bytesPerElement,this.dynamicDraw=A,this.context=i;const T=i.gl;this.buffer=T.createBuffer(),i.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,g){for(let y=0;y<this.attributes.length;y++){const A=g.attributes[this.attributes[y].name];void 0!==A&&i.enableVertexAttribArray(A)}}setVertexAttribPointers(i,g,y){for(let A=0;A<this.attributes.length;A++){const T=this.attributes[A],N=g.attributes[T.name];void 0!==N&&i.vertexAttribPointer(N,T.components,i[gr[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ir extends tr{getDefault(){return f.Color.transparent}set(i){const g=this.current;(i.r!==g.r||i.g!==g.g||i.b!==g.b||i.a!==g.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class nn extends tr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Oi extends tr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Gn extends tr{getDefault(){return[!0,!0,!0,!0]}set(i){const g=this.current;(i[0]!==g[0]||i[1]!==g[1]||i[2]!==g[2]||i[3]!==g[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Pi extends tr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class vi extends tr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class qr extends tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const g=this.current;(i.func!==g.func||i.ref!==g.ref||i.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ci extends tr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const g=this.current;(i[0]!==g[0]||i[1]!==g[1]||i[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ni extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;i?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=i,this.dirty=!1}}class fr extends tr{getDefault(){return[0,1]}set(i){const g=this.current;(i[0]!==g[0]||i[1]!==g[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ai extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;i?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=i,this.dirty=!1}}class wr extends tr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Pr extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;i?g.enable(g.BLEND):g.disable(g.BLEND),this.current=i,this.dirty=!1}}class xi extends tr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const g=this.current;(i[0]!==g[0]||i[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class _r extends tr{getDefault(){return f.Color.transparent}set(i){const g=this.current;(i.r!==g.r||i.g!==g.g||i.b!==g.b||i.a!==g.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Rr extends tr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class ur extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;i?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=i,this.dirty=!1}}class Mo extends tr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ho extends tr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let qt,Xi=class extends tr{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class si extends tr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class po extends tr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const g=this.current;(i[0]!==g[0]||i[1]!==g[1]||i[2]!==g[2]||i[3]!==g[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Jr extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class wo extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class nr extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Bs extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ue extends tr{getDefault(){return null}set(i){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ge extends tr{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class ve extends tr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Re extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Oe extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class rt extends tr{constructor(i,g){super(i),this.context=i,this.parent=g}getDefault(){return null}}class wt extends rt{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class st extends rt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ye extends st{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Dt{constructor(i,g,y,A){this.context=i,this.width=g,this.height=y;const T=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new wt(i,T),A&&(this.depthAttachment=new st(i,T))}destroy(){const i=this.context.gl,g=this.colorAttachment.get();if(g&&i.deleteTexture(g),this.depthAttachment){const y=this.depthAttachment.get();y&&i.deleteRenderbuffer(y)}i.deleteFramebuffer(this.framebuffer)}}class pn{constructor(i,g=!1){if(this.gl=i,this.isWebGL2=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),g){const y=i;this.extVertexArrayObject={createVertexArrayOES:y.createVertexArray.bind(i),deleteVertexArrayOES:y.deleteVertexArray.bind(i),bindVertexArrayOES:y.bindVertexArray.bind(i)}}this.clearColor=new ir(this),this.clearDepth=new nn(this),this.clearStencil=new Oi(this),this.colorMask=new Gn(this),this.depthMask=new Pi(this),this.stencilMask=new vi(this),this.stencilFunc=new qr(this),this.stencilOp=new Ci(this),this.stencilTest=new Ni(this),this.depthRange=new fr(this),this.depthTest=new Ai(this),this.depthFunc=new wr(this),this.blend=new Pr(this),this.blendFunc=new xi(this),this.blendColor=new _r(this),this.blendEquation=new Rr(this),this.cullFace=new ur(this),this.cullFaceSide=new Mo(this),this.frontFace=new Ho(this),this.program=new Xi(this),this.activeTexture=new si(this),this.viewport=new po(this),this.bindFramebuffer=new Jr(this),this.bindRenderbuffer=new wo(this),this.bindTexture=new nr(this),this.bindVertexBuffer=new Bs(this),this.bindElementBuffer=new Ue(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ge(this),this.pixelStoreUnpack=new ve(this),this.pixelStoreUnpackPremultiplyAlpha=new Re(this),this.pixelStoreUnpackFlipY=new Oe(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),g||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(g||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=g||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,g){return new _n(this,i,g)}createVertexBuffer(i,g,y){return new Qn(this,i,g,y)}createRenderbuffer(i,g,y){const A=this.gl,T=A.createRenderbuffer();return this.bindRenderbuffer.set(T),A.renderbufferStorage(A.RENDERBUFFER,i,g,y),this.bindRenderbuffer.set(null),T}createFramebuffer(i,g,y){return new Dt(this,i,g,y)}clear({color:i,depth:g,stencil:y}){const A=this.gl;let T=0;i&&(T|=A.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(T|=A.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==y&&(T|=A.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),A.clear(T)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){ze(i.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Mn extends f.Evented{constructor(i,g,y,A){if(super(),this.id=i,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(g,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(i){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"}));const g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=mt(this._options,this.map._requestManager,g,y,(A,T)=>{this._tileJSONRequest=null,this._loaded=!0,A?(g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),y&&2!==y.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new f.ErrorEvent(A))):T&&(f.extend(this,T),T.bounds&&(this.tileBounds=new rn(T.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(T.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(A)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.extend({},this._options)}loadTile(i,g){const y=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(y,f.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(A.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=g:i.request=i.actor.send("reloadTile",A,T.bind(this));else if(i.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",A,T.bind(this),void 0,!0);else{const N=f.loadVectorTile.call({deduped:this._deduped},A,(k,H)=>{k||!H?T.call(this,k):(A.data={cacheControl:H.cacheControl,expires:H.expires,rawData:H.rawData.slice(0)},i.actor&&i.actor.send("loadTile",A,T.bind(this),void 0,!0))},!0);i.request={cancel:N}}function T(N,k){return delete i.request,i.aborted?g(null):N&&404!==N.status?g(N):(k&&k.resourceTiming&&(i.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&i.setExpiryData(k),i.loadVectorData(k,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ze extends f.Evented{constructor(i,g,y,A){super(),this.id=i,this.dispatcher=y,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},g),f.extend(this,f.pick(g,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=mt(this._options,this.map._requestManager,null,null,(g,y)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new f.ErrorEvent(g)):y&&(f.extend(this,y),y.bounds&&(this.tileBounds=new rn(y.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(y.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(g)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return f.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,g){const y=f.exported.devicePixelRatio>=2,A=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);i.request=f.getImage(this.map._requestManager.transformRequest(A,f.ResourceType.Tile),(T,N,k,H)=>(delete i.request,i.aborted?(i.state="unloaded",g(null)):T?(i.state="errored",g(T)):N?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:k,expires:H}),i.setTexture(N,this.map.painter),i.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(i,g,y){i.setTexture(g,y)}static unloadTileData(i,g){i.texture&&g.saveTileTexture(i.texture)}abortTile(i,g){i.request&&(i.request.cancel(),delete i.request),g()}unloadTile(i,g){i.texture&&this.map.painter.saveTileTexture(i.texture),g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function lt(_,i,g,y,A,T,N,k){const H=[_,g,A,i,y,T,1,1,1],Q=[N,k,1],J=f.adjoint([],H),[de,ye,Ae]=f.transformMat3(Q,Q,f.transpose(J,J));return f.multiply$1(H,[de,0,0,0,ye,0,0,0,Ae],H)}class De extends f.Evented{constructor(i,g,y,A){super(),this.id=i,this.dispatcher=y,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=g,this._dirty=!1}load(i,g){this._loaded=g||!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(y,A)=>{if(this._imageRequest=null,this._loaded=!0,y)this.fire(new f.ErrorEvent(y));else if(A){const{HTMLImageElement:T}=f.window;this.image=A instanceof T?f.exported.getImageData(A):A,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const g=i.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let A=1/0,T=1/0,N=-1/0,k=-1/0;for(const de of y)A=Math.min(A,de.x),T=Math.min(T,de.y),N=Math.max(N,de.x),k=Math.max(k,de.y);const H=Math.max(N-A,k-T),Q=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),J=Math.pow(2,Q);return new f.CanonicalTileID(Q,Math.floor((A+N)/2*J),Math.floor((T+k)/2*J))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const H in this.tiles){const Q=this.tiles[H];"loaded"!==Q.state&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray)return;const g=f.tileTransform(this.tileID,this.map.transform.projection),[y,A,T,N]=this.coordinates.map(H=>{const Q=g.projection.project(H[0],H[1]);return f.getTilePoint(g,Q)._round()});this.perspectiveTransform=function(H,Q,J,de,ye,Ae,we,Se,Me,he){const Te=lt(0,0,H,0,0,Q,H,Q),Be=lt(J,de,ye,Ae,we,Se,Me,he);return f.multiply$1(Be,f.adjoint(Te,Te),Be),[Be[6]/Be[8]*H/f.EXTENT,Be[7]/Be[8]*Q/f.EXTENT]}(this.width,this.height,y.x,y.y,A.x,A.y,N.x,N.y,T.x,T.y);const k=this._boundsArray=new f.StructArrayLayout4i8;k.emplaceBack(y.x,y.y,0,0),k.emplaceBack(A.x,A.y,f.EXTENT,0),k.emplaceBack(N.x,N.y,0,f.EXTENT),k.emplaceBack(T.x,T.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(k,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,g=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new f.Texture(i,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,g){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},g(null)):(i.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ke={vector:Mn,raster:Ze,"raster-dem":class extends Ze{constructor(_,i,g,y){super(_,i,g,y),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(_,i){const g=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(A,T){A&&(_.state="errored",i(A)),T&&(_.dem=T,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",i(null))}_.request=f.getImage(this.map._requestManager.transformRequest(g,f.ResourceType.Tile),function(A,T,N,k){if(delete _.request,_.aborted)_.state="unloaded",i(null);else if(A)_.state="errored",i(A);else if(T){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:N,expires:k});const H=f.window.ImageBitmap&&T instanceof f.window.ImageBitmap&&(null==qt&&(qt=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),qt),Q=1-(T.width-f.prevPowerOfTwo(T.width))/2;Q<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const J=H?T:f.exported.getImageData(T,Q),de={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:J,encoding:this.encoding,padding:Q};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",de,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const i=_.canonical,g=Math.pow(2,i.z),y=(i.x-1+g)%g,A=0===i.x?_.wrap-1:_.wrap,T=(i.x+1+g)%g,N=i.x+1===g?_.wrap+1:_.wrap,k={};return k[new f.OverscaledTileID(_.overscaledZ,A,i.z,y,i.y).key]={backfilled:!1},k[new f.OverscaledTileID(_.overscaledZ,N,i.z,T,i.y).key]={backfilled:!1},i.y>0&&(k[new f.OverscaledTileID(_.overscaledZ,A,i.z,y,i.y-1).key]={backfilled:!1},k[new f.OverscaledTileID(_.overscaledZ,_.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},k[new f.OverscaledTileID(_.overscaledZ,N,i.z,T,i.y-1).key]={backfilled:!1}),i.y+1<g&&(k[new f.OverscaledTileID(_.overscaledZ,A,i.z,y,i.y+1).key]={backfilled:!1},k[new f.OverscaledTileID(_.overscaledZ,_.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},k[new f.OverscaledTileID(_.overscaledZ,N,i.z,T,i.y+1).key]={backfilled:!1}),k}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends f.Evented{constructor(_,i,g,y){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(y),this._data=i.data,this._options=f.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const A=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*A,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*A,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*A,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},i),this}getClusterChildren(_,i){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},i),this}getClusterLeaves(_,i,g,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:i,offset:g},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=f.extend({},this.workerOptions),i=this._data;"string"==typeof i?(_.request=this.map._requestManager.transformRequest(f.exported.resolveURL(i),f.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(g,y)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new f.ErrorEvent(g));else{const A={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(A.resourceTiming=y.resourceTiming[this.id]),this.fire(new f.Event("data",A)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,i){const g=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(g,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,A)=>(delete _.request,_.unloadVectorData(),_.aborted?i(null):y?i(y):(_.loadVectorData(A,this.map.painter,"reloadTile"===g),i(null))),void 0,"loadTile"===g)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends De{constructor(_,i,g,y){super(_,i,g,y),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const i of _.urls)this.urls.push(this.map._requestManager.transformRequest(i,f.ResourceType.Source).url);f.getVideo(this.urls,(i,g)=>{this._loaded=!0,i?this.fire(new f.ErrorEvent(i)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const i=this.video.seekable;_<i.start(0)||_>i.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,i=_.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(_,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:De,canvas:class extends De{constructor(_,i,g,y){super(_,i,g,y),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(A=>!Array.isArray(A)||2!==A.length||A.some(T=>"number"!=typeof T))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends f.Evented{constructor(_,i,g,y){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=i,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new rn(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:i,y:g,z:y}=_.canonical;return this._implementation.hasTile({x:i,y:g,z:y})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,i){const{x:g,y,z:A}=_.tileID.canonical,T=new f.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:g,y,z:A},{signal:T.signal})).then(function(N){return delete _.request,_.aborted?(_.state="unloaded",i(null)):void 0===N?(_.state="errored",i(null)):null===N?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",i(null)):(k=N)instanceof f.window.ImageData||k instanceof f.window.HTMLCanvasElement||k instanceof f.window.ImageBitmap||k instanceof f.window.HTMLImageElement?(this.loadTileData(_,N),_.state="loaded",void i(null)):(_.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(N=>{20!==N.code&&(_.state="errored",i(N))}),_.request.cancel=()=>T.abort()}loadTileData(_,i){Ze.loadTileData(_,i,this._map.painter)}unloadTileData(_){Ze.unloadTileData(_,this._map.painter)}unloadTile(_,i){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:g,y,z:A}=_.tileID.canonical;this._implementation.unloadTile({x:g,y,z:A})}i()}abortTile(_,i){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Tt=function(_,i,g,y){const A=new Ke[i.type](_,i,g,y);if(A.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${A.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],A),A};function xn(_,i){const g=f.identity([]);return f.scale(g,g,[.5*_.width,.5*-_.height,1]),f.translate(g,g,[1,-1,0]),f.multiply(g,g,_.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(g)}function Bn(_,i,g,y,A,T,N,k=!1){const H=_.tilesIn(y,N,k);H.sort(Lr);const Q=[];for(const de of H)Q.push({wrappedTileID:de.tile.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(i,g,_._state,de,A,T,xn(_.transform,de.tile.tileID),k)});const J=function(de){const ye={},Ae={};for(const we of de){const Se=we.queryResults,Me=we.wrappedTileID,he=Ae[Me]=Ae[Me]||{};for(const Te in Se){const Be=Se[Te],Ve=he[Te]=he[Te]||{},tt=ye[Te]=ye[Te]||[];for(const Qe of Be)Ve[Qe.featureIndex]||(Ve[Qe.featureIndex]=!0,tt.push(Qe))}}return ye}(Q);for(const de in J)J[de].forEach(ye=>{const Ae=ye.feature,we=Ae.layer;we&&"background"!==we.type&&"sky"!==we.type&&(Ae.source=we.source,we["source-layer"]&&(Ae.sourceLayer=we["source-layer"]),Ae.state=void 0!==Ae.id?_.getFeatureState(we["source-layer"],Ae.id):{})});return J}function Mr(_,i){const g=_.getRenderableIds().map(T=>_.getTileByID(T)),y=[],A={};for(let T=0;T<g.length;T++){const N=g[T],k=N.tileID.canonical.key;A[k]||(A[k]=!0,N.querySourceFeatures(y,i))}return y}function Lr(_,i){const g=_.tileID,y=i.tileID;return g.overscaledZ-y.overscaledZ||g.canonical.y-y.canonical.y||g.wrap-y.wrap||g.canonical.x-y.canonical.x}function hi(){return null!=se.workerClass?new se.workerClass:new f.window.Worker(se.workerUrl)}const zi="mapboxgl_preloaded_worker_pool";class Ji{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Ji.workerCount;)this.workers.push(new hi);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zi]}numActive(){return Object.keys(this.active).length}}let _t;function Je(){return _t||(_t=new Ji),_t}function ct(_,i){const g={};for(const y in _)"ref"!==y&&(g[y]=_[y]);return f.refProperties.forEach(y=>{y in i&&(g[y]=i[y])}),g}function an(_){_=_.slice();const i=Object.create(null);for(let g=0;g<_.length;g++)i[_[g].id]=_[g];for(let g=0;g<_.length;g++)"ref"in _[g]&&(_[g]=ct(_[g],i[_[g].ref]));return _}Ji.workerCount=2;const en={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function In(_,i,g){g.push({command:en.addSource,args:[_,i[_]]})}function zn(_,i,g){i.push({command:en.removeSource,args:[_]}),g[_]=!0}function br(_,i,g,y){zn(_,g,y),In(_,i,g)}function Sr(_,i,g){let y;for(y in _[g])if(_[g].hasOwnProperty(y)&&"data"!==y&&!ze(_[g][y],i[g][y]))return!1;for(y in i[g])if(i[g].hasOwnProperty(y)&&"data"!==y&&!ze(_[g][y],i[g][y]))return!1;return!0}function Ui(_,i,g,y,A,T){let N;for(N in i=i||{},_=_||{})_.hasOwnProperty(N)&&(ze(_[N],i[N])||g.push({command:T,args:[y,N,i[N],A]}));for(N in i)i.hasOwnProperty(N)&&!_.hasOwnProperty(N)&&(ze(_[N],i[N])||g.push({command:T,args:[y,N,i[N],A]}))}function Fi(_){return _.id}function _o(_,i){return _[i.id]=i,_}class Jo{constructor(i,g){this.reset(i,g)}reset(i,g){this.points=i||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=f.clamp(i,0,1);let g=1,y=this._distances[g];const A=i*this.paddedLength+this.padding;for(;y<A&&g<this._distances.length;)y=this._distances[++g];const T=g-1,N=this._distances[T],k=y-N,H=k>0?(A-N)/k:0;return this.points[T].mult(1-H).add(this.points[g].mult(H))}}class Vi{constructor(i,g,y){const A=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(i/y),this.yCellCount=Math.ceil(g/y);for(let N=0;N<this.xCellCount*this.yCellCount;N++)A.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=g,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,g,y,A,T){this._forEachCell(g,y,A,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(A),this.bboxes.push(T)}insertCircle(i,g,y,A){this._forEachCell(g-A,y-A,g+A,y+A,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(g),this.circles.push(y),this.circles.push(A)}_insertBoxCell(i,g,y,A,T,N){this.boxCells[T].push(N)}_insertCircleCell(i,g,y,A,T,N){this.circleCells[T].push(N)}_query(i,g,y,A,T,N){if(y<0||i>this.width||A<0||g>this.height)return!T&&[];const k=[];if(i<=0&&g<=0&&this.width<=y&&this.height<=A){if(T)return!0;for(let H=0;H<this.boxKeys.length;H++)k.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const Q=this.circles[3*H],J=this.circles[3*H+1],de=this.circles[3*H+2];k.push({key:this.circleKeys[H],x1:Q-de,y1:J-de,x2:Q+de,y2:J+de})}return N?k.filter(N):k}return this._forEachCell(i,g,y,A,this._queryCell,k,{hitTest:T,seenUids:{box:{},circle:{}}},N),T?k.length>0:k}_queryCircle(i,g,y,A,T){const N=i-y,k=i+y,H=g-y,Q=g+y;if(k<0||N>this.width||Q<0||H>this.height)return!A&&[];const J=[];return this._forEachCell(N,H,k,Q,this._queryCellCircle,J,{hitTest:A,circle:{x:i,y:g,radius:y},seenUids:{box:{},circle:{}}},T),A?J.length>0:J}query(i,g,y,A,T){return this._query(i,g,y,A,!1,T)}hitTest(i,g,y,A,T){return this._query(i,g,y,A,!0,T)}hitTestCircle(i,g,y,A){return this._queryCircle(i,g,y,!0,A)}_queryCell(i,g,y,A,T,N,k,H){const Q=k.seenUids,J=this.boxCells[T];if(null!==J){const ye=this.bboxes;for(const Ae of J)if(!Q.box[Ae]){Q.box[Ae]=!0;const we=4*Ae;if(i<=ye[we+2]&&g<=ye[we+3]&&y>=ye[we+0]&&A>=ye[we+1]&&(!H||H(this.boxKeys[Ae]))){if(k.hitTest)return N.push(!0),!0;N.push({key:this.boxKeys[Ae],x1:ye[we],y1:ye[we+1],x2:ye[we+2],y2:ye[we+3]})}}}const de=this.circleCells[T];if(null!==de){const ye=this.circles;for(const Ae of de)if(!Q.circle[Ae]){Q.circle[Ae]=!0;const we=3*Ae;if(this._circleAndRectCollide(ye[we],ye[we+1],ye[we+2],i,g,y,A)&&(!H||H(this.circleKeys[Ae]))){if(k.hitTest)return N.push(!0),!0;{const Se=ye[we],Me=ye[we+1],he=ye[we+2];N.push({key:this.circleKeys[Ae],x1:Se-he,y1:Me-he,x2:Se+he,y2:Me+he})}}}}}_queryCellCircle(i,g,y,A,T,N,k,H){const Q=k.circle,J=k.seenUids,de=this.boxCells[T];if(null!==de){const Ae=this.bboxes;for(const we of de)if(!J.box[we]){J.box[we]=!0;const Se=4*we;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,Ae[Se+0],Ae[Se+1],Ae[Se+2],Ae[Se+3])&&(!H||H(this.boxKeys[we])))return N.push(!0),!0}}const ye=this.circleCells[T];if(null!==ye){const Ae=this.circles;for(const we of ye)if(!J.circle[we]){J.circle[we]=!0;const Se=3*we;if(this._circlesCollide(Ae[Se],Ae[Se+1],Ae[Se+2],Q.x,Q.y,Q.radius)&&(!H||H(this.circleKeys[we])))return N.push(!0),!0}}}_forEachCell(i,g,y,A,T,N,k,H){const Q=this._convertToXCellCoord(i),J=this._convertToYCellCoord(g),de=this._convertToXCellCoord(y),ye=this._convertToYCellCoord(A);for(let Ae=Q;Ae<=de;Ae++)for(let we=J;we<=ye;we++)if(T.call(this,i,g,y,A,this.xCellCount*we+Ae,N,k,H))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,g,y,A,T,N){const k=A-i,H=T-g,Q=y+N;return Q*Q>k*k+H*H}_circleAndRectCollide(i,g,y,A,T,N,k){const H=(N-A)/2,Q=Math.abs(i-(A+H));if(Q>H+y)return!1;const J=(k-T)/2,de=Math.abs(g-(T+J));if(de>J+y)return!1;if(Q<=H||de<=J)return!0;const ye=Q-H,Ae=de-J;return ye*ye+Ae*Ae<=y*y}}const ro={unknown:0,flipRequired:1,flipNotRequired:2},yi=Math.tan(85*Math.PI/180);function Et(_,i,g,y,A,T,N){const k=f.create();if(g)if("globe"===T.name){const H=f.calculateGlobeLabelMatrix(A,i);f.multiply(k,k,H)}else{const H=gt([],N);k[0]=H[0],k[1]=H[1],k[4]=H[2],k[5]=H[3],y||f.rotateZ(k,k,A.angle)}else f.multiply(k,A.labelPlaneMatrix,_);return k}function vr(_,i,g,y,A,T,N){const k=Et(_,i,g,y,A,T,N);return"globe"===T.name&&g||(k[2]=k[6]=k[10]=k[14]=0),k}function Cr(_,i,g,y,A,T,N){if(g){if("globe"===T.name){const k=Et(_,i,g,y,A,T,N);return f.invert(k,k),f.multiply(k,_,k),k}{const k=f.clone(_),H=f.identity([]);return H[0]=N[0],H[1]=N[1],H[4]=N[2],H[5]=N[3],f.multiply(k,k,H),y||f.rotateZ(k,k,-A.angle),k}}return A.glCoordMatrix}function ai(_,i,g,y){const A=[_,i,g,1];g?f.transformMat4$1(A,A,y):Vr(A,A,y);const T=A[3];return A[0]/=T,A[1]/=T,A[2]/=T,A}function Gs(_,i){return Math.min(.5+_/i*.5,1.5)}function Zn(_,i){const g=_[0]/_[3],y=_[1]/_[3];return g>=-i[0]&&g<=i[0]&&y>=-i[1]&&y<=i[1]}function ka(_,i,g,y,A,T,N,k,H,Q){const J=g.transform,de=y?_.textSizeData:_.iconSizeData,ye=f.evaluateSizeForZoom(de,g.transform.zoom),Ae="globe"===J.projection.name,we=[256/g.width*2+1,256/g.height*2+1],Se=y?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Se.clear();let Me=null;Ae&&(Me=y?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const he=_.lineVertexArray,Te=y?_.text.placedSymbolArray:_.icon.placedSymbolArray,Be=g.transform.width/g.transform.height;let Ve,tt=!1;for(let Qe=0;Qe<Te.length;Qe++){const nt=Te.get(Qe),{numGlyphs:vt,writingMode:pt}=nt;if(pt!==f.WritingMode.vertical||tt||Ve===f.WritingMode.horizontal||(tt=!0),Ve=pt,(nt.hidden||pt===f.WritingMode.vertical)&&!tt){ws(vt,Se);continue}tt=!1;const Lt=new f.Point(nt.tileAnchorX,nt.tileAnchorY);let{x:En,y:Ot,z:sn}=J.projection.projectTilePoint(Lt.x,Lt.y,Q.canonical);if(H){const[Kr,sr,Nr]=H(Lt);En+=Kr,Ot+=sr,sn+=Nr}const jt=[En,Ot,sn,1];if(f.transformMat4$1(jt,jt,i),!Zn(jt,we)){ws(vt,Se);continue}const yn=Gs(g.transform.cameraToCenterDistance,jt[3]),It=f.evaluateSizeForFeature(de,ye,nt),on=N?It/yn:It*yn,Cn=ai(En,Ot,sn,A);if(Cn[3]<=0){ws(vt,Se);continue}let gn={};const An=N?null:H,Er=Fn(nt,on,!1,k,i,A,T,_.glyphOffsetArray,he,Se,Me,Cn,Lt,gn,Be,An,J.projection,Q,N);tt=Er.useVertical,An&&Er.needsFlipping&&(gn={}),(Er.notEnoughRoom||tt||Er.needsFlipping&&Fn(nt,on,!0,k,i,A,T,_.glyphOffsetArray,he,Se,Me,Cn,Lt,gn,Be,An,J.projection,Q,N).notEnoughRoom)&&ws(vt,Se)}y?(_.text.dynamicLayoutVertexBuffer.updateData(Se),Me&&_.text.globeExtVertexBuffer.updateData(Me)):(_.icon.dynamicLayoutVertexBuffer.updateData(Se),Me&&_.icon.globeExtVertexBuffer.updateData(Me))}function Go(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se){const{lineStartIndex:Me,glyphStartIndex:he,segment:Te}=k,Be=he+k.numGlyphs,Ve=Me+k.lineLength,tt=i.getoffsetX(he),Qe=i.getoffsetX(Be-1),nt=bo(_*tt,g,y,A,T,N,Te,Me,Ve,H,Q,J,de,ye,!0,Ae,we,Se);if(!nt)return null;const vt=bo(_*Qe,g,y,A,T,N,Te,Me,Ve,H,Q,J,de,ye,!0,Ae,we,Se);return vt?{first:nt,last:vt}:null}function Qs(_,i,g,y){return _===f.WritingMode.horizontal&&Math.abs(y)>Math.abs(g)?{useVertical:!0}:_===f.WritingMode.vertical?y>0?{needsFlipping:!0}:null:i!==ro.unknown&&(0===(A=g)||Math.abs(y/A)>yi)?i===ro.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null;var A}function Fn(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se,Me,he,Te){const Be=i/24,Ve=_.lineOffsetX*Be,tt=_.lineOffsetY*Be,{lineStartIndex:Qe,glyphStartIndex:nt,numGlyphs:vt,segment:pt,writingMode:Lt,flipState:En}=_,Ot=Qe+_.lineLength,sn=jt=>{if(J){const[Cn,gn,An]=jt.up,Er=Q.length;f.updateGlobeVertexNormal(J,Er+0,Cn,gn,An),f.updateGlobeVertexNormal(J,Er+1,Cn,gn,An),f.updateGlobeVertexNormal(J,Er+2,Cn,gn,An),f.updateGlobeVertexNormal(J,Er+3,Cn,gn,An)}const[yn,It,on]=jt.point;f.addDynamicAttributes(Q,yn,It,on,jt.angle)};if(vt>1){const jt=Go(Be,k,Ve,tt,g,de,ye,_,H,T,Ae,Se,!1,Me,he,Te);if(!jt)return{notEnoughRoom:!0};if(y&&!g){let[yn,It,on]=jt.first.point,[Cn,gn,An]=jt.last.point;[yn,It]=ai(yn,It,on,N),[Cn,gn]=ai(Cn,gn,An,N);const Er=Qs(Lt,En,(Cn-yn)*we,gn-It);if(_.flipState=Er&&Er.needsFlipping?ro.flipRequired:ro.flipNotRequired,Er)return Er}sn(jt.first);for(let yn=nt+1;yn<nt+vt-1;yn++){const It=bo(Be*k.getoffsetX(yn),Ve,tt,g,de,ye,pt,Qe,Ot,H,T,Ae,Se,!1,!1,Me,he,Te);if(!It)return Q.length-=4*(yn-nt),{notEnoughRoom:!0};sn(It)}sn(jt.last)}else{if(y&&!g){const yn=ai(ye.x,ye.y,0,A),It=Qe+pt+1,on=new f.Point(H.getx(It),H.gety(It)),Cn=ai(on.x,on.y,0,A),gn=Cn[3]>0?Cn:kr(ye,on,yn,1,A,void 0,Me,he.canonical),An=Qs(Lt,En,(gn[0]-yn[0])*we,gn[1]-yn[1]);if(_.flipState=An&&An.needsFlipping?ro.flipRequired:ro.flipNotRequired,An)return An}const jt=bo(Be*k.getoffsetX(nt),Ve,tt,g,de,ye,pt,Qe,Ot,H,T,Ae,Se,!1,!1,Me,he,Te);if(!jt)return{notEnoughRoom:!0};sn(jt)}return{}}function Hr(_,i,g,y,A){const{x:T,y:N,z:k}=y.projectTilePoint(_.x,_.y,i);if(!A)return ai(T,N,k,g);const[H,Q,J]=A(_);return ai(T+H,N+Q,k+J,g)}function kr(_,i,g,y,A,T,N,k){const H=Hr(_.sub(i)._unit()._add(_),k,A,N,T);return f.sub(H,g,H),f.normalize(H,H),f.scaleAndAdd(H,g,H,y)}function bo(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se,Me,he){const Te=y?_-i:_+i;let Be=Te>0?1:-1,Ve=0;y&&(Be*=-1,Ve=Math.PI),Be<0&&(Ve+=Math.PI);let tt=k+N+(Be>0?0:1)|0,Qe=A,nt=A,vt=0,pt=0;const Lt=Math.abs(Te),En=[],Ot=[];let sn=T,jt=sn;const yn=()=>kr(jt,sn,nt,Lt-vt+1,J,ye,Se,Me.canonical);for(;vt+pt<=Lt;){if(tt+=Be,tt<k||tt>=H)return null;if(nt=Qe,jt=sn,En.push(nt),Ae&&Ot.push(jt),sn=new f.Point(Q.getx(tt),Q.gety(tt)),Qe=de[tt],!Qe){const Nr=Hr(sn,Me.canonical,J,Se,ye);Qe=Nr[3]>0?de[tt]=Nr:yn()}vt+=pt,pt=f.distance(nt,Qe)}we&&ye&&(de[tt]&&(Qe=yn(),pt=f.distance(nt,Qe)),de[tt]=Qe);const It=(Lt-vt)/pt,on=sn.sub(jt)._mult(It)._add(jt),Cn=f.sub([],Qe,nt),gn=f.scaleAndAdd([],nt,Cn,It);let An=[0,0,1],Er=Cn[0],Kr=Cn[1];if(he&&(An=Se.upVector(Me.canonical,on.x,on.y),0!==An[0]||0!==An[1]||1!==An[2])){const Nr=[An[2],0,-An[0]],_i=f.cross([],An,Nr);f.normalize(Nr,Nr),f.normalize(_i,_i),Er=f.dot(Cn,Nr),Kr=f.dot(Cn,_i)}if(g){const Nr=f.cross([],An,Cn);f.normalize(Nr,Nr),f.scaleAndAdd(gn,gn,Nr,g*Be)}const sr=Ve+Math.atan2(Kr,Er);return En.push(gn),Ae&&Ot.push(on),{point:gn,angle:sr,path:En,tilePath:Ot,up:An}}function ws(_,i){const g=i.length,y=g+4*_;i.resize(y),i.float32.fill(-1/0,4*g,4*y)}function Vr(_,i,g){const y=i[0],A=i[1];return _[0]=g[0]*y+g[4]*A+g[12],_[1]=g[1]*y+g[5]*A+g[13],_[3]=g[3]*y+g[7]*A+g[15],_}const $o=100;class fa{constructor(i,g,y=new Vi(i.width+200,i.height+200,25),A=new Vi(i.width+200,i.height+200,25)){this.transform=i,this.grid=y,this.ignoredGrid=A,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+$o,this.screenBottomBoundary=i.height+$o,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=g}placeCollisionBox(i,g,y,A,T,N,k,H){let Q=y.projectedAnchorX,J=y.projectedAnchorY,de=y.projectedAnchorZ;const ye=y.elevation,Ae=y.tileID,we=i.getProjection();if(ye&&Ae){const[Qe,nt,vt]=we.upVector(Ae.canonical,y.tileAnchorX,y.tileAnchorY),pt=we.upVectorScale(Ae.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Q+=Qe*ye*pt,J+=nt*ye*pt,de+=vt*ye*pt}const Se=this.projectAndGetPerspectiveRatio(k,Q,J,de,y.tileID,"globe"===we.name||!!ye||this.transform.pitch>0,we),Me=N*Se.perspectiveRatio,he=(y.x1*g+A.x-y.padding)*Me+Se.point.x,Te=(y.y1*g+A.y-y.padding)*Me+Se.point.y,Be=(y.x2*g+A.x+y.padding)*Me+Se.point.x,Ve=(y.y2*g+A.y+y.padding)*Me+Se.point.y,tt=Se.perspectiveRatio<=.55||Se.occluded;return!this.isInsideGrid(he,Te,Be,Ve)||!T&&this.grid.hitTest(he,Te,Be,Ve,H)||tt?{box:[],offscreen:!1,occluded:Se.occluded}:{box:[he,Te,Be,Ve],offscreen:this.isOffscreen(he,Te,Be,Ve),occluded:!1}}placeCollisionCircles(i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se){const Me=[],he=this.transform.elevation,Te=i.getProjection(),Be=he?he.getAtTileOffsetFunc(Se,this.transform.center.lat,this.transform.worldSize,Te):null,Ve=new f.Point(y.tileAnchorX,y.tileAnchorY);let{x:tt,y:Qe,z:nt}=Te.projectTilePoint(Ve.x,Ve.y,Se.canonical);if(Be){const[on,Cn,gn]=Be(Ve);tt+=on,Qe+=Cn,nt+=gn}const vt="globe"===Te.name,pt=this.projectAndGetPerspectiveRatio(k,tt,Qe,nt,Se,vt||!!he||this.transform.pitch>0,Te),{perspectiveRatio:Lt}=pt,En=(de?N/Lt:N*Lt)/f.ONE_EM,Ot=ai(tt,Qe,nt,H),sn=pt.signedDistanceFromCamera>0?Go(En,T,y.lineOffsetX*En,y.lineOffsetY*En,!1,Ot,Ve,y,A,H,{},he&&!de?Be:null,de&&!!he,Te,Se,de):null;let jt=!1,yn=!1,It=!0;if(sn&&!pt.occluded){const on=.5*Ae*Lt+we,Cn=new f.Point(-100,-100),gn=new f.Point(this.screenRightBoundary,this.screenBottomBoundary),An=new Jo,{first:Er,last:Kr}=sn,sr=Er.path.length;let Nr=[];for(let dr=sr-1;dr>=1;dr--)Nr.push(Er.path[dr]);for(let dr=1;dr<Kr.path.length;dr++)Nr.push(Kr.path[dr]);const _i=2.5*on;Q&&(Nr=Nr.map(([dr,Gi,oo],uo)=>(Be&&!vt&&(oo=Be(uo<sr-1?Er.tilePath[sr-1-uo]:Kr.tilePath[uo-sr+2])[2]),ai(dr,Gi,oo,Q))),Nr.some(dr=>dr[3]<=0)&&(Nr=[]));let oi=[];if(Nr.length>0){let dr=1/0,Gi=-1/0,oo=1/0,uo=-1/0;for(const To of Nr)dr=Math.min(dr,To[0]),oo=Math.min(oo,To[1]),Gi=Math.max(Gi,To[0]),uo=Math.max(uo,To[1]);Gi>=Cn.x&&dr<=gn.x&&uo>=Cn.y&&oo<=gn.y&&(oi=[Nr.map(To=>new f.Point(To[0],To[1]))],(dr<Cn.x||Gi>gn.x||oo<Cn.y||uo>gn.y)&&(oi=f.clipLine(oi,Cn.x,Cn.y,gn.x,gn.y)))}for(const dr of oi){An.reset(dr,.25*on);let Gi=0;Gi=An.length<=.5*on?1:Math.ceil(An.paddedLength/_i)+1;for(let oo=0;oo<Gi;oo++){const uo=oo/Math.max(Gi-1,1),To=An.lerp(uo),Oa=To.x+$o,ua=To.y+$o;Me.push(Oa,ua,on,0);const Fl=Oa-on,da=ua-on,rs=Oa+on,ho=ua+on;if(It=It&&this.isOffscreen(Fl,da,rs,ho),yn=yn||this.isInsideGrid(Fl,da,rs,ho),!g&&this.grid.hitTestCircle(Oa,ua,on,ye)&&(jt=!0,!J))return{circles:[],offscreen:!1,collisionDetected:jt,occluded:!1}}}}return{circles:!J&&jt||!yn?[]:Me,offscreen:It,collisionDetected:jt,occluded:pt.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let y=1/0,A=1/0,T=-1/0,N=-1/0;for(const J of i){const de=new f.Point(J.x+$o,J.y+$o);y=Math.min(y,de.x),A=Math.min(A,de.y),T=Math.max(T,de.x),N=Math.max(N,de.y),g.push(de)}const k=this.grid.query(y,A,T,N).concat(this.ignoredGrid.query(y,A,T,N)),H={},Q={};for(const J of k){const de=J.key;if(void 0===H[de.bucketInstanceId]&&(H[de.bucketInstanceId]={}),H[de.bucketInstanceId][de.featureIndex])continue;const ye=[new f.Point(J.x1,J.y1),new f.Point(J.x2,J.y1),new f.Point(J.x2,J.y2),new f.Point(J.x1,J.y2)];f.polygonIntersectsPolygon(g,ye)&&(H[de.bucketInstanceId][de.featureIndex]=!0,void 0===Q[de.bucketInstanceId]&&(Q[de.bucketInstanceId]=[]),Q[de.bucketInstanceId].push(de.featureIndex))}return Q}insertCollisionBox(i,g,y,A,T){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:A,collisionGroupID:T},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,g,y,A,T){const N=g?this.ignoredGrid:this.grid,k={bucketInstanceId:y,featureIndex:A,collisionGroupID:T};for(let H=0;H<i.length;H+=4)N.insertCircle(k,i[H],i[H+1],i[H+2])}projectAndGetPerspectiveRatio(i,g,y,A,T,N,k){const H=[g,y,A,1];let Q=!1;A||this.transform.pitch>0?(f.transformMat4$1(H,H,i),this.fogState&&T&&"globe"!==k.name&&(Q=function(ye,Ae,we,Se,Me,he){const Te=he.calculateFogTileMatrix(Me),Be=[Ae,we,Se];return f.transformMat4(Be,Be,Te),di(ye,Be,he.pitch,he._fov)}(this.fogState,g,y,A,T.toUnwrapped(),this.transform)>.9)):Vr(H,H,i);const J=H[3];return{point:new f.Point((H[0]/J+1)/2*this.transform.width+$o,(-H[1]/J+1)/2*this.transform.height+$o),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/J*.5,1.5),signedDistanceFromCamera:J,occluded:N&&H[2]>J||Q}}isOffscreen(i,g,y,A){return y<$o||i>=this.screenRightBoundary||A<$o||g>this.screenBottomBoundary}isInsideGrid(i,g,y,A){return y>=0&&i<this.gridRightBoundary&&A>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const i=f.identity([]);return f.translate(i,i,[-100,-100,0]),i}}function as(_,i,g){const y=i.createTileMatrix(_,_.worldSize,g.toUnwrapped());return f.multiply(new Float32Array(16),_.projMatrix,y)}function ls(_,i,g){if(i.projection.name===g.projection.name)return _.projMatrix;const y=g.clone();return y.setProjection(i.projection),as(y,i.getProjection(),_)}function Ii(_,i,g){return i.name===g.projection.name?_.projMatrix:as(g,i,_)}class gs{constructor(i,g,y,A){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?g:-g))):A&&y?1:0,this.placed=y}isHidden(){return 0===this.opacity&&!this.placed}}class ji{constructor(i,g,y,A,T,N=!1){this.text=new gs(i?i.text:null,g,y,T),this.icon=new gs(i?i.icon:null,g,A,T),this.clipped=N}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ko{constructor(i,g,y,A=!1){this.text=i,this.icon=g,this.skipFade=y,this.clipped=A}}class Za{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class Ll{constructor(i,g,y,A,T){this.bucketInstanceId=i,this.featureIndex=g,this.sourceLayerIndex=y,this.bucketIndex=A,this.tileID=T}}class Yl{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const g=++this.maxGroupID;this.collisionGroups[i]={ID:g,predicate:y=>y.collisionGroupID===g}}return this.collisionGroups[i]}}function ba(_,i,g,y,A){const{horizontalAlign:T,verticalAlign:N}=f.getAnchorAlignment(_),k=-(T-.5)*i,H=-(N-.5)*g,Q=f.evaluateVariableOffset(_,y);return new f.Point(k+Q[0]*A,H+Q[1]*A)}function ea(_,i,g,y,A){const T=new f.Point(_,i);return g&&T._rotate(y?A:-A),T}class cl{constructor(i,g,y,A,T){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new fa(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Yl(y),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,g,y,A){const T=y.getBucket(g),N=y.latestFeatureIndex;if(!T||!N||g.id!==T.layerIds[0])return;const k=T.layers[0].layout,H=y.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),J=y.tileSize/f.EXTENT,de=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ye=(Ae=y.tileID,we=T.getProjection(),Se=this.transform,we.name===this.projection?Se.calculateProjMatrix(Ae.toUnwrapped()):as(Se,we,Ae));var Ae,we,Se;const Me="map"===k.get("text-pitch-alignment"),he="map"===k.get("text-rotation-alignment");g.compileFilter();const Te=g.dynamicFilter(),Be=g.dynamicFilterNeedsFeature(),Ve=this.transform.calculatePixelsToTileUnitsMatrix(y),tt=vr(ye,y.tileID.canonical,Me,he,this.transform,T.getProjection(),Ve);let Qe=null;if(Me){const pt=Cr(ye,y.tileID.canonical,Me,he,this.transform,T.getProjection(),Ve);Qe=f.multiply([],this.transform.labelPlaneMatrix,pt)}let nt=null;Te&&y.latestFeatureIndex&&(nt={unwrappedTileID:de,dynamicFilter:Te,dynamicFilterNeedsFeature:Be,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new Ll(T.bucketInstanceId,N,T.sourceLayerIndex,T.index,y.tileID);const vt={bucket:T,layout:k,posMatrix:ye,textLabelPlaneMatrix:tt,labelToScreenMatrix:Qe,clippingData:nt,scale:Q,textPixelRatio:J,holdingForFade:y.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(A)for(const pt of T.sortKeyRanges){const{sortKey:Lt,symbolInstanceStart:En,symbolInstanceEnd:Ot}=pt;i.push({sortKey:Lt,symbolInstanceStart:En,symbolInstanceEnd:Ot,parameters:vt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:vt})}attemptAnchorPlacement(i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se,Me,he,Te){const{textOffset0:Be,textOffset1:Ve,crossTileID:tt}=ye,Qe=[Be,Ve],nt=ba(i,y,A,Qe,T),vt=this.collisionIndex.placeCollisionBox(we,T,g,ea(nt.x,nt.y,N,k,this.transform.angle),de,H,Q,J.predicate);if(Me){const pt=we.getSymbolInstanceIconSize(Te,this.transform.zoom,ye.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(we,pt,Me,ea(nt.x,nt.y,N,k,this.transform.angle),de,H,Q,J.predicate).box.length)return}if(vt.box.length>0){let pt;return this.prevPlacement&&this.prevPlacement.variableOffsets[tt]&&this.prevPlacement.placements[tt]&&this.prevPlacement.placements[tt].text&&(pt=this.prevPlacement.variableOffsets[tt].anchor),this.variableOffsets[tt]={textOffset:Qe,width:y,height:A,anchor:i,textScale:T,prevAnchor:pt},this.markUsedJustification(we,i,ye,Se),we.allowVerticalPlacement&&(this.markUsedOrientation(we,Se,ye),this.placedOrientations[tt]=Se),{shift:nt,placedGlyphBoxes:vt}}}placeLayerBucketPart(i,g,y,A){const{bucket:T,layout:N,posMatrix:k,textLabelPlaneMatrix:H,labelToScreenMatrix:Q,clippingData:J,textPixelRatio:de,holdingForFade:ye,collisionBoxArray:Ae,partiallyEvaluatedTextSize:we,partiallyEvaluatedIconSize:Se,collisionGroup:Me}=i.parameters,he=N.get("text-optional"),Te=N.get("icon-optional"),Be=N.get("text-allow-overlap"),Ve=N.get("icon-allow-overlap"),tt="map"===N.get("text-rotation-alignment"),Qe="map"===N.get("text-pitch-alignment"),nt="none"!==N.get("icon-text-fit"),vt="viewport-y"===N.get("symbol-z-order");this.transform.setProjection(T.projection);let pt=Be&&(Ve||!T.hasIconData()||Te),Lt=Ve&&(Be||!T.hasTextData()||he);!T.collisionArrays&&Ae&&T.deserializeCollisionBoxes(Ae),y&&A&&T.updateCollisionDebugBuffers(this.transform.zoom,Ae);const En=(Ot,sn,jt)=>{const{crossTileID:yn,numVerticalGlyphVertices:It}=Ot;if(J){const rs={zoom:this.transform.zoom,pitch:this.transform.pitch};let ho=null;if(J.dynamicFilterNeedsFeature){const $i=this.retainedQueryData[T.bucketInstanceId];ho=J.featureIndex.loadFeature({featureIndex:Ot.featureIndex,bucketIndex:$i.bucketIndex,sourceLayerIndex:$i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,J.dynamicFilter)(rs,ho,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new f.Point(Ot.tileAnchorX,Ot.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[yn]=new ko(!1,!1,!1,!0),void g.add(yn)}if(g.has(yn))return;if(ye)return void(this.placements[yn]=new ko(!1,!1,!1));let on=!1,Cn=!1,gn=!0,An=!1,Er=!1,Kr=null,sr={box:null,offscreen:null,occluded:null},Nr={box:null,offscreen:null,occluded:null},_i=null,oi=null,dr=null,Gi=0,oo=0,uo=0;jt.textFeatureIndex?Gi=jt.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(Gi=Ot.featureIndex),jt.verticalTextFeatureIndex&&(oo=jt.verticalTextFeatureIndex);const To=rs=>{rs.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const ho=this.transform.elevation;(ho||rs.elevation)&&(rs.elevation=ho?ho.getAtTileOffset(rs.tileID,rs.tileAnchorX,rs.tileAnchorY):0)},Oa=jt.textBox;if(Oa){To(Oa);const rs=$i=>{let Ps=f.WritingMode.horizontal;if(T.allowVerticalPlacement&&!$i&&this.prevPlacement){const va=this.prevPlacement.placedOrientations[yn];va&&(this.placedOrientations[yn]=va,Ps=va,this.markUsedOrientation(T,Ps,Ot))}return Ps},ho=($i,Ps)=>{if(T.allowVerticalPlacement&&It>0&&jt.verticalTextBox){for(const va of T.writingModes)if(va===f.WritingMode.vertical?(sr=Ps(),Nr=sr):sr=$i(),sr&&sr.box&&sr.box.length)break}else sr=$i()};if(N.get("text-variable-anchor")){let $i=N.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[yn]){const Po=this.prevPlacement.variableOffsets[yn];$i.indexOf(Po.anchor)>0&&($i=$i.filter(ol=>ol!==Po.anchor),$i.unshift(Po.anchor))}const Ps=(Po,ol,Nu)=>{const Tc=T.getSymbolInstanceTextSize(we,Ot,this.transform.zoom,sn),gu=(Po.x2-Po.x1)*Tc+2*Po.padding,Ql=(Po.y2-Po.y1)*Tc+2*Po.padding,Sc=nt&&!Ve?ol:null;Sc&&To(Sc);let ec={box:[],offscreen:!1,occluded:!1};const tc=Be?2*$i.length:$i.length;for(let ku=0;ku<tc;++ku){const gd=this.attemptAnchorPlacement($i[ku%$i.length],Po,gu,Ql,Tc,tt,Qe,de,k,Me,ku>=$i.length,Ot,sn,T,Nu,Sc,we,Se);if(gd&&(ec=gd.placedGlyphBoxes,ec&&ec.box&&ec.box.length)){on=!0,Kr=gd.shift;break}}return ec};ho(()=>Ps(Oa,jt.iconBox,f.WritingMode.horizontal),()=>{const Po=jt.verticalTextBox;return Po&&To(Po),T.allowVerticalPlacement&&!(sr&&sr.box&&sr.box.length)&&It>0&&Po?Ps(Po,jt.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),sr&&(on=sr.box,gn=sr.offscreen,An=sr.occluded);const va=rs(!(!sr||!sr.box));if(!on&&this.prevPlacement){const Po=this.prevPlacement.variableOffsets[yn];Po&&(this.variableOffsets[yn]=Po,this.markUsedJustification(T,Po.anchor,Ot,va))}}else{const $i=(Ps,va)=>{const Po=T.getSymbolInstanceTextSize(we,Ot,this.transform.zoom,sn),ol=this.collisionIndex.placeCollisionBox(T,Po,Ps,new f.Point(0,0),Be,de,k,Me.predicate);return ol&&ol.box&&ol.box.length&&(this.markUsedOrientation(T,va,Ot),this.placedOrientations[yn]=va),ol};ho(()=>$i(Oa,f.WritingMode.horizontal),()=>{const Ps=jt.verticalTextBox;return T.allowVerticalPlacement&&It>0&&Ps?(To(Ps),$i(Ps,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),rs(!!(sr&&sr.box&&sr.box.length))}}if(_i=sr,on=_i&&_i.box&&_i.box.length>0,gn=_i&&_i.offscreen,An=_i&&_i.occluded,Ot.useRuntimeCollisionCircles){const rs=T.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex>=0?Ot.centerJustifiedTextSymbolIndex:Ot.verticalPlacedTextSymbolIndex),ho=f.evaluateSizeForFeature(T.textSizeData,we,rs),$i=N.get("text-padding");oi=this.collisionIndex.placeCollisionCircles(T,Be,rs,T.lineVertexArray,T.glyphOffsetArray,ho,k,H,Q,y,Qe,Me.predicate,Ot.collisionCircleDiameter*ho/f.ONE_EM,$i,this.retainedQueryData[T.bucketInstanceId].tileID),on=Be||oi.circles.length>0&&!oi.collisionDetected,gn=gn&&oi.offscreen,An=oi.occluded}if(jt.iconFeatureIndex&&(uo=jt.iconFeatureIndex),jt.iconBox){const rs=ho=>{To(ho);const $i=nt&&Kr?ea(Kr.x,Kr.y,tt,Qe,this.transform.angle):new f.Point(0,0),Ps=T.getSymbolInstanceIconSize(Se,this.transform.zoom,Ot.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Ps,ho,$i,Ve,de,k,Me.predicate)};Nr&&Nr.box&&Nr.box.length&&jt.verticalIconBox?(dr=rs(jt.verticalIconBox),Cn=dr.box.length>0):(dr=rs(jt.iconBox),Cn=dr.box.length>0),gn=gn&&dr.offscreen,Er=dr.occluded}const ua=he||0===Ot.numHorizontalGlyphVertices&&0===It,Fl=Te||0===Ot.numIconVertices;if(ua||Fl?Fl?ua||(Cn=Cn&&on):on=Cn&&on:Cn=on=Cn&&on,on&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,N.get("text-ignore-placement"),T.bucketInstanceId,Nr&&Nr.box&&oo?oo:Gi,Me.ID),Cn&&dr&&this.collisionIndex.insertCollisionBox(dr.box,N.get("icon-ignore-placement"),T.bucketInstanceId,uo,Me.ID),oi&&(on&&this.collisionIndex.insertCollisionCircles(oi.circles,N.get("text-ignore-placement"),T.bucketInstanceId,Gi,Me.ID),y)){const rs=T.bucketInstanceId;let ho=this.collisionCircleArrays[rs];void 0===ho&&(ho=this.collisionCircleArrays[rs]=new Za);for(let $i=0;$i<oi.circles.length;$i+=4)ho.circles.push(oi.circles[$i+0]),ho.circles.push(oi.circles[$i+1]),ho.circles.push(oi.circles[$i+2]),ho.circles.push(oi.collisionDetected?1:0)}const da="globe"!==T.projection.name;pt=pt&&(da||!An),Lt=Lt&&(da||!Er),this.placements[yn]=new ko(on||pt,Cn||Lt,gn||T.justReloaded),g.add(yn)};if(vt){const Ot=T.getSortedSymbolIndexes(this.transform.angle);for(let sn=Ot.length-1;sn>=0;--sn){const jt=Ot[sn];En(T.symbolInstances.get(jt),jt,T.collisionArrays[jt])}}else for(let Ot=i.symbolInstanceStart;Ot<i.symbolInstanceEnd;Ot++)En(T.symbolInstances.get(Ot),Ot,T.collisionArrays[Ot]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Ot=this.collisionCircleArrays[T.bucketInstanceId];f.invert(Ot.invProjMatrix,k),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(i,g,y,A){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:H,crossTileID:Q}=y,J=f.getAnchorJustification(g),de=A===f.WritingMode.vertical?H:"left"===J?T:"center"===J?N:"right"===J?k:-1;T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=de>=0&&T!==de?0:Q),N>=0&&(i.text.placedSymbolArray.get(N).crossTileID=de>=0&&N!==de?0:Q),k>=0&&(i.text.placedSymbolArray.get(k).crossTileID=de>=0&&k!==de?0:Q),H>=0&&(i.text.placedSymbolArray.get(H).crossTileID=de>=0&&H!==de?0:Q)}markUsedOrientation(i,g,y){const A=g===f.WritingMode.horizontal||g===f.WritingMode.horizontalOnly?g:0,T=g===f.WritingMode.vertical?g:0,{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:H,verticalPlacedTextSymbolIndex:Q}=y,J=i.text.placedSymbolArray;N>=0&&(J.get(N).placedOrientation=A),k>=0&&(J.get(k).placedOrientation=A),H>=0&&(J.get(H).placedOrientation=A),Q>=0&&(J.get(Q).placedOrientation=T)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let y=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const A=g?g.symbolFadeChange(i):1,T=g?g.opacities:{},N=g?g.variableOffsets:{},k=g?g.placedOrientations:{};for(const H in this.placements){const Q=this.placements[H],J=T[H];J?(this.opacities[H]=new ji(J,A,Q.text,Q.icon,null,Q.clipped),y=y||Q.text!==J.text.placed||Q.icon!==J.icon.placed):(this.opacities[H]=new ji(null,A,Q.text,Q.icon,Q.skipFade,Q.clipped),y=y||Q.text||Q.icon)}for(const H in T){const Q=T[H];if(!this.opacities[H]){const J=new ji(Q,A,!1,!1);J.isHidden()||(this.opacities[H]=J,y=y||Q.text.placed||Q.icon.placed)}}for(const H in N)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=N[H]);for(const H in k)this.placedOrientations[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.placedOrientations[H]=k[H]);y?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:i)}updateLayerOpacities(i,g){const y=new Set;for(const A of g){const T=A.getBucket(i);T&&A.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,y,A.collisionBoxArray)}}updateBucketOpacities(i,g,y){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const A=i.layers[0].layout,T=!!i.layers[0].dynamicFilter(),N=new ji(null,0,!1,!1,!0),k=A.get("text-allow-overlap"),H=A.get("icon-allow-overlap"),Q=A.get("text-variable-anchor"),J="map"===A.get("text-rotation-alignment"),de="map"===A.get("text-pitch-alignment"),ye="none"!==A.get("icon-text-fit"),Ae=new ji(null,0,k&&(H||!i.hasIconData()||A.get("icon-optional")),H&&(k||!i.hasTextData()||A.get("text-optional")),!0);!i.collisionArrays&&y&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(y);const we=(Me,he,Te)=>{for(let Be=0;Be<he/4;Be++)Me.opacityVertexArray.emplaceBack(Te)};let Se=0;for(let Me=0;Me<i.symbolInstances.length;Me++){const he=i.symbolInstances.get(Me),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:Be,crossTileID:Ve,numIconVertices:tt}=he,Qe=g.has(Ve);let nt=this.opacities[Ve];Qe?nt=N:nt||(nt=Ae,this.opacities[Ve]=nt),g.add(Ve);const vt=Te>0||Be>0,pt=tt>0,Lt=this.placedOrientations[Ve],En=Lt===f.WritingMode.vertical,Ot=Lt===f.WritingMode.horizontal||Lt===f.WritingMode.horizontalOnly;if(!vt&&!pt||nt.isHidden()||Se++,vt){const sn=hl(nt.text);we(i.text,Te,En?go:sn),we(i.text,Be,Ot?go:sn);const jt=nt.text.isHidden(),{leftJustifiedTextSymbolIndex:yn,centerJustifiedTextSymbolIndex:It,rightJustifiedTextSymbolIndex:on,verticalPlacedTextSymbolIndex:Cn}=he,gn=i.text.placedSymbolArray,An=jt||En?1:0;yn>=0&&(gn.get(yn).hidden=An),It>=0&&(gn.get(It).hidden=An),on>=0&&(gn.get(on).hidden=An),Cn>=0&&(gn.get(Cn).hidden=jt||Ot?1:0);const Er=this.variableOffsets[Ve];Er&&this.markUsedJustification(i,Er.anchor,he,Lt);const Kr=this.placedOrientations[Ve];Kr&&(this.markUsedJustification(i,"left",he,Kr),this.markUsedOrientation(i,Kr,he))}if(pt){const sn=hl(nt.icon),{placedIconSymbolIndex:jt,verticalPlacedIconSymbolIndex:yn}=he,It=i.icon.placedSymbolArray,on=nt.icon.isHidden()?1:0;jt>=0&&(we(i.icon,tt,En?go:sn),It.get(jt).hidden=on),yn>=0&&(we(i.icon,he.numVerticalIconVertices,Ot?go:sn),It.get(yn).hidden=on)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const sn=i.collisionArrays[Me];if(sn){let jt=new f.Point(0,0),yn=!0;if(sn.textBox||sn.verticalTextBox){if(Q){const on=this.variableOffsets[Ve];on?(jt=ba(on.anchor,on.width,on.height,on.textOffset,on.textScale),J&&jt._rotate(de?this.transform.angle:-this.transform.angle)):yn=!1}T&&(yn=!nt.clipped),sn.textBox&&ul(i.textCollisionBox.collisionVertexArray,nt.text.placed,!yn||En,jt.x,jt.y),sn.verticalTextBox&&ul(i.textCollisionBox.collisionVertexArray,nt.text.placed,!yn||Ot,jt.x,jt.y)}const It=yn&&!(Ot||!sn.verticalIconBox);sn.iconBox&&ul(i.iconCollisionBox.collisionVertexArray,nt.icon.placed,It,ye?jt.x:0,ye?jt.y:0),sn.verticalIconBox&&ul(i.iconCollisionBox.collisionVertexArray,nt.icon.placed,!It,ye?jt.x:0,ye?jt.y:0)}}}if(i.fullyClipped=0===Se,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Me.invProjMatrix,i.placementViewportMatrix=Me.viewportMatrix,i.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,g){const y=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*y>i}setStale(){this.stale=!0}}function ul(_,i,g,y,A){_.emplaceBack(i?1:0,g?1:0,y||0,A||0),_.emplaceBack(i?1:0,g?1:0,y||0,A||0),_.emplaceBack(i?1:0,g?1:0,y||0,A||0),_.emplaceBack(i?1:0,g?1:0,y||0,A||0)}const Di=Math.pow(2,25),Eo=Math.pow(2,24),Vl=Math.pow(2,17),dl=Math.pow(2,16),bs=Math.pow(2,9),Qo=Math.pow(2,8),qa=Math.pow(2,1);function hl(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const i=_.placed?1:0,g=Math.floor(127*_.opacity);return g*Di+i*Eo+g*Vl+i*dl+g*bs+i*Qo+g*qa+i}const go=0;class $s{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,g,y,A,T){const N=this._bucketParts;for(;this._currentTileIndex<i.length;)if(g.getBucketParts(N,A,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort((k,H)=>k.sortKey-H.sortKey));this._currentPartIndex<N.length;){const k=N[this._currentPartIndex];if(g.placeLayerBucketPart(k,this._seenCrossTileIDs,y,0===k.symbolInstanceStart),this._currentPartIndex++,T())return!0}return!1}}class Ea{constructor(i,g,y,A,T,N,k,H){this.placement=new cl(i,T,N,k,H),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(i,g,y){const A=f.exported.now(),T=()=>{const N=f.exported.now()-A;return!this._forceFullPlacement&&N>2};for(;this._currentPlacementIndex>=0;){const N=g[i[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===N.type&&(!N.minzoom||N.minzoom<=k)&&(!N.maxzoom||N.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new $s(N)),this._inProgressLayer.continuePlacement(y[N.source],this.placement,this._showCollisionBoxes,N,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const zr=512/f.EXTENT/2;class ti{constructor(i,g,y){this.tileID=i,this.bucketInstanceId=y,this.index=new f.KDBush(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const A=i.canonical.x*f.EXTENT,T=i.canonical.y*f.EXTENT;for(let N=0;N<g.length;N++){const{key:k,crossTileID:H,tileAnchorX:Q,tileAnchorY:J}=g.get(N),de=Math.floor((A+Q)*zr),ye=Math.floor((T+J)*zr);this.index.add(de,ye),this.keys.push(k),this.crossTileIDs.push(H)}this.index.finish()}findMatches(i,g,y){const A=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),T=zr/Math.pow(2,g.canonical.z-this.tileID.canonical.z),N=g.canonical.x*f.EXTENT,k=g.canonical.y*f.EXTENT;for(let H=0;H<i.length;H++){const Q=i.get(H);if(Q.crossTileID)continue;const{key:J,tileAnchorX:de,tileAnchorY:ye}=Q,Ae=Math.floor((N+de)*T),we=Math.floor((k+ye)*T),Se=this.index.range(Ae-A,we-A,Ae+A,we+A);for(const Me of Se){const he=this.crossTileIDs[Me];if(this.keys[Me]===J&&!y.has(he)){y.add(he),Q.crossTileID=he;break}}}}}class Ri{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class es{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const g=Math.round((i-this.lng)/360);if(0!==g)for(const y in this.indexes){const A=this.indexes[y],T={};for(const N in A){const k=A[N];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+g),T[k.tileID.key]=k}this.indexes[y]=T}this.lng=i}addBucket(i,g,y){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let T=0;T<g.symbolInstances.length;T++)g.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const A=this.usedCrossTileIDs[i.overscaledZ];for(const T in this.indexes){const N=this.indexes[T];if(Number(T)>i.overscaledZ)for(const k in N){const H=N[k];H.tileID.isChildOf(i)&&H.findMatches(g.symbolInstances,i,A)}else{const k=N[i.scaledTo(Number(T)).key];k&&k.findMatches(g.symbolInstances,i,A)}}for(let T=0;T<g.symbolInstances.length;T++){const N=g.symbolInstances.get(T);N.crossTileID||(N.crossTileID=y.generate(),A.add(N.crossTileID))}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new ti(i,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(i,g){for(const y of g.crossTileIDs)this.usedCrossTileIDs[i].delete(y)}removeStaleBuckets(i){let g=!1;for(const y in this.indexes){const A=this.indexes[y];for(const T in A)i[A[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,A[T]),delete A[T],g=!0)}return g}}class Qi{constructor(){this.layerIndexes={},this.crossTileIDs=new Ri,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,g,y,A){let T=this.layerIndexes[i.id];void 0===T&&(T=this.layerIndexes[i.id]=new es);let N=!1;const k={};"globe"!==A.name&&T.handleWrapJump(y);for(const H of g){const Q=H.getBucket(i);Q&&i.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(H.tileID,Q,this.crossTileIDs)&&(N=!0),k[Q.bucketInstanceId]=!0)}return T.removeStaleBuckets(k)&&(N=!0),N}pruneUnusedLayers(i){const g={};i.forEach(y=>{g[y]=!0});for(const y in this.layerIndexes)g[y]||delete this.layerIndexes[y]}}const pa=(_,i)=>f.emitValidationErrors(_,i&&i.filter(g=>"source.canvas"!==g.identifier)),Fa=f.pick(en,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Fo=f.pick(en,["setCenter","setZoom","setBearing","setPitch"]),Ba={version:8,layers:[],sources:{}},Ca={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class mi extends f.Evented{constructor(i,g={}){super(),this.map=i,this.dispatcher=new Zr(Je(),this),this.imageManager=new Wn,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(i._requestManager,g.localFontFamily?f.LocalGlyphMode.all:g.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new Qi,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const y=this;this._rtlTextPluginCallback=mi.registerForPluginStateChange(A=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},(T,N)=>{if(f.triggerPluginCompletionEvent(T),N&&N.every(k=>k))for(const k in y._sourceCaches){const H=y._sourceCaches[k],Q=H.getSource().type;"vector"!==Q&&"geojson"!==Q||H.reload()}})}),this.on("data",A=>{if("source"!==A.dataType||"metadata"!==A.sourceDataType)return;const T=this.getSource(A.sourceId);if(T&&T.vectorLayerIds)for(const N in this._layers){const k=this._layers[N];k.source===T.id&&this._validateLayer(k)}})}loadURL(i,g={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const y="boolean"==typeof g.validate?g.validate:!f.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,g.accessToken);const A=this.map._requestManager.transformRequest(i,f.ResourceType.Style);this._request=f.getJSON(A,(T,N)=>{this._request=null,T?this.fire(new f.ErrorEvent(T)):N&&this._load(N,y)})}loadJSON(i,g={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(i,!1!==g.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(Ba,!1)}_updateLayerCount(i,g){const y=g?1:-1;i.is3D()&&(this._num3DLayers+=y),"circle"===i.type&&(this._numCircleLayers+=y),"symbol"===i.type&&(this._numSymbolLayers+=y)}_load(i,g){if(g&&pa(this,f.validateStyle(i)))return;this._loaded=!0,this.stylesheet=f.clone$1(i),this._updateMapProjection();for(const A in i.sources)this.addSource(A,i.sources[A],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const y=an(this.stylesheet.layers);this._order=y.map(A=>A.id),this._layers={},this._serializedLayers={};for(const A of y){const T=f.createStyleLayer(A);T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(g,y,A){let T,N,k;const H=f.exported.devicePixelRatio>1?"@2x":"";let Q=f.getJSON(y.transformRequest(y.normalizeSpriteURL(g,H,".json"),f.ResourceType.SpriteJSON),(ye,Ae)=>{Q=null,k||(k=ye,T=Ae,de())}),J=f.getImage(y.transformRequest(y.normalizeSpriteURL(g,H,".png"),f.ResourceType.SpriteImage),(ye,Ae)=>{J=null,k||(k=ye,N=Ae,de())});function de(){if(k)A(k);else if(T&&N){const ye=f.exported.getImageData(N),Ae={};for(const we in T){const{width:Se,height:Me,x:he,y:Te,sdf:Be,pixelRatio:Ve,stretchX:tt,stretchY:Qe,content:nt}=T[we],vt=new f.RGBAImage({width:Se,height:Me});f.RGBAImage.copy(ye,vt,{x:he,y:Te},{x:0,y:0},{width:Se,height:Me}),Ae[we]={data:vt,pixelRatio:Ve,sdf:Be,stretchX:tt,stretchY:Qe,content:nt}}A(null,Ae)}}return{cancel(){Q&&(Q.cancel(),Q=null),J&&(J.cancel(),J=null)}}}(i,this.map._requestManager,(g,y)=>{if(this._spriteRequest=null,g)this.fire(new f.ErrorEvent(g));else if(y)for(const A in y)this.imageManager.addImage(A,y[A]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(i){const g=this.getSource(i.source);if(!g)return;const y=i.sourceLayer;y&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(y))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${g.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const g=[];for(const y of i){const A=this._layers[y];"custom"!==A.type&&g.push(A.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&("function"==typeof i.isLayerDraped?i.isLayerDraped():Ca[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const g=this._changed;if(this._changed){const A=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(A.length||T.length)&&this._updateWorkerLayers(A,T);for(const N in this._updatedSources){const k=this._updatedSources[N];"reload"===k?this._reloadSource(N):"clear"===k&&this._clearSource(N)}this._updateTilesForChangedImages();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const y={};for(const A in this._sourceCaches){const T=this._sourceCaches[A];y[A]=T.used,T.used=!1}for(const A of this._order){const T=this._layers[A];if(T.recalculate(i,this._availableImages),!T.isHidden(i.zoom)){const k=this._getLayerSourceCache(T);k&&(k.used=!0)}const N=this.map.painter;if(N){const k=T.getProgramIds();if(!k)continue;const H=T.getProgramConfiguration(i.zoom);for(const Q of k)N.useProgram(Q,H)}}for(const A in y){const T=this._sourceCaches[A];y[A]!==T.used&&T.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),pa(this,f.validateStyle(i)))return!1;(i=f.clone$1(i)).layers=an(i.layers);const g=function(A,T){if(!A)return[{command:en.setStyle,args:[T]}];let N=[];try{if(!ze(A.version,T.version))return[{command:en.setStyle,args:[T]}];ze(A.center,T.center)||N.push({command:en.setCenter,args:[T.center]}),ze(A.zoom,T.zoom)||N.push({command:en.setZoom,args:[T.zoom]}),ze(A.bearing,T.bearing)||N.push({command:en.setBearing,args:[T.bearing]}),ze(A.pitch,T.pitch)||N.push({command:en.setPitch,args:[T.pitch]}),ze(A.sprite,T.sprite)||N.push({command:en.setSprite,args:[T.sprite]}),ze(A.glyphs,T.glyphs)||N.push({command:en.setGlyphs,args:[T.glyphs]}),ze(A.transition,T.transition)||N.push({command:en.setTransition,args:[T.transition]}),ze(A.light,T.light)||N.push({command:en.setLight,args:[T.light]}),ze(A.fog,T.fog)||N.push({command:en.setFog,args:[T.fog]}),ze(A.projection,T.projection)||N.push({command:en.setProjection,args:[T.projection]});const k={},H=[];!function(de,ye,Ae,we){let Se;for(Se in ye=ye||{},de=de||{})de.hasOwnProperty(Se)&&(ye.hasOwnProperty(Se)||zn(Se,Ae,we));for(Se in ye){if(!ye.hasOwnProperty(Se))continue;const Me=ye[Se];de.hasOwnProperty(Se)?ze(de[Se],Me)||("geojson"===de[Se].type&&"geojson"===Me.type&&Sr(de,ye,Se)?Ae.push({command:en.setGeoJSONSourceData,args:[Se,Me.data]}):br(Se,ye,Ae,we)):In(Se,ye,Ae)}}(A.sources,T.sources,H,k);const Q=[];A.layers&&A.layers.forEach(de=>{de.source&&k[de.source]?N.push({command:en.removeLayer,args:[de.id]}):Q.push(de)});let J=A.terrain;J&&k[J.source]&&(N.push({command:en.setTerrain,args:[void 0]}),J=void 0),N=N.concat(H),ze(J,T.terrain)||N.push({command:en.setTerrain,args:[T.terrain]}),function(de,ye,Ae){ye=ye||[];const we=(de=de||[]).map(Fi),Se=ye.map(Fi),Me=de.reduce(_o,{}),he=ye.reduce(_o,{}),Te=we.slice(),Be=Object.create(null);let Ve,tt,Qe,nt,vt,pt,Lt;for(Ve=0,tt=0;Ve<we.length;Ve++)Qe=we[Ve],he.hasOwnProperty(Qe)?tt++:(Ae.push({command:en.removeLayer,args:[Qe]}),Te.splice(Te.indexOf(Qe,tt),1));for(Ve=0,tt=0;Ve<Se.length;Ve++)Qe=Se[Se.length-1-Ve],Te[Te.length-1-Ve]!==Qe&&(Me.hasOwnProperty(Qe)?(Ae.push({command:en.removeLayer,args:[Qe]}),Te.splice(Te.lastIndexOf(Qe,Te.length-tt),1)):tt++,pt=Te[Te.length-Ve],Ae.push({command:en.addLayer,args:[he[Qe],pt]}),Te.splice(Te.length-Ve,0,Qe),Be[Qe]=!0);for(Ve=0;Ve<Se.length;Ve++)if(Qe=Se[Ve],nt=Me[Qe],vt=he[Qe],!Be[Qe]&&!ze(nt,vt))if(ze(nt.source,vt.source)&&ze(nt["source-layer"],vt["source-layer"])&&ze(nt.type,vt.type)){for(Lt in Ui(nt.layout,vt.layout,Ae,Qe,null,en.setLayoutProperty),Ui(nt.paint,vt.paint,Ae,Qe,null,en.setPaintProperty),ze(nt.filter,vt.filter)||Ae.push({command:en.setFilter,args:[Qe,vt.filter]}),ze(nt.minzoom,vt.minzoom)&&ze(nt.maxzoom,vt.maxzoom)||Ae.push({command:en.setLayerZoomRange,args:[Qe,vt.minzoom,vt.maxzoom]}),nt)nt.hasOwnProperty(Lt)&&"layout"!==Lt&&"paint"!==Lt&&"filter"!==Lt&&"metadata"!==Lt&&"minzoom"!==Lt&&"maxzoom"!==Lt&&(0===Lt.indexOf("paint.")?Ui(nt[Lt],vt[Lt],Ae,Qe,Lt.slice(6),en.setPaintProperty):ze(nt[Lt],vt[Lt])||Ae.push({command:en.setLayerProperty,args:[Qe,Lt,vt[Lt]]}));for(Lt in vt)vt.hasOwnProperty(Lt)&&!nt.hasOwnProperty(Lt)&&"layout"!==Lt&&"paint"!==Lt&&"filter"!==Lt&&"metadata"!==Lt&&"minzoom"!==Lt&&"maxzoom"!==Lt&&(0===Lt.indexOf("paint.")?Ui(nt[Lt],vt[Lt],Ae,Qe,Lt.slice(6),en.setPaintProperty):ze(nt[Lt],vt[Lt])||Ae.push({command:en.setLayerProperty,args:[Qe,Lt,vt[Lt]]}))}else Ae.push({command:en.removeLayer,args:[Qe]}),pt=Te[Te.lastIndexOf(Qe)+1],Ae.push({command:en.addLayer,args:[vt,pt]})}(Q,T.layers,N)}catch(k){console.warn("Unable to compute style diff:",k),N=[{command:en.setStyle,args:[T]}]}return N}(this.serialize(),i).filter(A=>!(A.command in Fo));if(0===g.length)return!1;const y=g.filter(A=>!(A.command in Fa));if(y.length>0)throw new Error(`Unimplemented: ${y.map(A=>A.command).join(", ")}.`);return g.forEach(A=>{"setTransition"!==A.command&&"setProjection"!==A.command&&this[A.command].apply(this,A.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,g){return this.getImage(i)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,g),this._afterImageUpdated(i),this)}updateImage(i,g){this.imageManager.updateImage(i,g)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,g,y={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(f.validateSource,`sources.${i}`,g,null,y))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const A=Tt(i,g,this.dispatcher,this);A.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:A.serialize(),sourceId:i}));const T=N=>{const k=(N?"symbol:":"other:")+i,H=this._sourceCaches[k]=new f.SourceCache(k,A,N);(N?this._symbolSourceCaches:this._otherSourceCaches)[i]=H,H.style=this,H.onAdd(this.map)};T(!1),"vector"!==g.type&&"geojson"!==g.type||T(!0),A.onAdd&&A.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const g=this.getSource(i);if(!g)throw new Error("There is no source with this ID");for(const A in this._layers)if(this._layers[A].source===i)return this.fire(new f.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${A}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new f.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(i);for(const A of y)delete this._sourceCaches[A.id],delete this._updatedSources[A.id],A.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:A.getSource().id})),A.setEventedParent(null),A.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,g){this._checkLoaded(),this.getSource(i).setData(g),this._changed=!0}getSource(i){const g=this._getSourceCache(i);return g&&g.getSource()}_getSources(){const i=[];for(const g in this._otherSourceCaches){const y=this._getSourceCache(g);y&&i.push(y.getSource())}return i}addLayer(i,g,y={}){this._checkLoaded();const A=i.id;if(this.getLayer(A))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${A}" already exists on this map`)));let T;if("custom"===i.type){if(pa(this,f.validateCustomStyleLayer(i)))return;T=f.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(A,i.source),i=f.clone$1(i),i=f.extend(i,{source:A})),this._validate(f.validateLayer,`layers.${A}`,i,{arrayIndex:-1},y))return;T=f.createStyleLayer(i),this._validateLayer(T),T.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const N=g?this._order.indexOf(g):this._order.length;if(g&&-1===N)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(N,0,A),this._layerOrderChanged=!0,this._layers[A]=T;const k=this._getLayerSourceCache(T);if(this._removedLayers[A]&&T.source&&k&&"custom"!==T.type){const H=this._removedLayers[A];delete this._removedLayers[A],H.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",k.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,g){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===g)return;const y=this._order.indexOf(i);this._order.splice(y,1);const A=g?this._order.indexOf(g):this._order.length;g&&-1===A?this.fire(new f.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(A,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const g=this._layers[i];if(!g)return void this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const y=this._order.indexOf(i);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=g,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const g in this._layers)if(this._layers[g].type===i)return!0;return!1}setLayerZoomRange(i,g,y){this._checkLoaded();const A=this.getLayer(i);A?A.minzoom===g&&A.maxzoom===y||(null!=g&&(A.minzoom=g),null!=y&&(A.maxzoom=y),this._updateLayer(A)):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,g,y={}){this._checkLoaded();const A=this.getLayer(i);if(A){if(!ze(A.filter,g))return null==g?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(f.validateFilter,`layers.${A.id}.filter`,g,{layerType:A.type},y)||(A.filter=f.clone$1(g),this._updateLayer(A)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const g=this.getLayer(i);return g&&f.clone$1(g.filter)}setLayoutProperty(i,g,y,A={}){this._checkLoaded();const T=this.getLayer(i);T?ze(T.getLayoutProperty(g),y)||(T.setLayoutProperty(g,y,A),this._updateLayer(T)):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,g){const y=this.getLayer(i);if(y)return y.getLayoutProperty(g);this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,g,y,A={}){this._checkLoaded();const T=this.getLayer(i);T?ze(T.getPaintProperty(g),y)||(T.setPaintProperty(g,y,A)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,g){const y=this.getLayer(i);return y&&y.getPaintProperty(g)}setFeatureState(i,g){this._checkLoaded();const y=i.source,A=i.sourceLayer,T=this.getSource(y);if(!T)return void this.fire(new f.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const N=T.type;if("geojson"===N&&A)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===N&&!A)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(y);for(const H of k)H.setFeatureState(A,i.id,g)}removeFeatureState(i,g){this._checkLoaded();const y=i.source,A=this.getSource(y);if(!A)return void this.fire(new f.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const T=A.type,N="vector"===T?i.sourceLayer:void 0;if("vector"===T&&!N)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(y);for(const H of k)H.removeFeatureState(N,i.id,g)}getFeatureState(i){this._checkLoaded();const g=i.source,y=i.sourceLayer,A=this.getSource(g);if(A){if("vector"!==A.type||y)return void 0===i.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(y,i.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const g in this._sourceCaches){const y=this._sourceCaches[g].getSource();i[y.id]||(i[y.id]=y.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(i){this._updatedLayers[i.id]=!0;const g=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[i.source]="reload",g.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const g=N=>"fill-extrusion"===this._layers[N].type,y={},A=[];for(let N=this._order.length-1;N>=0;N--){const k=this._order[N];if(g(k)){y[k]=N;for(const H of i){const Q=H[k];if(Q)for(const J of Q)A.push(J)}}}A.sort((N,k)=>k.intersectionZ-N.intersectionZ);const T=[];for(let N=this._order.length-1;N>=0;N--){const k=this._order[N];if(g(k))for(let H=A.length-1;H>=0;H--){const Q=A[H].feature;if(y[Q.layer.id]<N)break;T.push(Q),A.pop()}else for(const H of i){const Q=H[k];if(Q)for(const J of Q)T.push(J.feature)}}return T}queryRenderedFeatures(i,g,y){g&&g.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const A={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const H of g.layers){const Q=this._layers[H];if(!Q)return this.fire(new f.ErrorEvent(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];A[Q.source]=!0}}const T=[];g.availableImages=this._availableImages;const N=g&&g.layers?g.layers.some(H=>{const Q=this.getLayer(H);return Q&&Q.is3D()}):this.has3DLayers(),k=Ir.createFromScreenPoints(i,y);for(const H in this._sourceCaches){const Q=this._sourceCaches[H].getSource().id;g.layers&&!A[Q]||T.push(Bn(this._sourceCaches[H],this._layers,this._serializedLayers,k,g,y,N,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(H,Q,J,de,ye,Ae,we){const Se={},Me=Ae.queryRenderedSymbols(de),he=[];for(const Te of Object.keys(Me).map(Number))he.push(we[Te]);he.sort(Lr);for(const Te of he){const Be=Te.featureIndex.lookupSymbolFeatures(Me[Te.bucketInstanceId],Q,Te.bucketIndex,Te.sourceLayerIndex,ye.filter,ye.layers,ye.availableImages,H);for(const Ve in Be){const tt=Se[Ve]=Se[Ve]||[],Qe=Be[Ve];Qe.sort((nt,vt)=>{const pt=Te.featureSortOrder;if(pt){const Lt=pt.indexOf(nt.featureIndex);return pt.indexOf(vt.featureIndex)-Lt}return vt.featureIndex-nt.featureIndex});for(const nt of Qe)tt.push(nt)}}for(const Te in Se)Se[Te].forEach(Be=>{const Ve=Be.feature,tt=J(H[Te]);if(!tt)return;const Qe=tt.getFeatureState(Ve.layer["source-layer"],Ve.id);Ve.source=Ve.layer.source,Ve.layer["source-layer"]&&(Ve.sourceLayer=Ve.layer["source-layer"]),Ve.state=Qe});return Se}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(i,g){g&&g.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const y=this._getSourceCaches(i);let A=[];for(const T of y)A=A.concat(Mr(T,g));return A}addSourceType(i,g,y){return mi.getSourceType(i)?y(new Error(`A source type called "${i}" already exists.`)):(mi.setSourceType(i,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:g.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(i,g={}){this._checkLoaded();const y=this.light.getLight();let A=!1;for(const N in i)if(!ze(i[N],y[N])){A=!0;break}if(!A)return;const T=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,g),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,g=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=i;if(1===g){if("object"==typeof y.source){const A="terrain-dem-src";this.addSource(A,y.source),y=f.clone$1(y),y=f.extend(y,{source:A})}if(this._validate(f.validateTerrain,"terrain",y))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,g)}else{const A=this.terrain,T=A.get();for(const N of Object.keys(f.spec.terrain))!y.hasOwnProperty(N)&&f.spec.terrain[N].default&&(y[N]=f.spec.terrain[N].default);for(const N in y)if(!ze(y[N],T[N])){A.set(y),this.stylesheet.terrain=y;const k=this._setTransitionParameters({duration:0});A.updateTransitions(k);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const g=this.fog=new Vn(i,this.map.transform);this.stylesheet.fog=i;const y=this._setTransitionParameters({duration:0});g.updateTransitions(y)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,y=g.get();0===Object.keys(i).length&&g.set(i);for(const A in i)if(!ze(i[A],y[A])){g.set(i),this.stylesheet.fog=i;const T=this._setTransitionParameters({duration:0});g.updateTransitions(T);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:f.exported.now(),transition:f.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(y=>this.isLayerDraped(this._layers[y])),g=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...g)}_createTerrain(i,g){const y=this.terrain=new kn(i,g);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const A=this._setTransitionParameters({duration:0});y.updateTransitions(A)}_force3DLayerUpdate(){for(const i in this._layers){const g=this._layers[i];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const g=this._layers[i];"symbol"===g.type&&this._updateLayer(g)}}_validate(i,g,y,A,T={}){return(!T||!1!==T.validate)&&pa(this,i.call(f.validateStyle,f.extend({key:g,style:this.serialize(),value:y,styleSpec:f.spec},A)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const g=this._getSourceCaches(i);for(const y of g)y.clearTiles()}_reloadSource(i){const g=this._getSourceCaches(i);for(const y of g)y.resume(),y.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const g in this._sourceCaches)this._sourceCaches[g].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const g=this._sourceCaches[i];g.resume(),g.reload()}}_updatePlacement(i,g,y,A,T=!1){let N=!1,k=!1;const H={};for(const Q of this._order){const J=this._layers[Q];if("symbol"!==J.type)continue;if(!H[J.source]){const ye=this._getLayerSourceCache(J);if(!ye)continue;H[J.source]=ye.getRenderableIds(!0).map(Ae=>ye.getTileByID(Ae)).sort((Ae,we)=>we.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(we.tileID)?-1:1))}const de=this.crossTileSymbolIndex.addLayer(J,H[J.source],i.center.lng,i.projection);N=N||de}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||0===y,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),i.zoom))&&(this.pauseablePlacement=new Ea(i,this._order,T,g,y,A,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),k=!0),N&&this.pauseablePlacement.placement.setStale()),k||N)for(const Q of this._order){const J=this._layers[Q];"symbol"===J.type&&this.placement.updateLayerOpacities(J,H[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,g,y){this.imageManager.getImages(g.icons,y),this._updateTilesForChangedImages();const A=T=>{T&&T.setDependencies(g.tileID.key,g.type,g.icons)};A(this._otherSourceCaches[g.source]),A(this._symbolSourceCaches[g.source])}getGlyphs(i,g,y){this.glyphManager.getGlyphs(g.stacks,y)}getResource(i,g,y){return f.makeRequest(g,y)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const g=[];return this._otherSourceCaches[i]&&g.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&g.push(this._symbolSourceCaches[i]),g}_isSourceCacheLoaded(i){const g=this._getSourceCaches(i);return 0===g.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):g.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}mi.getSourceType=function(_){return Ke[_]},mi.setSourceType=function(_,i){Ke[_]=i},mi.registerForPluginStateChange=f.registerForPluginStateChange;var er="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Dr="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ni="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",cs="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ts="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Co={},Aa={};const Fr=[];ms(er,Fr),ms(ni,Fr),ms(cs,Fr),ms(ts,Fr),Co=Xr("",ni),Aa=Xr(ts,cs);const Ws=Xr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ta=er,Or="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var zs={background:Xr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Xr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Xr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Xr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Xr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Xr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Xr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Xr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Xr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Xr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Xr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Xr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Xr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Xr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Xr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Xr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Xr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Xr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Xr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Xr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Xr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Xr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Dr),skyboxGradient:Xr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Dr),skyboxCapture:Xr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Xr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ms(_,i){const g=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let y of g)if(y=y.trim(),"#"===y[0]&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const A=y.split(" ");for(const T of A)i.includes(T)||i.push(T)}}function Xr(_,i){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),A={},T=[...Fr];return ms(_,T),ms(i,T),{fragmentSource:_=_.replace(g,(N,k,H,Q,J)=>(A[J]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${J}\nvarying ${H} ${Q} ${J};\n#else\nuniform ${H} ${Q} u_${J};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${J}\n    ${H} ${Q} ${J} = u_${J};\n#endif\n`)),vertexSource:i=i.replace(g,(N,k,H,Q,J)=>{const de="float"===Q?"vec2":"vec4",ye=J.match(/color/)?"color":de;return A[J]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${H} ${de} a_${J};\nvarying ${H} ${Q} ${J};\n#else\nuniform ${H} ${Q} u_${J};\n#endif\n`:"vec4"===ye?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = a_${J};\n#else\n    ${H} ${Q} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = unpack_mix_${ye}(a_${J}, u_${J}_t);\n#else\n    ${H} ${Q} ${J} = u_${J};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${H} ${de} a_${J};\n#else\nuniform ${H} ${Q} u_${J};\n#endif\n`:"vec4"===ye?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${H} ${Q} ${J} = a_${J};\n#else\n    ${H} ${Q} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${H} ${Q} ${J} = unpack_mix_${ye}(a_${J}, u_${J}_t);\n#else\n    ${H} ${Q} ${J} = u_${J};\n#endif\n`}),staticAttributes:y,usedDefines:T}}class lo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,g,y,A,T,N,k){this.context=i;let H=this.boundPaintVertexBuffers.length!==A.length;for(let J=0;!H&&J<A.length;J++)this.boundPaintVertexBuffers[J]!==A[J]&&(H=!0);let Q=this.boundDynamicVertexBuffers.length!==k.length;for(let J=0;!Q&&J<k.length;J++)this.boundDynamicVertexBuffers[J]!==k[J]&&(Q=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==y||H||Q||this.boundIndexBuffer!==T||this.boundVertexOffset!==N)this.freshBind(g,y,A,T,N,k);else{i.bindVertexArrayOES.set(this.vao);for(const J of k)J&&J.bind();T&&T.dynamicDraw&&T.bind()}}freshBind(i,g,y,A,T,N){let k;const H=i.numAttributes,Q=this.context,J=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=i,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=A,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=N;else{k=Q.currentNumAttributes||0;for(let de=H;de<k;de++)J.disableVertexAttribArray(de)}g.enableAttributes(J,i),g.bind(),g.setVertexAttribPointers(J,i,T);for(const de of y)de.enableAttributes(J,i),de.bind(),de.setVertexAttribPointers(J,i,T);for(const de of N)de&&(de.enableAttributes(J,i),de.bind(),de.setVertexAttribPointers(J,i,T));A&&A.bind(),Q.currentNumAttributes=H}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function na(_,i){const g=Math.pow(2,i.canonical.z),y=i.canonical.y;return[new f.MercatorCoordinate(0,y/g).toLngLat().lat,new f.MercatorCoordinate(0,(y+1)/g).toLngLat().lat]}function Da(_,i,g,y,A,T,N){const k=_.context,H=k.gl,Q=g.fbo;if(!Q)return;_.prepareDrawTile();const J=_.useProgram("hillshade");k.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Q.colorAttachment.get());const de=((Se,Me,he,Te)=>{const Be=he.paint.get("hillshade-shadow-color"),Ve=he.paint.get("hillshade-highlight-color"),tt=he.paint.get("hillshade-accent-color");let Qe=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===he.paint.get("hillshade-illumination-anchor")&&(Qe-=Se.transform.angle);const nt=!Se.options.moving;return{u_matrix:Te||Se.transform.calculateProjMatrix(Me.tileID.toUnwrapped(),nt),u_image:0,u_latrange:na(0,Me.tileID),u_light:[he.paint.get("hillshade-exaggeration"),Qe],u_shadow:Be,u_highlight:Ve,u_accent:tt}})(_,g,y,_.terrain?i.projMatrix:null);_.prepareDrawProgram(k,J,i.toUnwrapped());const{tileBoundsBuffer:ye,tileBoundsIndexBuffer:Ae,tileBoundsSegments:we}=_.getTileBoundsBuffers(g);J.draw(k,H.TRIANGLES,A,T,N,f.CullFaceMode.disabled,de,y.id,ye,Ae,we)}function Es(_,i,g){if(!i.needsDEMTextureUpload)return;const y=_.context,A=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||_.getTileTexture(g.stride);const T=g.getPixels();i.demTexture?i.demTexture.update(T,{premultiply:!1}):i.demTexture=new f.Texture(y,T,A.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ns(_,i,g,y,A,T){const N=_.context,k=N.gl;if(!i.dem)return;const H=i.dem;if(N.activeTexture.set(k.TEXTURE1),Es(_,i,H),!i.demTexture)return;i.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const Q=H.dim;N.activeTexture.set(k.TEXTURE0);let J=i.fbo;if(!J){const we=new f.Texture(N,{width:Q,height:Q,data:null},k.RGBA);we.bind(k.LINEAR,k.CLAMP_TO_EDGE),J=i.fbo=N.createFramebuffer(Q,Q,!0),J.colorAttachment.set(we.texture)}N.bindFramebuffer.set(J.framebuffer),N.viewport.set([0,0,Q,Q]);const{tileBoundsBuffer:de,tileBoundsIndexBuffer:ye,tileBoundsSegments:Ae}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(N,k.TRIANGLES,y,A,T,f.CullFaceMode.disabled,((we,Se)=>{const Me=Se.stride,he=f.create();return f.ortho(he,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(he,he,[0,-f.EXTENT,0]),{u_matrix:he,u_image:1,u_dimension:[Me,Me],u_zoom:we.overscaledZ,u_unpack:Se.unpackVector}})(i.tileID,H),g.id,de,ye,Ae),i.needsHillshadePrepare=!1}const Xa=_=>({u_matrix:new f.UniformMatrix4f(_),u_image0:new f.Uniform1i(_),u_skirt_height:new f.Uniform1f(_)}),_s=(_,i)=>({u_matrix:_,u_image0:0,u_skirt_height:i}),Us=(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:g,u_zoom_transition:A,u_merc_center:T,u_image0:0,u_frustum_tl:N,u_frustum_tr:k,u_frustum_br:H,u_frustum_bl:Q,u_globe_pos:J,u_globe_radius:de,u_viewport:ye,u_grid_matrix:we?Float32Array.from(we):new Float32Array(9),u_skirt_height:Ae});function ra(_,i){return null!=_&&null!=i&&!(!_.hasData()||!i.hasData())&&null!=_.demTexture&&null!=i.demTexture&&_.tileID.key!==i.tileID.key}const ia=new class{constructor(){this.operations={}}newMorphing(_,i,g,y,A){if(_ in this.operations){const T=this.operations[_];T.to.tileID.key!==g.tileID.key&&(T.queued=g)}else this.operations[_]={startTime:y,phase:0,duration:A,from:i,to:g,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const i=this.operations[_];return{from:i.from,to:i.to,phase:i.phase}}update(_){for(const i in this.operations){const g=this.operations[i];for(g.phase=(_-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,_)){delete this.operations[i];break}}}_nextOp(_,i){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=i,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Wr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function vl(_){return 6*Math.pow(1.5,22-_)}function Ya(_,i){const g=1<<_.z;return!i&&(0===_.x||_.x===g-1)||0===_.y||_.y===g-1}const za=_=>({u_matrix:_});function oa(_,i,g,y,A){if(A>0){const T=f.exported.now(),N=(T-_.timeAdded)/A,k=i?(T-i.timeAdded)/A:-1,H=g.getSource(),Q=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),J=!i||Math.abs(i.tileID.overscaledZ-Q)>Math.abs(_.tileID.overscaledZ-Q),de=J&&_.refreshedUponExpiration?1:f.clamp(J?N:1-k,0,1);return _.refreshedUponExpiration&&N>=1&&(_.refreshedUponExpiration=!1),i?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}class vs extends f.SourceCache{constructor(i){const g={type:"raster-dem",maxzoom:i.transform.maxZoom},y=new Zr(Je(),null),A=Tt("mock-dem",g,y,i.style);super("mock-dem",A,!1),A.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,g){i.state="loaded",g(null)}}class Ua extends f.SourceCache{constructor(i){const g=Tt("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Zr(Je(),null),i.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,g,y){if(i.freezeTileCoverage)return;this.transform=i;const A=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,N)=>{if(T[N.key]="",!this._tiles[N.key]){const k=new f.Tile(N,this._source.tileSize*N.overscaleFactor(),i.tileZoom);k.state="loaded",this._tiles[N.key]=k}return T},{});for(const T in this._tiles)T in A||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(i){const g=this.proxyCachedFBO[i];if(void 0!==g){const y=Object.values(g);this.renderCachePool.push(...y),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Zs extends f.OverscaledTileID{constructor(i,g,y){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=g,this.projMatrix=y}}class us extends f.Elevation{constructor(i,g){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,A,T]=function(H){const Q=new f.StructArrayLayout2i4,J=new f.StructArrayLayout3ui6;Q.reserve(17161),J.reserve(33800);const ye=f.EXTENT/128,Ae=f.EXTENT+ye/2,we=Ae+ye;for(let Me=-ye;Me<we;Me+=ye)for(let he=-ye;he<we;he+=ye){const Te=he<0||he>Ae||Me<0||Me>Ae?24575:0,Be=f.clamp(Math.round(he),0,f.EXTENT),Ve=f.clamp(Math.round(Me),0,f.EXTENT);Q.emplaceBack(Be+Te,Ve)}const Se=(Me,he)=>{const Te=131*he+Me;J.emplaceBack(Te+1,Te,Te+131),J.emplaceBack(Te+131,Te+131+1,Te+1)};for(let Me=1;Me<129;Me++)for(let he=1;he<129;he++)Se(he,Me);return[0,129].forEach(Me=>{for(let he=0;he<130;he++)Se(he,Me),Se(Me,he)}),[Q,J,32768]}(),N=i.context;this.gridBuffer=N.createVertexBuffer(y,f.posAttributes.members),this.gridIndexBuffer=N.createIndexBuffer(A),this.gridSegments=f.SegmentVector.simpleSegment(0,0,y.length,A.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ua(g.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,f.EXTENT,0,f.EXTENT,0,1);const k=N.gl;this._overlapStencilMode=new f.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vs(g.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,g,y){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const A=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(A.get("source")),this._exaggeration=A.get("exaggeration");const T=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(g,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),g.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=0===y._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(y.center),-1),this._emptyDEMTextureDirty=!this._initializing);const A=this.proxyCoords=g.getIds().map(H=>{const Q=g.getTileByID(H).tileID;return Q.projMatrix=y.calculateProjMatrix(Q.toUnwrapped()),Q});(function(H,Q){const J=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),de=new f.Point(J.x,J.y);H.sort((ye,Ae)=>{if(Ae.overscaledZ-ye.overscaledZ)return Ae.overscaledZ-ye.overscaledZ;const we=new f.Point(ye.canonical.x+(1<<ye.canonical.z)*ye.wrap,ye.canonical.y),Se=new f.Point(Ae.canonical.x+(1<<Ae.canonical.z)*Ae.wrap,Ae.canonical.y),Me=de.mult(1<<ye.canonical.z);return Me.x-=.5,Me.y-=.5,Me.distSqr(we)-Me.distSqr(Se)})})(A,this.painter),this._previousZoom=y.zoom;const T=this.proxyToSource||{};this.proxyToSource={},A.forEach(H=>{this.proxyToSource[H.key]={}}),this.terrainTileForTile={};const N=this._style._sourceCaches;for(const H in N){const Q=N[H];if(!Q.used||(Q!==this.sourceCache&&this.resetTileLookupCache(Q.id),this._setupProxiedCoordsForOrtho(Q,i[H],T),Q.usedForTerrain))continue;const J=i[H];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(J)}this.proxiedCoords[g.id]=A.map(H=>new Zs(H,H.key,this.orthoMatrix)),this._assignTerrainTiles(A),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const k={};this._visibleDemTiles=[];for(const H of this.proxyCoords){const Q=this.terrainTileForTile[H.key];if(!Q)continue;const J=Q.tileID.key;J in k||(this._visibleDemTiles.push(Q),k[J]=J)}}_assignTerrainTiles(i){this._initializing||i.forEach(g=>{if(this.terrainTileForTile[g.key])return;const y=this._findTileCoveringTileID(g,this.sourceCache);y&&(this.terrainTileForTile[g.key]=y)})}_prepareDEMTextures(){const i=this.painter.context,g=i.gl;for(const y in this.terrainTileForTile){const A=this.terrainTileForTile[y],T=A.dem;!T||A.demTexture&&!A.needsDEMTextureUpload||(i.activeTexture.set(g.TEXTURE1),Es(this.painter,A,T))}}_prepareDemTileUniforms(i,g,y,A){if(!g||null==g.demTexture)return!1;const T=i.tileID.canonical,N=Math.pow(2,g.tileID.canonical.z-T.z),k=A||"";return y[`u_dem_tl${k}`]=[T.x*N%1,T.y*N%1],y[`u_dem_scale${k}`]=N,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,g=i.gl;if(!this._emptyDepthBufferTexture){const y=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(i,y,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const g=this._visibleDemTiles.reduce((y,A)=>{if(!A.dem)return y;const T=A.dem.tree.minimums[0];return T>0&&i++,y+T},0);return i?g/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,g=i.gl;i.activeTexture.set(g.TEXTURE2);const y=this._getLoadedAreaMinimum(),A=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(A,{premultiply:!1}):T=this._emptyDEMTexture=new f.Texture(i,A,g.RGBA,{premultiply:!1}),T}setupElevationDraw(i,g,y){const A=this.painter.context,T=A.gl,N=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;N.u_dem_size=this.sourceCache.getSource().tileSize,N.u_exaggeration=this.exaggeration();let H=null,Q=null,J=1;if(y&&y.morphing&&this._useVertexMorphing){const de=y.morphing.srcDemTile,ye=y.morphing.dstDemTile;J=y.morphing.phase,de&&ye&&(this._prepareDemTileUniforms(i,de,N,"_prev")&&(Q=de),this._prepareDemTileUniforms(i,ye,N)&&(H=ye))}if(Q&&H?(A.activeTexture.set(T.TEXTURE2),H.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),A.activeTexture.set(T.TEXTURE4),Q.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),N.u_dem_lerp=J):(H=this.terrainTileForTile[i.tileID.key],A.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(i,H,N)?H.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),A.activeTexture.set(T.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(N.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),N.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&H){const de=(1<<H.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;N.u_meter_to_dem=de}if(y&&y.labelPlaneMatrixInv&&(N.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),g.setTerrainUniformValues(A,N),"globe"===this.painter.transform.projection.name){const de=this.globeUniformValues(this.painter.transform,i.tileID.canonical,y&&y.useDenormalizedUpVectorScale);g.setGlobeUniformValues(A,de)}}globeUniformValues(i,g,y){const A=i.projection;return{u_tile_tl_up:A.upVector(g,0,0),u_tile_tr_up:A.upVector(g,f.EXTENT,0),u_tile_br_up:A.upVector(g,f.EXTENT,f.EXTENT),u_tile_bl_up:A.upVector(g,0,f.EXTENT),u_tile_up_scale:y?f.globeMetersToEcef(1):A.upVectorScale(g,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const g=this.painter,y=this.painter.context;0!==i.length&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(A,T,N,k,H){if("globe"===A.transform.projection.name)!function(Q,J,de,ye,Ae){const we=Q.context,Se=we.gl;let Me,he;const Te=Q.options.showTerrainWireframe?2:0,Be=Q.transform,Ve=f.globeUseCustomAntiAliasing(Q,we,Be),tt=(yn,It)=>{if(he===yn)return;const on=[Wr[yn],"PROJECTION_GLOBE_VIEW"];Ve&&on.push("CUSTOM_ANTIALIASING"),It&&on.push(Wr[Te]),Me=Q.useProgram("globeRaster",null,on),he=yn},Qe=Q.colorModeForRenderPass(),nt=new f.DepthMode(Se.LEQUAL,f.DepthMode.ReadWrite,Q.depthRangeFor3D);ia.update(Ae);const vt=f.calculateGlobeMercatorMatrix(Be),pt=[f.mercatorXfromLng(Be.center.lng),f.mercatorYfromLat(Be.center.lat)],Lt=Te?[!1,!0]:[!1],En=Q.globeSharedBuffers,Ot=[Be.width*f.exported.devicePixelRatio,Be.height*f.exported.devicePixelRatio],sn=Float32Array.from(Be.globeMatrix),jt={useDenormalizedUpVectorScale:!0};if(Lt.forEach(yn=>{const It=Q.transform,on=vl(It.zoom)*J.exaggeration();he=-1;const Cn=yn?Se.LINES:Se.TRIANGLES;for(const gn of ye){const An=de.getTile(gn),Er=f.StencilMode.disabled,Kr=J.prevTerrainTileForTile[gn.key],sr=J.terrainTileForTile[gn.key];ra(Kr,sr)&&ia.newMorphing(gn.key,Kr,sr,Ae,250),we.activeTexture.set(Se.TEXTURE0),An.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);const Nr=ia.getMorphValuesForProxy(gn.key),_i=Nr?1:0;Nr&&f.extend$1(jt,{morphing:{srcDemTile:Nr.from,dstDemTile:Nr.to,phase:f.easeCubicInOut(Nr.phase)}});const oi=f.tileCornersToBounds(gn.canonical),dr=f.getLatitudinalLod(oi.getCenter().lat),Gi=f.getGridMatrix(gn.canonical,oi,dr,It.worldSize/It._pixelsPerMercatorPixel),oo=f.globeNormalizeECEF(f.globeTileBounds(gn.canonical)),uo=Us(It.projMatrix,sn,vt,oo,f.globeToMercatorTransition(It.zoom),pt,It.frustumCorners.TL,It.frustumCorners.TR,It.frustumCorners.BR,It.frustumCorners.BL,It.globeCenterInViewSpace,It.globeRadius,Ot,on,Gi);if(tt(_i,yn),J.setupElevationDraw(An,Me,jt),Q.prepareDrawProgram(we,Me,gn.toUnwrapped()),En){const[To,Oa,ua]=yn?En.getWirefameBuffers(Q.context,dr):En.getGridBuffers(dr,0!==on);Me.draw(we,Cn,nt,Er,Qe,f.CullFaceMode.backCCW,uo,"globe_raster",To,Oa,ua)}}}),En){const yn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ve&&yn.push("CUSTOM_ANTIALIASING"),Me=Q.useProgram("globeRaster",null,yn);for(const It of ye){const{x:on,y:Cn,z:gn}=It.canonical,An=0===Cn,Er=Cn===(1<<gn)-1,[Kr,sr,Nr,_i]=En.getPoleBuffers(gn);if(_i&&(An||Er)){const oi=de.getTile(It);we.activeTexture.set(Se.TEXTURE0),oi.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);let dr=f.globePoleMatrixForTile(gn,on,Be);const Gi=f.globeNormalizeECEF(f.globeTileBounds(It.canonical)),oo=(uo,To)=>uo.draw(we,Se.TRIANGLES,nt,f.StencilMode.disabled,Qe,f.CullFaceMode.disabled,Us(Be.projMatrix,dr,dr,Gi,0,pt,Be.frustumCorners.TL,Be.frustumCorners.TR,Be.frustumCorners.BR,Be.frustumCorners.BL,Be.globeCenterInViewSpace,Be.globeRadius,Ot,0),"globe_pole_raster",To,Nr,_i);J.setupElevationDraw(oi,Me,jt),Q.prepareDrawProgram(we,Me,It.toUnwrapped()),An&&oo(Me,Kr),Er&&(dr=f.scale(f.create(),dr,[1,-1,1]),oo(Me,sr))}}}}(A,T,N,k,H);else{const Q=A.context,J=Q.gl;let de,ye;const Ae=A.options.showTerrainWireframe?2:0,we=(Be,Ve)=>{if(ye===Be)return;const tt=[Wr[Be]];Ve&&tt.push(Wr[Ae]),de=A.useProgram("terrainRaster",null,tt),ye=Be},Se=A.colorModeForRenderPass(),Me=new f.DepthMode(J.LEQUAL,f.DepthMode.ReadWrite,A.depthRangeFor3D);ia.update(H);const he=A.transform,Te=vl(he.zoom)*T.exaggeration();(Ae?[!1,!0]:[!1]).forEach(Be=>{ye=-1;const Ve=Be?J.LINES:J.TRIANGLES,[tt,Qe]=Be?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const nt of k){const vt=N.getTile(nt),pt=f.StencilMode.disabled,Lt=T.prevTerrainTileForTile[nt.key],En=T.terrainTileForTile[nt.key];ra(Lt,En)&&ia.newMorphing(nt.key,Lt,En,H,250),Q.activeTexture.set(J.TEXTURE0),vt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const Ot=ia.getMorphValuesForProxy(nt.key),sn=Ot?1:0;let jt;Ot&&(jt={morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:f.easeCubicInOut(Ot.phase)}});const yn=_s(nt.projMatrix,Ya(nt.canonical,he.renderWorldCopies)?Te/10:Te);we(sn,Be),T.setupElevationDraw(vt,de,jt),A.prepareDrawProgram(Q,de,nt.toUnwrapped()),de.draw(Q,Ve,Me,pt,Se,f.CullFaceMode.backCCW,yn,"terrain_raster",T.gridBuffer,tt,Qe)}})}}(g,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const g=this.painter,y=this.painter.context,A=this.proxySourceCache,T=this.proxiedCoords[A.id],N=this._drapedRenderBatches.shift(),k=[],H=g.style.order;let Q=0;for(const J of T){const de=A.getTileByID(J.proxyTileKey),ye=A.proxyCachedFBO[J.key]?A.proxyCachedFBO[J.key][i]:void 0,Ae=void 0!==ye?A.renderCache[ye]:this.pool[Q++],we=void 0!==ye;if(de.texture=Ae.tex,we&&!Ae.dirty){k.push(de.tileID);continue}let Se;y.bindFramebuffer.set(Ae.fb.framebuffer),this.renderedToTile=!1,Ae.dirty&&(y.clear({color:f.Color.transparent,stencil:0}),Ae.dirty=!1);for(let Me=N.start;Me<=N.end;++Me){const he=g.style._layers[H[Me]];if(he.isHidden(g.transform.zoom))continue;const Te=g.style._getLayerSourceCache(he),Be=Te?this.proxyToSource[J.key][Te.id]:[J];if(!Be)continue;const Ve=Be;y.viewport.set([0,0,Ae.fb.width,Ae.fb.height]),Se!==(Te?Te.id:null)&&(this._setupStencil(Ae,Be,he,Te),Se=Te?Te.id:null),g.renderLayer(g,Te,he,Ve)}this.renderedToTile?(Ae.dirty=!0,k.push(de.tileID)):we||--Q,5===Q&&(Q=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]),N.end+1}postRender(){}renderCacheEfficiency(i){const g=i.order.length;if(0===g)return{efficiency:100};let y,A=0,T=0,N=!1;for(let k=0;k<g;++k){const H=i._layers[i.order[k]];this._style.isLayerDraped(H)?(N&&++A,++T):N||(N=!0,y=H.id)}return 0===T?{efficiency:100}:{efficiency:100*(1-A/T),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{i=Math.min(i,g.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,g,y){if(!this._visibleDemTiles)return null;const A=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const N=T.tileID,k=1<<N.overscaledZ,{x:H,y:Q}=N.canonical,J=H/k,de=(H+1)/k,ye=Q/k,Ae=(Q+1)/k;return{minx:J,miny:ye,maxx:de,maxy:Ae,t:T.dem.tree.raycastRoot(J,ye,de,Ae,i,g,y),tile:T}});A.sort((T,N)=>(null!==T.t?T.t:Number.MAX_VALUE)-(null!==N.t?N.t:Number.MAX_VALUE));for(const T of A){if(null==T.t)return null;const N=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,i,g,y);if(null!=N)return N}return null}_createFBO(){const i=this.painter.context,g=i.gl,y=this.drapeBufferSize;i.activeTexture.set(g.TEXTURE0);const A=new f.Texture(i,{width:y[0],height:y[1],data:null},g.RGBA);A.bind(g.LINEAR,g.CLAMP_TO_EDGE);const T=i.createFramebuffer(y[0],y[1],!1);return T.colorAttachment.set(A.texture),T.depthAttachment=new Ye(i,T.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:T,tex:A,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const g=this._style._layers[i],y=g.isHidden(this.painter.transform.zoom);return"custom"===g.type?!y&&g.shouldRedrape():!y&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const y of this._style._getSources())if(y instanceof Mn){i=!0;break}if(!i)return;const g={};for(let y=0;y<this._style.order.length;++y){const A=this._style._layers[this._style.order[y]],T=this._style._getLayerSourceCache(A);if(T&&!g[T.id]&&!A.isHidden(this.painter.transform.zoom)&&"line"===A.type&&A.widthExpression()instanceof f.ZoomDependentExpression){g[T.id]=!0;for(const N of this.proxyCoords){const k=this.proxyToSource[N.key][T.id];if(k)for(const H of k)this._clearRenderCacheForTile(T.id,H)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const y in this._style._sourceCaches)if(this._style._sourceCaches[y]._source instanceof Ze){i=!0;break}if(!i)return;const g={};for(let y=0;y<this._style.order.length;++y){const A=this._style._layers[this._style.order[y]],T=this._style._getLayerSourceCache(A);if(!T||g[T.id]||A.isHidden(this.painter.transform.zoom)||"raster"!==A.type)continue;const N=A.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const H=this.proxyToSource[k.key][T.id];if(H)for(const Q of H){const J=oa(T.getTile(Q),T.findLoadedParent(Q,0),T,this.painter.transform,N);(1!==J.opacity||0!==J.mix)&&this._clearRenderCacheForTile(T.id,Q)}}}}_setupDrapedRenderBatches(){const i=this._style.order,g=i.length;if(0===g)return;const y=[];let A,T=0,N=this._style._layers[i[T]];for(;!this._style.isLayerDraped(N)&&N.isHidden(this.painter.transform.zoom)&&++T<g;)N=this._style._layers[i[T]];for(;T<g;++T){const k=this._style._layers[i[T]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===A&&(A=T):void 0!==A&&(y.push({start:A,end:T-1}),A=void 0))}void 0!==A&&y.push({start:A,end:T-1}),this._drapedRenderBatches=y}_setupRenderCache(i){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const N=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let k=0;k<N.length;++k){const H=Object.values(N[k]);g.renderCachePool.push(...H)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,A=this._tilesDirty;for(let N=y.length-1;N>=0;N--){const k=y[N];if(g.getTileByID(k.key),void 0!==g.proxyCachedFBO[k.key]){const H=i[k.key],Q=this.proxyToSource[k.key];let J=0;for(const de in Q){const ye=Q[de],Ae=H[de];if(!Ae||Ae.length!==ye.length||ye.some((we,Se)=>we!==Ae[Se]||A[de]&&A[de].hasOwnProperty(we.key))){J=-1;break}++J}for(const de in g.proxyCachedFBO[k.key])g.renderCache[g.proxyCachedFBO[k.key][de]].dirty=J<0||J!==Object.values(H).length}}const T=[...this._drapedRenderBatches];T.sort((N,k)=>k.end-k.start-(N.end-N.start));for(const N of T)for(const k of y){if(g.proxyCachedFBO[k.key])continue;let H=g.renderCachePool.pop();void 0===H&&g.renderCache.length<50&&(H=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==H&&(g.proxyCachedFBO[k.key]={},g.proxyCachedFBO[k.key][N.start]=H,g.renderCache[H].dirty=!0)}this._tilesDirty={}}_setupStencil(i,g,y,A){if(!A||!this._sourceTilesOverlap[A.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,N=T.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let k;if(y.isTileClipped())k=g.length,this._overlapStencilMode.test={func:N.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:N.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(i,g){const y=this.painter,A=this.painter.context,T=A.gl;y._tileClippingMaskIDs={},A.setColorMode(f.ColorMode.disabled),A.setDepthMode(f.DepthMode.disabled);const N=y.useProgram("clippingMask");for(const k of i){const H=y._tileClippingMaskIDs[k.key]=--g;N.draw(A,T.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:T.ALWAYS,mask:0},H,255,T.KEEP,T.KEEP,T.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,za(k.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(i){const g=this.painter.transform;if(i.x<0||i.x>g.width||i.y<0||i.y>g.height)return null;const y=[i.x,i.y,1,1];f.transformMat4$1(y,y,g.pixelMatrixInverse),f.scale$1(y,y,1/y[3]),y[0]/=g.worldSize,y[1]/=g.worldSize;const A=g._camera.position,T=f.mercatorZfromAltitude(1,g.center.lat),N=[A[0],A[1],A[2]/T,0],k=f.subtract([],y.slice(0,3),N);f.normalize(k,k);const H=this.raycast(N,k,this._exaggeration);return null!==H&&H?(f.scaleAndAdd(N,N,k,H),N[3]=N[2],N[2]*=T,N):null}drawDepth(){const i=this.painter,g=i.context,y=this.proxySourceCache,A=Math.ceil(i.width),T=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===A&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const N=g.gl,k=g.createFramebuffer(A,T,!0);g.activeTexture.set(N.TEXTURE0);const H=new f.Texture(g,{width:A,height:T,data:null},N.RGBA);H.bind(N.NEAREST,N.CLAMP_TO_EDGE),k.colorAttachment.set(H.texture);const Q=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,A,T);k.depthAttachment.set(Q),this._depthFBO=k,this._depthTexture=H}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,A,T]),function(N,k,H,Q){if("globe"===N.transform.projection.name)return;const J=N.context,de=J.gl;J.clear({depth:1});const ye=N.useProgram("terrainDepth"),Ae=new f.DepthMode(de.LESS,f.DepthMode.ReadWrite,N.depthRangeFor3D);for(const we of Q){const Se=H.getTile(we),Me=_s(we.projMatrix,0);k.setupElevationDraw(Se,ye),ye.draw(J,de.TRIANGLES,Ae,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,Me,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(i,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,g,y){if(i.getSource()instanceof De)return this._setupProxiedCoordsForImageSource(i,g,y);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const A=this.proxiedCoords[i.id]=[],T=this.proxyCoords;for(let k=0;k<T.length;k++){const H=T[k],Q=this._findTileCoveringTileID(H,i);if(Q){const J=this._createProxiedId(H,Q,y[H.key]&&y[H.key][i.id]);A.push(J),this.proxyToSource[H.key][i.id]=[J]}}let N=!1;for(let k=0;k<g.length;k++){const H=i.getTile(g[k]);if(!H||!H.hasData())continue;const Q=this._findTileCoveringTileID(H.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==H.tileID.canonical.z){const J=this.proxyToSource[Q.tileID.key][i.id],de=this._createProxiedId(Q.tileID,H,y[Q.tileID.key]&&y[Q.tileID.key][i.id]);J?J.splice(J.length-1,0,de):this.proxyToSource[Q.tileID.key][i.id]=[de],A.push(de),N=!0}}this._sourceTilesOverlap[i.id]=N}_setupProxiedCoordsForImageSource(i,g,y){if(!i.getSource().loaded())return;const A=this.proxiedCoords[i.id]=[],T=this.proxyCoords,N=i.getSource(),k=new f.Point(N.tileID.x,N.tileID.y)._div(1<<N.tileID.z),H=N.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((J,de)=>(J.min.x=Math.min(J.min.x,de.x-k.x),J.min.y=Math.min(J.min.y,de.y-k.y),J.max.x=Math.max(J.max.x,de.x-k.x),J.max.y=Math.max(J.max.y,de.y-k.y),J),{min:new f.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(J,de)=>{const ye=J.wrap+J.canonical.x/(1<<J.canonical.z),Ae=J.canonical.y/(1<<J.canonical.z),we=f.EXTENT/(1<<J.canonical.z),Se=de.wrap+de.canonical.x/(1<<de.canonical.z),Me=de.canonical.y/(1<<de.canonical.z);return ye+we<Se+H.min.x||ye>Se+H.max.x||Ae+we<Me+H.min.y||Ae>Me+H.max.y};for(let J=0;J<T.length;J++){const de=T[J];for(let ye=0;ye<g.length;ye++){const Ae=i.getTile(g[ye]);if(!Ae||!Ae.hasData()||Q(de,Ae.tileID))continue;const we=this._createProxiedId(de,Ae,y[de.key]&&y[de.key][i.id]),Se=this.proxyToSource[de.key][i.id];Se?Se.push(we):this.proxyToSource[de.key][i.id]=[we],A.push(we)}}}_createProxiedId(i,g,y){let A=this.orthoMatrix;if(y){const T=y.find(N=>N.key===g.tileID.key);if(T)return T}if(g.tileID.key!==i.key){const T=i.canonical.z-g.tileID.canonical.z;let N,k,H;A=f.create();const Q=g.tileID.wrap-i.wrap<<i.overscaledZ;T>0?(N=f.EXTENT>>T,k=N*((g.tileID.canonical.x<<T)-i.canonical.x+Q),H=N*((g.tileID.canonical.y<<T)-i.canonical.y)):(N=f.EXTENT<<-T,k=f.EXTENT*(g.tileID.canonical.x-(i.canonical.x+Q<<-T)),H=f.EXTENT*(g.tileID.canonical.y-(i.canonical.y<<-T))),f.ortho(A,0,N,0,N,0,1),f.translate(A,A,[k,H,0])}return new Zs(g.tileID,i.key,A)}_findTileCoveringTileID(i,g){let y=g.getTile(i);if(y&&y.hasData())return y;const A=this._findCoveringTileCache[g.id],T=A[i.key];if(y=T?g.getTileByID(T):null,y&&y.hasData()||null===T)return y;let N=y?y.tileID:i,k=N.overscaledZ;const H=g.getSource().minzoom,Q=[];if(!T){const de=g.getSource().maxzoom;if(i.canonical.z>=de){const ye=i.canonical.z-de;g.getSource().reparseOverscaled?(k=Math.max(i.canonical.z+2,g.transform.tileZoom),N=new f.OverscaledTileID(k,i.wrap,de,i.canonical.x>>ye,i.canonical.y>>ye)):0!==ye&&(k=de,N=new f.OverscaledTileID(k,i.wrap,de,i.canonical.x>>ye,i.canonical.y>>ye))}N.key!==i.key&&(Q.push(N.key),y=g.getTile(N))}const J=de=>{Q.forEach(ye=>{A[ye]=de}),Q.length=0};for(k-=1;k>=H&&(!y||!y.hasData());k--){y&&J(y.tileID.key);const de=N.calculateScaledKey(k);if(y=g.getTileByID(de),y&&y.hasData())break;const ye=A[de];if(null===ye)break;void 0===ye?Q.push(de):y=g.getTileByID(ye)}return J(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,g){let y=this._tilesDirty[i];y||(y=this._tilesDirty[i]={}),y[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(g){let y=0;const A=new f.StructArrayLayout2ui4,T=131;for(let N=1;N<129;N++){for(let k=1;k<129;k++)y=N*T+k,A.emplaceBack(y,y+1),A.emplaceBack(y,y+T),A.emplaceBack(y+1,y+T),128===N&&A.emplaceBack(y+T,y+T+1);A.emplaceBack(y+1,y+1+T)}return A}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ri{static cacheKey(i,g,y,A){let T=`${g}${A?A.cacheKey:""}`;for(const N of y)i.usedDefines.includes(N)&&(T+=`/${N}`);return T}constructor(i,g,y,A,T,N){const k=i.gl;this.program=k.createProgram();const H=function(he){const Te=[];for(let Be=0;Be<he.length;Be++){if(null===he[Be])continue;const Ve=he[Be].split(" ");Te.push(Ve.pop())}return Te}(y.staticAttributes),Q=A?A.getBinderAttributes():[],J=H.concat(Q);let de=A?A.defines():[];de=de.concat(N.map(he=>`#define ${he}`));const ye=i.isWebGL2?"#version 300 es\n":"",Ae=ye+de.concat(i.extStandardDerivatives&&0===ye.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Or):Or,Or,ta,Ws.fragmentSource,Aa.fragmentSource,y.fragmentSource).join("\n"),we=ye+de.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ta,Ws.vertexSource,Aa.vertexSource,Co.vertexSource,y.vertexSource).join("\n"),Se=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Se,Ae),k.compileShader(Se),k.attachShader(this.program,Se);const Me=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Me,we),k.compileShader(Me),k.attachShader(this.program,Me),this.attributes={},this.numAttributes=J.length;for(let he=0;he<this.numAttributes;he++)J[he]&&(k.bindAttribLocation(this.program,he,J[he]),this.attributes[J[he]]=he);k.linkProgram(this.program),k.deleteShader(Me),k.deleteShader(Se),this.fixedUniforms=T(i),this.binderUniforms=A?A.getUniforms(i):[],N.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(he=i),u_dem_prev:new f.Uniform1i(he),u_dem_unpack:new f.Uniform4f(he),u_dem_tl:new f.Uniform2f(he),u_dem_scale:new f.Uniform1f(he),u_dem_tl_prev:new f.Uniform2f(he),u_dem_scale_prev:new f.Uniform1f(he),u_dem_size:new f.Uniform1f(he),u_dem_lerp:new f.Uniform1f(he),u_exaggeration:new f.Uniform1f(he),u_depth:new f.Uniform1i(he),u_depth_size_inv:new f.Uniform2f(he),u_meter_to_dem:new f.Uniform1f(he),u_label_plane_matrix_inv:new f.UniformMatrix4f(he)}),N.includes("GLOBE")&&(this.globeUniforms=(he=>({u_tile_tl_up:new f.Uniform3f(he),u_tile_tr_up:new f.Uniform3f(he),u_tile_br_up:new f.Uniform3f(he),u_tile_bl_up:new f.Uniform3f(he),u_tile_up_scale:new f.Uniform1f(he)}))(i)),N.includes("FOG")&&(this.fogUniforms=(he=>({u_fog_matrix:new f.UniformMatrix4f(he),u_fog_range:new f.Uniform2f(he),u_fog_color:new f.Uniform4f(he),u_fog_horizon_blend:new f.Uniform1f(he),u_fog_temporal_offset:new f.Uniform1f(he),u_frustum_tl:new f.Uniform3f(he),u_frustum_tr:new f.Uniform3f(he),u_frustum_br:new f.Uniform3f(he),u_frustum_bl:new f.Uniform3f(he),u_globe_pos:new f.Uniform3f(he),u_globe_radius:new f.Uniform1f(he),u_globe_transition:new f.Uniform1f(he),u_is_globe:new f.Uniform1i(he),u_viewport:new f.Uniform2f(he)}))(i))}var he}setTerrainUniformValues(i,g){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const A in g)y[A]&&y[A].set(this.program,A,g[A])}}setGlobeUniformValues(i,g){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const A in g)y[A]&&y[A].set(this.program,A,g[A])}}setFogUniformValues(i,g){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const A in g)y[A].set(this.program,A,g[A])}}draw(i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se){const Me=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(y),i.setStencilMode(A),i.setColorMode(T),i.setCullFace(N);for(const Te of Object.keys(this.fixedUniforms))this.fixedUniforms[Te].set(this.program,Te,k[Te]);we&&we.setUniforms(this.program,i,this.binderUniforms,ye,{zoom:Ae});const he={[Me.LINES]:2,[Me.TRIANGLES]:3,[Me.LINE_STRIP]:1}[g];for(const Te of de.get()){const Be=Te.vaos||(Te.vaos={});(Be[H]||(Be[H]=new lo)).bind(i,this,Q,we?we.getPaintVertexBuffers():[],J,Te.vertexOffset,Se||[]),Me.drawElements(g,Te.primitiveLength*he,Me.UNSIGNED_SHORT,Te.primitiveOffset*he*2)}}}function ie(_,i){const g=Math.pow(2,i.tileID.overscaledZ),y=i.tileSize*Math.pow(2,_.transform.tileZoom)/g,A=y*(i.tileID.canonical.x+i.tileID.wrap*g),T=y*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ln(i,1,_.transform.tileZoom),u_pixel_coord_upper:[A>>16,T>>16],u_pixel_coord_lower:[65535&A,65535&T]}}const K=f.create(),le=(_,i,g,y,A,T,N,k,H,Q,J)=>{const de=i.style.light,ye=de.properties.get("position"),Ae=[ye.x,ye.y,ye.z],we=f.create$1();"viewport"===de.properties.get("anchor")&&(f.fromRotation(we,-i.transform.angle),f.transformMat3(Ae,Ae,we));const Se=de.properties.get("color"),Me=i.transform,he={u_matrix:_,u_lightpos:Ae,u_lightintensity:de.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+g,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:K,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:A,u_edge_radius:T};return"globe"===Me.projection.name&&(he.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],he.u_zoom_transition=H,he.u_inv_rot_matrix=J,he.u_merc_center=Q,he.u_up_dir=Me.projection.upVector(new f.CanonicalTileID(0,0,0),Q[0]*f.EXTENT,Q[1]*f.EXTENT),he.u_height_lift=k),he},Ie=(_,i,g,y,A,T,N,k,H,Q,J,de)=>{const ye=le(_,i,g,y,A,T,N,H,Q,J,de),Ae={u_height_factor:-Math.pow(2,N.overscaledZ)/k.tileSize/8};return f.extend(ye,ie(i,k),Ae)},Ge=_=>({u_matrix:_}),yt=(_,i,g)=>f.extend(Ge(_),ie(i,g)),vn=(_,i)=>({u_matrix:_,u_world:i}),Sn=(_,i,g,y)=>f.extend(yt(_,i,g),{u_world:y}),re=f.create(),ue=(_,i,g,y,A,T)=>{const N=_.transform,k="globe"===N.projection.name;let H;if("map"===T.paint.get("circle-pitch-alignment"))if(k){const J=f.globePixelsToTileUnits(N.zoom,i.canonical)*N._pixelsPerMercatorPixel;H=Float32Array.from([J,0,0,J])}else H=N.calculatePixelsToTileUnitsMatrix(g);else H=new Float32Array([N.pixelsToGLUnits[0],0,0,N.pixelsToGLUnits[1]]);const Q={u_camera_to_center_distance:N.cameraToCenterDistance,u_matrix:_.translatePosMatrix(i.projMatrix,g,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:H,u_inv_rot_matrix:re,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){Q.u_inv_rot_matrix=y,Q.u_merc_center=A,Q.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],Q.u_zoom_transition=f.globeToMercatorTransition(N.zoom);const J=A[0]*f.EXTENT,de=A[1]*f.EXTENT;Q.u_up_dir=N.projection.upVector(new f.CanonicalTileID(0,0,0),J,de)}return Q},X=_=>{const i=[];return"map"===_.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},be=(_,i,g,y)=>{const A=f.EXTENT/g.tileSize;return{u_matrix:_,u_camera_to_center_distance:i.getCameraToCenterDistance(y),u_extrude_scale:[i.pixelsToGLUnits[0]/A,i.pixelsToGLUnits[1]/A]}},qe=(_,i,g=1)=>({u_matrix:_,u_color:i,u_overlay:0,u_overlay_scale:g}),On=f.create(),lr=(_,i,g,y,A,T,N)=>{const k=_.transform,H="globe"===k.projection.name,Q=H?f.globePixelsToTileUnits(k.zoom,i.canonical)*k._pixelsPerMercatorPixel:Ln(g,1,T),J={u_matrix:i.projMatrix,u_extrude_scale:Q,u_intensity:N,u_inv_rot_matrix:On,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(H){J.u_inv_rot_matrix=y,J.u_merc_center=A,J.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],J.u_zoom_transition=f.globeToMercatorTransition(k.zoom);const de=A[0]*f.EXTENT,ye=A[1]*f.EXTENT;J.u_up_dir=k.projection.upVector(new f.CanonicalTileID(0,0,0),de,ye)}return J},Br=(_,i,g,y,A,T,N)=>{const k=_.transform,H=k.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:ki(_,i,g,y),u_pixels_to_tile_units:H,u_device_pixel_ratio:T,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:A,u_texsize:eo(g)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ti(i,_.transform),u_alpha_discard_threshold:0,u_trim_offset:N}},ii=(_,i,g,y,A)=>{const T=_.transform;return{u_matrix:ki(_,i,g,y),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:A,u_image:0,u_tile_units_to_pixels:Ti(i,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ti(_,i){return 1/Ln(_,1,i.tileZoom)}function ki(_,i,g,y){return _.translatePosMatrix(y||i.tileID.projMatrix,i,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function eo(_){const i=_.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Qr=(_,i,g,y,A,T)=>{return{u_matrix:_,u_tl_parent:i,u_scale_parent:g,u_fade_t:y.mix,u_opacity:y.opacity*A.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:A.paint.get("raster-brightness-min"),u_brightness_high:A.paint.get("raster-brightness-max"),u_saturation_factor:(k=A.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(N=A.paint.get("raster-contrast"),N>0?1/(1-N):1+N),u_spin_weights:Gr(A.paint.get("raster-hue-rotate")),u_perspective_transform:T};var N,k};function Gr(_){_*=Math.PI/180;const i=Math.sin(_),g=Math.cos(_);return[(2*g+1)/3,(-Math.sqrt(3)*i-g+1)/3,(Math.sqrt(3)*i-g+1)/3]}const Bi=f.create(),Bo=(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se)=>{const Me=A.transform,he={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Me.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:Me.width/Me.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:N,u_coord_matrix:k,u_is_text:+H,u_pitch_with_map:+y,u_texsize:Q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bi,u_up_vector:[0,-1,0]};return"globe"===Se.name&&(he.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],he.u_zoom_transition=de,he.u_inv_rot_matrix=Ae,he.u_merc_center=ye,he.u_camera_forward=Me._camera.forward(),he.u_ecef_origin=f.globeECEFOrigin(Me.globeMatrix,J.toUnwrapped()),he.u_tile_matrix=Float32Array.from(Me.globeMatrix),he.u_up_vector=we),he},zo=(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se,Me)=>f.extend(Bo(_,i,g,y,A,T,N,k,H,Q,de,ye,Ae,we,Se,Me),{u_gamma_scale:y?A.transform.cameraToCenterDistance*Math.cos(A.terrain?0:A.transform._pitch):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+J}),Wo=(_,i,g,y,A,T,N,k,H,Q,J,de,ye,Ae,we,Se)=>f.extend(zo(_,i,g,y,A,T,N,k,!0,H,!0,J,de,ye,Ae,we,Se),{u_texsize_icon:Q,u_texture_icon:1}),Uo=(_,i,g)=>({u_matrix:_,u_opacity:i,u_color:g}),qs=(_,i,g,y,A)=>f.extend(function(T,N,k){const H=N.imageManager.getPattern(T.toString()),{width:Q,height:J}=N.imageManager.getPixelSize(),de=Math.pow(2,k.tileID.overscaledZ),ye=k.tileSize*Math.pow(2,N.transform.tileZoom)/de,Ae=ye*(k.tileID.canonical.x+k.tileID.wrap*de),we=ye*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[Q,J],u_pattern_size:H.displaySize,u_tile_units_to_pixels:1/Ln(k,1,N.transform.tileZoom),u_pixel_coord_upper:[Ae>>16,we>>16],u_pixel_coord_lower:[65535&Ae,65535&we]}}(y,g,A),{u_matrix:_,u_opacity:i}),sa={fillExtrusion:_=>({u_matrix:new f.UniformMatrix4f(_),u_lightpos:new f.Uniform3f(_),u_lightintensity:new f.Uniform1f(_),u_lightcolor:new f.Uniform3f(_),u_vertical_gradient:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_edge_radius:new f.Uniform1f(_),u_ao:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_up_dir:new f.Uniform3f(_),u_height_lift:new f.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_lightpos:new f.Uniform3f(_),u_lightintensity:new f.Uniform1f(_),u_lightcolor:new f.Uniform3f(_),u_vertical_gradient:new f.Uniform1f(_),u_height_factor:new f.Uniform1f(_),u_edge_radius:new f.Uniform1f(_),u_ao:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_up_dir:new f.Uniform3f(_),u_height_lift:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_)}),fill:_=>({u_matrix:new f.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),fillOutline:_=>({u_matrix:new f.UniformMatrix4f(_),u_world:new f.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_world:new f.Uniform2f(_),u_image:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new f.Uniform1f(_),u_extrude_scale:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_up_dir:new f.Uniform3f(_)}),collisionBox:_=>({u_matrix:new f.UniformMatrix4f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_extrude_scale:new f.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new f.UniformMatrix4f(_),u_inv_matrix:new f.UniformMatrix4f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_viewport_size:new f.Uniform2f(_)}),debug:_=>({u_color:new f.UniformColor(_),u_matrix:new f.UniformMatrix4f(_),u_overlay:new f.Uniform1i(_),u_overlay_scale:new f.Uniform1f(_)}),clippingMask:_=>({u_matrix:new f.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new f.Uniform1f(_),u_intensity:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_up_dir:new f.Uniform3f(_)}),heatmapTexture:_=>({u_image:new f.Uniform1i(_),u_color_ramp:new f.Uniform1i(_),u_opacity:new f.Uniform1f(_)}),hillshade:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_latrange:new f.Uniform2f(_),u_light:new f.Uniform2f(_),u_shadow:new f.UniformColor(_),u_highlight:new f.UniformColor(_),u_accent:new f.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new f.UniformMatrix4f(_),u_image:new f.Uniform1i(_),u_dimension:new f.Uniform2f(_),u_zoom:new f.Uniform1f(_),u_unpack:new f.Uniform4f(_)}),line:_=>({u_matrix:new f.UniformMatrix4f(_),u_pixels_to_tile_units:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_units_to_pixels:new f.Uniform2f(_),u_dash_image:new f.Uniform1i(_),u_gradient_image:new f.Uniform1i(_),u_image_height:new f.Uniform1f(_),u_texsize:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_alpha_discard_threshold:new f.Uniform1f(_),u_trim_offset:new f.Uniform2f(_)}),linePattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_texsize:new f.Uniform2f(_),u_pixels_to_tile_units:new f.UniformMatrix2f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_units_to_pixels:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_),u_alpha_discard_threshold:new f.Uniform1f(_)}),raster:_=>({u_matrix:new f.UniformMatrix4f(_),u_tl_parent:new f.Uniform2f(_),u_scale_parent:new f.Uniform1f(_),u_fade_t:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_image0:new f.Uniform1i(_),u_image1:new f.Uniform1i(_),u_brightness_low:new f.Uniform1f(_),u_brightness_high:new f.Uniform1f(_),u_saturation_factor:new f.Uniform1f(_),u_contrast_factor:new f.Uniform1f(_),u_spin_weights:new f.Uniform3f(_),u_perspective_transform:new f.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_camera_forward:new f.Uniform3f(_),u_tile_matrix:new f.UniformMatrix4f(_),u_up_vector:new f.Uniform3f(_),u_ecef_origin:new f.Uniform3f(_),u_texture:new f.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_texture:new f.Uniform1i(_),u_gamma_scale:new f.Uniform1f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_tile_id:new f.Uniform3f(_),u_zoom_transition:new f.Uniform1f(_),u_inv_rot_matrix:new f.UniformMatrix4f(_),u_merc_center:new f.Uniform2f(_),u_camera_forward:new f.Uniform3f(_),u_tile_matrix:new f.UniformMatrix4f(_),u_up_vector:new f.Uniform3f(_),u_ecef_origin:new f.Uniform3f(_),u_is_halo:new f.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new f.Uniform1i(_),u_is_size_feature_constant:new f.Uniform1i(_),u_size_t:new f.Uniform1f(_),u_size:new f.Uniform1f(_),u_camera_to_center_distance:new f.Uniform1f(_),u_rotate_symbol:new f.Uniform1i(_),u_aspect_ratio:new f.Uniform1f(_),u_fade_change:new f.Uniform1f(_),u_matrix:new f.UniformMatrix4f(_),u_label_plane_matrix:new f.UniformMatrix4f(_),u_coord_matrix:new f.UniformMatrix4f(_),u_is_text:new f.Uniform1i(_),u_pitch_with_map:new f.Uniform1i(_),u_texsize:new f.Uniform2f(_),u_texsize_icon:new f.Uniform2f(_),u_texture:new f.Uniform1i(_),u_texture_icon:new f.Uniform1i(_),u_gamma_scale:new f.Uniform1f(_),u_device_pixel_ratio:new f.Uniform1f(_),u_is_halo:new f.Uniform1i(_)}),background:_=>({u_matrix:new f.UniformMatrix4f(_),u_opacity:new f.Uniform1f(_),u_color:new f.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new f.UniformMatrix4f(_),u_opacity:new f.Uniform1f(_),u_image:new f.Uniform1i(_),u_pattern_tl:new f.Uniform2f(_),u_pattern_br:new f.Uniform2f(_),u_texsize:new f.Uniform2f(_),u_pattern_size:new f.Uniform2f(_),u_pixel_coord_upper:new f.Uniform2f(_),u_pixel_coord_lower:new f.Uniform2f(_),u_tile_units_to_pixels:new f.Uniform1f(_)}),terrainRaster:Xa,terrainDepth:Xa,skybox:_=>({u_matrix:new f.UniformMatrix4f(_),u_sun_direction:new f.Uniform3f(_),u_cubemap:new f.Uniform1i(_),u_opacity:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new f.UniformMatrix4f(_),u_color_ramp:new f.Uniform1i(_),u_center_direction:new f.Uniform3f(_),u_radius:new f.Uniform1f(_),u_opacity:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new f.UniformMatrix3f(_),u_sun_direction:new f.Uniform3f(_),u_sun_intensity:new f.Uniform1f(_),u_color_tint_r:new f.Uniform4f(_),u_color_tint_m:new f.Uniform4f(_),u_luminance:new f.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new f.UniformMatrix4f(_),u_globe_matrix:new f.UniformMatrix4f(_),u_normalize_matrix:new f.UniformMatrix4f(_),u_merc_matrix:new f.UniformMatrix4f(_),u_zoom_transition:new f.Uniform1f(_),u_merc_center:new f.Uniform2f(_),u_image0:new f.Uniform1i(_),u_grid_matrix:new f.UniformMatrix3f(_),u_skirt_height:new f.Uniform1f(_),u_frustum_tl:new f.Uniform3f(_),u_frustum_tr:new f.Uniform3f(_),u_frustum_br:new f.Uniform3f(_),u_frustum_bl:new f.Uniform3f(_),u_globe_pos:new f.Uniform3f(_),u_globe_radius:new f.Uniform1f(_),u_viewport:new f.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new f.Uniform3f(_),u_frustum_tr:new f.Uniform3f(_),u_frustum_br:new f.Uniform3f(_),u_frustum_bl:new f.Uniform3f(_),u_horizon:new f.Uniform1f(_),u_transition:new f.Uniform1f(_),u_fadeout_range:new f.Uniform1f(_),u_color:new f.Uniform4f(_),u_high_color:new f.Uniform4f(_),u_space_color:new f.Uniform4f(_),u_star_intensity:new f.Uniform1f(_),u_star_density:new f.Uniform1f(_),u_star_size:new f.Uniform1f(_),u_temporal_offset:new f.Uniform1f(_),u_horizon_angle:new f.Uniform1f(_),u_rotation_matrix:new f.UniformMatrix4f(_)})};let vo;function Cs(_,i,g,y,A,T,N){const k=_.context,H=k.gl,Q=_.transform,J=_.useProgram("collisionBox"),de=[];let ye=0,Ae=0;for(let Ve=0;Ve<y.length;Ve++){const tt=y[Ve],Qe=i.getTile(tt),nt=Qe.getBucket(g);if(!nt)continue;const vt=ls(tt,nt,Q);let pt=vt;0===A[0]&&0===A[1]||(pt=_.translatePosMatrix(vt,Qe,A,T));const Lt=N?nt.textCollisionBox:nt.iconCollisionBox,En=nt.collisionCircleArray;if(En.length>0){const Ot=f.create(),sn=pt;f.mul(Ot,nt.placementInvProjMatrix,Q.glCoordMatrix),f.mul(Ot,Ot,nt.placementViewportMatrix),de.push({circleArray:En,circleOffset:Ae,transform:sn,invTransform:Ot,projection:nt.getProjection()}),ye+=En.length/4,Ae=ye}Lt&&(_.terrain&&_.terrain.setupElevationDraw(Qe,J),J.draw(k,H.LINES,f.DepthMode.disabled,f.StencilMode.disabled,_.colorModeForRenderPass(),f.CullFaceMode.disabled,be(pt,Q,Qe,nt.getProjection()),g.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,null,Q.zoom,null,[Lt.collisionVertexBuffer,Lt.collisionVertexBufferExt]))}if(!N||!de.length)return;const we=_.useProgram("collisionCircle"),Se=new f.StructArrayLayout2f1f2i16;Se.resize(4*ye),Se._trim();let Me=0;for(const Ve of de)for(let tt=0;tt<Ve.circleArray.length/4;tt++){const Qe=4*tt,nt=Ve.circleArray[Qe+0],vt=Ve.circleArray[Qe+1],pt=Ve.circleArray[Qe+2],Lt=Ve.circleArray[Qe+3];Se.emplace(Me++,nt,vt,pt,Lt,0),Se.emplace(Me++,nt,vt,pt,Lt,1),Se.emplace(Me++,nt,vt,pt,Lt,2),Se.emplace(Me++,nt,vt,pt,Lt,3)}(!vo||vo.length<2*ye)&&(vo=function(Ve){const tt=2*Ve,Qe=new f.StructArrayLayout3ui6;Qe.resize(tt),Qe._trim();for(let nt=0;nt<tt;nt++){const vt=6*nt;Qe.uint16[vt+0]=4*nt+0,Qe.uint16[vt+1]=4*nt+1,Qe.uint16[vt+2]=4*nt+2,Qe.uint16[vt+3]=4*nt+2,Qe.uint16[vt+4]=4*nt+3,Qe.uint16[vt+5]=4*nt+0}return Qe}(ye));const he=k.createIndexBuffer(vo,!0),Te=k.createVertexBuffer(Se,f.collisionCircleLayout.members,!0);for(const Ve of de){const tt={u_matrix:Ve.transform,u_inv_matrix:Ve.invTransform,u_camera_to_center_distance:(Be=Q).getCameraToCenterDistance(Ve.projection),u_viewport_size:[Be.width,Be.height]};we.draw(k,H.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,_.colorModeForRenderPass(),f.CullFaceMode.disabled,tt,g.id,Te,he,f.SegmentVector.simpleSegment(0,2*Ve.circleOffset,Ve.circleArray.length,Ve.circleArray.length/2),null,Q.zoom)}var Be;Te.destroy(),he.destroy()}const As=f.create();function aa({width:_,height:i,anchor:g,textOffset:y,textScale:A},T){const{horizontalAlign:N,verticalAlign:k}=f.getAnchorAlignment(g),H=-(N-.5)*_,Q=-(k-.5)*i,J=f.evaluateVariableOffset(g,y);return new f.Point((H/A+J[0])*T,(Q/A+J[1])*T)}function to(_,i,g,y,A,T,N,k,H,Q,J){const de=_.text.placedSymbolArray,ye=_.text.dynamicLayoutVertexArray,Ae=_.icon.dynamicLayoutVertexArray,we={},Se=_.getProjection(),Me=Ii(k,Se,T),he=T.elevation,Te=Se.upVectorScale(k.canonical,T.center.lat,T.worldSize).metersToTile;ye.clear();for(let Be=0;Be<de.length;Be++){const Ve=de.get(Be),{tileAnchorX:tt,tileAnchorY:Qe,numGlyphs:nt}=Ve,vt=Ve.hidden||!Ve.crossTileID||_.allowVerticalPlacement&&!Ve.placedOrientation?null:y[Ve.crossTileID];if(vt){let pt=0,Lt=0,En=0;if(he){const An=he?he.getAtTileOffset(k,tt,Qe):0,[Er,Kr,sr]=Se.upVector(k.canonical,tt,Qe);pt=An*Er*Te,Lt=An*Kr*Te,En=An*sr*Te}let[Ot,sn,jt,yn]=ai(Ve.projectedAnchorX+pt,Ve.projectedAnchorY+Lt,Ve.projectedAnchorZ+En,g?Me:N);const It=Gs(T.getCameraToCenterDistance(Se),yn);let on=A.evaluateSizeForFeature(_.textSizeData,Q,Ve)*It/f.ONE_EM;g&&(on*=_.tilePixelRatio/H);const Cn=aa(vt,on);g?(({x:Ot,y:sn,z:jt}=Se.projectTilePoint(tt+Cn.x,Qe+Cn.y,k.canonical)),[Ot,sn,jt]=ai(Ot+pt,sn+Lt,jt+En,N)):(i&&Cn._rotate(-T.angle),Ot+=Cn.x,sn+=Cn.y,jt=0);const gn=_.allowVerticalPlacement&&Ve.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let An=0;An<nt;An++)f.addDynamicAttributes(ye,Ot,sn,jt,gn);J&&Ve.associatedIconIndex>=0&&(we[Ve.associatedIconIndex]={x:Ot,y:sn,z:jt,angle:gn})}else ws(nt,ye)}if(J){Ae.clear();const Be=_.icon.placedSymbolArray;for(let Ve=0;Ve<Be.length;Ve++){const tt=Be.get(Ve),{numGlyphs:Qe}=tt,nt=we[Ve];if(tt.hidden||!nt)ws(Qe,Ae);else{const{x:vt,y:pt,z:Lt,angle:En}=nt;for(let Ot=0;Ot<Qe;Ot++)f.addDynamicAttributes(Ae,vt,pt,Lt,En)}}_.icon.dynamicLayoutVertexBuffer.updateData(Ae)}_.text.dynamicLayoutVertexBuffer.updateData(ye)}function Ka(_,i,g){return g.iconsInText&&i?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Oo(_,i,g,y,A,T,N,k,H,Q,J,de){const ye=_.context,Ae=ye.gl,we=_.transform,Se="map"===k,Me="map"===H,he=Se&&"point"!==g.layout.get("symbol-placement"),Te=Se&&!Me&&!he,Be=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let Ve=!1;const tt=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),Qe=[f.mercatorXfromLng(we.center.lng),f.mercatorYfromLat(we.center.lat)],nt=g.layout.get("text-variable-anchor"),vt="globe"===we.projection.name,pt=[],Lt=[0,-1,0];let En=Lt;!vt&&!we.mercatorFromTransition||Se||(En=function(Ot){const sn=Ot._camera.getWorldToCamera(Ot.worldSize,1),jt=f.multiply([],sn,Ot.globeMatrix);f.invert(jt,jt);const yn=[0,0,0],It=[0,1,0,0];return f.transformMat4$1(It,It,jt),yn[0]=It[0],yn[1]=It[1],yn[2]=It[2],f.normalize(yn,yn),yn}(we));for(const Ot of y){const sn=i.getTile(Ot),jt=sn.getBucket(g);if(!jt||"mercator"===jt.projection.name&&vt)continue;const yn=A?jt.text:jt.icon;if(!yn||jt.fullyClipped||!yn.segments.get().length)continue;const It=yn.programConfigurations.get(g.id),on=A||jt.sdfIcons,Cn=A?jt.textSizeData:jt.iconSizeData,gn=Me||0!==we.pitch,An=f.evaluateSizeForZoom(Cn,we.zoom);let Er,Kr,sr,Nr,_i=[0,0],oi=null;if(A)Kr=sn.glyphAtlasTexture,sr=Ae.LINEAR,Er=sn.glyphAtlasTexture.size,jt.iconsInText&&(_i=sn.imageAtlasTexture.size,oi=sn.imageAtlasTexture,Nr=gn||_.options.rotating||_.options.zooming||"composite"===Cn.kind||"camera"===Cn.kind?Ae.LINEAR:Ae.NEAREST);else{const Ql=1!==g.layout.get("icon-size").constantOr(0)||jt.iconsNeedLinear;Kr=sn.imageAtlasTexture,sr=on||_.options.rotating||_.options.zooming||Ql||gn?Ae.LINEAR:Ae.NEAREST,Er=sn.imageAtlasTexture.size}const dr="globe"===jt.projection.name,Gi=dr?En:Lt,oo=dr?f.globeToMercatorTransition(we.zoom):0,uo=Ii(Ot,jt.getProjection(),we),To=we.calculatePixelsToTileUnitsMatrix(sn),Oa=Et(uo,sn.tileID.canonical,Me,Se,we,jt.getProjection(),To),ua=_.terrain&&Me&&he?f.invert(f.create(),Oa):As,Fl=Cr(uo,sn.tileID.canonical,Me,Se,we,jt.getProjection(),To),da=nt&&jt.hasTextData(),rs="none"!==g.layout.get("icon-text-fit")&&da&&jt.hasIconData();if(he){const Ql=we.elevation,Sc=Ql?Ql.getAtTileOffsetFunc(Ot,we.center.lat,we.worldSize,jt.getProjection()):null,ec=vr(uo,sn.tileID.canonical,Me,Se,we,jt.getProjection(),To);ka(jt,uo,_,A,ec,Fl,Me,Q,Sc,Ot)}const ho=he||A&&nt||rs,$i=_.translatePosMatrix(uo,sn,T,N),Ps=ho?As:Oa,va=_.translatePosMatrix(Fl,sn,T,N,!0),Po=jt.getProjection().createInversionMatrix(we,Ot.canonical),ol=[];_.terrainRenderModeElevated()&&Me&&ol.push("PITCH_WITH_MAP_TERRAIN"),dr&&ol.push("PROJECTION_GLOBE_VIEW"),ho&&ol.push("PROJECTED_POS_ON_VIEWPORT");const Nu=on&&0!==g.paint.get(A?"text-halo-width":"icon-halo-width").constantOr(1);let Tc;Tc=on?jt.iconsInText?Wo(Cn.kind,An,Te,Me,_,$i,Ps,va,Er,_i,Ot,oo,Qe,Po,Gi,jt.getProjection()):zo(Cn.kind,An,Te,Me,_,$i,Ps,va,A,Er,!0,Ot,oo,Qe,Po,Gi,jt.getProjection()):Bo(Cn.kind,An,Te,Me,_,$i,Ps,va,A,Er,Ot,oo,Qe,Po,Gi,jt.getProjection());const gu={program:_.useProgram(Ka(on,A,jt),It,ol),buffers:yn,uniformValues:Tc,atlasTexture:Kr,atlasTextureIcon:oi,atlasInterpolation:sr,atlasInterpolationIcon:Nr,isSDF:on,hasHalo:Nu,tile:sn,labelPlaneMatrixInv:ua};if(Be&&jt.canOverlap){Ve=!0;const Ql=yn.segments.get();for(const Sc of Ql)pt.push({segments:new f.SegmentVector([Sc]),sortKey:Sc.sortKey,state:gu})}else pt.push({segments:yn.segments,sortKey:0,state:gu})}Ve&&pt.sort((Ot,sn)=>Ot.sortKey-sn.sortKey);for(const Ot of pt){const sn=Ot.state;if(_.terrain&&_.terrain.setupElevationDraw(sn.tile,sn.program,{useDepthForOcclusion:!vt,labelPlaneMatrixInv:sn.labelPlaneMatrixInv}),ye.activeTexture.set(Ae.TEXTURE0),sn.atlasTexture.bind(sn.atlasInterpolation,Ae.CLAMP_TO_EDGE),sn.atlasTextureIcon&&(ye.activeTexture.set(Ae.TEXTURE1),sn.atlasTextureIcon&&sn.atlasTextureIcon.bind(sn.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),sn.isSDF){const jt=sn.uniformValues;sn.hasHalo&&(jt.u_is_halo=1,Ja(sn.buffers,Ot.segments,g,_,sn.program,tt,J,de,jt)),jt.u_is_halo=0}Ja(sn.buffers,Ot.segments,g,_,sn.program,tt,J,de,sn.uniformValues)}}function Ja(_,i,g,y,A,T,N,k,H){const Q=y.context,J=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];A.draw(Q,Q.gl.TRIANGLES,T,N,k,f.CullFaceMode.disabled,H,g.id,_.layoutVertexBuffer,_.indexBuffer,i,g.paint,y.transform.zoom,_.programConfigurations.get(g.id),J)}function Kl(_,i,g,y,A,T,N){const k=_.context.gl,H=g.paint.get("fill-pattern"),Q=H&&H.constantOr(1);let J,de,ye,Ae,we;N?(de=Q&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=k.LINES):(de=Q?"fillPattern":"fill",J=k.TRIANGLES);for(const Se of y){const Me=i.getTile(Se);if(Q&&!Me.patternsLoaded())continue;const he=Me.getBucket(g);if(!he)continue;_.prepareDrawTile();const Te=he.programConfigurations.get(g.id),Be=_.useProgram(de,Te);Q&&(_.context.activeTexture.set(k.TEXTURE0),Me.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Te.updatePaintBuffers());const Ve=H.constantOr(null);if(Ve&&Me.imageAtlas){const Qe=Me.imageAtlas.patternPositions[Ve.toString()];Qe&&Te.setConstantPatternPositions(Qe)}const tt=_.translatePosMatrix(Se.projMatrix,Me,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(N){Ae=he.indexBuffer2,we=he.segments2;const Qe=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ye="fillOutlinePattern"===de&&Q?Sn(tt,_,Me,Qe):vn(tt,Qe)}else Ae=he.indexBuffer,we=he.segments,ye=Q?yt(tt,_,Me):Ge(tt);_.prepareDrawProgram(_.context,Be,Se.toUnwrapped()),Be.draw(_.context,J,A,_.stencilModeForClipping(Se),T,f.CullFaceMode.disabled,ye,g.id,he.layoutVertexBuffer,Ae,we,g.paint,_.transform.zoom,Te)}}function Qa(_,i,g,y,A,T,N){const k=_.context,H=k.gl,Q=_.transform,J=g.paint.get("fill-extrusion-pattern"),de=J.constantOr(1),ye=g.paint.get("fill-extrusion-opacity"),Ae=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],we=g.layout.get("fill-extrusion-edge-radius"),Se=we>0&&!g.paint.get("fill-extrusion-rounded-roof"),Me=Se?0:we,he="globe"===Q.projection.name?f.fillExtrusionHeightLift():0,Te="globe"===Q.projection.name,Be=Te?f.globeToMercatorTransition(Q.zoom):0,Ve=[f.mercatorXfromLng(Q.center.lng),f.mercatorYfromLat(Q.center.lat)],tt=[];Te&&tt.push("PROJECTION_GLOBE_VIEW"),Ae[0]>0&&tt.push("FAUX_AO"),Se&&tt.push("ZERO_ROOF_RADIUS");for(const Qe of y){const nt=i.getTile(Qe),vt=nt.getBucket(g);if(!vt||vt.projection.name!==Q.projection.name)continue;const pt=vt.programConfigurations.get(g.id),Lt=_.useProgram(de?"fillExtrusionPattern":"fillExtrusion",pt,tt);if(_.terrain){const on=_.terrain;if(_.style.terrainSetForDrapingOnly())on.setupElevationDraw(nt,Lt,{useMeterToDem:!0});else{if(!vt.enableTerrain)continue;if(on.setupElevationDraw(nt,Lt,{useMeterToDem:!0}),jl(k,i,Qe,vt,g,on),!vt.centroidVertexBuffer){const Cn=Lt.attributes.a_centroid_pos;void 0!==Cn&&H.vertexAttrib2f(Cn,0,0)}}}de&&(_.context.activeTexture.set(H.TEXTURE0),nt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),pt.updatePaintBuffers());const En=J.constantOr(null);if(En&&nt.imageAtlas){const on=nt.imageAtlas.patternPositions[En.toString()];on&&pt.setConstantPatternPositions(on)}const Ot=_.translatePosMatrix(Qe.projMatrix,nt,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),sn=Q.projection.createInversionMatrix(Q,Qe.canonical),jt=g.paint.get("fill-extrusion-vertical-gradient"),yn=de?Ie(Ot,_,jt,ye,Ae,Me,Qe,nt,he,Be,Ve,sn):le(Ot,_,jt,ye,Ae,Me,Qe,he,Be,Ve,sn);_.prepareDrawProgram(k,Lt,Qe.toUnwrapped());const It=[];_.terrain&&It.push(vt.centroidVertexBuffer),Te&&It.push(vt.layoutVertexExtBuffer),Lt.draw(k,k.gl.TRIANGLES,A,T,N,f.CullFaceMode.backCCW,yn,g.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,g.paint,_.transform.zoom,pt,It)}}function jl(_,i,g,y,A,T){const N=[he=>{let Te=he.canonical.x-1,Be=he.wrap;return Te<0&&(Te=(1<<he.canonical.z)-1,Be--),new f.OverscaledTileID(he.overscaledZ,Be,he.canonical.z,Te,he.canonical.y)},he=>{let Te=he.canonical.x+1,Be=he.wrap;return Te===1<<he.canonical.z&&(Te=0,Be++),new f.OverscaledTileID(he.overscaledZ,Be,he.canonical.z,Te,he.canonical.y)},he=>new f.OverscaledTileID(he.overscaledZ,he.wrap,he.canonical.z,he.canonical.x,(0===he.canonical.y?1<<he.canonical.z:he.canonical.y)-1),he=>new f.OverscaledTileID(he.overscaledZ,he.wrap,he.canonical.z,he.canonical.x,he.canonical.y===(1<<he.canonical.z)-1?0:he.canonical.y+1)],k=he=>{const Te=i.getSource().minzoom,Be=tt=>{const Qe=i.getTileByID(tt);if(Qe&&Qe.hasData())return Qe.getBucket(A)},Ve=[0,-1,1];for(const tt of Ve){if(he.overscaledZ+tt<Te)continue;const Qe=Be(he.calculateScaledKey(he.overscaledZ+tt));if(Qe)return Qe}},H=[0,0,0],Q=(he,Te)=>(H[0]=Math.min(he.min.y,Te.min.y),H[1]=Math.max(he.max.y,Te.max.y),H[2]=f.EXTENT-Te.min.x>he.max.x?Te.min.x-f.EXTENT:he.max.x,H),J=(he,Te)=>(H[0]=Math.min(he.min.x,Te.min.x),H[1]=Math.max(he.max.x,Te.max.x),H[2]=f.EXTENT-Te.min.y>he.max.y?Te.min.y-f.EXTENT:he.max.y,H),de=[(he,Te)=>Q(he,Te),(he,Te)=>Q(Te,he),(he,Te)=>J(he,Te),(he,Te)=>J(Te,he)],ye=new f.Point(0,0);let Ae,we,Se;const Me=(he,Te,Be,Ve,tt)=>{const Qe=[[Ve?Be:he,Ve?he:Be,0],[Ve?Be:Te,Ve?Te:Be,0]],nt=tt<0?f.EXTENT+tt:tt,vt=[Ve?nt:(he+Te)/2,Ve?(he+Te)/2:nt,0];return 0===Be&&tt<0||0!==Be&&tt>0?T.getForTilePoints(Se,[vt],!0,we):Qe.push(vt),T.getForTilePoints(g,Qe,!0,Ae),Math.max(Qe[0][2],Qe[1][2],vt[2])/T.exaggeration()};for(let he=0;he<4;he++){const Te=(he<2?1:5)-he,Be=y.borders[he];if(0===Be.length)continue;const Ve=Se=N[he](g),tt=k(Ve);if(!(tt&&tt instanceof f.FillExtrusionBucket&&tt.enableTerrain)||y.borderDoneWithNeighborZ[he]===tt.canonical.z&&tt.borderDoneWithNeighborZ[Te]===y.canonical.z||(we=T.findDEMTileFor(Ve),!we||!we.dem))continue;if(!Ae){const pt=T.findDEMTileFor(g);if(!pt||!pt.dem)return;Ae=pt}const Qe=tt.borders[Te];let nt=0;const vt=tt.borderDoneWithNeighborZ[Te]!==y.canonical.z;if(y.canonical.z===tt.canonical.z){for(let pt=0;pt<Be.length;pt++){const Lt=y.featuresOnBorder[Be[pt]],En=Lt.borders[he];let Ot;for(;nt<Qe.length&&(Ot=tt.featuresOnBorder[Qe[nt]],!(Ot.borders[Te][1]>En[0]+3));)vt&&tt.encodeCentroid(void 0,Ot,!1),nt++;if(Ot&&nt<Qe.length){const sn=nt;let jt=0;for(;!(Ot.borders[Te][0]>En[1]-3)&&(jt++,++nt!==Qe.length);)Ot=tt.featuresOnBorder[Qe[nt]];if(Ot=tt.featuresOnBorder[Qe[sn]],Lt.intersectsCount()>1||Ot.intersectsCount()>1||1!==jt){1!==jt&&(nt=sn),y.encodeCentroid(void 0,Lt,!1),vt&&tt.encodeCentroid(void 0,Ot,!1);continue}const yn=de[he](Lt,Ot),It=he%2?f.EXTENT-1:0;ye.x=Me(yn[0],Math.min(f.EXTENT-1,yn[1]),It,he<2,yn[2]),ye.y=0,y.encodeCentroid(ye,Lt,!1),vt&&tt.encodeCentroid(ye,Ot,!1)}else y.encodeCentroid(void 0,Lt,!1)}y.borderDoneWithNeighborZ[he]=tt.canonical.z,y.needsCentroidUpdate=!0,vt&&(tt.borderDoneWithNeighborZ[Te]=y.canonical.z,tt.needsCentroidUpdate=!0)}else{for(const pt of Be)y.encodeCentroid(void 0,y.featuresOnBorder[pt],!1);if(vt){for(const pt of Qe)tt.encodeCentroid(void 0,tt.featuresOnBorder[pt],!1);tt.borderDoneWithNeighborZ[Te]=y.canonical.z,tt.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[he]=tt.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&0!==y.centroidVertexArray.length)&&y.uploadCentroid(_)}const ys=new f.Color(1,0,0,1),el=new f.Color(0,1,0,1),fl=new f.Color(0,0,1,1),yl=new f.Color(1,0,1,1),xl=new f.Color(0,1,1,1);function sc(_,i,g){const y=_.context,A=_.transform,T=y.gl,N="globe"===A.projection.name,k=N?["PROJECTION_GLOBE_VIEW"]:null;let H=g.projMatrix;if(N&&f.globeToMercatorTransition(A.zoom)>0){const Lt=f.transitionTileAABBinECEF(g.canonical,A),En=f.globeDenormalizeECEF(Lt);H=f.multiply(new Float32Array(16),A.globeMatrix,En),f.multiply(H,A.projMatrix,H)}const Q=_.useProgram("debug",null,k),J=i.getTileByID(g.key);_.terrain&&_.terrain.setupElevationDraw(J,Q);const de=f.DepthMode.disabled,ye=f.StencilMode.disabled,Ae=_.colorModeForRenderPass();y.activeTexture.set(T.TEXTURE0),_.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),N?J._makeGlobeTileDebugBuffers(_.context,A):J._makeDebugTileBoundsBuffers(_.context,A.projection);const Se=J._tileDebugBuffer||_.debugBuffer,Me=J._tileDebugIndexBuffer||_.debugIndexBuffer,he=J._tileDebugSegments||_.debugSegments;Q.draw(y,T.LINE_STRIP,de,ye,Ae,f.CullFaceMode.disabled,qe(H,f.Color.red),"$debug",Se,Me,he,null,null,null,[J._globeTileDebugBorderBuffer]);const Te=J.latestRawTileData,Be=Math.floor((Te&&Te.byteLength||0)/1024),Ve=i.getTile(g).tileSize,tt=512/Math.min(Ve,512)*(g.overscaledZ/A.zoom)*.5;let Qe=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Qe+=` => ${g.overscaledZ}`),Qe+=` ${Be}kb`,function(Lt,En){Lt.initDebugOverlayCanvas();const Ot=Lt.debugOverlayCanvas,sn=Lt.context.gl,jt=Lt.debugOverlayCanvas.getContext("2d");jt.clearRect(0,0,Ot.width,Ot.height),jt.shadowColor="white",jt.shadowBlur=2,jt.lineWidth=1.5,jt.strokeStyle="white",jt.textBaseline="top",jt.font="bold 36px Open Sans, sans-serif",jt.fillText(En,5,5),jt.strokeText(En,5,5),Lt.debugOverlayTexture.update(Ot),Lt.debugOverlayTexture.bind(sn.LINEAR,sn.CLAMP_TO_EDGE)}(_,Qe);const nt=J._tileDebugTextBuffer||_.debugBuffer,vt=J._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,pt=J._tileDebugTextSegments||_.debugSegments;Q.draw(y,T.TRIANGLES,de,ye,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,qe(H,f.Color.transparent,tt),"$debug",nt,vt,pt,null,null,null,[J._globeTileDebugTextBuffer])}function wc(_,i,g,y){ga(_,0,i+g/2,_.transform.width,g,y)}function pl(_,i,g,y){ga(_,i-g/2,0,g,_.transform.height,y)}function ga(_,i,g,y,A,T){const N=_.context,k=N.gl;k.enable(k.SCISSOR_TEST),k.scissor(i*f.exported.devicePixelRatio,g*f.exported.devicePixelRatio,y*f.exported.devicePixelRatio,A*f.exported.devicePixelRatio),N.clear({color:T}),k.disable(k.SCISSOR_TEST)}const wl=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bc}=wl;function bl(_,i,g,y){_.emplaceBack(i,g,y)}class El{constructor(i){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,bl(this.vertexArray,-1,-1,1),bl(this.vertexArray,1,-1,1),bl(this.vertexArray,-1,1,1),bl(this.vertexArray,1,1,1),bl(this.vertexArray,-1,-1,-1),bl(this.vertexArray,1,-1,-1),bl(this.vertexArray,-1,1,-1),bl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,bc),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function Ta(_,i,g,y,A,T){const N=_.gl,k=i.paint.get("sky-atmosphere-color"),H=i.paint.get("sky-atmosphere-halo-color"),Q=i.paint.get("sky-atmosphere-sun-intensity"),J={u_matrix_3f:f.fromMat4(f.create$1(),y),u_sun_direction:A,u_sun_intensity:Q,u_color_tint_r:[(we=k).r,we.g,we.b,we.a],u_color_tint_m:[(Se=H).r,Se.g,Se.b,Se.a],u_luminance:5e-5};var we,Se;N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+T,i.skyboxTexture,0),g.draw(_,N.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,J,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const j=f.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class me{constructor(i){const g=new f.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const y=new f.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(g,j.members),this.indexBuffer=i.createIndexBuffer(y),this.segments=f.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const te={symbol:function(_,i,g,y,A){if("translucent"!==_.renderPass)return;const T=f.StencilMode.disabled,N=_.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(k,H,Q,J,de,ye,Ae){const we=H.transform,Se="map"===de,Me="map"===ye;for(const he of k){const Te=J.getTile(he),Be=Te.getBucket(Q);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Ve=f.evaluateSizeForZoom(Be.textSizeData,we.zoom),tt=Ii(he,Be.getProjection(),we),Qe=we.calculatePixelsToTileUnitsMatrix(Te),nt=Et(tt,Te.tileID.canonical,Me,Se,we,Be.getProjection(),Qe),vt="none"!==Q.layout.get("icon-text-fit")&&Be.hasIconData();if(Ve){const pt=Math.pow(2,we.zoom-Te.tileID.overscaledZ);to(Be,Se,Me,Ae,f.symbolSize,we,nt,he,pt,Ve,vt)}}}(y,_,g,i,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),A),0!==g.paint.get("icon-opacity").constantOr(1)&&Oo(_,i,g,y,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),T,N),0!==g.paint.get("text-opacity").constantOr(1)&&Oo(_,i,g,y,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),T,N),i.map.showCollisionBoxes&&(Cs(_,i,g,y,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),Cs(_,i,g,y,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(_,i,g,y){if("translucent"!==_.renderPass)return;const A=g.paint.get("circle-opacity"),T=g.paint.get("circle-stroke-width"),N=g.paint.get("circle-stroke-opacity"),k=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===A.constantOr(1)&&(0===T.constantOr(1)||0===N.constantOr(1)))return;const H=_.context,Q=H.gl,J=_.transform,de=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),ye=f.StencilMode.disabled,Ae=_.colorModeForRenderPass(),we="globe"===J.projection.name,Se=[f.mercatorXfromLng(J.center.lng),f.mercatorYfromLat(J.center.lat)],Me=[];for(let Te=0;Te<y.length;Te++){const Be=y[Te],Ve=i.getTile(Be),tt=Ve.getBucket(g);if(!tt||tt.projection.name!==J.projection.name)continue;const Qe=tt.programConfigurations.get(g.id),nt=X(g);we&&nt.push("PROJECTION_GLOBE_VIEW");const vt=_.useProgram("circle",Qe,nt),pt=tt.layoutVertexBuffer,Lt=tt.globeExtVertexBuffer,En=tt.indexBuffer,Ot=J.projection.createInversionMatrix(J,Be.canonical),sn={programConfiguration:Qe,program:vt,layoutVertexBuffer:pt,globeExtVertexBuffer:Lt,indexBuffer:En,uniformValues:ue(_,Be,Ve,Ot,Se,g),tile:Ve};if(k){const jt=tt.segments.get();for(const yn of jt)Me.push({segments:new f.SegmentVector([yn]),sortKey:yn.sortKey,state:sn})}else Me.push({segments:tt.segments,sortKey:0,state:sn})}k&&Me.sort((Te,Be)=>Te.sortKey-Be.sortKey);const he={useDepthForOcclusion:!we};for(const Te of Me){const{programConfiguration:Be,program:Ve,layoutVertexBuffer:tt,globeExtVertexBuffer:Qe,indexBuffer:nt,uniformValues:vt,tile:pt}=Te.state,Lt=Te.segments;_.terrain&&_.terrain.setupElevationDraw(pt,Ve,he),_.prepareDrawProgram(H,Ve,pt.tileID.toUnwrapped()),Ve.draw(H,Q.TRIANGLES,de,ye,Ae,f.CullFaceMode.disabled,vt,g.id,tt,nt,Lt,g.paint,J.zoom,Be,[Qe])}},heatmap:function(_,i,g,y){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const A=_.context,T=A.gl,N=f.StencilMode.disabled,k=new f.ColorMode([T.ONE,T.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function(Ae,we,Se,Me){const he=Ae.gl,Te=we.width*Me,Be=we.height*Me;Ae.activeTexture.set(he.TEXTURE1),Ae.viewport.set([0,0,Te,Be]);let Ve=Se.heatmapFbo;if(!Ve||Ve&&(Ve.width!==Te||Ve.height!==Be)){Ve&&Ve.destroy();const tt=he.createTexture();he.bindTexture(he.TEXTURE_2D,tt),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_2D,he.TEXTURE_MAG_FILTER,he.LINEAR),Ve=Se.heatmapFbo=Ae.createFramebuffer(Te,Be,!1),function(Qe,nt,vt,pt,Lt,En){const Ot=Qe.gl;Ot.texImage2D(Ot.TEXTURE_2D,0,Qe.isWebGL2&&Qe.extRenderToTextureHalfFloat?Ot.RGBA16F:Ot.RGBA,Lt,En,0,Ot.RGBA,Qe.extRenderToTextureHalfFloat?Qe.isWebGL2?Ot.HALF_FLOAT:Qe.extTextureHalfFloat.HALF_FLOAT_OES:Ot.UNSIGNED_BYTE,null),pt.colorAttachment.set(vt)}(Ae,0,tt,Ve,Te,Be)}else he.bindTexture(he.TEXTURE_2D,Ve.colorAttachment.get()),Ae.bindFramebuffer.set(Ve.framebuffer)})(A,_,g,"globe"===_.transform.projection.name?.5:.25),A.clear({color:f.Color.transparent});const H=_.transform,Q="globe"===H.projection.name,J=Q?["PROJECTION_GLOBE_VIEW"]:null,de=Q?f.CullFaceMode.frontCCW:f.CullFaceMode.disabled,ye=[f.mercatorXfromLng(H.center.lng),f.mercatorYfromLat(H.center.lat)];for(let Ae=0;Ae<y.length;Ae++){const we=y[Ae];if(i.hasRenderableParent(we))continue;const Se=i.getTile(we),Me=Se.getBucket(g);if(!Me||Me.projection.name!==H.projection.name)continue;const he=Me.programConfigurations.get(g.id),Te=_.useProgram("heatmap",he,J),{zoom:Be}=_.transform;_.terrain&&_.terrain.setupElevationDraw(Se,Te),_.prepareDrawProgram(A,Te,we.toUnwrapped());const Ve=H.projection.createInversionMatrix(H,we.canonical);Te.draw(A,T.TRIANGLES,f.DepthMode.disabled,N,k,de,lr(_,we,Se,Ve,ye,Be,g.paint.get("heatmap-intensity")),g.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,g.paint,_.transform.zoom,he,Q?[Me.globeExtVertexBuffer]:null)}A.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(A,T){const N=A.context,k=N.gl,H=T.heatmapFbo;if(!H)return;N.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,H.colorAttachment.get()),N.activeTexture.set(k.TEXTURE1);let Q=T.colorRampTexture;Q||(Q=T.colorRampTexture=new f.Texture(N,T.colorRamp,k.RGBA)),Q.bind(k.LINEAR,k.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(N,k.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,A.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:T.paint.get("heatmap-opacity")},T.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,T.paint,A.transform.zoom)}(_,g))},line:function(_,i,g,y){if("translucent"!==_.renderPass)return;const A=g.paint.get("line-opacity"),T=g.paint.get("line-width");if(0===A.constantOr(1)||0===T.constantOr(1))return;const N=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),k=_.colorModeForRenderPass(),H=_.terrain&&_.terrain.renderingToTexture?1:f.exported.devicePixelRatio,Q=g.paint.get("line-dasharray"),J=Q.constantOr(1),de=g.layout.get("line-cap"),ye=g.paint.get("line-pattern"),Ae=ye.constantOr(1),we=g.paint.get("line-gradient"),Se=Ae?"linePattern":"line",Me=_.context,he=Me.gl,Te=(Ve=>{const tt=[];eo(Ve)&&tt.push("RENDER_LINE_DASH"),Ve.paint.get("line-gradient")&&tt.push("RENDER_LINE_GRADIENT");const Qe=Ve.paint.get("line-trim-offset");0===Qe[0]&&0===Qe[1]||tt.push("RENDER_LINE_TRIM_OFFSET");const nt=Ve.paint.get("line-pattern").constantOr(1),vt=1!==Ve.paint.get("line-opacity").constantOr(1);return!nt&&vt&&tt.push("RENDER_LINE_ALPHA_DISCARD"),tt})(g);let Be=Te.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(Be=!1);for(const Ve of y){const tt=i.getTile(Ve);if(Ae&&!tt.patternsLoaded())continue;const Qe=tt.getBucket(g);if(!Qe)continue;_.prepareDrawTile();const nt=Qe.programConfigurations.get(g.id),vt=_.useProgram(Se,nt,Te),pt=ye.constantOr(null);if(pt&&tt.imageAtlas){const on=tt.imageAtlas.patternPositions[pt.toString()];on&&nt.setConstantPatternPositions(on)}const Lt=Q.constantOr(null),En=de.constantOr(null);if(!Ae&&Lt&&En&&tt.lineAtlas){const on=tt.lineAtlas.getDash(Lt,En);on&&nt.setConstantPatternPositions(on)}let[Ot,sn]=g.paint.get("line-trim-offset");("round"===En||"square"===En)&&Ot!==sn&&(0===Ot&&(Ot-=1),1===sn&&(sn+=1));const jt=_.terrain?Ve.projMatrix:null,yn=Ae?ii(_,tt,g,jt,H):Br(_,tt,g,jt,Qe.lineClipsArray.length,H,[Ot,sn]);if(we){const on=Qe.gradients[g.id];let Cn=on.texture;if(g.gradientVersion!==on.version){let gn=256;if(g.stepInterpolant){const An=i.getSource().maxzoom,Er=Ve.canonical.z===An?Math.ceil(1<<_.transform.maxZoom-Ve.canonical.z):1;gn=f.clamp(f.nextPowerOfTwo(Qe.maxLineLength/f.EXTENT*1024*Er),256,Me.maxTextureSize)}on.gradient=f.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:gn,image:on.gradient||void 0,clips:Qe.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new f.Texture(Me,on.gradient,he.RGBA),on.version=g.gradientVersion,Cn=on.texture}Me.activeTexture.set(he.TEXTURE1),Cn.bind(g.stepInterpolant?he.NEAREST:he.LINEAR,he.CLAMP_TO_EDGE)}J&&(Me.activeTexture.set(he.TEXTURE0),tt.lineAtlasTexture.bind(he.LINEAR,he.REPEAT),nt.updatePaintBuffers()),Ae&&(Me.activeTexture.set(he.TEXTURE0),tt.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),nt.updatePaintBuffers()),_.prepareDrawProgram(Me,vt,Ve.toUnwrapped());const It=on=>{vt.draw(Me,he.TRIANGLES,N,on,k,f.CullFaceMode.disabled,yn,g.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,g.paint,_.transform.zoom,nt,[Qe.layoutVertexBuffer2])};if(Be){const on=_.stencilModeForClipping(Ve).ref;0===on&&_.terrain&&Me.clear({stencil:0});const Cn={func:he.EQUAL,mask:255};yn.u_alpha_discard_threshold=.8,It(new f.StencilMode(Cn,on,255,he.KEEP,he.KEEP,he.INVERT)),yn.u_alpha_discard_threshold=0,It(new f.StencilMode(Cn,on,255,he.KEEP,he.KEEP,he.KEEP))}else It(_.stencilModeForClipping(Ve))}Be&&(_.resetStencilClippingMasks(),_.terrain&&Me.clear({stencil:0}))},fill:function(_,i,g,y){const A=g.paint.get("fill-color"),T=g.paint.get("fill-opacity");if(0===T.constantOr(1))return;const N=_.colorModeForRenderPass(),k=g.paint.get("fill-pattern"),H=_.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===A.constantOr(f.Color.transparent).a&&1===T.constantOr(0)?"opaque":"translucent";if(_.renderPass===H){const Q=_.depthModeForSublayer(1,"opaque"===_.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Kl(_,i,g,y,Q,N,!1)}if("translucent"===_.renderPass&&g.paint.get("fill-antialias")){const Q=_.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Kl(_,i,g,y,Q,N,!0)}},"fill-extrusion":function(_,i,g,y){const A=g.paint.get("fill-extrusion-opacity");if(0!==A&&"translucent"===_.renderPass){const T=new f.DepthMode(_.context.gl.LEQUAL,f.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==A||g.paint.get("fill-extrusion-pattern").constantOr(1))Qa(_,i,g,y,T,f.StencilMode.disabled,f.ColorMode.disabled),Qa(_,i,g,y,T,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const N=_.colorModeForRenderPass();Qa(_,i,g,y,T,f.StencilMode.disabled,N)}}},hillshade:function(_,i,g,y){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const A=_.context,T=_.depthModeForSublayer(0,f.DepthMode.ReadOnly),N=_.colorModeForRenderPass(),k=_.terrain&&_.terrain.renderingToTexture,[H,Q]="translucent"!==_.renderPass||k?[{},y]:_.stencilConfigForOverlap(y);for(const J of Q){const de=i.getTile(J);if(de.needsHillshadePrepare&&"offscreen"===_.renderPass)ns(_,de,g,T,f.StencilMode.disabled,N);else if("translucent"===_.renderPass){const ye=k&&_.terrain?_.terrain.stencilModeForRTTOverlap(J):H[J.overscaledZ];Da(_,J,de,g,T,ye,N)}}A.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,i,g,y,A,T){if("translucent"!==_.renderPass||0===g.paint.get("raster-opacity")||!y.length)return;const N=_.context,k=N.gl,H=i.getSource(),Q=_.useProgram("raster"),J=_.colorModeForRenderPass(),de=_.terrain&&_.terrain.renderingToTexture,[ye,Ae]=H instanceof De||de?[{},y]:_.stencilConfigForOverlap(y),we=Ae[Ae.length-1].overscaledZ,Se=!_.options.moving;for(const Me of Ae){const he=de?f.DepthMode.disabled:_.depthModeForSublayer(Me.overscaledZ-we,1===g.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,k.LESS),Te=Me.toUnwrapped(),Be=i.getTile(Me);if(de&&(!Be||!Be.hasData()))continue;const Ve=de?Me.projMatrix:_.transform.calculateProjMatrix(Te,Se),tt=_.terrain&&de?_.terrain.stencilModeForRTTOverlap(Me):ye[Me.overscaledZ],Qe=T?0:g.paint.get("raster-fade-duration");Be.registerFadeDuration(Qe);const nt=i.findLoadedParent(Me,0),vt=oa(Be,nt,i,_.transform,Qe);let pt,Lt;_.terrain&&_.terrain.prepareDrawTile();const En="nearest"===g.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;N.activeTexture.set(k.TEXTURE0),Be.texture.bind(En,k.CLAMP_TO_EDGE),N.activeTexture.set(k.TEXTURE1),nt?(nt.texture.bind(En,k.CLAMP_TO_EDGE),pt=Math.pow(2,nt.tileID.overscaledZ-Be.tileID.overscaledZ),Lt=[Be.tileID.canonical.x*pt%1,Be.tileID.canonical.y*pt%1]):Be.texture.bind(En,k.CLAMP_TO_EDGE),Be.texture.useMipmap&&N.extTextureFilterAnisotropic&&_.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const Ot=Qr(Ve,Lt||[0,0],pt||1,vt,g,H instanceof De?H.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(N,Q,Te),H instanceof De)H.boundsBuffer&&H.boundsSegments&&Q.draw(N,k.TRIANGLES,he,f.StencilMode.disabled,J,f.CullFaceMode.disabled,Ot,g.id,H.boundsBuffer,_.quadTriangleIndexBuffer,H.boundsSegments);else{const{tileBoundsBuffer:sn,tileBoundsIndexBuffer:jt,tileBoundsSegments:yn}=_.getTileBoundsBuffers(Be);Q.draw(N,k.TRIANGLES,he,tt,J,f.CullFaceMode.disabled,Ot,g.id,sn,jt,yn)}}_.resetStencilClippingMasks()},background:function(_,i,g,y){const A=g.paint.get("background-color"),T=g.paint.get("background-opacity");if(0===T)return;const N=_.context,k=N.gl,H=_.transform,Q=H.tileSize,J=g.paint.get("background-pattern");if(_.isPatternMissing(J))return;const de=!J&&1===A.a&&1===T&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==de)return;const ye=f.StencilMode.disabled,Ae=_.depthModeForSublayer(0,"opaque"===de?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),we=_.colorModeForRenderPass(),Se=_.useProgram(J?"backgroundPattern":"background");let Me,he=y;he||(Me=_.getBackgroundTiles(),he=Object.values(Me).map(Te=>Te.tileID)),J&&(N.activeTexture.set(k.TEXTURE0),_.imageManager.bind(_.context));for(const Te of he){const Be=Te.toUnwrapped(),Ve=y?Te.projMatrix:_.transform.calculateProjMatrix(Be);_.prepareDrawTile();const tt=i?i.getTile(Te):Me?Me[Te.key]:new f.Tile(Te,Q,H.zoom,_),Qe=J?qs(Ve,T,_,J,{tileID:Te,tileSize:Q}):Uo(Ve,T,A);_.prepareDrawProgram(N,Se,Be);const{tileBoundsBuffer:nt,tileBoundsIndexBuffer:vt,tileBoundsSegments:pt}=_.getTileBoundsBuffers(tt);Se.draw(N,k.TRIANGLES,Ae,ye,we,f.CullFaceMode.disabled,Qe,g.id,nt,vt,pt)}},sky:function(_,i,g){const y=_.transform,A="mercator"===y.projection.name||"globe"===y.projection.name?1:f.smoothstep(7,8,y.zoom),T=g.paint.get("sky-opacity")*A;if(0===T)return;const N=_.context,k=g.paint.get("sky-type"),H=new f.DepthMode(N.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),Q=_.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===_.renderPass?g.needsSkyboxCapture(_)&&(function(J,de,ye,Ae){const we=J.context,Se=we.gl;let Me=de.skyboxFbo;if(!Me){Me=de.skyboxFbo=we.createFramebuffer(32,32,!1),de.skyboxGeometry=new El(we),de.skyboxTexture=we.gl.createTexture(),Se.bindTexture(Se.TEXTURE_CUBE_MAP,de.skyboxTexture),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_CUBE_MAP,Se.TEXTURE_MAG_FILTER,Se.LINEAR);for(let Ve=0;Ve<6;++Ve)Se.texImage2D(Se.TEXTURE_CUBE_MAP_POSITIVE_X+Ve,0,Se.RGBA,32,32,0,Se.RGBA,Se.UNSIGNED_BYTE,null)}we.bindFramebuffer.set(Me.framebuffer),we.viewport.set([0,0,32,32]);const he=de.getCenter(J,!0),Te=J.useProgram("skyboxCapture"),Be=new Float64Array(16);f.identity(Be),f.rotateY(Be,Be,.5*-Math.PI),Ta(we,de,Te,Be,he,0),f.identity(Be),f.rotateY(Be,Be,.5*Math.PI),Ta(we,de,Te,Be,he,1),f.identity(Be),f.rotateX(Be,Be,.5*-Math.PI),Ta(we,de,Te,Be,he,2),f.identity(Be),f.rotateX(Be,Be,.5*Math.PI),Ta(we,de,Te,Be,he,3),f.identity(Be),Ta(we,de,Te,Be,he,4),f.identity(Be),f.rotateY(Be,Be,Math.PI),Ta(we,de,Te,Be,he,5),we.viewport.set([0,0,J.width,J.height])}(_,g),g.markSkyboxValid(_)):"sky"===_.renderPass&&function(J,de,ye,Ae,we){const Se=J.context,Me=Se.gl,he=J.transform,Te=J.useProgram("skybox");Se.activeTexture.set(Me.TEXTURE0),Me.bindTexture(Me.TEXTURE_CUBE_MAP,de.skyboxTexture);const Be={u_matrix:he.skyboxMatrix,u_sun_direction:de.getCenter(J,!1),u_cubemap:0,u_opacity:Ae,u_temporal_offset:we};J.prepareDrawProgram(Se,Te),Te.draw(Se,Me.TRIANGLES,ye,f.StencilMode.disabled,J.colorModeForRenderPass(),f.CullFaceMode.backCW,Be,"skybox",de.skyboxGeometry.vertexBuffer,de.skyboxGeometry.indexBuffer,de.skyboxGeometry.segment)}(_,g,H,T,Q):"gradient"===k&&"sky"===_.renderPass&&function(J,de,ye,Ae,we){const Se=J.context,Me=Se.gl,he=J.transform,Te=J.useProgram("skyboxGradient");de.skyboxGeometry||(de.skyboxGeometry=new El(Se)),Se.activeTexture.set(Me.TEXTURE0);let Be=de.colorRampTexture;Be||(Be=de.colorRampTexture=new f.Texture(Se,de.colorRamp,Me.RGBA)),Be.bind(Me.LINEAR,Me.CLAMP_TO_EDGE);const Ve=(tt=he.skyboxMatrix,Qe=de.getCenter(J,!1),nt=de.paint.get("sky-gradient-radius"),vt=Ae,pt=we,{u_matrix:tt,u_color_ramp:0,u_center_direction:Qe,u_radius:f.degToRad(nt),u_opacity:vt,u_temporal_offset:pt});var tt,Qe,nt,vt,pt;J.prepareDrawProgram(Se,Te),Te.draw(Se,Me.TRIANGLES,ye,f.StencilMode.disabled,J.colorModeForRenderPass(),f.CullFaceMode.backCW,Ve,"skyboxGradient",de.skyboxGeometry.vertexBuffer,de.skyboxGeometry.indexBuffer,de.skyboxGeometry.segment)}(_,g,H,T,Q)},debug:function(_,i,g){for(let y=0;y<g.length;y++)sc(_,i,g[y])},custom:function(_,i,g,y){const A=_.context,T=g.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||"offscreen"===_.renderPass)&&g.isLayerDraped()){if("offscreen"===_.renderPass){const N=T.prerender;if(N){if(_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;N.call(T,A.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),f.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else N.call(T,A.gl,_.transform.customLayerMatrix());A.setDirty(),_.setBaseState()}}else if("translucent"===_.renderPass){if(_.terrain&&_.terrain.renderingToTexture){const k=T.renderToTile;if(k){const H=y[0].canonical,Q=new f.MercatorCoordinate(H.x+y[0].wrap*(1<<H.z),H.y,H.z);A.setDepthMode(f.DepthMode.disabled),A.setStencilMode(f.StencilMode.disabled),A.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),k.call(T,A.gl,Q),A.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),A.setColorMode(_.colorModeForRenderPass()),A.setStencilMode(f.StencilMode.disabled);const N="3d"===T.renderingMode?new f.DepthMode(_.context.gl.LEQUAL,f.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,f.DepthMode.ReadOnly);if(A.setDepthMode(N),"globe"===_.transform.projection.name){const k=_.transform.pointMerc;T.render(A.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),f.globeToMercatorTransition(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else T.render(A.gl,_.transform.customLayerMatrix());A.setDirty(),_.setBaseState(),A.bindFramebuffer.set(null)}}else f.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class fe{constructor(i,g,y=!1){this.context=new pn(i,y),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,g){const y=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new us(this,i));const A=this._terrain;this.transform.elevation=y?A:null,A.update(i,this.transform,g)}_updateFog(i){const g=i.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,A]=g.getFovAdjustedRange(this.transform._fov);if(y>A)return void(this.transform.fogCullDistSq=null);const T=y+.78*(A-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,g){if(this.width=i*f.exported.devicePixelRatio,this.height=g*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const i=this.context,g=new f.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(f.EXTENT,0),g.emplaceBack(0,f.EXTENT),g.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(g,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const y=new f.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(f.EXTENT,0),y.emplaceBack(0,f.EXTENT),y.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=i.createVertexBuffer(y,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const A=new f.StructArrayLayout2i4;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(-1,1),A.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(A,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const T=new f.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(f.EXTENT,0,f.EXTENT,0),T.emplaceBack(0,f.EXTENT,0,f.EXTENT),T.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(T,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const N=new f.StructArrayLayout3ui6;N.emplaceBack(0,1,2),N.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(N);const k=new f.StructArrayLayout1ui2;for(const Q of[0,1,3,2,0])k.emplaceBack(Q);this.debugIndexBuffer=i.createIndexBuffer(k),this.emptyTexture=new f.Texture(i,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=f.create();const H=this.context.gl;this.stencilClearMode=new f.StencilMode({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.loadTimeStamps.push(f.window.performance.now()),this.atmosphereBuffer=new me(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,g=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,g.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,za(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,g,y){if(!g||this.currentStencilSource===g.id||!i.isTileClipped()||!y||0===y.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const H of y)if(void 0===this._tileClippingMaskIDs[H.key]){k=!0;break}if(!k)return}this.currentStencilSource=g.id;const A=this.context,T=A.gl;this.nextStencilID+y.length>256&&this.clearStencil(),A.setColorMode(f.ColorMode.disabled),A.setDepthMode(f.DepthMode.disabled);const N=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of y){const H=g.getTile(k),Q=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:J,tileBoundsIndexBuffer:de,tileBoundsSegments:ye}=this.getTileBoundsBuffers(H);N.draw(A,T.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:T.ALWAYS,mask:0},Q,255,T.KEEP,T.KEEP,T.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,za(k.projMatrix),"$clipping",J,de,ye)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,g=this.context.gl;return new f.StencilMode({func:g.NOTEQUAL,mask:255},i,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const g=this.context.gl;return new f.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(i){const g=this.context.gl,y=i.sort((N,k)=>k.overscaledZ-N.overscaledZ),A=y[y.length-1].overscaledZ,T=y[0].overscaledZ-A+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const N={};for(let k=0;k<T;k++)N[k+A]=new f.StencilMode({func:g.GEQUAL,mask:255},k+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=T,[N,y]}return[{[A]:f.StencilMode.disabled},y]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([i.CONSTANT_COLOR,i.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(i,g,y){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const A=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new f.DepthMode(y||this.context.gl.LEQUAL,g,[A,A])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,g){this.style=i,this.options=g,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const y=this.style.order,A=this.style._sourceCaches;for(const Q in A){const J=A[Q];J.used&&J.prepare(this.context)}const T={},N={},k={};for(const Q in A){const J=A[Q];T[Q]=J.getVisibleCoordinates(),N[Q]=T[Q].slice().reverse(),k[Q]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Q=0;Q<y.length;Q++)if(this.style._layers[y[Q]].is3D()){this.opaquePassCutoff=Q;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Q of y){const J=this.style._layers[Q],de=i._getLayerSourceCache(J);if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ye=de?N[de.id]:void 0;("custom"===J.type||J.isSky()||ye&&ye.length)&&this.renderLayer(this,de,J,ye)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const H=this.terrain;if(H&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&H.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?f.Color.black:f.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const Q=this.style._layers[y[this.currentLayer]],J=i._getLayerSourceCache(Q);if(Q.isSky())continue;const de=J?N[J.id]:void 0;this._renderTileClippingMasks(Q,J,de),this.renderLayer(this,J,Q,de)}if(this.style.fog&&this.transform.projection.supportsFog&&function(Q,J){const de=Q.context,ye=de.gl,Ae=Q.transform,we=new f.DepthMode(ye.LEQUAL,f.DepthMode.ReadOnly,[0,1]),Se=Q.useProgram("globeAtmosphere",null,"globe"===Ae.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Me=f.globeToMercatorTransition(Ae.zoom),he=J.properties.get("color").toArray01(),Te=J.properties.get("high-color").toArray01(),Be=J.properties.get("space-color").toArray01PremultipliedAlpha(),Ve=f.identity$1([]);f.rotateY$1(Ve,Ve,-f.degToRad(Ae._center.lng)),f.rotateX$1(Ve,Ve,f.degToRad(Ae._center.lat)),f.rotateZ$1(Ve,Ve,Ae.angle),f.rotateX$1(Ve,Ve,-Ae._pitch);const tt=f.fromQuat(new Float32Array(16),Ve),Qe=f.mapValue(J.properties.get("star-intensity"),0,1,0,.25),vt=f.mapValue(J.properties.get("horizon-blend"),0,1,5e-4,.25),pt=f.globeUseCustomAntiAliasing(Q,de,Ae)&&5e-4===vt?Ae.worldSize/(2*Math.PI*1.025)-1:Ae.globeRadius,Lt=Q.frameCounter/1e3%1,En=f.length(Ae.globeCenterInViewSpace),Ot=Math.sqrt(Math.pow(En,2)-Math.pow(pt,2)),sn=Math.acos(Ot/En),jt={u_frustum_tl:Ae.frustumCorners.TL,u_frustum_tr:Ae.frustumCorners.TR,u_frustum_br:Ae.frustumCorners.BR,u_frustum_bl:Ae.frustumCorners.BL,u_horizon:Ae.frustumCorners.horizon,u_transition:Me,u_fadeout_range:vt,u_color:he,u_high_color:Te,u_space_color:Be,u_star_intensity:Qe,u_star_size:5*f.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Lt,u_horizon_angle:sn,u_rotation_matrix:tt};Q.prepareDrawProgram(de,Se);const yn=Q.atmosphereBuffer;yn&&Se.draw(de,ye.TRIANGLES,we,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,jt,"skybox",yn.vertexBuffer,yn.indexBuffer,yn.segments)}(this,this.style.fog),this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const Q=this.style._layers[y[this.currentLayer]],J=i._getLayerSourceCache(Q);Q.isSky()&&this.renderLayer(this,J,Q,J?N[J.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const Q=this.style._layers[y[this.currentLayer]],J=i._getLayerSourceCache(Q);if(Q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Q)){if(Q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const de=J?("symbol"===Q.type?k:N)[J.id]:void 0;this._renderTileClippingMasks(Q,J,J?T[J.id]:void 0),this.renderLayer(this,J,Q,de),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Q=null;f.values(this.style._layers).forEach(J=>{const de=i._getLayerSourceCache(J);de&&!J.isHidden(this.transform.zoom)&&(!Q||Q.getSource().maxzoom<de.getSource().maxzoom)&&(Q=de)}),Q&&this.options.showTileBoundaries&&te.debug(this,Q,Q.getVisibleCoordinates())}this.options.showPadding&&function(Q){const J=Q.transform.padding;wc(Q,Q.transform.height-(J.top||0),3,ys),wc(Q,J.bottom||0,3,el),pl(Q,J.left||0,3,fl),pl(Q,Q.transform.width-(J.right||0),3,yl);const de=Q.transform.centerPoint;var ye,Ae,we,Se;ga(ye=Q,(Ae=de.x)-1,(we=Q.transform.height-de.y)-10,2,20,Se=xl),ga(ye,Ae-10,we-1,20,2,Se)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,g,y,A){y.isHidden(this.transform.zoom)||("background"===y.type||"sky"===y.type||"custom"===y.type||A&&A.length)&&(this.id=y.id,this.gpuTimingStart(y),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(y.type)||i.terrain&&"custom"===y.type)&&te[y.type](i,g,y,A,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let y=this.gpuTimers[i.id];y||(y=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),y.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,g=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),i.beginQueryEXT(i.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const g={};for(const y in i){const A=i[y],T=this.context.extTimerQuery,N=T.getQueryObjectEXT(A.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(A.query),g[y]=N}return g}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let y=0;for(const A of i)y+=g.getQueryObjectEXT(A,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(A);return y}translatePosMatrix(i,g,y,A,T){if(!y[0]&&!y[1])return i;const N=T?"map"===A?this.transform.angle:0:"viewport"===A?-this.transform.angle:0;if(N){const Q=Math.sin(N),J=Math.cos(N);y=[y[0]*J-y[1]*Q,y[0]*Q+y[1]*J]}const k=[T?y[0]:Ln(g,y[0],this.transform.zoom),T?y[1]:Ln(g,y[1],this.transform.zoom),0],H=new Float32Array(16);return f.translate(H,i,k),H}saveTileTexture(i){const g=this._tileTextures[i.size[0]];g?g.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const g=this._tileTextures[i];return g&&g.length>0?g.pop():null}isPatternMissing(i){return null===i||void 0!==i&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,g=this.terrain&&0===this.terrain.exaggeration(),y=this.style&&this.style.fog,A=[];return this.terrainRenderModeElevated()&&A.push("TERRAIN"),"globe"===this.transform.projection.name&&A.push("GLOBE"),g&&A.push("ZERO_EXAGGERATION"),y&&!i&&0!==y.getOpacity(this.transform.pitch)&&A.push("FOG"),i&&A.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&A.push("OVERDRAW_INSPECTOR"),A}useProgram(i,g,y){this.cache=this.cache||{};const A=y||[],T=this.currentGlobalDefines().concat(A),N=ri.cacheKey(zs[i],i,T,g);return this.cache[N]||(this.cache[N]=new ri(this.context,i,zs[i],g,sa[i],T)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,g,y){if(this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const T=A.getOpacity(this.transform.pitch),N=((k,H,Q,J,de,ye,Ae,we,Se,Me,he)=>{const Te=k.transform,Be=H.properties.get("color").toArray01();Be[3]=J;const Ve=k.frameCounter/1e3%1;return{u_fog_matrix:Q?Te.calculateFogTileMatrix(Q):k.identityMat,u_fog_range:H.getFovAdjustedRange(Te._fov),u_fog_color:Be,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_temporal_offset:Ve,u_frustum_tl:de,u_frustum_tr:ye,u_frustum_br:Ae,u_frustum_bl:we,u_globe_pos:Se,u_globe_radius:Me,u_viewport:he,u_globe_transition:f.globeToMercatorTransition(Te.zoom),u_is_globe:+("globe"===Te.projection.name)}})(this,A,y,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*f.exported.devicePixelRatio,this.transform.height*f.exported.devicePixelRatio]);g.setFogUniformValues(i,N)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,g=i.createTexture();return i.bindTexture(i.TEXTURE_2D,g),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,g=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const A of y)g[A.key]=i[A.key]||new f.Tile(A,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class He{constructor(i=0,g=0,y=0,A=0){if(isNaN(i)||i<0||isNaN(g)||g<0||isNaN(y)||y<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=g,this.left=y,this.right=A}interpolate(i,g,y){return null!=g.top&&null!=i.top&&(this.top=f.number(i.top,g.top,y)),null!=g.bottom&&null!=i.bottom&&(this.bottom=f.number(i.bottom,g.bottom,y)),null!=g.left&&null!=i.left&&(this.left=f.number(i.left,g.left,y)),null!=g.right&&null!=i.right&&(this.right=f.number(i.right,g.right,y)),this}getCenter(i,g){const y=f.clamp((this.left+i-this.right)/2,0,i),A=f.clamp((this.top+g-this.bottom)/2,0,g);return new f.Point(y,A)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new He(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Gt(_,i){const g=f.getColumn(_,3);f.fromQuat(_,i),f.setColumn(_,3,g)}function Ut(_,i){const g=f.identity$1([]);return f.rotateZ$1(g,g,-i),f.rotateX$1(g,g,-_),g}function pr(_,i){const g=[_[0],_[1],0],y=[i[0],i[1],0];if(f.length(g)>=1e-15){const N=f.normalize([],g);f.scale$2(y,N,f.dot(y,N)),i[0]=y[0],i[1]=y[1]}const A=f.cross([],i,_);if(f.len(A)<1e-15)return null;const T=Math.atan2(-A[1],A[0]);return Ut(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),T)}class io{constructor(i,g){this.position=i,this.orientation=g}get position(){return this._position}set position(i){if(i){const g=i instanceof f.MercatorCoordinate?i:new f.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(g.x=f.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(i,g){if(this.orientation=null,!this.position)return;const y=this.position,A=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(i)):0,T=f.MercatorCoordinate.fromLngLat(i,A),N=[T.x-y.x,T.y-y.y,T.z-y.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=pr(N,g)}setPitchBearing(i,g){this.orientation=Ut(f.degToRad(i),f.degToRad(-g))}}class Hi{constructor(i,g){this._transform=f.identity([]),this.orientation=g,this.position=i}get mercatorPosition(){const i=this.position;return new f.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=f.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var g;i&&f.setColumn(this._transform,3,[(g=i)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||f.identity$1([]),i&&Gt(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,g){this._orientation=Ut(i,g),Gt(this._transform,this._orientation)}forward(){const i=f.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=f.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=f.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,g){const y=new Float64Array(16);return f.invert(y,this.getWorldToCamera(i,g)),y}getWorldToCameraPosition(i,g,y){const A=this.position;f.scale$2(A,A,-i);const T=new Float64Array(16);return f.fromScaling(T,[y,y,y]),f.translate(T,T,A),T[10]*=g,T}getWorldToCamera(i,g){const y=new Float64Array(16),A=new Float64Array(4),T=this.position;return f.conjugate(A,this._orientation),f.scale$2(T,T,-i),f.fromQuat(y,A),f.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=g,y[9]*=g,y[10]*=g,y[11]*=g,y}getCameraToClipPerspective(i,g,y,A){const T=new Float64Array(16);return f.perspective(T,i,g,y,A),T}getDistanceToElevation(i,g=!1){const y=0===i?0:f.mercatorZfromAltitude(i,g?f.latFromMercatorY(this.position[1]):this.position[1]),A=this.forward();return(y-this.position[2])/A[2]}clone(){return new Hi([...this.position],[...this.orientation])}}function wi(_,i){const g=Ao(_.projection,_.zoom,_.width,_.height),y=function(T,N,k,H,Q){const J=new f.LngLat(k.lng-180*bi,k.lat),de=new f.LngLat(k.lng+180*bi,k.lat),ye=T.project(J.lng,J.lat),Ae=T.project(de.lng,de.lat),we=-Math.atan2(Ae.y-ye.y,Ae.x-ye.x),Se=f.MercatorCoordinate.fromLngLat(k);Se.y=f.clamp(Se.y,-1+bi,1-bi);const Me=Se.toLngLat(),he=T.project(Me.lng,Me.lat),Te=f.MercatorCoordinate.fromLngLat(Me);Te.x+=bi;const Be=Te.toLngLat(),Ve=T.project(Be.lng,Be.lat),tt=tl(Ve.x-he.x,Ve.y-he.y,we),Qe=f.MercatorCoordinate.fromLngLat(Me);Qe.y+=bi;const nt=Qe.toLngLat(),vt=T.project(nt.lng,nt.lat),pt=tl(vt.x-he.x,vt.y-he.y,we),Lt=Math.abs(tt.x)/Math.abs(pt.y),En=f.identity([]);f.rotateZ(En,En,-we*(1-(Q?0:H)));const Ot=f.identity([]);return f.scale(Ot,Ot,[1,1-(1-Lt)*H,1]),Ot[4]=-pt.x/pt.y*H,f.rotateZ(Ot,Ot,we),f.multiply(Ot,En,Ot),Ot}(_.projection,0,_.center,g,i),A=Yr(_);return f.scale(y,y,[A,A,1]),y}function Yr(_){const i=_.projection,g=Ao(_.projection,_.zoom,_.width,_.height),y=ds(i,_.center),A=ds(i,f.LngLat.convert(i.center));return Math.pow(2,y*g+(1-g)*A)}function Ao(_,i,g,y,A=1/0){const T=_.range;if(!T)return 0;const N=Math.min(A,Math.max(g,y)),k=Math.log(N/1024)/Math.LN2;return f.smoothstep(T[0]+k,T[1]+k,i)}const bi=1/4e4;function ds(_,i){const g=f.clamp(i.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),y=new f.LngLat(i.lng-180*bi,g),A=new f.LngLat(i.lng+180*bi,g),T=_.project(y.lng,g),N=_.project(A.lng,g),k=f.MercatorCoordinate.fromLngLat(y),H=f.MercatorCoordinate.fromLngLat(A),Q=N.x-T.x,J=N.y-T.y,de=H.x-k.x,ye=H.y-k.y,Ae=Math.sqrt((de*de+ye*ye)/(Q*Q+J*J));return Math.log(Ae)/Math.LN2}function tl(_,i,g){const y=Math.cos(g),A=Math.sin(g);return{x:_*y-i*A,y:_*A+i*y}}class ma{constructor(i,g,y,A,T,N,k){this.tileSize=512,this._renderWorldCopies=void 0===T||T,this._minZoom=i||0,this._maxZoom=g||22,this._minPitch=y??0,this._maxPitch=A??60,this.setProjection(N),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new He,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Hi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new ma(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,g=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||y)&&this._updateCameraOnTerrain(),(i||y)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=f.getProjection(this.projectionOptions);const y=!ze(g,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=f.getProjection({name:"mercator"});const g=i!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return f.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.Point(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const g=-i*Math.PI/180;var y,A,T,N,k,H,Q,J,de,ye;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(y=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),A=this.rotationMatrix,N=this.angle,k=(T=this.rotationMatrix)[0],H=T[1],Q=T[2],J=T[3],de=Math.sin(N),ye=Math.cos(N),A[0]=k*ye+Q*de,A[1]=H*ye+J*de,A[2]=k*-de+Q*ye,A[3]=H*-de+J*ye)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const g=f.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=f.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const g=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let A=0,T=0;for(let N=0;N<g.length;N++){const k=new f.Point(g[N][0]*this.width,y+g[N][1]*(this.height-y)),H=i.pointCoordinate(k);if(!H)continue;const Q=1/Math.hypot(H[0]-this._camera.position[0],H[1]-this._camera.position[1]);A+=H[3]*Q,T+=Q}return 0===T?NaN:A/T}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*g,A=this._mercatorZfromZoom(i),T=this._mercatorZfromZoom(this._maxZoom),N=Math.max(A-y,T);this._setZoom(this._zoomFromMercatorZ(N))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let y;y=i.z<this._camera.position[2]?[g.x,g.y,g.z]:[i.x,i.y,i.z];const A=f.length(f.sub([],this._camera.position,y));return f.clamp(this._zoomFromMercatorZ(A),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let g=!1;if(i.orientation&&!f.exactEquals(i.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(i.orientation)),i.position){const y=[i.position.x,i.position.y,i.position.z];f.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,g=new io;return g.position=new f.MercatorCoordinate(i[0],i[1],i[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(i){if(!f.length$1(i))return!1;f.normalize$1(i,i);const g=f.transformQuat([],[0,0,-1],i),y=f.transformQuat([],[0,-1,0],i);if(y[2]<0)return!1;const A=pr(g,y);return!!A&&(this._camera.orientation=A,!0)}_setCameraPosition(i){const g=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,A=this.cameraToCenterDistance;i[2]=f.clamp(i[2],A/y,A/g),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,g,y){this._unmodified=!1,this._edgeInsets.interpolate(i,g,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const g=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(i){const g=[new f.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const y=this.pointCoordinate(new f.Point(0,0)),A=this.pointCoordinate(new f.Point(this.width,0)),T=this.pointCoordinate(new f.Point(this.width,this.height)),N=this.pointCoordinate(new f.Point(0,this.height)),k=Math.floor(Math.min(y.x,A.x,T.x,N.x)),H=Math.floor(Math.max(y.x,A.x,T.x,N.x)),Q=1;for(let J=k-Q;J<=H+Q;J++)0!==J&&g.push(new f.UnwrappedTileID(J,i))}return g}coveringTiles(i){let g=this.coveringZoomLevel(i);const y=g,A=this.elevation&&!i.isTerrainDEM,T="mercator"===this.projection.name;if(void 0!==i.minzoom&&g<i.minzoom)return[];void 0!==i.maxzoom&&g>i.maxzoom&&(g=i.maxzoom);const N=this.locationCoordinate(this.center),k=this.center.lat,H=1<<g,Q=[H*N.x,H*N.y,0],J="globe"===this.projection.name,de=!J,ye=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,de),Ae=J?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),we=H*f.mercatorZfromAltitude(1,this.center.lat),Se=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),Me=[H*Ae.x,H*Ae.y,Se*(de?1:we)],he=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,Be=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ve=i.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,tt=this.projection.isReprojectedInTileSpace?Yr(this):1,Qe=It=>{const Cn=new f.MercatorCoordinate(It.x+25e-6,It.y,It.z),gn=new f.MercatorCoordinate(It.x,It.y+25e-6,It.z),An=It.toLngLat(),Er=Cn.toLngLat(),Kr=gn.toLngLat(),sr=this.locationCoordinate(An),Nr=this.locationCoordinate(Er),_i=this.locationCoordinate(Kr),oi=Math.hypot(Nr.x-sr.x,Nr.y-sr.y),dr=Math.hypot(_i.x-sr.x,_i.y-sr.y);return Math.sqrt(oi*dr)*tt/25e-6},nt=It=>{const on=Be,Cn=Ve;return{aabb:f.tileAABB(this,H,0,0,0,It,Cn,on,this.projection),zoom:0,x:0,y:0,minZ:Cn,maxZ:on,wrap:It,fullyVisible:!1}},vt=[];let pt=[];const Lt=g,En=i.reparseOverscaled?y:g,Ot=It=>It*It,sn=Ot((Se-this._centerAltitude)*we),jt=It=>{if(!this._elevation||!It.tileID||!T)return;const on=this._elevation.getMinMaxForTile(It.tileID),Cn=It.aabb;on?(Cn.min[2]=on.min,Cn.max[2]=on.max,Cn.center[2]=(Cn.min[2]+Cn.max[2])/2):(It.shouldSplit=yn(It),It.shouldSplit||(Cn.min[2]=Cn.max[2]=Cn.center[2]=this._centerAltitude))},yn=It=>{if(It.zoom<Te)return!0;if(It.zoom===Lt)return!1;if(null!=It.shouldSplit)return It.shouldSplit;const on=It.aabb.distanceX(Me),Cn=It.aabb.distanceY(Me);let gn=sn,An=1;if(J){gn=Ot(It.aabb.distanceZ(Me));const sr=Math.pow(2,It.zoom),Nr=f.latFromMercatorY((It.y+1)/sr),_i=f.latFromMercatorY(It.y/sr),oi=Math.min(Math.max(k,Nr),_i),dr=f.circumferenceAtLatitude(oi)/f.circumferenceAtLatitude(k);if(An=oi===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,dr/this._mercatorScaleRatio),this.zoom<=f.GLOBE_ZOOM_THRESHOLD_MIN&&It.zoom===Lt-1&&dr>=.9)return!0}else if(A&&(gn=Ot(It.aabb.distanceZ(Me)*we)),this.projection.isReprojectedInTileSpace&&y<=5){const sr=Math.pow(2,It.zoom),Nr=Qe(new f.MercatorCoordinate((It.x+.5)/sr,(It.y+.5)/sr));An=Nr>.85?1:Nr}const Er=on*on+Cn*Cn+gn;return Er<Ot((1<<Lt-It.zoom)*he*An*((sr,Nr)=>{if(Nr*Ot(.707)<sr)return 1;const _i=Math.sqrt(Nr/sr);return _i/(1.4144271570014144+(Math.pow(1.1,_i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(gn,sn),Er))};if(this.renderWorldCopies)for(let It=1;It<=3;It++)vt.push(nt(-It)),vt.push(nt(It));for(vt.push(nt(0));vt.length>0;){const It=vt.pop(),on=It.x,Cn=It.y;let gn=It.fullyVisible;if(!gn){const An=It.aabb.intersects(ye);if(0===An)continue;gn=2===An}if(It.zoom!==Lt&&yn(It))for(let An=0;An<4;An++){const Er=(on<<1)+An%2,Kr=(Cn<<1)+(An>>1),sr={aabb:T?It.aabb.quadrant(An):f.tileAABB(this,H,It.zoom+1,Er,Kr,It.wrap,It.minZ,It.maxZ,this.projection),zoom:It.zoom+1,x:Er,y:Kr,wrap:It.wrap,fullyVisible:gn,tileID:void 0,shouldSplit:void 0,minZ:It.minZ,maxZ:It.maxZ};A&&!J&&(sr.tileID=new f.OverscaledTileID(It.zoom+1===Lt?En:It.zoom+1,It.wrap,It.zoom+1,Er,Kr),jt(sr)),vt.push(sr)}else{const An=It.zoom===Lt?En:It.zoom;if(i.minzoom&&i.minzoom>An)continue;const Er=Q[0]-(.5+on+(It.wrap<<It.zoom))*(1<<g-It.zoom),Kr=Q[1]-.5-Cn,sr=It.tileID?It.tileID:new f.OverscaledTileID(An,It.wrap,It.zoom,on,Cn);pt.push({tileID:sr,distanceSq:Er*Er+Kr*Kr})}}if(this.fogCullDistSq){const It=this.fogCullDistSq,on=this.horizonLineFromTop();pt=pt.filter(Cn=>{const gn=[0,0,0,1],An=[f.EXTENT,f.EXTENT,0,1],Er=this.calculateFogTileMatrix(Cn.tileID.toUnwrapped());f.transformMat4$1(gn,gn,Er),f.transformMat4$1(An,An,Er);const Kr=f.getAABBPointSquareDist(gn,An);if(0===Kr)return!0;let sr=!1;const Nr=this._elevation;if(Nr&&Kr>It&&0!==on){const _i=this.calculateProjMatrix(Cn.tileID.toUnwrapped());let oi;i.isTerrainDEM||(oi=Nr.getMinMaxForTile(Cn.tileID)),oi||(oi={min:Ve,max:Be});const dr=f.furthestTileCorner(this.rotation),Gi=[dr[0]*f.EXTENT,dr[1]*f.EXTENT,oi.max];f.transformMat4(Gi,Gi,_i),sr=(1-Gi[1])*this.height*.5<on}return Kr<It||sr})}return pt.sort((It,on)=>It.distanceSq-on.distanceSq).map(It=>It.tileID)}resize(i,g){this.width=i,this.height=g,this.pixelsToGLUnits=[2/i,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const g=f.clamp(i.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),y=this.projection.project(i.lng,g);return new f.Point(y.x*this.worldSize,y.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/f.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,g){let y,A;const T=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;y=(g.x-T.x)/k,A=(g.y-T.y)/k}else{const k=this.pointCoordinate(g),H=this.pointCoordinate(T);y=k.x-H.x,A=k.y-H.y}const N=this.locationCoordinate(i);this.setLocation(new f.MercatorCoordinate(N.x-y,N.y-A))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,g){const y=g?f.mercatorZfromAltitude(g,i.lat):void 0,A=this.projection.project(i.lng,i.lat);return new f.MercatorCoordinate(A.x,A.y,y)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,g){const y=g??this._centerAltitude,A=[i.x,i.y,0,1],T=[i.x,i.y,1,1];f.transformMat4$1(A,A,this.pixelMatrixInverse),f.transformMat4$1(T,T,this.pixelMatrixInverse);const N=T[3];f.scale$1(A,A,1/A[3]),f.scale$1(T,T,1/N);const k=A[2],H=T[2];return{p0:A,p1:T,t:k===H?0:(y-k)/(H-k)}}screenPointToMercatorRay(i){const g=[i.x,i.y,0,1],y=[i.x,i.y,1,1];return f.transformMat4$1(g,g,this.pixelMatrixInverse),f.transformMat4$1(y,y,this.pixelMatrixInverse),f.scale$1(g,g,1/g[3]),f.scale$1(y,y,1/y[3]),g[2]=f.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,y[2]=f.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,f.scale$1(g,g,1/this.worldSize),f.scale$1(y,y,1/this.worldSize),new f.Ray([g[0],g[1],g[2]],f.normalize([],f.sub([],y,g)))}rayIntersectionCoordinate(i){const{p0:g,p1:y,t:A}=i,T=f.mercatorZfromAltitude(g[2],this._center.lat),N=f.mercatorZfromAltitude(y[2],this._center.lat);return new f.MercatorCoordinate(f.number(g[0],y[0],A)/this.worldSize,f.number(g[1],y[1],A)/this.worldSize,f.number(T,N,A))}pointCoordinate(i,g=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,g)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let g=this.projection.pointCoordinate3D(this,i.x,i.y);if(g)return new f.MercatorCoordinate(g[0],g[1],g[2]);let y=0,A=this.horizonLineFromTop();if(i.y>A)return this.pointCoordinate(i);const T=.02*A,N=i.clone();for(let k=0;k<10&&A-y>T;k++){N.y=f.number(y,A,.66);const H=this.projection.pointCoordinate3D(this,N.x,N.y);H?(A=N.y,g=H):y=N.y}return g?new f.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const g=this.pointCoordinate(i);return g.y>=0&&g.y<=1}_coordinatePoint(i,g){const y=g&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,A=[i.x*this.worldSize,i.y*this.worldSize,y+i.toAltitude(),1];return f.transformMat4$1(A,A,this.pixelMatrix),A[3]>0?new f.Point(A[0]/A[3],A[1]/A[3]):new f.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,T=this.pointLocation3D(new f.Point(g,i)),N=this.pointLocation3D(new f.Point(A,i)),k=this.pointLocation3D(new f.Point(A,y)),H=this.pointLocation3D(new f.Point(g,y));let Q=Math.min(T.lng,N.lng,k.lng,H.lng),J=Math.max(T.lng,N.lng,k.lng,H.lng),de=Math.min(T.lat,N.lat,k.lat,H.lat),ye=Math.max(T.lat,N.lat,k.lat,H.lat);const Ae=Math.pow(2,-this.zoom)/16*270,we="globe"===this.projection.name?1:4,Se=(Me,he,Te,Be,Ve)=>{const tt=(Me+Te)/2,Qe=(he+Be)/2,nt=new f.Point(tt,Qe),{lng:vt,lat:pt}=this.pointLocation3D(nt),Lt=Math.max(0,Q-vt,de-pt,vt-J,pt-ye);Q=Math.min(Q,vt),J=Math.max(J,vt),de=Math.min(de,pt),ye=Math.max(ye,pt),(Ve<we||Lt>Ae)&&(Se(Me,he,tt,Qe,Ve+1),Se(tt,Qe,Te,Be,Ve+1))};if(Se(g,i,A,i,1),Se(A,i,A,y,1),Se(A,y,g,y,1),Se(g,y,g,i,1),"globe"===this.projection.name){const[Me,he]=f.polesInViewport(this);Me?(ye=90,J=180,Q=-180):he&&(de=-90,J=180,Q=-180)}return new f.LngLatBounds(new f.LngLat(Q,de),new f.LngLat(J,ye))}_getBoundsRectangular(i,g){const{top:y,left:A}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,N=this.width-this._edgeInsets.right,k=new f.Point(A,y),H=new f.Point(N,y),Q=new f.Point(N,T),J=new f.Point(A,T);let de=this.pointCoordinate(k,i),ye=this.pointCoordinate(H,i);const Ae=this.pointCoordinate(Q,g),we=this.pointCoordinate(J,g),Se=(Me,he)=>(he.y-Me.y)/(he.x-Me.x);return de.y>1&&ye.y>=0?de=new f.MercatorCoordinate((1-we.y)/Se(we,de)+we.x,1):de.y<0&&ye.y<=1&&(de=new f.MercatorCoordinate(-we.y/Se(we,de)+we.x,0)),ye.y>1&&de.y>=0?ye=new f.MercatorCoordinate((1-Ae.y)/Se(Ae,ye)+Ae.x,1):ye.y<0&&de.y<=1&&(ye=new f.MercatorCoordinate(-Ae.y/Se(Ae,ye)+Ae.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(de)).extend(this.coordinateLocation(ye)).extend(this.coordinateLocation(we)).extend(this.coordinateLocation(Ae))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const g=i.visibleDemTiles.reduce((y,A)=>{if(A.dem){const T=A.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*i.exaggeration(),g.max*i.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-g*(1-this._horizonShift);return i?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,g){return this.projection.createTileMatrix(this,g,i)}calculateDistanceTileData(i){const g=i.key,y=this._distanceTileDataCache;if(y[g])return y[g];const A=i.canonical,T=1/this.height,N=this.cameraWorldSize,k=N/this.zoomScale(A.z),H=(A.x+Math.pow(2,A.z)*i.wrap)*k,Q=A.y*k,J=this.point;J.x*=N/this.worldSize,J.y*=N/this.worldSize;const de=this.angle,ye=Math.sin(-de),Ae=-Math.cos(-de);return y[g]={bearing:[ye,Ae],center:[(J.x-H)*T,(J.y-Q)*T],scale:k/f.EXTENT*T},y[g]}calculateFogTileMatrix(i){const g=i.key,y=this._fogTileMatrixCache;if(y[g])return y[g];const A=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return f.multiply(A,this.worldToFogMatrix,A),y[g]=new Float32Array(A),y[g]}calculateProjMatrix(i,g=!1){const y=i.key,A=g?this._alignedProjMatrixCache:this._projMatrixCache;if(A[y])return A[y];const T=this.calculatePosMatrix(i,this.worldSize);return f.multiply(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,T),A[y]=new Float32Array(T),A[y]}calculatePixelsToTileUnitsMatrix(i){const g=i.tileID.key,y=this._pixelsToTileUnitsCache;if(y[g])return y[g];const A=function(T,N){const{scale:k}=T.tileTransform,H=k*f.EXTENT/(T.tileSize*Math.pow(2,N.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return Q=new Float32Array(4),ye=(J=N.inverseAdjustmentMatrix)[1],Ae=J[2],we=J[3],Me=(de=[H,H])[1],Q[0]=J[0]*(Se=de[0]),Q[1]=ye*Se,Q[2]=Ae*Me,Q[3]=we*Me,Q;var Q,J,de,ye,Ae,we,Se,Me}(i,this);return y[g]=A,y[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const i=1/this.worldSize,g=f.fromScaling([],[i,i,i]);return f.multiply(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const g=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(g),A=this._camera.forward(),T=f.mercatorZfromAltitude(1,this._center.lat);y[2]/=T,A[2]/=T,f.normalize(A,A);const N=i.raycast(y,A,i.exaggeration());if(N){const k=f.scaleAndAdd([],y,A,N),H=new f.MercatorCoordinate(k[0],k[1],f.mercatorZfromAltitude(k[2],f.latFromMercatorY(k[1]))),Q=(H.z+f.length([H.x-y[0],H.y-y[1],H.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=H.toAltitude(),this._center=this.coordinateLocation(H),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const g=this._elevation,y=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,A=this._computeCameraPosition(y),T=g.getAtPointOrZero(new f.MercatorCoordinate(...A)),N=this.pixelsPerMeter/this.worldSize*T,k=this._minimumHeightOverTerrain(),H=A[2]-N;if(H<=k)if(H<0||i){const Q=this.locationCoordinate(this._center,this._centerAltitude),J=[A[0],A[1],Q.z-A[2]],de=f.length(J);J[2]-=(k-H)/this._pixelsPerMercatorPixel;const ye=f.length(J);if(0===ye)return;f.scale$2(J,J,de/ye*this._pixelsPerMercatorPixel),this._camera.position=[A[0],A[1],Q.z*this._pixelsPerMercatorPixel-J[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const ye=this.center;return ye.lat=f.clamp(ye.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(ye.lng=f.clamp(ye.lng,this.minLng,this.maxLng)),this.center=ye,void(this._constraining=!1)}const g=this._unmodified,{x:y,y:A}=this.point;let T=0,N=y,k=A;const H=this.width/2,Q=this.height/2,J=this.worldMinY*this.scale,de=this.worldMaxY*this.scale;if(A-Q<J&&(k=J+Q),A+Q>de&&(k=de-Q),de-J<this.height&&(T=Math.max(T,this.height/(de-J)),k=(de+J)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ye=this.worldMinX*this.scale,Ae=this.worldMaxX*this.scale,we=this.worldSize/2-(ye+Ae)/2;N=(y+we+this.worldSize)%this.worldSize-we,N-H<ye&&(N=ye+H),N+H>Ae&&(N=Ae-H),Ae-ye<this.width&&(T=Math.max(T,this.width/(Ae-ye)),N=(Ae+ye)/2)}N===y&&k===A||(this.center=this.unproject(new f.Point(N,k))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=f.mercatorZfromAltitude(1,this.center.lat)/f.mercatorZfromAltitude(1,f.GLOBE_SCALE_MATCH_LATITUDE));const y=Ao(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const A="meters"===this.projection.zAxisUnit?g:1,T=this._camera.getWorldToCamera(this.worldSize,A),N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);N[8]=2*-i.x/this.width,N[9]=2*i.y/this.height;let k=f.mul([],N,T);if(this.projection.isReprojectedInTileSpace){const Qe=this.locationCoordinate(this.center),nt=f.identity([]);f.translate(nt,nt,[Qe.x*this.worldSize,Qe.y*this.worldSize,0]),f.multiply(nt,nt,wi(this)),f.translate(nt,nt,[-Qe.x*this.worldSize,-Qe.y*this.worldSize,0]),f.multiply(k,k,nt),this.inverseAdjustmentMatrix=function(vt){const pt=wi(vt,!0);return gt([],[pt[0],pt[1],pt[4],pt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],k,[this.worldSize,this.worldSize,this.worldSize/A,1]),this.projMatrix=k,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const H=f.invert([],N);this.frustumCorners=f.FrustumCorners.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height);const Q=new Float32Array(16);f.identity(Q),f.scale(Q,Q,[1,-1,1]),f.rotateX(Q,Q,this._pitch),f.rotateZ(Q,Q,this.angle);const J=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),de=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;J[8]=2*-i.x/this.width,J[9]=2*(i.y+de)/this.height,this.skyboxMatrix=f.multiply(Q,J,Q);const ye=this.point,Ae=ye.x,we=ye.y,Se=this.width%2/2,Me=this.height%2/2,he=Math.cos(this.angle),Te=Math.sin(this.angle),Be=Ae-Math.round(Ae)+he*Se+Te*Me,Ve=we-Math.round(we)+he*Me+Te*Se,tt=new Float64Array(k);if(f.translate(tt,tt,[Be>.5?Be-1:Be,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=tt,k=f.create(),f.scale(k,k,[this.width/2,-this.height/2,1]),f.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=f.create(),f.scale(k,k,[1,-1,1]),f.translate(k,k,[-1,-1,0]),f.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=f.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=f.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=f.calculateGlobeMatrix(this);const Qe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=f.transformMat4(Qe,Qe,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,y=this._camera.position,A=1/this.height/this._pixelsPerMercatorPixel,T=[i,i,g];f.scale$2(T,T,A),f.scale$2(y,y,-1),f.multiply$2(y,y,T);const N=f.create();f.translate(N,N,y),f.scale(N,N,T),this.mercatorFogMatrix=N,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,g,A)}_computeCameraPosition(i){const g=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),A=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-i/this.worldSize*this._centerAltitude;return[A.x/this.worldSize-y[0]*T,A.y/this.worldSize-y[1]*T,i/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],A=i[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),A>0&&(T=Math.min((g-y)/A,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,i,T),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,g=this._camera.forward(),{pitch:y,bearing:A}=this._camera.getPitchBearing(),T=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,N=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),k=Math.max((i[2]-T)/Math.cos(y),N),H=this._zoomFromMercatorZ(k);f.scaleAndAdd(i,i,g,k),this._pitch=f.clamp(y,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(A,-Math.PI,Math.PI),this._setZoom(f.clamp(H,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let g=0,y=f.GLOBE_ZOOM_THRESHOLD_MAX,A=0,T=1/0;for(;y-g>1e-6&&y>g;){const N=g+.5*(y-g),k=this.tileSize*Math.pow(2,N),H=this.getCameraToCenterDistance(this.projection,N,k),Q=this.scaleZoom(H/(i*this.tileSize)),J=Math.abs(N-Q);J<T&&(T=J,A=N),N<Q?g=N:y=N}return A}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,g){const y=Math.min(i.x,g.x),A=Math.max(i.x,g.x),T=Math.min(i.y,g.y),N=Math.max(i.y,g.y);if(T<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new f.Point(y,T),new f.Point(A,N),new f.Point(y,N),new f.Point(A,T)],H=this.renderWorldCopies?-3:0,Q=this.renderWorldCopies?4:1;for(const J of k){const de=this.pointRayIntersection(J);if(de.t<0)return!0;const ye=this.rayIntersectionCoordinate(de);if(ye.x<H||ye.y<0||ye.x>Q||ye.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.Point(0,0),new f.Point(this.width,this.height))}zoomDeltaToMovement(i,g){const y=f.length(f.sub([],this._camera.position,i)),A=this._zoomFromMercatorZ(y)+g;return y-this._mercatorZfromZoom(A)}getCameraPoint(){if("globe"===this.projection.name){const i=function([g,y,A],T){const N=[g,y,A,1];f.transformMat4$1(N,N,T);const k=N[3]=Math.max(N[3],1e-6);return N[0]/=k,N[1]/=k,N[2]/=k,N}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new f.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.Point(0,i))}}getCameraToCenterDistance(i,g=this.zoom,y=this.worldSize){const A=Ao(i,g,this.width,this.height,1024),T=i.pixelSpaceConversion(this.center.lat,y,A);return.5/Math.tan(.5*this._fov)*this.height*T}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&f.multiply(i,i,this.globeMatrix),i}}function Sa(_,i){let g=!1,y=null;const A=()=>{y=null,g&&(_(),y=setTimeout(A,i),g=!1)};return()=>(g=!0,y||A(),y)}class Os{constructor(i){this._hashName=i&&encodeURIComponent(i),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Sa(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,f.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const g=nl(i);if(this._hashName){const y=this._hashName;let A=!1;const T=f.window.location.hash.slice(1).split("&").map(N=>{const k=N.split("=")[0];return k===y?(A=!0,`${k}=${g}`):N}).filter(N=>N);return A||T.push(`${y}=${g}`),`#${T.join("&")}`}return`#${g}`}_getCurrentHash(){const i=f.window.location.hash.replace("#","");if(this._hashName){let g;return i.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(g=y)}),(g&&g[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(y=>isNaN(y))){const y=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(g[3]||0):i.getBearing();return i.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:y,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,i)}}function nl(_,i){const g=_.getCenter(),y=Math.round(100*_.getZoom())/100,A=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,A),N=Math.round(g.lng*T)/T,k=Math.round(g.lat*T)/T,H=_.getBearing(),Q=_.getPitch();let J=i?`/${N}/${k}/${y}`:`${y}/${k}/${N}`;return(H||Q)&&(J+="/"+Math.round(10*H)/10),Q&&(J+=`/${Math.round(Q)}`),J}const Ia={linearity:.3,easing:f.bezier(0,0,.3,1)},rl=f.extend({deceleration:2500,maxSpeed:1400},Ia),qc=f.extend({deceleration:20,maxSpeed:1400},Ia),Hn=f.extend({deceleration:1e3,maxSpeed:360},Ia),Cl=f.extend({deceleration:1e3,maxSpeed:90},Ia);class Xc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,g=f.exported.now();for(;i.length>0&&g-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const g={zoom:0,bearing:0,pitch:0,pan:new f.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)g.zoom+=T.zoomDelta||0,g.bearing+=T.bearingDelta||0,g.pitch+=T.pitchDelta||0,T.panDelta&&g.pan._add(T.panDelta),T.around&&(g.around=T.around),T.pinchAround&&(g.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(g.pan.mag()){const T=Yi(g.pan.mag(),y,f.extend({},rl,i||{}));A.offset=g.pan.mult(T.amount/g.pan.mag()),A.center=this._map.transform.center,ac(A,T)}if(g.zoom){const T=Yi(g.zoom,y,qc);A.zoom=this._map.transform.zoom+T.amount,ac(A,T)}if(g.bearing){const T=Yi(g.bearing,y,Hn);A.bearing=this._map.transform.bearing+f.clamp(T.amount,-179,179),ac(A,T)}if(g.pitch){const T=Yi(g.pitch,y,Cl);A.pitch=this._map.transform.pitch+T.amount,ac(A,T)}if(A.zoom||A.bearing){const T=void 0===g.pinchAround?g.around:g.pinchAround;A.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),A.noMoveStart=!0,A}}function ac(_,i){(!_.duration||_.duration<i.duration)&&(_.duration=i.duration,_.easing=i.easing)}function Yi(_,i,g){const{maxSpeed:y,linearity:A,deceleration:T}=g,N=f.clamp(_*A/(i/1e3),-y,y),k=Math.abs(N)/(T*A);return{easing:g.easing,duration:1e3*k,amount:N*(k/2)}}class $r extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,g,y,A={}){const T=mr(g.getCanvasContainer(),y),N=g.unproject(T);super(i,f.extend({point:T,lngLat:N,originalEvent:y},A)),this._defaultPrevented=!1,this.target=g}}class Ec extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,g,y){const A="touchend"===i?y.changedTouches:y.touches,T=Xt(g.getCanvasContainer(),A),N=T.map(H=>g.unproject(H)),k=T.reduce((H,Q,J,de)=>H.add(Q.div(de.length)),new f.Point(0,0));super(i,{points:T,point:k,lngLats:N,lngLat:g.unproject(k),originalEvent:y}),this._defaultPrevented=!1}}class il extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,g,y){super(i,{originalEvent:y}),this._defaultPrevented=!1}}class du{constructor(i,g){this._map=i,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new il(i.type,this._map,i))}mousedown(i,g){return this._mousedownPos=g,this._firePreventable(new $r(i.type,this._map,i))}mouseup(i){this._map.fire(new $r(i.type,this._map,i))}preclick(i){const g=f.extend({},i);g.type="preclick",this._map.fire(new $r(g.type,this._map,g))}click(i,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(i),this._map.fire(new $r(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new $r(i.type,this._map,i))}mouseover(i){this._map.fire(new $r(i.type,this._map,i))}mouseout(i){this._map.fire(new $r(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ec(i.type,this._map,i))}touchmove(i){this._map.fire(new Ec(i.type,this._map,i))}touchend(i){this._map.fire(new Ec(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ec(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new $r(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new $r(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Do{constructor(i,g){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,g){this.isEnabled()&&i.shiftKey&&0===i.button&&(zt(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(i,g){if(!this._active)return;const y=g,A=this._startPos,T=this._lastPos;if(!A||!T||T.equals(y)||!this._box&&y.dist(A)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=xt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const N=Math.min(A.x,y.x),k=Math.max(A.x,y.x),H=Math.min(A.y,y.y),Q=Math.max(A.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${N}px,${H}px)`,this._box.style.width=k-N+"px",this._box.style.height=Q-H+"px")})}mouseupWindow(i,g){if(!this._active)return;const y=this._startPos,A=g;if(y&&0===i.button){if(this.reset(),Jn(),y.x!==A.x||y.y!==A.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:T=>T.fitScreenCoordinates(y,A,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),un(),delete this._startPos,delete this._lastPos}_fireEvent(i,g){return this._map.fire(new f.Event(i,{originalEvent:g}))}}function Xs(_,i){const g={};for(let y=0;y<_.length;y++)g[_[y].identifier]=i[y];return g}class Hl{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,g,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),y.length===this.numTouches&&(this.centroid=function(A){const T=new f.Point(0,0);for(const N of A)T._add(N);return T.div(A.length)}(g),this.touches=Xs(y,g)))}touchmove(i,g,y){if(this.aborted||!this.centroid)return;const A=Xs(y,g);for(const T in this.touches){const N=A[T];(!N||N.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(i,g,y){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===y.length){const A=!this.aborted&&this.centroid;if(this.reset(),A)return A}}}class la{constructor(i){this.singleTap=new Hl(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,g,y){this.singleTap.touchstart(i,g,y)}touchmove(i,g,y){this.singleTap.touchmove(i,g,y)}touchend(i,g,y){const A=this.singleTap.touchend(i,g,y);if(A){const T=i.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(A)<30;if(T&&N||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=A,this.count===this.numTaps)return this.reset(),A}}}class Kc{constructor(){this._zoomIn=new la({numTouches:1,numTaps:2}),this._zoomOut=new la({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,g,y){this._zoomIn.touchstart(i,g,y),this._zoomOut.touchstart(i,g,y)}touchmove(i,g,y){this._zoomIn.touchmove(i,g,y),this._zoomOut.touchmove(i,g,y)}touchend(i,g,y){const A=this._zoomIn.touchend(i,g,y),T=this._zoomOut.touchend(i,g,y);return A?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()+1,around:N.unproject(A)},{originalEvent:i})}):T?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:N.getZoom()-1,around:N.unproject(T)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ds={0:1,2:2};class Al{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,g){return!1}_move(i,g){return{}}mousedown(i,g){if(this._lastPoint)return;const y=rr(i);this._correctButton(i,y)&&(this._lastPoint=g,this._eventButton=y)}mousemoveWindow(i,g){const y=this._lastPoint;if(y)if(i.preventDefault(),null!=this._eventButton&&function(A,T){const N=Ds[T];return void 0===A.buttons||(A.buttons&N)!==N}(i,this._eventButton))this.reset();else if(this._moved||!(g.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(y,g)}mouseupWindow(i){this._lastPoint&&rr(i)===this._eventButton&&(this._moved&&Jn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _a extends Al{mousedown(i,g){super.mousedown(i,g),this._lastPoint&&(this._active=!0)}_correctButton(i,g){return 0===g&&!i.ctrlKey}_move(i,g){return{around:g,panDelta:g.sub(i)}}}class cd extends Al{_correctButton(i,g){return 0===g&&i.ctrlKey||2===g}_move(i,g){const y=.8*(g.x-i.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(i){i.preventDefault()}}class ud extends Al{_correctButton(i,g){return 0===g&&i.ctrlKey||2===g}_move(i,g){const y=-.5*(g.y-i.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(i){i.preventDefault()}}class hu{constructor(i,g){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.Point(0,0)}touchstart(i,g,y){return this._calculateTransform(i,g,y)}touchmove(i,g,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===y.length&&!f.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,g,y)}}touchend(i,g,y){this._calculateTransform(i,g,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,g,y){y.length>0&&(this._active=!0);const A=Xs(y,g),T=new f.Point(0,0),N=new f.Point(0,0);let k=0;for(const Q in A){const J=A[Q],de=this._touches[Q];de&&(T._add(J),N._add(J.sub(de)),k++,A[Q]=J)}if(this._touches=A,k<this._minTouches||!N.mag())return;const H=N.div(k);return this._sum._add(H),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(k),panDelta:H}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Va{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,g,y){return{}}touchstart(i,g,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([g[0],g[1]]))}touchmove(i,g,y){const A=this._firstTwoTouches;if(!A)return;i.preventDefault();const[T,N]=A,k=lc(y,g,T),H=lc(y,g,N);if(!k||!H)return;const Q=this._aroundCenter?null:k.add(H).div(2);return this._move([k,H],Q,i)}touchend(i,g,y){if(!this._firstTwoTouches)return;const[A,T]=this._firstTwoTouches,N=lc(y,g,A),k=lc(y,g,T);N&&k||(this._active&&Jn(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function lc(_,i,g){for(let y=0;y<_.length;y++)if(_[y].identifier===g)return i[y]}function dd(_,i){return Math.log(_/i)/Math.LN2}class cc extends Va{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,g){const y=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(dd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dd(this._distance,y),pinchAround:g}}}function gl(_,i){return 180*_.angleWith(i)/Math.PI}class hd extends Va{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,g){const y=this._vector;if(this._vector=i[0].sub(i[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:gl(this._vector,y),pinchAround:g}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const g=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const A=gl(i,y);return Math.abs(A)<g}}function Dl(_){return Math.abs(_.y)>Math.abs(_.x)}class ei extends Va{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Dl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,g,y){const A=this._lastPoints;if(!A)return;const T=i[0].sub(A[0]),N=i[1].sub(A[1]);return this._map._cooperativeGestures&&!f.isFullscreen()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,N,y.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(T.y+N.y)/2*-.5})}gestureBeginsVertically(i,g,y){if(void 0!==this._valid)return this._valid;const A=i.mag()>=2,T=g.mag()>=2;if(!A&&!T)return;if(!A||!T)return null==this._firstMove&&(this._firstMove=y),y-this._firstMove<100&&void 0;const N=i.y>0==g.y>0;return Dl(i)&&Dl(g)&&N}}const Nl={panStep:100,bearingStep:15,pitchStep:10};class Vd{constructor(){const i=Nl;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let g=0,y=0,A=0,T=0,N=0;switch(i.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:i.shiftKey?y=-1:(i.preventDefault(),T=-1);break;case 39:i.shiftKey?y=1:(i.preventDefault(),T=1);break;case 38:i.shiftKey?A=1:(i.preventDefault(),N=-1);break;case 40:i.shiftKey?A=-1:(i.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(y=0,A=0),{cameraAnimation:k=>{const H=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Ru,zoom:g?Math.round(H)+g*(i.shiftKey?2:1):H,bearing:k.getBearing()+y*this._bearingStep,pitch:k.getPitch()+A*this._pitchStep,offset:[-T*this._panStep,-N*this._panStep],center:k.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ru(_){return _*(2-_)}const Cc=4.000244140625;class fd{constructor(i,g){this._map=i,this._el=i.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||f.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=i.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const y=f.exported.now(),A=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,0!==g&&g%Cc==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":A>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(A*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),i.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=i,this._delta-=g,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=mr(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const H="wheel"===this._type&&Math.abs(this._delta)>Cc?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&0!==Q&&(Q=1/Q);const J=g(),de=Math.pow(2,J),ye="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):de;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(ye*Q))),"wheel"===this._type&&(this._startZoom=J,this._easing=this._smoothOutEasing(200)),this._delta=0}const y="number"==typeof this._targetZoom?this._targetZoom:g(),A=this._startZoom,T=this._easing;let N,k=!1;if("wheel"===this._type&&A&&T){const H=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),Q=T(H);N=f.number(A,y,Q),H<1?this._frameId||(this._frameId=!0):k=!0}else N=y,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:N-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let g=f.ease;if(this._prevEase){const y=this._prevEase,A=(f.exported.now()-y.start)/y.duration,T=y.easing(A+.01)-y.easing(A),N=.27/Math.sqrt(T*T+1e-4)*.01,k=Math.sqrt(.0729-N*N);g=f.bezier(N,k,.25,1)}return this._prevEase={start:f.exported.now(),duration:i,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Lu{constructor(i,g){this._clickZoom=i,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ct{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,g){return i.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(i.shiftKey?-1:1),around:y.unproject(g)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pd{constructor(){this._tap=new la({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,g,y){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=g[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(i,g,y))}touchmove(i,g,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const A=g[0],T=A.y-this._swipePoint.y;return this._swipePoint=A,i.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(i,g,y)}touchend(i,g,y){this._tapTime?this._swipePoint&&0===y.length&&this.reset():this._tap.touchend(i,g,y)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fe{constructor(i,g,y){this._el=i,this._mousePan=g,this._touchPan=y}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ah{constructor(i,g,y){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=g,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dh{constructor(i,g,y,A){this._el=i,this._touchZoom=g,this._touchRotate=y,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ca=_=>_.zoom||_.drag||_.pitch||_.rotate;class hn extends f.Event{}class no{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,g){const y=f.sub([],g,i);this.radius=f.length(y[2]<0?f.div([],y,this.constants):[y[0],y[1],0])}projectRay(i){f.div(i,i,this.constants),f.normalize(i,i),f.mul$1(i,i,this.constants);const g=f.scale$2([],i,this.radius);if(g[2]>0){const y=f.scale$2([],[0,0,1],f.dot(g,[0,0,1])),A=f.scale$2([],f.normalize([],[g[0],g[1],0]),this.radius),T=f.add([],g,f.scale$2([],f.sub([],f.add([],A,y),g),2));g[0]=T[0],g[1]=T[1]}return g}}function ja(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Tl{constructor(i,g){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xc(i),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new no,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),f.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[A,T,N]of this._listeners)A.addEventListener(T,A===f.window.document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[i,g,y]of this._listeners)i.removeEventListener(g,i===f.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(i){const g=this._map,y=g.getCanvasContainer();this._add("mapEvent",new du(g,i));const A=g.boxZoom=new Do(g,i);this._add("boxZoom",A);const T=new Kc,N=new Ct;g.doubleClickZoom=new Lu(N,T),this._add("tapZoom",T),this._add("clickZoom",N);const k=new pd;this._add("tapDragZoom",k);const H=g.touchPitch=new ei(g);this._add("touchPitch",H);const Q=new cd(i),J=new ud(i);g.dragRotate=new Ah(i,Q,J),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);const de=new _a(i),ye=new hu(g,i);g.dragPan=new Fe(y,de,ye),this._add("mousePan",de),this._add("touchPan",ye,["touchZoom","touchRotate"]);const Ae=new hd,we=new cc;g.touchZoomRotate=new Dh(y,we,Ae,k),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yc(g));const Se=g.scrollZoom=new fd(g,this);this._add("scrollZoom",Se,["mousePan"]);const Me=g.keyboard=new Vd;this._add("keyboard",Me);for(const he of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[he]&&g[he].enable(i[he])}_add(i,g,y){this._handlers.push({handlerName:i,handler:g,allowed:y}),this._handlersById[i]=g}stop(i){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ca(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,g,y){for(const A in i)if(A!==y&&(!g||g.indexOf(A)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const g=[];for(const y of i)this._el.contains(y.target)&&g.push(y);return g}handleEvent(i,g){this._updatingCamera=!0;const y="renderFrame"===i.type,A=y?void 0:i,T={needsRenderFrame:!1},N={},k={},H=i.touches?this._getMapTouches(i.touches):void 0,Q=H?Xt(this._el,H):y?void 0:mr(this._el,i);for(const{handlerName:ye,handler:Ae,allowed:we}of this._handlers){if(!Ae.isEnabled())continue;let Se;this._blockedByActive(k,we,ye)?Ae.reset():Ae[g||i.type]&&(Se=Ae[g||i.type](i,Q,H),this.mergeHandlerResult(T,N,Se,ye,A),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||Ae.isActive())&&(k[ye]=Ae)}const J={};for(const ye in this._previousActiveHandlers)k[ye]||(J[ye]=A);this._previousActiveHandlers=k,(Object.keys(J).length||ja(T))&&(this._changes.push([T,N,J]),this._triggerRenderFrame()),(Object.keys(k).length||ja(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=T;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))}mergeHandlerResult(i,g,y,A,T){if(!y)return;f.extend(i,y);const N={handlerName:A,originalEvent:y.originalEvent||T};void 0!==y.zoomDelta&&(g.zoom=N),void 0!==y.panDelta&&(g.drag=N),void 0!==y.pitchDelta&&(g.pitch=N),void 0!==y.bearingDelta&&(g.rotate=N)}_applyChanges(){const i={},g={},y={};for(const[A,T,N]of this._changes)A.panDelta&&(i.panDelta=(i.panDelta||new f.Point(0,0))._add(A.panDelta)),A.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+A.pitchDelta),void 0!==A.around&&(i.around=A.around),void 0!==A.aroundCoord&&(i.aroundCoord=A.aroundCoord),void 0!==A.pinchAround&&(i.pinchAround=A.pinchAround),A.noInertia&&(i.noInertia=A.noInertia),f.extend(g,T),f.extend(y,N);this._updateMapTransform(i,g,y),this._changes=[]}_updateMapTransform(i,g,y){const A=this._map,T=A.transform,N=Te=>[Te.x,Te.y,Te.z];if((Te=>{const Be=this._eventsInProgress.drag;return Be&&!this._handlersById[Be.handlerName].isActive()})()&&!ja(i)){const Te=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",Te!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&A._stop(!0),!ja(i))return void this._fireEvents(g,y,!0);let{panDelta:k,zoomDelta:H,bearingDelta:Q,pitchDelta:J,around:de,aroundCoord:ye,pinchAround:Ae}=i;T._isCameraConstrained&&(H>0&&(H=0),T._isCameraConstrained=!1),void 0!==Ae&&(de=Ae),(H||(Te=>g.drag&&!this._eventsInProgress.drag)())&&de&&(this._dragOrigin=N(T.pointCoordinate3D(de)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",A._stop(!0),de=de||A.transform.centerPoint,Q&&(T.bearing+=Q),J&&(T.pitch+=J),T._updateCameraState();const we=[0,0,0];if(k)if("mercator"===T.projection.name){const Te=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(de).dir),Be=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(de.sub(k)).dir);we[0]=Be[0]-Te[0],we[1]=Be[1]-Te[1]}else{const Te=T.pointCoordinate(de);if("globe"===T.projection.name){k=k.rotate(-T.angle);const Be=T._pixelsPerMercatorPixel/T.worldSize;we[0]=-k.x*f.mercatorScale(f.latFromMercatorY(Te.y))*Be,we[1]=-k.y*f.mercatorScale(T.center.lat)*Be}else{const Be=T.pointCoordinate(de.sub(k));Te&&Be&&(we[0]=Be.x-Te.x,we[1]=Be.y-Te.y)}}const Se=T.zoom,Me=[0,0,0];if(H){const Te=N(ye||T.pointCoordinate3D(de)),Be={dir:f.normalize([],f.sub([],Te,T._camera.position))};if(Be.dir[2]<0){const Ve=T.zoomDeltaToMovement(Te,H);f.scale$2(Me,Be.dir,Ve)}}const he=f.add(we,we,Me);T._translateCameraConstrained(he),H&&Math.abs(T.zoom-Se)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(g,y,!0)}_fireEvents(i,g,y){const A=ca(this._eventsInProgress),T=ca(i),N={};for(const J in i){const{originalEvent:de}=i[J];this._eventsInProgress[J]||(N[`${J}start`]=de),this._eventsInProgress[J]=i[J]}!A&&T&&this._fireEvent("movestart",T.originalEvent);for(const J in N)this._fireEvent(J,N[J]);T&&this._fireEvent("move",T.originalEvent);for(const J in i){const{originalEvent:de}=i[J];this._fireEvent(J,de)}const k={};let H;for(const J in this._eventsInProgress){const{handlerName:de,originalEvent:ye}=this._eventsInProgress[J];this._handlersById[de].isActive()||(delete this._eventsInProgress[J],H=g[de]||ye,k[`${J}end`]=H)}for(const J in k)this._fireEvent(J,k[J]);const Q=ca(this._eventsInProgress);if(y&&(A||T)&&!Q){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),de=ye=>0!==ye&&-this._bearingSnap<ye&&ye<this._bearingSnap;J?(de(J.bearing||this._map.getBearing())&&(J.bearing=0),this._map.easeTo(J,{originalEvent:H})):(this._map.fire(new f.Event("moveend",{originalEvent:H})),de(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,g){this._map.fire(new f.Event(i,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new hn("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const hs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ac extends f.Evented{constructor(i,g){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=!1!==g.respectPrefersReducedMotion,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,g){return this.jumpTo({center:i},g)}panBy(i,g,y){return i=f.Point.convert(i).mult(-1),this.panTo(this.transform.center,f.extend({offset:i},g),y)}panTo(i,g,y){return this.easeTo(f.extend({center:i},g),y)}getZoom(){return this.transform.zoom}setZoom(i,g){return this.jumpTo({zoom:i},g),this}zoomTo(i,g,y){return this.easeTo(f.extend({zoom:i},g),y)}zoomIn(i,g){return this.zoomTo(this.getZoom()+1,i,g),this}zoomOut(i,g){return this.zoomTo(this.getZoom()-1,i,g),this}getBearing(){return this.transform.bearing}setBearing(i,g){return this.jumpTo({bearing:i},g),this}getPadding(){return this.transform.padding}setPadding(i,g){return this.jumpTo({padding:i},g),this}rotateTo(i,g,y){return this.easeTo(f.extend({bearing:i},g),y)}resetNorth(i,g){return this.rotateTo(0,f.extend({duration:1e3},i),g),this}resetNorthPitch(i,g){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},i),g),this}snapToNorth(i,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,g):this}getPitch(){return this.transform.pitch}setPitch(i,g){return this.jumpTo({pitch:i},g),this}cameraForBounds(i,g){i=f.LngLatBounds.convert(i);const y=g&&g.bearing||0,A=g&&g.pitch||0,T=i.getNorthWest(),N=i.getSouthEast();return this._cameraForBounds(this.transform,T,N,y,A,g)}_extendCameraOptions(i){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=f.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const y=i.padding;i.padding={top:y,bottom:y,right:y,left:y}}return i.padding=f.extend(g,i.padding),i}_minimumAABBFrustumDistance(i,g){const y=g.max[0]-g.min[0],A=g.max[1]-g.min[1];return y/A>i.aspect?y/(2*Math.tan(.5*i.fovX)*i.aspect):A/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,g,y,A,T,N){const k=i.clone(),H=this._extendCameraOptions(N);k.bearing=A,k.pitch=T;const Q=f.LngLat.convert(g),J=f.LngLat.convert(y),de=.5*(Q.lat+J.lat),ye=.5*(Q.lng+J.lng),Ae=f.latLngToECEF(de,ye),we=f.normalize([],Ae),Se=f.normalize([],f.cross([],we,[0,1,0])),Me=f.cross([],Se,we),he=[Se[0],Se[1],Se[2],0,Me[0],Me[1],Me[2],0,we[0],we[1],we[2],0,0,0,0,1],Te=[Ae,f.latLngToECEF(Q.lat,Q.lng),f.latLngToECEF(J.lat,Q.lng),f.latLngToECEF(J.lat,J.lng),f.latLngToECEF(Q.lat,J.lng),f.latLngToECEF(de,Q.lng),f.latLngToECEF(de,J.lng),f.latLngToECEF(Q.lat,ye),f.latLngToECEF(J.lat,ye)];let Be=f.Aabb.fromPoints(Te.map(gn=>[f.dot(Se,gn),f.dot(Me,gn),f.dot(we,gn)]));const Ve=f.transformMat4([],Be.center,he);0===f.squaredLength(Ve)&&f.set(Ve,0,0,1),f.normalize(Ve,Ve),f.scale$2(Ve,Ve,f.GLOBE_RADIUS),k.center=f.ecefToLatLng(Ve);const tt=k.getWorldToCameraMatrix(),Qe=f.invert(new Float64Array(16),tt);Be=f.Aabb.applyTransform(Be,f.multiply([],tt,he)),f.transformMat4(Ve,Ve,tt);const nt=.5*(Be.max[2]-Be.min[2]),vt=this._minimumAABBFrustumDistance(k,Be),pt=f.scale$2([],[0,0,1],nt),Lt=f.add(pt,Ve,pt),En=vt+(0===k.pitch?0:f.distance(Ve,Lt)),Ot=k.globeCenterInViewSpace,sn=f.sub([],Ve,[Ot[0],Ot[1],Ot[2]]);f.normalize(sn,sn),f.scale$2(sn,sn,En);const jt=f.add([],Ve,sn);f.transformMat4(jt,jt,Qe);const yn=f.earthRadius/f.GLOBE_RADIUS,It=f.length(jt),on=f.mercatorZfromAltitude(Math.max(It*yn-f.earthRadius,Number.EPSILON),0),Cn=Math.min(k.zoomFromMercatorZAdjusted(on),H.maxZoom);return Cn>.5*(f.GLOBE_ZOOM_THRESHOLD_MIN+f.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=Cn,this._cameraForBounds(k,g,y,A,T,N)):{center:k.center,zoom:Cn,bearing:A,pitch:T}}queryTerrainElevation(i,g){const y=this.transform.elevation;return y?(g=f.extend({},{exaggerated:!0},g),y.getAtPoint(f.MercatorCoordinate.fromLngLat(i),null,g.exaggerated)):null}_cameraForBounds(i,g,y,A,T,N){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,g,y,A,T,N);const k=i.clone(),H=this._extendCameraOptions(N),Q=k.padding;k.bearing=A,k.pitch=T;const J=f.LngLat.convert(g),de=f.LngLat.convert(y),ye=new f.LngLat(J.lng,de.lat),Ae=new f.LngLat(de.lng,J.lat),we=k.project(J),Se=k.project(de),Me=this.queryTerrainElevation(J),he=this.queryTerrainElevation(de),Te=this.queryTerrainElevation(ye),Be=this.queryTerrainElevation(Ae),Ve=[[we.x,we.y,Math.min(Me||0,he||0,Te||0,Be||0)],[Se.x,Se.y,Math.max(Me||0,he||0,Te||0,Be||0)]];let tt=f.Aabb.fromPoints(Ve);const Qe=k.getWorldToCameraMatrix(),nt=f.invert(new Float64Array(16),Qe);tt=f.Aabb.applyTransform(tt,Qe);const vt=f.sub([],tt.max,tt.min),pt=Q.left||0,Lt=Q.right||0,En=Q.bottom||0,Ot=Q.top||0,{left:sn,right:jt,top:yn,bottom:It}=H.padding,on=.5*(pt+Lt),Cn=.5*(Ot+En),gn=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(pt+Lt+sn+jt))/vt[0],(k.height-(En+Ot+It+yn))/vt[1])),H.maxZoom),An=k.scale/k.zoomScale(gn);tt=new f.Aabb([tt.min[0]-(sn+on)*An,tt.min[1]-(It+Cn)*An,tt.min[2]],[tt.max[0]+(jt+on)*An,tt.max[1]+(yn+Cn)*An,tt.max[2]]);const Er=.5*vt[2],Kr=this._minimumAABBFrustumDistance(k,tt),sr=[0,0,1,0];f.transformMat4$1(sr,sr,Qe),f.normalize$2(sr,sr);const Nr=f.scale$2([],sr,Kr+Er),_i=f.add([],tt.center,Nr),oi=("number"==typeof H.offset.x&&"number"==typeof H.offset.y?new f.Point(H.offset.x,H.offset.y):f.Point.convert(H.offset)).rotate(-f.degToRad(A));tt.center[0]-=oi.x*An,tt.center[1]+=oi.y*An,f.transformMat4(tt.center,tt.center,nt),f.transformMat4(_i,_i,nt);const dr=[tt.center[0],tt.center[1],_i[2]*k.pixelsPerMeter];f.scale$2(dr,dr,1/k.worldSize);const Gi=f.lngFromMercatorX(dr[0]),oo=f.latFromMercatorY(dr[1]),uo=Math.min(k._zoomFromMercatorZ(dr[2]),H.maxZoom),To=new f.LngLat(Gi,oo);return k.mercatorFromTransition&&uo<.5*(f.GLOBE_ZOOM_THRESHOLD_MIN+f.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=uo,this._cameraForBounds(k,g,y,A,T,N)):{center:To,zoom:uo,bearing:A,pitch:T}}fitBounds(i,g,y){const A=this.cameraForBounds(i,g);return this._fitInternal(A,g,y)}fitScreenCoordinates(i,g,y,A,T){const N=f.Point.convert(i),k=f.Point.convert(g),H=new f.Point(Math.min(N.x,k.x),Math.min(N.y,k.y)),Q=new f.Point(Math.max(N.x,k.x),Math.max(N.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(N,k))return this;const J=this.transform.pointLocation3D(H),de=this.transform.pointLocation3D(Q),ye=this.transform.pointLocation3D(new f.Point(H.x,Q.y)),Ae=this.transform.pointLocation3D(new f.Point(Q.x,H.y)),we=[Math.min(J.lng,de.lng,ye.lng,Ae.lng),Math.min(J.lat,de.lat,ye.lat,Ae.lat)],Se=[Math.max(J.lng,de.lng,ye.lng,Ae.lng),Math.max(J.lat,de.lat,ye.lat,Ae.lat)],Me=A&&A.pitch?A.pitch:this.getPitch(),he=this._cameraForBounds(this.transform,we,Se,y,Me,A);return this._fitInternal(he,A,T)}_fitInternal(i,g,y){return i?(delete(g=f.extend(i,g)).padding,g.linear?this.easeTo(g,y):this.flyTo(g,y)):this}jumpTo(i,g){this.stop();const y=i.preloadOnly?this.transform.clone():this.transform;let A=!1,T=!1,N=!1;return"zoom"in i&&y.zoom!==+i.zoom&&(A=!0,y.zoom=+i.zoom),void 0!==i.center&&(y.center=f.LngLat.convert(i.center)),"bearing"in i&&y.bearing!==+i.bearing&&(T=!0,y.bearing=+i.bearing),"pitch"in i&&y.pitch!==+i.pitch&&(N=!0,y.pitch=+i.pitch),null==i.padding||y.isPaddingEqual(i.padding)||(y.padding=i.padding),i.preloadOnly?(this._preloadTiles(y),this):(this.fire(new f.Event("movestart",g)).fire(new f.Event("move",g)),A&&this.fire(new f.Event("zoomstart",g)).fire(new f.Event("zoom",g)).fire(new f.Event("zoomend",g)),T&&this.fire(new f.Event("rotatestart",g)).fire(new f.Event("rotate",g)).fire(new f.Event("rotateend",g)),N&&this.fire(new f.Event("pitchstart",g)).fire(new f.Event("pitch",g)).fire(new f.Event("pitchend",g)),this.fire(new f.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(hs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,g){const y=this.transform;if(!y.projection.supportsFreeCamera)return f.warnOnce(hs),this;this.stop();const A=y.zoom,T=y.pitch,N=y.bearing;y.setFreeCameraOptions(i);const k=A!==y.zoom,H=T!==y.pitch,Q=N!==y.bearing;return this.fire(new f.Event("movestart",g)).fire(new f.Event("move",g)),k&&this.fire(new f.Event("zoomstart",g)).fire(new f.Event("zoom",g)).fire(new f.Event("zoomend",g)),Q&&this.fire(new f.Event("rotatestart",g)).fire(new f.Event("rotate",g)).fire(new f.Event("rotateend",g)),H&&this.fire(new f.Event("pitchstart",g)).fire(new f.Event("pitch",g)).fire(new f.Event("pitchend",g)),this.fire(new f.Event("moveend",g)),this}easeTo(i,g){this._stop(!1,i.easeId),(!1===(i=f.extend({offset:[0,0],duration:500,easing:f.ease},i)).animate||this._prefersReducedMotion(i))&&(i.duration=0);const y=this.transform,A=this.getZoom(),T=this.getBearing(),N=this.getPitch(),k=this.getPadding(),H="zoom"in i?+i.zoom:A,Q="bearing"in i?this._normalizeBearing(i.bearing,T):T,J="pitch"in i?+i.pitch:N,de="padding"in i?i.padding:y.padding,ye=f.Point.convert(i.offset);let Ae,we,Se;if("globe"===y.projection.name){const pt=f.MercatorCoordinate.fromLngLat(y.center),Lt=ye.rotate(-y.angle);pt.x+=Lt.x/y.worldSize,pt.y+=Lt.y/y.worldSize;const En=pt.toLngLat(),Ot=f.LngLat.convert(i.center||En);this._normalizeCenter(Ot),Ae=y.centerPoint.add(Lt),we=new f.Point(pt.x,pt.y).mult(y.worldSize),Se=new f.Point(f.mercatorXfromLng(Ot.lng),f.mercatorYfromLat(Ot.lat)).mult(y.worldSize).sub(we)}else{Ae=y.centerPoint.add(ye);const pt=y.pointLocation(Ae),Lt=f.LngLat.convert(i.center||pt);this._normalizeCenter(Lt),we=y.project(pt),Se=y.project(Lt).sub(we)}const Me=y.zoomScale(H-A);let he,Te;i.around&&(he=f.LngLat.convert(i.around),Te=y.locationPoint(he));const Be=this._zooming||H!==A,Ve=this._rotating||T!==Q,tt=this._pitching||J!==N,Qe=!y.isPaddingEqual(de),nt=pt=>Lt=>{if(Be&&(pt.zoom=f.number(A,H,Lt)),Ve&&(pt.bearing=f.number(T,Q,Lt)),tt&&(pt.pitch=f.number(N,J,Lt)),Qe&&(pt.interpolatePadding(k,de,Lt),Ae=pt.centerPoint.add(ye)),he)pt.setLocationAtPoint(he,Te);else{const En=pt.zoomScale(pt.zoom-A),Ot=H>A?Math.min(2,Me):Math.max(.5,Me),sn=Math.pow(Ot,1-Lt),jt=pt.unproject(we.add(Se.mult(Lt*sn)).mult(En));pt.setLocationAtPoint(pt.renderWorldCopies?jt.wrap():jt,Ae)}return i.preloadOnly||this._fireMoveEvents(g),pt};if(i.preloadOnly){const pt=this._emulate(nt,i.duration,y);return this._preloadTiles(pt),this}const vt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Be,this._rotating=Ve,this._pitching=tt,this._padding=Qe,this._easeId=i.easeId,this._prepareEase(g,i.noMoveStart,vt),this._ease(nt(y),pt=>{y.recenterOnTerrain(),this._afterEase(g,pt)},i),this}_prepareEase(i,g,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||y.moving||this.fire(new f.Event("movestart",i)),this._zooming&&!y.zooming&&this.fire(new f.Event("zoomstart",i)),this._rotating&&!y.rotating&&this.fire(new f.Event("rotatestart",i)),this._pitching&&!y.pitching&&this.fire(new f.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new f.Event("move",i)),this._zooming&&this.fire(new f.Event("zoom",i)),this._rotating&&this.fire(new f.Event("rotate",i)),this._pitching&&this.fire(new f.Event("pitch",i))}_afterEase(i,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,A=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new f.Event("zoomend",i)),A&&this.fire(new f.Event("rotateend",i)),T&&this.fire(new f.Event("pitchend",i)),this.fire(new f.Event("moveend",i))}flyTo(i,g){if(this._prefersReducedMotion(i)){const gn=f.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(gn,g)}this.stop(),i=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},i);const y=this.transform,A=this.getZoom(),T=this.getBearing(),N=this.getPitch(),k=this.getPadding(),H="zoom"in i?f.clamp(+i.zoom,y.minZoom,y.maxZoom):A,Q="bearing"in i?this._normalizeBearing(i.bearing,T):T,J="pitch"in i?+i.pitch:N,de="padding"in i?i.padding:y.padding,ye=y.zoomScale(H-A),Ae=f.Point.convert(i.offset);let we=y.centerPoint.add(Ae);const Se=y.pointLocation(we),Me=f.LngLat.convert(i.center||Se);this._normalizeCenter(Me);const he=y.project(Se),Te=y.project(Me).sub(he);let Be=i.curve;const Ve=Math.max(y.width,y.height),tt=Ve/ye,Qe=Te.mag();if("minZoom"in i){const gn=f.clamp(Math.min(i.minZoom,A,H),y.minZoom,y.maxZoom),An=Ve/y.zoomScale(gn-A);Be=Math.sqrt(An/Qe*2)}const nt=Be*Be;function vt(gn){const An=(tt*tt-Ve*Ve+(gn?-1:1)*nt*nt*Qe*Qe)/(2*(gn?tt:Ve)*nt*Qe);return Math.log(Math.sqrt(An*An+1)-An)}function pt(gn){return(Math.exp(gn)-Math.exp(-gn))/2}function Lt(gn){return(Math.exp(gn)+Math.exp(-gn))/2}const En=vt(0);let Ot=function(gn){return Lt(En)/Lt(En+Be*gn)},sn=function(gn){return Ve*((Lt(En)*(pt(An=En+Be*gn)/Lt(An))-pt(En))/nt)/Qe;var An},jt=(vt(1)-En)/Be;if(Math.abs(Qe)<1e-6||!isFinite(jt)){if(Math.abs(Ve-tt)<1e-6)return this.easeTo(i,g);const gn=tt<Ve?-1:1;jt=Math.abs(Math.log(tt/Ve))/Be,sn=function(){return 0},Ot=function(An){return Math.exp(gn*Be*An)}}i.duration="duration"in i?+i.duration:1e3*jt/("screenSpeed"in i?+i.screenSpeed/Be:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const yn=T!==Q,It=J!==N,on=!y.isPaddingEqual(de),Cn=gn=>An=>{const Er=An*jt,Kr=1/Ot(Er);gn.zoom=1===An?H:A+gn.scaleZoom(Kr),yn&&(gn.bearing=f.number(T,Q,An)),It&&(gn.pitch=f.number(N,J,An)),on&&(gn.interpolatePadding(k,de,An),we=gn.centerPoint.add(Ae));const sr=1===An?Me:gn.unproject(he.add(Te.mult(sn(Er))).mult(Kr));return gn.setLocationAtPoint(gn.renderWorldCopies?sr.wrap():sr,we),gn._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(g),gn};if(i.preloadOnly){const gn=this._emulate(Cn,i.duration,y);return this._preloadTiles(gn),this}return this._zooming=!0,this._rotating=yn,this._pitching=It,this._padding=on,this._prepareEase(g,!1),this._ease(Cn(y),()=>this._afterEase(g),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,g)}if(!i){const y=this.handlers;y&&y.stop(!1)}return this}_ease(i,g,y){!1===y.animate||0===y.duration?(i(1),g()):(this._easeStart=f.exported.now(),this._easeOptions=y,this._onEaseFrame=i,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,g){i=f.wrap(i,-180,180);const y=Math.abs(i-g);return Math.abs(i-360-g)<y&&(i-=360),Math.abs(i+360-g)<y&&(i+=360),i}_normalizeCenter(i){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const y=i.lng-g.center.lng;i.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&f.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,g,y){const A=Math.ceil(15*g/1e3),T=[],N=i(y.clone());for(let k=0;k<=A;k++){const H=N(k/A);T.push(H.clone())}return T}}class Kn{constructor(i={}){this.options=i,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const g=this.options&&this.options.compact;return this._map=i,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xt("button","mapboxgl-ctrl-attrib-button",this._container),xt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,g){const y=this._map._getUIString(`AttributionControl.${g}`);i.setAttribute("aria-label",y),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(i){const y=g.reduce((A,T,N)=>(T.value&&(A+=`${T.key}=${T.value}${N<g.length-1?"&":""}`),A),"?");i.href=`${f.config.FEEDBACK_URL}/${y}#${nl(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const A=this._map.style.stylesheet;this.styleOwner=A.owner,this.styleId=A.id}const g=this._map.style._sourceCaches;for(const A in g){const T=g[A];if(T.used){const N=T.getSource();N.attribution&&i.indexOf(N.attribution)<0&&i.push(N.attribution)}}i.sort((A,T)=>A.length-T.length),i=i.filter((A,T)=>{for(let N=T+1;N<i.length;N++)if(i[N].indexOf(A)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const y=i.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,i.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ml{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=xt("div","mapboxgl-ctrl");const g=xt("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const g in i){const y=i[g].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const g=i[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class Ma{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const g=++this._id;return this._queue.push({callback:i,id:g,cancelled:!1}),g}remove(i){const g=this._currentlyRunning,y=g?this._queue.concat(g):this._queue;for(const A of y)if(A.id===i)return void(A.cancelled=!0)}run(i=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const y of g)if(!y.cancelled&&(y.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Jl(_,i,g){if(_=new f.LngLat(_.lng,_.lat),i){const y=new f.LngLat(_.lng-360,_.lat),A=new f.LngLat(_.lng+360,_.lat),T=360*Math.ceil(Math.abs(_.lng-g.center.lng)/360),N=g.locationPoint(_).distSqr(i),k=i.x<0||i.y<0||i.x>g.width||i.y>g.height;g.locationPoint(y).distSqr(i)<N&&(k||Math.abs(y.lng-g.center.lng)<T)?_=y:g.locationPoint(A).distSqr(i)<N&&(k||Math.abs(A.lng-g.center.lng)<T)&&(_=A)}for(;Math.abs(_.lng-g.center.lng)>180;){const y=g.locationPoint(_);if(y.x>=0&&y.y>=0&&y.x<=g.width&&y.y<=g.height)break;_.lng>g.center.lng?_.lng-=360:_.lng+=360}return _}const co={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $n extends f.Evented{constructor(i,g){if(super(),(i instanceof f.window.HTMLElement||g)&&(i=f.extend({element:i},g)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=f.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=xt("div");const A=41,T=27,N=ft("svg",{display:"block",height:A*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${A}`},this._element),k=ft("radialGradient",{id:"shadowGradient"},ft("defs",{},N));ft("stop",{offset:"10%","stop-opacity":.4},k),ft("stop",{offset:"100%","stop-opacity":.05},k),ft("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},N),ft("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},N),ft("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},N),ft("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},N),this._offset=f.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",A=>{A.preventDefault()}),this._element.addEventListener("mousedown",A=>{A.preventDefault()});const y=this._element.classList;for(const A in co)y.remove(`mapboxgl-marker-anchor-${A}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=f.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const A=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[A,-1*(24.6+A)],"bottom-right":[-A,-1*(24.6+A)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const g=i.code,y=i.charCode||i.keyCode;"Space"!==g&&"Enter"!==g&&32!==y&&13!==y||this.togglePopup()}_onMapClick(i){const g=i.originalEvent.target,y=this._element;this._popup&&(g===y||y.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,g=this._pos;if(!i||!g)return!1;const y=i.unproject(g),A=i.getFreeCameraOptions();if(!A.position)return!1;const T=A.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const g=this._pos;if(!g||g.x<0||g.x>i.transform.width||g.y<0||g.y>i.transform.height)return void this._clearFadeTimer();const y=i.unproject(g);let A;i._showingGlobe()&&f.isLngLatBehindGlobe(i.transform,this._lngLat)?A=0:(A=1-i._queryFogOpacity(y),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(A*=this._occludedOpacity)),this._element.style.opacity=`${A}`,this._element.style.pointerEvents=A>0?"auto":"none",this._popup&&this._popup._setOpacity(A),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${co[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const i=this._pos,g=this._map,y=this.getPitchAlignment();if(!g||!i||"map"!==y)return"";if(!g._showingGlobe()){const H=g.getPitch();return H?`rotateX(${H}deg)`:""}const A=f.radToDeg(f.globeTiltAtLngLat(g.transform,this._lngLat)),T=i.sub(f.globeCenterToScreenPoint(g.transform)),N=Math.abs(T.x)+Math.abs(T.y);if(0===N)return"";const k=A/N;return`rotateX(${-T.y*k}deg) rotateY(${T.x*k}deg)`}_calculateZTransform(){const i=this._pos,g=this._map;if(!g||!i)return"";let y=0;const A=this.getRotationAlignment();if("map"===A)if(g._showingGlobe()){const T=g.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),N=g.project(new f.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=f.radToDeg(Math.atan2(N.y,N.x))-90}else y=-g.getBearing();else if("horizon"===A){const T=f.smoothstep(4,6,g.getZoom()),N=f.globeCenterToScreenPoint(g.transform);N.y+=T*g.transform.height;const k=i.sub(N),H=f.radToDeg(Math.atan2(k.y,k.x));y=(H>90?H-270:H+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(i){f.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=Jl(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===i?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=f.Point.convert(i),this._update(),this}_onMove(i){const g=this._map;if(!g)return;const y=this._pointerdownPos,A=this._positionDelta;if(y&&A){if(!this._isDragging){const T=this._clickTolerance||g._clickTolerance;if(i.point.dist(y)<T)return;this._isDragging=!0}this._pos=i.point.sub(A),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(i){const g=this._map,y=this._pos;g&&y&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(y),this._pointerdownPos=i.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const g=this._map;return g&&(i?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const fu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ha=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kl(_=new f.Point(0,0),i="bottom"){if("number"==typeof _){const g=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(i){case"top":return new f.Point(0,_);case"top-left":return new f.Point(g,g);case"top-right":return new f.Point(-g,g);case"bottom":return new f.Point(0,-_);case"bottom-left":return new f.Point(g,-g);case"bottom-right":return new f.Point(-g,-g);case"left":return new f.Point(_,0);case"right":return new f.Point(-_,0)}return new f.Point(0,0)}return _ instanceof f.Point||Array.isArray(_)?f.Point.convert(_):f.Point.convert(_[i]||[0,0])}class pu{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const g=f.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,g,y){this._start=this.getValue(g),this._end=i,this._startTime=g,this._endTime=g+y}}const Dc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Gl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Th={showCompass:!0,showZoom:!0,visualizePitch:!1};class B{constructor(i,g,y=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new cd({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,y&&(this.mousePitch=new ud({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(i,g){this.mouseRotate.mousedown(i,g),this.mousePitch&&this.mousePitch.mousedown(i,g),zt()}move(i,g){const y=this.map,A=this.mouseRotate.mousemoveWindow(i,g),T=A&&A.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const N=this.mousePitch.mousemoveWindow(i,g),k=N&&N.pitchDelta;k&&y.setPitch(y.getPitch()+k)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){un(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(f.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),mr(this.element,i)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,mr(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Xt(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Xt(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const $={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},F={maxWidth:100,unit:"metric"},q={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},se={version:f.version,supported:ke,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends Ac{constructor(_){if(f.LivePerformanceUtils.mark(f.PerformanceMarkers.create),null!=(_=f.extend({},Gl,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(_.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ma(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._useWebGL2=_.useWebGL2,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Ma,this._domRenderTaskQueue=new Ma,this._controls=[],this._markers=[],this._popups=[],this._mapId=f.uniqueId(),this._locale=f.extend({},Dc,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new pu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new f.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=f.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Tl(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new Os("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,f.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new Kn({customAttribution:_.customAttribution})),this._logoControl=new ml,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new f.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new f.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(_,i){if(void 0===i&&(i=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=_.onAdd(this);this._controls.push(_);const y=this._controlPositions[i];return-1!==i.indexOf("bottom")?y.insertBefore(g,y.firstChild):y.appendChild(g),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(_);return i>-1&&this._controls.splice(i,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new f.Event("movestart",_)).fire(new f.Event("move",_)),this.fire(new f.Event("resize",_)),i&&this.fire(new f.Event("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(f.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?f.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(i=>"auto"===i?f.window.navigator.language:i):_}setLanguage(_){const i=this._parseLanguage(_);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,i=_.projection.name;let g;"globe"===i&&_.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),g=!0):"mercator"===i&&_.zoom<f.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,i){return this._updateProjection(_||i||{name:"mercator"})}_updateProjection(_){let i;if(i="globe"===_.name&&this.transform.zoom>=f.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(f.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(f.Point.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,i,g){if("mouseenter"===_||"mouseover"===_){let y=!1;const A=N=>{const k=i.filter(Q=>this.getLayer(Q)),H=k.length?this.queryRenderedFeatures(N.point,{layers:k}):[];H.length?y||(y=!0,g.call(this,new $r(_,this,N.originalEvent,{features:H}))):y=!1},T=()=>{y=!1};return{layers:new Set(i),listener:g,delegates:{mousemove:A,mouseout:T}}}if("mouseleave"===_||"mouseout"===_){let y=!1;const A=N=>{const k=i.filter(H=>this.getLayer(H));(k.length?this.queryRenderedFeatures(N.point,{layers:k}):[]).length?y=!0:y&&(y=!1,g.call(this,new $r(_,this,N.originalEvent)))},T=N=>{y&&(y=!1,g.call(this,new $r(_,this,N.originalEvent)))};return{layers:new Set(i),listener:g,delegates:{mousemove:A,mouseout:T}}}{const y=A=>{const T=i.filter(k=>this.getLayer(k)),N=T.length?this.queryRenderedFeatures(A.point,{layers:T}):[];N.length&&(A.features=N,g.call(this,A),delete A.features)};return{layers:new Set(i),listener:g,delegates:{[_]:y}}}}on(_,i,g){if(void 0===g)return super.on(_,i);Array.isArray(i)||(i=[i]);const y=this._createDelegatedListener(_,i,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(y);for(const A in y.delegates)this.on(A,y.delegates[A]);return this}once(_,i,g){if(void 0===g)return super.once(_,i);Array.isArray(i)||(i=[i]);const y=this._createDelegatedListener(_,i,g);for(const A in y.delegates)this.once(A,y.delegates[A]);return this}off(_,i,g){if(void 0===g)return super.off(_,i);i=new Set(Array.isArray(i)?i:[i]);const y=(T,N)=>{if(T.size!==N.size)return!1;for(const k of T)if(!N.has(k))return!1;return!0},A=this._delegatedListeners?this._delegatedListeners[_]:void 0;return A&&(T=>{for(let N=0;N<T.length;N++){const k=T[N];if(k.listener===g&&y(k.layers,i)){for(const H in k.delegates)this.off(H,k.delegates[H]);return T.splice(N,1),this}}})(A),this}queryRenderedFeatures(_,i){return this.style?(void 0!==i||void 0===_||_ instanceof f.Point||Array.isArray(_)||(i=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(_,i){return this.style.querySourceFeatures(_,i)}isPointOnSurface(_){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&f.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(f.Point.convert(_))}setStyle(_,i){return!1!==(i=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(_,i))}_getUIString(_){const i=this._locale[_];if(null==i)throw new Error(`Missing UI string '${_}'`);return i}_updateStyle(_,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new mi(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new mi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,i){if("string"==typeof _){const g=this._requestManager.normalizeStyleURL(_),y=this._requestManager.transformRequest(g,f.ResourceType.Style);f.getJSON(y,(A,T)=>{A?this.fire(new f.ErrorEvent(A)):T&&this._updateDiff(T,i)})}else"object"==typeof _&&this._updateDiff(_,i)}_updateDiff(_,i){try{this.style.setState(_)&&this._update(!0)}catch(g){f.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(_,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(_,i){return this._lazyInitEmptyStyle(),this.style.addSource(_,i),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const i in _){const g=_[i]._tiles;for(const y in g){const A=g[y];if("loaded"!==A.state&&"errored"!==A.state)return!1}}return!0}addSourceType(_,i,g){this._lazyInitEmptyStyle(),this.style.addSourceType(_,i,g)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,i,{pixelRatio:g=1,sdf:y=!1,stretchX:A,stretchY:T,content:N}={}){if(this._lazyInitEmptyStyle(),i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap){const{width:k,height:H,data:Q}=f.exported.getImageData(i);this.style.addImage(_,{data:new f.RGBAImage({width:k,height:H},Q),pixelRatio:g,stretchX:A,stretchY:T,content:N,sdf:y,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:H}=i,Q=i;this.style.addImage(_,{data:new f.RGBAImage({width:k,height:H},new Uint8Array(Q.data)),pixelRatio:g,stretchX:A,stretchY:T,content:N,sdf:y,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,_)}}updateImage(_,i){const g=this.style.getImage(_);if(!g)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap?f.exported.getImageData(i):i,{width:A,height:T}=y;void 0!==A&&void 0!==T?A===g.data.width&&T===g.data.height?(g.data.replace(y.data,!(i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap)),this.style.updateImage(_,g)):this.fire(new f.ErrorEvent(new Error(`The width and height of the updated image (${A}, ${T})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,i){f.getImage(this._requestManager.transformRequest(_,f.ResourceType.Image),(g,y)=>{i(g,y instanceof f.window.HTMLImageElement?f.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(_,i){return this._lazyInitEmptyStyle(),this.style.addLayer(_,i),this._update(!0)}moveLayer(_,i){return this.style.moveLayer(_,i),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,i,g){return this.style.setLayerZoomRange(_,i,g),this._update(!0)}setFilter(_,i,g={}){return this.style.setFilter(_,i,g),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,i,g,y={}){return this.style.setPaintProperty(_,i,g,y),this._update(!0)}getPaintProperty(_,i){return this.style.getPaintProperty(_,i)}setLayoutProperty(_,i,g,y={}){return this.style.setLayoutProperty(_,i,g,y),this._update(!0)}getLayoutProperty(_,i){return this.style.getLayoutProperty(_,i)}setLight(_,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(_),this.transform):0}setFeatureState(_,i){return this.style.setFeatureState(_,i),this._update()}removeFeatureState(_,i){return this.style.removeFeatureState(_,i),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let g,y,A,T=this._container;for(;T&&(!y||!A);){const N=f.window.getComputedStyle(T).transform;N&&"none"!==N&&(g=N.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(y=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(A=g[3])),T=T.parentElement}this._containerWidth=y?Math.abs(_/y):_,this._containerHeight=A?Math.abs(i/A):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=xt("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=xt("div","mapboxgl-canvas-container",_);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=xt("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=xt("div","mapboxgl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{y[A]=xt("div",`mapboxgl-ctrl-${A}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,i){const g=f.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(_),this._canvas.height=g*Math.ceil(i),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${i}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const i=this._markers.indexOf(_);-1!==i&&this._markers.splice(i,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const i=this._popups.indexOf(_);-1!==i&&this._popups.splice(i,1)}_setupPainter(){const _=f.extend({},ke.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",_),g=i||this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);g?(this._useWebGL2&&!i&&f.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),f.storeAuthState(g,!0),this.painter=new fe(g,this.transform,!!i),this.on("data",y=>{"source"===y.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(g)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let i;const g=this.painter.context.extTimerQuery,y=f.exported.now();if(this.listens("gpu-timing-frame")&&(i=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],f.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],f.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const A=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,H=this.transform.pitch,Q=f.exported.now(),J=new f.EvaluationParameters(k,{now:Q,fadeDuration:A,pitch:H,transition:this.style.getTransition()});this.style.update(J)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const k=f.exported.now()-y;g.endQueryEXT(g.TIME_ELAPSED_EXT,i),setTimeout(()=>{const H=g.getQueryObjectEXT(i,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(i),this.fire(new f.Event("gpu-timing-frame",{cpuTime:k,gpuTime:H})),f.window.performance.mark("frame-gpu",{startTime:y,detail:{gpuTime:H}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(k);this.fire(new f.Event("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(k);this.fire(new f.Event("gpu-timing-deferred-render",{gpuTime:H}))},50)}const N=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(N||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(T=this._updateAverageElevation(y,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,f.LivePerformanceUtils.mark(f.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&f.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const i of this._markers)_&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!_||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(_,i=!1){const g=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((i||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const y=this.transform.averageElevation;let A=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(A)?A=0:this._averageElevationLastSampledAt=_;const N=Math.abs(y-A);if(N>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(A),g(A);this._averageElevation.easeTo(A,_,300)}else if(N>1e-4)return this._averageElevation.jumpTo(A),g(A)}return!!this._averageElevation.isEasing(_)&&g(this._averageElevation.getValue(_))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===f.AUTH_ERR_MSG||401===_.status)){const i=this.painter.context.gl;f.storeAuthState(i,!1),this._logoControl instanceof ml&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const g=this.painter.context.gl,y=g.createFramebuffer();function A(T){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,T,0);const N=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,N),N}return g.bindFramebuffer(g.FRAMEBUFFER,y),this._canvasPixelComparison(A(_),i.canvasCopies.map(A),i.timeStamps)}_canvasPixelComparison(_,i,g){let y=g[1]-g[0];const A=_.length/4;for(let T=0;T<i.length;T++){const N=i[T];let k=0;for(let H=0;H<N.length;H+=4)N[H]===_[H]&&N[H+1]===_[H+1]&&N[H+2]===_[H+2]&&N[H+3]===_[H+3]&&(k+=1);y+=(g[T+2]-g[T+1])*(1-k/A)}return y}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1),f.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=f.exported.frame(i=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(i)}))}_preloadTiles(_){const i=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(i,(g,y)=>g._preloadTiles(_,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){"hidden"===f.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,i){f.setCacheLimits(_,i)}get version(){return f.version}},NavigationControl:class{constructor(_){this.options=f.extend({},Th,_),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),xt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),xt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:i}):g.resetNorth({},{originalEvent:i}))}),this._compassIcon=xt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const i=_.getZoom(),g=i===_.getMaxZoom(),y=i===_.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new B(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,i){const g=xt("button",_,this._container);return g.type="button",g.addEventListener("click",i),g}_setButtonTitle(_,i){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${i}`);_.setAttribute("aria-label",g),_.firstElementChild&&_.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends f.Evented{constructor(_){super(),this.options=f.extend({geolocation:f.window.navigator.geolocation},$,_),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Sa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const i=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,_(g)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(g=>i("denied"!==g.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(_){const i=this._map.getMaxBounds(),g=_.coords;return!!i&&(g.longitude<i.getWest()||g.longitude>i.getEast()||g.latitude<i.getSouth()||g.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",_)),this._finish()}}_updateCamera(_){const i=new f.LngLat(_.coords.longitude,_.coords.latitude),g=_.coords.accuracy,y=this._map.getBearing(),A=f.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(g),A,{geolocateSource:!0})}_updateMarker(_){if(_){const i=new f.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,i=f.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,g=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=xt("button","mapboxgl-ctrl-geolocate",this._container),xt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xt("div","mapboxgl-user-location"),this._dotElement.appendChild(xt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $n({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $n({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kn,ScaleControl:class{constructor(_){this.options=f.extend({},F,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),f.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,i=this._map,g=i._containerHeight/2,y=i._containerWidth/2-_/2,A=i.unproject([y,g]),T=i.unproject([y+_,g]),N=A.distanceTo(T);if("imperial"===this.options.unit){const k=3.2808*N;k>5280?this._setScale(_,k/5280,"mile"):this._setScale(_,k,"foot")}else"nautical"===this.options.unit?this._setScale(_,N/1852,"nautical-mile"):N>=1e3?this._setScale(_,N/1e3,"kilometer"):this._setScale(_,N,"meter")}_setScale(_,i,g){this._map._requestDomTask(()=>{const y=function(T){const N=Math.pow(10,`${Math.floor(T)}`.length-1);let k=T/N;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(H){const Q=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*Q)/Q}(k),N*k}(i),A=y/i;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(y):`${y}&nbsp;${q[g]}`,this._container.style.width=_*A+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=xt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof f.window.HTMLElement?this._container=_.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=xt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=xt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xt("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(_){super(),this.options=f.extend(Object.create(fu),_),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=f.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(f.window.document.createTextNode(_))}setHTML(_){const i=f.window.document.createDocumentFragment(),g=f.window.document.createElement("body");let y;for(g.innerHTML=_;y=g.firstChild,y;)i.appendChild(y);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=xt("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(_),this.options.closeButton){const g=this._closeButton=xt("button","mapboxgl-popup-close-button",i);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let i;return this._classList.delete(_)?i=!1:(this._classList.add(_),i=!0),this._updateClassList(),i}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const i=this._map,g=this._container,y=this._pos;if(!i||!g||!y)return"bottom";const A=g.offsetWidth,T=g.offsetHeight,N=y.x<A/2,k=y.x>i.transform.width-A/2;if(y.y+_<T)return N?"top-left":k?"top-right":"top";if(y.y>i.transform.height-T){if(N)return"bottom-left";if(k)return"bottom-right"}return N?"left":k?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),_.className=i.join(" ")}_update(_){const i=this._map,g=this._content;if(!i||!this._lngLat&&!this._trackPointer||!g)return;let y=this._container;if(y||(y=this._container=xt("div","mapboxgl-popup",i.getContainer()),this._tip=xt("div","mapboxgl-popup-tip",y),y.appendChild(g)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jl(this._lngLat,this._pos,i.transform)),!this._trackPointer||_){const A=this._pos=this._trackPointer&&_?_:i.project(this._lngLat),T=kl(this.options.offset),N=this._anchor=this._getAnchor(T.y),k=kl(this.options.offset,N),H=A.add(k).round();i._requestDomTask(()=>{this._container&&N&&(this._container.style.transform=`${co[N]} translate(${H.x}px,${H.y}px)`)})}if(!this._marker&&i._showingGlobe()){const A=f.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(A)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Ha);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:$n,Style:mi,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.Point,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:io,Evented:f.Evented,config:f.config,prewarm:function(){Je().acquire(zi)},clearPrewarmedResources:function(){const _=_t;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(zi),_t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(_){f.config.ACCESS_TOKEN=_},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(_){f.config.API_URL=_},get workerCount(){return Ji.workerCount},set workerCount(_){Ji.workerCount=_},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){f.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){f.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return se}),O}()},5619:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{X:()=>bt});var O=_e(8645);class bt extends O.x{constructor(f){super(),this._value=f}get value(){return this.getValue()}_subscribe(f){const ze=super._subscribe(f);return!ze.closed&&f.next(this._value),ze}getValue(){const{hasError:f,thrownError:ze,_value:ke}=this;if(f)throw ze;return this._throwIfClosed(),ke}next(f){super.next(this._value=f)}}},5592:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{y:()=>$t});var O=_e(305),bt=_e(7394),St=_e(4850),f=_e(8407),ze=_e(2653),ke=_e(4674),Vt=_e(1441);let $t=(()=>{class dt{constructor(zt){zt&&(this._subscribe=zt)}lift(zt){const un=new dt;return un.source=this,un.operator=zt,un}subscribe(zt,un,jn){const Jn=function it(dt){return dt&&dt instanceof O.Lv||function ft(dt){return dt&&(0,ke.m)(dt.next)&&(0,ke.m)(dt.error)&&(0,ke.m)(dt.complete)}(dt)&&(0,bt.Nn)(dt)}(zt)?zt:new O.Hp(zt,un,jn);return(0,Vt.x)(()=>{const{operator:mr,source:Xt}=this;Jn.add(mr?mr.call(Jn,Xt):Xt?this._subscribe(Jn):this._trySubscribe(Jn))}),Jn}_trySubscribe(zt){try{return this._subscribe(zt)}catch(un){zt.error(un)}}forEach(zt,un){return new(un=xt(un))((jn,Jn)=>{const mr=new O.Hp({next:Xt=>{try{zt(Xt)}catch(rr){Jn(rr),mr.unsubscribe()}},error:Jn,complete:jn});this.subscribe(mr)})}_subscribe(zt){var un;return null===(un=this.source)||void 0===un?void 0:un.subscribe(zt)}[St.L](){return this}pipe(...zt){return(0,f.U)(zt)(this)}toPromise(zt){return new(zt=xt(zt))((un,jn)=>{let Jn;this.subscribe(mr=>Jn=mr,mr=>jn(mr),()=>un(Jn))})}}return dt.create=Bt=>new dt(Bt),dt})();function xt(dt){var Bt;return null!==(Bt=dt??ze.config.Promise)&&void 0!==Bt?Bt:Promise}},8645:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{x:()=>Vt});var O=_e(5592),bt=_e(7394);const f=(0,_e(2306).d)(xt=>function(){xt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ze=_e(9039),ke=_e(1441);let Vt=(()=>{class xt extends O.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(it){const dt=new $t(this,this);return dt.operator=it,dt}_throwIfClosed(){if(this.closed)throw new f}next(it){(0,ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const dt of this.currentObservers)dt.next(it)}})}error(it){(0,ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=it;const{observers:dt}=this;for(;dt.length;)dt.shift().error(it)}})}complete(){(0,ke.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:it}=this;for(;it.length;)it.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var it;return(null===(it=this.observers)||void 0===it?void 0:it.length)>0}_trySubscribe(it){return this._throwIfClosed(),super._trySubscribe(it)}_subscribe(it){return this._throwIfClosed(),this._checkFinalizedStatuses(it),this._innerSubscribe(it)}_innerSubscribe(it){const{hasError:dt,isStopped:Bt,observers:zt}=this;return dt||Bt?bt.Lc:(this.currentObservers=null,zt.push(it),new bt.w0(()=>{this.currentObservers=null,(0,ze.P)(zt,it)}))}_checkFinalizedStatuses(it){const{hasError:dt,thrownError:Bt,isStopped:zt}=this;dt?it.error(Bt):zt&&it.complete()}asObservable(){const it=new O.y;return it.source=this,it}}return xt.create=(ft,it)=>new $t(ft,it),xt})();class $t extends Vt{constructor(ft,it){super(),this.destination=ft,this.source=it}next(ft){var it,dt;null===(dt=null===(it=this.destination)||void 0===it?void 0:it.next)||void 0===dt||dt.call(it,ft)}error(ft){var it,dt;null===(dt=null===(it=this.destination)||void 0===it?void 0:it.error)||void 0===dt||dt.call(it,ft)}complete(){var ft,it;null===(it=null===(ft=this.destination)||void 0===ft?void 0:ft.complete)||void 0===it||it.call(ft)}_subscribe(ft){var it,dt;return null!==(dt=null===(it=this.source)||void 0===it?void 0:it.subscribe(ft))&&void 0!==dt?dt:bt.Lc}}},305:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Hp:()=>jn,Lv:()=>dt});var O=_e(4674),bt=_e(7394),St=_e(2653),f=_e(3894),ze=_e(2420);const ke=xt("C",void 0,void 0);function xt(kt,gt,ln){return{kind:kt,value:gt,error:ln}}var ft=_e(7599),it=_e(1441);class dt extends bt.w0{constructor(gt){super(),this.isStopped=!1,gt?(this.destination=gt,(0,bt.Nn)(gt)&&gt.add(this)):this.destination=rr}static create(gt,ln,Wn){return new jn(gt,ln,Wn)}next(gt){this.isStopped?Xt(function $t(kt){return xt("N",kt,void 0)}(gt),this):this._next(gt)}error(gt){this.isStopped?Xt(function Vt(kt){return xt("E",void 0,kt)}(gt),this):(this.isStopped=!0,this._error(gt))}complete(){this.isStopped?Xt(ke,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(gt){this.destination.next(gt)}_error(gt){try{this.destination.error(gt)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Bt=Function.prototype.bind;function zt(kt,gt){return Bt.call(kt,gt)}class un{constructor(gt){this.partialObserver=gt}next(gt){const{partialObserver:ln}=this;if(ln.next)try{ln.next(gt)}catch(Wn){Jn(Wn)}}error(gt){const{partialObserver:ln}=this;if(ln.error)try{ln.error(gt)}catch(Wn){Jn(Wn)}else Jn(gt)}complete(){const{partialObserver:gt}=this;if(gt.complete)try{gt.complete()}catch(ln){Jn(ln)}}}class jn extends dt{constructor(gt,ln,Wn){let Yt;if(super(),(0,O.m)(gt)||!gt)Yt={next:gt??void 0,error:ln??void 0,complete:Wn??void 0};else{let Kt;this&&St.config.useDeprecatedNextContext?(Kt=Object.create(gt),Kt.unsubscribe=()=>this.unsubscribe(),Yt={next:gt.next&&zt(gt.next,Kt),error:gt.error&&zt(gt.error,Kt),complete:gt.complete&&zt(gt.complete,Kt)}):Yt=gt}this.destination=new un(Yt)}}function Jn(kt){St.config.useDeprecatedSynchronousErrorHandling?(0,it.O)(kt):(0,f.h)(kt)}function Xt(kt,gt){const{onStoppedNotification:ln}=St.config;ln&&ft.z.setTimeout(()=>ln(kt,gt))}const rr={closed:!0,next:ze.Z,error:function mr(kt){throw kt},complete:ze.Z}},7394:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Lc:()=>ke,w0:()=>ze,Nn:()=>Vt});var O=_e(4674);const St=(0,_e(2306).d)(xt=>function(it){xt(this),this.message=it?`${it.length} errors occurred during unsubscription:\n${it.map((dt,Bt)=>`${Bt+1}) ${dt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=it});var f=_e(9039);class ze{constructor(ft){this.initialTeardown=ft,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let ft;if(!this.closed){this.closed=!0;const{_parentage:it}=this;if(it)if(this._parentage=null,Array.isArray(it))for(const zt of it)zt.remove(this);else it.remove(this);const{initialTeardown:dt}=this;if((0,O.m)(dt))try{dt()}catch(zt){ft=zt instanceof St?zt.errors:[zt]}const{_finalizers:Bt}=this;if(Bt){this._finalizers=null;for(const zt of Bt)try{$t(zt)}catch(un){ft=ft??[],un instanceof St?ft=[...ft,...un.errors]:ft.push(un)}}if(ft)throw new St(ft)}}add(ft){var it;if(ft&&ft!==this)if(this.closed)$t(ft);else{if(ft instanceof ze){if(ft.closed||ft._hasParent(this))return;ft._addParent(this)}(this._finalizers=null!==(it=this._finalizers)&&void 0!==it?it:[]).push(ft)}}_hasParent(ft){const{_parentage:it}=this;return it===ft||Array.isArray(it)&&it.includes(ft)}_addParent(ft){const{_parentage:it}=this;this._parentage=Array.isArray(it)?(it.push(ft),it):it?[it,ft]:ft}_removeParent(ft){const{_parentage:it}=this;it===ft?this._parentage=null:Array.isArray(it)&&(0,f.P)(it,ft)}remove(ft){const{_finalizers:it}=this;it&&(0,f.P)(it,ft),ft instanceof ze&&ft._removeParent(this)}}ze.EMPTY=(()=>{const xt=new ze;return xt.closed=!0,xt})();const ke=ze.EMPTY;function Vt(xt){return xt instanceof ze||xt&&"closed"in xt&&(0,O.m)(xt.remove)&&(0,O.m)(xt.add)&&(0,O.m)(xt.unsubscribe)}function $t(xt){(0,O.m)(xt)?xt():xt.unsubscribe()}},2653:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{config:()=>O});const O={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},6232:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{E:()=>bt});const bt=new(_e(5592).y)(ze=>ze.complete())},7715:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{D:()=>Wn});var O=_e(4829),bt=_e(7103),St=_e(9360),f=_e(8251);function ze(Yt,Kt=0){return(0,St.e)((dn,kn)=>{dn.subscribe((0,f.x)(kn,di=>(0,bt.f)(kn,Yt,()=>kn.next(di),Kt),()=>(0,bt.f)(kn,Yt,()=>kn.complete(),Kt),di=>(0,bt.f)(kn,Yt,()=>kn.error(di),Kt)))})}function ke(Yt,Kt=0){return(0,St.e)((dn,kn)=>{kn.add(Yt.schedule(()=>dn.subscribe(kn),Kt))})}var xt=_e(5592),it=_e(4971),dt=_e(4674);function zt(Yt,Kt){if(!Yt)throw new Error("Iterable cannot be null");return new xt.y(dn=>{(0,bt.f)(dn,Kt,()=>{const kn=Yt[Symbol.asyncIterator]();(0,bt.f)(dn,Kt,()=>{kn.next().then(di=>{di.done?dn.complete():dn.next(di.value)})},0,!0)})})}var un=_e(8382),jn=_e(4026),Jn=_e(4266),mr=_e(3664),Xt=_e(5726),rr=_e(9853),kt=_e(541);function Wn(Yt,Kt){return Kt?function ln(Yt,Kt){if(null!=Yt){if((0,un.c)(Yt))return function Vt(Yt,Kt){return(0,O.Xf)(Yt).pipe(ke(Kt),ze(Kt))}(Yt,Kt);if((0,Jn.z)(Yt))return function ft(Yt,Kt){return new xt.y(dn=>{let kn=0;return Kt.schedule(function(){kn===Yt.length?dn.complete():(dn.next(Yt[kn++]),dn.closed||this.schedule())})})}(Yt,Kt);if((0,jn.t)(Yt))return function $t(Yt,Kt){return(0,O.Xf)(Yt).pipe(ke(Kt),ze(Kt))}(Yt,Kt);if((0,Xt.D)(Yt))return zt(Yt,Kt);if((0,mr.T)(Yt))return function Bt(Yt,Kt){return new xt.y(dn=>{let kn;return(0,bt.f)(dn,Kt,()=>{kn=Yt[it.h](),(0,bt.f)(dn,Kt,()=>{let di,xo;try{({value:di,done:xo}=kn.next())}catch(xr){return void dn.error(xr)}xo?dn.complete():dn.next(di)},0,!0)}),()=>(0,dt.m)(kn?.return)&&kn.return()})}(Yt,Kt);if((0,kt.L)(Yt))return function gt(Yt,Kt){return zt((0,kt.Q)(Yt),Kt)}(Yt,Kt)}throw(0,rr.z)(Yt)}(Yt,Kt):(0,O.Xf)(Yt)}},4829:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Xf:()=>Bt});var O=_e(7582),bt=_e(4266),St=_e(4026),f=_e(5592),ze=_e(8382),ke=_e(5726),Vt=_e(9853),$t=_e(3664),xt=_e(541),ft=_e(4674),it=_e(3894),dt=_e(4850);function Bt(kt){if(kt instanceof f.y)return kt;if(null!=kt){if((0,ze.c)(kt))return function zt(kt){return new f.y(gt=>{const ln=kt[dt.L]();if((0,ft.m)(ln.subscribe))return ln.subscribe(gt);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(kt);if((0,bt.z)(kt))return function un(kt){return new f.y(gt=>{for(let ln=0;ln<kt.length&&!gt.closed;ln++)gt.next(kt[ln]);gt.complete()})}(kt);if((0,St.t)(kt))return function jn(kt){return new f.y(gt=>{kt.then(ln=>{gt.closed||(gt.next(ln),gt.complete())},ln=>gt.error(ln)).then(null,it.h)})}(kt);if((0,ke.D)(kt))return mr(kt);if((0,$t.T)(kt))return function Jn(kt){return new f.y(gt=>{for(const ln of kt)if(gt.next(ln),gt.closed)return;gt.complete()})}(kt);if((0,xt.L)(kt))return function Xt(kt){return mr((0,xt.Q)(kt))}(kt)}throw(0,Vt.z)(kt)}function mr(kt){return new f.y(gt=>{(function rr(kt,gt){var ln,Wn,Yt,Kt;return(0,O.mG)(this,void 0,void 0,function*(){try{for(ln=(0,O.KL)(kt);!(Wn=yield ln.next()).done;)if(gt.next(Wn.value),gt.closed)return}catch(dn){Yt={error:dn}}finally{try{Wn&&!Wn.done&&(Kt=ln.return)&&(yield Kt.call(ln))}finally{if(Yt)throw Yt.error}}gt.complete()})})(kt,gt).catch(ln=>gt.error(ln))})}},2096:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{of:()=>St});var O=_e(4564),bt=_e(7715);function St(...f){const ze=(0,O.yG)(f);return(0,bt.D)(f,ze)}},8251:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{x:()=>bt});var O=_e(305);function bt(f,ze,ke,Vt,$t){return new St(f,ze,ke,Vt,$t)}class St extends O.Lv{constructor(ze,ke,Vt,$t,xt,ft){super(ze),this.onFinalize=xt,this.shouldUnsubscribe=ft,this._next=ke?function(it){try{ke(it)}catch(dt){ze.error(dt)}}:super._next,this._error=$t?function(it){try{$t(it)}catch(dt){ze.error(dt)}finally{this.unsubscribe()}}:super._error,this._complete=Vt?function(){try{Vt()}catch(it){ze.error(it)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ze;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:ke}=this;super.unsubscribe(),!ke&&(null===(ze=this.onFinalize)||void 0===ze||ze.call(this))}}}},6306:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{K:()=>f});var O=_e(4829),bt=_e(8251),St=_e(9360);function f(ze){return(0,St.e)((ke,Vt)=>{let ft,$t=null,xt=!1;$t=ke.subscribe((0,bt.x)(Vt,void 0,void 0,it=>{ft=(0,O.Xf)(ze(it,f(ze)(ke))),$t?($t.unsubscribe(),$t=null,ft.subscribe(Vt)):xt=!0})),xt&&($t.unsubscribe(),$t=null,ft.subscribe(Vt))})}},6328:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{b:()=>St});var O=_e(1631),bt=_e(4674);function St(f,ze){return(0,bt.m)(ze)?(0,O.z)(f,ze,1):(0,O.z)(f,1)}},2181:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{h:()=>St});var O=_e(9360),bt=_e(8251);function St(f,ze){return(0,O.e)((ke,Vt)=>{let $t=0;ke.subscribe((0,bt.x)(Vt,xt=>f.call(ze,xt,$t++)&&Vt.next(xt)))})}},4716:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{x:()=>bt});var O=_e(9360);function bt(St){return(0,O.e)((f,ze)=>{try{f.subscribe(ze)}finally{ze.add(St)}})}},7398:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{U:()=>St});var O=_e(9360),bt=_e(8251);function St(f,ze){return(0,O.e)((ke,Vt)=>{let $t=0;ke.subscribe((0,bt.x)(Vt,xt=>{Vt.next(f.call(ze,xt,$t++))}))})}},7537:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{J:()=>St});var O=_e(1631),bt=_e(2737);function St(f=1/0){return(0,O.z)(bt.y,f)}},1631:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{z:()=>$t});var O=_e(7398),bt=_e(4829),St=_e(9360),f=_e(7103),ze=_e(8251),Vt=_e(4674);function $t(xt,ft,it=1/0){return(0,Vt.m)(ft)?$t((dt,Bt)=>(0,O.U)((zt,un)=>ft(dt,zt,Bt,un))((0,bt.Xf)(xt(dt,Bt))),it):("number"==typeof ft&&(it=ft),(0,St.e)((dt,Bt)=>function ke(xt,ft,it,dt,Bt,zt,un,jn){const Jn=[];let mr=0,Xt=0,rr=!1;const kt=()=>{rr&&!Jn.length&&!mr&&ft.complete()},gt=Wn=>mr<dt?ln(Wn):Jn.push(Wn),ln=Wn=>{zt&&ft.next(Wn),mr++;let Yt=!1;(0,bt.Xf)(it(Wn,Xt++)).subscribe((0,ze.x)(ft,Kt=>{Bt?.(Kt),zt?gt(Kt):ft.next(Kt)},()=>{Yt=!0},void 0,()=>{if(Yt)try{for(mr--;Jn.length&&mr<dt;){const Kt=Jn.shift();un?(0,f.f)(ft,un,()=>ln(Kt)):ln(Kt)}kt()}catch(Kt){ft.error(Kt)}}))};return xt.subscribe((0,ze.x)(ft,gt,()=>{rr=!0,kt()})),()=>{jn?.()}}(dt,Bt,xt,it)))}},4664:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{w:()=>f});var O=_e(4829),bt=_e(9360),St=_e(8251);function f(ze,ke){return(0,bt.e)((Vt,$t)=>{let xt=null,ft=0,it=!1;const dt=()=>it&&!xt&&$t.complete();Vt.subscribe((0,St.x)($t,Bt=>{xt?.unsubscribe();let zt=0;const un=ft++;(0,O.Xf)(ze(Bt,un)).subscribe(xt=(0,St.x)($t,jn=>$t.next(ke?ke(Bt,jn,un,zt++):jn),()=>{xt=null,dt()}))},()=>{it=!0,dt()}))})}},9397:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{b:()=>ze});var O=_e(4674),bt=_e(9360),St=_e(8251),f=_e(2737);function ze(ke,Vt,$t){const xt=(0,O.m)(ke)||Vt||$t?{next:ke,error:Vt,complete:$t}:ke;return xt?(0,bt.e)((ft,it)=>{var dt;null===(dt=xt.subscribe)||void 0===dt||dt.call(xt);let Bt=!0;ft.subscribe((0,St.x)(it,zt=>{var un;null===(un=xt.next)||void 0===un||un.call(xt,zt),it.next(zt)},()=>{var zt;Bt=!1,null===(zt=xt.complete)||void 0===zt||zt.call(xt),it.complete()},zt=>{var un;Bt=!1,null===(un=xt.error)||void 0===un||un.call(xt,zt),it.error(zt)},()=>{var zt,un;Bt&&(null===(zt=xt.unsubscribe)||void 0===zt||zt.call(xt)),null===(un=xt.finalize)||void 0===un||un.call(xt)}))}):f.y}},7599:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{z:()=>O});const O={setTimeout(bt,St,...f){const{delegate:ze}=O;return ze?.setTimeout?ze.setTimeout(bt,St,...f):setTimeout(bt,St,...f)},clearTimeout(bt){const{delegate:St}=O;return(St?.clearTimeout||clearTimeout)(bt)},delegate:void 0}},4971:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{h:()=>bt});const bt=function O(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},4850:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{L:()=>O});const O="function"==typeof Symbol&&Symbol.observable||"@@observable"},4564:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{_6:()=>ke,jO:()=>f,yG:()=>ze});var O=_e(4674);function St(Vt){return Vt[Vt.length-1]}function f(Vt){return(0,O.m)(St(Vt))?Vt.pop():void 0}function ze(Vt){return function bt(Vt){return Vt&&(0,O.m)(Vt.schedule)}(St(Vt))?Vt.pop():void 0}function ke(Vt,$t){return"number"==typeof St(Vt)?Vt.pop():$t}},7453:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{D:()=>ze});const{isArray:O}=Array,{getPrototypeOf:bt,prototype:St,keys:f}=Object;function ze(Vt){if(1===Vt.length){const $t=Vt[0];if(O($t))return{args:$t,keys:null};if(function ke(Vt){return Vt&&"object"==typeof Vt&&bt(Vt)===St}($t)){const xt=f($t);return{args:xt.map(ft=>$t[ft]),keys:xt}}}return{args:Vt,keys:null}}},9039:(yr,Qt,_e)=>{"use strict";function O(bt,St){if(bt){const f=bt.indexOf(St);0<=f&&bt.splice(f,1)}}_e.d(Qt,{P:()=>O})},2306:(yr,Qt,_e)=>{"use strict";function O(bt){const f=bt(ze=>{Error.call(ze),ze.stack=(new Error).stack});return f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f}_e.d(Qt,{d:()=>O})},2714:(yr,Qt,_e)=>{"use strict";function O(bt,St){return bt.reduce((f,ze,ke)=>(f[ze]=St[ke],f),{})}_e.d(Qt,{n:()=>O})},1441:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{O:()=>f,x:()=>St});var O=_e(2653);let bt=null;function St(ze){if(O.config.useDeprecatedSynchronousErrorHandling){const ke=!bt;if(ke&&(bt={errorThrown:!1,error:null}),ze(),ke){const{errorThrown:Vt,error:$t}=bt;if(bt=null,Vt)throw $t}}else ze()}function f(ze){O.config.useDeprecatedSynchronousErrorHandling&&bt&&(bt.errorThrown=!0,bt.error=ze)}},7103:(yr,Qt,_e)=>{"use strict";function O(bt,St,f,ze=0,ke=!1){const Vt=St.schedule(function(){f(),ke?bt.add(this.schedule(null,ze)):this.unsubscribe()},ze);if(bt.add(Vt),!ke)return Vt}_e.d(Qt,{f:()=>O})},2737:(yr,Qt,_e)=>{"use strict";function O(bt){return bt}_e.d(Qt,{y:()=>O})},4266:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{z:()=>O});const O=bt=>bt&&"number"==typeof bt.length&&"function"!=typeof bt},5726:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{D:()=>bt});var O=_e(4674);function bt(St){return Symbol.asyncIterator&&(0,O.m)(St?.[Symbol.asyncIterator])}},4674:(yr,Qt,_e)=>{"use strict";function O(bt){return"function"==typeof bt}_e.d(Qt,{m:()=>O})},8382:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{c:()=>St});var O=_e(4850),bt=_e(4674);function St(f){return(0,bt.m)(f[O.L])}},3664:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{T:()=>St});var O=_e(4971),bt=_e(4674);function St(f){return(0,bt.m)(f?.[O.h])}},4026:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{t:()=>bt});var O=_e(4674);function bt(St){return(0,O.m)(St?.then)}},541:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{L:()=>f,Q:()=>St});var O=_e(7582),bt=_e(4674);function St(ze){return(0,O.FC)(this,arguments,function*(){const Vt=ze.getReader();try{for(;;){const{value:$t,done:xt}=yield(0,O.qq)(Vt.read());if(xt)return yield(0,O.qq)(void 0);yield yield(0,O.qq)($t)}}finally{Vt.releaseLock()}})}function f(ze){return(0,bt.m)(ze?.getReader)}},9360:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{A:()=>bt,e:()=>St});var O=_e(4674);function bt(f){return(0,O.m)(f?.lift)}function St(f){return ze=>{if(bt(ze))return ze.lift(function(ke){try{return f(ke,this)}catch(Vt){this.error(Vt)}});throw new TypeError("Unable to lift unknown Observable type")}}},7400:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Z:()=>f});var O=_e(7398);const{isArray:bt}=Array;function f(ze){return(0,O.U)(ke=>function St(ze,ke){return bt(ke)?ze(...ke):ze(ke)}(ze,ke))}},2420:(yr,Qt,_e)=>{"use strict";function O(){}_e.d(Qt,{Z:()=>O})},8407:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{U:()=>St,z:()=>bt});var O=_e(2737);function bt(...f){return St(f)}function St(f){return 0===f.length?O.y:1===f.length?f[0]:function(ke){return f.reduce((Vt,$t)=>$t(Vt),ke)}}},3894:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{h:()=>St});var O=_e(2653),bt=_e(7599);function St(f){bt.z.setTimeout(()=>{const{onUnhandledError:ze}=O.config;if(!ze)throw f;ze(f)})}},9853:(yr,Qt,_e)=>{"use strict";function O(bt){return new TypeError(`You provided ${null!==bt&&"object"==typeof bt?"an invalid object":`'${bt}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}_e.d(Qt,{z:()=>O})},6814:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Do:()=>jn,EM:()=>Aa,HT:()=>f,JF:()=>Or,K0:()=>ke,Mx:()=>Vi,O5:()=>Go,PC:()=>as,PM:()=>ni,S$:()=>Bt,V_:()=>$t,Ye:()=>Jn,b0:()=>un,bD:()=>Ba,ez:()=>Fo,p6:()=>Mo,q:()=>St,rS:()=>cl,sg:()=>Gs,uU:()=>dl,w_:()=>ze});var O=_e(4946);let bt=null;function St(){return bt}function f(j){bt||(bt=j)}class ze{}const ke=new O.OlP("DocumentToken");let Vt=(()=>{class j{historyGo(te){throw new Error("Not implemented")}static#e=this.\u0275fac=function(fe){return new(fe||j)};static#t=this.\u0275prov=O.Yz7({token:j,factory:function(){return(0,O.f3M)(xt)},providedIn:"platform"})}return j})();const $t=new O.OlP("Location Initialized");let xt=(()=>{class j extends Vt{constructor(){super(),this._doc=(0,O.f3M)(ke),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return St().getBaseHref(this._doc)}onPopState(te){const fe=St().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("popstate",te,!1),()=>fe.removeEventListener("popstate",te)}onHashChange(te){const fe=St().getGlobalEventTarget(this._doc,"window");return fe.addEventListener("hashchange",te,!1),()=>fe.removeEventListener("hashchange",te)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(te){this._location.pathname=te}pushState(te,fe,He){this._history.pushState(te,fe,He)}replaceState(te,fe,He){this._history.replaceState(te,fe,He)}forward(){this._history.forward()}back(){this._history.back()}historyGo(te=0){this._history.go(te)}getState(){return this._history.state}static#e=this.\u0275fac=function(fe){return new(fe||j)};static#t=this.\u0275prov=O.Yz7({token:j,factory:function(){return new j},providedIn:"platform"})}return j})();function ft(j,me){if(0==j.length)return me;if(0==me.length)return j;let te=0;return j.endsWith("/")&&te++,me.startsWith("/")&&te++,2==te?j+me.substring(1):1==te?j+me:j+"/"+me}function it(j){const me=j.match(/#|\?|$/),te=me&&me.index||j.length;return j.slice(0,te-("/"===j[te-1]?1:0))+j.slice(te)}function dt(j){return j&&"?"!==j[0]?"?"+j:j}let Bt=(()=>{class j{historyGo(te){throw new Error("Not implemented")}static#e=this.\u0275fac=function(fe){return new(fe||j)};static#t=this.\u0275prov=O.Yz7({token:j,factory:function(){return(0,O.f3M)(un)},providedIn:"root"})}return j})();const zt=new O.OlP("appBaseHref");let un=(()=>{class j extends Bt{constructor(te,fe){super(),this._platformLocation=te,this._removeListenerFns=[],this._baseHref=fe??this._platformLocation.getBaseHrefFromDOM()??(0,O.f3M)(ke).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(te){this._removeListenerFns.push(this._platformLocation.onPopState(te),this._platformLocation.onHashChange(te))}getBaseHref(){return this._baseHref}prepareExternalUrl(te){return ft(this._baseHref,te)}path(te=!1){const fe=this._platformLocation.pathname+dt(this._platformLocation.search),He=this._platformLocation.hash;return He&&te?`${fe}${He}`:fe}pushState(te,fe,He,Gt){const Ut=this.prepareExternalUrl(He+dt(Gt));this._platformLocation.pushState(te,fe,Ut)}replaceState(te,fe,He,Gt){const Ut=this.prepareExternalUrl(He+dt(Gt));this._platformLocation.replaceState(te,fe,Ut)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(te=0){this._platformLocation.historyGo?.(te)}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.LFG(Vt),O.LFG(zt,8))};static#t=this.\u0275prov=O.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"})}return j})(),jn=(()=>{class j extends Bt{constructor(te,fe){super(),this._platformLocation=te,this._baseHref="",this._removeListenerFns=[],null!=fe&&(this._baseHref=fe)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(te){this._removeListenerFns.push(this._platformLocation.onPopState(te),this._platformLocation.onHashChange(te))}getBaseHref(){return this._baseHref}path(te=!1){let fe=this._platformLocation.hash;return null==fe&&(fe="#"),fe.length>0?fe.substring(1):fe}prepareExternalUrl(te){const fe=ft(this._baseHref,te);return fe.length>0?"#"+fe:fe}pushState(te,fe,He,Gt){let Ut=this.prepareExternalUrl(He+dt(Gt));0==Ut.length&&(Ut=this._platformLocation.pathname),this._platformLocation.pushState(te,fe,Ut)}replaceState(te,fe,He,Gt){let Ut=this.prepareExternalUrl(He+dt(Gt));0==Ut.length&&(Ut=this._platformLocation.pathname),this._platformLocation.replaceState(te,fe,Ut)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(te=0){this._platformLocation.historyGo?.(te)}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.LFG(Vt),O.LFG(zt,8))};static#t=this.\u0275prov=O.Yz7({token:j,factory:j.\u0275fac})}return j})(),Jn=(()=>{class j{constructor(te){this._subject=new O.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=te;const fe=this._locationStrategy.getBaseHref();this._basePath=function kt(j){if(new RegExp("^(https?:)?//").test(j)){const[,te]=j.split(/\/\/[^\/]+/);return te}return j}(it(rr(fe))),this._locationStrategy.onPopState(He=>{this._subject.emit({url:this.path(!0),pop:!0,state:He.state,type:He.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(te=!1){return this.normalize(this._locationStrategy.path(te))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(te,fe=""){return this.path()==this.normalize(te+dt(fe))}normalize(te){return j.stripTrailingSlash(function Xt(j,me){if(!j||!me.startsWith(j))return me;const te=me.substring(j.length);return""===te||["/",";","?","#"].includes(te[0])?te:me}(this._basePath,rr(te)))}prepareExternalUrl(te){return te&&"/"!==te[0]&&(te="/"+te),this._locationStrategy.prepareExternalUrl(te)}go(te,fe="",He=null){this._locationStrategy.pushState(He,"",te,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(te+dt(fe)),He)}replaceState(te,fe="",He=null){this._locationStrategy.replaceState(He,"",te,fe),this._notifyUrlChangeListeners(this.prepareExternalUrl(te+dt(fe)),He)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(te=0){this._locationStrategy.historyGo?.(te)}onUrlChange(te){return this._urlChangeListeners.push(te),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(fe=>{this._notifyUrlChangeListeners(fe.url,fe.state)})),()=>{const fe=this._urlChangeListeners.indexOf(te);this._urlChangeListeners.splice(fe,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(te="",fe){this._urlChangeListeners.forEach(He=>He(te,fe))}subscribe(te,fe,He){return this._subject.subscribe({next:te,error:fe,complete:He})}static#e=this.normalizeQueryParams=dt;static#t=this.joinWithSlash=ft;static#n=this.stripTrailingSlash=it;static#r=this.\u0275fac=function(fe){return new(fe||j)(O.LFG(Bt))};static#i=this.\u0275prov=O.Yz7({token:j,factory:function(){return function mr(){return new Jn((0,O.LFG)(Bt))}()},providedIn:"root"})}return j})();function rr(j){return j.replace(/\/index.html$/,"")}var Yt=function(j){return j[j.Format=0]="Format",j[j.Standalone=1]="Standalone",j}(Yt||{}),Kt=function(j){return j[j.Narrow=0]="Narrow",j[j.Abbreviated=1]="Abbreviated",j[j.Wide=2]="Wide",j[j.Short=3]="Short",j}(Kt||{}),dn=function(j){return j[j.Short=0]="Short",j[j.Medium=1]="Medium",j[j.Long=2]="Long",j[j.Full=3]="Full",j}(dn||{}),kn=function(j){return j[j.Decimal=0]="Decimal",j[j.Group=1]="Group",j[j.List=2]="List",j[j.PercentSign=3]="PercentSign",j[j.PlusSign=4]="PlusSign",j[j.MinusSign=5]="MinusSign",j[j.Exponential=6]="Exponential",j[j.SuperscriptingExponent=7]="SuperscriptingExponent",j[j.PerMille=8]="PerMille",j[j.Infinity=9]="Infinity",j[j.NaN=10]="NaN",j[j.TimeSeparator=11]="TimeSeparator",j[j.CurrencyDecimal=12]="CurrencyDecimal",j[j.CurrencyGroup=13]="CurrencyGroup",j}(kn||{});function Nt(j,me){return qr((0,O.cg1)(j)[O.wAp.DateFormat],me)}function Zt(j,me){return qr((0,O.cg1)(j)[O.wAp.TimeFormat],me)}function mt(j,me){return qr((0,O.cg1)(j)[O.wAp.DateTimeFormat],me)}function rn(j,me){const te=(0,O.cg1)(j),fe=te[O.wAp.NumberSymbols][me];if(typeof fe>"u"){if(me===kn.CurrencyDecimal)return te[O.wAp.NumberSymbols][kn.Decimal];if(me===kn.CurrencyGroup)return te[O.wAp.NumberSymbols][kn.Group]}return fe}function Oi(j){if(!j[O.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${j[O.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function qr(j,me){for(let te=me;te>-1;te--)if(typeof j[te]<"u")return j[te];throw new Error("Locale data API: locale data undefined")}function Ci(j){const[me,te]=j.split(":");return{hours:+me,minutes:+te}}const wr=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Pr={},xi=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var _r=function(j){return j[j.Short=0]="Short",j[j.ShortGMT=1]="ShortGMT",j[j.Long=2]="Long",j[j.Extended=3]="Extended",j}(_r||{}),Rr=function(j){return j[j.FullYear=0]="FullYear",j[j.Month=1]="Month",j[j.Date=2]="Date",j[j.Hours=3]="Hours",j[j.Minutes=4]="Minutes",j[j.Seconds=5]="Seconds",j[j.FractionalSeconds=6]="FractionalSeconds",j[j.Day=7]="Day",j}(Rr||{}),ur=function(j){return j[j.DayPeriods=0]="DayPeriods",j[j.Days=1]="Days",j[j.Months=2]="Months",j[j.Eras=3]="Eras",j}(ur||{});function Mo(j,me,te,fe){let He=function Ze(j){if(De(j))return j;if("number"==typeof j&&!isNaN(j))return new Date(j);if("string"==typeof j){if(j=j.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(j)){const[He,Gt=1,Ut=1]=j.split("-").map(pr=>+pr);return Ho(He,Gt-1,Ut)}const te=parseFloat(j);if(!isNaN(j-te))return new Date(te);let fe;if(fe=j.match(wr))return function lt(j){const me=new Date(0);let te=0,fe=0;const He=j[8]?me.setUTCFullYear:me.setFullYear,Gt=j[8]?me.setUTCHours:me.setHours;j[9]&&(te=Number(j[9]+j[10]),fe=Number(j[9]+j[11])),He.call(me,Number(j[1]),Number(j[2])-1,Number(j[3]));const Ut=Number(j[4]||0)-te,pr=Number(j[5]||0)-fe,io=Number(j[6]||0),Hi=Math.floor(1e3*parseFloat("0."+(j[7]||0)));return Gt.call(me,Ut,pr,io,Hi),me}(fe)}const me=new Date(j);if(!De(me))throw new Error(`Unable to convert "${j}" into a date`);return me}(j);me=qt(te,me)||me;let pr,Ut=[];for(;me;){if(pr=xi.exec(me),!pr){Ut.push(me);break}{Ut=Ut.concat(pr.slice(1));const wi=Ut.pop();if(!wi)break;me=wi}}let io=He.getTimezoneOffset();fe&&(io=Dt(fe,io),He=function Mn(j,me,te){const fe=te?-1:1,He=j.getTimezoneOffset();return function pn(j,me){return(j=new Date(j.getTime())).setMinutes(j.getMinutes()+me),j}(j,fe*(Dt(me,He)-He))}(He,fe,!0));let Hi="";return Ut.forEach(wi=>{const Yr=function Ye(j){if(st[j])return st[j];let me;switch(j){case"G":case"GG":case"GGG":me=nr(ur.Eras,Kt.Abbreviated);break;case"GGGG":me=nr(ur.Eras,Kt.Wide);break;case"GGGGG":me=nr(ur.Eras,Kt.Narrow);break;case"y":me=Jr(Rr.FullYear,1,0,!1,!0);break;case"yy":me=Jr(Rr.FullYear,2,0,!0,!0);break;case"yyy":me=Jr(Rr.FullYear,3,0,!1,!0);break;case"yyyy":me=Jr(Rr.FullYear,4,0,!1,!0);break;case"Y":me=wt(1);break;case"YY":me=wt(2,!0);break;case"YYY":me=wt(3);break;case"YYYY":me=wt(4);break;case"M":case"L":me=Jr(Rr.Month,1,1);break;case"MM":case"LL":me=Jr(Rr.Month,2,1);break;case"MMM":me=nr(ur.Months,Kt.Abbreviated);break;case"MMMM":me=nr(ur.Months,Kt.Wide);break;case"MMMMM":me=nr(ur.Months,Kt.Narrow);break;case"LLL":me=nr(ur.Months,Kt.Abbreviated,Yt.Standalone);break;case"LLLL":me=nr(ur.Months,Kt.Wide,Yt.Standalone);break;case"LLLLL":me=nr(ur.Months,Kt.Narrow,Yt.Standalone);break;case"w":me=rt(1);break;case"ww":me=rt(2);break;case"W":me=rt(1,!0);break;case"d":me=Jr(Rr.Date,1);break;case"dd":me=Jr(Rr.Date,2);break;case"c":case"cc":me=Jr(Rr.Day,1);break;case"ccc":me=nr(ur.Days,Kt.Abbreviated,Yt.Standalone);break;case"cccc":me=nr(ur.Days,Kt.Wide,Yt.Standalone);break;case"ccccc":me=nr(ur.Days,Kt.Narrow,Yt.Standalone);break;case"cccccc":me=nr(ur.Days,Kt.Short,Yt.Standalone);break;case"E":case"EE":case"EEE":me=nr(ur.Days,Kt.Abbreviated);break;case"EEEE":me=nr(ur.Days,Kt.Wide);break;case"EEEEE":me=nr(ur.Days,Kt.Narrow);break;case"EEEEEE":me=nr(ur.Days,Kt.Short);break;case"a":case"aa":case"aaa":me=nr(ur.DayPeriods,Kt.Abbreviated);break;case"aaaa":me=nr(ur.DayPeriods,Kt.Wide);break;case"aaaaa":me=nr(ur.DayPeriods,Kt.Narrow);break;case"b":case"bb":case"bbb":me=nr(ur.DayPeriods,Kt.Abbreviated,Yt.Standalone,!0);break;case"bbbb":me=nr(ur.DayPeriods,Kt.Wide,Yt.Standalone,!0);break;case"bbbbb":me=nr(ur.DayPeriods,Kt.Narrow,Yt.Standalone,!0);break;case"B":case"BB":case"BBB":me=nr(ur.DayPeriods,Kt.Abbreviated,Yt.Format,!0);break;case"BBBB":me=nr(ur.DayPeriods,Kt.Wide,Yt.Format,!0);break;case"BBBBB":me=nr(ur.DayPeriods,Kt.Narrow,Yt.Format,!0);break;case"h":me=Jr(Rr.Hours,1,-12);break;case"hh":me=Jr(Rr.Hours,2,-12);break;case"H":me=Jr(Rr.Hours,1);break;case"HH":me=Jr(Rr.Hours,2);break;case"m":me=Jr(Rr.Minutes,1);break;case"mm":me=Jr(Rr.Minutes,2);break;case"s":me=Jr(Rr.Seconds,1);break;case"ss":me=Jr(Rr.Seconds,2);break;case"S":me=Jr(Rr.FractionalSeconds,1);break;case"SS":me=Jr(Rr.FractionalSeconds,2);break;case"SSS":me=Jr(Rr.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":me=Ue(_r.Short);break;case"ZZZZZ":me=Ue(_r.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":me=Ue(_r.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":me=Ue(_r.Long);break;default:return null}return st[j]=me,me}(wi);Hi+=Yr?Yr(He,te,io):"''"===wi?"'":wi.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),Hi}function Ho(j,me,te){const fe=new Date(0);return fe.setFullYear(j,me,te),fe.setHours(0,0,0),fe}function qt(j,me){const te=function xo(j){return(0,O.cg1)(j)[O.wAp.LocaleId]}(j);if(Pr[te]=Pr[te]||{},Pr[te][me])return Pr[te][me];let fe="";switch(me){case"shortDate":fe=Nt(j,dn.Short);break;case"mediumDate":fe=Nt(j,dn.Medium);break;case"longDate":fe=Nt(j,dn.Long);break;case"fullDate":fe=Nt(j,dn.Full);break;case"shortTime":fe=Zt(j,dn.Short);break;case"mediumTime":fe=Zt(j,dn.Medium);break;case"longTime":fe=Zt(j,dn.Long);break;case"fullTime":fe=Zt(j,dn.Full);break;case"short":const He=qt(j,"shortTime"),Gt=qt(j,"shortDate");fe=Xi(mt(j,dn.Short),[He,Gt]);break;case"medium":const Ut=qt(j,"mediumTime"),pr=qt(j,"mediumDate");fe=Xi(mt(j,dn.Medium),[Ut,pr]);break;case"long":const io=qt(j,"longTime"),Hi=qt(j,"longDate");fe=Xi(mt(j,dn.Long),[io,Hi]);break;case"full":const wi=qt(j,"fullTime"),Yr=qt(j,"fullDate");fe=Xi(mt(j,dn.Full),[wi,Yr])}return fe&&(Pr[te][me]=fe),fe}function Xi(j,me){return me&&(j=j.replace(/\{([^}]+)}/g,function(te,fe){return null!=me&&fe in me?me[fe]:te})),j}function si(j,me,te="-",fe,He){let Gt="";(j<0||He&&j<=0)&&(He?j=1-j:(j=-j,Gt=te));let Ut=String(j);for(;Ut.length<me;)Ut="0"+Ut;return fe&&(Ut=Ut.slice(Ut.length-me)),Gt+Ut}function Jr(j,me,te=0,fe=!1,He=!1){return function(Gt,Ut){let pr=function wo(j,me){switch(j){case Rr.FullYear:return me.getFullYear();case Rr.Month:return me.getMonth();case Rr.Date:return me.getDate();case Rr.Hours:return me.getHours();case Rr.Minutes:return me.getMinutes();case Rr.Seconds:return me.getSeconds();case Rr.FractionalSeconds:return me.getMilliseconds();case Rr.Day:return me.getDay();default:throw new Error(`Unknown DateType value "${j}".`)}}(j,Gt);if((te>0||pr>-te)&&(pr+=te),j===Rr.Hours)0===pr&&-12===te&&(pr=12);else if(j===Rr.FractionalSeconds)return function po(j,me){return si(j,3).substring(0,me)}(pr,me);const io=rn(Ut,kn.MinusSign);return si(pr,me,io,fe,He)}}function nr(j,me,te=Yt.Format,fe=!1){return function(He,Gt){return function Bs(j,me,te,fe,He,Gt){switch(te){case ur.Months:return function Zr(j,me,te){const fe=(0,O.cg1)(j),Gt=qr([fe[O.wAp.MonthsFormat],fe[O.wAp.MonthsStandalone]],me);return qr(Gt,te)}(me,He,fe)[j.getMonth()];case ur.Days:return function Vn(j,me,te){const fe=(0,O.cg1)(j),Gt=qr([fe[O.wAp.DaysFormat],fe[O.wAp.DaysStandalone]],me);return qr(Gt,te)}(me,He,fe)[j.getDay()];case ur.DayPeriods:const Ut=j.getHours(),pr=j.getMinutes();if(Gt){const Hi=function Gn(j){const me=(0,O.cg1)(j);return Oi(me),(me[O.wAp.ExtraData][2]||[]).map(fe=>"string"==typeof fe?Ci(fe):[Ci(fe[0]),Ci(fe[1])])}(me),wi=function Pi(j,me,te){const fe=(0,O.cg1)(j);Oi(fe);const Gt=qr([fe[O.wAp.ExtraData][0],fe[O.wAp.ExtraData][1]],me)||[];return qr(Gt,te)||[]}(me,He,fe),Yr=Hi.findIndex(Ao=>{if(Array.isArray(Ao)){const[bi,ds]=Ao,tl=Ut>=bi.hours&&pr>=bi.minutes,ma=Ut<ds.hours||Ut===ds.hours&&pr<ds.minutes;if(bi.hours<ds.hours){if(tl&&ma)return!0}else if(tl||ma)return!0}else if(Ao.hours===Ut&&Ao.minutes===pr)return!0;return!1});if(-1!==Yr)return wi[Yr]}return function xr(j,me,te){const fe=(0,O.cg1)(j),Gt=qr([fe[O.wAp.DayPeriodsFormat],fe[O.wAp.DayPeriodsStandalone]],me);return qr(Gt,te)}(me,He,fe)[Ut<12?0:1];case ur.Eras:return function Ln(j,me){return qr((0,O.cg1)(j)[O.wAp.Eras],me)}(me,fe)[j.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${te}`)}}(He,Gt,j,me,te,fe)}}function Ue(j){return function(me,te,fe){const He=-1*fe,Gt=rn(te,kn.MinusSign),Ut=He>0?Math.floor(He/60):Math.ceil(He/60);switch(j){case _r.Short:return(He>=0?"+":"")+si(Ut,2,Gt)+si(Math.abs(He%60),2,Gt);case _r.ShortGMT:return"GMT"+(He>=0?"+":"")+si(Ut,1,Gt);case _r.Long:return"GMT"+(He>=0?"+":"")+si(Ut,2,Gt)+":"+si(Math.abs(He%60),2,Gt);case _r.Extended:return 0===fe?"Z":(He>=0?"+":"")+si(Ut,2,Gt)+":"+si(Math.abs(He%60),2,Gt);default:throw new Error(`Unknown zone width "${j}"`)}}}const ge=0,ve=4;function Oe(j){return Ho(j.getFullYear(),j.getMonth(),j.getDate()+(ve-j.getDay()))}function rt(j,me=!1){return function(te,fe){let He;if(me){const Gt=new Date(te.getFullYear(),te.getMonth(),1).getDay()-1,Ut=te.getDate();He=1+Math.floor((Ut+Gt)/7)}else{const Gt=Oe(te),Ut=function Re(j){const me=Ho(j,ge,1).getDay();return Ho(j,0,1+(me<=ve?ve:ve+7)-me)}(Gt.getFullYear()),pr=Gt.getTime()-Ut.getTime();He=1+Math.round(pr/6048e5)}return si(He,j,rn(fe,kn.MinusSign))}}function wt(j,me=!1){return function(te,fe){return si(Oe(te).getFullYear(),j,rn(fe,kn.MinusSign),me)}}const st={};function Dt(j,me){j=j.replace(/:/g,"");const te=Date.parse("Jan 01, 1970 00:00:00 "+j)/6e4;return isNaN(te)?me:te}function De(j){return j instanceof Date&&!isNaN(j.valueOf())}function Vi(j,me){me=encodeURIComponent(me);for(const te of j.split(";")){const fe=te.indexOf("="),[He,Gt]=-1==fe?[te,""]:[te.slice(0,fe),te.slice(fe+1)];if(He.trim()===me)return decodeURIComponent(Gt)}return null}class ai{constructor(me,te,fe,He){this.$implicit=me,this.ngForOf=te,this.index=fe,this.count=He}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Gs=(()=>{class j{set ngForOf(te){this._ngForOf=te,this._ngForOfDirty=!0}set ngForTrackBy(te){this._trackByFn=te}get ngForTrackBy(){return this._trackByFn}constructor(te,fe,He){this._viewContainer=te,this._template=fe,this._differs=He,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(te){te&&(this._template=te)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const te=this._ngForOf;!this._differ&&te&&(this._differ=this._differs.find(te).create(this.ngForTrackBy))}if(this._differ){const te=this._differ.diff(this._ngForOf);te&&this._applyChanges(te)}}_applyChanges(te){const fe=this._viewContainer;te.forEachOperation((He,Gt,Ut)=>{if(null==He.previousIndex)fe.createEmbeddedView(this._template,new ai(He.item,this._ngForOf,-1,-1),null===Ut?void 0:Ut);else if(null==Ut)fe.remove(null===Gt?void 0:Gt);else if(null!==Gt){const pr=fe.get(Gt);fe.move(pr,Ut),Zn(pr,He)}});for(let He=0,Gt=fe.length;He<Gt;He++){const pr=fe.get(He).context;pr.index=He,pr.count=Gt,pr.ngForOf=this._ngForOf}te.forEachIdentityChange(He=>{Zn(fe.get(He.currentIndex),He)})}static ngTemplateContextGuard(te,fe){return!0}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.Y36(O.s_b),O.Y36(O.Rgc),O.Y36(O.ZZ4))};static#t=this.\u0275dir=O.lG2({type:j,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return j})();function Zn(j,me){j.context.$implicit=me.item}let Go=(()=>{class j{constructor(te,fe){this._viewContainer=te,this._context=new Qs,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=fe}set ngIf(te){this._context.$implicit=this._context.ngIf=te,this._updateView()}set ngIfThen(te){Fn("ngIfThen",te),this._thenTemplateRef=te,this._thenViewRef=null,this._updateView()}set ngIfElse(te){Fn("ngIfElse",te),this._elseTemplateRef=te,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(te,fe){return!0}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.Y36(O.s_b),O.Y36(O.Rgc))};static#t=this.\u0275dir=O.lG2({type:j,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return j})();class Qs{constructor(){this.$implicit=null,this.ngIf=null}}function Fn(j,me){if(me&&!me.createEmbeddedView)throw new Error(`${j} must be a TemplateRef, but received '${(0,O.AaK)(me)}'.`)}let as=(()=>{class j{constructor(te,fe,He){this._ngEl=te,this._differs=fe,this._renderer=He,this._ngStyle=null,this._differ=null}set ngStyle(te){this._ngStyle=te,!this._differ&&te&&(this._differ=this._differs.find(te).create())}ngDoCheck(){if(this._differ){const te=this._differ.diff(this._ngStyle);te&&this._applyChanges(te)}}_setStyle(te,fe){const[He,Gt]=te.split("."),Ut=-1===He.indexOf("-")?void 0:O.JOm.DashCase;null!=fe?this._renderer.setStyle(this._ngEl.nativeElement,He,Gt?`${fe}${Gt}`:fe,Ut):this._renderer.removeStyle(this._ngEl.nativeElement,He,Ut)}_applyChanges(te){te.forEachRemovedItem(fe=>this._setStyle(fe.key,null)),te.forEachAddedItem(fe=>this._setStyle(fe.key,fe.currentValue)),te.forEachChangedItem(fe=>this._setStyle(fe.key,fe.currentValue))}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.Y36(O.SBq),O.Y36(O.aQg),O.Y36(O.Qsj))};static#t=this.\u0275dir=O.lG2({type:j,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0})}return j})();function gs(j,me){return new O.vHH(2100,!1)}const ea=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g;let cl=(()=>{class j{transform(te){if(null==te)return null;if("string"!=typeof te)throw gs();return te.replace(ea,fe=>fe[0].toUpperCase()+fe.slice(1).toLowerCase())}static#e=this.\u0275fac=function(fe){return new(fe||j)};static#t=this.\u0275pipe=O.Yjl({name:"titlecase",type:j,pure:!0,standalone:!0})}return j})();const Eo=new O.OlP("DATE_PIPE_DEFAULT_TIMEZONE"),Vl=new O.OlP("DATE_PIPE_DEFAULT_OPTIONS");let dl=(()=>{class j{constructor(te,fe,He){this.locale=te,this.defaultTimezone=fe,this.defaultOptions=He}transform(te,fe,He,Gt){if(null==te||""===te||te!=te)return null;try{return Mo(te,fe??this.defaultOptions?.dateFormat??"mediumDate",Gt||this.locale,He??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(Ut){throw gs()}}static#e=this.\u0275fac=function(fe){return new(fe||j)(O.Y36(O.soG,16),O.Y36(Eo,24),O.Y36(Vl,24))};static#t=this.\u0275pipe=O.Yjl({name:"date",type:j,pure:!0,standalone:!0})}return j})(),Fo=(()=>{class j{static#e=this.\u0275fac=function(fe){return new(fe||j)};static#t=this.\u0275mod=O.oAB({type:j});static#n=this.\u0275inj=O.cJS({})}return j})();const Ba="browser",Ca="server";function ni(j){return j===Ca}let Aa=(()=>{class j{static#e=this.\u0275prov=(0,O.Yz7)({token:j,providedIn:"root",factory:()=>new Fr((0,O.LFG)(ke),window)})}return j})();class Fr{constructor(me,te){this.document=me,this.window=te,this.offset=()=>[0,0]}setOffset(me){this.offset=Array.isArray(me)?()=>me:me}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(me){this.supportsScrolling()&&this.window.scrollTo(me[0],me[1])}scrollToAnchor(me){if(!this.supportsScrolling())return;const te=function Ws(j,me){const te=j.getElementById(me)||j.getElementsByName(me)[0];if(te)return te;if("function"==typeof j.createTreeWalker&&j.body&&"function"==typeof j.body.attachShadow){const fe=j.createTreeWalker(j.body,NodeFilter.SHOW_ELEMENT);let He=fe.currentNode;for(;He;){const Gt=He.shadowRoot;if(Gt){const Ut=Gt.getElementById(me)||Gt.querySelector(`[name="${me}"]`);if(Ut)return Ut}He=fe.nextNode()}}return null}(this.document,me);te&&(this.scrollToElement(te),te.focus())}setHistoryScrollRestoration(me){this.supportsScrolling()&&(this.window.history.scrollRestoration=me)}scrollToElement(me){const te=me.getBoundingClientRect(),fe=te.left+this.window.pageXOffset,He=te.top+this.window.pageYOffset,Gt=this.offset();this.window.scrollTo(fe-Gt[0],He-Gt[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class Or{}},9862:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{JF:()=>Ke,WM:()=>Bt,eN:()=>At});var O=_e(4946),bt=_e(2096),St=_e(7715),f=_e(5592),ze=_e(6328),ke=_e(2181),Vt=_e(7398),$t=_e(4716),xt=_e(4664),ft=_e(6814);class it{}class dt{}class Bt{constructor(Je){this.normalizedNames=new Map,this.lazyUpdate=null,Je?"string"==typeof Je?this.lazyInit=()=>{this.headers=new Map,Je.split("\n").forEach(ct=>{const an=ct.indexOf(":");if(an>0){const en=ct.slice(0,an),In=en.toLowerCase(),zn=ct.slice(an+1).trim();this.maybeSetNormalizedName(en,In),this.headers.has(In)?this.headers.get(In).push(zn):this.headers.set(In,[zn])}})}:typeof Headers<"u"&&Je instanceof Headers?(this.headers=new Map,Je.forEach((ct,an)=>{this.setHeaderEntries(an,ct)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(Je).forEach(([ct,an])=>{this.setHeaderEntries(ct,an)})}:this.headers=new Map}has(Je){return this.init(),this.headers.has(Je.toLowerCase())}get(Je){this.init();const ct=this.headers.get(Je.toLowerCase());return ct&&ct.length>0?ct[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Je){return this.init(),this.headers.get(Je.toLowerCase())||null}append(Je,ct){return this.clone({name:Je,value:ct,op:"a"})}set(Je,ct){return this.clone({name:Je,value:ct,op:"s"})}delete(Je,ct){return this.clone({name:Je,value:ct,op:"d"})}maybeSetNormalizedName(Je,ct){this.normalizedNames.has(ct)||this.normalizedNames.set(ct,Je)}init(){this.lazyInit&&(this.lazyInit instanceof Bt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Je=>this.applyUpdate(Je)),this.lazyUpdate=null))}copyFrom(Je){Je.init(),Array.from(Je.headers.keys()).forEach(ct=>{this.headers.set(ct,Je.headers.get(ct)),this.normalizedNames.set(ct,Je.normalizedNames.get(ct))})}clone(Je){const ct=new Bt;return ct.lazyInit=this.lazyInit&&this.lazyInit instanceof Bt?this.lazyInit:this,ct.lazyUpdate=(this.lazyUpdate||[]).concat([Je]),ct}applyUpdate(Je){const ct=Je.name.toLowerCase();switch(Je.op){case"a":case"s":let an=Je.value;if("string"==typeof an&&(an=[an]),0===an.length)return;this.maybeSetNormalizedName(Je.name,ct);const en=("a"===Je.op?this.headers.get(ct):void 0)||[];en.push(...an),this.headers.set(ct,en);break;case"d":const In=Je.value;if(In){let zn=this.headers.get(ct);if(!zn)return;zn=zn.filter(br=>-1===In.indexOf(br)),0===zn.length?(this.headers.delete(ct),this.normalizedNames.delete(ct)):this.headers.set(ct,zn)}else this.headers.delete(ct),this.normalizedNames.delete(ct)}}setHeaderEntries(Je,ct){const an=(Array.isArray(ct)?ct:[ct]).map(In=>In.toString()),en=Je.toLowerCase();this.headers.set(en,an),this.maybeSetNormalizedName(Je,en)}forEach(Je){this.init(),Array.from(this.normalizedNames.keys()).forEach(ct=>Je(this.normalizedNames.get(ct),this.headers.get(ct)))}}class un{encodeKey(Je){return Xt(Je)}encodeValue(Je){return Xt(Je)}decodeKey(Je){return decodeURIComponent(Je)}decodeValue(Je){return decodeURIComponent(Je)}}const Jn=/%(\d[a-f0-9])/gi,mr={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Xt(_t){return encodeURIComponent(_t).replace(Jn,(Je,ct)=>mr[ct]??Je)}function rr(_t){return`${_t}`}class kt{constructor(Je={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Je.encoder||new un,Je.fromString){if(Je.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function jn(_t,Je){const ct=new Map;return _t.length>0&&_t.replace(/^\?/,"").split("&").forEach(en=>{const In=en.indexOf("="),[zn,br]=-1==In?[Je.decodeKey(en),""]:[Je.decodeKey(en.slice(0,In)),Je.decodeValue(en.slice(In+1))],Sr=ct.get(zn)||[];Sr.push(br),ct.set(zn,Sr)}),ct}(Je.fromString,this.encoder)}else Je.fromObject?(this.map=new Map,Object.keys(Je.fromObject).forEach(ct=>{const an=Je.fromObject[ct],en=Array.isArray(an)?an.map(rr):[rr(an)];this.map.set(ct,en)})):this.map=null}has(Je){return this.init(),this.map.has(Je)}get(Je){this.init();const ct=this.map.get(Je);return ct?ct[0]:null}getAll(Je){return this.init(),this.map.get(Je)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Je,ct){return this.clone({param:Je,value:ct,op:"a"})}appendAll(Je){const ct=[];return Object.keys(Je).forEach(an=>{const en=Je[an];Array.isArray(en)?en.forEach(In=>{ct.push({param:an,value:In,op:"a"})}):ct.push({param:an,value:en,op:"a"})}),this.clone(ct)}set(Je,ct){return this.clone({param:Je,value:ct,op:"s"})}delete(Je,ct){return this.clone({param:Je,value:ct,op:"d"})}toString(){return this.init(),this.keys().map(Je=>{const ct=this.encoder.encodeKey(Je);return this.map.get(Je).map(an=>ct+"="+this.encoder.encodeValue(an)).join("&")}).filter(Je=>""!==Je).join("&")}clone(Je){const ct=new kt({encoder:this.encoder});return ct.cloneFrom=this.cloneFrom||this,ct.updates=(this.updates||[]).concat(Je),ct}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Je=>this.map.set(Je,this.cloneFrom.map.get(Je))),this.updates.forEach(Je=>{switch(Je.op){case"a":case"s":const ct=("a"===Je.op?this.map.get(Je.param):void 0)||[];ct.push(rr(Je.value)),this.map.set(Je.param,ct);break;case"d":if(void 0===Je.value){this.map.delete(Je.param);break}{let an=this.map.get(Je.param)||[];const en=an.indexOf(rr(Je.value));-1!==en&&an.splice(en,1),an.length>0?this.map.set(Je.param,an):this.map.delete(Je.param)}}}),this.cloneFrom=this.updates=null)}}class ln{constructor(){this.map=new Map}set(Je,ct){return this.map.set(Je,ct),this}get(Je){return this.map.has(Je)||this.map.set(Je,Je.defaultValue()),this.map.get(Je)}delete(Je){return this.map.delete(Je),this}has(Je){return this.map.has(Je)}keys(){return this.map.keys()}}function Yt(_t){return typeof ArrayBuffer<"u"&&_t instanceof ArrayBuffer}function Kt(_t){return typeof Blob<"u"&&_t instanceof Blob}function dn(_t){return typeof FormData<"u"&&_t instanceof FormData}class di{constructor(Je,ct,an,en){let In;if(this.url=ct,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Je.toUpperCase(),function Wn(_t){switch(_t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||en?(this.body=void 0!==an?an:null,In=en):In=an,In&&(this.reportProgress=!!In.reportProgress,this.withCredentials=!!In.withCredentials,In.responseType&&(this.responseType=In.responseType),In.headers&&(this.headers=In.headers),In.context&&(this.context=In.context),In.params&&(this.params=In.params)),this.headers||(this.headers=new Bt),this.context||(this.context=new ln),this.params){const zn=this.params.toString();if(0===zn.length)this.urlWithParams=ct;else{const br=ct.indexOf("?");this.urlWithParams=ct+(-1===br?"?":br<ct.length-1?"&":"")+zn}}else this.params=new kt,this.urlWithParams=ct}serializeBody(){return null===this.body?null:Yt(this.body)||Kt(this.body)||dn(this.body)||function kn(_t){return typeof URLSearchParams<"u"&&_t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof kt?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||dn(this.body)?null:Kt(this.body)?this.body.type||null:Yt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof kt?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Je={}){const ct=Je.method||this.method,an=Je.url||this.url,en=Je.responseType||this.responseType,In=void 0!==Je.body?Je.body:this.body,zn=void 0!==Je.withCredentials?Je.withCredentials:this.withCredentials,br=void 0!==Je.reportProgress?Je.reportProgress:this.reportProgress;let Sr=Je.headers||this.headers,Ui=Je.params||this.params;const Fi=Je.context??this.context;return void 0!==Je.setHeaders&&(Sr=Object.keys(Je.setHeaders).reduce((_o,Jo)=>_o.set(Jo,Je.setHeaders[Jo]),Sr)),Je.setParams&&(Ui=Object.keys(Je.setParams).reduce((_o,Jo)=>_o.set(Jo,Je.setParams[Jo]),Ui)),new di(ct,an,In,{params:Ui,headers:Sr,context:Fi,reportProgress:br,responseType:en,withCredentials:zn})}}var xo=function(_t){return _t[_t.Sent=0]="Sent",_t[_t.UploadProgress=1]="UploadProgress",_t[_t.ResponseHeader=2]="ResponseHeader",_t[_t.DownloadProgress=3]="DownloadProgress",_t[_t.Response=4]="Response",_t[_t.User=5]="User",_t}(xo||{});class xr{constructor(Je,ct=200,an="OK"){this.headers=Je.headers||new Bt,this.status=void 0!==Je.status?Je.status:ct,this.statusText=Je.statusText||an,this.url=Je.url||null,this.ok=this.status>=200&&this.status<300}}class Vn extends xr{constructor(Je={}){super(Je),this.type=xo.ResponseHeader}clone(Je={}){return new Vn({headers:Je.headers||this.headers,status:void 0!==Je.status?Je.status:this.status,statusText:Je.statusText||this.statusText,url:Je.url||this.url||void 0})}}class Zr extends xr{constructor(Je={}){super(Je),this.type=xo.Response,this.body=void 0!==Je.body?Je.body:null}clone(Je={}){return new Zr({body:void 0!==Je.body?Je.body:this.body,headers:Je.headers||this.headers,status:void 0!==Je.status?Je.status:this.status,statusText:Je.statusText||this.statusText,url:Je.url||this.url||void 0})}}class Ln extends xr{constructor(Je){super(Je,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Je.url||"(unknown url)"}`:`Http failure response for ${Je.url||"(unknown url)"}: ${Je.status} ${Je.statusText}`,this.error=Je.error||null}}function Ir(_t,Je){return{body:Je,headers:_t.headers,context:_t.context,observe:_t.observe,params:_t.params,reportProgress:_t.reportProgress,responseType:_t.responseType,withCredentials:_t.withCredentials}}let At=(()=>{class _t{constructor(ct){this.handler=ct}request(ct,an,en={}){let In;if(ct instanceof di)In=ct;else{let Sr,Ui;Sr=en.headers instanceof Bt?en.headers:new Bt(en.headers),en.params&&(Ui=en.params instanceof kt?en.params:new kt({fromObject:en.params})),In=new di(ct,an,void 0!==en.body?en.body:null,{headers:Sr,context:en.context,params:Ui,reportProgress:en.reportProgress,responseType:en.responseType||"json",withCredentials:en.withCredentials})}const zn=(0,bt.of)(In).pipe((0,ze.b)(Sr=>this.handler.handle(Sr)));if(ct instanceof di||"events"===en.observe)return zn;const br=zn.pipe((0,ke.h)(Sr=>Sr instanceof Zr));switch(en.observe||"body"){case"body":switch(In.responseType){case"arraybuffer":return br.pipe((0,Vt.U)(Sr=>{if(null!==Sr.body&&!(Sr.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Sr.body}));case"blob":return br.pipe((0,Vt.U)(Sr=>{if(null!==Sr.body&&!(Sr.body instanceof Blob))throw new Error("Response is not a Blob.");return Sr.body}));case"text":return br.pipe((0,Vt.U)(Sr=>{if(null!==Sr.body&&"string"!=typeof Sr.body)throw new Error("Response is not a string.");return Sr.body}));default:return br.pipe((0,Vt.U)(Sr=>Sr.body))}case"response":return br;default:throw new Error(`Unreachable: unhandled observe type ${en.observe}}`)}}delete(ct,an={}){return this.request("DELETE",ct,an)}get(ct,an={}){return this.request("GET",ct,an)}head(ct,an={}){return this.request("HEAD",ct,an)}jsonp(ct,an){return this.request("JSONP",ct,{params:(new kt).append(an,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(ct,an={}){return this.request("OPTIONS",ct,an)}patch(ct,an,en={}){return this.request("PATCH",ct,Ir(en,an))}post(ct,an,en={}){return this.request("POST",ct,Ir(en,an))}put(ct,an,en={}){return this.request("PUT",ct,Ir(en,an))}static#e=this.\u0275fac=function(an){return new(an||_t)(O.LFG(it))};static#t=this.\u0275prov=O.Yz7({token:_t,factory:_t.\u0275fac})}return _t})();function tr(_t,Je){return Je(_t)}function ir(_t,Je){return(ct,an)=>Je.intercept(ct,{handle:en=>_t(en,an)})}const Oi=new O.OlP(""),Gn=new O.OlP(""),Pi=new O.OlP("");function vi(){let _t=null;return(Je,ct)=>{null===_t&&(_t=((0,O.f3M)(Oi,{optional:!0})??[]).reduceRight(ir,tr));const an=(0,O.f3M)(O.HDt),en=an.add();return _t(Je,ct).pipe((0,$t.x)(()=>an.remove(en)))}}let qr=(()=>{class _t extends it{constructor(ct,an){super(),this.backend=ct,this.injector=an,this.chain=null,this.pendingTasks=(0,O.f3M)(O.HDt)}handle(ct){if(null===this.chain){const en=Array.from(new Set([...this.injector.get(Gn),...this.injector.get(Pi,[])]));this.chain=en.reduceRight((In,zn)=>function nn(_t,Je,ct){return(an,en)=>ct.runInContext(()=>Je(an,In=>_t(In,en)))}(In,zn,this.injector),tr)}const an=this.pendingTasks.add();return this.chain(ct,en=>this.backend.handle(en)).pipe((0,$t.x)(()=>this.pendingTasks.remove(an)))}static#e=this.\u0275fac=function(an){return new(an||_t)(O.LFG(dt),O.LFG(O.lqb))};static#t=this.\u0275prov=O.Yz7({token:_t,factory:_t.\u0275fac})}return _t})();const Ho=/^\)\]\}',?\n/;let Xi=(()=>{class _t{constructor(ct){this.xhrFactory=ct}handle(ct){if("JSONP"===ct.method)throw new O.vHH(-2800,!1);const an=this.xhrFactory;return(an.\u0275loadImpl?(0,St.D)(an.\u0275loadImpl()):(0,bt.of)(null)).pipe((0,xt.w)(()=>new f.y(In=>{const zn=an.build();if(zn.open(ct.method,ct.urlWithParams),ct.withCredentials&&(zn.withCredentials=!0),ct.headers.forEach((yi,Et)=>zn.setRequestHeader(yi,Et.join(","))),ct.headers.has("Accept")||zn.setRequestHeader("Accept","application/json, text/plain, */*"),!ct.headers.has("Content-Type")){const yi=ct.detectContentTypeHeader();null!==yi&&zn.setRequestHeader("Content-Type",yi)}if(ct.responseType){const yi=ct.responseType.toLowerCase();zn.responseType="json"!==yi?yi:"text"}const br=ct.serializeBody();let Sr=null;const Ui=()=>{if(null!==Sr)return Sr;const yi=zn.statusText||"OK",Et=new Bt(zn.getAllResponseHeaders()),vr=function qt(_t){return"responseURL"in _t&&_t.responseURL?_t.responseURL:/^X-Request-URL:/m.test(_t.getAllResponseHeaders())?_t.getResponseHeader("X-Request-URL"):null}(zn)||ct.url;return Sr=new Vn({headers:Et,status:zn.status,statusText:yi,url:vr}),Sr},Fi=()=>{let{headers:yi,status:Et,statusText:vr,url:Cr}=Ui(),ai=null;204!==Et&&(ai=typeof zn.response>"u"?zn.responseText:zn.response),0===Et&&(Et=ai?200:0);let Gs=Et>=200&&Et<300;if("json"===ct.responseType&&"string"==typeof ai){const Zn=ai;ai=ai.replace(Ho,"");try{ai=""!==ai?JSON.parse(ai):null}catch(ka){ai=Zn,Gs&&(Gs=!1,ai={error:ka,text:ai})}}Gs?(In.next(new Zr({body:ai,headers:yi,status:Et,statusText:vr,url:Cr||void 0})),In.complete()):In.error(new Ln({error:ai,headers:yi,status:Et,statusText:vr,url:Cr||void 0}))},_o=yi=>{const{url:Et}=Ui(),vr=new Ln({error:yi,status:zn.status||0,statusText:zn.statusText||"Unknown Error",url:Et||void 0});In.error(vr)};let Jo=!1;const Vi=yi=>{Jo||(In.next(Ui()),Jo=!0);let Et={type:xo.DownloadProgress,loaded:yi.loaded};yi.lengthComputable&&(Et.total=yi.total),"text"===ct.responseType&&zn.responseText&&(Et.partialText=zn.responseText),In.next(Et)},ro=yi=>{let Et={type:xo.UploadProgress,loaded:yi.loaded};yi.lengthComputable&&(Et.total=yi.total),In.next(Et)};return zn.addEventListener("load",Fi),zn.addEventListener("error",_o),zn.addEventListener("timeout",_o),zn.addEventListener("abort",_o),ct.reportProgress&&(zn.addEventListener("progress",Vi),null!==br&&zn.upload&&zn.upload.addEventListener("progress",ro)),zn.send(br),In.next({type:xo.Sent}),()=>{zn.removeEventListener("error",_o),zn.removeEventListener("abort",_o),zn.removeEventListener("load",Fi),zn.removeEventListener("timeout",_o),ct.reportProgress&&(zn.removeEventListener("progress",Vi),null!==br&&zn.upload&&zn.upload.removeEventListener("progress",ro)),zn.readyState!==zn.DONE&&zn.abort()}})))}static#e=this.\u0275fac=function(an){return new(an||_t)(O.LFG(ft.JF))};static#t=this.\u0275prov=O.Yz7({token:_t,factory:_t.\u0275fac})}return _t})();const si=new O.OlP("XSRF_ENABLED"),Jr=new O.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),nr=new O.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Bs{}let Ue=(()=>{class _t{constructor(ct,an,en){this.doc=ct,this.platform=an,this.cookieName=en,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const ct=this.doc.cookie||"";return ct!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,ft.Mx)(ct,this.cookieName),this.lastCookieString=ct),this.lastToken}static#e=this.\u0275fac=function(an){return new(an||_t)(O.LFG(ft.K0),O.LFG(O.Lbi),O.LFG(Jr))};static#t=this.\u0275prov=O.Yz7({token:_t,factory:_t.\u0275fac})}return _t})();function ge(_t,Je){const ct=_t.url.toLowerCase();if(!(0,O.f3M)(si)||"GET"===_t.method||"HEAD"===_t.method||ct.startsWith("http://")||ct.startsWith("https://"))return Je(_t);const an=(0,O.f3M)(Bs).getToken(),en=(0,O.f3M)(nr);return null!=an&&!_t.headers.has(en)&&(_t=_t.clone({headers:_t.headers.set(en,an)})),Je(_t)}var Re=function(_t){return _t[_t.Interceptors=0]="Interceptors",_t[_t.LegacyInterceptors=1]="LegacyInterceptors",_t[_t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",_t[_t.NoXsrfProtection=3]="NoXsrfProtection",_t[_t.JsonpSupport=4]="JsonpSupport",_t[_t.RequestsMadeViaParent=5]="RequestsMadeViaParent",_t[_t.Fetch=6]="Fetch",_t}(Re||{});function rt(..._t){const Je=[At,Xi,qr,{provide:it,useExisting:qr},{provide:dt,useExisting:Xi},{provide:Gn,useValue:ge,multi:!0},{provide:si,useValue:!0},{provide:Bs,useClass:Ue}];for(const ct of _t)Je.push(...ct.\u0275providers);return(0,O.MR2)(Je)}const st=new O.OlP("LEGACY_INTERCEPTOR_FN");function Ye(){return function Oe(_t,Je){return{\u0275kind:_t,\u0275providers:Je}}(Re.LegacyInterceptors,[{provide:st,useFactory:vi},{provide:Gn,useExisting:st,multi:!0}])}let Ke=(()=>{class _t{static#e=this.\u0275fac=function(an){return new(an||_t)};static#t=this.\u0275mod=O.oAB({type:_t});static#n=this.\u0275inj=O.cJS({providers:[rt(Ye())]})}return _t})()},4946:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{tb:()=>Mv,AFp:()=>Hg,ip1:()=>Ex,hGG:()=>kC,z2F:()=>gg,Ojb:()=>Ym,sBO:()=>xC,Sil:()=>jE,EJc:()=>zE,Xts:()=>td,SBq:()=>rf,lqb:()=>Su,qLn:()=>Rd,vpe:()=>Pl,XFs:()=>nr,OlP:()=>Si,zs3:()=>su,ZZ4:()=>kv,aQg:()=>Fv,soG:()=>r_,YKP:()=>E1,h0i:()=>op,PXZ:()=>hC,R0b:()=>Wa,FiY:()=>Zd,Lbi:()=>Ro,g9A:()=>Gg,Qsj:()=>E_,FYo:()=>r0,JOm:()=>wu,tp0:()=>yu,Rgc:()=>Rm,dDg:()=>lC,eoX:()=>Ox,GfV:()=>sf,s_b:()=>t_,ifc:()=>Et,VuI:()=>ZC,MMx:()=>A1,Lck:()=>D2,eFA:()=>Nx,Gpc:()=>Kt,f3M:()=>br,$WT:()=>es,MR2:()=>Sp,_c5:()=>NC,qFp:()=>XC,rg0:()=>tl,c2e:()=>Cx,zSh:()=>zg,HDt:()=>Ax,wAp:()=>dg,vHH:()=>Vn,lri:()=>Ix,rWj:()=>Mx,cg1:()=>rv,kL8:()=>qy,dqk:()=>Oe,Z0I:()=>Mo,eJc:()=>xv,QGY:()=>$_,F4k:()=>ty,RDi:()=>Ep,AaK:()=>ln,qOj:()=>Ar,Xq5:()=>No,TTD:()=>rl,_Bn:()=>b1,jDz:()=>D1,xp6:()=>C0,uIk:()=>yc,ekj:()=>J_,Suo:()=>nx,Xpm:()=>Vl,lG2:()=>$s,Yz7:()=>xi,cJS:()=>Rr,oAB:()=>qa,Yjl:()=>Ea,Y36:()=>hf,_UZ:()=>j_,qZA:()=>$0,TgZ:()=>G0,EpF:()=>ey,n5z:()=>Ic,LFG:()=>In,$8M:()=>Oc,$Z:()=>cm,NdJ:()=>W_,CRH:()=>rx,kcU:()=>he,O4$:()=>Se,oxw:()=>sy,ALo:()=>z1,lcZ:()=>U1,xi3:()=>V1,Dn7:()=>j1,Q6J:()=>U_,VKq:()=>R1,iGM:()=>ex,KtG:()=>Tl,CHM:()=>ja,LSH:()=>Dp,P3R:()=>$m,Udp:()=>K_,YNc:()=>qv,_uU:()=>Iy,Oqu:()=>ev,hij:()=>q0,AsE:()=>tv,lnq:()=>nv,Gf:()=>tx});var O=_e(8645),bt=_e(7394),St=_e(5592),f=_e(7537),ze=_e(4829),ke=_e(6232),Vt=_e(4564),$t=_e(7715),ft=_e(5619),it=_e(2096),dt=_e(305),Bt=_e(9360);function zt(r={}){const{connector:c=(()=>new O.x),resetOnError:d=!0,resetOnComplete:v=!0,resetOnRefCountZero:b=!0}=r;return S=>{let L,z,Z,ce=0,xe=!1,je=!1;const ht=()=>{z?.unsubscribe(),z=void 0},Mt=()=>{ht(),L=Z=void 0,xe=je=!1},mn=()=>{const Nn=L;Mt(),Nn?.unsubscribe()};return(0,Bt.e)((Nn,cr)=>{ce++,!je&&!xe&&ht();const Ur=Z=Z??c();cr.add(()=>{ce--,0===ce&&!je&&!xe&&(z=un(mn,b))}),Ur.subscribe(cr),!L&&ce>0&&(L=new dt.Hp({next:Tn=>Ur.next(Tn),error:Tn=>{je=!0,ht(),z=un(Mt,d,Tn),Ur.error(Tn)},complete:()=>{xe=!0,ht(),z=un(Mt,v),Ur.complete()}}),(0,ze.Xf)(Nn).subscribe(L))})(S)}}function un(r,c,...d){if(!0===c)return void r();if(!1===c)return;const v=new dt.Hp({next:()=>{v.unsubscribe(),r()}});return(0,ze.Xf)(c(...d)).subscribe(v)}var jn=_e(4664),Jn=_e(2737),mr=_e(8251);function rr(r,c){return r===c}function kt(r){for(let c in r)if(r[c]===kt)return c;throw Error("Could not find renamed property on target object.")}function gt(r,c){for(const d in c)c.hasOwnProperty(d)&&!r.hasOwnProperty(d)&&(r[d]=c[d])}function ln(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(ln).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const c=r.toString();if(null==c)return""+c;const d=c.indexOf("\n");return-1===d?c:c.substring(0,d)}function Wn(r,c){return null==r||""===r?null===c?"":c:null==c||""===c?r:r+" "+c}const Yt=kt({__forward_ref__:kt});function Kt(r){return r.__forward_ref__=Kt,r.toString=function(){return ln(this())},r}function dn(r){return kn(r)?r():r}function kn(r){return"function"==typeof r&&r.hasOwnProperty(Yt)&&r.__forward_ref__===Kt}function di(r){return r&&!!r.\u0275providers}const xr="https://g.co/ng/security#xss";class Vn extends Error{constructor(c,d){super(function Zr(r,c){return`NG0${Math.abs(r)}${c?": "+c:""}`}(c,d)),this.code=c}}function Ln(r){return"string"==typeof r?r:null==r?"":String(r)}function mt(r,c){throw new Vn(-201,!1)}function Ni(r,c){null==r&&function fr(r,c,d,v){throw new Error(`ASSERTION ERROR: ${r}`+(null==v?"":` [Expected=> ${d} ${v} ${c} <=Actual]`))}(c,r,null,"!=")}function xi(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Rr(r){return{providers:r.providers||[],imports:r.imports||[]}}function ur(r){return Ho(r,si)||Ho(r,Jr)}function Mo(r){return null!==ur(r)}function Ho(r,c){return r.hasOwnProperty(c)?r[c]:null}function Xi(r){return r&&(r.hasOwnProperty(po)||r.hasOwnProperty(wo))?r[po]:null}const si=kt({\u0275prov:kt}),po=kt({\u0275inj:kt}),Jr=kt({ngInjectableDef:kt}),wo=kt({ngInjectorDef:kt});var nr=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(nr||{});let Bs;function ge(r){const c=Bs;return Bs=r,c}function ve(r,c,d){const v=ur(r);return v&&"root"==v.providedIn?void 0===v.value?v.value=v.factory():v.value:d&nr.Optional?null:void 0!==c?c:void mt(ln(r))}const Oe=globalThis,Bn={},Mr="__NG_DI_FLAG__",Lr="ngTempTokenPath",zi=/\n/gm,_t="__source";let Je;function an(r){const c=Je;return Je=r,c}function en(r,c=nr.Default){if(void 0===Je)throw new Vn(-203,!1);return null===Je?ve(r,void 0,c):Je.get(r,c&nr.Optional?null:void 0,c)}function In(r,c=nr.Default){return(function Ue(){return Bs}()||en)(dn(r),c)}function br(r,c=nr.Default){return In(r,Sr(c))}function Sr(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function Ui(r){const c=[];for(let d=0;d<r.length;d++){const v=dn(r[d]);if(Array.isArray(v)){if(0===v.length)throw new Vn(900,!1);let b,S=nr.Default;for(let L=0;L<v.length;L++){const z=v[L],Z=_o(z);"number"==typeof Z?-1===Z?b=z.token:S|=Z:b=z}c.push(In(b,S))}else c.push(In(v))}return c}function Fi(r,c){return r[Mr]=c,r.prototype[Mr]=c,r}function _o(r){return r[Mr]}function ro(r){return{toString:r}.toString()}var yi=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(yi||{}),Et=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Et||{});const vr={},Cr=[],ai=kt({\u0275cmp:kt}),Gs=kt({\u0275dir:kt}),Zn=kt({\u0275pipe:kt}),ka=kt({\u0275mod:kt}),Go=kt({\u0275fac:kt}),Qs=kt({__NG_ELEMENT_ID__:kt}),Fn=kt({__NG_ENV_ID__:kt});function Hr(r,c,d){let v=r.length;for(;;){const b=r.indexOf(c,d);if(-1===b)return b;if(0===b||r.charCodeAt(b-1)<=32){const S=c.length;if(b+S===v||r.charCodeAt(b+S)<=32)return b}d=b+1}}function kr(r,c,d){let v=0;for(;v<d.length;){const b=d[v];if("number"==typeof b){if(0!==b)break;v++;const S=d[v++],L=d[v++],z=d[v++];r.setAttribute(c,L,z,S)}else{const S=b,L=d[++v];ws(S)?r.setProperty(c,S,L):r.setAttribute(c,S,L),v++}}return v}function bo(r){return 3===r||4===r||6===r}function ws(r){return 64===r.charCodeAt(0)}function Vr(r,c){if(null!==c&&0!==c.length)if(null===r||0===r.length)r=c.slice();else{let d=-1;for(let v=0;v<c.length;v++){const b=c[v];"number"==typeof b?d=b:0===d||$o(r,d,b,null,-1===d||2===d?c[++v]:null)}}return r}function $o(r,c,d,v,b){let S=0,L=r.length;if(-1===c)L=-1;else for(;S<r.length;){const z=r[S++];if("number"==typeof z){if(z===c){L=-1;break}if(z>c){L=S-1;break}}}for(;S<r.length;){const z=r[S];if("number"==typeof z)break;if(z===d){if(null===v)return void(null!==b&&(r[S+1]=b));if(v===r[S+1])return void(r[S+2]=b)}S++,null!==v&&S++,null!==b&&S++}-1!==L&&(r.splice(L,0,c),S=L+1),r.splice(S++,0,d),null!==v&&r.splice(S++,0,v),null!==b&&r.splice(S++,0,b)}const fa="ng-template";function as(r,c,d){let v=0,b=!0;for(;v<r.length;){let S=r[v++];if("string"==typeof S&&b){const L=r[v++];if(d&&"class"===S&&-1!==Hr(L.toLowerCase(),c,0))return!0}else{if(1===S){for(;v<r.length&&"string"==typeof(S=r[v++]);)if(S.toLowerCase()===c)return!0;return!1}"number"==typeof S&&(b=!1)}}return!1}function ls(r){return 4===r.type&&r.value!==fa}function Ii(r,c,d){return c===(4!==r.type||d?r.value:fa)}function gs(r,c,d){let v=4;const b=r.attrs||[],S=function Yl(r){for(let c=0;c<r.length;c++)if(bo(r[c]))return c;return r.length}(b);let L=!1;for(let z=0;z<c.length;z++){const Z=c[z];if("number"!=typeof Z){if(!L)if(4&v){if(v=2|1&v,""!==Z&&!Ii(r,Z,d)||""===Z&&1===c.length){if(ji(v))return!1;L=!0}}else{const ce=8&v?Z:c[++z];if(8&v&&null!==r.attrs){if(!as(r.attrs,ce,d)){if(ji(v))return!1;L=!0}continue}const je=ko(8&v?"class":Z,b,ls(r),d);if(-1===je){if(ji(v))return!1;L=!0;continue}if(""!==ce){let ht;ht=je>S?"":b[je+1].toLowerCase();const Mt=8&v?ht:null;if(Mt&&-1!==Hr(Mt,ce,0)||2&v&&ce!==ht){if(ji(v))return!1;L=!0}}}}else{if(!L&&!ji(v)&&!ji(Z))return!1;if(L&&ji(Z))continue;L=!1,v=Z|1&v}}return ji(v)||L}function ji(r){return 0==(1&r)}function ko(r,c,d,v){if(null===c)return-1;let b=0;if(v||!d){let S=!1;for(;b<c.length;){const L=c[b];if(L===r)return b;if(3===L||6===L)S=!0;else{if(1===L||2===L){let z=c[++b];for(;"string"==typeof z;)z=c[++b];continue}if(4===L)break;if(0===L){b+=4;continue}}b+=S?1:2}return-1}return function ba(r,c){let d=r.indexOf(4);if(d>-1)for(d++;d<r.length;){const v=r[d];if("number"==typeof v)return-1;if(v===c)return d;d++}return-1}(c,r)}function Za(r,c,d=!1){for(let v=0;v<c.length;v++)if(gs(r,c[v],d))return!0;return!1}function cl(r,c){return r?":not("+c.trim()+")":c}function ul(r){let c=r[0],d=1,v=2,b="",S=!1;for(;d<r.length;){let L=r[d];if("string"==typeof L)if(2&v){const z=r[++d];b+="["+L+(z.length>0?'="'+z+'"':"")+"]"}else 8&v?b+="."+L:4&v&&(b+=" "+L);else""!==b&&!ji(L)&&(c+=cl(S,b),b=""),v=L,S=S||!ji(v);d++}return""!==b&&(c+=cl(S,b)),c}function Vl(r){return ro(()=>{const c=pa(r),d={...c,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===yi.OnPush,directiveDefs:null,pipeDefs:null,dependencies:c.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Et.Emulated,styles:r.styles||Cr,_:null,schemas:r.schemas||null,tView:null,id:""};Fa(d);const v=r.dependencies;return d.directiveDefs=Fo(v,!1),d.pipeDefs=Fo(v,!0),d.id=function Ca(r){let c=0;const d=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(const b of d)c=Math.imul(31,c)+b.charCodeAt(0)<<0;return c+=2147483648,"c"+c}(d),d})}function bs(r){return zr(r)||ti(r)}function Qo(r){return null!==r}function qa(r){return ro(()=>({type:r.type,bootstrap:r.bootstrap||Cr,declarations:r.declarations||Cr,imports:r.imports||Cr,exports:r.exports||Cr,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function go(r,c){if(null==r)return vr;const d={};for(const v in r)if(r.hasOwnProperty(v)){let b=r[v],S=b;Array.isArray(b)&&(S=b[1],b=b[0]),d[b]=v,c&&(c[b]=S)}return d}function $s(r){return ro(()=>{const c=pa(r);return Fa(c),c})}function Ea(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function zr(r){return r[ai]||null}function ti(r){return r[Gs]||null}function Ri(r){return r[Zn]||null}function es(r){const c=zr(r)||ti(r)||Ri(r);return null!==c&&c.standalone}function Qi(r,c){const d=r[ka]||null;if(!d&&!0===c)throw new Error(`Type ${ln(r)} does not have '\u0275mod' property.`);return d}function pa(r){const c={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:c,inputTransforms:null,inputConfig:r.inputs||vr,exportAs:r.exportAs||null,standalone:!0===r.standalone,signals:!0===r.signals,selectors:r.selectors||Cr,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:go(r.inputs,c),outputs:go(r.outputs)}}function Fa(r){r.features?.forEach(c=>c(r))}function Fo(r,c){if(!r)return null;const d=c?Ri:bs;return()=>("function"==typeof r?r():r).map(v=>d(v)).filter(Qo)}const mi=0,er=1,Dr=2,ni=3,cs=4,ts=5,Co=6,Aa=7,Fr=8,Ws=9,ta=10,Or=11,zs=12,ms=13,Xr=14,lo=15,na=16,Da=17,Es=18,ns=19,Xa=20,_s=21,Us=22,ra=23,ia=24,Wr=25,Ya=1,za=2,oa=7,Ua=9,us=11;function ie(r){return Array.isArray(r)&&"object"==typeof r[Ya]}function K(r){return Array.isArray(r)&&!0===r[Ya]}function le(r){return 0!=(4&r.flags)}function Ie(r){return r.componentOffset>-1}function Ge(r){return 1==(1&r.flags)}function yt(r){return!!r.template}function vn(r){return 0!=(512&r[Dr])}function vo(r,c){return r.hasOwnProperty(Go)?r[Go]:null}let to=null,Ka=!1;function Oo(r){const c=to;return to=r,c}const Ja={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function Qa(r){if(!ga(r)||r.dirty){if(!r.producerMustRecompute(r)&&!xl(r))return void(r.dirty=!1);r.producerRecomputeValue(r),r.dirty=!1}}function el(r){r.dirty=!0,function jl(r){if(void 0===r.liveConsumerNode)return;const c=Ka;Ka=!0;try{for(const d of r.liveConsumerNode)d.dirty||el(d)}finally{Ka=c}}(r),r.consumerMarkedDirty?.(r)}function fl(r){return r&&(r.nextProducerIndex=0),Oo(r)}function yl(r,c){if(Oo(c),r&&void 0!==r.producerNode&&void 0!==r.producerIndexOfThis&&void 0!==r.producerLastReadVersion){if(ga(r))for(let d=r.nextProducerIndex;d<r.producerNode.length;d++)pl(r.producerNode[d],r.producerIndexOfThis[d]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function xl(r){wl(r);for(let c=0;c<r.producerNode.length;c++){const d=r.producerNode[c],v=r.producerLastReadVersion[c];if(v!==d.version||(Qa(d),v!==d.version))return!0}return!1}function sc(r){if(wl(r),ga(r))for(let c=0;c<r.producerNode.length;c++)pl(r.producerNode[c],r.producerIndexOfThis[c]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function pl(r,c){if(function bc(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}(r),wl(r),1===r.liveConsumerNode.length)for(let v=0;v<r.producerNode.length;v++)pl(r.producerNode[v],r.producerIndexOfThis[v]);const d=r.liveConsumerNode.length-1;if(r.liveConsumerNode[c]=r.liveConsumerNode[d],r.liveConsumerIndexOfThis[c]=r.liveConsumerIndexOfThis[d],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,c<r.liveConsumerNode.length){const v=r.liveConsumerIndexOfThis[c],b=r.liveConsumerNode[c];wl(b),b.producerIndexOfThis[v]=c}}function ga(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function wl(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}let fe=null;function tl(r){const c=Oo(null);try{return r()}finally{Oo(c)}}const Sa=()=>{},Os=(()=>({...Ja,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:r=>{r.schedule(r.ref)},hasRun:!1,cleanupFn:Sa}))();class Ia{constructor(c,d,v){this.previousValue=c,this.currentValue=d,this.firstChange=v}isFirstChange(){return this.firstChange}}function rl(){return qc}function qc(r){return r.type.prototype.ngOnChanges&&(r.setInput=Cl),Hn}function Hn(){const r=ac(this),c=r?.current;if(c){const d=r.previous;if(d===vr)r.previous=c;else for(let v in c)d[v]=c[v];r.current=null,this.ngOnChanges(c)}}function Cl(r,c,d,v){const b=this.declaredInputs[d],S=ac(r)||function Yi(r,c){return r[Xc]=c}(r,{previous:vr,current:null}),L=S.current||(S.current={}),z=S.previous,Z=z[b];L[b]=new Ia(Z&&Z.currentValue,c,z===vr),r[v]=c}rl.ngInherit=!0;const Xc="__ngSimpleChanges__";function ac(r){return r[Xc]||null}const il=function(r,c,d){},du="svg";function Do(r){for(;Array.isArray(r);)r=r[mi];return r}function Hl(r,c){return Do(c[r])}function la(r,c){return Do(c[r.index])}function Ds(r,c){return r.data[c]}function Al(r,c){return r[c]}function _a(r,c){const d=c[r];return ie(d)?d:d[mi]}function Va(r,c){return null==c?null:r[c]}function lc(r){r[Da]=0}function dd(r){1024&r[Dr]||(r[Dr]|=1024,gl(r,1))}function cc(r){1024&r[Dr]&&(r[Dr]&=-1025,gl(r,-1))}function gl(r,c){let d=r[ni];if(null===d)return;d[ts]+=c;let v=d;for(d=d[ni];null!==d&&(1===c&&1===v[ts]||-1===c&&0===v[ts]);)d[ts]+=c,v=d,d=d[ni]}const ei={lFrame:N(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Lu(){return ei.bindingsEnabled}function hn(){return ei.lFrame.lView}function no(){return ei.lFrame.tView}function ja(r){return ei.lFrame.contextLView=r,r[Fr]}function Tl(r){return ei.lFrame.contextLView=null,r}function hs(){let r=Ac();for(;null!==r&&64===r.type;)r=r.parent;return r}function Ac(){return ei.lFrame.currentTNode}function ml(r,c){const d=ei.lFrame;d.currentTNode=r,d.isParent=c}function Ma(){return ei.lFrame.isParent}function Ha(){const r=ei.lFrame;let c=r.bindingRootIndex;return-1===c&&(c=r.bindingRootIndex=r.tView.bindingStartIndex),c}function kl(){return ei.lFrame.bindingIndex}function Dc(){return ei.lFrame.bindingIndex++}function Gl(r){const c=ei.lFrame,d=c.bindingIndex;return c.bindingIndex=c.bindingIndex+r,d}function $(r,c){const d=ei.lFrame;d.bindingIndex=d.bindingRootIndex=r,q(c)}function q(r){ei.lFrame.currentDirectiveIndex=r}function _(){return ei.lFrame.currentQueryIndex}function i(r){ei.lFrame.currentQueryIndex=r}function g(r){const c=r[er];return 2===c.type?c.declTNode:1===c.type?r[Co]:null}function y(r,c,d){if(d&nr.SkipSelf){let b=c,S=r;for(;!(b=b.parent,null!==b||d&nr.Host||(b=g(S),null===b||(S=S[Xr],10&b.type))););if(null===b)return!1;c=b,r=S}const v=ei.lFrame=T();return v.currentTNode=c,v.lView=r,!0}function A(r){const c=T(),d=r[er];ei.lFrame=c,c.currentTNode=d.firstChild,c.lView=r,c.tView=d,c.contextLView=r,c.bindingIndex=d.bindingStartIndex,c.inI18n=!1}function T(){const r=ei.lFrame,c=null===r?null:r.child;return null===c?N(r):c}function N(r){const c={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=c),c}function k(){const r=ei.lFrame;return ei.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const H=k;function Q(){const r=k();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ye(){return ei.lFrame.selectedIndex}function Ae(r){ei.lFrame.selectedIndex=r}function we(){const r=ei.lFrame;return Ds(r.tView,r.selectedIndex)}function Se(){ei.lFrame.currentNamespace=du}function he(){!function Te(){ei.lFrame.currentNamespace=null}()}let Ve=!0;function tt(){return Ve}function Qe(r){Ve=r}function vt(r,c){for(let d=c.directiveStart,v=c.directiveEnd;d<v;d++){const S=r.data[d].type.prototype,{ngAfterContentInit:L,ngAfterContentChecked:z,ngAfterViewInit:Z,ngAfterViewChecked:ce,ngOnDestroy:xe}=S;L&&(r.contentHooks??=[]).push(-d,L),z&&((r.contentHooks??=[]).push(d,z),(r.contentCheckHooks??=[]).push(d,z)),Z&&(r.viewHooks??=[]).push(-d,Z),ce&&((r.viewHooks??=[]).push(d,ce),(r.viewCheckHooks??=[]).push(d,ce)),null!=xe&&(r.destroyHooks??=[]).push(d,xe)}}function pt(r,c,d){Ot(r,c,3,d)}function Lt(r,c,d,v){(3&r[Dr])===d&&Ot(r,c,d,v)}function En(r,c){let d=r[Dr];(3&d)===c&&(d&=8191,d+=1,r[Dr]=d)}function Ot(r,c,d,v){const S=v??-1,L=c.length-1;let z=0;for(let Z=void 0!==v?65535&r[Da]:0;Z<L;Z++)if("number"==typeof c[Z+1]){if(z=c[Z],null!=v&&z>=v)break}else c[Z]<0&&(r[Da]+=65536),(z<S||-1==S)&&(jt(r,d,c,Z),r[Da]=(4294901760&r[Da])+Z+2),Z++}function sn(r,c){il(4,r,c);const d=Oo(null);try{c.call(r)}finally{Oo(d),il(5,r,c)}}function jt(r,c,d,v){const b=d[v]<0,S=d[v+1],z=r[b?-d[v]:d[v]];b?r[Dr]>>13<r[Da]>>16&&(3&r[Dr])===c&&(r[Dr]+=8192,sn(z,S)):sn(z,S)}const yn=-1;class It{constructor(c,d,v){this.factory=c,this.resolving=!1,this.canSeeViewProviders=d,this.injectImpl=v}}function _i(r){return r!==yn}function oi(r){return 32767&r}function Gi(r,c){let d=function dr(r){return r>>16}(r),v=c;for(;d>0;)v=v[Xr],d--;return v}let oo=!0;function uo(r){const c=oo;return oo=r,c}const Oa=255,ua=5;let Fl=0;const da={};function ho(r,c){const d=Ps(r,c);if(-1!==d)return d;const v=c[er];v.firstCreatePass&&(r.injectorIndex=c.length,$i(v.data,r),$i(c,null),$i(v.blueprint,null));const b=va(r,c),S=r.injectorIndex;if(_i(b)){const L=oi(b),z=Gi(b,c),Z=z[er].data;for(let ce=0;ce<8;ce++)c[S+ce]=z[L+ce]|Z[L+ce]}return c[S+8]=b,S}function $i(r,c){r.push(0,0,0,0,0,0,0,0,c)}function Ps(r,c){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===c[r.injectorIndex+8]?-1:r.injectorIndex}function va(r,c){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let d=0,v=null,b=c;for(;null!==b;){if(v=Mc(b),null===v)return yn;if(d++,b=b[Xr],-1!==v.injectorIndex)return v.injectorIndex|d<<16}return yn}function Po(r,c,d){!function rs(r,c,d){let v;"string"==typeof d?v=d.charCodeAt(0)||0:d.hasOwnProperty(Qs)&&(v=d[Qs]),null==v&&(v=d[Qs]=Fl++);const b=v&Oa;c.data[r+(b>>ua)]|=1<<b}(r,c,d)}function Nu(r,c,d){if(d&nr.Optional||void 0!==r)return r;mt()}function Tc(r,c,d,v){if(d&nr.Optional&&void 0===v&&(v=null),!(d&(nr.Self|nr.Host))){const b=r[Ws],S=ge(void 0);try{return b?b.get(c,v,d&nr.Optional):ve(c,v,d&nr.Optional)}finally{ge(S)}}return Nu(v,0,d)}function gu(r,c,d,v=nr.Default,b){if(null!==r){if(2048&c[Dr]&&!(v&nr.Self)){const L=function Sh(r,c,d,v,b){let S=r,L=c;for(;null!==S&&null!==L&&2048&L[Dr]&&!(512&L[Dr]);){const z=Ql(S,L,d,v|nr.Self,da);if(z!==da)return z;let Z=S.parent;if(!Z){const ce=L[Xa];if(ce){const xe=ce.get(d,da,v);if(xe!==da)return xe}Z=Mc(L),L=L[Xr]}S=Z}return b}(r,c,d,v,da);if(L!==da)return L}const S=Ql(r,c,d,v,da);if(S!==da)return S}return Tc(c,d,v,b)}function Ql(r,c,d,v,b){const S=function ku(r){if("string"==typeof r)return r.charCodeAt(0)||0;const c=r.hasOwnProperty(Qs)?r[Qs]:void 0;return"number"==typeof c?c>=0?c&Oa:Fu:c}(d);if("function"==typeof S){if(!y(c,r,v))return v&nr.Host?Nu(b,0,v):Tc(c,d,v,b);try{let L;if(L=S(v),null!=L||v&nr.Optional)return L;mt()}finally{H()}}else if("number"==typeof S){let L=null,z=Ps(r,c),Z=yn,ce=v&nr.Host?c[lo][Co]:null;for((-1===z||v&nr.SkipSelf)&&(Z=-1===z?va(r,c):c[z+8],Z!==yn&&vf(v,!1)?(L=c[er],z=oi(Z),c=Gi(Z,c)):z=-1);-1!==z;){const xe=c[er];if(gd(S,z,xe.data)){const je=Sc(z,c,d,L,v,ce);if(je!==da)return je}Z=c[z+8],Z!==yn&&vf(v,c[er].data[z+8]===ce)&&gd(S,z,c)?(L=xe,z=oi(Z),c=Gi(Z,c)):z=-1}}return b}function Sc(r,c,d,v,b,S){const L=c[er],z=L.data[r+8],xe=ec(z,L,d,null==v?Ie(z)&&oo:v!=L&&0!=(3&z.type),b&nr.Host&&S===z);return null!==xe?tc(c,L,xe,z):da}function ec(r,c,d,v,b){const S=r.providerIndexes,L=c.data,z=1048575&S,Z=r.directiveStart,xe=S>>20,ht=b?z+xe:r.directiveEnd;for(let Mt=v?z:z+xe;Mt<ht;Mt++){const mn=L[Mt];if(Mt<Z&&d===mn||Mt>=Z&&mn.type===d)return Mt}if(b){const Mt=L[Z];if(Mt&&yt(Mt)&&Mt.type===d)return Z}return null}function tc(r,c,d,v){let b=r[d];const S=c.data;if(function on(r){return r instanceof It}(b)){const L=b;L.resolving&&function At(r,c){const d=c?`. Dependency path: ${c.join(" > ")} > ${r}`:"";throw new Vn(-200,`Circular dependency in DI detected for ${r}${d}`)}(function Ir(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():Ln(r)}(S[d]));const z=uo(L.canSeeViewProviders);L.resolving=!0;const ce=L.injectImpl?ge(L.injectImpl):null;y(r,v,nr.Default);try{b=r[d]=L.factory(void 0,S,r,v),c.firstCreatePass&&d>=v.directiveStart&&function nt(r,c,d){const{ngOnChanges:v,ngOnInit:b,ngDoCheck:S}=c.type.prototype;if(v){const L=qc(c);(d.preOrderHooks??=[]).push(r,L),(d.preOrderCheckHooks??=[]).push(r,L)}b&&(d.preOrderHooks??=[]).push(0-r,b),S&&((d.preOrderHooks??=[]).push(r,S),(d.preOrderCheckHooks??=[]).push(r,S))}(d,S[d],c)}finally{null!==ce&&ge(ce),uo(z),L.resolving=!1,H()}}return b}function gd(r,c,d){return!!(d[c+(r>>ua)]&1<<r)}function vf(r,c){return!(r&nr.Self||r&nr.Host&&c)}class Ga{constructor(c,d){this._tNode=c,this._lView=d}get(c,d,v){return gu(this._tNode,this._lView,c,Sr(v),d)}}function Fu(){return new Ga(hs(),hn())}function Ic(r){return ro(()=>{const c=r.prototype.constructor,d=c[Go]||jd(c),v=Object.prototype;let b=Object.getPrototypeOf(r.prototype).constructor;for(;b&&b!==v;){const S=b[Go]||jd(b);if(S&&S!==d)return S;b=Object.getPrototypeOf(b)}return S=>new S})}function jd(r){return kn(r)?()=>{const c=jd(dn(r));return c&&c()}:vo(r)}function Mc(r){const c=r[er],d=c.type;return 2===d?c.declTNode:1===d?r[Co]:null}function Oc(r){return function ol(r,c){if("class"===c)return r.classes;if("style"===c)return r.styles;const d=r.attrs;if(d){const v=d.length;let b=0;for(;b<v;){const S=d[b];if(bo(S))break;if(0===S)b+=2;else if("number"==typeof S)for(b++;b<v&&"string"==typeof d[b];)b++;else{if(S===c)return d[b+1];b+=2}}}return null}(hs(),r)}const zu="__parameters__";function mu(r,c,d){return ro(()=>{const v=function vd(r){return function(...d){if(r){const v=r(...d);for(const b in v)this[b]=v[b]}}}(c);function b(...S){if(this instanceof b)return v.apply(this,S),this;const L=new b(...S);return z.annotation=L,z;function z(Z,ce,xe){const je=Z.hasOwnProperty(zu)?Z[zu]:Object.defineProperty(Z,zu,{value:[]})[zu];for(;je.length<=xe;)je.push(null);return(je[xe]=je[xe]||[]).push(L),Z}}return d&&(b.prototype=Object.create(d.prototype)),b.prototype.ngMetadataName=r,b.annotationCls=b,b})}function So(r,c){r.forEach(d=>Array.isArray(d)?So(d,c):c(d))}function Tr(r,c,d){c>=r.length?r.push(d):r.splice(c,0,d)}function uc(r,c){return c>=r.length-1?r.pop():r.splice(c,1)[0]}function Wi(r,c,d){let v=dc(r,c);return v>=0?r[1|v]=d:(v=~v,function cp(r,c,d,v){let b=r.length;if(b==c)r.push(d,v);else if(1===b)r.push(v,r[0]),r[0]=d;else{for(b--,r.push(r[b-1],r[b]);b>c;)r[b]=r[b-2],b--;r[c]=d,r[c+1]=v}}(r,v,c,d)),v}function eu(r,c){const d=dc(r,c);if(d>=0)return r[1|d]}function dc(r,c){return function Mh(r,c,d){let v=0,b=r.length>>d;for(;b!==v;){const S=v+(b-v>>1),L=r[S<<d];if(c===L)return S<<d;L>c?b=S:v=S+1}return~(b<<d)}(r,c,1)}const Zd=Fi(mu("Optional"),8),yu=Fi(mu("SkipSelf"),4);function Xd(r){return 128==(128&r.flags)}var wu=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(wu||{});const Ad=new Map;let _p=0;const kh="__ngContext__";function ya(r,c){ie(c)?(r[kh]=c[ns],function If(r){Ad.set(r[ns],r)}(c)):r[kh]=c}let Fh;function Eu(r,c){return Fh(r,c)}function Zu(r){const c=r[ni];return K(c)?c[ni]:c}function Bh(r){return zh(r[zs])}function Rf(r){return zh(r[cs])}function zh(r){for(;null!==r&&!K(r);)r=r[cs];return r}function zl(r,c,d,v,b){if(null!=v){let S,L=!1;K(v)?S=v:ie(v)&&(L=!0,v=v[mi]);const z=Do(v);0===r&&null!==d?null==b?eh(c,d,z):Du(c,d,z,b||null,!0):1===r&&null!==d?Du(c,d,z,b||null,!0):2===r?function os(r,c,d){const v=Hh(r,c);v&&function Dg(r,c,d,v){r.removeChild(c,d,v)}(r,v,c,d)}(c,z,L):3===r&&c.destroyNode(z),null!=S&&function Ig(r,c,d,v,b){const S=d[oa];S!==Do(d)&&zl(c,r,v,S,b);for(let z=us;z<d.length;z++){const Z=d[z];rh(Z[er],Z,r,c,v,S)}}(c,r,S,d,b)}}function Fc(r,c,d){return r.createElement(c,d)}function Vh(r,c){const d=r[Ua],v=d.indexOf(c);cc(c),d.splice(v,1)}function qu(r,c){if(r.length<=us)return;const d=us+c,v=r[d];if(v){const b=v[na];null!==b&&b!==r&&Vh(b,v),c>0&&(r[d-1][cs]=v[cs]);const S=uc(r,us+c);!function yp(r,c){rh(r,c,c[Or],2,null,null),c[mi]=null,c[Co]=null}(v[er],v);const L=S[Es];null!==L&&L.detachView(S[er]),v[ni]=null,v[cs]=null,v[Dr]&=-129}return v}function jh(r,c){if(!(256&c[Dr])){const d=c[Or];c[ra]&&sc(c[ra]),c[ia]&&sc(c[ia]),d.destroyNode&&rh(r,c,d,3,null,null),function oc(r){let c=r[zs];if(!c)return iu(r[er],r);for(;c;){let d=null;if(ie(c))d=c[zs];else{const v=c[us];v&&(d=v)}if(!d){for(;c&&!c[cs]&&c!==r;)ie(c)&&iu(c[er],c),c=c[ni];null===c&&(c=r),ie(c)&&iu(c[er],c),d=c&&c[cs]}c=d}}(c)}}function iu(r,c){if(!(256&c[Dr])){c[Dr]&=-129,c[Dr]|=256,function Ag(r,c){let d;if(null!=r&&null!=(d=r.destroyHooks))for(let v=0;v<d.length;v+=2){const b=c[d[v]];if(!(b instanceof It)){const S=d[v+1];if(Array.isArray(S))for(let L=0;L<S.length;L+=2){const z=b[S[L]],Z=S[L+1];il(4,z,Z);try{Z.call(z)}finally{il(5,z,Z)}}else{il(4,b,S);try{S.call(b)}finally{il(5,b,S)}}}}}(r,c),function Lf(r,c){const d=r.cleanup,v=c[Aa];if(null!==d)for(let S=0;S<d.length-1;S+=2)if("string"==typeof d[S]){const L=d[S+3];L>=0?v[L]():v[-L].unsubscribe(),S+=2}else d[S].call(v[d[S+1]]);null!==v&&(c[Aa]=null);const b=c[_s];if(null!==b){c[_s]=null;for(let S=0;S<b.length;S++)(0,b[S])()}}(r,c),1===c[er].type&&c[Or].destroy();const d=c[na];if(null!==d&&K(c[ni])){d!==c[ni]&&Vh(d,c);const v=c[Es];null!==v&&v.detachView(r)}!function bu(r){Ad.delete(r[ns])}(c)}}function Au(r,c,d){return function Qd(r,c,d){let v=c;for(;null!==v&&40&v.type;)v=(c=v).parent;if(null===v)return d[mi];{const{componentOffset:b}=v;if(b>-1){const{encapsulation:S}=r.data[v.directiveStart+b];if(S===Et.None||S===Et.Emulated)return null}return la(v,d)}}(r,c.parent,d)}function Du(r,c,d,v,b){r.insertBefore(c,d,v,b)}function eh(r,c,d){r.appendChild(c,d)}function th(r,c,d,v,b){null!==v?Du(r,c,d,v,b):eh(r,c,d)}function Hh(r,c){return r.parentNode(c)}let $h,Ku,Ju,wp=function Sg(r,c,d){return 40&r.type?la(r,d):null};function Xu(r,c,d,v){const b=Au(r,v,c),S=c[Or],z=function Gh(r,c,d){return wp(r,c,d)}(v.parent||c[Co],v,c);if(null!=b)if(Array.isArray(d))for(let Z=0;Z<d.length;Z++)th(S,b,d[Z],z,!1);else th(S,b,d,z,!1);void 0!==$h&&$h(S,v,c,d,b)}function Zl(r,c){if(null!==c){const d=c.type;if(3&d)return la(c,r);if(4&d)return Tu(-1,r[c.index]);if(8&d){const v=c.child;if(null!==v)return Zl(r,v);{const b=r[c.index];return K(b)?Tu(-1,b):Do(b)}}if(32&d)return Eu(c,r)()||Do(r[c.index]);{const v=Ol(r,c);return null!==v?Array.isArray(v)?v[0]:Zl(Zu(r[lo]),v):Zl(r,c.next)}}return null}function Ol(r,c){return null!==c?r[lo][Co].projection[c.projection]:null}function Tu(r,c){const d=us+r+1;if(d<c.length){const v=c[d],b=v[er].firstChild;if(null!==b)return Zl(v,b)}return c[oa]}function nh(r,c,d,v,b,S,L){for(;null!=d;){const z=v[d.index],Z=d.type;if(L&&0===c&&(z&&ya(Do(z),v),d.flags|=2),32!=(32&d.flags))if(8&Z)nh(r,c,d.child,v,b,S,!1),zl(c,r,b,z,S);else if(32&Z){const ce=Eu(d,v);let xe;for(;xe=ce();)zl(c,r,b,xe,S);zl(c,r,b,z,S)}else 16&Z?ih(r,c,v,d,b,S):zl(c,r,b,z,S);d=L?d.projectionNext:d.next}}function rh(r,c,d,v,b,S){nh(d,v,r.firstChild,c,b,S,!1)}function ih(r,c,d,v,b,S){const L=d[lo],Z=L[Co].projection[v.projection];if(Array.isArray(Z))for(let ce=0;ce<Z.length;ce++)zl(c,r,b,Z[ce],S);else{let ce=Z;const xe=L[ni];Xd(v)&&(ce.flags|=128),nh(r,c,ce,xe,b,S,!0)}}function bp(r,c,d){""===d?r.removeAttribute(c,"class"):r.setAttribute(c,"class",d)}function Mg(r,c,d){const{mergedAttrs:v,classes:b,styles:S}=d;null!==v&&kr(r,c,v),null!==b&&bp(r,c,b),null!==S&&function Wh(r,c,d){r.setAttribute(c,"style",d)}(r,c,S)}function Ep(r){Ku=r}function Sd(r){return function qh(){if(void 0===Ju&&(Ju=null,Oe.trustedTypes))try{Ju=Oe.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Ju}()?.createScriptURL(r)||r}class s{constructor(c){this.changingThisBreaksApplicationSecurity=c}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${xr})`}}function w(r){return r instanceof s?r.changingThisBreaksApplicationSecurity:r}function E(r,c){const d=function I(r){return r instanceof s&&r.getTypeName()||null}(r);if(null!=d&&d!==c){if("ResourceURL"===d&&"URL"===c)return!0;throw new Error(`Required a safe ${c}, got a ${d} (see ${xr})`)}return d===c}const at=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var ah=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(ah||{});function Dp(r){const c=Yh();return c?c.sanitize(ah.URL,r)||"":E(r,"URL")?w(r):function Pt(r){return(r=String(r)).match(at)?r:"unsafe:"+r}(Ln(r))}function Rg(r){const c=Yh();if(c)return Sd(c.sanitize(ah.RESOURCE_URL,r)||"");if(E(r,"ResourceURL"))return Sd(w(r));throw new Vn(904,!1)}function $m(r,c,d){return function d_(r,c){return"src"===c&&("embed"===r||"frame"===r||"iframe"===r||"media"===r||"script"===r)||"href"===c&&("base"===r||"link"===r)?Rg:Dp}(c,d)(r)}function Yh(){const r=hn();return r&&r[ta].sanitizer}class Si{constructor(c,d){this._desc=c,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof d?this.__NG_ELEMENT_ID__=d:void 0!==d&&(this.\u0275prov=xi({token:this,providedIn:d.providedIn||"root",factory:d.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const td=new Si("ENVIRONMENT_INITIALIZER"),lh=new Si("INJECTOR",-1),Kh=new Si("INJECTOR_DEF_TYPES");class Tp{get(c,d=Bn){if(d===Bn){const v=new Error(`NullInjectorError: No provider for ${ln(c)}!`);throw v.name="NullInjectorError",v}return d}}function Sp(r){return{\u0275providers:r}}function f_(...r){return{\u0275providers:Wm(0,r),\u0275fromNgModule:!0}}function Wm(r,...c){const d=[],v=new Set;let b;const S=L=>{d.push(L)};return So(c,L=>{const z=L;Ip(z,S,[],v)&&(b||=[],b.push(z))}),void 0!==b&&Zm(b,S),d}function Zm(r,c){for(let d=0;d<r.length;d++){const{ngModule:v,providers:b}=r[d];Ng(b,S=>{c(S,v)})}}function Ip(r,c,d,v){if(!(r=dn(r)))return!1;let b=null,S=Xi(r);const L=!S&&zr(r);if(S||L){if(L&&!L.standalone)return!1;b=r}else{const Z=r.ngModule;if(S=Xi(Z),!S)return!1;b=Z}const z=v.has(b);if(L){if(z)return!1;if(v.add(b),L.dependencies){const Z="function"==typeof L.dependencies?L.dependencies():L.dependencies;for(const ce of Z)Ip(ce,c,d,v)}}else{if(!S)return!1;{if(null!=S.imports&&!z){let ce;v.add(b);try{So(S.imports,xe=>{Ip(xe,c,d,v)&&(ce||=[],ce.push(xe))})}finally{}void 0!==ce&&Zm(ce,c)}if(!z){const ce=vo(b)||(()=>new b);c({provide:b,useFactory:ce,deps:Cr},b),c({provide:Kh,useValue:b,multi:!0},b),c({provide:td,useValue:()=>In(b),multi:!0},b)}const Z=S.providers;if(null!=Z&&!z){const ce=r;Ng(Z,xe=>{c(xe,ce)})}}}return b!==r&&void 0!==r.providers}function Ng(r,c){for(let d of r)di(d)&&(d=d.\u0275providers),Array.isArray(d)?Ng(d,c):c(d)}const Mp=kt({provide:String,useValue:kt});function kg(r){return null!==r&&"object"==typeof r&&Mp in r}function Od(r){return"function"==typeof r}const zg=new Si("Set Injector scope."),Op={},g_={};let Ug;function zf(){return void 0===Ug&&(Ug=new Tp),Ug}class Su{}class wa extends Su{get destroyed(){return this._destroyed}constructor(c,d,v,b){super(),this.parent=d,this.source=v,this.scopes=b,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,jg(c,L=>this.processProvider(L)),this.records.set(lh,Jh(void 0,this)),b.has("environment")&&this.records.set(Su,Jh(void 0,this));const S=this.records.get(zg);null!=S&&"string"==typeof S.value&&this.scopes.add(S.value),this.injectorDefTypes=new Set(this.get(Kh.multi,Cr,nr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const d of this._ngOnDestroyHooks)d.ngOnDestroy();const c=this._onDestroyHooks;this._onDestroyHooks=[];for(const d of c)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(c){return this.assertNotDestroyed(),this._onDestroyHooks.push(c),()=>this.removeOnDestroy(c)}runInContext(c){this.assertNotDestroyed();const d=an(this),v=ge(void 0);try{return c()}finally{an(d),ge(v)}}get(c,d=Bn,v=nr.Default){if(this.assertNotDestroyed(),c.hasOwnProperty(Fn))return c[Fn](this);v=Sr(v);const S=an(this),L=ge(void 0);try{if(!(v&nr.SkipSelf)){let Z=this.records.get(c);if(void 0===Z){const ce=function __(r){return"function"==typeof r||"object"==typeof r&&r instanceof Si}(c)&&ur(c);Z=ce&&this.injectableDefInScope(ce)?Jh(pc(c),Op):null,this.records.set(c,Z)}if(null!=Z)return this.hydrate(c,Z)}return(v&nr.Self?zf():this.parent).get(c,d=v&nr.Optional&&d===Bn?null:d)}catch(z){if("NullInjectorError"===z.name){if((z[Lr]=z[Lr]||[]).unshift(ln(c)),S)throw z;return function Jo(r,c,d,v){const b=r[Lr];throw c[_t]&&b.unshift(c[_t]),r.message=function Vi(r,c,d,v=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let b=ln(c);if(Array.isArray(c))b=c.map(ln).join(" -> ");else if("object"==typeof c){let S=[];for(let L in c)if(c.hasOwnProperty(L)){let z=c[L];S.push(L+":"+("string"==typeof z?JSON.stringify(z):ln(z)))}b=`{${S.join(", ")}}`}return`${d}${v?"("+v+")":""}[${b}]: ${r.replace(zi,"\n  ")}`}("\n"+r.message,b,d,v),r.ngTokenPath=b,r[Lr]=null,r}(z,c,"R3InjectorError",this.source)}throw z}finally{ge(L),an(S)}}resolveInjectorInitializers(){const c=an(this),d=ge(void 0);try{const b=this.get(td.multi,Cr,nr.Self);for(const S of b)S()}finally{an(c),ge(d)}}toString(){const c=[],d=this.records;for(const v of d.keys())c.push(ln(v));return`R3Injector[${c.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Vn(205,!1)}processProvider(c){let d=Od(c=dn(c))?c:dn(c&&c.provide);const v=function Pp(r){return kg(r)?Jh(void 0,r.useValue):Jh(ch(r),Op)}(c);if(Od(c)||!0!==c.multi)this.records.get(d);else{let b=this.records.get(d);b||(b=Jh(void 0,Op,!0),b.factory=()=>Ui(b.multi),this.records.set(d,b)),d=c,b.multi.push(c)}this.records.set(d,v)}hydrate(c,d){return d.value===Op&&(d.value=g_,d.value=d.factory()),"object"==typeof d.value&&d.value&&function Uf(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(d.value)&&this._ngOnDestroyHooks.add(d.value),d.value}injectableDefInScope(c){if(!c.providedIn)return!1;const d=dn(c.providedIn);return"string"==typeof d?"any"===d||this.scopes.has(d):this.injectorDefTypes.has(d)}removeOnDestroy(c){const d=this._onDestroyHooks.indexOf(c);-1!==d&&this._onDestroyHooks.splice(d,1)}}function pc(r){const c=ur(r),d=null!==c?c.factory:vo(r);if(null!==d)return d;if(r instanceof Si)throw new Vn(204,!1);if(r instanceof Function)return function Vg(r){const c=r.length;if(c>0)throw function Qc(r,c){const d=[];for(let v=0;v<r;v++)d.push(c);return d}(c,"?"),new Vn(204,!1);const d=function qt(r){return r&&(r[si]||r[Jr])||null}(r);return null!==d?()=>d.factory(r):()=>new r}(r);throw new Vn(204,!1)}function ch(r,c,d){let v;if(Od(r)){const b=dn(r);return vo(b)||pc(b)}if(kg(r))v=()=>dn(r.useValue);else if(function Bg(r){return!(!r||!r.useFactory)}(r))v=()=>r.useFactory(...Ui(r.deps||[]));else if(function Fg(r){return!(!r||!r.useExisting)}(r))v=()=>In(dn(r.useExisting));else{const b=dn(r&&(r.useClass||r.provide));if(!function m_(r){return!!r.deps}(r))return vo(b)||pc(b);v=()=>new b(...Ui(r.deps))}return v}function Jh(r,c,d=!1){return{factory:r,value:c,multi:d?[]:void 0}}function jg(r,c){for(const d of r)Array.isArray(d)?jg(d,c):d&&di(d)?jg(d.\u0275providers,c):c(d)}const Hg=new Si("AppId",{providedIn:"root",factory:()=>qm}),qm="ng",Gg=new Si("Platform Initializer"),Ro=new Si("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Ym=new Si("CSP nonce",{providedIn:"root",factory:()=>function ps(){if(void 0!==Ku)return Ku;if(typeof document<"u")return document;throw new Vn(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Yg=(r,c,d)=>null;function Gf(r,c,d=!1){return Yg(r,c,d)}class Qm{}class em{}class e0{resolveComponentFactory(c){throw function tm(r){const c=Error(`No component factory found for ${ln(r)}.`);return c.ngComponent=r,c}(c)}}let Uc=(()=>{class r{static#e=this.NULL=new e0}return r})();function t0(){return dh(hs(),hn())}function dh(r,c){return new rf(la(r,c))}let rf=(()=>{class r{constructor(d){this.nativeElement=d}static#e=this.__NG_ELEMENT_ID__=t0}return r})();function n0(r){return r instanceof rf?r.nativeElement:r}class r0{}let E_=(()=>{class r{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function o0(){const r=hn(),d=_a(hs().index,r);return(ie(d)?d:r)[Or]}()}return r})(),s0=(()=>{class r{static#e=this.\u0275prov=xi({token:r,providedIn:"root",factory:()=>null})}return r})();class sf{constructor(c){this.full=c,this.major=c.split(".")[0],this.minor=c.split(".")[1],this.patch=c.split(".").slice(2).join(".")}}const a0=new sf("16.2.10"),zp={};function u0(r,c=null,d=null,v){const b=d0(r,c,d,v);return b.resolveInjectorInitializers(),b}function d0(r,c=null,d=null,v,b=new Set){const S=[d||Cr,f_(r)];return v=v||("object"==typeof r?void 0:ln(r)),new wa(S,c||zf(),v||null,b)}let su=(()=>{class r{static#e=this.THROW_IF_NOT_FOUND=Bn;static#t=this.NULL=new Tp;static create(d,v){if(Array.isArray(d))return u0({name:""},v,d,"");{const b=d.name??"";return u0({name:b},d.parent,d.providers,b)}}static#n=this.\u0275prov=xi({token:r,providedIn:"any",factory:()=>In(lh)});static#r=this.__NG_ELEMENT_ID__=-1}return r})();function Xf(r){return r.ngOriginalError}class Rd{constructor(){this._console=console}handleError(c){const d=this._findOriginalError(c);this._console.error("ERROR",c),d&&this._console.error("ORIGINAL ERROR",d)}_findOriginalError(c){let d=c&&Xf(c);for(;d&&Xf(d);)d=Xf(d);return d||null}}function ph(r){return c=>{setTimeout(r,void 0,c)}}const Pl=class D_ extends O.x{constructor(c=!1){super(),this.__isAsync=c}emit(c){super.next(c)}subscribe(c,d,v){let b=c,S=d||(()=>null),L=v;if(c&&"object"==typeof c){const Z=c;b=Z.next?.bind(Z),S=Z.error?.bind(Z),L=Z.complete?.bind(Z)}this.__isAsync&&(S=ph(S),b&&(b=ph(b)),L&&(L=ph(L)));const z=super.subscribe({next:b,error:S,complete:L});return c instanceof bt.w0&&c.add(z),z}};function rm(...r){}class Wa{constructor({enableLongStackTrace:c=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:v=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pl(!1),this.onMicrotaskEmpty=new Pl(!1),this.onStable=new Pl(!1),this.onError=new Pl(!1),typeof Zone>"u")throw new Vn(908,!1);Zone.assertZonePatched();const b=this;b._nesting=0,b._outer=b._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(b._inner=b._inner.fork(new Zone.TaskTrackingZoneSpec)),c&&Zone.longStackTraceZoneSpec&&(b._inner=b._inner.fork(Zone.longStackTraceZoneSpec)),b.shouldCoalesceEventChangeDetection=!v&&d,b.shouldCoalesceRunChangeDetection=v,b.lastRequestAnimationFrameId=-1,b.nativeRequestAnimationFrame=function f0(){const r="function"==typeof Oe.requestAnimationFrame;let c=Oe[r?"requestAnimationFrame":"setTimeout"],d=Oe[r?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&c&&d){const v=c[Zone.__symbol__("OriginalDelegate")];v&&(c=v);const b=d[Zone.__symbol__("OriginalDelegate")];b&&(d=b)}return{nativeRequestAnimationFrame:c,nativeCancelAnimationFrame:d}}().nativeRequestAnimationFrame,function S_(r){const c=()=>{!function gh(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Oe,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,Mu(r),r.isCheckStableRunning=!0,jp(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),Mu(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(d,v,b,S,L,z)=>{if(function Hp(r){return!(!Array.isArray(r)||1!==r.length)&&!0===r[0].data?.__ignore_ng_zone__}(z))return d.invokeTask(b,S,L,z);try{return p0(r),d.invokeTask(b,S,L,z)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===S.type||r.shouldCoalesceRunChangeDetection)&&c(),lf(r)}},onInvoke:(d,v,b,S,L,z,Z)=>{try{return p0(r),d.invoke(b,S,L,z,Z)}finally{r.shouldCoalesceRunChangeDetection&&c(),lf(r)}},onHasTask:(d,v,b,S)=>{d.hasTask(b,S),v===b&&("microTask"==S.change?(r._hasPendingMicrotasks=S.microTask,Mu(r),jp(r)):"macroTask"==S.change&&(r.hasPendingMacrotasks=S.macroTask))},onHandleError:(d,v,b,S)=>(d.handleError(b,S),r.runOutsideAngular(()=>r.onError.emit(S)),!1)})}(b)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Wa.isInAngularZone())throw new Vn(909,!1)}static assertNotInAngularZone(){if(Wa.isInAngularZone())throw new Vn(909,!1)}run(c,d,v){return this._inner.run(c,d,v)}runTask(c,d,v,b){const S=this._inner,L=S.scheduleEventTask("NgZoneEvent: "+b,c,T_,rm,rm);try{return S.runTask(L,d,v)}finally{S.cancelTask(L)}}runGuarded(c,d,v){return this._inner.runGuarded(c,d,v)}runOutsideAngular(c){return this._outer.run(c)}}const T_={};function jp(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Mu(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function p0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function lf(r){r._nesting--,jp(r)}class Yf{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pl,this.onMicrotaskEmpty=new Pl,this.onStable=new Pl,this.onError=new Pl}run(c,d,v){return c.apply(d,v)}runGuarded(c,d,v){return c.apply(d,v)}runOutsideAngular(c){return c()}runTask(c,d,v,b){return c.apply(d,v)}}const cf=new Si("",{providedIn:"root",factory:uf});function uf(){const r=br(Wa);let c=!0;return function xt(...r){const c=(0,Vt.yG)(r),d=(0,Vt._6)(r,1/0),v=r;return v.length?1===v.length?(0,ze.Xf)(v[0]):(0,f.J)(d)((0,$t.D)(v,c)):ke.E}(new St.y(b=>{c=r.isStable&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks,r.runOutsideAngular(()=>{b.next(c),b.complete()})}),new St.y(b=>{let S;r.runOutsideAngular(()=>{S=r.onStable.subscribe(()=>{Wa.assertNotInAngularZone(),queueMicrotask(()=>{!c&&!r.hasPendingMacrotasks&&!r.hasPendingMicrotasks&&(c=!0,b.next(!0))})})});const L=r.onUnstable.subscribe(()=>{Wa.assertInAngularZone(),c&&(c=!1,r.runOutsideAngular(()=>{b.next(!1)}))});return()=>{S.unsubscribe(),L.unsubscribe()}}).pipe(zt()))}function od(r){return r instanceof Function?r():r}let Gp=(()=>{class r{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=xi({token:r,providedIn:"root",factory:()=>new r})}return r})();function Kf(r){for(;r;){r[Dr]|=64;const c=Zu(r);if(vn(r)&&!c)return r;r=c}return null}const v0=new Si("",{providedIn:"root",factory:()=>!1});let Xp=null;function w0(r,c){return r[c]??df()}function b0(r,c){const d=df();d.producerNode?.length&&(r[c]=Xp,d.lView=r,Xp=E0())}const am={...Ja,consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{Kf(r.lView)},lView:null};function E0(){return Object.create(am)}function df(){return Xp??=E0(),Xp}const Li={};function C0(r){lm(no(),hn(),ye()+r,!1)}function lm(r,c,d,v){if(!v)if(3==(3&c[Dr])){const S=r.preOrderCheckHooks;null!==S&&pt(c,S,d)}else{const S=r.preOrderHooks;null!==S&&Lt(c,S,0,d)}Ae(d)}function hf(r,c=nr.Default){const d=hn();return null===d?In(r,c):gu(hs(),d,dn(r),c)}function cm(){throw new Error("invalid")}function mc(r,c,d,v,b,S,L,z,Z,ce,xe){const je=c.blueprint.slice();return je[mi]=b,je[Dr]=140|v,(null!==ce||r&&2048&r[Dr])&&(je[Dr]|=2048),lc(je),je[ni]=je[Xr]=r,je[Fr]=d,je[ta]=L||r&&r[ta],je[Or]=z||r&&r[Or],je[Ws]=Z||r&&r[Ws]||null,je[Co]=S,je[ns]=function Yd(){return _p++}(),je[Us]=xe,je[Xa]=ce,je[lo]=2==c.type?r[lo]:je,je}function _c(r,c,d,v,b){let S=r.data[c];if(null===S)S=function jc(r,c,d,v,b){const S=Ac(),L=Ma(),Z=r.data[c]=function Nd(r,c,d,v,b,S){let L=c?c.injectorIndex:-1,z=0;return function Ct(){return null!==ei.skipHydrationRootTNode}()&&(z|=128),{type:d,index:v,insertBeforeIndex:null,injectorIndex:L,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:z,providerIndexes:0,value:b,attrs:S,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:c,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,L?S:S&&S.parent,d,c,v,b);return null===r.firstChild&&(r.firstChild=Z),null!==S&&(L?null==S.child&&null!==Z.parent&&(S.child=Z):null===S.next&&(S.next=Z,Z.prev=S)),Z}(r,c,d,v,b),function Th(){return ei.lFrame.inI18n}()&&(S.flags|=32);else if(64&S.type){S.type=d,S.value=v,S.attrs=b;const L=function Kn(){const r=ei.lFrame,c=r.currentTNode;return r.isParent?c:c.parent}();S.injectorIndex=null===L?-1:L.injectorIndex}return ml(S,!0),S}function Hc(r,c,d,v){if(0===d)return-1;const b=c.length;for(let S=0;S<d;S++)c.push(v),r.blueprint.push(v),r.data.push(null);return b}function ep(r,c,d,v,b){const S=w0(c,ra),L=ye(),z=2&v;try{Ae(-1),z&&c.length>Wr&&lm(r,c,Wr,!1),il(z?2:0,b);const ce=z?S:null,xe=fl(ce);try{null!==ce&&(ce.dirty=!1),d(v,b)}finally{yl(ce,xe)}}finally{z&&null===c[ra]&&b0(c,ra),Ae(L),il(z?3:1,b)}}function Yp(r,c,d){if(le(c)){const v=Oo(null);try{const S=c.directiveEnd;for(let L=c.directiveStart;L<S;L++){const z=r.data[L];z.contentQueries&&z.contentQueries(1,d[L],L)}}finally{Oo(v)}}}function Kp(r,c,d){Lu()&&(function vh(r,c,d,v){const b=d.directiveStart,S=d.directiveEnd;Ie(d)&&function F0(r,c,d){const v=la(c,r),b=Qp(d);let L=16;d.signals?L=4096:d.onPush&&(L=64);const z=gf(r,mc(r,b,null,L,v,c,null,r[ta].rendererFactory.createRenderer(v,d),null,null,null));r[c.index]=z}(c,d,r.data[b+d.componentOffset]),r.firstCreatePass||ho(d,c),ya(v,c);const L=d.initialInputs;for(let z=b;z<S;z++){const Z=r.data[z],ce=tc(c,r,z,d);ya(ce,c),null!==L&&_m(0,z-b,ce,Z,0,L),yt(Z)&&(_a(d.index,c)[Fr]=tc(c,r,z,d))}}(r,c,d,la(d,c)),64==(64&d.flags)&&gm(r,c,d))}function Jp(r,c,d=la){const v=c.localNames;if(null!==v){let b=c.index+1;for(let S=0;S<v.length;S+=2){const L=v[S+1],z=-1===L?d(c,r):r[L];r[b++]=z}}}function Qp(r){const c=r.tView;return null===c||c.incompleteFirstPass?r.tView=um(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):c}function um(r,c,d,v,b,S,L,z,Z,ce,xe){const je=Wr+v,ht=je+b,Mt=function A0(r,c){const d=[];for(let v=0;v<c;v++)d.push(v<r?null:Li);return d}(je,ht),mn="function"==typeof ce?ce():ce;return Mt[er]={type:r,blueprint:Mt,template:d,queries:null,viewQuery:z,declTNode:c,data:Mt.slice().fill(null,je),bindingStartIndex:je,expandoStartIndex:ht,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof S?S():S,pipeRegistry:"function"==typeof L?L():L,firstChild:null,schemas:Z,consts:mn,incompleteFirstPass:!1,ssrId:xe}}let dm=r=>null;function hm(r,c,d,v){for(let b in r)if(r.hasOwnProperty(b)){d=null===d?{}:d;const S=r[b];null===v?O0(d,c,b,S):v.hasOwnProperty(b)&&O0(d,c,v[b],S)}return d}function O0(r,c,d,v){r.hasOwnProperty(d)?r[d].push(c,v):r[d]=[c,v]}function Gc(r,c,d,v){if(Lu()){const b=null===v?null:{"":-1},S=function tp(r,c){const d=r.directiveRegistry;let v=null,b=null;if(d)for(let S=0;S<d.length;S++){const L=d[S];if(Za(c,L.selectors,!1))if(v||(v=[]),yt(L))if(null!==L.findHostDirectiveDefs){const z=[];b=b||new Map,L.findHostDirectiveDefs(L,z,b),v.unshift(...z,L),pf(r,c,z.length)}else v.unshift(L),pf(r,c,0);else b=b||new Map,L.findHostDirectiveDefs?.(L,v,b),v.push(L)}return null===v?null:[v,b]}(r,d);let L,z;null===S?L=z=null:[L,z]=S,null!==L&&tg(r,c,d,L,b,z),b&&function L0(r,c,d){if(c){const v=r.localNames=[];for(let b=0;b<c.length;b+=2){const S=d[c[b+1]];if(null==S)throw new Vn(-301,!1);v.push(c[b],S)}}}(d,v,b)}d.mergedAttrs=Vr(d.mergedAttrs,d.attrs)}function tg(r,c,d,v,b,S){for(let ce=0;ce<v.length;ce++)Po(ho(d,c),r,v[ce].type);!function L_(r,c,d){r.flags|=1,r.directiveStart=c,r.directiveEnd=c+d,r.providerIndexes=c}(d,r.data.length,v.length);for(let ce=0;ce<v.length;ce++){const xe=v[ce];xe.providersResolver&&xe.providersResolver(xe)}let L=!1,z=!1,Z=Hc(r,c,v.length,null);for(let ce=0;ce<v.length;ce++){const xe=v[ce];d.mergedAttrs=Vr(d.mergedAttrs,xe.hostAttrs),k0(r,d,c,Z,xe),N0(Z,xe,b),null!==xe.contentQueries&&(d.flags|=4),(null!==xe.hostBindings||null!==xe.hostAttrs||0!==xe.hostVars)&&(d.flags|=64);const je=xe.type.prototype;!L&&(je.ngOnChanges||je.ngOnInit||je.ngDoCheck)&&((r.preOrderHooks??=[]).push(d.index),L=!0),!z&&(je.ngOnChanges||je.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(d.index),z=!0),Z++}!function R_(r,c,d){const b=c.directiveEnd,S=r.data,L=c.attrs,z=[];let Z=null,ce=null;for(let xe=c.directiveStart;xe<b;xe++){const je=S[xe],ht=d?d.get(je):null,mn=ht?ht.outputs:null;Z=hm(je.inputs,xe,Z,ht?ht.inputs:null),ce=hm(je.outputs,xe,ce,mn);const Nn=null===Z||null===L||ls(c)?null:B0(Z,xe,L);z.push(Nn)}null!==Z&&(Z.hasOwnProperty("class")&&(c.flags|=8),Z.hasOwnProperty("style")&&(c.flags|=16)),c.initialInputs=z,c.inputs=Z,c.outputs=ce}(r,d,S)}function gm(r,c,d){const v=d.directiveStart,b=d.directiveEnd,S=d.index,L=function F(){return ei.lFrame.currentDirectiveIndex}();try{Ae(S);for(let z=v;z<b;z++){const Z=r.data[z],ce=c[z];q(z),(null!==Z.hostBindings||0!==Z.hostVars||null!==Z.hostAttrs)&&R0(Z,ce)}}finally{Ae(-1),q(L)}}function R0(r,c){null!==r.hostBindings&&r.hostBindings(1,c)}function pf(r,c,d){c.componentOffset=d,(r.components??=[]).push(c.index)}function N0(r,c,d){if(d){if(c.exportAs)for(let v=0;v<c.exportAs.length;v++)d[c.exportAs[v]]=r;yt(c)&&(d[""]=r)}}function k0(r,c,d,v,b){r.data[v]=b;const S=b.factory||(b.factory=vo(b.type)),L=new It(S,yt(b),hf);r.blueprint[v]=L,d[v]=L,function pm(r,c,d,v,b){const S=b.hostBindings;if(S){let L=r.hostBindingOpCodes;null===L&&(L=r.hostBindingOpCodes=[]);const z=~c.index;(function au(r){let c=r.length;for(;c>0;){const d=r[--c];if("number"==typeof d&&d<0)return d}return 0})(L)!=z&&L.push(z),L.push(d,v,S)}}(r,c,v,Hc(r,d,b.hostVars,Li),b)}function lu(r,c,d,v,b,S){const L=la(r,c);!function mm(r,c,d,v,b,S,L){if(null==S)r.removeAttribute(c,b,d);else{const z=null==L?Ln(S):L(S,v||"",b);r.setAttribute(c,b,z,d)}}(c[Or],L,S,r.value,d,v,b)}function _m(r,c,d,v,b,S){const L=S[c];if(null!==L)for(let z=0;z<L.length;)vm(v,d,L[z++],L[z++],L[z++])}function vm(r,c,d,v,b){const S=Oo(null);try{const L=r.inputTransforms;null!==L&&L.hasOwnProperty(v)&&(b=L[v].call(c,b)),null!==r.setInput?r.setInput(c,b,d,v):c[v]=b}finally{Oo(S)}}function B0(r,c,d){let v=null,b=0;for(;b<d.length;){const S=d[b];if(0!==S)if(5!==S){if("number"==typeof S)break;if(r.hasOwnProperty(S)){null===v&&(v=[]);const L=r[S];for(let z=0;z<L.length;z+=2)if(L[z]===c){v.push(S,L[z+1],d[b+1]);break}}b+=2}else b+=2;else b+=4}return v}function ym(r,c,d,v){return[r,!0,!1,c,null,0,v,d,null,null,null]}function ng(r,c){const d=r.contentQueries;if(null!==d)for(let v=0;v<d.length;v+=2){const S=d[v+1];if(-1!==S){const L=r.data[S];i(d[v]),L.contentQueries(2,c[S],S)}}}function gf(r,c){return r[zs]?r[ms][cs]=c:r[zs]=c,r[ms]=c,c}function rg(r,c,d){i(0);const v=Oo(null);try{c(r,d)}finally{Oo(v)}}function og(r){return r[Aa]||(r[Aa]=[])}function xm(r){return r.cleanup||(r.cleanup=[])}function t(r,c){const d=r[Ws],v=d?d.get(Rd,null):null;v&&v.handleError(c)}function l(r,c,d,v,b){for(let S=0;S<d.length;){const L=d[S++],z=d[S++];vm(r.data[L],c[L],v,z,b)}}function h(r,c,d){const v=Hl(c,r);!function Kd(r,c,d){r.setValue(c,d)}(r[Or],v,d)}function m(r,c){const d=_a(c,r),v=d[er];!function x(r,c){for(let d=c.length;d<r.blueprint.length;d++)c.push(r.blueprint[d])}(v,d);const b=d[mi];null!==b&&null===d[Us]&&(d[Us]=Gf(b,d[Ws])),C(v,d,d[Fr])}function C(r,c,d){A(c);try{const v=r.viewQuery;null!==v&&rg(1,v,d);const b=r.template;null!==b&&ep(r,c,b,1,d),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&ng(r,c),r.staticViewQueries&&rg(2,r.viewQuery,d);const S=r.components;null!==S&&function D(r,c){for(let d=0;d<c.length;d++)m(r,c[d])}(c,S)}catch(v){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),v}finally{c[Dr]&=-5,Q()}}let M=(()=>{class r{constructor(){this.all=new Set,this.queue=new Map}create(d,v,b){const S=typeof Zone>"u"?null:Zone.current,L=function ma(r,c,d){const v=Object.create(Os);d&&(v.consumerAllowSignalWrites=!0),v.fn=r,v.schedule=c;const b=L=>{v.cleanupFn=L};return v.ref={notify:()=>el(v),run:()=>{if(v.dirty=!1,v.hasRun&&!xl(v))return;v.hasRun=!0;const L=fl(v);try{v.cleanupFn(),v.cleanupFn=Sa,v.fn(b)}finally{yl(v,L)}},cleanup:()=>v.cleanupFn()},v.ref}(d,ce=>{this.all.has(ce)&&this.queue.set(ce,S)},b);let z;this.all.add(L),L.notify();const Z=()=>{L.cleanup(),z?.(),this.all.delete(L),this.queue.delete(L)};return z=v?.onDestroy(Z),{destroy:Z}}flush(){if(0!==this.queue.size)for(const[d,v]of this.queue)this.queue.delete(d),v?v.run(()=>d.run()):d.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=xi({token:r,providedIn:"root",factory:()=>new r})}return r})();function U(r,c,d){let v=d?r.styles:null,b=d?r.classes:null,S=0;if(null!==c)for(let L=0;L<c.length;L++){const z=c[L];"number"==typeof z?S=z:1==S?b=Wn(b,z):2==S&&(v=Wn(v,z+": "+c[++L]+";"))}d?r.styles=v:r.stylesWithoutHost=v,d?r.classes=b:r.classesWithoutHost=b}function G(r,c,d,v,b=!1){for(;null!==d;){const S=c[d.index];null!==S&&v.push(Do(S)),K(S)&&Y(S,v);const L=d.type;if(8&L)G(r,c,d.child,v);else if(32&L){const z=Eu(d,c);let Z;for(;Z=z();)v.push(Z)}else if(16&L){const z=Ol(c,d);if(Array.isArray(z))v.push(...z);else{const Z=Zu(c[lo]);G(Z[er],Z,z,v,!0)}}d=b?d.projectionNext:d.next}return v}function Y(r,c){for(let d=us;d<r.length;d++){const v=r[d],b=v[er].firstChild;null!==b&&G(v[er],v,b,c)}r[oa]!==r[mi]&&c.push(r[oa])}function ne(r,c,d,v=!0){const b=c[ta],S=b.rendererFactory,L=b.afterRenderEventManager;S.begin?.(),L?.begin();try{Ee(r,c,r.template,d)}catch(Z){throw v&&t(c,Z),Z}finally{S.end?.(),b.effectManager?.flush(),L?.end()}}function Ee(r,c,d,v){const b=c[Dr];if(256!=(256&b)){c[ta].effectManager?.flush(),A(c);try{lc(c),function pu(r){return ei.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==d&&ep(r,c,d,2,v);const L=3==(3&b);if(L){const ce=r.preOrderCheckHooks;null!==ce&&pt(c,ce,null)}else{const ce=r.preOrderHooks;null!==ce&&Lt(c,ce,0,null),En(c,0)}if(function We(r){for(let c=Bh(r);null!==c;c=Rf(c)){if(!c[za])continue;const d=c[Ua];for(let v=0;v<d.length;v++){dd(d[v])}}}(c),Pe(c,2),null!==r.contentQueries&&ng(r,c),L){const ce=r.contentCheckHooks;null!==ce&&pt(c,ce)}else{const ce=r.contentHooks;null!==ce&&Lt(c,ce,1),En(c,1)}!function Vc(r,c){const d=r.hostBindingOpCodes;if(null===d)return;const v=w0(c,ia);try{for(let b=0;b<d.length;b++){const S=d[b];if(S<0)Ae(~S);else{const L=S,z=d[++b],Z=d[++b];$(z,L),v.dirty=!1;const ce=fl(v);try{Z(2,c[L])}finally{yl(v,ce)}}}}finally{null===c[ia]&&b0(c,ia),Ae(-1)}}(r,c);const z=r.components;null!==z&&et(c,z,0);const Z=r.viewQuery;if(null!==Z&&rg(2,Z,v),L){const ce=r.viewCheckHooks;null!==ce&&pt(c,ce)}else{const ce=r.viewHooks;null!==ce&&Lt(c,ce,2),En(c,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),c[Dr]&=-73,cc(c)}finally{Q()}}}function Pe(r,c){for(let d=Bh(r);null!==d;d=Rf(d))for(let v=us;v<d.length;v++)$e(d[v],c)}function Le(r,c,d){$e(_a(c,r),d)}function $e(r,c){if(!function ud(r){return 128==(128&r[Dr])}(r))return;const d=r[er],v=r[Dr];if(80&v&&0===c||1024&v||2===c)Ee(d,r,d.template,r[Fr]);else if(r[ts]>0){Pe(r,1);const b=d.components;null!==b&&et(r,b,1)}}function et(r,c,d){for(let v=0;v<c.length;v++)Le(r,c[v],d)}class Xe{get rootNodes(){const c=this._lView,d=c[er];return G(d,c,d.firstChild,[])}constructor(c,d){this._lView=c,this._cdRefInjectingView=d,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Fr]}set context(c){this._lView[Fr]=c}get destroyed(){return 256==(256&this._lView[Dr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const c=this._lView[ni];if(K(c)){const d=c[8],v=d?d.indexOf(this):-1;v>-1&&(qu(c,v),uc(d,v))}this._attachedToViewContainer=!1}jh(this._lView[er],this._lView)}onDestroy(c){!function hd(r,c){if(256==(256&r[Dr]))throw new Vn(911,!1);null===r[_s]&&(r[_s]=[]),r[_s].push(c)}(this._lView,c)}markForCheck(){Kf(this._cdRefInjectingView||this._lView)}detach(){this._lView[Dr]&=-129}reattach(){this._lView[Dr]|=128}detectChanges(){ne(this._lView[er],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Vn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Jd(r,c){rh(r,c,c[Or],2,null,null)}(this._lView[er],this._lView)}attachToAppRef(c){if(this._attachedToViewContainer)throw new Vn(902,!1);this._appRef=c}}class Ft extends Xe{constructor(c){super(c),this._view=c}detectChanges(){const c=this._view;ne(c[er],c,c[Fr],!1)}checkNoChanges(){}get context(){return null}}class Rt extends Uc{constructor(c){super(),this.ngModule=c}resolveComponentFactory(c){const d=zr(c);return new cn(d,this.ngModule)}}function tn(r){const c=[];for(let d in r)r.hasOwnProperty(d)&&c.push({propName:r[d],templateName:d});return c}class Ht{constructor(c,d){this.injector=c,this.parentInjector=d}get(c,d,v){v=Sr(v);const b=this.injector.get(c,zp,v);return b!==zp||d===zp?b:this.parentInjector.get(c,d,v)}}class cn extends em{get inputs(){const c=this.componentDef,d=c.inputTransforms,v=tn(c.inputs);if(null!==d)for(const b of v)d.hasOwnProperty(b.propName)&&(b.transform=d[b.propName]);return v}get outputs(){return tn(this.componentDef.outputs)}constructor(c,d){super(),this.componentDef=c,this.ngModule=d,this.componentType=c.type,this.selector=function Di(r){return r.map(ul).join(",")}(c.selectors),this.ngContentSelectors=c.ngContentSelectors?c.ngContentSelectors:[],this.isBoundToModule=!!d}create(c,d,v,b){let S=(b=b||this.ngModule)instanceof Su?b:b?.injector;S&&null!==this.componentDef.getStandaloneInjector&&(S=this.componentDef.getStandaloneInjector(S)||S);const L=S?new Ht(c,S):c,z=L.get(r0,null);if(null===z)throw new Vn(407,!1);const je={rendererFactory:z,sanitizer:L.get(s0,null),effectManager:L.get(M,null),afterRenderEventManager:L.get(Gp,null)},ht=z.createRenderer(null,this.componentDef),Mt=this.componentDef.selectors[0][0]||"div",mn=v?function D0(r,c,d,v){const S=v.get(v0,!1)||d===Et.ShadowDom,L=r.selectRootElement(c,S);return function T0(r){dm(r)}(L),L}(ht,v,this.componentDef.encapsulation,L):Fc(ht,Mt,function Dn(r){const c=r.toLowerCase();return"svg"===c?du:"math"===c?"math":null}(Mt)),Ur=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Tn=null;null!==mn&&(Tn=Gf(mn,L,!0));const Mi=um(0,null,null,1,0,null,null,null,null,null,null),ao=mc(null,Mi,null,Ur,null,null,je,ht,L,null,Tn);let Ms,Zc;A(ao);try{const Ch=this.componentDef;let mg,zv=null;Ch.findHostDirectiveDefs?(mg=[],zv=new Map,Ch.findHostDirectiveDefs(Ch,mg,zv),mg.push(Ch)):mg=[Ch];const YC=function bn(r,c){const d=r[er],v=Wr;return r[v]=c,_c(d,v,2,"#host",null)}(ao,mn),KC=function Pn(r,c,d,v,b,S,L){const z=b[er];!function Jt(r,c,d,v){for(const b of r)c.mergedAttrs=Vr(c.mergedAttrs,b.hostAttrs);null!==c.mergedAttrs&&(U(c,c.mergedAttrs,!0),null!==d&&Mg(v,d,c))}(v,r,c,L);let Z=null;null!==c&&(Z=Gf(c,b[Ws]));const ce=S.rendererFactory.createRenderer(c,d);let xe=16;d.signals?xe=4096:d.onPush&&(xe=64);const je=mc(b,Qp(d),null,xe,b[r.index],r,S,ce,null,null,Z);return z.firstCreatePass&&pf(z,r,v.length-1),gf(b,je),b[r.index]=je}(YC,mn,Ch,mg,ao,je,ht);Zc=Ds(Mi,Wr),mn&&function ar(r,c,d,v){if(v)kr(r,d,["ng-version",a0.full]);else{const{attrs:b,classes:S}=function Eo(r){const c=[],d=[];let v=1,b=2;for(;v<r.length;){let S=r[v];if("string"==typeof S)2===b?""!==S&&c.push(S,r[++v]):8===b&&d.push(S);else{if(!ji(b))break;b=S}v++}return{attrs:c,classes:d}}(c.selectors[0]);b&&kr(r,d,b),S&&S.length>0&&bp(r,d,S.join(" "))}}(ht,Ch,mn,v),void 0!==d&&function Yn(r,c,d){const v=r.projection=[];for(let b=0;b<c.length;b++){const S=d[b];v.push(null!=S?Array.from(S):null)}}(Zc,this.ngContentSelectors,d),Ms=function qn(r,c,d,v,b,S){const L=hs(),z=b[er],Z=la(L,b);tg(z,b,L,d,null,v);for(let xe=0;xe<d.length;xe++)ya(tc(b,z,L.directiveStart+xe,L),b);gm(z,b,L),Z&&ya(Z,b);const ce=tc(b,z,L.directiveStart+L.componentOffset,L);if(r[Fr]=b[Fr]=ce,null!==S)for(const xe of S)xe(ce,c);return Yp(z,L,r),ce}(KC,Ch,mg,zv,ao,[li]),C(Mi,ao,null)}finally{Q()}return new fn(this.componentType,Ms,dh(Zc,ao),ao,Zc)}}class fn extends Qm{constructor(c,d,v,b,S){super(),this.location=v,this._rootLView=b,this._tNode=S,this.previousInputValues=null,this.instance=d,this.hostView=this.changeDetectorRef=new Ft(b),this.componentType=c}setInput(c,d){const v=this._tNode.inputs;let b;if(null!==v&&(b=v[c])){if(this.previousInputValues??=new Map,this.previousInputValues.has(c)&&Object.is(this.previousInputValues.get(c),d))return;const S=this._rootLView;l(S[er],S,b,c,d),this.previousInputValues.set(c,d),Kf(_a(this._tNode.index,S))}}get injector(){return new Ga(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(c){this.hostView.onDestroy(c)}}function li(){const r=hs();vt(hn()[er],r)}function Ar(r){let c=function Rn(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),d=!0;const v=[r];for(;c;){let b;if(yt(r))b=c.\u0275cmp||c.\u0275dir;else{if(c.\u0275cmp)throw new Vn(903,!1);b=c.\u0275dir}if(b){if(d){v.push(b);const L=r;L.inputs=qi(r.inputs),L.inputTransforms=qi(r.inputTransforms),L.declaredInputs=qi(r.declaredInputs),L.outputs=qi(r.outputs);const z=b.hostBindings;z&&ss(r,z);const Z=b.viewQuery,ce=b.contentQueries;if(Z&&ui(r,Z),ce&&jr(r,ce),gt(r.inputs,b.inputs),gt(r.declaredInputs,b.declaredInputs),gt(r.outputs,b.outputs),null!==b.inputTransforms&&(null===L.inputTransforms&&(L.inputTransforms={}),gt(L.inputTransforms,b.inputTransforms)),yt(b)&&b.data.animation){const xe=r.data;xe.animation=(xe.animation||[]).concat(b.data.animation)}}const S=b.features;if(S)for(let L=0;L<S.length;L++){const z=S[L];z&&z.ngInherit&&z(r),z===Ar&&(d=!1)}}c=Object.getPrototypeOf(c)}!function ci(r){let c=0,d=null;for(let v=r.length-1;v>=0;v--){const b=r[v];b.hostVars=c+=b.hostVars,b.hostAttrs=Vr(b.hostAttrs,d=Vr(d,b.hostAttrs))}}(v)}function qi(r){return r===vr?{}:r===Cr?[]:r}function ui(r,c){const d=r.viewQuery;r.viewQuery=d?(v,b)=>{c(v,b),d(v,b)}:c}function jr(r,c){const d=r.contentQueries;r.contentQueries=d?(v,b,S)=>{c(v,b,S),d(v,b,S)}:c}function ss(r,c){const d=r.hostBindings;r.hostBindings=d?(v,b)=>{c(v,b),d(v,b)}:c}function No(r){const c=r.inputConfig,d={};for(const v in c)if(c.hasOwnProperty(v)){const b=c[v];Array.isArray(b)&&b[2]&&(d[v]=b[2])}r.inputTransforms=d}function Ns(r){return!!js(r)&&(Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r)}function js(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Hs(r,c,d){return r[c]=d}function Io(r,c,d){return!Object.is(r[c],d)&&(r[c]=d,!0)}function Fs(r,c,d,v){const b=Io(r,c,d);return Io(r,c+1,v)||b}function ll(r,c,d,v,b){const S=Fs(r,c,d,v);return Io(r,c+2,b)||S}function yc(r,c,d,v){const b=hn();return Io(b,Dc(),c)&&(no(),lu(we(),b,r,c,d,v)),yc}function qv(r,c,d,v,b,S,L,z){const Z=hn(),ce=no(),xe=r+Wr,je=ce.firstCreatePass?function bw(r,c,d,v,b,S,L,z,Z){const ce=c.consts,xe=_c(c,r,4,L||null,Va(ce,z));Gc(c,d,xe,Va(ce,Z)),vt(c,xe);const je=xe.tView=um(2,xe,v,b,S,c.directiveRegistry,c.pipeRegistry,null,c.schemas,ce,null);return null!==c.queries&&(c.queries.template(c,xe),je.queries=c.queries.embeddedTView(xe)),xe}(xe,ce,Z,c,d,v,b,S,L):ce.data[xe];ml(je,!1);const ht=Xv(ce,Z,je,r);tt()&&Xu(ce,Z,ht,je),ya(ht,Z),gf(Z,Z[xe]=ym(ht,Z,ht,je)),Ge(je)&&Kp(ce,Z,je),null!=L&&Jp(Z,je,z)}let Xv=function Yv(r,c,d,v){return Qe(!0),c[Or].createComment("")};function U_(r,c,d){const v=hn();return Io(v,Dc(),c)&&function vc(r,c,d,v,b,S,L,z){const Z=la(c,d);let xe,ce=c.inputs;!z&&null!=ce&&(xe=ce[v])?(l(r,d,xe,v,b),Ie(c)&&function ff(r,c){const d=_a(c,r);16&d[Dr]||(d[Dr]|=64)}(d,c.index)):3&c.type&&(v=function eg(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(v),b=null!=L?L(b,c.value||"",v):b,S.setProperty(Z,v,b))}(no(),we(),v,r,c,v[Or],d,!1),U_}function V_(r,c,d,v,b){const L=b?"class":"style";l(r,d,c.inputs[L],L,v)}function G0(r,c,d,v){const b=hn(),S=no(),L=Wr+r,z=b[Or],Z=S.firstCreatePass?function Tw(r,c,d,v,b,S){const L=c.consts,Z=_c(c,r,2,v,Va(L,b));return Gc(c,d,Z,Va(L,S)),null!==Z.attrs&&U(Z,Z.attrs,!1),null!==Z.mergedAttrs&&U(Z,Z.mergedAttrs,!0),null!==c.queries&&c.queries.elementStart(c,Z),Z}(L,S,b,c,d,v):S.data[L],ce=Kv(S,b,Z,z,c,r);b[L]=ce;const xe=Ge(Z);return ml(Z,!0),Mg(z,ce,Z),32!=(32&Z.flags)&&tt()&&Xu(S,b,ce,Z),0===function Ru(){return ei.lFrame.elementDepthCount}()&&ya(ce,b),function Cc(){ei.lFrame.elementDepthCount++}(),xe&&(Kp(S,b,Z),Yp(S,Z,b)),null!==v&&Jp(b,Z),G0}function $0(){let r=hs();Ma()?function Jl(){ei.lFrame.isParent=!1}():(r=r.parent,ml(r,!1));const c=r;(function pd(r){return ei.skipHydrationRootTNode===r})(c)&&function ca(){ei.skipHydrationRootTNode=null}(),function fd(){ei.lFrame.elementDepthCount--}();const d=no();return d.firstCreatePass&&(vt(d,r),le(r)&&d.queries.elementEnd(r)),null!=c.classesWithoutHost&&function Er(r){return 0!=(8&r.flags)}(c)&&V_(d,c,hn(),c.classesWithoutHost,!0),null!=c.stylesWithoutHost&&function Kr(r){return 0!=(16&r.flags)}(c)&&V_(d,c,hn(),c.stylesWithoutHost,!1),$0}function j_(r,c,d,v){return G0(r,c,d,v),$0(),j_}let Kv=(r,c,d,v,b,S)=>(Qe(!0),Fc(v,b,function Be(){return ei.lFrame.currentNamespace}()));function ey(){return hn()}function $_(r){return!!r&&"function"==typeof r.then}function ty(r){return!!r&&"function"==typeof r.subscribe}function W_(r,c,d,v){const b=hn(),S=no(),L=hs();return function ry(r,c,d,v,b,S,L){const z=Ge(v),ce=r.firstCreatePass&&xm(r),xe=c[Fr],je=og(c);let ht=!0;if(3&v.type||L){const Nn=la(v,c),cr=L?L(Nn):Nn,Ur=je.length,Tn=L?ao=>L(Do(ao[v.index])):v.index;let Mi=null;if(!L&&z&&(Mi=function Rw(r,c,d,v){const b=r.cleanup;if(null!=b)for(let S=0;S<b.length-1;S+=2){const L=b[S];if(L===d&&b[S+1]===v){const z=c[Aa],Z=b[S+2];return z.length>Z?z[Z]:null}"string"==typeof L&&(S+=2)}return null}(r,c,b,v.index)),null!==Mi)(Mi.__ngLastListenerFn__||Mi).__ngNextListenerFn__=S,Mi.__ngLastListenerFn__=S,ht=!1;else{S=oy(v,c,xe,S,!1);const ao=d.listen(cr,b,S);je.push(S,ao),ce&&ce.push(b,Tn,Ur,Ur+1)}}else S=oy(v,c,xe,S,!1);const Mt=v.outputs;let mn;if(ht&&null!==Mt&&(mn=Mt[b])){const Nn=mn.length;if(Nn)for(let cr=0;cr<Nn;cr+=2){const Ms=c[mn[cr]][mn[cr+1]].subscribe(S),Zc=je.length;je.push(S,Ms),ce&&ce.push(b,v.index,Zc,-(Zc+1))}}}(S,b,b[Or],L,r,c,v),W_}function iy(r,c,d,v){try{return il(6,c,d),!1!==d(v)}catch(b){return t(r,b),!1}finally{il(7,c,d)}}function oy(r,c,d,v,b){return function S(L){if(L===Function)return v;Kf(r.componentOffset>-1?_a(r.index,c):c);let Z=iy(c,d,v,L),ce=S.__ngNextListenerFn__;for(;ce;)Z=iy(c,d,ce,L)&&Z,ce=ce.__ngNextListenerFn__;return b&&!1===Z&&L.preventDefault(),Z}}function sy(r=1){return function J(r){return(ei.lFrame.contextLView=function de(r,c){for(;r>0;)c=c[Xr],r--;return c}(r,ei.lFrame.contextLView))[Fr]}(r)}function W0(r,c){return r<<17|c<<2}function mf(r){return r>>17&32767}function q_(r){return 2|r}function rp(r){return(131068&r)>>2}function X_(r,c){return-131069&r|c<<2}function Y_(r){return 1|r}function my(r,c,d,v,b){const S=r[d+1],L=null===c;let z=v?mf(S):rp(S),Z=!1;for(;0!==z&&(!1===Z||L);){const xe=r[z+1];jw(r[z],c)&&(Z=!0,r[z+1]=v?Y_(xe):q_(xe)),z=v?mf(xe):rp(xe)}Z&&(r[d+1]=v?q_(S):Y_(S))}function jw(r,c){return null===r||null==c||(Array.isArray(r)?r[1]:r)===c||!(!Array.isArray(r)||"string"!=typeof c)&&dc(r,c)>=0}function K_(r,c,d){return ad(r,c,d,!1),K_}function J_(r,c){return ad(r,c,null,!0),J_}function ad(r,c,d,v){const b=hn(),S=no(),L=Gl(2);S.firstUpdatePass&&function Cy(r,c,d,v){const b=r.data;if(null===b[d+1]){const S=b[ye()],L=function Ey(r,c){return c>=r.expandoStartIndex}(r,d);(function Sy(r,c){return 0!=(r.flags&(c?8:16))})(S,v)&&null===c&&!L&&(c=!1),c=function Kw(r,c,d,v){const b=function se(r){const c=ei.lFrame.currentDirectiveIndex;return-1===c?null:r[c]}(r);let S=v?c.residualClasses:c.residualStyles;if(null===b)0===(v?c.classBindings:c.styleBindings)&&(d=Am(d=Q_(null,r,c,d,v),c.attrs,v),S=null);else{const L=c.directiveStylingLast;if(-1===L||r[L]!==b)if(d=Q_(b,r,c,d,v),null===S){let Z=function Jw(r,c,d){const v=d?c.classBindings:c.styleBindings;if(0!==rp(v))return r[mf(v)]}(r,c,v);void 0!==Z&&Array.isArray(Z)&&(Z=Q_(null,r,c,Z[1],v),Z=Am(Z,c.attrs,v),function Qw(r,c,d,v){r[mf(d?c.classBindings:c.styleBindings)]=v}(r,c,v,Z))}else S=function eb(r,c,d){let v;const b=c.directiveEnd;for(let S=1+c.directiveStylingLast;S<b;S++)v=Am(v,r[S].hostAttrs,d);return Am(v,c.attrs,d)}(r,c,v)}return void 0!==S&&(v?c.residualClasses=S:c.residualStyles=S),d}(b,S,c,v),function Uw(r,c,d,v,b,S){let L=S?c.classBindings:c.styleBindings,z=mf(L),Z=rp(L);r[v]=d;let xe,ce=!1;if(Array.isArray(d)?(xe=d[1],(null===xe||dc(d,xe)>0)&&(ce=!0)):xe=d,b)if(0!==Z){const ht=mf(r[z+1]);r[v+1]=W0(ht,z),0!==ht&&(r[ht+1]=X_(r[ht+1],v)),r[z+1]=function Bw(r,c){return 131071&r|c<<17}(r[z+1],v)}else r[v+1]=W0(z,0),0!==z&&(r[z+1]=X_(r[z+1],v)),z=v;else r[v+1]=W0(Z,0),0===z?z=v:r[Z+1]=X_(r[Z+1],v),Z=v;ce&&(r[v+1]=q_(r[v+1])),my(r,xe,v,!0),my(r,xe,v,!1),function Vw(r,c,d,v,b){const S=b?r.residualClasses:r.residualStyles;null!=S&&"string"==typeof c&&dc(S,c)>=0&&(d[v+1]=Y_(d[v+1]))}(c,xe,r,v,S),L=W0(z,Z),S?c.classBindings=L:c.styleBindings=L}(b,S,c,d,L,v)}}(S,r,L,v),c!==Li&&Io(b,L,c)&&function Dy(r,c,d,v,b,S,L,z){if(!(3&c.type))return;const Z=r.data,ce=Z[z+1],xe=function zw(r){return 1==(1&r)}(ce)?Ty(Z,c,d,b,rp(ce),L):void 0;Z0(xe)||(Z0(S)||function Fw(r){return 2==(2&r)}(ce)&&(S=Ty(Z,null,d,b,z,L)),function Yu(r,c,d,v,b){if(c)b?r.addClass(d,v):r.removeClass(d,v);else{let S=-1===v.indexOf("-")?void 0:wu.DashCase;null==b?r.removeStyle(d,v,S):("string"==typeof b&&b.endsWith("!important")&&(b=b.slice(0,-10),S|=wu.Important),r.setStyle(d,v,b,S))}}(v,L,Hl(ye(),d),b,S))}(S,S.data[ye()],b,b[Or],r,b[L+1]=function ib(r,c){return null==r||""===r||("string"==typeof c?r+=c:"object"==typeof r&&(r=ln(w(r)))),r}(c,d),v,L)}function Q_(r,c,d,v,b){let S=null;const L=d.directiveEnd;let z=d.directiveStylingLast;for(-1===z?z=d.directiveStart:z++;z<L&&(S=c[z],v=Am(v,S.hostAttrs,b),S!==r);)z++;return null!==r&&(d.directiveStylingLast=z),v}function Am(r,c,d){const v=d?1:2;let b=-1;if(null!==c)for(let S=0;S<c.length;S++){const L=c[S];"number"==typeof L?b=L:b===v&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),Wi(r,L,!!d||c[++S]))}return void 0===r?null:r}function Ty(r,c,d,v,b,S){const L=null===c;let z;for(;b>0;){const Z=r[b],ce=Array.isArray(Z),xe=ce?Z[1]:Z,je=null===xe;let ht=d[b+1];ht===Li&&(ht=je?Cr:void 0);let Mt=je?eu(ht,v):xe===v?ht:void 0;if(ce&&!Z0(Mt)&&(Mt=eu(Z,v)),Z0(Mt)&&(z=Mt,L))return z;const mn=r[b+1];b=L?mf(mn):rp(mn)}if(null!==c){let Z=S?c.residualClasses:c.residualStyles;null!=Z&&(z=eu(Z,v))}return z}function Z0(r){return void 0!==r}function Iy(r,c=""){const d=hn(),v=no(),b=r+Wr,S=v.firstCreatePass?_c(v,b,1,c,null):v.data[b],L=My(v,d,S,c,r);d[b]=L,tt()&&Xu(v,d,L,S),ml(S,!1)}let My=(r,c,d,v,b)=>(Qe(!0),function kc(r,c){return r.createText(c)}(c[Or],v));function ev(r){return q0("",r,""),ev}function q0(r,c,d){const v=hn(),b=function Ou(r,c,d,v){return Io(r,Dc(),d)?c+Ln(d)+v:Li}(v,r,c,d);return b!==Li&&h(v,ye(),b),q0}function tv(r,c,d,v,b){const S=hn(),L=function Pu(r,c,d,v,b,S){const z=Fs(r,kl(),d,b);return Gl(2),z?c+Ln(d)+v+Ln(b)+S:Li}(S,r,c,d,v,b);return L!==Li&&h(S,ye(),L),tv}function nv(r,c,d,v,b,S,L){const z=hn(),Z=function yh(r,c,d,v,b,S,L,z){const ce=ll(r,kl(),d,b,L);return Gl(3),ce?c+Ln(d)+v+Ln(b)+S+Ln(L)+z:Li}(z,r,c,d,v,b,S,L);return Z!==Li&&h(z,ye(),Z),nv}const ip=void 0;var Db=["en",[["a","p"],["AM","PM"],ip],[["AM","PM"],ip,ip],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ip,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ip,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ip,"{1} 'at' {0}",ip],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Ab(r){const d=Math.floor(Math.abs(r)),v=r.toString().replace(/^[^.]*\.?/,"").length;return 1===d&&0===v?1:5}];let ug={};function rv(r){const c=function Tb(r){return r.toLowerCase().replace(/_/g,"-")}(r);let d=Xy(c);if(d)return d;const v=c.split("-")[0];if(d=Xy(v),d)return d;if("en"===v)return Db;throw new Vn(701,!1)}function qy(r){return rv(r)[dg.PluralCase]}function Xy(r){return r in ug||(ug[r]=Oe.ng&&Oe.ng.common&&Oe.ng.common.locales&&Oe.ng.common.locales[r]),ug[r]}var dg=function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r}(dg||{});const hg="en-US";let Yy=hg;function sv(r,c,d,v,b){if(r=dn(r),Array.isArray(r))for(let S=0;S<r.length;S++)sv(r[S],c,d,v,b);else{const S=no(),L=hn(),z=hs();let Z=Od(r)?r:dn(r.provide);const ce=ch(r),xe=1048575&z.providerIndexes,je=z.directiveStart,ht=z.providerIndexes>>20;if(Od(r)||!r.multi){const Mt=new It(ce,b,hf),mn=lv(Z,c,b?xe:xe+ht,je);-1===mn?(Po(ho(z,L),S,Z),av(S,r,c.length),c.push(Z),z.directiveStart++,z.directiveEnd++,b&&(z.providerIndexes+=1048576),d.push(Mt),L.push(Mt)):(d[mn]=Mt,L[mn]=Mt)}else{const Mt=lv(Z,c,xe+ht,je),mn=lv(Z,c,xe,xe+ht),cr=mn>=0&&d[mn];if(b&&!cr||!b&&!(Mt>=0&&d[Mt])){Po(ho(z,L),S,Z);const Ur=function A2(r,c,d,v,b){const S=new It(r,d,hf);return S.multi=[],S.index=c,S.componentProviders=0,w1(S,b,v&&!d),S}(b?C2:E2,d.length,b,v,ce);!b&&cr&&(d[mn].providerFactory=Ur),av(S,r,c.length,0),c.push(Z),z.directiveStart++,z.directiveEnd++,b&&(z.providerIndexes+=1048576),d.push(Ur),L.push(Ur)}else av(S,r,Mt>-1?Mt:mn,w1(d[b?mn:Mt],ce,!b&&v));!b&&v&&cr&&d[mn].componentProviders++}}}function av(r,c,d,v){const b=Od(c),S=function p_(r){return!!r.useClass}(c);if(b||S){const Z=(S?dn(c.useClass):c).prototype.ngOnDestroy;if(Z){const ce=r.destroyHooks||(r.destroyHooks=[]);if(!b&&c.multi){const xe=ce.indexOf(d);-1===xe?ce.push(d,[v,Z]):ce[xe+1].push(v,Z)}else ce.push(d,Z)}}}function w1(r,c,d){return d&&r.componentProviders++,r.multi.push(c)-1}function lv(r,c,d,v){for(let b=d;b<v;b++)if(c[b]===r)return b;return-1}function E2(r,c,d,v){return cv(this.multi,[])}function C2(r,c,d,v){const b=this.multi;let S;if(this.providerFactory){const L=this.providerFactory.componentProviders,z=tc(d,d[er],this.providerFactory.index,v);S=z.slice(0,L),cv(b,S);for(let Z=L;Z<z.length;Z++)S.push(z[Z])}else S=[],cv(b,S);return S}function cv(r,c){for(let d=0;d<r.length;d++)c.push((0,r[d])());return c}function b1(r,c=[]){return d=>{d.providersResolver=(v,b)=>function b2(r,c,d){const v=no();if(v.firstCreatePass){const b=yt(r);sv(d,v.data,v.blueprint,b,!0),sv(c,v.data,v.blueprint,b,!1)}}(v,b?b(r):r,c)}}class op{}class E1{}function D2(r,c){return new uv(r,c??null,[])}class uv extends op{constructor(c,d,v){super(),this._parent=d,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Rt(this);const b=Qi(c);this._bootstrapComponents=od(b.bootstrap),this._r3Injector=d0(c,d,[{provide:op,useValue:this},{provide:Uc,useValue:this.componentFactoryResolver},...v],ln(c),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(c)}get injector(){return this._r3Injector}destroy(){const c=this._r3Injector;!c.destroyed&&c.destroy(),this.destroyCbs.forEach(d=>d()),this.destroyCbs=null}onDestroy(c){this.destroyCbs.push(c)}}class dv extends E1{constructor(c){super(),this.moduleType=c}create(c){return new uv(this.moduleType,c,[])}}class C1 extends op{constructor(c){super(),this.componentFactoryResolver=new Rt(this),this.instance=null;const d=new wa([...c.providers,{provide:op,useValue:this},{provide:Uc,useValue:this.componentFactoryResolver}],c.parent||zf(),c.debugName,new Set(["environment"]));this.injector=d,c.runEnvironmentInitializers&&d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(c){this.injector.onDestroy(c)}}function A1(r,c,d=null){return new C1({providers:r,parent:c,debugName:d,runEnvironmentInitializers:!0}).injector}let S2=(()=>{class r{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){const v=Wm(0,d.type),b=v.length>0?A1([v],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,b)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(const d of this.cachedInjectors.values())null!==d&&d.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=xi({token:r,providedIn:"environment",factory:()=>new r(In(Su))})}return r})();function D1(r){r.getStandaloneInjector=c=>c.get(S2).getOrCreateStandaloneInjector(r)}function R1(r,c,d,v){return L1(hn(),Ha(),r,c,d,v)}function Om(r,c){const d=r[c];return d===Li?void 0:d}function L1(r,c,d,v,b,S){const L=c+d;return Io(r,L,b)?Hs(r,L+1,S?v.call(S,b):v(b)):Om(r,L+1)}function z1(r,c){const d=no();let v;const b=r+Wr;d.firstCreatePass?(v=function W2(r,c){if(c)for(let d=c.length-1;d>=0;d--){const v=c[d];if(r===v.name)return v}}(c,d.pipeRegistry),d.data[b]=v,v.onDestroy&&(d.destroyHooks??=[]).push(b,v.onDestroy)):v=d.data[b];const S=v.factory||(v.factory=vo(v.type)),z=ge(hf);try{const Z=uo(!1),ce=S();return uo(Z),function Aw(r,c,d,v){d>=r.data.length&&(r.data[d]=null,r.blueprint[d]=null),c[d]=v}(d,hn(),b,ce),ce}finally{ge(z)}}function U1(r,c,d){const v=r+Wr,b=hn(),S=Al(b,v);return Pm(b,v)?L1(b,Ha(),c,S.transform,d,S):S.transform(d)}function V1(r,c,d,v){const b=r+Wr,S=hn(),L=Al(S,b);return Pm(S,b)?function N1(r,c,d,v,b,S,L){const z=c+d;return Fs(r,z,b,S)?Hs(r,z+2,L?v.call(L,b,S):v(b,S)):Om(r,z+2)}(S,Ha(),c,L.transform,d,v,L):L.transform(d,v)}function j1(r,c,d,v,b){const S=r+Wr,L=hn(),z=Al(L,S);return Pm(L,S)?function k1(r,c,d,v,b,S,L,z){const Z=c+d;return ll(r,Z,b,S,L)?Hs(r,Z+3,z?v.call(z,b,S,L):v(b,S,L)):Om(r,Z+3)}(L,Ha(),c,z.transform,d,v,b,z):z.transform(d,v,b)}function Pm(r,c){return r[er].data[c].pure}function X2(){return this._results[Symbol.iterator]()}class fv{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new Pl)}constructor(c=!1){this._emitDistinctChangesOnly=c,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const d=fv.prototype;d[Symbol.iterator]||(d[Symbol.iterator]=X2)}get(c){return this._results[c]}map(c){return this._results.map(c)}filter(c){return this._results.filter(c)}find(c){return this._results.find(c)}reduce(c,d){return this._results.reduce(c,d)}forEach(c){this._results.forEach(c)}some(c){return this._results.some(c)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(c,d){const v=this;v.dirty=!1;const b=function nc(r){return r.flat(Number.POSITIVE_INFINITY)}(c);(this._changesDetected=!function lp(r,c,d){if(r.length!==c.length)return!1;for(let v=0;v<r.length;v++){let b=r[v],S=c[v];if(d&&(b=d(b),S=d(S)),S!==b)return!1}return!0}(v._results,b,d))&&(v._results=b,v.length=b.length,v.last=b[this.length-1],v.first=b[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function K2(r,c,d,v=!0){const b=c[er];if(function Uh(r,c,d,v){const b=us+v,S=d.length;v>0&&(d[b-1][cs]=c),v<S-us?(c[cs]=d[b],Tr(d,us+v,c)):(d.push(c),c[cs]=null),c[ni]=d;const L=c[na];null!==L&&d!==L&&function Bc(r,c){const d=r[Ua];c[lo]!==c[ni][ni][lo]&&(r[za]=!0),null===d?r[Ua]=[c]:d.push(c)}(L,c);const z=c[Es];null!==z&&z.insertView(r),c[Dr]|=128}(b,c,r,d),v){const S=Tu(d,r),L=c[Or],z=Hh(L,r[oa]);null!==z&&function Cu(r,c,d,v,b,S){v[mi]=b,v[Co]=c,rh(r,v,d,1,b,S)}(b,r[Co],L,c,z,S)}}let Rm=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=eE}return r})();const J2=Rm,Q2=class extends J2{constructor(c,d,v){super(),this._declarationLView=c,this._declarationTContainer=d,this.elementRef=v}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(c,d){return this.createEmbeddedViewImpl(c,d)}createEmbeddedViewImpl(c,d,v){const b=function Y2(r,c,d,v){const b=c.tView,z=mc(r,b,d,4096&r[Dr]?4096:16,null,c,null,null,null,v?.injector??null,v?.hydrationInfo??null);z[na]=r[c.index];const ce=r[Es];return null!==ce&&(z[Es]=ce.createEmbeddedView(b)),C(b,z,d),z}(this._declarationLView,this._declarationTContainer,c,{injector:d,hydrationInfo:v});return new Xe(b)}};function eE(){return Q0(hs(),hn())}function Q0(r,c){return 4&r.type?new Q2(c,r,dh(r,c)):null}let t_=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=sE}return r})();function sE(){return X1(hs(),hn())}const aE=t_,Z1=class extends aE{constructor(c,d,v){super(),this._lContainer=c,this._hostTNode=d,this._hostLView=v}get element(){return dh(this._hostTNode,this._hostLView)}get injector(){return new Ga(this._hostTNode,this._hostLView)}get parentInjector(){const c=va(this._hostTNode,this._hostLView);if(_i(c)){const d=Gi(c,this._hostLView),v=oi(c);return new Ga(d[er].data[v+8],d)}return new Ga(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(c){const d=q1(this._lContainer);return null!==d&&d[c]||null}get length(){return this._lContainer.length-us}createEmbeddedView(c,d,v){let b,S;"number"==typeof v?b=v:null!=v&&(b=v.index,S=v.injector);const z=c.createEmbeddedViewImpl(d||{},S,null);return this.insertImpl(z,b,false),z}createComponent(c,d,v,b,S){const L=c&&!function Sl(r){return"function"==typeof r}(c);let z;if(L)z=d;else{const Nn=d||{};z=Nn.index,v=Nn.injector,b=Nn.projectableNodes,S=Nn.environmentInjector||Nn.ngModuleRef}const Z=L?c:new cn(zr(c)),ce=v||this.parentInjector;if(!S&&null==Z.ngModule){const cr=(L?ce:this.parentInjector).get(Su,null);cr&&(S=cr)}zr(Z.componentType??{});const Mt=Z.create(ce,b,null,S);return this.insertImpl(Mt.hostView,z,false),Mt}insert(c,d){return this.insertImpl(c,d,!1)}insertImpl(c,d,v){const b=c._lView;if(function hu(r){return K(r[ni])}(b)){const Z=this.indexOf(c);if(-1!==Z)this.detach(Z);else{const ce=b[ni],xe=new Z1(ce,ce[Co],ce[ni]);xe.detach(xe.indexOf(c))}}const L=this._adjustIndex(d),z=this._lContainer;return K2(z,b,L,!v),c.attachToViewContainerRef(),Tr(pv(z),L,c),c}move(c,d){return this.insert(c,d)}indexOf(c){const d=q1(this._lContainer);return null!==d?d.indexOf(c):-1}remove(c){const d=this._adjustIndex(c,-1),v=qu(this._lContainer,d);v&&(uc(pv(this._lContainer),d),jh(v[er],v))}detach(c){const d=this._adjustIndex(c,-1),v=qu(this._lContainer,d);return v&&null!=uc(pv(this._lContainer),d)?new Xe(v):null}_adjustIndex(c,d=0){return c??this.length+d}};function q1(r){return r[8]}function pv(r){return r[8]||(r[8]=[])}function X1(r,c){let d;const v=c[r.index];return K(v)?d=v:(d=ym(v,c,null,r),c[r.index]=d,gf(c,d)),Y1(d,c,r,v),new Z1(d,r,c)}let Y1=function K1(r,c,d,v){if(r[oa])return;let b;b=8&d.type?Do(v):function lE(r,c){const d=r[Or],v=d.createComment(""),b=la(c,r);return Du(d,Hh(d,b),v,function xp(r,c){return r.nextSibling(c)}(d,b),!1),v}(c,d),r[oa]=b};class gv{constructor(c){this.queryList=c,this.matches=null}clone(){return new gv(this.queryList)}setDirty(){this.queryList.setDirty()}}class mv{constructor(c=[]){this.queries=c}createEmbeddedView(c){const d=c.queries;if(null!==d){const v=null!==c.contentQueries?c.contentQueries[0]:d.length,b=[];for(let S=0;S<v;S++){const L=d.getByIndex(S);b.push(this.queries[L.indexInDeclarationView].clone())}return new mv(b)}return null}insertView(c){this.dirtyQueriesWithMatches(c)}detachView(c){this.dirtyQueriesWithMatches(c)}dirtyQueriesWithMatches(c){for(let d=0;d<this.queries.length;d++)null!==sx(c,d).matches&&this.queries[d].setDirty()}}class J1{constructor(c,d,v=null){this.predicate=c,this.flags=d,this.read=v}}class _v{constructor(c=[]){this.queries=c}elementStart(c,d){for(let v=0;v<this.queries.length;v++)this.queries[v].elementStart(c,d)}elementEnd(c){for(let d=0;d<this.queries.length;d++)this.queries[d].elementEnd(c)}embeddedTView(c){let d=null;for(let v=0;v<this.length;v++){const b=null!==d?d.length:0,S=this.getByIndex(v).embeddedTView(c,b);S&&(S.indexInDeclarationView=v,null!==d?d.push(S):d=[S])}return null!==d?new _v(d):null}template(c,d){for(let v=0;v<this.queries.length;v++)this.queries[v].template(c,d)}getByIndex(c){return this.queries[c]}get length(){return this.queries.length}track(c){this.queries.push(c)}}class vv{constructor(c,d=-1){this.metadata=c,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=d}elementStart(c,d){this.isApplyingToNode(d)&&this.matchTNode(c,d)}elementEnd(c){this._declarationNodeIndex===c.index&&(this._appliesToNextNode=!1)}template(c,d){this.elementStart(c,d)}embeddedTView(c,d){return this.isApplyingToNode(c)?(this.crossesNgTemplate=!0,this.addMatch(-c.index,d),new vv(this.metadata)):null}isApplyingToNode(c){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const d=this._declarationNodeIndex;let v=c.parent;for(;null!==v&&8&v.type&&v.index!==d;)v=v.parent;return d===(null!==v?v.index:-1)}return this._appliesToNextNode}matchTNode(c,d){const v=this.metadata.predicate;if(Array.isArray(v))for(let b=0;b<v.length;b++){const S=v[b];this.matchTNodeWithReadOption(c,d,dE(d,S)),this.matchTNodeWithReadOption(c,d,ec(d,c,S,!1,!1))}else v===Rm?4&d.type&&this.matchTNodeWithReadOption(c,d,-1):this.matchTNodeWithReadOption(c,d,ec(d,c,v,!1,!1))}matchTNodeWithReadOption(c,d,v){if(null!==v){const b=this.metadata.read;if(null!==b)if(b===rf||b===t_||b===Rm&&4&d.type)this.addMatch(d.index,-2);else{const S=ec(d,c,b,!1,!1);null!==S&&this.addMatch(d.index,S)}else this.addMatch(d.index,v)}}addMatch(c,d){null===this.matches?this.matches=[c,d]:this.matches.push(c,d)}}function dE(r,c){const d=r.localNames;if(null!==d)for(let v=0;v<d.length;v+=2)if(d[v]===c)return d[v+1];return null}function fE(r,c,d,v){return-1===d?function hE(r,c){return 11&r.type?dh(r,c):4&r.type?Q0(r,c):null}(c,r):-2===d?function pE(r,c,d){return d===rf?dh(c,r):d===Rm?Q0(c,r):d===t_?X1(c,r):void 0}(r,c,v):tc(r,r[er],d,c)}function Q1(r,c,d,v){const b=c[Es].queries[v];if(null===b.matches){const S=r.data,L=d.matches,z=[];for(let Z=0;Z<L.length;Z+=2){const ce=L[Z];z.push(ce<0?null:fE(c,S[ce],L[Z+1],d.metadata.read))}b.matches=z}return b.matches}function yv(r,c,d,v){const b=r.queries.getByIndex(d),S=b.matches;if(null!==S){const L=Q1(r,c,b,d);for(let z=0;z<S.length;z+=2){const Z=S[z];if(Z>0)v.push(L[z/2]);else{const ce=S[z+1],xe=c[-Z];for(let je=us;je<xe.length;je++){const ht=xe[je];ht[na]===ht[ni]&&yv(ht[er],ht,ce,v)}if(null!==xe[Ua]){const je=xe[Ua];for(let ht=0;ht<je.length;ht++){const Mt=je[ht];yv(Mt[er],Mt,ce,v)}}}}}return v}function ex(r){const c=hn(),d=no(),v=_();i(v+1);const b=sx(d,v);if(r.dirty&&function cd(r){return 4==(4&r[Dr])}(c)===(2==(2&b.metadata.flags))){if(null===b.matches)r.reset([]);else{const S=b.crossesNgTemplate?yv(d,c,v,[]):Q1(d,c,b,v);r.reset(S,n0),r.notifyOnChanges()}return!0}return!1}function tx(r,c,d){const v=no();v.firstCreatePass&&(ox(v,new J1(r,c,d),-1),2==(2&c)&&(v.staticViewQueries=!0)),ix(v,hn(),c)}function nx(r,c,d,v){const b=no();if(b.firstCreatePass){const S=hs();ox(b,new J1(c,d,v),S.index),function mE(r,c){const d=r.contentQueries||(r.contentQueries=[]);c!==(d.length?d[d.length-1]:-1)&&d.push(r.queries.length-1,c)}(b,r),2==(2&d)&&(b.staticContentQueries=!0)}ix(b,hn(),d)}function rx(){return function gE(r,c){return r[Es].queries[c].queryList}(hn(),_())}function ix(r,c,d){const v=new fv(4==(4&d));(function M0(r,c,d,v){const b=og(c);b.push(d),r.firstCreatePass&&xm(r).push(v,b.length-1)})(r,c,v,v.destroy),null===c[Es]&&(c[Es]=new mv),c[Es].queries.push(new gv(v))}function ox(r,c,d){null===r.queries&&(r.queries=new _v),r.queries.track(new vv(c,d))}function sx(r,c){return r.queries.getByIndex(c)}function xv(r){return!!Qi(r)}const Ex=new Si("Application Initializer");let Av=(()=>{class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,v)=>{this.resolve=d,this.reject=v}),this.appInits=br(Ex,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const d=[];for(const b of this.appInits){const S=b();if($_(S))d.push(S);else if(ty(S)){const L=new Promise((z,Z)=>{S.subscribe({complete:z,error:Z})});d.push(L)}}const v=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{v()}).catch(b=>{this.reject(b)}),0===d.length&&v(),this.initialized=!0}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),Cx=(()=>{class r{log(d){console.log(d)}warn(d){console.warn(d)}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();const r_=new Si("LocaleId",{providedIn:"root",factory:()=>br(r_,nr.Optional|nr.SkipSelf)||function BE(){return typeof $localize<"u"&&$localize.locale||hg}()}),zE=new Si("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});let Ax=(()=>{class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ft.X(!1)}add(){this.hasPendingTasks.next(!0);const d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();class VE{constructor(c,d){this.ngModuleFactory=c,this.componentFactories=d}}let jE=(()=>{class r{compileModuleSync(d){return new dv(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){const v=this.compileModuleSync(d),S=od(Qi(d).declarations).reduce((L,z)=>{const Z=zr(z);return Z&&L.push(new cn(Z)),L},[]);return new VE(v,S)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const Ix=new Si(""),Mx=new Si("");let Sv,lC=(()=>{class r{constructor(d,v,b){this._ngZone=d,this.registry=v,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Sv||(function cC(r){Sv=r}(b),b.addToWindow(v)),this._watchAngularEvents(),d.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Wa.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let d=this._callbacks.pop();clearTimeout(d.timeoutId),d.doneCb(this._didWork)}this._didWork=!1});else{let d=this.getPendingTasks();this._callbacks=this._callbacks.filter(v=>!v.updateCb||!v.updateCb(d)||(clearTimeout(v.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(d=>({source:d.source,creationLocation:d.creationLocation,data:d.data})):[]}addCallback(d,v,b){let S=-1;v&&v>0&&(S=setTimeout(()=>{this._callbacks=this._callbacks.filter(L=>L.timeoutId!==S),d(this._didWork,this.getPendingTasks())},v)),this._callbacks.push({doneCb:d,timeoutId:S,updateCb:b})}whenStable(d,v,b){if(b&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(d,v,b),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(d){this.registry.registerApplication(d,this)}unregisterApplication(d){this.registry.unregisterApplication(d)}findProviders(d,v,b){return[]}static#e=this.\u0275fac=function(v){return new(v||r)(In(Wa),In(Ox),In(Mx))};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac})}return r})(),Ox=(()=>{class r{constructor(){this._applications=new Map}registerApplication(d,v){this._applications.set(d,v)}unregisterApplication(d){this._applications.delete(d)}unregisterAllApplications(){this._applications.clear()}getTestability(d){return this._applications.get(d)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(d,v=!0){return Sv?.findTestabilityInTree(this,d,v)??null}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})(),_f=null;const Px=new Si("AllowMultipleToken"),Iv=new Si("PlatformDestroyListeners"),Mv=new Si("appBootstrapListener");class hC{constructor(c,d){this.name=c,this.token=d}}function Nx(r,c,d=[]){const v=`Platform: ${c}`,b=new Si(v);return(S=[])=>{let L=Ov();if(!L||L.injector.get(Px,!1)){const z=[...d,...S,{provide:b,useValue:!0}];r?r(z):function fC(r){if(_f&&!_f.get(Px,!1))throw new Vn(400,!1);(function Rx(){!function Gt(r){fe=r}(()=>{throw new Vn(600,!1)})})(),_f=r;const c=r.get(Fx);(function Lx(r){r.get(Gg,null)?.forEach(d=>d())})(r)}(function kx(r=[],c){return su.create({name:c,providers:[{provide:zg,useValue:"platform"},{provide:Iv,useValue:new Set([()=>_f=null])},...r]})}(z,v))}return function gC(r){const c=Ov();if(!c)throw new Vn(401,!1);return c}()}}function Ov(){return _f?.get(Fx)??null}let Fx=(()=>{class r{constructor(d){this._injector=d,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(d,v){const b=function mC(r="zone.js",c){return"noop"===r?new Yf:"zone.js"===r?new Wa(c):r}(v?.ngZone,function Bx(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}({eventCoalescing:v?.ngZoneEventCoalescing,runCoalescing:v?.ngZoneRunCoalescing}));return b.run(()=>{const S=function T2(r,c,d){return new uv(r,c,d)}(d.moduleType,this.injector,function Hx(r){return[{provide:Wa,useFactory:r},{provide:td,multi:!0,useFactory:()=>{const c=br(vC,{optional:!0});return()=>c.initialize()}},{provide:jx,useFactory:_C},{provide:cf,useFactory:uf}]}(()=>b)),L=S.injector.get(Rd,null);return b.runOutsideAngular(()=>{const z=b.onError.subscribe({next:Z=>{L.handleError(Z)}});S.onDestroy(()=>{o_(this._modules,S),z.unsubscribe()})}),function zx(r,c,d){try{const v=d();return $_(v)?v.catch(b=>{throw c.runOutsideAngular(()=>r.handleError(b)),b}):v}catch(v){throw c.runOutsideAngular(()=>r.handleError(v)),v}}(L,b,()=>{const z=S.injector.get(Av);return z.runInitializers(),z.donePromise.then(()=>(function Ky(r){Ni(r,"Expected localeId to be defined"),"string"==typeof r&&(Yy=r.toLowerCase().replace(/_/g,"-"))}(S.injector.get(r_,hg)||hg),this._moduleDoBootstrap(S),S))})})}bootstrapModule(d,v=[]){const b=Ux({},v);return function uC(r,c,d){const v=new dv(d);return Promise.resolve(v)}(0,0,d).then(S=>this.bootstrapModuleFactory(S,b))}_moduleDoBootstrap(d){const v=d.injector.get(gg);if(d._bootstrapComponents.length>0)d._bootstrapComponents.forEach(b=>v.bootstrap(b));else{if(!d.instance.ngDoBootstrap)throw new Vn(-403,!1);d.instance.ngDoBootstrap(v)}this._modules.push(d)}onDestroy(d){this._destroyListeners.push(d)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Vn(404,!1);this._modules.slice().forEach(v=>v.destroy()),this._destroyListeners.forEach(v=>v());const d=this._injector.get(Iv,null);d&&(d.forEach(v=>v()),d.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(v){return new(v||r)(In(su))};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();function Ux(r,c){return Array.isArray(c)?c.reduce(Ux,r):{...r,...c}}let gg=(()=>{class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=br(jx),this.zoneIsStable=br(cf),this.componentTypes=[],this.components=[],this.isStable=br(Ax).hasPendingTasks.pipe((0,jn.w)(d=>d?(0,it.of)(!1):this.zoneIsStable),function Xt(r,c=Jn.y){return r=r??rr,(0,Bt.e)((d,v)=>{let b,S=!0;d.subscribe((0,mr.x)(v,L=>{const z=c(L);(S||!r(b,z))&&(S=!1,b=z,v.next(L))}))})}(),zt()),this._injector=br(Su)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,v){const b=d instanceof em;if(!this._injector.get(Av).done)throw!b&&es(d),new Vn(405,!1);let L;L=b?d:this._injector.get(Uc).resolveComponentFactory(d),this.componentTypes.push(L.componentType);const z=function dC(r){return r.isBoundToModule}(L)?void 0:this._injector.get(op),ce=L.create(su.NULL,[],v||L.selector,z),xe=ce.location.nativeElement,je=ce.injector.get(Ix,null);return je?.registerApplication(xe),ce.onDestroy(()=>{this.detachView(ce.hostView),o_(this.components,ce),je?.unregisterApplication(xe)}),this._loadComponent(ce),ce}tick(){if(this._runningTick)throw new Vn(101,!1);try{this._runningTick=!0;for(let d of this._views)d.detectChanges()}catch(d){this.internalErrorHandler(d)}finally{this._runningTick=!1}}attachView(d){const v=d;this._views.push(v),v.attachToAppRef(this)}detachView(d){const v=d;o_(this._views,v),v.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);const v=this._injector.get(Mv,[]);v.push(...this._bootstrapListeners),v.forEach(b=>b(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>o_(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new Vn(406,!1);const d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function o_(r,c){const d=r.indexOf(c);d>-1&&r.splice(d,1)}const jx=new Si("",{providedIn:"root",factory:()=>br(Rd).handleError.bind(void 0)});function _C(){const r=br(Wa),c=br(Rd);return d=>r.runOutsideAngular(()=>c.handleError(d))}let vC=(()=>{class r{constructor(){this.zone=br(Wa),this.applicationRef=br(gg)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(v){return new(v||r)};static#t=this.\u0275prov=xi({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();let xC=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=wC}return r})();function wC(r){return function bC(r,c,d){if(Ie(r)&&!d){const v=_a(r.index,c);return new Xe(v,v)}return 47&r.type?new Xe(c[lo],c):null}(hs(),hn(),16==(16&r))}class Zx{constructor(){}supports(c){return Ns(c)}create(c){return new SC(c)}}const TC=(r,c)=>c;class SC{constructor(c){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=c||TC}forEachItem(c){let d;for(d=this._itHead;null!==d;d=d._next)c(d)}forEachOperation(c){let d=this._itHead,v=this._removalsHead,b=0,S=null;for(;d||v;){const L=!v||d&&d.currentIndex<Xx(v,b,S)?d:v,z=Xx(L,b,S),Z=L.currentIndex;if(L===v)b--,v=v._nextRemoved;else if(d=d._next,null==L.previousIndex)b++;else{S||(S=[]);const ce=z-b,xe=Z-b;if(ce!=xe){for(let ht=0;ht<ce;ht++){const Mt=ht<S.length?S[ht]:S[ht]=0,mn=Mt+ht;xe<=mn&&mn<ce&&(S[ht]=Mt+1)}S[L.previousIndex]=xe-ce}}z!==Z&&c(L,z,Z)}}forEachPreviousItem(c){let d;for(d=this._previousItHead;null!==d;d=d._nextPrevious)c(d)}forEachAddedItem(c){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)c(d)}forEachMovedItem(c){let d;for(d=this._movesHead;null!==d;d=d._nextMoved)c(d)}forEachRemovedItem(c){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)c(d)}forEachIdentityChange(c){let d;for(d=this._identityChangesHead;null!==d;d=d._nextIdentityChange)c(d)}diff(c){if(null==c&&(c=[]),!Ns(c))throw new Vn(900,!1);return this.check(c)?this:null}onDestroy(){}check(c){this._reset();let b,S,L,d=this._itHead,v=!1;if(Array.isArray(c)){this.length=c.length;for(let z=0;z<this.length;z++)S=c[z],L=this._trackByFn(z,S),null!==d&&Object.is(d.trackById,L)?(v&&(d=this._verifyReinsertion(d,S,L,z)),Object.is(d.item,S)||this._addIdentityChange(d,S)):(d=this._mismatch(d,S,L,z),v=!0),d=d._next}else b=0,function fo(r,c){if(Array.isArray(r))for(let d=0;d<r.length;d++)c(r[d]);else{const d=r[Symbol.iterator]();let v;for(;!(v=d.next()).done;)c(v.value)}}(c,z=>{L=this._trackByFn(b,z),null!==d&&Object.is(d.trackById,L)?(v&&(d=this._verifyReinsertion(d,z,L,b)),Object.is(d.item,z)||this._addIdentityChange(d,z)):(d=this._mismatch(d,z,L,b),v=!0),d=d._next,b++}),this.length=b;return this._truncate(d),this.collection=c,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let c;for(c=this._previousItHead=this._itHead;null!==c;c=c._next)c._nextPrevious=c._next;for(c=this._additionsHead;null!==c;c=c._nextAdded)c.previousIndex=c.currentIndex;for(this._additionsHead=this._additionsTail=null,c=this._movesHead;null!==c;c=c._nextMoved)c.previousIndex=c.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(c,d,v,b){let S;return null===c?S=this._itTail:(S=c._prev,this._remove(c)),null!==(c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(v,null))?(Object.is(c.item,d)||this._addIdentityChange(c,d),this._reinsertAfter(c,S,b)):null!==(c=null===this._linkedRecords?null:this._linkedRecords.get(v,b))?(Object.is(c.item,d)||this._addIdentityChange(c,d),this._moveAfter(c,S,b)):c=this._addAfter(new IC(d,v),S,b),c}_verifyReinsertion(c,d,v,b){let S=null===this._unlinkedRecords?null:this._unlinkedRecords.get(v,null);return null!==S?c=this._reinsertAfter(S,c._prev,b):c.currentIndex!=b&&(c.currentIndex=b,this._addToMoves(c,b)),c}_truncate(c){for(;null!==c;){const d=c._next;this._addToRemovals(this._unlink(c)),c=d}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(c,d,v){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(c);const b=c._prevRemoved,S=c._nextRemoved;return null===b?this._removalsHead=S:b._nextRemoved=S,null===S?this._removalsTail=b:S._prevRemoved=b,this._insertAfter(c,d,v),this._addToMoves(c,v),c}_moveAfter(c,d,v){return this._unlink(c),this._insertAfter(c,d,v),this._addToMoves(c,v),c}_addAfter(c,d,v){return this._insertAfter(c,d,v),this._additionsTail=null===this._additionsTail?this._additionsHead=c:this._additionsTail._nextAdded=c,c}_insertAfter(c,d,v){const b=null===d?this._itHead:d._next;return c._next=b,c._prev=d,null===b?this._itTail=c:b._prev=c,null===d?this._itHead=c:d._next=c,null===this._linkedRecords&&(this._linkedRecords=new qx),this._linkedRecords.put(c),c.currentIndex=v,c}_remove(c){return this._addToRemovals(this._unlink(c))}_unlink(c){null!==this._linkedRecords&&this._linkedRecords.remove(c);const d=c._prev,v=c._next;return null===d?this._itHead=v:d._next=v,null===v?this._itTail=d:v._prev=d,c}_addToMoves(c,d){return c.previousIndex===d||(this._movesTail=null===this._movesTail?this._movesHead=c:this._movesTail._nextMoved=c),c}_addToRemovals(c){return null===this._unlinkedRecords&&(this._unlinkedRecords=new qx),this._unlinkedRecords.put(c),c.currentIndex=null,c._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=c,c._prevRemoved=null):(c._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=c),c}_addIdentityChange(c,d){return c.item=d,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=c:this._identityChangesTail._nextIdentityChange=c,c}}class IC{constructor(c,d){this.item=c,this.trackById=d,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class MC{constructor(){this._head=null,this._tail=null}add(c){null===this._head?(this._head=this._tail=c,c._nextDup=null,c._prevDup=null):(this._tail._nextDup=c,c._prevDup=this._tail,c._nextDup=null,this._tail=c)}get(c,d){let v;for(v=this._head;null!==v;v=v._nextDup)if((null===d||d<=v.currentIndex)&&Object.is(v.trackById,c))return v;return null}remove(c){const d=c._prevDup,v=c._nextDup;return null===d?this._head=v:d._nextDup=v,null===v?this._tail=d:v._prevDup=d,null===this._head}}class qx{constructor(){this.map=new Map}put(c){const d=c.trackById;let v=this.map.get(d);v||(v=new MC,this.map.set(d,v)),v.add(c)}get(c,d){const b=this.map.get(c);return b?b.get(c,d):null}remove(c){const d=c.trackById;return this.map.get(d).remove(c)&&this.map.delete(d),c}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Xx(r,c,d){const v=r.previousIndex;if(null===v)return v;let b=0;return d&&v<d.length&&(b=d[v]),v+c+b}class Yx{constructor(){}supports(c){return c instanceof Map||js(c)}create(){return new OC}}class OC{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(c){let d;for(d=this._mapHead;null!==d;d=d._next)c(d)}forEachPreviousItem(c){let d;for(d=this._previousMapHead;null!==d;d=d._nextPrevious)c(d)}forEachChangedItem(c){let d;for(d=this._changesHead;null!==d;d=d._nextChanged)c(d)}forEachAddedItem(c){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)c(d)}forEachRemovedItem(c){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)c(d)}diff(c){if(c){if(!(c instanceof Map||js(c)))throw new Vn(900,!1)}else c=new Map;return this.check(c)?this:null}onDestroy(){}check(c){this._reset();let d=this._mapHead;if(this._appendAfter=null,this._forEach(c,(v,b)=>{if(d&&d.key===b)this._maybeAddToChanges(d,v),this._appendAfter=d,d=d._next;else{const S=this._getOrCreateRecordForKey(b,v);d=this._insertBeforeOrAppend(d,S)}}),d){d._prev&&(d._prev._next=null),this._removalsHead=d;for(let v=d;null!==v;v=v._nextRemoved)v===this._mapHead&&(this._mapHead=null),this._records.delete(v.key),v._nextRemoved=v._next,v.previousValue=v.currentValue,v.currentValue=null,v._prev=null,v._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(c,d){if(c){const v=c._prev;return d._next=c,d._prev=v,c._prev=d,v&&(v._next=d),c===this._mapHead&&(this._mapHead=d),this._appendAfter=c,c}return this._appendAfter?(this._appendAfter._next=d,d._prev=this._appendAfter):this._mapHead=d,this._appendAfter=d,null}_getOrCreateRecordForKey(c,d){if(this._records.has(c)){const b=this._records.get(c);this._maybeAddToChanges(b,d);const S=b._prev,L=b._next;return S&&(S._next=L),L&&(L._prev=S),b._next=null,b._prev=null,b}const v=new PC(c);return this._records.set(c,v),v.currentValue=d,this._addToAdditions(v),v}_reset(){if(this.isDirty){let c;for(this._previousMapHead=this._mapHead,c=this._previousMapHead;null!==c;c=c._next)c._nextPrevious=c._next;for(c=this._changesHead;null!==c;c=c._nextChanged)c.previousValue=c.currentValue;for(c=this._additionsHead;null!=c;c=c._nextAdded)c.previousValue=c.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(c,d){Object.is(d,c.currentValue)||(c.previousValue=c.currentValue,c.currentValue=d,this._addToChanges(c))}_addToAdditions(c){null===this._additionsHead?this._additionsHead=this._additionsTail=c:(this._additionsTail._nextAdded=c,this._additionsTail=c)}_addToChanges(c){null===this._changesHead?this._changesHead=this._changesTail=c:(this._changesTail._nextChanged=c,this._changesTail=c)}_forEach(c,d){c instanceof Map?c.forEach(d):Object.keys(c).forEach(v=>d(c[v],v))}}class PC{constructor(c){this.key=c,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Kx(){return new kv([new Zx])}let kv=(()=>{class r{static#e=this.\u0275prov=xi({token:r,providedIn:"root",factory:Kx});constructor(d){this.factories=d}static create(d,v){if(null!=v){const b=v.factories.slice();d=d.concat(b)}return new r(d)}static extend(d){return{provide:r,useFactory:v=>r.create(d,v||Kx()),deps:[[r,new yu,new Zd]]}}find(d){const v=this.factories.find(b=>b.supports(d));if(null!=v)return v;throw new Vn(901,!1)}}return r})();function Jx(){return new Fv([new Yx])}let Fv=(()=>{class r{static#e=this.\u0275prov=xi({token:r,providedIn:"root",factory:Jx});constructor(d){this.factories=d}static create(d,v){if(v){const b=v.factories.slice();d=d.concat(b)}return new r(d)}static extend(d){return{provide:r,useFactory:v=>r.create(d,v||Jx()),deps:[[r,new yu,new Zd]]}}find(d){const v=this.factories.find(b=>b.supports(d));if(v)return v;throw new Vn(901,!1)}}return r})();const NC=Nx(null,"core",[]);let kC=(()=>{class r{constructor(d){}static#e=this.\u0275fac=function(v){return new(v||r)(In(gg))};static#t=this.\u0275mod=qa({type:r});static#n=this.\u0275inj=Rr({})}return r})();function ZC(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}function XC(r){const c=zr(r);if(!c)return null;const d=new cn(c);return{get selector(){return d.selector},get type(){return d.componentType},get inputs(){return d.inputs},get outputs(){return d.outputs},get ngContentSelectors(){return d.ngContentSelectors},get isStandalone(){return c.standalone},get isSignal(){return c.signals}}}},95:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Wl:()=>Jn,Fj:()=>kt,NI:()=>$o,u5:()=>vn,JJ:()=>Rr,JL:()=>ur,F:()=>bo,On:()=>ea,YN:()=>ni,wV:()=>Di,Q7:()=>ns,EJ:()=>Dr,_Y:()=>cl,Kr:()=>Ws});var O=_e(4946),bt=_e(6814),St=_e(7715),f=_e(5592),ze=_e(7453),ke=_e(4829),Vt=_e(4564),$t=_e(8251),xt=_e(7400),ft=_e(2714),dt=_e(7398);let Bt=(()=>{class re{constructor(X,be){this._renderer=X,this._elementRef=be,this.onChange=qe=>{},this.onTouched=()=>{}}setProperty(X,be){this._renderer.setProperty(this._elementRef.nativeElement,X,be)}registerOnTouched(X){this.onTouched=X}registerOnChange(X){this.onChange=X}setDisabledState(X){this.setProperty("disabled",X)}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(O.Qsj),O.Y36(O.SBq))};static#t=this.\u0275dir=O.lG2({type:re})}return re})(),zt=(()=>{class re extends Bt{static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,features:[O.qOj]})}return re})();const un=new O.OlP("NgValueAccessor"),jn={provide:un,useExisting:(0,O.Gpc)(()=>Jn),multi:!0};let Jn=(()=>{class re extends zt{writeValue(X){this.setProperty("checked",X)}static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(be,qe){1&be&&O.NdJ("change",function(lr){return qe.onChange(lr.target.checked)})("blur",function(){return qe.onTouched()})},features:[O._Bn([jn]),O.qOj]})}return re})();const mr={provide:un,useExisting:(0,O.Gpc)(()=>kt),multi:!0},rr=new O.OlP("CompositionEventMode");let kt=(()=>{class re extends Bt{constructor(X,be,qe){super(X,be),this._compositionMode=qe,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function Xt(){const re=(0,bt.q)()?(0,bt.q)().getUserAgent():"";return/android (\d+)/.test(re.toLowerCase())}())}writeValue(X){this.setProperty("value",X??"")}_handleInput(X){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(X)}_compositionStart(){this._composing=!0}_compositionEnd(X){this._composing=!1,this._compositionMode&&this.onChange(X)}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(O.Qsj),O.Y36(O.SBq),O.Y36(rr,8))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(be,qe){1&be&&O.NdJ("input",function(lr){return qe._handleInput(lr.target.value)})("blur",function(){return qe.onTouched()})("compositionstart",function(){return qe._compositionStart()})("compositionend",function(lr){return qe._compositionEnd(lr.target.value)})},features:[O._Bn([mr]),O.qOj]})}return re})();const Wn=new O.OlP("NgValidators"),Yt=new O.OlP("NgAsyncValidators");function xo(re){return function gt(re){return null==re||("string"==typeof re||Array.isArray(re))&&0===re.length}(re.value)?{required:!0}:null}function At(re){return null}function Nt(re){return null!=re}function Zt(re){return(0,O.QGY)(re)?(0,St.D)(re):re}function mt(re){let ue={};return re.forEach(X=>{ue=null!=X?{...ue,...X}:ue}),0===Object.keys(ue).length?null:ue}function rn(re,ue){return ue.map(X=>X(re))}function gr(re){return re.map(ue=>function _n(re){return!re.validate}(ue)?ue:X=>ue.validate(X))}function tr(re){return null!=re?function Qn(re){if(!re)return null;const ue=re.filter(Nt);return 0==ue.length?null:function(X){return mt(rn(X,ue))}}(gr(re)):null}function nn(re){return null!=re?function ir(re){if(!re)return null;const ue=re.filter(Nt);return 0==ue.length?null:function(X){return function it(...re){const ue=(0,Vt.jO)(re),{args:X,keys:be}=(0,ze.D)(re),qe=new f.y(On=>{const{length:lr}=X;if(!lr)return void On.complete();const Br=new Array(lr);let ii=lr,Ti=lr;for(let ki=0;ki<lr;ki++){let eo=!1;(0,ke.Xf)(X[ki]).subscribe((0,$t.x)(On,Qr=>{eo||(eo=!0,Ti--),Br[ki]=Qr},()=>ii--,void 0,()=>{(!ii||!eo)&&(Ti||On.next(be?(0,ft.n)(be,Br):Br),On.complete())}))}});return ue?qe.pipe((0,xt.Z)(ue)):qe}(rn(X,ue).map(Zt)).pipe((0,dt.U)(mt))}}(gr(re)):null}function Oi(re,ue){return null===re?[ue]:Array.isArray(re)?[...re,ue]:[re,ue]}function vi(re){return re?Array.isArray(re)?re:[re]:[]}function qr(re,ue){return Array.isArray(re)?re.includes(ue):re===ue}function Ci(re,ue){const X=vi(ue);return vi(re).forEach(qe=>{qr(X,qe)||X.push(qe)}),X}function Ni(re,ue){return vi(ue).filter(X=>!qr(re,X))}class fr{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(ue){this._rawValidators=ue||[],this._composedValidatorFn=tr(this._rawValidators)}_setAsyncValidators(ue){this._rawAsyncValidators=ue||[],this._composedAsyncValidatorFn=nn(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(ue){this._onDestroyCallbacks.push(ue)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(ue=>ue()),this._onDestroyCallbacks=[]}reset(ue=void 0){this.control&&this.control.reset(ue)}hasError(ue,X){return!!this.control&&this.control.hasError(ue,X)}getError(ue,X){return this.control?this.control.getError(ue,X):null}}class Ai extends fr{get formDirective(){return null}get path(){return null}}class wr extends fr{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Pr{constructor(ue){this._cd=ue}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Rr=(()=>{class re extends Pr{constructor(X){super(X)}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(wr,2))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(be,qe){2&be&&O.ekj("ng-untouched",qe.isUntouched)("ng-touched",qe.isTouched)("ng-pristine",qe.isPristine)("ng-dirty",qe.isDirty)("ng-valid",qe.isValid)("ng-invalid",qe.isInvalid)("ng-pending",qe.isPending)},features:[O.qOj]})}return re})(),ur=(()=>{class re extends Pr{constructor(X){super(X)}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(Ai,10))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(be,qe){2&be&&O.ekj("ng-untouched",qe.isUntouched)("ng-touched",qe.isTouched)("ng-pristine",qe.isPristine)("ng-dirty",qe.isDirty)("ng-valid",qe.isValid)("ng-invalid",qe.isInvalid)("ng-pending",qe.isPending)("ng-submitted",qe.isSubmitted)},features:[O.qOj]})}return re})();const st="VALID",Ye="INVALID",Dt="PENDING",pn="DISABLED";function Mn(re){return(Ke(re)?re.validators:re)||null}function lt(re,ue){return(Ke(ue)?ue.asyncValidators:re)||null}function Ke(re){return null!=re&&!Array.isArray(re)&&"object"==typeof re}class Bn{constructor(ue,X){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(ue),this._assignAsyncValidators(X)}get validator(){return this._composedValidatorFn}set validator(ue){this._rawValidators=this._composedValidatorFn=ue}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(ue){this._rawAsyncValidators=this._composedAsyncValidatorFn=ue}get parent(){return this._parent}get valid(){return this.status===st}get invalid(){return this.status===Ye}get pending(){return this.status==Dt}get disabled(){return this.status===pn}get enabled(){return this.status!==pn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(ue){this._assignValidators(ue)}setAsyncValidators(ue){this._assignAsyncValidators(ue)}addValidators(ue){this.setValidators(Ci(ue,this._rawValidators))}addAsyncValidators(ue){this.setAsyncValidators(Ci(ue,this._rawAsyncValidators))}removeValidators(ue){this.setValidators(Ni(ue,this._rawValidators))}removeAsyncValidators(ue){this.setAsyncValidators(Ni(ue,this._rawAsyncValidators))}hasValidator(ue){return qr(this._rawValidators,ue)}hasAsyncValidator(ue){return qr(this._rawAsyncValidators,ue)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(ue={}){this.touched=!0,this._parent&&!ue.onlySelf&&this._parent.markAsTouched(ue)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(ue=>ue.markAllAsTouched())}markAsUntouched(ue={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(X=>{X.markAsUntouched({onlySelf:!0})}),this._parent&&!ue.onlySelf&&this._parent._updateTouched(ue)}markAsDirty(ue={}){this.pristine=!1,this._parent&&!ue.onlySelf&&this._parent.markAsDirty(ue)}markAsPristine(ue={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(X=>{X.markAsPristine({onlySelf:!0})}),this._parent&&!ue.onlySelf&&this._parent._updatePristine(ue)}markAsPending(ue={}){this.status=Dt,!1!==ue.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!ue.onlySelf&&this._parent.markAsPending(ue)}disable(ue={}){const X=this._parentMarkedDirty(ue.onlySelf);this.status=pn,this.errors=null,this._forEachChild(be=>{be.disable({...ue,onlySelf:!0})}),this._updateValue(),!1!==ue.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...ue,skipPristineCheck:X}),this._onDisabledChange.forEach(be=>be(!0))}enable(ue={}){const X=this._parentMarkedDirty(ue.onlySelf);this.status=st,this._forEachChild(be=>{be.enable({...ue,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:ue.emitEvent}),this._updateAncestors({...ue,skipPristineCheck:X}),this._onDisabledChange.forEach(be=>be(!1))}_updateAncestors(ue){this._parent&&!ue.onlySelf&&(this._parent.updateValueAndValidity(ue),ue.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(ue){this._parent=ue}getRawValue(){return this.value}updateValueAndValidity(ue={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===st||this.status===Dt)&&this._runAsyncValidator(ue.emitEvent)),!1!==ue.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!ue.onlySelf&&this._parent.updateValueAndValidity(ue)}_updateTreeValidity(ue={emitEvent:!0}){this._forEachChild(X=>X._updateTreeValidity(ue)),this.updateValueAndValidity({onlySelf:!0,emitEvent:ue.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?pn:st}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(ue){if(this.asyncValidator){this.status=Dt,this._hasOwnPendingAsyncValidator=!0;const X=Zt(this.asyncValidator(this));this._asyncValidationSubscription=X.subscribe(be=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(be,{emitEvent:ue})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(ue,X={}){this.errors=ue,this._updateControlsErrors(!1!==X.emitEvent)}get(ue){let X=ue;return null==X||(Array.isArray(X)||(X=X.split(".")),0===X.length)?null:X.reduce((be,qe)=>be&&be._find(qe),this)}getError(ue,X){const be=X?this.get(X):this;return be&&be.errors?be.errors[ue]:null}hasError(ue,X){return!!this.getError(ue,X)}get root(){let ue=this;for(;ue._parent;)ue=ue._parent;return ue}_updateControlsErrors(ue){this.status=this._calculateStatus(),ue&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(ue)}_initObservables(){this.valueChanges=new O.vpe,this.statusChanges=new O.vpe}_calculateStatus(){return this._allControlsDisabled()?pn:this.errors?Ye:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Dt)?Dt:this._anyControlsHaveStatus(Ye)?Ye:st}_anyControlsHaveStatus(ue){return this._anyControls(X=>X.status===ue)}_anyControlsDirty(){return this._anyControls(ue=>ue.dirty)}_anyControlsTouched(){return this._anyControls(ue=>ue.touched)}_updatePristine(ue={}){this.pristine=!this._anyControlsDirty(),this._parent&&!ue.onlySelf&&this._parent._updatePristine(ue)}_updateTouched(ue={}){this.touched=this._anyControlsTouched(),this._parent&&!ue.onlySelf&&this._parent._updateTouched(ue)}_registerOnCollectionChange(ue){this._onCollectionChange=ue}_setUpdateStrategy(ue){Ke(ue)&&null!=ue.updateOn&&(this._updateOn=ue.updateOn)}_parentMarkedDirty(ue){return!ue&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(ue){return null}_assignValidators(ue){this._rawValidators=Array.isArray(ue)?ue.slice():ue,this._composedValidatorFn=function Ze(re){return Array.isArray(re)?tr(re):re||null}(this._rawValidators)}_assignAsyncValidators(ue){this._rawAsyncValidators=Array.isArray(ue)?ue.slice():ue,this._composedAsyncValidatorFn=function De(re){return Array.isArray(re)?nn(re):re||null}(this._rawAsyncValidators)}}class Mr extends Bn{constructor(ue,X,be){super(Mn(X),lt(be,X)),this.controls=ue,this._initObservables(),this._setUpdateStrategy(X),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(ue,X){return this.controls[ue]?this.controls[ue]:(this.controls[ue]=X,X.setParent(this),X._registerOnCollectionChange(this._onCollectionChange),X)}addControl(ue,X,be={}){this.registerControl(ue,X),this.updateValueAndValidity({emitEvent:be.emitEvent}),this._onCollectionChange()}removeControl(ue,X={}){this.controls[ue]&&this.controls[ue]._registerOnCollectionChange(()=>{}),delete this.controls[ue],this.updateValueAndValidity({emitEvent:X.emitEvent}),this._onCollectionChange()}setControl(ue,X,be={}){this.controls[ue]&&this.controls[ue]._registerOnCollectionChange(()=>{}),delete this.controls[ue],X&&this.registerControl(ue,X),this.updateValueAndValidity({emitEvent:be.emitEvent}),this._onCollectionChange()}contains(ue){return this.controls.hasOwnProperty(ue)&&this.controls[ue].enabled}setValue(ue,X={}){(function xn(re,ue,X){re._forEachChild((be,qe)=>{if(void 0===X[qe])throw new O.vHH(1002,"")})})(this,0,ue),Object.keys(ue).forEach(be=>{(function Tt(re,ue,X){const be=re.controls;if(!(ue?Object.keys(be):be).length)throw new O.vHH(1e3,"");if(!be[X])throw new O.vHH(1001,"")})(this,!0,be),this.controls[be].setValue(ue[be],{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X)}patchValue(ue,X={}){null!=ue&&(Object.keys(ue).forEach(be=>{const qe=this.controls[be];qe&&qe.patchValue(ue[be],{onlySelf:!0,emitEvent:X.emitEvent})}),this.updateValueAndValidity(X))}reset(ue={},X={}){this._forEachChild((be,qe)=>{be.reset(ue?ue[qe]:null,{onlySelf:!0,emitEvent:X.emitEvent})}),this._updatePristine(X),this._updateTouched(X),this.updateValueAndValidity(X)}getRawValue(){return this._reduceChildren({},(ue,X,be)=>(ue[be]=X.getRawValue(),ue))}_syncPendingControls(){let ue=this._reduceChildren(!1,(X,be)=>!!be._syncPendingControls()||X);return ue&&this.updateValueAndValidity({onlySelf:!0}),ue}_forEachChild(ue){Object.keys(this.controls).forEach(X=>{const be=this.controls[X];be&&ue(be,X)})}_setUpControls(){this._forEachChild(ue=>{ue.setParent(this),ue._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(ue){for(const[X,be]of Object.entries(this.controls))if(this.contains(X)&&ue(be))return!0;return!1}_reduceValue(){return this._reduceChildren({},(X,be,qe)=>((be.enabled||this.disabled)&&(X[qe]=be.value),X))}_reduceChildren(ue,X){let be=ue;return this._forEachChild((qe,On)=>{be=X(be,qe,On)}),be}_allControlsDisabled(){for(const ue of Object.keys(this.controls))if(this.controls[ue].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(ue){return this.controls.hasOwnProperty(ue)?this.controls[ue]:null}}const _t=new O.OlP("CallSetDisabledState",{providedIn:"root",factory:()=>Je}),Je="always";function an(re,ue,X=Je){br(re,ue),ue.valueAccessor.writeValue(re.value),(re.disabled||"always"===X)&&ue.valueAccessor.setDisabledState?.(re.disabled),function Ui(re,ue){ue.valueAccessor.registerOnChange(X=>{re._pendingValue=X,re._pendingChange=!0,re._pendingDirty=!0,"change"===re.updateOn&&_o(re,ue)})}(re,ue),function Jo(re,ue){const X=(be,qe)=>{ue.valueAccessor.writeValue(be),qe&&ue.viewToModelUpdate(be)};re.registerOnChange(X),ue._registerOnDestroy(()=>{re._unregisterOnChange(X)})}(re,ue),function Fi(re,ue){ue.valueAccessor.registerOnTouched(()=>{re._pendingTouched=!0,"blur"===re.updateOn&&re._pendingChange&&_o(re,ue),"submit"!==re.updateOn&&re.markAsTouched()})}(re,ue),function zn(re,ue){if(ue.valueAccessor.setDisabledState){const X=be=>{ue.valueAccessor.setDisabledState(be)};re.registerOnDisabledChange(X),ue._registerOnDestroy(()=>{re._unregisterOnDisabledChange(X)})}}(re,ue)}function In(re,ue){re.forEach(X=>{X.registerOnValidatorChange&&X.registerOnValidatorChange(ue)})}function br(re,ue){const X=function Gn(re){return re._rawValidators}(re);null!==ue.validator?re.setValidators(Oi(X,ue.validator)):"function"==typeof X&&re.setValidators([X]);const be=function Pi(re){return re._rawAsyncValidators}(re);null!==ue.asyncValidator?re.setAsyncValidators(Oi(be,ue.asyncValidator)):"function"==typeof be&&re.setAsyncValidators([be]);const qe=()=>re.updateValueAndValidity();In(ue._rawValidators,qe),In(ue._rawAsyncValidators,qe)}function _o(re,ue){re._pendingDirty&&re.markAsDirty(),re.setValue(re._pendingValue,{emitModelToViewChange:!1}),ue.viewToModelUpdate(re._pendingValue),re._pendingChange=!1}const Hr={provide:Ai,useExisting:(0,O.Gpc)(()=>bo)},kr=(()=>Promise.resolve())();let bo=(()=>{class re extends Ai{constructor(X,be,qe){super(),this.callSetDisabledState=qe,this.submitted=!1,this._directives=new Set,this.ngSubmit=new O.vpe,this.form=new Mr({},tr(X),nn(be))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(X){kr.then(()=>{const be=this._findContainer(X.path);X.control=be.registerControl(X.name,X.control),an(X.control,X,this.callSetDisabledState),X.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(X)})}getControl(X){return this.form.get(X.path)}removeControl(X){kr.then(()=>{const be=this._findContainer(X.path);be&&be.removeControl(X.name),this._directives.delete(X)})}addFormGroup(X){kr.then(()=>{const be=this._findContainer(X.path),qe=new Mr({});(function Vi(re,ue){br(re,ue)})(qe,X),be.registerControl(X.name,qe),qe.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(X){kr.then(()=>{const be=this._findContainer(X.path);be&&be.removeControl(X.name)})}getFormGroup(X){return this.form.get(X.path)}updateModel(X,be){kr.then(()=>{this.form.get(X.path).setValue(be)})}setValue(X){this.control.setValue(X)}onSubmit(X){return this.submitted=!0,function ka(re,ue){re._syncPendingControls(),ue.forEach(X=>{const be=X.control;"submit"===be.updateOn&&be._pendingChange&&(X.viewToModelUpdate(be._pendingValue),be._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(X),"dialog"===X?.target?.method}onReset(){this.resetForm()}resetForm(X=void 0){this.form.reset(X),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(X){return X.pop(),X.length?this.form.get(X):this.form}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(Wn,10),O.Y36(Yt,10),O.Y36(_t,8))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(be,qe){1&be&&O.NdJ("submit",function(lr){return qe.onSubmit(lr)})("reset",function(){return qe.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[O._Bn([Hr]),O.qOj]})}return re})();function ws(re,ue){const X=re.indexOf(ue);X>-1&&re.splice(X,1)}function Vr(re){return"object"==typeof re&&null!==re&&2===Object.keys(re).length&&"value"in re&&"disabled"in re}const $o=class extends Bn{constructor(ue=null,X,be){super(Mn(X),lt(be,X)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(ue),this._setUpdateStrategy(X),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ke(X)&&(X.nonNullable||X.initialValueIsDefault)&&(this.defaultValue=Vr(ue)?ue.value:ue)}setValue(ue,X={}){this.value=this._pendingValue=ue,this._onChange.length&&!1!==X.emitModelToViewChange&&this._onChange.forEach(be=>be(this.value,!1!==X.emitViewToModelChange)),this.updateValueAndValidity(X)}patchValue(ue,X={}){this.setValue(ue,X)}reset(ue=this.defaultValue,X={}){this._applyFormState(ue),this.markAsPristine(X),this.markAsUntouched(X),this.setValue(this.value,X),this._pendingChange=!1}_updateValue(){}_anyControls(ue){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(ue){this._onChange.push(ue)}_unregisterOnChange(ue){ws(this._onChange,ue)}registerOnDisabledChange(ue){this._onDisabledChange.push(ue)}_unregisterOnDisabledChange(ue){ws(this._onDisabledChange,ue)}_forEachChild(ue){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(ue){Vr(ue)?(this.value=this._pendingValue=ue.value,ue.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=ue}},Yl={provide:wr,useExisting:(0,O.Gpc)(()=>ea)},ba=(()=>Promise.resolve())();let ea=(()=>{class re extends wr{constructor(X,be,qe,On,lr,Br){super(),this._changeDetectorRef=lr,this.callSetDisabledState=Br,this.control=new $o,this._registered=!1,this.name="",this.update=new O.vpe,this._parent=X,this._setValidators(be),this._setAsyncValidators(qe),this.valueAccessor=function Go(re,ue){if(!ue)return null;let X,be,qe;return Array.isArray(ue),ue.forEach(On=>{On.constructor===kt?X=On:function Zn(re){return Object.getPrototypeOf(re.constructor)===zt}(On)?be=On:qe=On}),qe||be||X||null}(0,On)}ngOnChanges(X){if(this._checkForErrors(),!this._registered||"name"in X){if(this._registered&&(this._checkName(),this.formDirective)){const be=X.name.previousValue;this.formDirective.removeControl({name:be,path:this._getPath(be)})}this._setUpControl()}"isDisabled"in X&&this._updateDisabled(X),function Gs(re,ue){if(!re.hasOwnProperty("model"))return!1;const X=re.model;return!!X.isFirstChange()||!Object.is(ue,X.currentValue)}(X,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(X){this.viewModel=X,this.update.emit(X)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){an(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(X){ba.then(()=>{this.control.setValue(X,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(X){const be=X.isDisabled.currentValue,qe=0!==be&&(0,O.VuI)(be);ba.then(()=>{qe&&!this.control.disabled?this.control.disable():!qe&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(X){return this._parent?function ct(re,ue){return[...ue.path,re]}(X,this._parent):[X]}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(Ai,9),O.Y36(Wn,10),O.Y36(Yt,10),O.Y36(un,10),O.Y36(O.sBO,8),O.Y36(_t,8))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[O._Bn([Yl]),O.qOj,O.TTD]})}return re})(),cl=(()=>{class re{static#e=this.\u0275fac=function(be){return new(be||re)};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}return re})();const ul={provide:un,useExisting:(0,O.Gpc)(()=>Di),multi:!0};let Di=(()=>{class re extends zt{writeValue(X){this.setProperty("value",X??"")}registerOnChange(X){this.onChange=be=>{X(""==be?null:parseFloat(be))}}static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(be,qe){1&be&&O.NdJ("input",function(lr){return qe.onChange(lr.target.value)})("blur",function(){return qe.onTouched()})},features:[O._Bn([ul]),O.qOj]})}return re})(),dl=(()=>{class re{static#e=this.\u0275fac=function(be){return new(be||re)};static#t=this.\u0275mod=O.oAB({type:re});static#n=this.\u0275inj=O.cJS({})}return re})();const Ca={provide:un,useExisting:(0,O.Gpc)(()=>Dr),multi:!0};function mi(re,ue){return null==re?`${ue}`:(ue&&"object"==typeof ue&&(ue="Object"),`${re}: ${ue}`.slice(0,50))}let Dr=(()=>{class re extends zt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(X){this._compareWith=X}writeValue(X){this.value=X;const qe=mi(this._getOptionId(X),X);this.setProperty("value",qe)}registerOnChange(X){this.onChange=be=>{this.value=this._getOptionValue(be),X(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(X){for(const be of this._optionMap.keys())if(this._compareWith(this._optionMap.get(be),X))return be;return null}_getOptionValue(X){const be=function er(re){return re.split(":")[0]}(X);return this._optionMap.has(be)?this._optionMap.get(be):X}static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(be,qe){1&be&&O.NdJ("change",function(lr){return qe.onChange(lr.target.value)})("blur",function(){return qe.onTouched()})},inputs:{compareWith:"compareWith"},features:[O._Bn([Ca]),O.qOj]})}return re})(),ni=(()=>{class re{constructor(X,be,qe){this._element=X,this._renderer=be,this._select=qe,this._select&&(this.id=this._select._registerOption())}set ngValue(X){null!=this._select&&(this._select._optionMap.set(this.id,X),this._setElementValue(mi(this.id,X)),this._select.writeValue(this._select.value))}set value(X){this._setElementValue(X),this._select&&this._select.writeValue(this._select.value)}_setElementValue(X){this._renderer.setProperty(this._element.nativeElement,"value",X)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(O.SBq),O.Y36(O.Qsj),O.Y36(Dr,9))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return re})();const cs={provide:un,useExisting:(0,O.Gpc)(()=>Fr),multi:!0};function ts(re,ue){return null==re?`${ue}`:("string"==typeof ue&&(ue=`'${ue}'`),ue&&"object"==typeof ue&&(ue="Object"),`${re}: ${ue}`.slice(0,50))}let Fr=(()=>{class re extends zt{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(X){this._compareWith=X}writeValue(X){let be;if(this.value=X,Array.isArray(X)){const qe=X.map(On=>this._getOptionId(On));be=(On,lr)=>{On._setSelected(qe.indexOf(lr.toString())>-1)}}else be=(qe,On)=>{qe._setSelected(!1)};this._optionMap.forEach(be)}registerOnChange(X){this.onChange=be=>{const qe=[],On=be.selectedOptions;if(void 0!==On){const lr=On;for(let Br=0;Br<lr.length;Br++){const Ti=this._getOptionValue(lr[Br].value);qe.push(Ti)}}else{const lr=be.options;for(let Br=0;Br<lr.length;Br++){const ii=lr[Br];if(ii.selected){const Ti=this._getOptionValue(ii.value);qe.push(Ti)}}}this.value=qe,X(qe)}}_registerOption(X){const be=(this._idCounter++).toString();return this._optionMap.set(be,X),be}_getOptionId(X){for(const be of this._optionMap.keys())if(this._compareWith(this._optionMap.get(be)._value,X))return be;return null}_getOptionValue(X){const be=function Co(re){return re.split(":")[0]}(X);return this._optionMap.has(be)?this._optionMap.get(be)._value:X}static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(be,qe){1&be&&O.NdJ("change",function(lr){return qe.onChange(lr.target)})("blur",function(){return qe.onTouched()})},inputs:{compareWith:"compareWith"},features:[O._Bn([cs]),O.qOj]})}return re})(),Ws=(()=>{class re{constructor(X,be,qe){this._element=X,this._renderer=be,this._select=qe,this._select&&(this.id=this._select._registerOption(this))}set ngValue(X){null!=this._select&&(this._value=X,this._setElementValue(ts(this.id,X)),this._select.writeValue(this._select.value))}set value(X){this._select?(this._value=X,this._setElementValue(ts(this.id,X)),this._select.writeValue(this._select.value)):this._setElementValue(X)}_setElementValue(X){this._renderer.setProperty(this._element.nativeElement,"value",X)}_setSelected(X){this._renderer.setProperty(this._element.nativeElement,"selected",X)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static#e=this.\u0275fac=function(be){return new(be||re)(O.Y36(O.SBq),O.Y36(O.Qsj),O.Y36(Fr,9))};static#t=this.\u0275dir=O.lG2({type:re,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}return re})(),zs=(()=>{class re{constructor(){this._validator=At}ngOnChanges(X){if(this.inputName in X){const be=this.normalizeInput(X[this.inputName].currentValue);this._enabled=this.enabled(be),this._validator=this._enabled?this.createValidator(be):At,this._onChange&&this._onChange()}}validate(X){return this._validator(X)}registerOnValidatorChange(X){this._onChange=X}enabled(X){return null!=X}static#e=this.\u0275fac=function(be){return new(be||re)};static#t=this.\u0275dir=O.lG2({type:re,features:[O.TTD]})}return re})();const Da={provide:Wn,useExisting:(0,O.Gpc)(()=>ns),multi:!0};let ns=(()=>{class re extends zs{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=O.VuI,this.createValidator=X=>xo}enabled(X){return X}static#e=this.\u0275fac=function(){let X;return function(qe){return(X||(X=O.n5z(re)))(qe||re)}}();static#t=this.\u0275dir=O.lG2({type:re,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(be,qe){2&be&&O.uIk("required",qe._enabled?"":null)},inputs:{required:"required"},features:[O._Bn([Da]),O.qOj]})}return re})(),Zs=(()=>{class re{static#e=this.\u0275fac=function(be){return new(be||re)};static#t=this.\u0275mod=O.oAB({type:re});static#n=this.\u0275inj=O.cJS({imports:[dl]})}return re})(),vn=(()=>{class re{static withConfig(X){return{ngModule:re,providers:[{provide:_t,useValue:X.callSetDisabledState??Je}]}}static#e=this.\u0275fac=function(be){return new(be||re)};static#t=this.\u0275mod=O.oAB({type:re});static#n=this.\u0275inj=O.cJS({imports:[Zs]})}return re})()},6593:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{Dx:()=>wr,b2:()=>qr,q6:()=>Oi});var O=_e(4946),bt=_e(6814);class St extends bt.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class f extends St{static makeCurrent(){(0,bt.HT)(new f)}onAndCancel(lt,De,Ke){return lt.addEventListener(De,Ke),()=>{lt.removeEventListener(De,Ke)}}dispatchEvent(lt,De){lt.dispatchEvent(De)}remove(lt){lt.parentNode&&lt.parentNode.removeChild(lt)}createElement(lt,De){return(De=De||this.getDefaultDocument()).createElement(lt)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(lt){return lt.nodeType===Node.ELEMENT_NODE}isShadowRoot(lt){return lt instanceof DocumentFragment}getGlobalEventTarget(lt,De){return"window"===De?window:"document"===De?lt:"body"===De?lt.body:null}getBaseHref(lt){const De=function ke(){return ze=ze||document.querySelector("base"),ze?ze.getAttribute("href"):null}();return null==De?null:function $t(Ze){Vt=Vt||document.createElement("a"),Vt.setAttribute("href",Ze);const lt=Vt.pathname;return"/"===lt.charAt(0)?lt:`/${lt}`}(De)}resetBaseElement(){ze=null}getUserAgent(){return window.navigator.userAgent}getCookie(lt){return(0,bt.Mx)(document.cookie,lt)}}let Vt,ze=null,ft=(()=>{class Ze{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();const it=new O.OlP("EventManagerPlugins");let dt=(()=>{class Ze{constructor(De,Ke){this._zone=Ke,this._eventNameToPlugin=new Map,De.forEach(Tt=>{Tt.manager=this}),this._plugins=De.slice().reverse()}addEventListener(De,Ke,Tt){return this._findPluginFor(Ke).addEventListener(De,Ke,Tt)}getZone(){return this._zone}_findPluginFor(De){let Ke=this._eventNameToPlugin.get(De);if(Ke)return Ke;if(Ke=this._plugins.find(xn=>xn.supports(De)),!Ke)throw new O.vHH(5101,!1);return this._eventNameToPlugin.set(De,Ke),Ke}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(it),O.LFG(O.R0b))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();class Bt{constructor(lt){this._doc=lt}}const zt="ng-app-id";let un=(()=>{class Ze{constructor(De,Ke,Tt,xn={}){this.doc=De,this.appId=Ke,this.nonce=Tt,this.platformId=xn,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,bt.PM)(xn),this.resetHostNodes()}addStyles(De){for(const Ke of De)1===this.changeUsageCount(Ke,1)&&this.onStyleAdded(Ke)}removeStyles(De){for(const Ke of De)this.changeUsageCount(Ke,-1)<=0&&this.onStyleRemoved(Ke)}ngOnDestroy(){const De=this.styleNodesInDOM;De&&(De.forEach(Ke=>Ke.remove()),De.clear());for(const Ke of this.getAllStyles())this.onStyleRemoved(Ke);this.resetHostNodes()}addHost(De){this.hostNodes.add(De);for(const Ke of this.getAllStyles())this.addStyleToHost(De,Ke)}removeHost(De){this.hostNodes.delete(De)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(De){for(const Ke of this.hostNodes)this.addStyleToHost(Ke,De)}onStyleRemoved(De){const Ke=this.styleRef;Ke.get(De)?.elements?.forEach(Tt=>Tt.remove()),Ke.delete(De)}collectServerRenderedStyles(){const De=this.doc.head?.querySelectorAll(`style[${zt}="${this.appId}"]`);if(De?.length){const Ke=new Map;return De.forEach(Tt=>{null!=Tt.textContent&&Ke.set(Tt.textContent,Tt)}),Ke}return null}changeUsageCount(De,Ke){const Tt=this.styleRef;if(Tt.has(De)){const xn=Tt.get(De);return xn.usage+=Ke,xn.usage}return Tt.set(De,{usage:Ke,elements:[]}),Ke}getStyleElement(De,Ke){const Tt=this.styleNodesInDOM,xn=Tt?.get(Ke);if(xn?.parentNode===De)return Tt.delete(Ke),xn.removeAttribute(zt),xn;{const Bn=this.doc.createElement("style");return this.nonce&&Bn.setAttribute("nonce",this.nonce),Bn.textContent=Ke,this.platformIsServer&&Bn.setAttribute(zt,this.appId),Bn}}addStyleToHost(De,Ke){const Tt=this.getStyleElement(De,Ke);De.appendChild(Tt);const xn=this.styleRef,Bn=xn.get(Ke)?.elements;Bn?Bn.push(Tt):xn.set(Ke,{elements:[Tt],usage:1})}resetHostNodes(){const De=this.hostNodes;De.clear(),De.add(this.doc.head)}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(bt.K0),O.LFG(O.AFp),O.LFG(O.Ojb,8),O.LFG(O.Lbi))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();const jn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Jn=/%COMP%/g,gt=new O.OlP("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function Yt(Ze,lt){return lt.map(De=>De.replace(Jn,Ze))}let Kt=(()=>{class Ze{constructor(De,Ke,Tt,xn,Bn,Mr,Lr,hi=null){this.eventManager=De,this.sharedStylesHost=Ke,this.appId=Tt,this.removeStylesOnCompDestroy=xn,this.doc=Bn,this.platformId=Mr,this.ngZone=Lr,this.nonce=hi,this.rendererByCompId=new Map,this.platformIsServer=(0,bt.PM)(Mr),this.defaultRenderer=new dn(De,Bn,Lr,this.platformIsServer)}createRenderer(De,Ke){if(!De||!Ke)return this.defaultRenderer;this.platformIsServer&&Ke.encapsulation===O.ifc.ShadowDom&&(Ke={...Ke,encapsulation:O.ifc.Emulated});const Tt=this.getOrCreateRenderer(De,Ke);return Tt instanceof Zr?Tt.applyToHost(De):Tt instanceof Vn&&Tt.applyStyles(),Tt}getOrCreateRenderer(De,Ke){const Tt=this.rendererByCompId;let xn=Tt.get(Ke.id);if(!xn){const Bn=this.doc,Mr=this.ngZone,Lr=this.eventManager,hi=this.sharedStylesHost,zi=this.removeStylesOnCompDestroy,Ji=this.platformIsServer;switch(Ke.encapsulation){case O.ifc.Emulated:xn=new Zr(Lr,hi,Ke,this.appId,zi,Bn,Mr,Ji);break;case O.ifc.ShadowDom:return new xr(Lr,hi,De,Ke,Bn,Mr,this.nonce,Ji);default:xn=new Vn(Lr,hi,Ke,zi,Bn,Mr,Ji)}Tt.set(Ke.id,xn)}return xn}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(dt),O.LFG(un),O.LFG(O.AFp),O.LFG(gt),O.LFG(bt.K0),O.LFG(O.Lbi),O.LFG(O.R0b),O.LFG(O.Ojb))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();class dn{constructor(lt,De,Ke,Tt){this.eventManager=lt,this.doc=De,this.ngZone=Ke,this.platformIsServer=Tt,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(lt,De){return De?this.doc.createElementNS(jn[De]||De,lt):this.doc.createElement(lt)}createComment(lt){return this.doc.createComment(lt)}createText(lt){return this.doc.createTextNode(lt)}appendChild(lt,De){(xo(lt)?lt.content:lt).appendChild(De)}insertBefore(lt,De,Ke){lt&&(xo(lt)?lt.content:lt).insertBefore(De,Ke)}removeChild(lt,De){lt&&lt.removeChild(De)}selectRootElement(lt,De){let Ke="string"==typeof lt?this.doc.querySelector(lt):lt;if(!Ke)throw new O.vHH(-5104,!1);return De||(Ke.textContent=""),Ke}parentNode(lt){return lt.parentNode}nextSibling(lt){return lt.nextSibling}setAttribute(lt,De,Ke,Tt){if(Tt){De=Tt+":"+De;const xn=jn[Tt];xn?lt.setAttributeNS(xn,De,Ke):lt.setAttribute(De,Ke)}else lt.setAttribute(De,Ke)}removeAttribute(lt,De,Ke){if(Ke){const Tt=jn[Ke];Tt?lt.removeAttributeNS(Tt,De):lt.removeAttribute(`${Ke}:${De}`)}else lt.removeAttribute(De)}addClass(lt,De){lt.classList.add(De)}removeClass(lt,De){lt.classList.remove(De)}setStyle(lt,De,Ke,Tt){Tt&(O.JOm.DashCase|O.JOm.Important)?lt.style.setProperty(De,Ke,Tt&O.JOm.Important?"important":""):lt.style[De]=Ke}removeStyle(lt,De,Ke){Ke&O.JOm.DashCase?lt.style.removeProperty(De):lt.style[De]=""}setProperty(lt,De,Ke){lt[De]=Ke}setValue(lt,De){lt.nodeValue=De}listen(lt,De,Ke){if("string"==typeof lt&&!(lt=(0,bt.q)().getGlobalEventTarget(this.doc,lt)))throw new Error(`Unsupported event target ${lt} for event ${De}`);return this.eventManager.addEventListener(lt,De,this.decoratePreventDefault(Ke))}decoratePreventDefault(lt){return De=>{if("__ngUnwrap__"===De)return lt;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>lt(De)):lt(De))&&De.preventDefault()}}}function xo(Ze){return"TEMPLATE"===Ze.tagName&&void 0!==Ze.content}class xr extends dn{constructor(lt,De,Ke,Tt,xn,Bn,Mr,Lr){super(lt,xn,Bn,Lr),this.sharedStylesHost=De,this.hostEl=Ke,this.shadowRoot=Ke.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const hi=Yt(Tt.id,Tt.styles);for(const zi of hi){const Ji=document.createElement("style");Mr&&Ji.setAttribute("nonce",Mr),Ji.textContent=zi,this.shadowRoot.appendChild(Ji)}}nodeOrShadowRoot(lt){return lt===this.hostEl?this.shadowRoot:lt}appendChild(lt,De){return super.appendChild(this.nodeOrShadowRoot(lt),De)}insertBefore(lt,De,Ke){return super.insertBefore(this.nodeOrShadowRoot(lt),De,Ke)}removeChild(lt,De){return super.removeChild(this.nodeOrShadowRoot(lt),De)}parentNode(lt){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(lt)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Vn extends dn{constructor(lt,De,Ke,Tt,xn,Bn,Mr,Lr){super(lt,xn,Bn,Mr),this.sharedStylesHost=De,this.removeStylesOnCompDestroy=Tt,this.styles=Lr?Yt(Lr,Ke.styles):Ke.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Zr extends Vn{constructor(lt,De,Ke,Tt,xn,Bn,Mr,Lr){const hi=Tt+"-"+Ke.id;super(lt,De,Ke,xn,Bn,Mr,Lr,hi),this.contentAttr=function ln(Ze){return"_ngcontent-%COMP%".replace(Jn,Ze)}(hi),this.hostAttr=function Wn(Ze){return"_nghost-%COMP%".replace(Jn,Ze)}(hi)}applyToHost(lt){this.applyStyles(),this.setAttribute(lt,this.hostAttr,"")}createElement(lt,De){const Ke=super.createElement(lt,De);return super.setAttribute(Ke,this.contentAttr,""),Ke}}let Ln=(()=>{class Ze extends Bt{constructor(De){super(De)}supports(De){return!0}addEventListener(De,Ke,Tt){return De.addEventListener(Ke,Tt,!1),()=>this.removeEventListener(De,Ke,Tt)}removeEventListener(De,Ke,Tt){return De.removeEventListener(Ke,Tt)}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(bt.K0))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();const Ir=["alt","control","meta","shift"],At={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nt={alt:Ze=>Ze.altKey,control:Ze=>Ze.ctrlKey,meta:Ze=>Ze.metaKey,shift:Ze=>Ze.shiftKey};let Zt=(()=>{class Ze extends Bt{constructor(De){super(De)}supports(De){return null!=Ze.parseEventName(De)}addEventListener(De,Ke,Tt){const xn=Ze.parseEventName(Ke),Bn=Ze.eventCallback(xn.fullKey,Tt,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,bt.q)().onAndCancel(De,xn.domEventName,Bn))}static parseEventName(De){const Ke=De.toLowerCase().split("."),Tt=Ke.shift();if(0===Ke.length||"keydown"!==Tt&&"keyup"!==Tt)return null;const xn=Ze._normalizeKey(Ke.pop());let Bn="",Mr=Ke.indexOf("code");if(Mr>-1&&(Ke.splice(Mr,1),Bn="code."),Ir.forEach(hi=>{const zi=Ke.indexOf(hi);zi>-1&&(Ke.splice(zi,1),Bn+=hi+".")}),Bn+=xn,0!=Ke.length||0===xn.length)return null;const Lr={};return Lr.domEventName=Tt,Lr.fullKey=Bn,Lr}static matchEventFullKeyCode(De,Ke){let Tt=At[De.key]||De.key,xn="";return Ke.indexOf("code.")>-1&&(Tt=De.code,xn="code."),!(null==Tt||!Tt)&&(Tt=Tt.toLowerCase()," "===Tt?Tt="space":"."===Tt&&(Tt="dot"),Ir.forEach(Bn=>{Bn!==Tt&&(0,Nt[Bn])(De)&&(xn+=Bn+".")}),xn+=Tt,xn===Ke)}static eventCallback(De,Ke,Tt){return xn=>{Ze.matchEventFullKeyCode(xn,De)&&Tt.runGuarded(()=>Ke(xn))}}static _normalizeKey(De){return"esc"===De?"escape":De}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(bt.K0))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:Ze.\u0275fac})}return Ze})();const Oi=(0,O.eFA)(O._c5,"browser",[{provide:O.Lbi,useValue:bt.bD},{provide:O.g9A,useValue:function Qn(){f.makeCurrent()},multi:!0},{provide:bt.K0,useFactory:function ir(){return(0,O.RDi)(document),document},deps:[]}]),Gn=new O.OlP(""),Pi=[{provide:O.rWj,useClass:class xt{addToWindow(lt){O.dqk.getAngularTestability=(Ke,Tt=!0)=>{const xn=lt.findTestabilityInTree(Ke,Tt);if(null==xn)throw new O.vHH(5103,!1);return xn},O.dqk.getAllAngularTestabilities=()=>lt.getAllTestabilities(),O.dqk.getAllAngularRootElements=()=>lt.getAllRootElements(),O.dqk.frameworkStabilizers||(O.dqk.frameworkStabilizers=[]),O.dqk.frameworkStabilizers.push(Ke=>{const Tt=O.dqk.getAllAngularTestabilities();let xn=Tt.length,Bn=!1;const Mr=function(Lr){Bn=Bn||Lr,xn--,0==xn&&Ke(Bn)};Tt.forEach(Lr=>{Lr.whenStable(Mr)})})}findTestabilityInTree(lt,De,Ke){return null==De?null:lt.getTestability(De)??(Ke?(0,bt.q)().isShadowRoot(De)?this.findTestabilityInTree(lt,De.host,!0):this.findTestabilityInTree(lt,De.parentElement,!0):null)}},deps:[]},{provide:O.lri,useClass:O.dDg,deps:[O.R0b,O.eoX,O.rWj]},{provide:O.dDg,useClass:O.dDg,deps:[O.R0b,O.eoX,O.rWj]}],vi=[{provide:O.zSh,useValue:"root"},{provide:O.qLn,useFactory:function tr(){return new O.qLn},deps:[]},{provide:it,useClass:Ln,multi:!0,deps:[bt.K0,O.R0b,O.Lbi]},{provide:it,useClass:Zt,multi:!0,deps:[bt.K0]},Kt,un,dt,{provide:O.FYo,useExisting:Kt},{provide:bt.JF,useClass:ft,deps:[]},[]];let qr=(()=>{class Ze{constructor(De){}static withServerTransition(De){return{ngModule:Ze,providers:[{provide:O.AFp,useValue:De.appId}]}}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(Gn,12))};static#t=this.\u0275mod=O.oAB({type:Ze});static#n=this.\u0275inj=O.cJS({providers:[...vi,...Pi],imports:[bt.ez,O.hGG]})}return Ze})(),wr=(()=>{class Ze{constructor(De){this._doc=De}getTitle(){return this._doc.title}setTitle(De){this._doc.title=De||""}static#e=this.\u0275fac=function(Ke){return new(Ke||Ze)(O.LFG(bt.K0))};static#t=this.\u0275prov=O.Yz7({token:Ze,factory:function(Ke){let Tt=null;return Tt=Ke?new Ke:function Ai(){return new wr((0,O.LFG)(bt.K0))}(),Tt},providedIn:"root"})}return Ze})();typeof window<"u"&&window},180:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{gz:()=>Fo,m2:()=>Ii,F0:()=>Xs,rH:()=>Kc,Od:()=>Ds,Bz:()=>Ac,lC:()=>Co});var O=_e(4946),bt=_e(5592),St=_e(4674),ze=_e(7715),ke=_e(2096),Vt=_e(5619),$t=_e(7453),xt=_e(2737),ft=_e(7400),it=_e(4564),dt=_e(2714),Bt=_e(8251),zt=_e(7103);function un(...B){const $=(0,it.yG)(B),F=(0,it.jO)(B),{args:q,keys:se}=(0,$t.D)(B);if(0===q.length)return(0,ze.D)([],$);const _=new bt.y(function jn(B,$,F=xt.y){return q=>{Jn($,()=>{const{length:se}=B,_=new Array(se);let i=se,g=se;for(let y=0;y<se;y++)Jn($,()=>{const A=(0,ze.D)(B[y],$);let T=!1;A.subscribe((0,Bt.x)(q,N=>{_[y]=N,T||(T=!0,g--),g||q.next(F(_.slice()))},()=>{--i||q.complete()}))},q)},q)}}(q,$,se?i=>(0,dt.n)(se,i):xt.y));return F?_.pipe((0,ft.Z)(F)):_}function Jn(B,$,F){B?(0,zt.f)(F,B,$):$()}const Xt=(0,_e(2306).d)(B=>function(){B(this),this.name="EmptyError",this.message="no elements in sequence"});var rr=_e(7537);function gt(...B){return function kt(){return(0,rr.J)(1)}()((0,ze.D)(B,(0,it.yG)(B)))}var ln=_e(4829);function Wn(B){return new bt.y($=>{(0,ln.Xf)(B()).subscribe($)})}var Yt=_e(8407);function Kt(B,$){const F=(0,St.m)(B)?B:()=>B,q=se=>se.error(F());return new bt.y($?se=>$.schedule(q,0,se):q)}var dn=_e(6232),kn=_e(7394),di=_e(9360);function xo(){return(0,di.e)((B,$)=>{let F=null;B._refCount++;const q=(0,Bt.x)($,void 0,void 0,void 0,()=>{if(!B||B._refCount<=0||0<--B._refCount)return void(F=null);const se=B._connection,_=F;F=null,se&&(!_||se===_)&&se.unsubscribe(),$.unsubscribe()});B.subscribe(q),q.closed||(F=B.connect())})}class xr extends bt.y{constructor($,F){super(),this.source=$,this.subjectFactory=F,this._subject=null,this._refCount=0,this._connection=null,(0,di.A)($)&&(this.lift=$.lift)}_subscribe($){return this.getSubject().subscribe($)}getSubject(){const $=this._subject;return(!$||$.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:$}=this;this._subject=this._connection=null,$?.unsubscribe()}connect(){let $=this._connection;if(!$){$=this._connection=new kn.w0;const F=this.getSubject();$.add(this.source.subscribe((0,Bt.x)(F,void 0,()=>{this._teardown(),F.complete()},q=>{this._teardown(),F.error(q)},()=>this._teardown()))),$.closed&&(this._connection=null,$=kn.w0.EMPTY)}return $}refCount(){return xo()(this)}}var Vn=_e(8645),Zr=_e(6814),Ln=_e(7398),Ir=_e(4664);function At(B){return B<=0?()=>dn.E:(0,di.e)(($,F)=>{let q=0;$.subscribe((0,Bt.x)(F,se=>{++q<=B&&(F.next(se),B<=q&&F.complete())}))})}var Zt=_e(2181),mt=_e(1631);function rn(B){return(0,di.e)(($,F)=>{let q=!1;$.subscribe((0,Bt.x)(F,se=>{q=!0,F.next(se)},()=>{q||F.next(B),F.complete()}))})}function _n(B=gr){return(0,di.e)(($,F)=>{let q=!1;$.subscribe((0,Bt.x)(F,se=>{q=!0,F.next(se)},()=>q?F.complete():F.error(B())))})}function gr(){return new Xt}function Qn(B,$){const F=arguments.length>=2;return q=>q.pipe(B?(0,Zt.h)((se,_)=>B(se,_,q)):xt.y,At(1),F?rn($):_n(()=>new Xt))}var tr=_e(6328),ir=_e(9397),nn=_e(6306);function Pi(B){return B<=0?()=>dn.E:(0,di.e)(($,F)=>{let q=[];$.subscribe((0,Bt.x)(F,se=>{q.push(se),B<q.length&&q.shift()},()=>{for(const se of q)F.next(se);F.complete()},void 0,()=>{q=null}))})}var Ci=_e(4716),Ni=_e(2420),Ai=_e(6593);const wr="primary",Pr=Symbol("RouteTitle");class xi{constructor($){this.params=$||{}}has($){return Object.prototype.hasOwnProperty.call(this.params,$)}get($){if(this.has($)){const F=this.params[$];return Array.isArray(F)?F[0]:F}return null}getAll($){if(this.has($)){const F=this.params[$];return Array.isArray(F)?F:[F]}return[]}get keys(){return Object.keys(this.params)}}function _r(B){return new xi(B)}function Rr(B,$,F){const q=F.path.split("/");if(q.length>B.length||"full"===F.pathMatch&&($.hasChildren()||q.length<B.length))return null;const se={};for(let _=0;_<q.length;_++){const i=q[_],g=B[_];if(i.startsWith(":"))se[i.substring(1)]=g;else if(i!==g.path)return null}return{consumed:B.slice(0,q.length),posParams:se}}function Mo(B,$){const F=B?Object.keys(B):void 0,q=$?Object.keys($):void 0;if(!F||!q||F.length!=q.length)return!1;let se;for(let _=0;_<F.length;_++)if(se=F[_],!Ho(B[se],$[se]))return!1;return!0}function Ho(B,$){if(Array.isArray(B)&&Array.isArray($)){if(B.length!==$.length)return!1;const F=[...B].sort(),q=[...$].sort();return F.every((se,_)=>q[_]===se)}return B===$}function qt(B){return B.length>0?B[B.length-1]:null}function Xi(B){return function f(B){return!!B&&(B instanceof bt.y||(0,St.m)(B.lift)&&(0,St.m)(B.subscribe))}(B)?B:(0,O.QGY)(B)?(0,ze.D)(Promise.resolve(B)):(0,ke.of)(B)}const si={exact:function nr(B,$,F){if(!st(B.segments,$.segments)||!ve(B.segments,$.segments,F)||B.numberOfChildren!==$.numberOfChildren)return!1;for(const q in $.children)if(!B.children[q]||!nr(B.children[q],$.children[q],F))return!1;return!0},subset:Ue},po={exact:function wo(B,$){return Mo(B,$)},subset:function Bs(B,$){return Object.keys($).length<=Object.keys(B).length&&Object.keys($).every(F=>Ho(B[F],$[F]))},ignored:()=>!0};function Jr(B,$,F){return si[F.paths](B.root,$.root,F.matrixParams)&&po[F.queryParams](B.queryParams,$.queryParams)&&!("exact"===F.fragment&&B.fragment!==$.fragment)}function Ue(B,$,F){return ge(B,$,$.segments,F)}function ge(B,$,F,q){if(B.segments.length>F.length){const se=B.segments.slice(0,F.length);return!(!st(se,F)||$.hasChildren()||!ve(se,F,q))}if(B.segments.length===F.length){if(!st(B.segments,F)||!ve(B.segments,F,q))return!1;for(const se in $.children)if(!B.children[se]||!Ue(B.children[se],$.children[se],q))return!1;return!0}{const se=F.slice(0,B.segments.length),_=F.slice(B.segments.length);return!!(st(B.segments,se)&&ve(B.segments,se,q)&&B.children[wr])&&ge(B.children[wr],$,_,q)}}function ve(B,$,F){return $.every((q,se)=>po[F](B[se].parameters,q.parameters))}class Re{constructor($=new Oe([],{}),F={},q=null){this.root=$,this.queryParams=F,this.fragment=q}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_r(this.queryParams)),this._queryParamMap}toString(){return Mn.serialize(this)}}class Oe{constructor($,F){this.segments=$,this.children=F,this.parent=null,Object.values(F).forEach(q=>q.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ze(this)}}class rt{constructor($,F){this.path=$,this.parameters=F}get parameterMap(){return this._parameterMap||(this._parameterMap=_r(this.parameters)),this._parameterMap}toString(){return Lr(this)}}function st(B,$){return B.length===$.length&&B.every((F,q)=>F.path===$[q].path)}let Dt=(()=>{class B{static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:function(){return new pn},providedIn:"root"})}return B})();class pn{parse($){const F=new br($);return new Re(F.parseRootSegment(),F.parseQueryParams(),F.parseFragment())}serialize($){const F=`/${lt($.root,!0)}`,q=function zi(B){const $=Object.keys(B).map(F=>{const q=B[F];return Array.isArray(q)?q.map(se=>`${Ke(F)}=${Ke(se)}`).join("&"):`${Ke(F)}=${Ke(q)}`}).filter(F=>!!F);return $.length?`?${$.join("&")}`:""}($.queryParams);return`${F}${q}${"string"==typeof $.fragment?`#${function Tt(B){return encodeURI(B)}($.fragment)}`:""}`}}const Mn=new pn;function Ze(B){return B.segments.map($=>Lr($)).join("/")}function lt(B,$){if(!B.hasChildren())return Ze(B);if($){const F=B.children[wr]?lt(B.children[wr],!1):"",q=[];return Object.entries(B.children).forEach(([se,_])=>{se!==wr&&q.push(`${se}:${lt(_,!1)}`)}),q.length>0?`${F}(${q.join("//")})`:F}{const F=function Ye(B,$){let F=[];return Object.entries(B.children).forEach(([q,se])=>{q===wr&&(F=F.concat($(se,q)))}),Object.entries(B.children).forEach(([q,se])=>{q!==wr&&(F=F.concat($(se,q)))}),F}(B,(q,se)=>se===wr?[lt(B.children[wr],!1)]:[`${se}:${lt(q,!1)}`]);return 1===Object.keys(B.children).length&&null!=B.children[wr]?`${Ze(B)}/${F[0]}`:`${Ze(B)}/(${F.join("//")})`}}function De(B){return encodeURIComponent(B).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ke(B){return De(B).replace(/%3B/gi,";")}function xn(B){return De(B).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Bn(B){return decodeURIComponent(B)}function Mr(B){return Bn(B.replace(/\+/g,"%20"))}function Lr(B){return`${xn(B.path)}${function hi(B){return Object.keys(B).map($=>`;${xn($)}=${xn(B[$])}`).join("")}(B.parameters)}`}const Ji=/^[^\/()?;#]+/;function _t(B){const $=B.match(Ji);return $?$[0]:""}const Je=/^[^\/()?;=#]+/,an=/^[^=?&#]+/,In=/^[^&#]+/;class br{constructor($){this.url=$,this.remaining=$}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Oe([],{}):new Oe([],this.parseChildren())}parseQueryParams(){const $={};if(this.consumeOptional("?"))do{this.parseQueryParam($)}while(this.consumeOptional("&"));return $}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const $=[];for(this.peekStartsWith("(")||$.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),$.push(this.parseSegment());let F={};this.peekStartsWith("/(")&&(this.capture("/"),F=this.parseParens(!0));let q={};return this.peekStartsWith("(")&&(q=this.parseParens(!1)),($.length>0||Object.keys(F).length>0)&&(q[wr]=new Oe($,F)),q}parseSegment(){const $=_t(this.remaining);if(""===$&&this.peekStartsWith(";"))throw new O.vHH(4009,!1);return this.capture($),new rt(Bn($),this.parseMatrixParams())}parseMatrixParams(){const $={};for(;this.consumeOptional(";");)this.parseParam($);return $}parseParam($){const F=function ct(B){const $=B.match(Je);return $?$[0]:""}(this.remaining);if(!F)return;this.capture(F);let q="";if(this.consumeOptional("=")){const se=_t(this.remaining);se&&(q=se,this.capture(q))}$[Bn(F)]=Bn(q)}parseQueryParam($){const F=function en(B){const $=B.match(an);return $?$[0]:""}(this.remaining);if(!F)return;this.capture(F);let q="";if(this.consumeOptional("=")){const i=function zn(B){const $=B.match(In);return $?$[0]:""}(this.remaining);i&&(q=i,this.capture(q))}const se=Mr(F),_=Mr(q);if($.hasOwnProperty(se)){let i=$[se];Array.isArray(i)||(i=[i],$[se]=i),i.push(_)}else $[se]=_}parseParens($){const F={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const q=_t(this.remaining),se=this.remaining[q.length];if("/"!==se&&")"!==se&&";"!==se)throw new O.vHH(4010,!1);let _;q.indexOf(":")>-1?(_=q.slice(0,q.indexOf(":")),this.capture(_),this.capture(":")):$&&(_=wr);const i=this.parseChildren();F[_]=1===Object.keys(i).length?i[wr]:new Oe([],i),this.consumeOptional("//")}return F}peekStartsWith($){return this.remaining.startsWith($)}consumeOptional($){return!!this.peekStartsWith($)&&(this.remaining=this.remaining.substring($.length),!0)}capture($){if(!this.consumeOptional($))throw new O.vHH(4011,!1)}}function Sr(B){return B.segments.length>0?new Oe([],{[wr]:B}):B}function Ui(B){const $={};for(const q of Object.keys(B.children)){const _=Ui(B.children[q]);if(q===wr&&0===_.segments.length&&_.hasChildren())for(const[i,g]of Object.entries(_.children))$[i]=g;else(_.segments.length>0||_.hasChildren())&&($[q]=_)}return function Fi(B){if(1===B.numberOfChildren&&B.children[wr]){const $=B.children[wr];return new Oe(B.segments.concat($.segments),$.children)}return B}(new Oe(B.segments,$))}function _o(B){return B instanceof Re}function Vi(B){let $;const se=Sr(function F(_){const i={};for(const y of _.children){const A=F(y);i[y.outlet]=A}const g=new Oe(_.url,i);return _===B&&($=g),g}(B.root));return $??se}function ro(B,$,F,q){let se=B;for(;se.parent;)se=se.parent;if(0===$.length)return vr(se,se,se,F,q);const _=function Gs(B){if("string"==typeof B[0]&&1===B.length&&"/"===B[0])return new ai(!0,0,B);let $=0,F=!1;const q=B.reduce((se,_,i)=>{if("object"==typeof _&&null!=_){if(_.outlets){const g={};return Object.entries(_.outlets).forEach(([y,A])=>{g[y]="string"==typeof A?A.split("/"):A}),[...se,{outlets:g}]}if(_.segmentPath)return[...se,_.segmentPath]}return"string"!=typeof _?[...se,_]:0===i?(_.split("/").forEach((g,y)=>{0==y&&"."===g||(0==y&&""===g?F=!0:".."===g?$++:""!=g&&se.push(g))}),se):[...se,_]},[]);return new ai(F,$,q)}($);if(_.toRoot())return vr(se,se,new Oe([],{}),F,q);const i=function ka(B,$,F){if(B.isAbsolute)return new Zn($,!0,0);if(!F)return new Zn($,!1,NaN);if(null===F.parent)return new Zn(F,!0,0);const q=yi(B.commands[0])?0:1;return function Go(B,$,F){let q=B,se=$,_=F;for(;_>se;){if(_-=se,q=q.parent,!q)throw new O.vHH(4005,!1);se=q.segments.length}return new Zn(q,!1,se-_)}(F,F.segments.length-1+q,B.numberOfDoubleDots)}(_,se,B),g=i.processChildren?Hr(i.segmentGroup,i.index,_.commands):Fn(i.segmentGroup,i.index,_.commands);return vr(se,i.segmentGroup,g,F,q)}function yi(B){return"object"==typeof B&&null!=B&&!B.outlets&&!B.segmentPath}function Et(B){return"object"==typeof B&&null!=B&&B.outlets}function vr(B,$,F,q,se){let i,_={};q&&Object.entries(q).forEach(([y,A])=>{_[y]=Array.isArray(A)?A.map(T=>`${T}`):`${A}`}),i=B===$?F:Cr(B,$,F);const g=Sr(Ui(i));return new Re(g,_,se)}function Cr(B,$,F){const q={};return Object.entries(B.children).forEach(([se,_])=>{q[se]=_===$?F:Cr(_,$,F)}),new Oe(B.segments,q)}class ai{constructor($,F,q){if(this.isAbsolute=$,this.numberOfDoubleDots=F,this.commands=q,$&&q.length>0&&yi(q[0]))throw new O.vHH(4003,!1);const se=q.find(Et);if(se&&se!==qt(q))throw new O.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Zn{constructor($,F,q){this.segmentGroup=$,this.processChildren=F,this.index=q}}function Fn(B,$,F){if(B||(B=new Oe([],{})),0===B.segments.length&&B.hasChildren())return Hr(B,$,F);const q=function kr(B,$,F){let q=0,se=$;const _={match:!1,pathIndex:0,commandIndex:0};for(;se<B.segments.length;){if(q>=F.length)return _;const i=B.segments[se],g=F[q];if(Et(g))break;const y=`${g}`,A=q<F.length-1?F[q+1]:null;if(se>0&&void 0===y)break;if(y&&A&&"object"==typeof A&&void 0===A.outlets){if(!$o(y,A,i))return _;q+=2}else{if(!$o(y,{},i))return _;q++}se++}return{match:!0,pathIndex:se,commandIndex:q}}(B,$,F),se=F.slice(q.commandIndex);if(q.match&&q.pathIndex<B.segments.length){const _=new Oe(B.segments.slice(0,q.pathIndex),{});return _.children[wr]=new Oe(B.segments.slice(q.pathIndex),B.children),Hr(_,0,se)}return q.match&&0===se.length?new Oe(B.segments,{}):q.match&&!B.hasChildren()?bo(B,$,F):q.match?Hr(B,0,se):bo(B,$,F)}function Hr(B,$,F){if(0===F.length)return new Oe(B.segments,{});{const q=function Qs(B){return Et(B[0])?B[0].outlets:{[wr]:B}}(F),se={};if(Object.keys(q).some(_=>_!==wr)&&B.children[wr]&&1===B.numberOfChildren&&0===B.children[wr].segments.length){const _=Hr(B.children[wr],$,F);return new Oe(B.segments,_.children)}return Object.entries(q).forEach(([_,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(se[_]=Fn(B.children[_],$,i))}),Object.entries(B.children).forEach(([_,i])=>{void 0===q[_]&&(se[_]=i)}),new Oe(B.segments,se)}}function bo(B,$,F){const q=B.segments.slice(0,$);let se=0;for(;se<F.length;){const _=F[se];if(Et(_)){const y=ws(_.outlets);return new Oe(q,y)}if(0===se&&yi(F[0])){q.push(new rt(B.segments[$].path,Vr(F[0]))),se++;continue}const i=Et(_)?_.outlets[wr]:`${_}`,g=se<F.length-1?F[se+1]:null;i&&g&&yi(g)?(q.push(new rt(i,Vr(g))),se+=2):(q.push(new rt(i,{})),se++)}return new Oe(q,{})}function ws(B){const $={};return Object.entries(B).forEach(([F,q])=>{"string"==typeof q&&(q=[q]),null!==q&&($[F]=bo(new Oe([],{}),0,q))}),$}function Vr(B){const $={};return Object.entries(B).forEach(([F,q])=>$[F]=`${q}`),$}function $o(B,$,F){return B==F.path&&Mo($,F.parameters)}const fa="imperative";class as{constructor($,F){this.id=$,this.url=F}}class ls extends as{constructor($,F,q="imperative",se=null){super($,F),this.type=0,this.navigationTrigger=q,this.restoredState=se}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Ii extends as{constructor($,F,q){super($,F),this.urlAfterRedirects=q,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class gs extends as{constructor($,F,q,se){super($,F),this.reason=q,this.code=se,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class ji extends as{constructor($,F,q,se){super($,F),this.reason=q,this.code=se,this.type=16}}class ko extends as{constructor($,F,q,se){super($,F),this.error=q,this.target=se,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Za extends as{constructor($,F,q,se){super($,F),this.urlAfterRedirects=q,this.state=se,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ll extends as{constructor($,F,q,se){super($,F),this.urlAfterRedirects=q,this.state=se,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yl extends as{constructor($,F,q,se,_){super($,F),this.urlAfterRedirects=q,this.state=se,this.shouldActivate=_,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ba extends as{constructor($,F,q,se){super($,F),this.urlAfterRedirects=q,this.state=se,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ea extends as{constructor($,F,q,se){super($,F),this.urlAfterRedirects=q,this.state=se,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cl{constructor($){this.route=$,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ul{constructor($){this.route=$,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Di{constructor($){this.snapshot=$,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Eo{constructor($){this.snapshot=$,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Vl{constructor($){this.snapshot=$,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class dl{constructor($){this.snapshot=$,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bs{constructor($,F,q){this.routerEvent=$,this.position=F,this.anchor=q,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Qo{}class qa{constructor($){this.url=$}}class go{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new $s,this.attachRef=null}}let $s=(()=>{class B{constructor(){this.contexts=new Map}onChildOutletCreated(F,q){const se=this.getOrCreateContext(F);se.outlet=q,this.contexts.set(F,se)}onChildOutletDestroyed(F){const q=this.getContext(F);q&&(q.outlet=null,q.attachRef=null)}onOutletDeactivated(){const F=this.contexts;return this.contexts=new Map,F}onOutletReAttached(F){this.contexts=F}getOrCreateContext(F){let q=this.getContext(F);return q||(q=new go,this.contexts.set(F,q)),q}getContext(F){return this.contexts.get(F)||null}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();class Ea{constructor($){this._root=$}get root(){return this._root.value}parent($){const F=this.pathFromRoot($);return F.length>1?F[F.length-2]:null}children($){const F=zr($,this._root);return F?F.children.map(q=>q.value):[]}firstChild($){const F=zr($,this._root);return F&&F.children.length>0?F.children[0].value:null}siblings($){const F=ti($,this._root);return F.length<2?[]:F[F.length-2].children.map(se=>se.value).filter(se=>se!==$)}pathFromRoot($){return ti($,this._root).map(F=>F.value)}}function zr(B,$){if(B===$.value)return $;for(const F of $.children){const q=zr(B,F);if(q)return q}return null}function ti(B,$){if(B===$.value)return[$];for(const F of $.children){const q=ti(B,F);if(q.length)return q.unshift($),q}return[]}class Ri{constructor($,F){this.value=$,this.children=F}toString(){return`TreeNode(${this.value})`}}function es(B){const $={};return B&&B.children.forEach(F=>$[F.value.outlet]=F),$}class Qi extends Ea{constructor($,F){super($),this.snapshot=F,Dr(this,$)}toString(){return this.snapshot.toString()}}function pa(B,$){const F=function Fa(B,$){const i=new mi([],{},{},"",{},wr,$,null,{});return new er("",new Ri(i,[]))}(0,$),q=new Vt.X([new rt("",{})]),se=new Vt.X({}),_=new Vt.X({}),i=new Vt.X({}),g=new Vt.X(""),y=new Fo(q,se,i,g,_,wr,$,F.root);return y.snapshot=F.root,new Qi(new Ri(y,[]),F)}class Fo{constructor($,F,q,se,_,i,g,y){this.urlSubject=$,this.paramsSubject=F,this.queryParamsSubject=q,this.fragmentSubject=se,this.dataSubject=_,this.outlet=i,this.component=g,this._futureSnapshot=y,this.title=this.dataSubject?.pipe((0,Ln.U)(A=>A[Pr]))??(0,ke.of)(void 0),this.url=$,this.params=F,this.queryParams=q,this.fragment=se,this.data=_}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Ln.U)($=>_r($)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Ln.U)($=>_r($)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ba(B,$="emptyOnly"){const F=B.pathFromRoot;let q=0;if("always"!==$)for(q=F.length-1;q>=1;){const se=F[q],_=F[q-1];if(se.routeConfig&&""===se.routeConfig.path)q--;else{if(_.component)break;q--}}return function Ca(B){return B.reduce(($,F)=>({params:{...$.params,...F.params},data:{...$.data,...F.data},resolve:{...F.data,...$.resolve,...F.routeConfig?.data,...F._resolvedData}}),{params:{},data:{},resolve:{}})}(F.slice(q))}class mi{get title(){return this.data?.[Pr]}constructor($,F,q,se,_,i,g,y,A){this.url=$,this.params=F,this.queryParams=q,this.fragment=se,this.data=_,this.outlet=i,this.component=g,this.routeConfig=y,this._resolve=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=_r(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=_r(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(q=>q.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class er extends Ea{constructor($,F){super(F),this.url=$,Dr(this,F)}toString(){return ni(this._root)}}function Dr(B,$){$.value._routerState=B,$.children.forEach(F=>Dr(B,F))}function ni(B){const $=B.children.length>0?` { ${B.children.map(ni).join(", ")} } `:"";return`${B.value}${$}`}function cs(B){if(B.snapshot){const $=B.snapshot,F=B._futureSnapshot;B.snapshot=F,Mo($.queryParams,F.queryParams)||B.queryParamsSubject.next(F.queryParams),$.fragment!==F.fragment&&B.fragmentSubject.next(F.fragment),Mo($.params,F.params)||B.paramsSubject.next(F.params),function ur(B,$){if(B.length!==$.length)return!1;for(let F=0;F<B.length;++F)if(!Mo(B[F],$[F]))return!1;return!0}($.url,F.url)||B.urlSubject.next(F.url),Mo($.data,F.data)||B.dataSubject.next(F.data)}else B.snapshot=B._futureSnapshot,B.dataSubject.next(B._futureSnapshot.data)}function ts(B,$){const F=Mo(B.params,$.params)&&function wt(B,$){return st(B,$)&&B.every((F,q)=>Mo(F.parameters,$[q].parameters))}(B.url,$.url);return F&&!(!B.parent!=!$.parent)&&(!B.parent||ts(B.parent,$.parent))}let Co=(()=>{class B{constructor(){this.activated=null,this._activatedRoute=null,this.name=wr,this.activateEvents=new O.vpe,this.deactivateEvents=new O.vpe,this.attachEvents=new O.vpe,this.detachEvents=new O.vpe,this.parentContexts=(0,O.f3M)($s),this.location=(0,O.f3M)(O.s_b),this.changeDetector=(0,O.f3M)(O.sBO),this.environmentInjector=(0,O.f3M)(O.lqb),this.inputBinder=(0,O.f3M)(Fr,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(F){if(F.name){const{firstChange:q,previousValue:se}=F.name;if(q)return;this.isTrackedInParentContexts(se)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(se)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(F){return this.parentContexts.getContext(F)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const F=this.parentContexts.getContext(this.name);F?.route&&(F.attachRef?this.attach(F.attachRef,F.route):this.activateWith(F.route,F.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new O.vHH(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new O.vHH(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new O.vHH(4012,!1);this.location.detach();const F=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(F.instance),F}attach(F,q){this.activated=F,this._activatedRoute=q,this.location.insert(F.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(F.instance)}deactivate(){if(this.activated){const F=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(F)}}activateWith(F,q){if(this.isActivated)throw new O.vHH(4013,!1);this._activatedRoute=F;const se=this.location,i=F.snapshot.component,g=this.parentContexts.getOrCreateContext(this.name).children,y=new Aa(F,g,se.injector);this.activated=se.createComponent(i,{index:se.length,injector:y,environmentInjector:q??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275dir=O.lG2({type:B,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[O.TTD]})}return B})();class Aa{constructor($,F,q){this.route=$,this.childContexts=F,this.parent=q}get($,F){return $===Fo?this.route:$===$s?this.childContexts:this.parent.get($,F)}}const Fr=new O.OlP("");let Ws=(()=>{class B{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(F){this.unsubscribeFromRouteData(F),this.subscribeToRouteData(F)}unsubscribeFromRouteData(F){this.outletDataSubscriptions.get(F)?.unsubscribe(),this.outletDataSubscriptions.delete(F)}subscribeToRouteData(F){const{activatedRoute:q}=F,se=un([q.queryParams,q.params,q.data]).pipe((0,Ir.w)(([_,i,g],y)=>(g={..._,...i,...g},0===y?(0,ke.of)(g):Promise.resolve(g)))).subscribe(_=>{if(!F.isActivated||!F.activatedComponentRef||F.activatedRoute!==q||null===q.component)return void this.unsubscribeFromRouteData(F);const i=(0,O.qFp)(q.component);if(i)for(const{templateName:g}of i.inputs)F.activatedComponentRef.setInput(g,_[g]);else this.unsubscribeFromRouteData(F)});this.outletDataSubscriptions.set(F,se)}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac})}return B})();function Or(B,$,F){if(F&&B.shouldReuseRoute($.value,F.value.snapshot)){const q=F.value;q._futureSnapshot=$.value;const se=function zs(B,$,F){return $.children.map(q=>{for(const se of F.children)if(B.shouldReuseRoute(q.value,se.value.snapshot))return Or(B,q,se);return Or(B,q)})}(B,$,F);return new Ri(q,se)}{if(B.shouldAttach($.value)){const _=B.retrieve($.value);if(null!==_){const i=_.route;return i.value._futureSnapshot=$.value,i.children=$.children.map(g=>Or(B,g)),i}}const q=function ms(B){return new Fo(new Vt.X(B.url),new Vt.X(B.params),new Vt.X(B.queryParams),new Vt.X(B.fragment),new Vt.X(B.data),B.outlet,B.component,B)}($.value),se=$.children.map(_=>Or(B,_));return new Ri(q,se)}}const Xr="ngNavigationCancelingError";function lo(B,$){const{redirectTo:F,navigationBehaviorOptions:q}=_o($)?{redirectTo:$,navigationBehaviorOptions:void 0}:$,se=na(!1,0,$);return se.url=F,se.navigationBehaviorOptions=q,se}function na(B,$,F){const q=new Error("NavigationCancelingError: "+(B||""));return q[Xr]=!0,q.cancellationCode=$,F&&(q.url=F),q}function Es(B){return B&&B[Xr]}let ns=(()=>{class B{static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275cmp=O.Xpm({type:B,selectors:[["ng-component"]],standalone:!0,features:[O.jDz],decls:1,vars:0,template:function(q,se){1&q&&O._UZ(0,"router-outlet")},dependencies:[Co],encapsulation:2})}return B})();function oa(B){const $=B.children&&B.children.map(oa),F=$?{...B,children:$}:{...B};return!F.component&&!F.loadComponent&&($||F.loadChildren)&&F.outlet&&F.outlet!==wr&&(F.component=ns),F}function vs(B){return B.outlet||wr}function Zs(B){if(!B)return null;if(B.routeConfig?._injector)return B.routeConfig._injector;for(let $=B.parent;$;$=$.parent){const F=$.routeConfig;if(F?._loadedInjector)return F._loadedInjector;if(F?._injector)return F._injector}return null}class ie{constructor($,F,q,se,_){this.routeReuseStrategy=$,this.futureState=F,this.currState=q,this.forwardEvent=se,this.inputBindingEnabled=_}activate($){const F=this.futureState._root,q=this.currState?this.currState._root:null;this.deactivateChildRoutes(F,q,$),cs(this.futureState.root),this.activateChildRoutes(F,q,$)}deactivateChildRoutes($,F,q){const se=es(F);$.children.forEach(_=>{const i=_.value.outlet;this.deactivateRoutes(_,se[i],q),delete se[i]}),Object.values(se).forEach(_=>{this.deactivateRouteAndItsChildren(_,q)})}deactivateRoutes($,F,q){const se=$.value,_=F?F.value:null;if(se===_)if(se.component){const i=q.getContext(se.outlet);i&&this.deactivateChildRoutes($,F,i.children)}else this.deactivateChildRoutes($,F,q);else _&&this.deactivateRouteAndItsChildren(F,q)}deactivateRouteAndItsChildren($,F){$.value.component&&this.routeReuseStrategy.shouldDetach($.value.snapshot)?this.detachAndStoreRouteSubtree($,F):this.deactivateRouteAndOutlet($,F)}detachAndStoreRouteSubtree($,F){const q=F.getContext($.value.outlet),se=q&&$.value.component?q.children:F,_=es($);for(const i of Object.keys(_))this.deactivateRouteAndItsChildren(_[i],se);if(q&&q.outlet){const i=q.outlet.detach(),g=q.children.onOutletDeactivated();this.routeReuseStrategy.store($.value.snapshot,{componentRef:i,route:$,contexts:g})}}deactivateRouteAndOutlet($,F){const q=F.getContext($.value.outlet),se=q&&$.value.component?q.children:F,_=es($);for(const i of Object.keys(_))this.deactivateRouteAndItsChildren(_[i],se);q&&(q.outlet&&(q.outlet.deactivate(),q.children.onOutletDeactivated()),q.attachRef=null,q.route=null)}activateChildRoutes($,F,q){const se=es(F);$.children.forEach(_=>{this.activateRoutes(_,se[_.value.outlet],q),this.forwardEvent(new dl(_.value.snapshot))}),$.children.length&&this.forwardEvent(new Eo($.value.snapshot))}activateRoutes($,F,q){const se=$.value,_=F?F.value:null;if(cs(se),se===_)if(se.component){const i=q.getOrCreateContext(se.outlet);this.activateChildRoutes($,F,i.children)}else this.activateChildRoutes($,F,q);else if(se.component){const i=q.getOrCreateContext(se.outlet);if(this.routeReuseStrategy.shouldAttach(se.snapshot)){const g=this.routeReuseStrategy.retrieve(se.snapshot);this.routeReuseStrategy.store(se.snapshot,null),i.children.onOutletReAttached(g.contexts),i.attachRef=g.componentRef,i.route=g.route.value,i.outlet&&i.outlet.attach(g.componentRef,g.route.value),cs(g.route.value),this.activateChildRoutes($,null,i.children)}else{const g=Zs(se.snapshot);i.attachRef=null,i.route=se,i.injector=g,i.outlet&&i.outlet.activateWith(se,i.injector),this.activateChildRoutes($,null,i.children)}}else this.activateChildRoutes($,null,q)}}class K{constructor($){this.path=$,this.route=this.path[this.path.length-1]}}class le{constructor($,F){this.component=$,this.route=F}}function Ie(B,$,F){const q=B._root;return vn(q,$?$._root:null,F,[q.value])}function yt(B,$){const F=Symbol(),q=$.get(B,F);return q===F?"function"!=typeof B||(0,O.Z0I)(B)?$.get(B):B:q}function vn(B,$,F,q,se={canDeactivateChecks:[],canActivateChecks:[]}){const _=es($);return B.children.forEach(i=>{(function Sn(B,$,F,q,se={canDeactivateChecks:[],canActivateChecks:[]}){const _=B.value,i=$?$.value:null,g=F?F.getContext(B.value.outlet):null;if(i&&_.routeConfig===i.routeConfig){const y=function re(B,$,F){if("function"==typeof F)return F(B,$);switch(F){case"pathParamsChange":return!st(B.url,$.url);case"pathParamsOrQueryParamsChange":return!st(B.url,$.url)||!Mo(B.queryParams,$.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ts(B,$)||!Mo(B.queryParams,$.queryParams);default:return!ts(B,$)}}(i,_,_.routeConfig.runGuardsAndResolvers);y?se.canActivateChecks.push(new K(q)):(_.data=i.data,_._resolvedData=i._resolvedData),vn(B,$,_.component?g?g.children:null:F,q,se),y&&g&&g.outlet&&g.outlet.isActivated&&se.canDeactivateChecks.push(new le(g.outlet.component,i))}else i&&ue($,g,se),se.canActivateChecks.push(new K(q)),vn(B,null,_.component?g?g.children:null:F,q,se)})(i,_[i.value.outlet],F,q.concat([i.value]),se),delete _[i.value.outlet]}),Object.entries(_).forEach(([i,g])=>ue(g,F.getContext(i),se)),se}function ue(B,$,F){const q=es(B),se=B.value;Object.entries(q).forEach(([_,i])=>{ue(i,se.component?$?$.children.getContext(_):null:$,F)}),F.canDeactivateChecks.push(new le(se.component&&$&&$.outlet&&$.outlet.isActivated?$.outlet.component:null,se))}function X(B){return"function"==typeof B}function eo(B){return B instanceof Xt||"EmptyError"===B?.name}const Qr=Symbol("INITIAL_VALUE");function Gr(){return(0,Ir.w)(B=>un(B.map($=>$.pipe(At(1),function Nt(...B){const $=(0,it.yG)(B);return(0,di.e)((F,q)=>{($?gt(B,F,$):gt(B,F)).subscribe(q)})}(Qr)))).pipe((0,Ln.U)($=>{for(const F of $)if(!0!==F){if(F===Qr)return Qr;if(!1===F||F instanceof Re)return F}return!0}),(0,Zt.h)($=>$!==Qr),At(1)))}function As(B){return(0,Yt.z)((0,ir.b)($=>{if(_o($))throw lo(0,$)}),(0,Ln.U)($=>!0===$))}class to{constructor($){this.segmentGroup=$||null}}class Ka{constructor($){this.urlTree=$}}function Oo(B){return Kt(new to(B))}function Ja(B){return Kt(new Ka(B))}class jl{constructor($,F){this.urlSerializer=$,this.urlTree=F}noMatchError($){return new O.vHH(4002,!1)}lineralizeSegments($,F){let q=[],se=F.root;for(;;){if(q=q.concat(se.segments),0===se.numberOfChildren)return(0,ke.of)(q);if(se.numberOfChildren>1||!se.children[wr])return Kt(new O.vHH(4e3,!1));se=se.children[wr]}}applyRedirectCommands($,F,q){return this.applyRedirectCreateUrlTree(F,this.urlSerializer.parse(F),$,q)}applyRedirectCreateUrlTree($,F,q,se){const _=this.createSegmentGroup($,F.root,q,se);return new Re(_,this.createQueryParams(F.queryParams,this.urlTree.queryParams),F.fragment)}createQueryParams($,F){const q={};return Object.entries($).forEach(([se,_])=>{if("string"==typeof _&&_.startsWith(":")){const g=_.substring(1);q[se]=F[g]}else q[se]=_}),q}createSegmentGroup($,F,q,se){const _=this.createSegments($,F.segments,q,se);let i={};return Object.entries(F.children).forEach(([g,y])=>{i[g]=this.createSegmentGroup($,y,q,se)}),new Oe(_,i)}createSegments($,F,q,se){return F.map(_=>_.path.startsWith(":")?this.findPosParam($,_,se):this.findOrReturn(_,q))}findPosParam($,F,q){const se=q[F.path.substring(1)];if(!se)throw new O.vHH(4001,!1);return se}findOrReturn($,F){let q=0;for(const se of F){if(se.path===$.path)return F.splice(q),se;q++}return $}}const ys={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function el(B,$,F,q,se){const _=fl(B,$,F);return _.matched?(q=function Xa(B,$){return B.providers&&!B._injector&&(B._injector=(0,O.MMx)(B.providers,$,`Route: ${B.path}`)),B._injector??$}($,q),function aa(B,$,F,q){const se=$.canMatch;if(!se||0===se.length)return(0,ke.of)(!0);const _=se.map(i=>{const g=yt(i,B);return Xi(function ii(B){return B&&X(B.canMatch)}(g)?g.canMatch($,F):B.runInContext(()=>g($,F)))});return(0,ke.of)(_).pipe(Gr(),As())}(q,$,F).pipe((0,Ln.U)(i=>!0===i?_:{...ys}))):(0,ke.of)(_)}function fl(B,$,F){if(""===$.path)return"full"===$.pathMatch&&(B.hasChildren()||F.length>0)?{...ys}:{matched:!0,consumedSegments:[],remainingSegments:F,parameters:{},positionalParamSegments:{}};const se=($.matcher||Rr)(F,B,$);if(!se)return{...ys};const _={};Object.entries(se.posParams??{}).forEach(([g,y])=>{_[g]=y.path});const i=se.consumed.length>0?{..._,...se.consumed[se.consumed.length-1].parameters}:_;return{matched:!0,consumedSegments:se.consumed,remainingSegments:F.slice(se.consumed.length),parameters:i,positionalParamSegments:se.posParams??{}}}function yl(B,$,F,q){return F.length>0&&function wc(B,$,F){return F.some(q=>ga(B,$,q)&&vs(q)!==wr)}(B,F,q)?{segmentGroup:new Oe($,sc(q,new Oe(F,B.children))),slicedSegments:[]}:0===F.length&&function pl(B,$,F){return F.some(q=>ga(B,$,q))}(B,F,q)?{segmentGroup:new Oe(B.segments,xl(B,0,F,q,B.children)),slicedSegments:F}:{segmentGroup:new Oe(B.segments,B.children),slicedSegments:F}}function xl(B,$,F,q,se){const _={};for(const i of q)if(ga(B,F,i)&&!se[vs(i)]){const g=new Oe([],{});_[vs(i)]=g}return{...se,..._}}function sc(B,$){const F={};F[wr]=$;for(const q of B)if(""===q.path&&vs(q)!==wr){const se=new Oe([],{});F[vs(q)]=se}return F}function ga(B,$,F){return(!(B.hasChildren()||$.length>0)||"full"!==F.pathMatch)&&""===F.path}class El{constructor($,F,q,se,_,i,g){this.injector=$,this.configLoader=F,this.rootComponentType=q,this.config=se,this.urlTree=_,this.paramsInheritanceStrategy=i,this.urlSerializer=g,this.allowRedirects=!0,this.applyRedirects=new jl(this.urlSerializer,this.urlTree)}noMatchError($){return new O.vHH(4002,!1)}recognize(){const $=yl(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,$,wr).pipe((0,nn.K)(F=>{if(F instanceof Ka)return this.allowRedirects=!1,this.urlTree=F.urlTree,this.match(F.urlTree);throw F instanceof to?this.noMatchError(F):F}),(0,Ln.U)(F=>{const q=new mi([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},wr,this.rootComponentType,null,{}),se=new Ri(q,F),_=new er("",se),i=function Jo(B,$,F=null,q=null){return ro(Vi(B),$,F,q)}(q,[],this.urlTree.queryParams,this.urlTree.fragment);return i.queryParams=this.urlTree.queryParams,_.url=this.urlSerializer.serialize(i),this.inheritParamsAndData(_._root),{state:_,tree:i}}))}match($){return this.processSegmentGroup(this.injector,this.config,$.root,wr).pipe((0,nn.K)(q=>{throw q instanceof to?this.noMatchError(q):q}))}inheritParamsAndData($){const F=$.value,q=Ba(F,this.paramsInheritanceStrategy);F.params=Object.freeze(q.params),F.data=Object.freeze(q.data),$.children.forEach(se=>this.inheritParamsAndData(se))}processSegmentGroup($,F,q,se){return 0===q.segments.length&&q.hasChildren()?this.processChildren($,F,q):this.processSegment($,F,q,q.segments,se,!0)}processChildren($,F,q){const se=[];for(const _ of Object.keys(q.children))"primary"===_?se.unshift(_):se.push(_);return(0,ze.D)(se).pipe((0,tr.b)(_=>{const i=q.children[_],g=function Ua(B,$){const F=B.filter(q=>vs(q)===$);return F.push(...B.filter(q=>vs(q)!==$)),F}(F,_);return this.processSegmentGroup($,g,i,_)}),function Gn(B,$){return(0,di.e)(function Oi(B,$,F,q,se){return(_,i)=>{let g=F,y=$,A=0;_.subscribe((0,Bt.x)(i,T=>{const N=A++;y=g?B(y,T,N):(g=!0,T),q&&i.next(y)},se&&(()=>{g&&i.next(y),i.complete()})))}}(B,$,arguments.length>=2,!0))}((_,i)=>(_.push(...i),_)),rn(null),function vi(B,$){const F=arguments.length>=2;return q=>q.pipe(B?(0,Zt.h)((se,_)=>B(se,_,q)):xt.y,Pi(1),F?rn($):_n(()=>new Xt))}(),(0,mt.z)(_=>{if(null===_)return Oo(q);const i=me(_);return function Ta(B){B.sort(($,F)=>$.value.outlet===wr?-1:F.value.outlet===wr?1:$.value.outlet.localeCompare(F.value.outlet))}(i),(0,ke.of)(i)}))}processSegment($,F,q,se,_,i){return(0,ze.D)(F).pipe((0,tr.b)(g=>this.processSegmentAgainstRoute(g._injector??$,F,g,q,se,_,i).pipe((0,nn.K)(y=>{if(y instanceof to)return(0,ke.of)(null);throw y}))),Qn(g=>!!g),(0,nn.K)(g=>{if(eo(g))return function bc(B,$,F){return 0===$.length&&!B.children[F]}(q,se,_)?(0,ke.of)([]):Oo(q);throw g}))}processSegmentAgainstRoute($,F,q,se,_,i,g){return function wl(B,$,F,q){return!!(vs(B)===q||q!==wr&&ga($,F,B))&&("**"===B.path||fl($,B,F).matched)}(q,se,_,i)?void 0===q.redirectTo?this.matchSegmentAgainstRoute($,se,q,_,i,g):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect($,se,F,q,_,i):Oo(se):Oo(se)}expandSegmentAgainstRouteUsingRedirect($,F,q,se,_,i){return"**"===se.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect($,q,se,i):this.expandRegularSegmentAgainstRouteUsingRedirect($,F,q,se,_,i)}expandWildCardWithParamsAgainstRouteUsingRedirect($,F,q,se){const _=this.applyRedirects.applyRedirectCommands([],q.redirectTo,{});return q.redirectTo.startsWith("/")?Ja(_):this.applyRedirects.lineralizeSegments(q,_).pipe((0,mt.z)(i=>{const g=new Oe(i,{});return this.processSegment($,F,g,i,se,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect($,F,q,se,_,i){const{matched:g,consumedSegments:y,remainingSegments:A,positionalParamSegments:T}=fl(F,se,_);if(!g)return Oo(F);const N=this.applyRedirects.applyRedirectCommands(y,se.redirectTo,T);return se.redirectTo.startsWith("/")?Ja(N):this.applyRedirects.lineralizeSegments(se,N).pipe((0,mt.z)(k=>this.processSegment($,q,F,k.concat(A),i,!1)))}matchSegmentAgainstRoute($,F,q,se,_,i){let g;if("**"===q.path){const y=se.length>0?qt(se).parameters:{},A=new mi(se,y,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fe(q),vs(q),q.component??q._loadedComponent??null,q,He(q));g=(0,ke.of)({snapshot:A,consumedSegments:[],remainingSegments:[]}),F.children={}}else g=el(F,q,se,$).pipe((0,Ln.U)(({matched:y,consumedSegments:A,remainingSegments:T,parameters:N})=>y?{snapshot:new mi(A,N,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,fe(q),vs(q),q.component??q._loadedComponent??null,q,He(q)),consumedSegments:A,remainingSegments:T}:null));return g.pipe((0,Ir.w)(y=>null===y?Oo(F):this.getChildConfig($=q._injector??$,q,se).pipe((0,Ir.w)(({routes:A})=>{const T=q._loadedInjector??$,{snapshot:N,consumedSegments:k,remainingSegments:H}=y,{segmentGroup:Q,slicedSegments:J}=yl(F,k,H,A);if(0===J.length&&Q.hasChildren())return this.processChildren(T,A,Q).pipe((0,Ln.U)(ye=>null===ye?null:[new Ri(N,ye)]));if(0===A.length&&0===J.length)return(0,ke.of)([new Ri(N,[])]);const de=vs(q)===_;return this.processSegment(T,A,Q,J,de?wr:_,!0).pipe((0,Ln.U)(ye=>[new Ri(N,ye)]))}))))}getChildConfig($,F,q){return F.children?(0,ke.of)({routes:F.children,injector:$}):F.loadChildren?void 0!==F._loadedRoutes?(0,ke.of)({routes:F._loadedRoutes,injector:F._loadedInjector}):function Cs(B,$,F,q){const se=$.canLoad;if(void 0===se||0===se.length)return(0,ke.of)(!0);const _=se.map(i=>{const g=yt(i,B);return Xi(function qe(B){return B&&X(B.canLoad)}(g)?g.canLoad($,F):B.runInContext(()=>g($,F)))});return(0,ke.of)(_).pipe(Gr(),As())}($,F,q).pipe((0,mt.z)(se=>se?this.configLoader.loadChildren($,F).pipe((0,ir.b)(_=>{F._loadedRoutes=_.routes,F._loadedInjector=_.injector})):function Qa(B){return Kt(na(!1,3))}())):(0,ke.of)({routes:[],injector:$})}}function j(B){const $=B.value.routeConfig;return $&&""===$.path}function me(B){const $=[],F=new Set;for(const q of B){if(!j(q)){$.push(q);continue}const se=$.find(_=>q.value.routeConfig===_.value.routeConfig);void 0!==se?(se.children.push(...q.children),F.add(se)):$.push(q)}for(const q of F){const se=me(q.children);$.push(new Ri(q.value,se))}return $.filter(q=>!F.has(q))}function fe(B){return B.data||{}}function He(B){return B.resolve||{}}function Yr(B){return"string"==typeof B.title||null===B.title}function Ao(B){return(0,Ir.w)($=>{const F=B($);return F?(0,ze.D)(F).pipe((0,Ln.U)(()=>$)):(0,ke.of)($)})}const bi=new O.OlP("ROUTES");let ds=(()=>{class B{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,O.f3M)(O.Sil)}loadComponent(F){if(this.componentLoaders.get(F))return this.componentLoaders.get(F);if(F._loadedComponent)return(0,ke.of)(F._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(F);const q=Xi(F.loadComponent()).pipe((0,Ln.U)(Sa),(0,ir.b)(_=>{this.onLoadEndListener&&this.onLoadEndListener(F),F._loadedComponent=_}),(0,Ci.x)(()=>{this.componentLoaders.delete(F)})),se=new xr(q,()=>new Vn.x).pipe(xo());return this.componentLoaders.set(F,se),se}loadChildren(F,q){if(this.childrenLoaders.get(q))return this.childrenLoaders.get(q);if(q._loadedRoutes)return(0,ke.of)({routes:q._loadedRoutes,injector:q._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(q);const _=function tl(B,$,F,q){return Xi(B.loadChildren()).pipe((0,Ln.U)(Sa),(0,mt.z)(se=>se instanceof O.YKP||Array.isArray(se)?(0,ke.of)(se):(0,ze.D)($.compileModuleAsync(se))),(0,Ln.U)(se=>{q&&q(B);let _,i,g=!1;return Array.isArray(se)?(i=se,!0):(_=se.create(F).injector,i=_.get(bi,[],{optional:!0,self:!0}).flat()),{routes:i.map(oa),injector:_}}))}(q,this.compiler,F,this.onLoadEndListener).pipe((0,Ci.x)(()=>{this.childrenLoaders.delete(q)})),i=new xr(_,()=>new Vn.x).pipe(xo());return this.childrenLoaders.set(q,i),i}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();function Sa(B){return function ma(B){return B&&"object"==typeof B&&"default"in B}(B)?B.default:B}let Os=(()=>{class B{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Vn.x,this.transitionAbortSubject=new Vn.x,this.configLoader=(0,O.f3M)(ds),this.environmentInjector=(0,O.f3M)(O.lqb),this.urlSerializer=(0,O.f3M)(Dt),this.rootContexts=(0,O.f3M)($s),this.inputBindingEnabled=null!==(0,O.f3M)(Fr,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,ke.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=se=>this.events.next(new ul(se)),this.configLoader.onLoadStartListener=se=>this.events.next(new cl(se))}complete(){this.transitions?.complete()}handleNavigationRequest(F){const q=++this.navigationId;this.transitions?.next({...this.transitions.value,...F,id:q})}setupNavigations(F,q,se){return this.transitions=new Vt.X({id:0,currentUrlTree:q,currentRawUrl:q,currentBrowserUrl:q,extractedUrl:F.urlHandlingStrategy.extract(q),urlAfterRedirects:F.urlHandlingStrategy.extract(q),rawUrl:q,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:fa,restoredState:null,currentSnapshot:se.snapshot,targetSnapshot:null,currentRouterState:se,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Zt.h)(_=>0!==_.id),(0,Ln.U)(_=>({..._,extractedUrl:F.urlHandlingStrategy.extract(_.rawUrl)})),(0,Ir.w)(_=>{this.currentTransition=_;let i=!1,g=!1;return(0,ke.of)(_).pipe((0,ir.b)(y=>{this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,Ir.w)(y=>{const A=y.currentBrowserUrl.toString(),T=!F.navigated||y.extractedUrl.toString()!==A||A!==y.currentUrlTree.toString();if(!T&&"reload"!==(y.extras.onSameUrlNavigation??F.onSameUrlNavigation)){const k="";return this.events.next(new ji(y.id,this.urlSerializer.serialize(y.rawUrl),k,0)),y.resolve(null),dn.E}if(F.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return(0,ke.of)(y).pipe((0,Ir.w)(k=>{const H=this.transitions?.getValue();return this.events.next(new ls(k.id,this.urlSerializer.serialize(k.extractedUrl),k.source,k.restoredState)),H!==this.transitions?.getValue()?dn.E:Promise.resolve(k)}),function Gt(B,$,F,q,se,_){return(0,mt.z)(i=>function bl(B,$,F,q,se,_,i="emptyOnly"){return new El(B,$,F,q,se,i,_).recognize()}(B,$,F,q,i.extractedUrl,se,_).pipe((0,Ln.U)(({state:g,tree:y})=>({...i,targetSnapshot:g,urlAfterRedirects:y}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,F.config,this.urlSerializer,F.paramsInheritanceStrategy),(0,ir.b)(k=>{_.targetSnapshot=k.targetSnapshot,_.urlAfterRedirects=k.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:k.urlAfterRedirects};const H=new Za(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(H)}));if(T&&F.urlHandlingStrategy.shouldProcessUrl(y.currentRawUrl)){const{id:k,extractedUrl:H,source:Q,restoredState:J,extras:de}=y,ye=new ls(k,this.urlSerializer.serialize(H),Q,J);this.events.next(ye);const Ae=pa(0,this.rootComponentType).snapshot;return this.currentTransition=_={...y,targetSnapshot:Ae,urlAfterRedirects:H,extras:{...de,skipLocationChange:!1,replaceUrl:!1}},(0,ke.of)(_)}{const k="";return this.events.next(new ji(y.id,this.urlSerializer.serialize(y.extractedUrl),k,1)),y.resolve(null),dn.E}}),(0,ir.b)(y=>{const A=new Ll(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot);this.events.next(A)}),(0,Ln.U)(y=>(this.currentTransition=_={...y,guards:Ie(y.targetSnapshot,y.currentSnapshot,this.rootContexts)},_)),function Bi(B,$){return(0,mt.z)(F=>{const{targetSnapshot:q,currentSnapshot:se,guards:{canActivateChecks:_,canDeactivateChecks:i}}=F;return 0===i.length&&0===_.length?(0,ke.of)({...F,guardsResult:!0}):function Bo(B,$,F,q){return(0,ze.D)(B).pipe((0,mt.z)(se=>function vo(B,$,F,q,se){const _=$&&$.routeConfig?$.routeConfig.canDeactivate:null;if(!_||0===_.length)return(0,ke.of)(!0);const i=_.map(g=>{const y=Zs($)??se,A=yt(g,y);return Xi(function Br(B){return B&&X(B.canDeactivate)}(A)?A.canDeactivate(B,$,F,q):y.runInContext(()=>A(B,$,F,q))).pipe(Qn())});return(0,ke.of)(i).pipe(Gr())}(se.component,se.route,F,$,q)),Qn(se=>!0!==se,!0))}(i,q,se,B).pipe((0,mt.z)(g=>g&&function be(B){return"boolean"==typeof B}(g)?function zo(B,$,F,q){return(0,ze.D)($).pipe((0,tr.b)(se=>gt(function Uo(B,$){return null!==B&&$&&$(new Di(B)),(0,ke.of)(!0)}(se.route.parent,q),function Wo(B,$){return null!==B&&$&&$(new Vl(B)),(0,ke.of)(!0)}(se.route,q),function sa(B,$,F){const q=$[$.length-1],_=$.slice(0,$.length-1).reverse().map(i=>function Ge(B){const $=B.routeConfig?B.routeConfig.canActivateChild:null;return $&&0!==$.length?{node:B,guards:$}:null}(i)).filter(i=>null!==i).map(i=>Wn(()=>{const g=i.guards.map(y=>{const A=Zs(i.node)??F,T=yt(y,A);return Xi(function lr(B){return B&&X(B.canActivateChild)}(T)?T.canActivateChild(q,B):A.runInContext(()=>T(q,B))).pipe(Qn())});return(0,ke.of)(g).pipe(Gr())}));return(0,ke.of)(_).pipe(Gr())}(B,se.path,F),function qs(B,$,F){const q=$.routeConfig?$.routeConfig.canActivate:null;if(!q||0===q.length)return(0,ke.of)(!0);const se=q.map(_=>Wn(()=>{const i=Zs($)??F,g=yt(_,i);return Xi(function On(B){return B&&X(B.canActivate)}(g)?g.canActivate($,B):i.runInContext(()=>g($,B))).pipe(Qn())}));return(0,ke.of)(se).pipe(Gr())}(B,se.route,F))),Qn(se=>!0!==se,!0))}(q,_,B,$):(0,ke.of)(g)),(0,Ln.U)(g=>({...F,guardsResult:g})))})}(this.environmentInjector,y=>this.events.next(y)),(0,ir.b)(y=>{if(_.guardsResult=y.guardsResult,_o(y.guardsResult))throw lo(0,y.guardsResult);const A=new Yl(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.events.next(A)}),(0,Zt.h)(y=>!!y.guardsResult||(this.cancelNavigationTransition(y,"",3),!1)),Ao(y=>{if(y.guards.canActivateChecks.length)return(0,ke.of)(y).pipe((0,ir.b)(A=>{const T=new ba(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot);this.events.next(T)}),(0,Ir.w)(A=>{let T=!1;return(0,ke.of)(A).pipe(function Ut(B,$){return(0,mt.z)(F=>{const{targetSnapshot:q,guards:{canActivateChecks:se}}=F;if(!se.length)return(0,ke.of)(F);let _=0;return(0,ze.D)(se).pipe((0,tr.b)(i=>function pr(B,$,F,q){const se=B.routeConfig,_=B._resolve;return void 0!==se?.title&&!Yr(se)&&(_[Pr]=se.title),function io(B,$,F,q){const se=function Hi(B){return[...Object.keys(B),...Object.getOwnPropertySymbols(B)]}(B);if(0===se.length)return(0,ke.of)({});const _={};return(0,ze.D)(se).pipe((0,mt.z)(i=>function wi(B,$,F,q){const se=Zs($)??q,_=yt(B,se);return Xi(_.resolve?_.resolve($,F):se.runInContext(()=>_($,F)))}(B[i],$,F,q).pipe(Qn(),(0,ir.b)(g=>{_[i]=g}))),Pi(1),function qr(B){return(0,Ln.U)(()=>B)}(_),(0,nn.K)(i=>eo(i)?dn.E:Kt(i)))}(_,B,$,q).pipe((0,Ln.U)(i=>(B._resolvedData=i,B.data=Ba(B,F).resolve,se&&Yr(se)&&(B.data[Pr]=se.title),null)))}(i.route,q,B,$)),(0,ir.b)(()=>_++),Pi(1),(0,mt.z)(i=>_===se.length?(0,ke.of)(F):dn.E))})}(F.paramsInheritanceStrategy,this.environmentInjector),(0,ir.b)({next:()=>T=!0,complete:()=>{T||this.cancelNavigationTransition(A,"",2)}}))}),(0,ir.b)(A=>{const T=new ea(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot);this.events.next(T)}))}),Ao(y=>{const A=T=>{const N=[];T.routeConfig?.loadComponent&&!T.routeConfig._loadedComponent&&N.push(this.configLoader.loadComponent(T.routeConfig).pipe((0,ir.b)(k=>{T.component=k}),(0,Ln.U)(()=>{})));for(const k of T.children)N.push(...A(k));return N};return un(A(y.targetSnapshot.root)).pipe(rn(),At(1))}),Ao(()=>this.afterPreactivation()),(0,Ln.U)(y=>{const A=function ta(B,$,F){const q=Or(B,$._root,F?F._root:void 0);return new Qi(q,$)}(F.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return this.currentTransition=_={...y,targetRouterState:A},_}),(0,ir.b)(()=>{this.events.next(new Qo)}),((B,$,F,q)=>(0,Ln.U)(se=>(new ie($,se.targetRouterState,se.currentRouterState,F,q).activate(B),se)))(this.rootContexts,F.routeReuseStrategy,y=>this.events.next(y),this.inputBindingEnabled),At(1),(0,ir.b)({next:y=>{i=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ii(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects))),F.titleStrategy?.updateTitle(y.targetRouterState.snapshot),y.resolve(!0)},complete:()=>{i=!0}}),function fr(B){return(0,di.e)(($,F)=>{(0,ln.Xf)(B).subscribe((0,Bt.x)(F,()=>F.complete(),Ni.Z)),!F.closed&&$.subscribe(F)})}(this.transitionAbortSubject.pipe((0,ir.b)(y=>{throw y}))),(0,Ci.x)(()=>{i||g||this.cancelNavigationTransition(_,"",1),this.currentNavigation?.id===_.id&&(this.currentNavigation=null)}),(0,nn.K)(y=>{if(g=!0,Es(y))this.events.next(new gs(_.id,this.urlSerializer.serialize(_.extractedUrl),y.message,y.cancellationCode)),function Da(B){return Es(B)&&_o(B.url)}(y)?this.events.next(new qa(y.url)):_.resolve(!1);else{this.events.next(new ko(_.id,this.urlSerializer.serialize(_.extractedUrl),y,_.targetSnapshot??void 0));try{_.resolve(F.errorHandler(y))}catch(A){_.reject(A)}}return dn.E}))}))}cancelNavigationTransition(F,q,se){const _=new gs(F.id,this.urlSerializer.serialize(F.extractedUrl),q,se);this.events.next(_),F.resolve(!1)}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();function nl(B){return B!==fa}let Ia=(()=>{class B{buildTitle(F){let q,se=F.root;for(;void 0!==se;)q=this.getResolvedTitleForRoute(se)??q,se=se.children.find(_=>_.outlet===wr);return q}getResolvedTitleForRoute(F){return F.data[Pr]}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:function(){return(0,O.f3M)(rl)},providedIn:"root"})}return B})(),rl=(()=>{class B extends Ia{constructor(F){super(),this.title=F}updateTitle(F){const q=this.buildTitle(F);void 0!==q&&this.title.setTitle(q)}static#e=this.\u0275fac=function(q){return new(q||B)(O.LFG(Ai.Dx))};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})(),qc=(()=>{class B{static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:function(){return(0,O.f3M)(Cl)},providedIn:"root"})}return B})();class Hn{shouldDetach($){return!1}store($,F){}shouldAttach($){return!1}retrieve($){return null}shouldReuseRoute($,F){return $.routeConfig===F.routeConfig}}let Cl=(()=>{class B extends Hn{static#e=this.\u0275fac=function(){let F;return function(se){return(F||(F=O.n5z(B)))(se||B)}}();static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();const Xc=new O.OlP("",{providedIn:"root",factory:()=>({})});let ac=(()=>{class B{static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:function(){return(0,O.f3M)(Yi)},providedIn:"root"})}return B})(),Yi=(()=>{class B{shouldProcessUrl(F){return!0}extract(F){return F}merge(F,q){return F}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();var $r=function(B){return B[B.COMPLETE=0]="COMPLETE",B[B.FAILED=1]="FAILED",B[B.REDIRECTING=2]="REDIRECTING",B}($r||{});function Ec(B,$){B.events.pipe((0,Zt.h)(F=>F instanceof Ii||F instanceof gs||F instanceof ko||F instanceof ji),(0,Ln.U)(F=>F instanceof Ii||F instanceof ji?$r.COMPLETE:F instanceof gs&&(0===F.code||1===F.code)?$r.REDIRECTING:$r.FAILED),(0,Zt.h)(F=>F!==$r.REDIRECTING),At(1)).subscribe(()=>{$()})}function il(B){throw B}function du(B,$,F){return $.parse("/")}const Yc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Do={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Xs=(()=>{class B{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,O.f3M)(O.c2e),this.isNgZoneEnabled=!1,this._events=new Vn.x,this.options=(0,O.f3M)(Xc,{optional:!0})||{},this.pendingTasks=(0,O.f3M)(O.HDt),this.errorHandler=this.options.errorHandler||il,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||du,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,O.f3M)(ac),this.routeReuseStrategy=(0,O.f3M)(qc),this.titleStrategy=(0,O.f3M)(Ia),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=(0,O.f3M)(bi,{optional:!0})?.flat()??[],this.navigationTransitions=(0,O.f3M)(Os),this.urlSerializer=(0,O.f3M)(Dt),this.location=(0,O.f3M)(Zr.Ye),this.componentInputBindingEnabled=!!(0,O.f3M)(Fr,{optional:!0}),this.eventsSubscription=new kn.w0,this.isNgZoneEnabled=(0,O.f3M)(O.R0b)instanceof O.R0b&&O.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Re,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=pa(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(F=>{this.lastSuccessfulId=F.id,this.currentPageId=this.browserPageId},F=>{this.console.warn(`Unhandled Navigation Error: ${F}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const F=this.navigationTransitions.events.subscribe(q=>{try{const{currentTransition:se}=this.navigationTransitions;if(null===se)return void(la(q)&&this._events.next(q));if(q instanceof ls)nl(se.source)&&(this.browserUrlTree=se.extractedUrl);else if(q instanceof ji)this.rawUrlTree=se.rawUrl;else if(q instanceof Za){if("eager"===this.urlUpdateStrategy){if(!se.extras.skipLocationChange){const _=this.urlHandlingStrategy.merge(se.urlAfterRedirects,se.rawUrl);this.setBrowserUrl(_,se)}this.browserUrlTree=se.urlAfterRedirects}}else if(q instanceof Qo)this.currentUrlTree=se.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(se.urlAfterRedirects,se.rawUrl),this.routerState=se.targetRouterState,"deferred"===this.urlUpdateStrategy&&(se.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,se),this.browserUrlTree=se.urlAfterRedirects);else if(q instanceof gs)0!==q.code&&1!==q.code&&(this.navigated=!0),(3===q.code||2===q.code)&&this.restoreHistory(se);else if(q instanceof qa){const _=this.urlHandlingStrategy.merge(q.url,se.currentRawUrl),i={skipLocationChange:se.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||nl(se.source)};this.scheduleNavigation(_,fa,null,i,{resolve:se.resolve,reject:se.reject,promise:se.promise})}q instanceof ko&&this.restoreHistory(se,!0),q instanceof Ii&&(this.navigated=!0),la(q)&&this._events.next(q)}catch(se){this.navigationTransitions.transitionAbortSubject.next(se)}});this.eventsSubscription.add(F)}resetRootComponentType(F){this.routerState.root.component=F,this.navigationTransitions.rootComponentType=F}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const F=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),fa,F)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(F=>{const q="popstate"===F.type?"popstate":"hashchange";"popstate"===q&&setTimeout(()=>{this.navigateToSyncWithBrowser(F.url,q,F.state)},0)}))}navigateToSyncWithBrowser(F,q,se){const _={replaceUrl:!0},i=se?.navigationId?se:null;if(se){const y={...se};delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(_.state=y)}const g=this.parseUrl(F);this.scheduleNavigation(g,q,i,_)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(F){this.config=F.map(oa),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(F,q={}){const{relativeTo:se,queryParams:_,fragment:i,queryParamsHandling:g,preserveFragment:y}=q,A=y?this.currentUrlTree.fragment:i;let N,T=null;switch(g){case"merge":T={...this.currentUrlTree.queryParams,..._};break;case"preserve":T=this.currentUrlTree.queryParams;break;default:T=_||null}null!==T&&(T=this.removeEmptyProps(T));try{N=Vi(se?se.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof F[0]||!F[0].startsWith("/"))&&(F=[]),N=this.currentUrlTree.root}return ro(N,F,T,A??null)}navigateByUrl(F,q={skipLocationChange:!1}){const se=_o(F)?F:this.parseUrl(F),_=this.urlHandlingStrategy.merge(se,this.rawUrlTree);return this.scheduleNavigation(_,fa,null,q)}navigate(F,q={skipLocationChange:!1}){return function Hl(B){for(let $=0;$<B.length;$++)if(null==B[$])throw new O.vHH(4008,!1)}(F),this.navigateByUrl(this.createUrlTree(F,q),q)}serializeUrl(F){return this.urlSerializer.serialize(F)}parseUrl(F){let q;try{q=this.urlSerializer.parse(F)}catch(se){q=this.malformedUriErrorHandler(se,this.urlSerializer,F)}return q}isActive(F,q){let se;if(se=!0===q?{...Yc}:!1===q?{...Do}:q,_o(F))return Jr(this.currentUrlTree,F,se);const _=this.parseUrl(F);return Jr(this.currentUrlTree,_,se)}removeEmptyProps(F){return Object.keys(F).reduce((q,se)=>{const _=F[se];return null!=_&&(q[se]=_),q},{})}scheduleNavigation(F,q,se,_,i){if(this.disposed)return Promise.resolve(!1);let g,y,A;i?(g=i.resolve,y=i.reject,A=i.promise):A=new Promise((N,k)=>{g=N,y=k});const T=this.pendingTasks.add();return Ec(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(T))}),this.navigationTransitions.handleNavigationRequest({source:q,restoredState:se,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:F,extras:_,resolve:g,reject:y,promise:A,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),A.catch(N=>Promise.reject(N))}setBrowserUrl(F,q){const se=this.urlSerializer.serialize(F);if(this.location.isCurrentPathEqualTo(se)||q.extras.replaceUrl){const i={...q.extras.state,...this.generateNgRouterState(q.id,this.browserPageId)};this.location.replaceState(se,"",i)}else{const _={...q.extras.state,...this.generateNgRouterState(q.id,this.browserPageId+1)};this.location.go(se,"",_)}}restoreHistory(F,q=!1){if("computed"===this.canceledNavigationResolution){const _=this.currentPageId-this.browserPageId;0!==_?this.location.historyGo(_):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===_&&(this.resetState(F),this.browserUrlTree=F.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(q&&this.resetState(F),this.resetUrlToCurrentUrlTree())}resetState(F){this.routerState=F.currentRouterState,this.currentUrlTree=F.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,F.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(F,q){return"computed"===this.canceledNavigationResolution?{navigationId:F,\u0275routerPageId:q}:{navigationId:F}}static#e=this.\u0275fac=function(q){return new(q||B)};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();function la(B){return!(B instanceof Qo||B instanceof qa)}let Kc=(()=>{class B{constructor(F,q,se,_,i,g){this.router=F,this.route=q,this.tabIndexAttribute=se,this.renderer=_,this.el=i,this.locationStrategy=g,this.href=null,this.commands=null,this.onChanges=new Vn.x,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const y=i.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===y||"area"===y,this.isAnchorElement?this.subscription=F.events.subscribe(A=>{A instanceof Ii&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(F){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",F)}ngOnChanges(F){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(F){null!=F?(this.commands=Array.isArray(F)?F:[F],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(F,q,se,_,i){return!!(null===this.urlTree||this.isAnchorElement&&(0!==F||q||se||_||i||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const F=null===this.href?null:(0,O.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",F)}applyAttributeValue(F,q){const se=this.renderer,_=this.el.nativeElement;null!==q?se.setAttribute(_,F,q):se.removeAttribute(_,F)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(q){return new(q||B)(O.Y36(Xs),O.Y36(Fo),O.$8M("tabindex"),O.Y36(O.Qsj),O.Y36(O.SBq),O.Y36(Zr.S$))};static#t=this.\u0275dir=O.lG2({type:B,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(q,se){1&q&&O.NdJ("click",function(i){return se.onClick(i.button,i.ctrlKey,i.shiftKey,i.altKey,i.metaKey)}),2&q&&O.uIk("target",se.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",O.VuI],skipLocationChange:["skipLocationChange","skipLocationChange",O.VuI],replaceUrl:["replaceUrl","replaceUrl",O.VuI],routerLink:"routerLink"},standalone:!0,features:[O.Xq5,O.TTD]})}return B})(),Ds=(()=>{class B{get isActive(){return this._isActive}constructor(F,q,se,_,i){this.router=F,this.element=q,this.renderer=se,this.cdr=_,this.link=i,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new O.vpe,this.routerEventsSubscription=F.events.subscribe(g=>{g instanceof Ii&&this.update()})}ngAfterContentInit(){(0,ke.of)(this.links.changes,(0,ke.of)(null)).pipe((0,rr.J)()).subscribe(F=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const F=[...this.links.toArray(),this.link].filter(q=>!!q).map(q=>q.onChanges);this.linkInputChangesSubscription=(0,ze.D)(F).pipe((0,rr.J)()).subscribe(q=>{this._isActive!==this.isLinkActive(this.router)(q)&&this.update()})}set routerLinkActive(F){const q=Array.isArray(F)?F:F.split(" ");this.classes=q.filter(se=>!!se)}ngOnChanges(F){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const F=this.hasActiveLinks();this._isActive!==F&&(this._isActive=F,this.cdr.markForCheck(),this.classes.forEach(q=>{F?this.renderer.addClass(this.element.nativeElement,q):this.renderer.removeClass(this.element.nativeElement,q)}),F&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(F))})}isLinkActive(F){const q=function Al(B){return!!B.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return se=>!!se.urlTree&&F.isActive(se.urlTree,q)}hasActiveLinks(){const F=this.isLinkActive(this.router);return this.link&&F(this.link)||this.links.some(F)}static#e=this.\u0275fac=function(q){return new(q||B)(O.Y36(Xs),O.Y36(O.SBq),O.Y36(O.Qsj),O.Y36(O.sBO),O.Y36(Kc,8))};static#t=this.\u0275dir=O.lG2({type:B,selectors:[["","routerLinkActive",""]],contentQueries:function(q,se,_){if(1&q&&O.Suo(_,Kc,5),2&q){let i;O.iGM(i=O.CRH())&&(se.links=i)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[O.TTD]})}return B})();class _a{}let hu=(()=>{class B{constructor(F,q,se,_,i){this.router=F,this.injector=se,this.preloadingStrategy=_,this.loader=i}setUpPreloading(){this.subscription=this.router.events.pipe((0,Zt.h)(F=>F instanceof Ii),(0,tr.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(F,q){const se=[];for(const _ of q){_.providers&&!_._injector&&(_._injector=(0,O.MMx)(_.providers,F,`Route: ${_.path}`));const i=_._injector??F,g=_._loadedInjector??i;(_.loadChildren&&!_._loadedRoutes&&void 0===_.canLoad||_.loadComponent&&!_._loadedComponent)&&se.push(this.preloadConfig(i,_)),(_.children||_._loadedRoutes)&&se.push(this.processRoutes(g,_.children??_._loadedRoutes))}return(0,ze.D)(se).pipe((0,rr.J)())}preloadConfig(F,q){return this.preloadingStrategy.preload(q,()=>{let se;se=q.loadChildren&&void 0===q.canLoad?this.loader.loadChildren(F,q):(0,ke.of)(null);const _=se.pipe((0,mt.z)(i=>null===i?(0,ke.of)(void 0):(q._loadedRoutes=i.routes,q._loadedInjector=i.injector,this.processRoutes(i.injector??F,i.routes))));if(q.loadComponent&&!q._loadedComponent){const i=this.loader.loadComponent(q);return(0,ze.D)([_,i]).pipe((0,rr.J)())}return _})}static#e=this.\u0275fac=function(q){return new(q||B)(O.LFG(Xs),O.LFG(O.Sil),O.LFG(O.lqb),O.LFG(_a),O.LFG(ds))};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})();const Va=new O.OlP("");let lc=(()=>{class B{constructor(F,q,se,_,i={}){this.urlSerializer=F,this.transitions=q,this.viewportScroller=se,this.zone=_,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(F=>{F instanceof ls?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=F.navigationTrigger,this.restoredId=F.restoredState?F.restoredState.navigationId:0):F instanceof Ii?(this.lastId=F.id,this.scheduleScrollEvent(F,this.urlSerializer.parse(F.urlAfterRedirects).fragment)):F instanceof ji&&0===F.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(F,this.urlSerializer.parse(F.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(F=>{F instanceof bs&&(F.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(F.position):F.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(F.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(F,q){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new bs(F,"popstate"===this.lastSource?this.store[this.restoredId]:null,q))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(q){O.$Z()};static#t=this.\u0275prov=O.Yz7({token:B,factory:B.\u0275fac})}return B})();function gl(B,$){return{\u0275kind:B,\u0275providers:$}}function Vd(){const B=(0,O.f3M)(O.zs3);return $=>{const F=B.get(O.z2F);if($!==F.components[0])return;const q=B.get(Xs),se=B.get(Ru);1===B.get(Cc)&&q.initialNavigation(),B.get(pd,null,O.XFs.Optional)?.setUpPreloading(),B.get(Va,null,O.XFs.Optional)?.init(),q.resetRootComponentType(F.componentTypes[0]),se.closed||(se.next(),se.complete(),se.unsubscribe())}}const Ru=new O.OlP("",{factory:()=>new Vn.x}),Cc=new O.OlP("",{providedIn:"root",factory:()=>1}),pd=new O.OlP("");function Fe(B){return gl(0,[{provide:pd,useExisting:hu},{provide:_a,useExisting:B}])}const ja=new O.OlP("ROUTER_FORROOT_GUARD"),Tl=[Zr.Ye,{provide:Dt,useClass:pn},Xs,$s,{provide:Fo,useFactory:function cc(B){return B.routerState.root},deps:[Xs]},ds,[]];function hs(){return new O.PXZ("Router",Xs)}let Ac=(()=>{class B{constructor(F){}static forRoot(F,q){return{ngModule:B,providers:[Tl,[],{provide:bi,multi:!0,useValue:F},{provide:ja,useFactory:Jl,deps:[[Xs,new O.FiY,new O.tp0]]},{provide:Xc,useValue:q||{}},q?.useHash?{provide:Zr.S$,useClass:Zr.Do}:{provide:Zr.S$,useClass:Zr.b0},{provide:Va,useFactory:()=>{const B=(0,O.f3M)(Zr.EM),$=(0,O.f3M)(O.R0b),F=(0,O.f3M)(Xc),q=(0,O.f3M)(Os),se=(0,O.f3M)(Dt);return F.scrollOffset&&B.setOffset(F.scrollOffset),new lc(se,q,B,$,F)}},q?.preloadingStrategy?Fe(q.preloadingStrategy).\u0275providers:[],{provide:O.PXZ,multi:!0,useFactory:hs},q?.initialNavigation?co(q):[],q?.bindToComponentInputs?gl(8,[Ws,{provide:Fr,useExisting:Ws}]).\u0275providers:[],[{provide:$n,useFactory:Vd},{provide:O.tb,multi:!0,useExisting:$n}]]}}static forChild(F){return{ngModule:B,providers:[{provide:bi,multi:!0,useValue:F}]}}static#e=this.\u0275fac=function(q){return new(q||B)(O.LFG(ja,8))};static#t=this.\u0275mod=O.oAB({type:B});static#n=this.\u0275inj=O.cJS({})}return B})();function Jl(B){return"guarded"}function co(B){return["disabled"===B.initialNavigation?gl(3,[{provide:O.ip1,multi:!0,useFactory:()=>{const $=(0,O.f3M)(Xs);return()=>{$.setUpLocationChangeListener()}}},{provide:Cc,useValue:2}]).\u0275providers:[],"enabledBlocking"===B.initialNavigation?gl(2,[{provide:Cc,useValue:0},{provide:O.ip1,multi:!0,deps:[O.zs3],useFactory:$=>{const F=$.get(Zr.V_,Promise.resolve());return()=>F.then(()=>new Promise(q=>{const se=$.get(Xs),_=$.get(Ru);Ec(se,()=>{q(!0)}),$.get(Os).afterPreactivation=()=>(q(!0),_.closed?(0,ke.of)(void 0):_),se.initialNavigation()}))}}]).\u0275providers:[]]}const $n=new O.OlP("")},469:(yr,Qt,_e)=>{"use strict";_e.d(Qt,{S:()=>oh,f:()=>Sd});var O=_e(5861),bt=_e(6814),St=_e(4946),f=_e(95);var s,Vt=(s=function(n,a){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,p){u.__proto__=p}||function(u,p){for(var w in p)Object.prototype.hasOwnProperty.call(p,w)&&(u[w]=p[w])})(n,a)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}),$t=function(s){function e(n,a){var u=this.constructor,p=s.call(this,n,a)||this;return Object.defineProperty(p,"name",{value:u.name,enumerable:!1,configurable:!0}),function ze(s,e){var n=Object.setPrototypeOf;n?n(s,e):s.__proto__=e}(p,u.prototype),function ke(s,e){void 0===e&&(e=s.constructor);var n=Error.captureStackTrace;n&&n(s,e)}(p),p}return Vt(e,s),e}(Error),it=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),dt=function(s){function e(n){void 0===n&&(n=void 0);var a=s.call(this,n)||this;return a.message=n,a}return it(e,s),e.prototype.getKind=function(){return this.constructor.kind},e.kind="Exception",e}($t);const Bt=dt;var zt=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),un=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return zt(e,s),e.kind="ArgumentException",e}(Bt);const jn=un;var Jn=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),mr=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Jn(e,s),e.kind="IllegalArgumentException",e}(Bt);const Xt=mr;var rr=function(){function s(e){if(this.binarizer=e,null===e)throw new Xt("Binarizer must be non-null.")}return s.prototype.getWidth=function(){return this.binarizer.getWidth()},s.prototype.getHeight=function(){return this.binarizer.getHeight()},s.prototype.getBlackRow=function(e,n){return this.binarizer.getBlackRow(e,n)},s.prototype.getBlackMatrix=function(){return null==this.matrix&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix},s.prototype.isCropSupported=function(){return this.binarizer.getLuminanceSource().isCropSupported()},s.prototype.crop=function(e,n,a,u){var p=this.binarizer.getLuminanceSource().crop(e,n,a,u);return new s(this.binarizer.createBinarizer(p))},s.prototype.isRotateSupported=function(){return this.binarizer.getLuminanceSource().isRotateSupported()},s.prototype.rotateCounterClockwise=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new s(this.binarizer.createBinarizer(e))},s.prototype.rotateCounterClockwise45=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new s(this.binarizer.createBinarizer(e))},s.prototype.toString=function(){try{return this.getBlackMatrix().toString()}catch{return""}},s}();const kt=rr;var gt=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ln=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return gt(e,s),e.getChecksumInstance=function(){return new e},e.kind="ChecksumException",e}(Bt);const Wn=ln;var Yt=function(){function s(e){this.source=e}return s.prototype.getLuminanceSource=function(){return this.source},s.prototype.getWidth=function(){return this.source.getWidth()},s.prototype.getHeight=function(){return this.source.getHeight()},s}();const Kt=Yt;var dn=function(){function s(){}return s.arraycopy=function(e,n,a,u,p){for(;p--;)a[u++]=e[n++]},s.currentTimeMillis=function(){return Date.now()},s}();const kn=dn;var di=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),xo=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return di(e,s),e.kind="IndexOutOfBoundsException",e}(Bt);const xr=xo;var Vn=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Zr=function(s){function e(n,a){void 0===n&&(n=void 0),void 0===a&&(a=void 0);var u=s.call(this,a)||this;return u.index=n,u.message=a,u}return Vn(e,s),e.kind="ArrayIndexOutOfBoundsException",e}(xr);const Ln=Zr;var At=function(){function s(){}return s.fill=function(e,n){for(var a=0,u=e.length;a<u;a++)e[a]=n},s.fillWithin=function(e,n,a,u){s.rangeCheck(e.length,n,a);for(var p=n;p<a;p++)e[p]=u},s.rangeCheck=function(e,n,a){if(n>a)throw new Xt("fromIndex("+n+") > toIndex("+a+")");if(n<0)throw new Ln(n);if(a>e)throw new Ln(a)},s.asList=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e},s.create=function(e,n,a){return Array.from({length:e}).map(function(p){return Array.from({length:n}).fill(a)})},s.createInt32Array=function(e,n,a){return Array.from({length:e}).map(function(p){return Int32Array.from({length:n}).fill(a)})},s.equals=function(e,n){if(!(e&&n&&e.length&&n.length&&e.length===n.length))return!1;for(var a=0,u=e.length;a<u;a++)if(e[a]!==n[a])return!1;return!0},s.hashCode=function(e){var n,a;if(null===e)return 0;var u=1;try{for(var p=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),w=p.next();!w.done;w=p.next())u=31*u+w.value}catch(I){n={error:I}}finally{try{w&&!w.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return u},s.fillUint8Array=function(e,n){for(var a=0;a!==e.length;a++)e[a]=n},s.copyOf=function(e,n){return e.slice(0,n)},s.copyOfUint8Array=function(e,n){if(e.length<=n){var a=new Uint8Array(n);return a.set(e),a}return e.slice(0,n)},s.copyOfRange=function(e,n,a){var u=a-n,p=new Int32Array(u);return kn.arraycopy(e,n,p,0,u),p},s.binarySearch=function(e,n,a){void 0===a&&(a=s.numberComparator);for(var u=0,p=e.length-1;u<=p;){var w=p+u>>1,E=a(n,e[w]);if(E>0)u=w+1;else{if(!(E<0))return w;p=w-1}}return-u-1},s.numberComparator=function(e,n){return e-n},s}();const Nt=At;var Zt=function(){function s(){}return s.numberOfTrailingZeros=function(e){var n;if(0===e)return 32;var a=31;return 0!=(n=e<<16)&&(a-=16,e=n),0!=(n=e<<8)&&(a-=8,e=n),0!=(n=e<<4)&&(a-=4,e=n),0!=(n=e<<2)&&(a-=2,e=n),a-(e<<1>>>31)},s.numberOfLeadingZeros=function(e){if(0===e)return 32;var n=1;return e>>>16||(n+=16,e<<=16),e>>>24||(n+=8,e<<=8),e>>>28||(n+=4,e<<=4),e>>>30||(n+=2,e<<=2),n-(e>>>31)},s.toHexString=function(e){return e.toString(16)},s.toBinaryString=function(e){return String(parseInt(String(e),2))},s.bitCount=function(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,63&(e+=e>>>8)+(e>>>16)},s.truncDivision=function(e,n){return Math.trunc(e/n)},s.parseInt=function(e,n){return void 0===n&&(n=void 0),parseInt(e,n)},s.MIN_VALUE_32_BITS=-2147483648,s.MAX_VALUE=Number.MAX_SAFE_INTEGER,s}();const mt=Zt;var rn=function(){function s(e,n){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=null==n?s.makeArray(e):n)}return s.prototype.getSize=function(){return this.size},s.prototype.getSizeInBytes=function(){return Math.floor((this.size+7)/8)},s.prototype.ensureCapacity=function(e){if(e>32*this.bits.length){var n=s.makeArray(e);kn.arraycopy(this.bits,0,n,0,this.bits.length),this.bits=n}},s.prototype.get=function(e){return 0!=(this.bits[Math.floor(e/32)]&1<<(31&e))},s.prototype.set=function(e){this.bits[Math.floor(e/32)]|=1<<(31&e)},s.prototype.flip=function(e){this.bits[Math.floor(e/32)]^=1<<(31&e)},s.prototype.getNextSet=function(e){var n=this.size;if(e>=n)return n;var a=this.bits,u=Math.floor(e/32),p=a[u];p&=~((1<<(31&e))-1);for(var w=a.length;0===p;){if(++u===w)return n;p=a[u]}var E=32*u+mt.numberOfTrailingZeros(p);return E>n?n:E},s.prototype.getNextUnset=function(e){var n=this.size;if(e>=n)return n;var a=this.bits,u=Math.floor(e/32),p=~a[u];p&=~((1<<(31&e))-1);for(var w=a.length;0===p;){if(++u===w)return n;p=~a[u]}var E=32*u+mt.numberOfTrailingZeros(p);return E>n?n:E},s.prototype.setBulk=function(e,n){this.bits[Math.floor(e/32)]=n},s.prototype.setRange=function(e,n){if(n<e||e<0||n>this.size)throw new Xt;if(n!==e){n--;for(var a=Math.floor(e/32),u=Math.floor(n/32),p=this.bits,w=a;w<=u;w++)p[w]|=(2<<(w<u?31:31&n))-(1<<(w>a?0:31&e))}},s.prototype.clear=function(){for(var e=this.bits.length,n=this.bits,a=0;a<e;a++)n[a]=0},s.prototype.isRange=function(e,n,a){if(n<e||e<0||n>this.size)throw new Xt;if(n===e)return!0;n--;for(var u=Math.floor(e/32),p=Math.floor(n/32),w=this.bits,E=u;E<=p;E++){var V=(2<<(E<p?31:31&n))-(1<<(E>u?0:31&e))&4294967295;if((w[E]&V)!==(a?V:0))return!1}return!0},s.prototype.appendBit=function(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++},s.prototype.appendBits=function(e,n){if(n<0||n>32)throw new Xt("Num bits must be between 0 and 32");this.ensureCapacity(this.size+n);for(var a=n;a>0;a--)this.appendBit(1==(e>>a-1&1))},s.prototype.appendBitArray=function(e){var n=e.size;this.ensureCapacity(this.size+n);for(var a=0;a<n;a++)this.appendBit(e.get(a))},s.prototype.xor=function(e){if(this.size!==e.size)throw new Xt("Sizes don't match");for(var n=this.bits,a=0,u=n.length;a<u;a++)n[a]^=e.bits[a]},s.prototype.toBytes=function(e,n,a,u){for(var p=0;p<u;p++){for(var w=0,E=0;E<8;E++)this.get(e)&&(w|=1<<7-E),e++;n[a+p]=w}},s.prototype.getBitArray=function(){return this.bits},s.prototype.reverse=function(){for(var e=new Int32Array(this.bits.length),n=Math.floor((this.size-1)/32),a=n+1,u=this.bits,p=0;p<a;p++){var w=u[p];e[n-p]=w=(w=(w=(w=(w=w>>1&1431655765|(1431655765&w)<<1)>>2&858993459|(858993459&w)<<2)>>4&252645135|(252645135&w)<<4)>>8&16711935|(16711935&w)<<8)>>16&65535|(65535&w)<<16}if(this.size!==32*a){var E=32*a-this.size,I=e[0]>>>E;for(p=1;p<a;p++){var R=e[p];e[p-1]=I|=R<<32-E,I=R>>>E}e[a-1]=I}this.bits=e},s.makeArray=function(e){return new Int32Array(Math.floor((e+31)/32))},s.prototype.equals=function(e){return e instanceof s&&(this.size===e.size&&Nt.equals(this.bits,e.bits))},s.prototype.hashCode=function(){return 31*this.size+Nt.hashCode(this.bits)},s.prototype.toString=function(){for(var e="",n=0,a=this.size;n<a;n++)7&n||(e+=" "),e+=this.get(n)?"X":".";return e},s.prototype.clone=function(){return new s(this.size,this.bits.slice())},s.prototype.toArray=function(){for(var e=[],n=0,a=this.size;n<a;n++)e.push(this.get(n));return e},s}();const _n=rn;var gr=function(s){return s[s.OTHER=0]="OTHER",s[s.PURE_BARCODE=1]="PURE_BARCODE",s[s.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",s[s.TRY_HARDER=3]="TRY_HARDER",s[s.CHARACTER_SET=4]="CHARACTER_SET",s[s.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",s[s.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",s[s.ASSUME_GS1=7]="ASSUME_GS1",s[s.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",s[s.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",s[s.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS",s}(gr||{});const Qn=gr;var tr=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ir=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return tr(e,s),e.getFormatInstance=function(){return new e},e.kind="FormatException",e}(Bt);const nn=ir;var Gn=function(s){return s[s.Cp437=0]="Cp437",s[s.ISO8859_1=1]="ISO8859_1",s[s.ISO8859_2=2]="ISO8859_2",s[s.ISO8859_3=3]="ISO8859_3",s[s.ISO8859_4=4]="ISO8859_4",s[s.ISO8859_5=5]="ISO8859_5",s[s.ISO8859_6=6]="ISO8859_6",s[s.ISO8859_7=7]="ISO8859_7",s[s.ISO8859_8=8]="ISO8859_8",s[s.ISO8859_9=9]="ISO8859_9",s[s.ISO8859_10=10]="ISO8859_10",s[s.ISO8859_11=11]="ISO8859_11",s[s.ISO8859_13=12]="ISO8859_13",s[s.ISO8859_14=13]="ISO8859_14",s[s.ISO8859_15=14]="ISO8859_15",s[s.ISO8859_16=15]="ISO8859_16",s[s.SJIS=16]="SJIS",s[s.Cp1250=17]="Cp1250",s[s.Cp1251=18]="Cp1251",s[s.Cp1252=19]="Cp1252",s[s.Cp1256=20]="Cp1256",s[s.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",s[s.UTF8=22]="UTF8",s[s.ASCII=23]="ASCII",s[s.Big5=24]="Big5",s[s.GB18030=25]="GB18030",s[s.EUC_KR=26]="EUC_KR",s}(Gn||{}),Pi=function(){function s(e,n,a){for(var u,p,w=[],E=3;E<arguments.length;E++)w[E-3]=arguments[E];this.valueIdentifier=e,this.name=a,this.values="number"==typeof n?Int32Array.from([n]):n,this.otherEncodingNames=w,s.VALUE_IDENTIFIER_TO_ECI.set(e,this),s.NAME_TO_ECI.set(a,this);for(var I=this.values,R=0,V=I.length;R!==V;R++)s.VALUES_TO_ECI.set(I[R],this);try{for(var ee=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(w),oe=ee.next();!oe.done;oe=ee.next())s.NAME_TO_ECI.set(oe.value,this)}catch(Ne){u={error:Ne}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}}return s.prototype.getValueIdentifier=function(){return this.valueIdentifier},s.prototype.getName=function(){return this.name},s.prototype.getValue=function(){return this.values[0]},s.getCharacterSetECIByValue=function(e){if(e<0||e>=900)throw new nn("incorect value");var n=s.VALUES_TO_ECI.get(e);if(void 0===n)throw new nn("incorect value");return n},s.getCharacterSetECIByName=function(e){var n=s.NAME_TO_ECI.get(e);if(void 0===n)throw new nn("incorect value");return n},s.prototype.equals=function(e){if(!(e instanceof s))return!1;var n=e;return this.getName()===n.getName()},s.VALUE_IDENTIFIER_TO_ECI=new Map,s.VALUES_TO_ECI=new Map,s.NAME_TO_ECI=new Map,s.Cp437=new s(Gn.Cp437,Int32Array.from([0,2]),"Cp437"),s.ISO8859_1=new s(Gn.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),s.ISO8859_2=new s(Gn.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),s.ISO8859_3=new s(Gn.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),s.ISO8859_4=new s(Gn.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),s.ISO8859_5=new s(Gn.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),s.ISO8859_6=new s(Gn.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),s.ISO8859_7=new s(Gn.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),s.ISO8859_8=new s(Gn.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),s.ISO8859_9=new s(Gn.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),s.ISO8859_10=new s(Gn.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),s.ISO8859_11=new s(Gn.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),s.ISO8859_13=new s(Gn.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),s.ISO8859_14=new s(Gn.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),s.ISO8859_15=new s(Gn.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),s.ISO8859_16=new s(Gn.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),s.SJIS=new s(Gn.SJIS,20,"SJIS","Shift_JIS"),s.Cp1250=new s(Gn.Cp1250,21,"Cp1250","windows-1250"),s.Cp1251=new s(Gn.Cp1251,22,"Cp1251","windows-1251"),s.Cp1252=new s(Gn.Cp1252,23,"Cp1252","windows-1252"),s.Cp1256=new s(Gn.Cp1256,24,"Cp1256","windows-1256"),s.UnicodeBigUnmarked=new s(Gn.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),s.UTF8=new s(Gn.UTF8,26,"UTF8","UTF-8"),s.ASCII=new s(Gn.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),s.Big5=new s(Gn.Big5,28,"Big5"),s.GB18030=new s(Gn.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),s.EUC_KR=new s(Gn.EUC_KR,30,"EUC_KR","EUC-KR"),s}();const vi=Pi;var qr=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ci=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return qr(e,s),e.kind="UnsupportedOperationException",e}(Bt);const Ni=Ci;var fr=function(){function s(){}return s.decode=function(e,n){var a=this.encodingName(n);return this.customDecoder?this.customDecoder(e,a):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(a)?this.decodeFallback(e,a):new TextDecoder(a).decode(e)},s.shouldDecodeOnFallback=function(e){return!s.isBrowser()&&"ISO-8859-1"===e},s.encode=function(e,n){var a=this.encodingName(n);return this.customEncoder?this.customEncoder(e,a):typeof TextEncoder>"u"?this.encodeFallback(e):(new TextEncoder).encode(e)},s.isBrowser=function(){return typeof window<"u"&&"[object Window]"==={}.toString.call(window)},s.encodingName=function(e){return"string"==typeof e?e:e.getName()},s.encodingCharacterSet=function(e){return e instanceof vi?e:vi.getCharacterSetECIByName(e)},s.decodeFallback=function(e,n){var a=this.encodingCharacterSet(n);if(s.isDecodeFallbackSupported(a)){for(var u="",p=0,w=e.length;p<w;p++){var E=e[p].toString(16);E.length<2&&(E="0"+E),u+="%"+E}return decodeURIComponent(u)}if(a.equals(vi.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new Ni("Encoding "+this.encodingName(n)+" not supported by fallback.")},s.isDecodeFallbackSupported=function(e){return e.equals(vi.UTF8)||e.equals(vi.ISO8859_1)||e.equals(vi.ASCII)},s.encodeFallback=function(e){for(var a=btoa(unescape(encodeURIComponent(e))).split(""),u=[],p=0;p<a.length;p++)u.push(a[p].charCodeAt(0));return new Uint8Array(u)},s}();const Ai=fr;var wr=function(){function s(){}return s.castAsNonUtf8Char=function(e,n){void 0===n&&(n=null);var a=n?n.getName():this.ISO88591;return Ai.decode(new Uint8Array([e]),a)},s.guessEncoding=function(e,n){if(null!=n&&void 0!==n.get(Qn.CHARACTER_SET))return n.get(Qn.CHARACTER_SET).toString();for(var a=e.length,u=!0,p=!0,w=!0,E=0,I=0,R=0,V=0,W=0,ee=0,oe=0,Ce=0,Ne=0,ot=0,ut=0,at=e.length>3&&239===e[0]&&187===e[1]&&191===e[2],Pt=0;Pt<a&&(u||p||w);Pt++){var Wt=255&e[Pt];w&&(E>0?128&Wt?E--:w=!1:128&Wt&&(64&Wt?(E++,32&Wt?(E++,16&Wt?(E++,8&Wt?w=!1:V++):R++):I++):w=!1)),u&&(Wt>127&&Wt<160?u=!1:Wt>159&&(Wt<192||215===Wt||247===Wt)&&ut++),p&&(W>0?Wt<64||127===Wt||Wt>252?p=!1:W--:128===Wt||160===Wt||Wt>239?p=!1:Wt>160&&Wt<224?(ee++,Ce=0,++oe>Ne&&(Ne=oe)):Wt>127?(W++,oe=0,++Ce>ot&&(ot=Ce)):(oe=0,Ce=0))}return w&&E>0&&(w=!1),p&&W>0&&(p=!1),w&&(at||I+R+V>0)?s.UTF8:p&&(s.ASSUME_SHIFT_JIS||Ne>=3||ot>=3)?s.SHIFT_JIS:u&&p?2===Ne&&2===ee||10*ut>=a?s.SHIFT_JIS:s.ISO88591:u?s.ISO88591:p?s.SHIFT_JIS:w?s.UTF8:s.PLATFORM_DEFAULT_ENCODING},s.format=function(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];var u=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function p(E,I,R,V,W,ee){if("%%"===E)return"%";if(void 0!==n[++u]){E=V?parseInt(V.substr(1)):void 0;var Ce,oe=W?parseInt(W.substr(1)):void 0;switch(ee){case"s":Ce=n[u];break;case"c":Ce=n[u][0];break;case"f":Ce=parseFloat(n[u]).toFixed(E);break;case"p":Ce=parseFloat(n[u]).toPrecision(E);break;case"e":Ce=parseFloat(n[u]).toExponential(E);break;case"x":Ce=parseInt(n[u]).toString(oe||16);break;case"d":Ce=parseFloat(parseInt(n[u],oe||10).toPrecision(E)).toFixed(0)}Ce="object"==typeof Ce?JSON.stringify(Ce):(+Ce).toString(oe);for(var Ne=parseInt(R),ot=R&&R[0]+""=="0"?"0":" ";Ce.length<Ne;)Ce=void 0!==I?Ce+ot:ot+Ce;return Ce}})},s.getBytes=function(e,n){return Ai.encode(e,n)},s.getCharCode=function(e,n){return void 0===n&&(n=0),e.charCodeAt(n)},s.getCharAt=function(e){return String.fromCharCode(e)},s.SHIFT_JIS=vi.SJIS.getName(),s.GB2312="GB2312",s.ISO88591=vi.ISO8859_1.getName(),s.EUC_JP="EUC_JP",s.UTF8=vi.UTF8.getName(),s.PLATFORM_DEFAULT_ENCODING=s.UTF8,s.ASSUME_SHIFT_JIS=!1,s}();const Pr=wr;var xi=function(){function s(e){void 0===e&&(e=""),this.value=e}return s.prototype.enableDecoding=function(e){return this.encoding=e,this},s.prototype.append=function(e){return this.value+="string"==typeof e?e.toString():this.encoding?Pr.castAsNonUtf8Char(e,this.encoding):String.fromCharCode(e),this},s.prototype.appendChars=function(e,n,a){for(var u=n;n<n+a;u++)this.append(e[u]);return this},s.prototype.length=function(){return this.value.length},s.prototype.charAt=function(e){return this.value.charAt(e)},s.prototype.deleteCharAt=function(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)},s.prototype.setCharAt=function(e,n){this.value=this.value.substr(0,e)+n+this.value.substr(e+1)},s.prototype.substring=function(e,n){return this.value.substring(e,n)},s.prototype.setLengthToZero=function(){this.value=""},s.prototype.toString=function(){return this.value},s.prototype.insert=function(e,n){this.value=this.value.substring(0,e)+n+this.value.substring(e)},s}();const _r=xi;var Rr=function(){function s(e,n,a,u){if(this.width=e,this.height=n,this.rowSize=a,this.bits=u,null==n&&(n=e),this.height=n,e<1||n<1)throw new Xt("Both dimensions must be greater than 0");null==a&&(a=Math.floor((e+31)/32)),this.rowSize=a,null==u&&(this.bits=new Int32Array(this.rowSize*this.height))}return s.parseFromBooleanArray=function(e){for(var n=e.length,a=e[0].length,u=new s(a,n),p=0;p<n;p++)for(var w=e[p],E=0;E<a;E++)w[E]&&u.set(E,p);return u},s.parseFromString=function(e,n,a){if(null===e)throw new Xt("stringRepresentation cannot be null");for(var u=new Array(e.length),p=0,w=0,E=-1,I=0,R=0;R<e.length;)if("\n"===e.charAt(R)||"\r"===e.charAt(R)){if(p>w){if(-1===E)E=p-w;else if(p-w!==E)throw new Xt("row lengths do not match");w=p,I++}R++}else if(e.substring(R,R+n.length)===n)R+=n.length,u[p]=!0,p++;else{if(e.substring(R,R+a.length)!==a)throw new Xt("illegal character encountered: "+e.substring(R));R+=a.length,u[p]=!1,p++}if(p>w){if(-1===E)E=p-w;else if(p-w!==E)throw new Xt("row lengths do not match");I++}for(var V=new s(E,I),W=0;W<p;W++)u[W]&&V.set(Math.floor(W%E),Math.floor(W/E));return V},s.prototype.get=function(e,n){var a=n*this.rowSize+Math.floor(e/32);return 0!=(this.bits[a]>>>(31&e)&1)},s.prototype.set=function(e,n){var a=n*this.rowSize+Math.floor(e/32);this.bits[a]|=1<<(31&e)&4294967295},s.prototype.unset=function(e,n){var a=n*this.rowSize+Math.floor(e/32);this.bits[a]&=~(1<<(31&e)&4294967295)},s.prototype.flip=function(e,n){var a=n*this.rowSize+Math.floor(e/32);this.bits[a]^=1<<(31&e)&4294967295},s.prototype.xor=function(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new Xt("input matrix dimensions do not match");for(var n=new _n(Math.floor(this.width/32)+1),a=this.rowSize,u=this.bits,p=0,w=this.height;p<w;p++)for(var E=p*a,I=e.getRow(p,n).getBitArray(),R=0;R<a;R++)u[E+R]^=I[R]},s.prototype.clear=function(){for(var e=this.bits,n=e.length,a=0;a<n;a++)e[a]=0},s.prototype.setRegion=function(e,n,a,u){if(n<0||e<0)throw new Xt("Left and top must be nonnegative");if(u<1||a<1)throw new Xt("Height and width must be at least 1");var p=e+a,w=n+u;if(w>this.height||p>this.width)throw new Xt("The region must fit inside the matrix");for(var E=this.rowSize,I=this.bits,R=n;R<w;R++)for(var V=R*E,W=e;W<p;W++)I[V+Math.floor(W/32)]|=1<<(31&W)&4294967295},s.prototype.getRow=function(e,n){null==n||n.getSize()<this.width?n=new _n(this.width):n.clear();for(var a=this.rowSize,u=this.bits,p=e*a,w=0;w<a;w++)n.setBulk(32*w,u[p+w]);return n},s.prototype.setRow=function(e,n){kn.arraycopy(n.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)},s.prototype.rotate180=function(){for(var e=this.getWidth(),n=this.getHeight(),a=new _n(e),u=new _n(e),p=0,w=Math.floor((n+1)/2);p<w;p++)a=this.getRow(p,a),u=this.getRow(n-1-p,u),a.reverse(),u.reverse(),this.setRow(p,u),this.setRow(n-1-p,a)},s.prototype.getEnclosingRectangle=function(){for(var n=this.height,a=this.rowSize,u=this.bits,p=this.width,w=n,E=-1,I=-1,R=0;R<n;R++)for(var V=0;V<a;V++){var W=u[R*a+V];if(0!==W){if(R<w&&(w=R),R>I&&(I=R),32*V<p){for(var ee=0;!(W<<31-ee&4294967295);)ee++;32*V+ee<p&&(p=32*V+ee)}if(32*V+31>E){for(ee=31;!(W>>>ee);)ee--;32*V+ee>E&&(E=32*V+ee)}}}return E<p||I<w?null:Int32Array.from([p,w,E-p+1,I-w+1])},s.prototype.getTopLeftOnBit=function(){for(var e=this.rowSize,n=this.bits,a=0;a<n.length&&0===n[a];)a++;if(a===n.length)return null;for(var u=a/e,p=a%e*32,w=n[a],E=0;!(w<<31-E&4294967295);)E++;return Int32Array.from([p+=E,u])},s.prototype.getBottomRightOnBit=function(){for(var e=this.rowSize,n=this.bits,a=n.length-1;a>=0&&0===n[a];)a--;if(a<0)return null;for(var u=Math.floor(a/e),p=32*Math.floor(a%e),w=n[a],E=31;!(w>>>E);)E--;return Int32Array.from([p+=E,u])},s.prototype.getWidth=function(){return this.width},s.prototype.getHeight=function(){return this.height},s.prototype.getRowSize=function(){return this.rowSize},s.prototype.equals=function(e){return e instanceof s&&(this.width===e.width&&this.height===e.height&&this.rowSize===e.rowSize&&Nt.equals(this.bits,e.bits))},s.prototype.hashCode=function(){var e=this.width;return 31*(e=31*(e=31*(e=31*e+this.width)+this.height)+this.rowSize)+Nt.hashCode(this.bits)},s.prototype.toString=function(e,n,a){return void 0===e&&(e="X "),void 0===n&&(n="  "),void 0===a&&(a="\n"),this.buildToString(e,n,a)},s.prototype.buildToString=function(e,n,a){for(var u=new _r,p=0,w=this.height;p<w;p++){for(var E=0,I=this.width;E<I;E++)u.append(this.get(E,p)?e:n);u.append(a)}return u.toString()},s.prototype.clone=function(){return new s(this.width,this.height,this.rowSize,this.bits.slice())},s}();const ur=Rr;var Mo=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ho=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Mo(e,s),e.getNotFoundInstance=function(){return new e},e.kind="NotFoundException",e}(Bt);const qt=Ho;var Xi=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),si=function(s){function e(n){var a=s.call(this,n)||this;return a.luminances=e.EMPTY,a.buckets=new Int32Array(e.LUMINANCE_BUCKETS),a}return Xi(e,s),e.prototype.getBlackRow=function(n,a){var u=this.getLuminanceSource(),p=u.getWidth();null==a||a.getSize()<p?a=new _n(p):a.clear(),this.initArrays(p);for(var w=u.getRow(n,this.luminances),E=this.buckets,I=0;I<p;I++)E[(255&w[I])>>e.LUMINANCE_SHIFT]++;var R=e.estimateBlackPoint(E);if(p<3)for(I=0;I<p;I++)(255&w[I])<R&&a.set(I);else{var V=255&w[0],W=255&w[1];for(I=1;I<p-1;I++){var ee=255&w[I+1];(4*W-V-ee)/2<R&&a.set(I),V=W,W=ee}}return a},e.prototype.getBlackMatrix=function(){var n=this.getLuminanceSource(),a=n.getWidth(),u=n.getHeight(),p=new ur(a,u);this.initArrays(a);for(var w=this.buckets,E=1;E<5;E++)for(var I=Math.floor(u*E/5),R=n.getRow(I,this.luminances),V=Math.floor(4*a/5),W=Math.floor(a/5);W<V;W++)w[(255&R[W])>>e.LUMINANCE_SHIFT]++;var oe=e.estimateBlackPoint(w),Ce=n.getMatrix();for(E=0;E<u;E++){var Ne=E*a;for(W=0;W<a;W++)(255&Ce[Ne+W])<oe&&p.set(W,E)}return p},e.prototype.createBinarizer=function(n){return new e(n)},e.prototype.initArrays=function(n){this.luminances.length<n&&(this.luminances=new Uint8ClampedArray(n));for(var a=this.buckets,u=0;u<e.LUMINANCE_BUCKETS;u++)a[u]=0},e.estimateBlackPoint=function(n){for(var a=n.length,u=0,p=0,w=0,E=0;E<a;E++)n[E]>w&&(p=E,w=n[E]),n[E]>u&&(u=n[E]);var I=0,R=0;for(E=0;E<a;E++){var V=E-p;(W=n[E]*V*V)>R&&(I=E,R=W)}if(p>I){var ee=p;p=I,I=ee}if(I-p<=a/16)throw new qt;var oe=I-1,Ce=-1;for(E=I-1;E>p;E--){var W,Ne=E-p;(W=Ne*Ne*(I-E)*(u-n[E]))>Ce&&(oe=E,Ce=W)}return oe<<e.LUMINANCE_SHIFT},e.LUMINANCE_SHIFT=8-(e.LUMINANCE_BITS=5),e.LUMINANCE_BUCKETS=1<<e.LUMINANCE_BITS,e.EMPTY=Uint8ClampedArray.from([0]),e}(Kt);const po=si;var Jr=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),wo=function(s){function e(n){var a=s.call(this,n)||this;return a.matrix=null,a}return Jr(e,s),e.prototype.getBlackMatrix=function(){if(null!==this.matrix)return this.matrix;var n=this.getLuminanceSource(),a=n.getWidth(),u=n.getHeight();if(a>=e.MINIMUM_DIMENSION&&u>=e.MINIMUM_DIMENSION){var p=n.getMatrix(),w=a>>e.BLOCK_SIZE_POWER;a&e.BLOCK_SIZE_MASK&&w++;var E=u>>e.BLOCK_SIZE_POWER;u&e.BLOCK_SIZE_MASK&&E++;var I=e.calculateBlackPoints(p,w,E,a,u),R=new ur(a,u);e.calculateThresholdForBlock(p,w,E,a,u,I,R),this.matrix=R}else this.matrix=s.prototype.getBlackMatrix.call(this);return this.matrix},e.prototype.createBinarizer=function(n){return new e(n)},e.calculateThresholdForBlock=function(n,a,u,p,w,E,I){for(var R=w-e.BLOCK_SIZE,V=p-e.BLOCK_SIZE,W=0;W<u;W++){var ee=W<<e.BLOCK_SIZE_POWER;ee>R&&(ee=R);for(var oe=e.cap(W,2,u-3),Ce=0;Ce<a;Ce++){var Ne=Ce<<e.BLOCK_SIZE_POWER;Ne>V&&(Ne=V);for(var ot=e.cap(Ce,2,a-3),ut=0,at=-2;at<=2;at++){var Pt=E[oe+at];ut+=Pt[ot-2]+Pt[ot-1]+Pt[ot]+Pt[ot+1]+Pt[ot+2]}e.thresholdBlock(n,Ne,ee,ut/25,p,I)}}},e.cap=function(n,a,u){return n<a?a:n>u?u:n},e.thresholdBlock=function(n,a,u,p,w,E){for(var I=0,R=u*w+a;I<e.BLOCK_SIZE;I++,R+=w)for(var V=0;V<e.BLOCK_SIZE;V++)(255&n[R+V])<=p&&E.set(a+V,u+I)},e.calculateBlackPoints=function(n,a,u,p,w){for(var E=w-e.BLOCK_SIZE,I=p-e.BLOCK_SIZE,R=new Array(u),V=0;V<u;V++){R[V]=new Int32Array(a);var W=V<<e.BLOCK_SIZE_POWER;W>E&&(W=E);for(var ee=0;ee<a;ee++){var oe=ee<<e.BLOCK_SIZE_POWER;oe>I&&(oe=I);for(var Ce=0,Ne=255,ot=0,ut=0,at=W*p+oe;ut<e.BLOCK_SIZE;ut++,at+=p){for(var Pt=0;Pt<e.BLOCK_SIZE;Pt++){var Wt=255&n[at+Pt];Ce+=Wt,Wt<Ne&&(Ne=Wt),Wt>ot&&(ot=Wt)}if(ot-Ne>e.MIN_DYNAMIC_RANGE)for(ut++,at+=p;ut<e.BLOCK_SIZE;ut++,at+=p)for(Pt=0;Pt<e.BLOCK_SIZE;Pt++)Ce+=255&n[at+Pt]}var wn=Ce>>2*e.BLOCK_SIZE_POWER;if(ot-Ne<=e.MIN_DYNAMIC_RANGE&&(wn=Ne/2,V>0&&ee>0)){var Un=(R[V-1][ee]+2*R[V][ee-1]+R[V-1][ee-1])/4;Ne<Un&&(wn=Un)}R[V][ee]=wn}}return R},e.BLOCK_SIZE_MASK=(e.BLOCK_SIZE=1<<(e.BLOCK_SIZE_POWER=3))-1,e.MINIMUM_DIMENSION=5*e.BLOCK_SIZE,e.MIN_DYNAMIC_RANGE=24,e}(po);const nr=wo;var Bs=function(){function s(e,n){this.width=e,this.height=n}return s.prototype.getWidth=function(){return this.width},s.prototype.getHeight=function(){return this.height},s.prototype.isCropSupported=function(){return!1},s.prototype.crop=function(e,n,a,u){throw new Ni("This luminance source does not support cropping.")},s.prototype.isRotateSupported=function(){return!1},s.prototype.rotateCounterClockwise=function(){throw new Ni("This luminance source does not support rotation by 90 degrees.")},s.prototype.rotateCounterClockwise45=function(){throw new Ni("This luminance source does not support rotation by 45 degrees.")},s.prototype.toString=function(){for(var e=new Uint8ClampedArray(this.width),n=new _r,a=0;a<this.height;a++){for(var u=this.getRow(a,e),p=0;p<this.width;p++){var w=255&u[p];n.append(w<64?"#":w<128?"+":w<192?".":" ")}n.append("\n")}return n.toString()},s}();const Ue=Bs;var ge=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ve=function(s){function e(n){var a=s.call(this,n.getWidth(),n.getHeight())||this;return a.delegate=n,a}return ge(e,s),e.prototype.getRow=function(n,a){for(var u=this.delegate.getRow(n,a),p=this.getWidth(),w=0;w<p;w++)u[w]=255-(255&u[w]);return u},e.prototype.getMatrix=function(){for(var n=this.delegate.getMatrix(),a=this.getWidth()*this.getHeight(),u=new Uint8ClampedArray(a),p=0;p<a;p++)u[p]=255-(255&n[p]);return u},e.prototype.isCropSupported=function(){return this.delegate.isCropSupported()},e.prototype.crop=function(n,a,u,p){return new e(this.delegate.crop(n,a,u,p))},e.prototype.isRotateSupported=function(){return this.delegate.isRotateSupported()},e.prototype.invert=function(){return this.delegate},e.prototype.rotateCounterClockwise=function(){return new e(this.delegate.rotateCounterClockwise())},e.prototype.rotateCounterClockwise45=function(){return new e(this.delegate.rotateCounterClockwise45())},e}(Ue);const Re=ve;var Oe=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),rt=function(s){function e(n){var a=s.call(this,n.width,n.height)||this;return a.canvas=n,a.tempCanvasElement=null,a.buffer=e.makeBufferFromCanvasImageData(n),a}return Oe(e,s),e.makeBufferFromCanvasImageData=function(n){var a=n.getContext("2d").getImageData(0,0,n.width,n.height);return e.toGrayscaleBuffer(a.data,n.width,n.height)},e.toGrayscaleBuffer=function(n,a,u){var p=new Uint8ClampedArray(a*u);if(e.FRAME_INDEX=!e.FRAME_INDEX)for(var w=0,E=0,I=n.length;w<I;w+=4,E++){p[E]=0===n[w+3]?255:306*n[w]+601*n[w+1]+117*n[w+2]+512>>10}else{w=0,E=0;for(var Ce=n.length;w<Ce;w+=4,E++)void 0,p[E]=255-(0===n[w+3]?255:306*n[w]+601*n[w+1]+117*n[w+2]+512>>10)}return p},e.prototype.getRow=function(n,a){if(n<0||n>=this.getHeight())throw new Xt("Requested row is outside the image: "+n);var u=this.getWidth(),p=n*u;return null===a?a=this.buffer.slice(p,p+u):(a.length<u&&(a=new Uint8ClampedArray(u)),a.set(this.buffer.slice(p,p+u))),a},e.prototype.getMatrix=function(){return this.buffer},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(n,a,u,p){return s.prototype.crop.call(this,n,a,u,p),this},e.prototype.isRotateSupported=function(){return!0},e.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},e.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},e.prototype.getTempCanvasElement=function(){if(null===this.tempCanvasElement){var n=this.canvas.ownerDocument.createElement("canvas");n.width=this.canvas.width,n.height=this.canvas.height,this.tempCanvasElement=n}return this.tempCanvasElement},e.prototype.rotate=function(n){var a=this.getTempCanvasElement(),u=a.getContext("2d"),p=n*e.DEGREE_TO_RADIANS,w=this.canvas.width,E=this.canvas.height,I=Math.ceil(Math.abs(Math.cos(p))*w+Math.abs(Math.sin(p))*E),R=Math.ceil(Math.abs(Math.sin(p))*w+Math.abs(Math.cos(p))*E);return a.width=I,a.height=R,u.translate(I/2,R/2),u.rotate(p),u.drawImage(this.canvas,w/-2,E/-2),this.buffer=e.makeBufferFromCanvasImageData(a),this},e.prototype.invert=function(){return new Re(this)},e.DEGREE_TO_RADIANS=Math.PI/180,e.FRAME_INDEX=!0,e}(Ue),wt=function(){function s(e,n,a){this.deviceId=e,this.label=n,this.kind="videoinput",this.groupId=a||void 0}return s.prototype.toJSON=function(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}},s}(),st=function(s,e,n,a){return new(n||(n=Promise))(function(p,w){function E(V){try{R(a.next(V))}catch(W){w(W)}}function I(V){try{R(a.throw(V))}catch(W){w(W)}}function R(V){V.done?p(V.value):function u(p){return p instanceof n?p:new n(function(w){w(p)})}(V.value).then(E,I)}R((a=a.apply(s,e||[])).next())})},Ye=function(s,e){var a,u,p,w,n={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return w={next:E(0),throw:E(1),return:E(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w;function E(R){return function(V){return function I(R){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,u&&(p=2&R[0]?u.return:R[0]?u.throw||((p=u.return)&&p.call(u),0):u.next)&&!(p=p.call(u,R[1])).done)return p;switch(u=0,p&&(R=[2&R[0],p.value]),R[0]){case 0:case 1:p=R;break;case 4:return n.label++,{value:R[1],done:!1};case 5:n.label++,u=R[1],R=[0];continue;case 7:R=n.ops.pop(),n.trys.pop();continue;default:if(!(p=(p=n.trys).length>0&&p[p.length-1])&&(6===R[0]||2===R[0])){n=0;continue}if(3===R[0]&&(!p||R[1]>p[0]&&R[1]<p[3])){n.label=R[1];break}if(6===R[0]&&n.label<p[1]){n.label=p[1],p=R;break}if(p&&n.label<p[2]){n.label=p[2],n.ops.push(R);break}p[2]&&n.ops.pop(),n.trys.pop();continue}R=e.call(s,n)}catch(V){R=[6,V],u=0}finally{a=p=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([R,V])}}},pn=function(){function s(e,n,a){void 0===n&&(n=500),this.reader=e,this.timeBetweenScansMillis=n,this._hints=a,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}return Object.defineProperty(s.prototype,"hasNavigator",{get:function(){return typeof navigator<"u"},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isMediaDevicesSuported",{get:function(){return this.hasNavigator&&!!navigator.mediaDevices},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"canEnumerateDevices",{get:function(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"timeBetweenDecodingAttempts",{get:function(){return this._timeBetweenDecodingAttempts},set:function(e){this._timeBetweenDecodingAttempts=e<0?0:e},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"hints",{get:function(){return this._hints},set:function(e){this._hints=e||null},enumerable:!1,configurable:!0}),s.prototype.listVideoInputDevices=function(){return st(this,void 0,void 0,function(){var e,n,a,u,p,w,W,ee;return Ye(this,function(oe){switch(oe.label){case 0:if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=oe.sent(),n=[];try{for(a=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),u=a.next();!u.done;u=a.next())"videoinput"===(w="video"===(p=u.value).kind?"videoinput":p.kind)&&n.push({deviceId:p.deviceId||p.id,label:p.label||"Video device "+(n.length+1),kind:w,groupId:p.groupId})}catch(Ce){W={error:Ce}}finally{try{u&&!u.done&&(ee=a.return)&&ee.call(a)}finally{if(W)throw W.error}}return[2,n]}})})},s.prototype.getVideoInputDevices=function(){return st(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return[4,this.listVideoInputDevices()];case 1:return[2,n.sent().map(function(a){return new wt(a.deviceId,a.label)})]}})})},s.prototype.findDeviceById=function(e){return st(this,void 0,void 0,function(){var n;return Ye(this,function(a){switch(a.label){case 0:return[4,this.listVideoInputDevices()];case 1:return(n=a.sent())?[2,n.find(function(u){return u.deviceId===e})]:[2,null]}})})},s.prototype.decodeFromInputVideoDevice=function(e,n){return st(this,void 0,void 0,function(){return Ye(this,function(a){switch(a.label){case 0:return[4,this.decodeOnceFromVideoDevice(e,n)];case 1:return[2,a.sent()]}})})},s.prototype.decodeOnceFromVideoDevice=function(e,n){return st(this,void 0,void 0,function(){return Ye(this,function(p){switch(p.label){case 0:return this.reset(),[4,this.decodeOnceFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},n)];case 1:return[2,p.sent()]}})})},s.prototype.decodeOnceFromConstraints=function(e,n){return st(this,void 0,void 0,function(){var a;return Ye(this,function(u){switch(u.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return a=u.sent(),[4,this.decodeOnceFromStream(a,n)];case 2:return[2,u.sent()]}})})},s.prototype.decodeOnceFromStream=function(e,n){return st(this,void 0,void 0,function(){var a;return Ye(this,function(p){switch(p.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,n)];case 1:return a=p.sent(),[4,this.decodeOnce(a)];case 2:return[2,p.sent()]}})})},s.prototype.decodeFromInputVideoDeviceContinuously=function(e,n,a){return st(this,void 0,void 0,function(){return Ye(this,function(u){switch(u.label){case 0:return[4,this.decodeFromVideoDevice(e,n,a)];case 1:return[2,u.sent()]}})})},s.prototype.decodeFromVideoDevice=function(e,n,a){return st(this,void 0,void 0,function(){return Ye(this,function(w){switch(w.label){case 0:return[4,this.decodeFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},n,a)];case 1:return[2,w.sent()]}})})},s.prototype.decodeFromConstraints=function(e,n,a){return st(this,void 0,void 0,function(){var u;return Ye(this,function(p){switch(p.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return u=p.sent(),[4,this.decodeFromStream(u,n,a)];case 2:return[2,p.sent()]}})})},s.prototype.decodeFromStream=function(e,n,a){return st(this,void 0,void 0,function(){var u;return Ye(this,function(p){switch(p.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,n)];case 1:return u=p.sent(),[4,this.decodeContinuously(u,a)];case 2:return[2,p.sent()]}})})},s.prototype.stopAsyncDecode=function(){this._stopAsyncDecode=!0},s.prototype.stopContinuousDecode=function(){this._stopContinuousDecode=!0},s.prototype.attachStreamToVideo=function(e,n){return st(this,void 0,void 0,function(){var a;return Ye(this,function(u){switch(u.label){case 0:return a=this.prepareVideoElement(n),this.addVideoSource(a,e),this.videoElement=a,this.stream=e,[4,this.playVideoOnLoadAsync(a)];case 1:return u.sent(),[2,a]}})})},s.prototype.playVideoOnLoadAsync=function(e){var n=this;return new Promise(function(a,u){return n.playVideoOnLoad(e,function(){return a()})})},s.prototype.playVideoOnLoad=function(e,n){var a=this;this.videoEndedListener=function(){return a.stopStreams()},this.videoCanPlayListener=function(){return a.tryPlayVideo(e)},e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",n),this.tryPlayVideo(e)},s.prototype.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2},s.prototype.tryPlayVideo=function(e){return st(this,void 0,void 0,function(){return Ye(this,function(a){switch(a.label){case 0:if(this.isVideoPlaying(e))return console.warn("Trying to play video that is already playing."),[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.play()];case 2:return a.sent(),[3,4];case 3:return a.sent(),console.warn("It was not possible to play the video."),[3,4];case 4:return[2]}})})},s.prototype.getMediaElement=function(e,n){var a=document.getElementById(e);if(!a)throw new jn("element with id '"+e+"' not found");if(a.nodeName.toLowerCase()!==n.toLowerCase())throw new jn("element with id '"+e+"' must be an "+n+" element");return a},s.prototype.decodeFromImage=function(e,n){if(!e&&!n)throw new jn("either imageElement with a src set or an url must be provided");return n&&!e?this.decodeFromImageUrl(n):this.decodeFromImageElement(e)},s.prototype.decodeFromVideo=function(e,n){if(!e&&!n)throw new jn("Either an element with a src set or an URL must be provided");return n&&!e?this.decodeFromVideoUrl(n):this.decodeFromVideoElement(e)},s.prototype.decodeFromVideoContinuously=function(e,n,a){if(void 0===e&&void 0===n)throw new jn("Either an element with a src set or an URL must be provided");return n&&!e?this.decodeFromVideoUrlContinuously(n,a):this.decodeFromVideoElementContinuously(e,a)},s.prototype.decodeFromImageElement=function(e){if(!e)throw new jn("An image element must be provided.");this.reset();var n=this.prepareImageElement(e);return this.imageElement=n,this.isImageLoaded(n)?this.decodeOnce(n,!1,!0):this._decodeOnLoadImage(n)},s.prototype.decodeFromVideoElement=function(e){var n=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(n)},s.prototype.decodeFromVideoElementContinuously=function(e,n){var a=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(a,n)},s.prototype._decodeFromVideoElementSetup=function(e){if(!e)throw new jn("A video element must be provided.");this.reset();var n=this.prepareVideoElement(e);return this.videoElement=n,n},s.prototype.decodeFromImageUrl=function(e){if(!e)throw new jn("An URL must be provided.");this.reset();var n=this.prepareImageElement();this.imageElement=n;var a=this._decodeOnLoadImage(n);return n.src=e,a},s.prototype.decodeFromVideoUrl=function(e){if(!e)throw new jn("An URL must be provided.");this.reset();var n=this.prepareVideoElement(),a=this.decodeFromVideoElement(n);return n.src=e,a},s.prototype.decodeFromVideoUrlContinuously=function(e,n){if(!e)throw new jn("An URL must be provided.");this.reset();var a=this.prepareVideoElement(),u=this.decodeFromVideoElementContinuously(a,n);return a.src=e,u},s.prototype._decodeOnLoadImage=function(e){var n=this;return new Promise(function(a,u){n.imageLoadedListener=function(){return n.decodeOnce(e,!1,!0).then(a,u)},e.addEventListener("load",n.imageLoadedListener)})},s.prototype._decodeOnLoadVideo=function(e){return st(this,void 0,void 0,function(){return Ye(this,function(n){switch(n.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return n.sent(),[4,this.decodeOnce(e)];case 2:return[2,n.sent()]}})})},s.prototype._decodeOnLoadVideoContinuously=function(e,n){return st(this,void 0,void 0,function(){return Ye(this,function(a){switch(a.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return a.sent(),this.decodeContinuously(e,n),[2]}})})},s.prototype.isImageLoaded=function(e){return!(!e.complete||0===e.naturalWidth)},s.prototype.prepareImageElement=function(e){var n;return typeof e>"u"&&((n=document.createElement("img")).width=200,n.height=200),"string"==typeof e&&(n=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(n=e),n},s.prototype.prepareVideoElement=function(e){var n;return!e&&typeof document<"u"&&((n=document.createElement("video")).width=200,n.height=200),"string"==typeof e&&(n=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(n=e),n.setAttribute("autoplay","true"),n.setAttribute("muted","true"),n.setAttribute("playsinline","true"),n},s.prototype.decodeOnce=function(e,n,a){var u=this;void 0===n&&(n=!0),void 0===a&&(a=!0),this._stopAsyncDecode=!1;var p=function(w,E){if(u._stopAsyncDecode)return E(new qt("Video stream has ended before any code could be detected.")),void(u._stopAsyncDecode=void 0);try{w(u.decode(e))}catch(ee){if(n&&ee instanceof qt||(ee instanceof Wn||ee instanceof nn)&&a)return setTimeout(p,u._timeBetweenDecodingAttempts,w,E);E(ee)}};return new Promise(function(w,E){return p(w,E)})},s.prototype.decodeContinuously=function(e,n){var a=this;this._stopContinuousDecode=!1;var u=function(){if(a._stopContinuousDecode)a._stopContinuousDecode=void 0;else try{var p=a.decode(e);n(p,null),setTimeout(u,a.timeBetweenScansMillis)}catch(I){n(null,I),(I instanceof Wn||I instanceof nn||I instanceof qt)&&setTimeout(u,a._timeBetweenDecodingAttempts)}};u()},s.prototype.decode=function(e){var n=this.createBinaryBitmap(e);return this.decodeBitmap(n)},s.prototype.createBinaryBitmap=function(e){this.getCaptureCanvasContext(e),e instanceof HTMLVideoElement?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);var a=this.getCaptureCanvas(e),u=new rt(a),p=new nr(u);return new kt(p)},s.prototype.getCaptureCanvasContext=function(e){if(!this.captureCanvasContext){var n=this.getCaptureCanvas(e),a=void 0;try{a=n.getContext("2d",{willReadFrequently:!0})}catch{a=n.getContext("2d")}this.captureCanvasContext=a}return this.captureCanvasContext},s.prototype.getCaptureCanvas=function(e){if(!this.captureCanvas){var n=this.createCaptureCanvas(e);this.captureCanvas=n}return this.captureCanvas},s.prototype.drawFrameOnCanvas=function(e,n,a){void 0===n&&(n={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),void 0===a&&(a=this.captureCanvasContext),a.drawImage(e,n.sx,n.sy,n.sWidth,n.sHeight,n.dx,n.dy,n.dWidth,n.dHeight)},s.prototype.drawImageOnCanvas=function(e,n,a){void 0===n&&(n={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),void 0===a&&(a=this.captureCanvasContext),a.drawImage(e,n.sx,n.sy,n.sWidth,n.sHeight,n.dx,n.dy,n.dWidth,n.dHeight)},s.prototype.decodeBitmap=function(e){return this.reader.decode(e,this._hints)},s.prototype.createCaptureCanvas=function(e){if(typeof document>"u")return this._destroyCaptureCanvas(),null;var a,u,n=document.createElement("canvas");return typeof e<"u"&&(e instanceof HTMLVideoElement?(a=e.videoWidth,u=e.videoHeight):e instanceof HTMLImageElement&&(a=e.naturalWidth||e.width,u=e.naturalHeight||e.height)),n.style.width=a+"px",n.style.height=u+"px",n.width=a,n.height=u,n},s.prototype.stopStreams=function(){this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()},s.prototype.reset=function(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()},s.prototype._destroyVideoElement=function(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)},s.prototype._destroyImageElement=function(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)},s.prototype._destroyCaptureCanvas=function(){this.captureCanvasContext=void 0,this.captureCanvas=void 0},s.prototype.addVideoSource=function(e,n){try{e.srcObject=n}catch{e.src=URL.createObjectURL(n)}},s.prototype.cleanVideoSource=function(e){try{e.srcObject=null}catch{e.src=""}this.videoElement.removeAttribute("src")},s}(),Mn=function(){function s(e,n,a,u,p,w){void 0===a&&(a=null==n?0:8*n.length),void 0===w&&(w=kn.currentTimeMillis()),this.text=e,this.rawBytes=n,this.numBits=a,this.resultPoints=u,this.format=p,this.timestamp=w,this.text=e,this.rawBytes=n,this.numBits=null==a?null==n?0:8*n.length:a,this.resultPoints=u,this.format=p,this.resultMetadata=null,this.timestamp=null==w?kn.currentTimeMillis():w}return s.prototype.getText=function(){return this.text},s.prototype.getRawBytes=function(){return this.rawBytes},s.prototype.getNumBits=function(){return this.numBits},s.prototype.getResultPoints=function(){return this.resultPoints},s.prototype.getBarcodeFormat=function(){return this.format},s.prototype.getResultMetadata=function(){return this.resultMetadata},s.prototype.putMetadata=function(e,n){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,n)},s.prototype.putAllMetadata=function(e){null!==e&&(this.resultMetadata=null===this.resultMetadata?e:new Map(e))},s.prototype.addResultPoints=function(e){var n=this.resultPoints;if(null===n)this.resultPoints=e;else if(null!==e&&e.length>0){var a=new Array(n.length+e.length);kn.arraycopy(n,0,a,0,n.length),kn.arraycopy(e,0,a,n.length,e.length),this.resultPoints=a}},s.prototype.getTimestamp=function(){return this.timestamp},s.prototype.toString=function(){return this.text},s}();const Ze=Mn;var lt=function(s){return s[s.AZTEC=0]="AZTEC",s[s.CODABAR=1]="CODABAR",s[s.CODE_39=2]="CODE_39",s[s.CODE_93=3]="CODE_93",s[s.CODE_128=4]="CODE_128",s[s.DATA_MATRIX=5]="DATA_MATRIX",s[s.EAN_8=6]="EAN_8",s[s.EAN_13=7]="EAN_13",s[s.ITF=8]="ITF",s[s.MAXICODE=9]="MAXICODE",s[s.PDF_417=10]="PDF_417",s[s.QR_CODE=11]="QR_CODE",s[s.RSS_14=12]="RSS_14",s[s.RSS_EXPANDED=13]="RSS_EXPANDED",s[s.UPC_A=14]="UPC_A",s[s.UPC_E=15]="UPC_E",s[s.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION",s}(lt||{});const De=lt;var Ke=function(s){return s[s.OTHER=0]="OTHER",s[s.ORIENTATION=1]="ORIENTATION",s[s.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",s[s.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",s[s.ISSUE_NUMBER=4]="ISSUE_NUMBER",s[s.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",s[s.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",s[s.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",s[s.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",s[s.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",s[s.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY",s}(Ke||{});const Tt=Ke;var xn=function(){function s(e,n,a,u,p,w){void 0===p&&(p=-1),void 0===w&&(w=-1),this.rawBytes=e,this.text=n,this.byteSegments=a,this.ecLevel=u,this.structuredAppendSequenceNumber=p,this.structuredAppendParity=w,this.numBits=null==e?0:8*e.length}return s.prototype.getRawBytes=function(){return this.rawBytes},s.prototype.getNumBits=function(){return this.numBits},s.prototype.setNumBits=function(e){this.numBits=e},s.prototype.getText=function(){return this.text},s.prototype.getByteSegments=function(){return this.byteSegments},s.prototype.getECLevel=function(){return this.ecLevel},s.prototype.getErrorsCorrected=function(){return this.errorsCorrected},s.prototype.setErrorsCorrected=function(e){this.errorsCorrected=e},s.prototype.getErasures=function(){return this.erasures},s.prototype.setErasures=function(e){this.erasures=e},s.prototype.getOther=function(){return this.other},s.prototype.setOther=function(e){this.other=e},s.prototype.hasStructuredAppend=function(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0},s.prototype.getStructuredAppendParity=function(){return this.structuredAppendParity},s.prototype.getStructuredAppendSequenceNumber=function(){return this.structuredAppendSequenceNumber},s}();const Bn=xn;var Mr=function(){function s(){}return s.prototype.exp=function(e){return this.expTable[e]},s.prototype.log=function(e){if(0===e)throw new Xt;return this.logTable[e]},s.addOrSubtract=function(e,n){return e^n},s}();const Lr=Mr;var hi=function(){function s(e,n){if(0===n.length)throw new Xt;this.field=e;var a=n.length;if(a>1&&0===n[0]){for(var u=1;u<a&&0===n[u];)u++;u===a?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(a-u),kn.arraycopy(n,u,this.coefficients,0,this.coefficients.length))}else this.coefficients=n}return s.prototype.getCoefficients=function(){return this.coefficients},s.prototype.getDegree=function(){return this.coefficients.length-1},s.prototype.isZero=function(){return 0===this.coefficients[0]},s.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},s.prototype.evaluateAt=function(e){if(0===e)return this.getCoefficient(0);var a,n=this.coefficients;if(1===e){a=0;for(var u=0,p=n.length;u!==p;u++)a=Lr.addOrSubtract(a,n[u]);return a}a=n[0];var E=n.length,I=this.field;for(u=1;u<E;u++)a=Lr.addOrSubtract(I.multiply(e,a),n[u]);return a},s.prototype.addOrSubtract=function(e){if(!this.field.equals(e.field))throw new Xt("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;var n=this.coefficients,a=e.coefficients;if(n.length>a.length){var u=n;n=a,a=u}var p=new Int32Array(a.length),w=a.length-n.length;kn.arraycopy(a,0,p,0,w);for(var E=w;E<a.length;E++)p[E]=Lr.addOrSubtract(n[E-w],a[E]);return new s(this.field,p)},s.prototype.multiply=function(e){if(!this.field.equals(e.field))throw new Xt("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();for(var n=this.coefficients,a=n.length,u=e.coefficients,p=u.length,w=new Int32Array(a+p-1),E=this.field,I=0;I<a;I++)for(var R=n[I],V=0;V<p;V++)w[I+V]=Lr.addOrSubtract(w[I+V],E.multiply(R,u[V]));return new s(E,w)},s.prototype.multiplyScalar=function(e){if(0===e)return this.field.getZero();if(1===e)return this;for(var n=this.coefficients.length,a=this.field,u=new Int32Array(n),p=this.coefficients,w=0;w<n;w++)u[w]=a.multiply(p[w],e);return new s(a,u)},s.prototype.multiplyByMonomial=function(e,n){if(e<0)throw new Xt;if(0===n)return this.field.getZero();for(var a=this.coefficients,u=a.length,p=new Int32Array(u+e),w=this.field,E=0;E<u;E++)p[E]=w.multiply(a[E],n);return new s(w,p)},s.prototype.divide=function(e){if(!this.field.equals(e.field))throw new Xt("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new Xt("Divide by 0");for(var n=this.field,a=n.getZero(),u=this,p=e.getCoefficient(e.getDegree()),w=n.inverse(p);u.getDegree()>=e.getDegree()&&!u.isZero();){var E=u.getDegree()-e.getDegree(),I=n.multiply(u.getCoefficient(u.getDegree()),w),R=e.multiplyByMonomial(E,I),V=n.buildMonomial(E,I);a=a.addOrSubtract(V),u=u.addOrSubtract(R)}return[a,u]},s.prototype.toString=function(){for(var e="",n=this.getDegree();n>=0;n--){var a=this.getCoefficient(n);if(0!==a){if(a<0?(e+=" - ",a=-a):e.length>0&&(e+=" + "),0===n||1!==a){var u=this.field.log(a);0===u?e+="1":1===u?e+="a":(e+="a^",e+=u)}0!==n&&(1===n?e+="x":(e+="x^",e+=n))}}return e},s}();const zi=hi;var Ji=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),_t=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Ji(e,s),e.kind="ArithmeticException",e}(Bt);const Je=_t;var ct=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),an=function(s){function e(n,a,u){var p=s.call(this)||this;p.primitive=n,p.size=a,p.generatorBase=u;for(var w=new Int32Array(a),E=1,I=0;I<a;I++)w[I]=E,(E*=2)>=a&&(E^=n,E&=a-1);p.expTable=w;var R=new Int32Array(a);for(I=0;I<a-1;I++)R[w[I]]=I;return p.logTable=R,p.zero=new zi(p,Int32Array.from([0])),p.one=new zi(p,Int32Array.from([1])),p}return ct(e,s),e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(n,a){if(n<0)throw new Xt;if(0===a)return this.zero;var u=new Int32Array(n+1);return u[0]=a,new zi(this,u)},e.prototype.inverse=function(n){if(0===n)throw new Je;return this.expTable[this.size-this.logTable[n]-1]},e.prototype.multiply=function(n,a){return 0===n||0===a?0:this.expTable[(this.logTable[n]+this.logTable[a])%(this.size-1)]},e.prototype.getSize=function(){return this.size},e.prototype.getGeneratorBase=function(){return this.generatorBase},e.prototype.toString=function(){return"GF(0x"+mt.toHexString(this.primitive)+","+this.size+")"},e.prototype.equals=function(n){return n===this},e.AZTEC_DATA_12=new e(4201,4096,1),e.AZTEC_DATA_10=new e(1033,1024,1),e.AZTEC_DATA_6=new e(67,64,1),e.AZTEC_PARAM=new e(19,16,1),e.QR_CODE_FIELD_256=new e(285,256,0),e.DATA_MATRIX_FIELD_256=new e(301,256,1),e.AZTEC_DATA_8=e.DATA_MATRIX_FIELD_256,e.MAXICODE_FIELD_64=e.AZTEC_DATA_6,e}(Lr);const en=an;var In=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),zn=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return In(e,s),e.kind="ReedSolomonException",e}(Bt);const br=zn;var Sr=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ui=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Sr(e,s),e.kind="IllegalStateException",e}(Bt);const Fi=Ui;var _o=function(){function s(e){this.field=e}return s.prototype.decode=function(e,n){for(var a=this.field,u=new zi(a,e),p=new Int32Array(n),w=!0,E=0;E<n;E++){var I=u.evaluateAt(a.exp(E+a.getGeneratorBase()));p[p.length-1-E]=I,0!==I&&(w=!1)}if(!w){var R=new zi(a,p),V=this.runEuclideanAlgorithm(a.buildMonomial(n,1),R,n),ee=V[1],oe=this.findErrorLocations(V[0]),Ce=this.findErrorMagnitudes(ee,oe);for(E=0;E<oe.length;E++){var Ne=e.length-1-a.log(oe[E]);if(Ne<0)throw new br("Bad error location");e[Ne]=en.addOrSubtract(e[Ne],Ce[E])}}},s.prototype.runEuclideanAlgorithm=function(e,n,a){if(e.getDegree()<n.getDegree()){var u=e;e=n,n=u}for(var p=this.field,w=e,E=n,I=p.getZero(),R=p.getOne();E.getDegree()>=(a/2|0);){var V=w,W=I;if(I=R,(w=E).isZero())throw new br("r_{i-1} was zero");E=V;for(var ee=p.getZero(),oe=w.getCoefficient(w.getDegree()),Ce=p.inverse(oe);E.getDegree()>=w.getDegree()&&!E.isZero();){var Ne=E.getDegree()-w.getDegree(),ot=p.multiply(E.getCoefficient(E.getDegree()),Ce);ee=ee.addOrSubtract(p.buildMonomial(Ne,ot)),E=E.addOrSubtract(w.multiplyByMonomial(Ne,ot))}if(R=ee.multiply(I).addOrSubtract(W),E.getDegree()>=w.getDegree())throw new Fi("Division algorithm failed to reduce polynomial?")}var ut=R.getCoefficient(0);if(0===ut)throw new br("sigmaTilde(0) was zero");var at=p.inverse(ut);return[R.multiplyScalar(at),E.multiplyScalar(at)]},s.prototype.findErrorLocations=function(e){var n=e.getDegree();if(1===n)return Int32Array.from([e.getCoefficient(1)]);for(var a=new Int32Array(n),u=0,p=this.field,w=1;w<p.getSize()&&u<n;w++)0===e.evaluateAt(w)&&(a[u]=p.inverse(w),u++);if(u!==n)throw new br("Error locator degree does not match number of roots");return a},s.prototype.findErrorMagnitudes=function(e,n){for(var a=n.length,u=new Int32Array(a),p=this.field,w=0;w<a;w++){for(var E=p.inverse(n[w]),I=1,R=0;R<a;R++)if(w!==R){var V=p.multiply(n[R],E);I=p.multiply(I,1&V?-2&V:1|V)}u[w]=p.multiply(e.evaluateAt(E),p.inverse(I)),0!==p.getGeneratorBase()&&(u[w]=p.multiply(u[w],E))}return u},s}();const Jo=_o;var Vi=function(s){return s[s.UPPER=0]="UPPER",s[s.LOWER=1]="LOWER",s[s.MIXED=2]="MIXED",s[s.DIGIT=3]="DIGIT",s[s.PUNCT=4]="PUNCT",s[s.BINARY=5]="BINARY",s}(Vi||{}),ro=function(){function s(){}return s.prototype.decode=function(e){this.ddata=e;var n=e.getBits(),a=this.extractBits(n),u=this.correctBits(a),p=s.convertBoolArrayToByteArray(u),w=s.getEncodedData(u),E=new Bn(p,w,null,null);return E.setNumBits(u.length),E},s.highLevelDecode=function(e){return this.getEncodedData(e)},s.getEncodedData=function(e){for(var n=e.length,a=Vi.UPPER,u=Vi.UPPER,p="",w=0;w<n;)if(u===Vi.BINARY){if(n-w<5)break;var E=s.readCode(e,w,5);if(w+=5,0===E){if(n-w<11)break;E=s.readCode(e,w,11)+31,w+=11}for(var I=0;I<E;I++){if(n-w<8){w=n;break}var R=s.readCode(e,w,8);p+=Pr.castAsNonUtf8Char(R),w+=8}u=a}else{var V=u===Vi.DIGIT?4:5;if(n-w<V)break;R=s.readCode(e,w,V),w+=V;var W=s.getCharacter(u,R);W.startsWith("CTRL_")?(a=u,u=s.getTable(W.charAt(5)),"L"===W.charAt(6)&&(a=u)):(p+=W,u=a)}return p},s.getTable=function(e){switch(e){case"L":return Vi.LOWER;case"P":return Vi.PUNCT;case"M":return Vi.MIXED;case"D":return Vi.DIGIT;case"B":return Vi.BINARY;default:return Vi.UPPER}},s.getCharacter=function(e,n){switch(e){case Vi.UPPER:return s.UPPER_TABLE[n];case Vi.LOWER:return s.LOWER_TABLE[n];case Vi.MIXED:return s.MIXED_TABLE[n];case Vi.PUNCT:return s.PUNCT_TABLE[n];case Vi.DIGIT:return s.DIGIT_TABLE[n];default:throw new Fi("Bad table")}},s.prototype.correctBits=function(e){var n,a;this.ddata.getNbLayers()<=2?(a=6,n=en.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,n=en.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,n=en.AZTEC_DATA_10):(a=12,n=en.AZTEC_DATA_12);var u=this.ddata.getNbDatablocks(),p=e.length/a;if(p<u)throw new nn;for(var w=e.length%a,E=new Int32Array(p),I=0;I<p;I++,w+=a)E[I]=s.readCode(e,w,a);try{new Jo(n).decode(E,p-u)}catch(ot){throw new nn(ot)}var V=(1<<a)-1,W=0;for(I=0;I<u;I++){if(0===(ee=E[I])||ee===V)throw new nn;(1===ee||ee===V-1)&&W++}var oe=new Array(u*a-W),Ce=0;for(I=0;I<u;I++){var ee;if(1===(ee=E[I])||ee===V-1)oe.fill(ee>1,Ce,Ce+a-1),Ce+=a-1;else for(var Ne=a-1;Ne>=0;--Ne)oe[Ce++]=0!=(ee&1<<Ne)}return oe},s.prototype.extractBits=function(e){var n=this.ddata.isCompact(),a=this.ddata.getNbLayers(),u=(n?11:14)+4*a,p=new Int32Array(u),w=new Array(this.totalBitsInLayer(a,n));if(n)for(var E=0;E<p.length;E++)p[E]=E;else{var I=u+1+2*mt.truncDivision(mt.truncDivision(u,2)-1,15),R=u/2,V=mt.truncDivision(I,2);for(E=0;E<R;E++){var W=E+mt.truncDivision(E,15);p[R-E-1]=V-W-1,p[R+E]=V+W+1}}E=0;for(var ee=0;E<a;E++){for(var oe=4*(a-E)+(n?9:12),Ce=2*E,Ne=u-1-Ce,ot=0;ot<oe;ot++)for(var ut=2*ot,at=0;at<2;at++)w[ee+ut+at]=e.get(p[Ce+at],p[Ce+ot]),w[ee+2*oe+ut+at]=e.get(p[Ce+ot],p[Ne-at]),w[ee+4*oe+ut+at]=e.get(p[Ne-at],p[Ne-ot]),w[ee+6*oe+ut+at]=e.get(p[Ne-ot],p[Ce+at]);ee+=8*oe}return w},s.readCode=function(e,n,a){for(var u=0,p=n;p<n+a;p++)u<<=1,e[p]&&(u|=1);return u},s.readByte=function(e,n){var a=e.length-n;return a>=8?s.readCode(e,n,8):s.readCode(e,n,a)<<8-a},s.convertBoolArrayToByteArray=function(e){for(var n=new Uint8Array((e.length+7)/8),a=0;a<n.length;a++)n[a]=s.readByte(e,8*a);return n},s.prototype.totalBitsInLayer=function(e,n){return((n?88:112)+16*e)*e},s.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],s.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],s.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],s.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],s.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],s}();const yi=ro;var Et=function(){function s(){}return s.round=function(e){return isNaN(e)?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0},s.distance=function(e,n,a,u){var p=e-a,w=n-u;return Math.sqrt(p*p+w*w)},s.sum=function(e){for(var n=0,a=0,u=e.length;a!==u;a++)n+=e[a];return n},s}();const vr=Et;var Cr=function(){function s(){}return s.floatToIntBits=function(e){return e},s.MAX_VALUE=Number.MAX_SAFE_INTEGER,s}();const ai=Cr;var Gs=function(){function s(e,n){this.x=e,this.y=n}return s.prototype.getX=function(){return this.x},s.prototype.getY=function(){return this.y},s.prototype.equals=function(e){return e instanceof s&&(this.x===e.x&&this.y===e.y)},s.prototype.hashCode=function(){return 31*ai.floatToIntBits(this.x)+ai.floatToIntBits(this.y)},s.prototype.toString=function(){return"("+this.x+","+this.y+")"},s.orderBestPatterns=function(e){var p,w,E,n=this.distance(e[0],e[1]),a=this.distance(e[1],e[2]),u=this.distance(e[0],e[2]);if(a>=n&&a>=u?(w=e[0],p=e[1],E=e[2]):u>=a&&u>=n?(w=e[1],p=e[0],E=e[2]):(w=e[2],p=e[0],E=e[1]),this.crossProductZ(p,w,E)<0){var I=p;p=E,E=I}e[0]=p,e[1]=w,e[2]=E},s.distance=function(e,n){return vr.distance(e.x,e.y,n.x,n.y)},s.crossProductZ=function(e,n,a){var u=n.x,p=n.y;return(a.x-u)*(e.y-p)-(a.y-p)*(e.x-u)},s}();const Zn=Gs;var ka=function(){function s(e,n){this.bits=e,this.points=n}return s.prototype.getBits=function(){return this.bits},s.prototype.getPoints=function(){return this.points},s}();const Go=ka;var Qs=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Fn=function(s){function e(n,a,u,p,w){var E=s.call(this,n,a)||this;return E.compact=u,E.nbDatablocks=p,E.nbLayers=w,E}return Qs(e,s),e.prototype.getNbLayers=function(){return this.nbLayers},e.prototype.getNbDatablocks=function(){return this.nbDatablocks},e.prototype.isCompact=function(){return this.compact},e}(Go);const Hr=Fn;var kr=function(){function s(e,n,a,u){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==n&&(n=s.INIT_SIZE),null==a&&(a=e.getWidth()/2|0),null==u&&(u=e.getHeight()/2|0);var p=n/2|0;if(this.leftInit=a-p,this.rightInit=a+p,this.upInit=u-p,this.downInit=u+p,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new qt}return s.prototype.detect=function(){for(var e=this.leftInit,n=this.rightInit,a=this.upInit,u=this.downInit,p=!1,w=!0,E=!1,I=!1,R=!1,V=!1,W=!1,ee=this.width,oe=this.height;w;){w=!1;for(var Ce=!0;(Ce||!I)&&n<ee;)(Ce=this.containsBlackPoint(a,u,n,!1))?(n++,w=!0,I=!0):I||n++;if(n>=ee){p=!0;break}for(var Ne=!0;(Ne||!R)&&u<oe;)(Ne=this.containsBlackPoint(e,n,u,!0))?(u++,w=!0,R=!0):R||u++;if(u>=oe){p=!0;break}for(var ot=!0;(ot||!V)&&e>=0;)(ot=this.containsBlackPoint(a,u,e,!1))?(e--,w=!0,V=!0):V||e--;if(e<0){p=!0;break}for(var ut=!0;(ut||!W)&&a>=0;)(ut=this.containsBlackPoint(e,n,a,!0))?(a--,w=!0,W=!0):W||a--;if(a<0){p=!0;break}w&&(E=!0)}if(!p&&E){for(var at=n-e,Pt=null,Wt=1;null===Pt&&Wt<at;Wt++)Pt=this.getBlackPointOnSegment(e,u-Wt,e+Wt,u);if(null==Pt)throw new qt;var wn=null;for(Wt=1;null===wn&&Wt<at;Wt++)wn=this.getBlackPointOnSegment(e,a+Wt,e+Wt,a);if(null==wn)throw new qt;var Un=null;for(Wt=1;null===Un&&Wt<at;Wt++)Un=this.getBlackPointOnSegment(n,a+Wt,n-Wt,a);if(null==Un)throw new qt;var Xn=null;for(Wt=1;null===Xn&&Wt<at;Wt++)Xn=this.getBlackPointOnSegment(n,u-Wt,n-Wt,u);if(null==Xn)throw new qt;return this.centerEdges(Xn,Pt,Un,wn)}throw new qt},s.prototype.getBlackPointOnSegment=function(e,n,a,u){for(var p=vr.round(vr.distance(e,n,a,u)),w=(a-e)/p,E=(u-n)/p,I=this.image,R=0;R<p;R++){var V=vr.round(e+R*w),W=vr.round(n+R*E);if(I.get(V,W))return new Zn(V,W)}return null},s.prototype.centerEdges=function(e,n,a,u){var p=e.getX(),w=e.getY(),E=n.getX(),I=n.getY(),R=a.getX(),V=a.getY(),W=u.getX(),ee=u.getY(),oe=s.CORR;return p<this.width/2?[new Zn(W-oe,ee+oe),new Zn(E+oe,I+oe),new Zn(R-oe,V-oe),new Zn(p+oe,w-oe)]:[new Zn(W+oe,ee+oe),new Zn(E+oe,I-oe),new Zn(R-oe,V+oe),new Zn(p-oe,w-oe)]},s.prototype.containsBlackPoint=function(e,n,a,u){var p=this.image;if(u){for(var w=e;w<=n;w++)if(p.get(w,a))return!0}else for(var E=e;E<=n;E++)if(p.get(a,E))return!0;return!1},s.INIT_SIZE=10,s.CORR=1,s}();const bo=kr;var ws=function(){function s(){}return s.checkAndNudgePoints=function(e,n){for(var a=e.getWidth(),u=e.getHeight(),p=!0,w=0;w<n.length&&p;w+=2){var E=Math.floor(n[w]),I=Math.floor(n[w+1]);if(E<-1||E>a||I<-1||I>u)throw new qt;p=!1,-1===E?(n[w]=0,p=!0):E===a&&(n[w]=a-1,p=!0),-1===I?(n[w+1]=0,p=!0):I===u&&(n[w+1]=u-1,p=!0)}for(p=!0,w=n.length-2;w>=0&&p;w-=2){if(E=Math.floor(n[w]),I=Math.floor(n[w+1]),E<-1||E>a||I<-1||I>u)throw new qt;p=!1,-1===E?(n[w]=0,p=!0):E===a&&(n[w]=a-1,p=!0),-1===I?(n[w+1]=0,p=!0):I===u&&(n[w+1]=u-1,p=!0)}},s}();const Vr=ws;var $o=function(){function s(e,n,a,u,p,w,E,I,R){this.a11=e,this.a21=n,this.a31=a,this.a12=u,this.a22=p,this.a32=w,this.a13=E,this.a23=I,this.a33=R}return s.quadrilateralToQuadrilateral=function(e,n,a,u,p,w,E,I,R,V,W,ee,oe,Ce,Ne,ot){var ut=s.quadrilateralToSquare(e,n,a,u,p,w,E,I);return s.squareToQuadrilateral(R,V,W,ee,oe,Ce,Ne,ot).times(ut)},s.prototype.transformPoints=function(e){for(var n=e.length,a=this.a11,u=this.a12,p=this.a13,w=this.a21,E=this.a22,I=this.a23,R=this.a31,V=this.a32,W=this.a33,ee=0;ee<n;ee+=2){var oe=e[ee],Ce=e[ee+1],Ne=p*oe+I*Ce+W;e[ee]=(a*oe+w*Ce+R)/Ne,e[ee+1]=(u*oe+E*Ce+V)/Ne}},s.prototype.transformPointsWithValues=function(e,n){for(var a=this.a11,u=this.a12,p=this.a13,w=this.a21,E=this.a22,I=this.a23,R=this.a31,V=this.a32,W=this.a33,ee=e.length,oe=0;oe<ee;oe++){var Ce=e[oe],Ne=n[oe],ot=p*Ce+I*Ne+W;e[oe]=(a*Ce+w*Ne+R)/ot,n[oe]=(u*Ce+E*Ne+V)/ot}},s.squareToQuadrilateral=function(e,n,a,u,p,w,E,I){var R=e-a+p-E,V=n-u+w-I;if(0===R&&0===V)return new s(a-e,p-a,e,u-n,w-u,n,0,0,1);var W=a-p,ee=E-p,oe=u-w,Ce=I-w,Ne=W*Ce-ee*oe,ot=(R*Ce-ee*V)/Ne,ut=(W*V-R*oe)/Ne;return new s(a-e+ot*a,E-e+ut*E,e,u-n+ot*u,I-n+ut*I,n,ot,ut,1)},s.quadrilateralToSquare=function(e,n,a,u,p,w,E,I){return s.squareToQuadrilateral(e,n,a,u,p,w,E,I).buildAdjoint()},s.prototype.buildAdjoint=function(){return new s(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},s.prototype.times=function(e){return new s(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)},s}();const fa=$o;var as=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ls=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return as(e,s),e.prototype.sampleGrid=function(n,a,u,p,w,E,I,R,V,W,ee,oe,Ce,Ne,ot,ut,at,Pt,Wt){var wn=fa.quadrilateralToQuadrilateral(p,w,E,I,R,V,W,ee,oe,Ce,Ne,ot,ut,at,Pt,Wt);return this.sampleGridWithTransform(n,a,u,wn)},e.prototype.sampleGridWithTransform=function(n,a,u,p){if(a<=0||u<=0)throw new qt;for(var w=new ur(a,u),E=new Float32Array(2*a),I=0;I<u;I++){for(var R=E.length,V=I+.5,W=0;W<R;W+=2)E[W]=W/2+.5,E[W+1]=V;p.transformPoints(E),Vr.checkAndNudgePoints(n,E);try{for(W=0;W<R;W+=2)n.get(Math.floor(E[W]),Math.floor(E[W+1]))&&w.set(W/2,I)}catch{throw new qt}}return w},e}(Vr);const Ii=ls;var gs=function(){function s(){}return s.setGridSampler=function(e){s.gridSampler=e},s.getInstance=function(){return s.gridSampler},s.gridSampler=new Ii,s}();const ji=gs;var ko=function(){function s(e,n){this.x=e,this.y=n}return s.prototype.toResultPoint=function(){return new Zn(this.getX(),this.getY())},s.prototype.getX=function(){return this.x},s.prototype.getY=function(){return this.y},s}(),Za=function(){function s(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}return s.prototype.detect=function(){return this.detectMirror(!1)},s.prototype.detectMirror=function(e){var n=this.getMatrixCenter(),a=this.getBullsEyeCorners(n);if(e){var u=a[0];a[0]=a[2],a[2]=u}this.extractParameters(a);var p=this.sampleGrid(this.image,a[this.shift%4],a[(this.shift+1)%4],a[(this.shift+2)%4],a[(this.shift+3)%4]),w=this.getMatrixCornerPoints(a);return new Hr(p,w,this.compact,this.nbDataBlocks,this.nbLayers)},s.prototype.extractParameters=function(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new qt;var n=2*this.nbCenterLayers,a=new Int32Array([this.sampleLine(e[0],e[1],n),this.sampleLine(e[1],e[2],n),this.sampleLine(e[2],e[3],n),this.sampleLine(e[3],e[0],n)]);this.shift=this.getRotation(a,n);for(var u=0,p=0;p<4;p++){var w=a[(this.shift+p)%4];this.compact?(u<<=7,u+=w>>1&127):(u<<=10,u+=(w>>2&992)+(w>>1&31))}var E=this.getCorrectedParameterData(u,this.compact);this.compact?(this.nbLayers=1+(E>>6),this.nbDataBlocks=1+(63&E)):(this.nbLayers=1+(E>>11),this.nbDataBlocks=1+(2047&E))},s.prototype.getRotation=function(e,n){var a=0;e.forEach(function(p,w,E){a=(p>>n-2<<1)+(1&p)+(a<<3)}),a=((1&a)<<11)+(a>>1);for(var u=0;u<4;u++)if(mt.bitCount(a^this.EXPECTED_CORNER_BITS[u])<=2)return u;throw new qt},s.prototype.getCorrectedParameterData=function(e,n){var a,u;n?(a=7,u=2):(a=10,u=4);for(var p=a-u,w=new Int32Array(a),E=a-1;E>=0;--E)w[E]=15&e,e>>=4;try{new Jo(en.AZTEC_PARAM).decode(w,p)}catch{throw new qt}var R=0;for(E=0;E<u;E++)R=(R<<4)+w[E];return R},s.prototype.getBullsEyeCorners=function(e){var n=e,a=e,u=e,p=e,w=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){var E=this.getFirstDifferent(n,w,1,-1),I=this.getFirstDifferent(a,w,1,1),R=this.getFirstDifferent(u,w,-1,1),V=this.getFirstDifferent(p,w,-1,-1);if(this.nbCenterLayers>2){var W=this.distancePoint(V,E)*this.nbCenterLayers/(this.distancePoint(p,n)*(this.nbCenterLayers+2));if(W<.75||W>1.25||!this.isWhiteOrBlackRectangle(E,I,R,V))break}n=E,a=I,u=R,p=V,w=!w}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new qt;this.compact=5===this.nbCenterLayers;var ee=new Zn(n.getX()+.5,n.getY()-.5),oe=new Zn(a.getX()+.5,a.getY()+.5),Ce=new Zn(u.getX()-.5,u.getY()+.5),Ne=new Zn(p.getX()-.5,p.getY()-.5);return this.expandSquare([ee,oe,Ce,Ne],2*this.nbCenterLayers-3,2*this.nbCenterLayers)},s.prototype.getMatrixCenter=function(){var e,n,a,u;try{e=(p=new bo(this.image).detect())[0],n=p[1],a=p[2],u=p[3]}catch{var w=this.image.getWidth()/2,E=this.image.getHeight()/2;e=this.getFirstDifferent(new ko(w+7,E-7),!1,1,-1).toResultPoint(),n=this.getFirstDifferent(new ko(w+7,E+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ko(w-7,E+7),!1,-1,1).toResultPoint(),u=this.getFirstDifferent(new ko(w-7,E-7),!1,-1,-1).toResultPoint()}var I=vr.round((e.getX()+u.getX()+n.getX()+a.getX())/4),R=vr.round((e.getY()+u.getY()+n.getY()+a.getY())/4);try{var p;e=(p=new bo(this.image,15,I,R).detect())[0],n=p[1],a=p[2],u=p[3]}catch{e=this.getFirstDifferent(new ko(I+7,R-7),!1,1,-1).toResultPoint(),n=this.getFirstDifferent(new ko(I+7,R+7),!1,1,1).toResultPoint(),a=this.getFirstDifferent(new ko(I-7,R+7),!1,-1,1).toResultPoint(),u=this.getFirstDifferent(new ko(I-7,R-7),!1,-1,-1).toResultPoint()}return I=vr.round((e.getX()+u.getX()+n.getX()+a.getX())/4),R=vr.round((e.getY()+u.getY()+n.getY()+a.getY())/4),new ko(I,R)},s.prototype.getMatrixCornerPoints=function(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())},s.prototype.sampleGrid=function(e,n,a,u,p){var w=ji.getInstance(),E=this.getDimension(),I=E/2-this.nbCenterLayers,R=E/2+this.nbCenterLayers;return w.sampleGrid(e,E,E,I,I,R,I,R,R,I,R,n.getX(),n.getY(),a.getX(),a.getY(),u.getX(),u.getY(),p.getX(),p.getY())},s.prototype.sampleLine=function(e,n,a){for(var u=0,p=this.distanceResultPoint(e,n),w=p/a,E=e.getX(),I=e.getY(),R=w*(n.getX()-e.getX())/p,V=w*(n.getY()-e.getY())/p,W=0;W<a;W++)this.image.get(vr.round(E+W*R),vr.round(I+W*V))&&(u|=1<<a-W-1);return u},s.prototype.isWhiteOrBlackRectangle=function(e,n,a,u){e=new ko(e.getX()-3,e.getY()+3),n=new ko(n.getX()-3,n.getY()-3),a=new ko(a.getX()+3,a.getY()-3),u=new ko(u.getX()+3,u.getY()+3);var w=this.getColor(u,e);if(0===w)return!1;var E=this.getColor(e,n);return E===w&&(E=this.getColor(n,a))===w&&(E=this.getColor(a,u))===w},s.prototype.getColor=function(e,n){for(var a=this.distancePoint(e,n),u=(n.getX()-e.getX())/a,p=(n.getY()-e.getY())/a,w=0,E=e.getX(),I=e.getY(),R=this.image.get(e.getX(),e.getY()),V=Math.ceil(a),W=0;W<V;W++)I+=p,this.image.get(vr.round(E+=u),vr.round(I))!==R&&w++;var ee=w/a;return ee>.1&&ee<.9?0:ee<=.1===R?1:-1},s.prototype.getFirstDifferent=function(e,n,a,u){for(var p=e.getX()+a,w=e.getY()+u;this.isValid(p,w)&&this.image.get(p,w)===n;)p+=a,w+=u;for(p-=a,w-=u;this.isValid(p,w)&&this.image.get(p,w)===n;)p+=a;for(p-=a;this.isValid(p,w)&&this.image.get(p,w)===n;)w+=u;return new ko(p,w-=u)},s.prototype.expandSquare=function(e,n,a){var u=a/(2*n),p=e[0].getX()-e[2].getX(),w=e[0].getY()-e[2].getY(),E=(e[0].getX()+e[2].getX())/2,I=(e[0].getY()+e[2].getY())/2,R=new Zn(E+u*p,I+u*w),V=new Zn(E-u*p,I-u*w);return p=e[1].getX()-e[3].getX(),w=e[1].getY()-e[3].getY(),E=(e[1].getX()+e[3].getX())/2,I=(e[1].getY()+e[3].getY())/2,[R,new Zn(E+u*p,I+u*w),V,new Zn(E-u*p,I-u*w)]},s.prototype.isValid=function(e,n){return e>=0&&e<this.image.getWidth()&&n>0&&n<this.image.getHeight()},s.prototype.isValidPoint=function(e){var n=vr.round(e.getX()),a=vr.round(e.getY());return this.isValid(n,a)},s.prototype.distancePoint=function(e,n){return vr.distance(e.getX(),e.getY(),n.getX(),n.getY())},s.prototype.distanceResultPoint=function(e,n){return vr.distance(e.getX(),e.getY(),n.getX(),n.getY())},s.prototype.getDimension=function(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(mt.truncDivision(this.nbLayers-4,8)+1)+15},s}();const Ll=Za;var Yl=function(){function s(){}return s.prototype.decode=function(e,n){void 0===n&&(n=null);var a=null,u=new Ll(e.getBlackMatrix()),p=null,w=null;try{p=(E=u.detectMirror(!1)).getPoints(),this.reportFoundResultPoints(n,p),w=(new yi).decode(E)}catch(W){a=W}if(null==w)try{var E;p=(E=u.detectMirror(!0)).getPoints(),this.reportFoundResultPoints(n,p),w=(new yi).decode(E)}catch(W){throw a??W}var I=new Ze(w.getText(),w.getRawBytes(),w.getNumBits(),p,De.AZTEC,kn.currentTimeMillis()),R=w.getByteSegments();null!=R&&I.putMetadata(Tt.BYTE_SEGMENTS,R);var V=w.getECLevel();return null!=V&&I.putMetadata(Tt.ERROR_CORRECTION_LEVEL,V),I},s.prototype.reportFoundResultPoints=function(e,n){if(null!=e){var a=e.get(Qn.NEED_RESULT_POINT_CALLBACK);null!=a&&n.forEach(function(u,p,w){a.foundPossibleResultPoint(u)})}},s.prototype.reset=function(){},s}();const ba=Yl;var ea=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ul=(function(s){ea(function e(n){return void 0===n&&(n=500),s.call(this,new ba,n)||this},s)}(pn),function(){function s(){}return s.prototype.decode=function(e,n){try{return this.doDecode(e,n)}catch{if(n&&!0===n.get(Qn.TRY_HARDER)&&e.isRotateSupported()){var u=e.rotateCounterClockwise(),p=this.doDecode(u,n),w=p.getResultMetadata(),E=270;null!==w&&!0===w.get(Tt.ORIENTATION)&&(E+=w.get(Tt.ORIENTATION)%360),p.putMetadata(Tt.ORIENTATION,E);var I=p.getResultPoints();if(null!==I)for(var R=u.getHeight(),V=0;V<I.length;V++)I[V]=new Zn(R-I[V].getY()-1,I[V].getX());return p}throw new qt}},s.prototype.reset=function(){},s.prototype.doDecode=function(e,n){var I,a=e.getWidth(),u=e.getHeight(),p=new _n(a),w=n&&!0===n.get(Qn.TRY_HARDER),E=Math.max(1,u>>(w?8:5));I=w?u:15;for(var R=Math.trunc(u/2),V=0;V<I;V++){var W=Math.trunc((V+1)/2),oe=R+E*(0==(1&V)?W:-W);if(oe<0||oe>=u)break;try{p=e.getBlackRow(oe,p)}catch{continue}for(var Ce=function(at){if(1===at&&(p.reverse(),n&&!0===n.get(Qn.NEED_RESULT_POINT_CALLBACK))){var Pt=new Map;n.forEach(function(Un,Xn){return Pt.set(Xn,Un)}),Pt.delete(Qn.NEED_RESULT_POINT_CALLBACK),n=Pt}try{var Wt=Ne.decodeRow(oe,p,n);if(1===at){Wt.putMetadata(Tt.ORIENTATION,180);var wn=Wt.getResultPoints();null!==wn&&(wn[0]=new Zn(a-wn[0].getX()-1,wn[0].getY()),wn[1]=new Zn(a-wn[1].getX()-1,wn[1].getY()))}return{value:Wt}}catch{}},Ne=this,ot=0;ot<2;ot++){var ut=Ce(ot);if("object"==typeof ut)return ut.value}}throw new qt},s.recordPattern=function(e,n,a){for(var u=a.length,p=0;p<u;p++)a[p]=0;var w=e.getSize();if(n>=w)throw new qt;for(var E=!e.get(n),I=0,R=n;R<w;){if(e.get(R)!==E)a[I]++;else{if(++I===u)break;a[I]=1,E=!E}R++}if(I!==u&&(I!==u-1||R!==w))throw new qt},s.recordPatternInReverse=function(e,n,a){for(var u=a.length,p=e.get(n);n>0&&u>=0;)e.get(--n)!==p&&(u--,p=!p);if(u>=0)throw new qt;s.recordPattern(e,n+1,a)},s.patternMatchVariance=function(e,n,a){for(var u=e.length,p=0,w=0,E=0;E<u;E++)p+=e[E],w+=n[E];if(p<w)return Number.POSITIVE_INFINITY;var I=p/w;a*=I;for(var R=0,V=0;V<u;V++){var W=e[V],ee=n[V]*I,oe=W>ee?W-ee:ee-W;if(oe>a)return Number.POSITIVE_INFINITY;R+=oe}return R/p},s}());const Di=ul;var Eo=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Vl=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Eo(e,s),e.findStartPattern=function(n){for(var a=n.getSize(),u=n.getNextSet(0),p=0,w=Int32Array.from([0,0,0,0,0,0]),E=u,I=!1,V=u;V<a;V++)if(n.get(V)!==I)w[p]++;else{if(5===p){for(var W=e.MAX_AVG_VARIANCE,ee=-1,oe=e.CODE_START_A;oe<=e.CODE_START_C;oe++){var Ce=Di.patternMatchVariance(w,e.CODE_PATTERNS[oe],e.MAX_INDIVIDUAL_VARIANCE);Ce<W&&(W=Ce,ee=oe)}if(ee>=0&&n.isRange(Math.max(0,E-(V-E)/2),E,!1))return Int32Array.from([E,V,ee]);E+=w[0]+w[1],(w=w.slice(2,w.length-1))[p-1]=0,w[p]=0,p--}else p++;w[p]=1,I=!I}throw new qt},e.decodeCode=function(n,a,u){Di.recordPattern(n,u,a);for(var p=e.MAX_AVG_VARIANCE,w=-1,E=0;E<e.CODE_PATTERNS.length;E++){var R=this.patternMatchVariance(a,e.CODE_PATTERNS[E],e.MAX_INDIVIDUAL_VARIANCE);R<p&&(p=R,w=E)}if(w>=0)return w;throw new qt},e.prototype.decodeRow=function(n,a,u){var V,p=u&&!0===u.get(Qn.ASSUME_GS1),w=e.findStartPattern(a),E=w[2],I=0,R=new Uint8Array(20);switch(R[I++]=E,E){case e.CODE_START_A:V=e.CODE_CODE_A;break;case e.CODE_START_B:V=e.CODE_CODE_B;break;case e.CODE_START_C:V=e.CODE_CODE_C;break;default:throw new nn}for(var W=!1,ee=!1,oe="",Ce=w[0],Ne=w[1],ot=Int32Array.from([0,0,0,0,0,0]),ut=0,at=0,Pt=E,Wt=0,wn=!0,Un=!1,Xn=!1;!W;){var hr=ee;switch(ee=!1,ut=at,at=e.decodeCode(a,ot,Ne),R[I++]=at,at!==e.CODE_STOP&&(wn=!0),at!==e.CODE_STOP&&(Pt+=++Wt*at),Ce=Ne,Ne+=ot.reduce(function(sh,Id){return sh+Id},0),at){case e.CODE_START_A:case e.CODE_START_B:case e.CODE_START_C:throw new nn}switch(V){case e.CODE_CODE_A:if(at<64)oe+=String.fromCharCode(Xn===Un?" ".charCodeAt(0)+at:" ".charCodeAt(0)+at+128),Xn=!1;else if(at<96)oe+=String.fromCharCode(Xn===Un?at-64:at+64),Xn=!1;else switch(at!==e.CODE_STOP&&(wn=!1),at){case e.CODE_FNC_1:p&&(oe+=0===oe.length?"]C1":String.fromCharCode(29));break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_A:!Un&&Xn?(Un=!0,Xn=!1):Un&&Xn?(Un=!1,Xn=!1):Xn=!0;break;case e.CODE_SHIFT:ee=!0,V=e.CODE_CODE_B;break;case e.CODE_CODE_B:V=e.CODE_CODE_B;break;case e.CODE_CODE_C:V=e.CODE_CODE_C;break;case e.CODE_STOP:W=!0}break;case e.CODE_CODE_B:if(at<96)oe+=String.fromCharCode(Xn===Un?" ".charCodeAt(0)+at:" ".charCodeAt(0)+at+128),Xn=!1;else switch(at!==e.CODE_STOP&&(wn=!1),at){case e.CODE_FNC_1:p&&(oe+=0===oe.length?"]C1":String.fromCharCode(29));break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_B:!Un&&Xn?(Un=!0,Xn=!1):Un&&Xn?(Un=!1,Xn=!1):Xn=!0;break;case e.CODE_SHIFT:ee=!0,V=e.CODE_CODE_A;break;case e.CODE_CODE_A:V=e.CODE_CODE_A;break;case e.CODE_CODE_C:V=e.CODE_CODE_C;break;case e.CODE_STOP:W=!0}break;case e.CODE_CODE_C:if(at<100)at<10&&(oe+="0"),oe+=at;else switch(at!==e.CODE_STOP&&(wn=!1),at){case e.CODE_FNC_1:p&&(oe+=0===oe.length?"]C1":String.fromCharCode(29));break;case e.CODE_CODE_A:V=e.CODE_CODE_A;break;case e.CODE_CODE_B:V=e.CODE_CODE_B;break;case e.CODE_STOP:W=!0}}hr&&(V=V===e.CODE_CODE_A?e.CODE_CODE_B:e.CODE_CODE_A)}var Ei=Ne-Ce;if(Ne=a.getNextUnset(Ne),!a.isRange(Ne,Math.min(a.getSize(),Ne+(Ne-Ce)/2),!1))throw new qt;if((Pt-=Wt*ut)%103!==ut)throw new Wn;var fi=oe.length;if(0===fi)throw new qt;fi>0&&wn&&(oe=oe.substring(0,V===e.CODE_CODE_C?fi-2:fi-1));for(var xa=(w[1]+w[0])/2,so=Ce+Ei/2,xs=R.length,fc=new Uint8Array(xs),ed=0;ed<xs;ed++)fc[ed]=R[ed];var Xh=[new Zn(xa,n),new Zn(so,n)];return new Ze(oe,fc,0,Xh,De.CODE_128,(new Date).getTime())},e.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],e.MAX_AVG_VARIANCE=.25,e.MAX_INDIVIDUAL_VARIANCE=.7,e.CODE_SHIFT=98,e.CODE_CODE_C=99,e.CODE_CODE_B=100,e.CODE_CODE_A=101,e.CODE_FNC_1=102,e.CODE_FNC_2=97,e.CODE_FNC_3=96,e.CODE_FNC_4_A=101,e.CODE_FNC_4_B=100,e.CODE_START_A=103,e.CODE_START_B=104,e.CODE_START_C=105,e.CODE_STOP=106,e}(Di);const dl=Vl;var bs=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Qo=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},qa=function(s){function e(n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var u=s.call(this)||this;return u.usingCheckDigit=n,u.extendedMode=a,u.decodeRowResult="",u.counters=new Int32Array(9),u}return bs(e,s),e.prototype.decodeRow=function(n,a,u){var p,w,E,I,R=this.counters;R.fill(0),this.decodeRowResult="";var oe,Ce,V=e.findAsteriskPattern(a,R),W=a.getNextSet(V[1]),ee=a.getSize();do{e.recordPattern(a,W,R);var Ne=e.toNarrowWidePattern(R);if(Ne<0)throw new qt;oe=e.patternToChar(Ne),this.decodeRowResult+=oe,Ce=W;try{for(var ot=(p=void 0,Qo(R)),ut=ot.next();!ut.done;ut=ot.next())W+=ut.value}catch(xs){p={error:xs}}finally{try{ut&&!ut.done&&(w=ot.return)&&w.call(ot)}finally{if(p)throw p.error}}W=a.getNextSet(W)}while("*"!==oe);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var fi,Pt=0;try{for(var Wt=Qo(R),wn=Wt.next();!wn.done;wn=Wt.next())Pt+=wn.value}catch(xs){E={error:xs}}finally{try{wn&&!wn.done&&(I=Wt.return)&&I.call(Wt)}finally{if(E)throw E.error}}if(W!==ee&&2*(W-Ce-Pt)<Pt)throw new qt;if(this.usingCheckDigit){for(var Xn=this.decodeRowResult.length-1,hr=0,Ei=0;Ei<Xn;Ei++)hr+=e.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Ei));if(this.decodeRowResult.charAt(Xn)!==e.ALPHABET_STRING.charAt(hr%43))throw new Wn;this.decodeRowResult=this.decodeRowResult.substring(0,Xn)}if(0===this.decodeRowResult.length)throw new qt;fi=this.extendedMode?e.decodeExtended(this.decodeRowResult):this.decodeRowResult;var so=Ce+Pt/2;return new Ze(fi,null,0,[new Zn((V[1]+V[0])/2,n),new Zn(so,n)],De.CODE_39,(new Date).getTime())},e.findAsteriskPattern=function(n,a){for(var u=n.getSize(),p=n.getNextSet(0),w=0,E=p,I=!1,R=a.length,V=p;V<u;V++)if(n.get(V)!==I)a[w]++;else{if(w===R-1){if(this.toNarrowWidePattern(a)===e.ASTERISK_ENCODING&&n.isRange(Math.max(0,E-Math.floor((V-E)/2)),E,!1))return[E,V];E+=a[0]+a[1],a.copyWithin(0,2,2+w-1),a[w-1]=0,a[w]=0,w--}else w++;a[w]=1,I=!I}throw new qt},e.toNarrowWidePattern=function(n){var a,u,E,p=n.length,w=0;do{var I=2147483647;try{for(var R=(a=void 0,Qo(n)),V=R.next();!V.done;V=R.next())(W=V.value)<I&&W>w&&(I=W)}catch(Ne){a={error:Ne}}finally{try{V&&!V.done&&(u=R.return)&&u.call(R)}finally{if(a)throw a.error}}w=I,E=0;for(var ee=0,oe=0,Ce=0;Ce<p;Ce++)(W=n[Ce])>w&&(oe|=1<<p-1-Ce,E++,ee+=W);if(3===E){for(Ce=0;Ce<p&&E>0;Ce++){var W;if((W=n[Ce])>w&&(E--,2*W>=ee))return-1}return oe}}while(E>3);return-1},e.patternToChar=function(n){for(var a=0;a<e.CHARACTER_ENCODINGS.length;a++)if(e.CHARACTER_ENCODINGS[a]===n)return e.ALPHABET_STRING.charAt(a);if(n===e.ASTERISK_ENCODING)return"*";throw new qt},e.decodeExtended=function(n){for(var a=n.length,u="",p=0;p<a;p++){var w=n.charAt(p);if("+"===w||"$"===w||"%"===w||"/"===w){var E=n.charAt(p+1),I="\0";switch(w){case"+":if(!(E>="A"&&E<="Z"))throw new nn;I=String.fromCharCode(E.charCodeAt(0)+32);break;case"$":if(!(E>="A"&&E<="Z"))throw new nn;I=String.fromCharCode(E.charCodeAt(0)-64);break;case"%":if(E>="A"&&E<="E")I=String.fromCharCode(E.charCodeAt(0)-38);else if(E>="F"&&E<="J")I=String.fromCharCode(E.charCodeAt(0)-11);else if(E>="K"&&E<="O")I=String.fromCharCode(E.charCodeAt(0)+16);else if(E>="P"&&E<="T")I=String.fromCharCode(E.charCodeAt(0)+43);else if("U"===E)I="\0";else if("V"===E)I="@";else if("W"===E)I="`";else{if("X"!==E&&"Y"!==E&&"Z"!==E)throw new nn;I="\x7f"}break;case"/":if(E>="A"&&E<="O")I=String.fromCharCode(E.charCodeAt(0)-32);else{if("Z"!==E)throw new nn;I=":"}}u+=I,p++}else u+=w}return u},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",e.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],e.ASTERISK_ENCODING=148,e}(Di);const hl=qa;var go=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),$s=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ea=function(s){function e(){var n=s.call(this)||this;return n.decodeRowResult="",n.counters=new Int32Array(6),n}return go(e,s),e.prototype.decodeRow=function(n,a,u){var p,w,E,I,oe,Ce,R=this.findAsteriskPattern(a),V=a.getNextSet(R[1]),W=a.getSize(),ee=this.counters;ee.fill(0),this.decodeRowResult="";do{e.recordPattern(a,V,ee);var Ne=this.toPattern(ee);if(Ne<0)throw new qt;oe=this.patternToChar(Ne),this.decodeRowResult+=oe,Ce=V;try{for(var ot=(p=void 0,$s(ee)),ut=ot.next();!ut.done;ut=ot.next())V+=ut.value}catch(Ei){p={error:Ei}}finally{try{ut&&!ut.done&&(w=ot.return)&&w.call(ot)}finally{if(p)throw p.error}}V=a.getNextSet(V)}while("*"!==oe);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var Pt=0;try{for(var Wt=$s(ee),wn=Wt.next();!wn.done;wn=Wt.next())Pt+=wn.value}catch(Ei){E={error:Ei}}finally{try{wn&&!wn.done&&(I=Wt.return)&&I.call(Wt)}finally{if(E)throw E.error}}if(V===W||!a.get(V))throw new qt;if(this.decodeRowResult.length<2)throw new qt;this.checkChecksums(this.decodeRowResult),this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-2);var Un=this.decodeExtended(this.decodeRowResult),hr=Ce+Pt/2;return new Ze(Un,null,0,[new Zn((R[1]+R[0])/2,n),new Zn(hr,n)],De.CODE_93,(new Date).getTime())},e.prototype.findAsteriskPattern=function(n){var a=n.getSize(),u=n.getNextSet(0);this.counters.fill(0);for(var p=this.counters,w=u,E=!1,I=p.length,R=0,V=u;V<a;V++)if(n.get(V)!==E)p[R]++;else{if(R===I-1){if(this.toPattern(p)===e.ASTERISK_ENCODING)return new Int32Array([w,V]);w+=p[0]+p[1],p.copyWithin(0,2,2+R-1),p[R-1]=0,p[R]=0,R--}else R++;p[R]=1,E=!E}throw new qt},e.prototype.toPattern=function(n){var a,u,p=0;try{for(var w=$s(n),E=w.next();!E.done;E=w.next())p+=E.value}catch(Ce){a={error:Ce}}finally{try{E&&!E.done&&(u=w.return)&&u.call(w)}finally{if(a)throw a.error}}for(var R=0,V=n.length,W=0;W<V;W++){var ee=Math.round(9*n[W]/p);if(ee<1||ee>4)return-1;if(1&W)R<<=ee;else for(var oe=0;oe<ee;oe++)R=R<<1|1}return R},e.prototype.patternToChar=function(n){for(var a=0;a<e.CHARACTER_ENCODINGS.length;a++)if(e.CHARACTER_ENCODINGS[a]===n)return e.ALPHABET_STRING.charAt(a);throw new qt},e.prototype.decodeExtended=function(n){for(var a=n.length,u="",p=0;p<a;p++){var w=n.charAt(p);if(w>="a"&&w<="d"){if(p>=a-1)throw new nn;var E=n.charAt(p+1),I="\0";switch(w){case"d":if(!(E>="A"&&E<="Z"))throw new nn;I=String.fromCharCode(E.charCodeAt(0)+32);break;case"a":if(!(E>="A"&&E<="Z"))throw new nn;I=String.fromCharCode(E.charCodeAt(0)-64);break;case"b":if(E>="A"&&E<="E")I=String.fromCharCode(E.charCodeAt(0)-38);else if(E>="F"&&E<="J")I=String.fromCharCode(E.charCodeAt(0)-11);else if(E>="K"&&E<="O")I=String.fromCharCode(E.charCodeAt(0)+16);else if(E>="P"&&E<="T")I=String.fromCharCode(E.charCodeAt(0)+43);else if("U"===E)I="\0";else if("V"===E)I="@";else if("W"===E)I="`";else{if(!(E>="X"&&E<="Z"))throw new nn;I=String.fromCharCode(127)}break;case"c":if(E>="A"&&E<="O")I=String.fromCharCode(E.charCodeAt(0)-32);else{if("Z"!==E)throw new nn;I=":"}}u+=I,p++}else u+=w}return u},e.prototype.checkChecksums=function(n){var a=n.length;this.checkOneChecksum(n,a-2,20),this.checkOneChecksum(n,a-1,15)},e.prototype.checkOneChecksum=function(n,a,u){for(var p=1,w=0,E=a-1;E>=0;E--)w+=p*e.ALPHABET_STRING.indexOf(n.charAt(E)),++p>u&&(p=1);if(n.charAt(a)!==e.ALPHABET_STRING[w%47])throw new Wn},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%abcd*",e.ASTERISK_ENCODING=(e.CHARACTER_ENCODINGS=[276,328,324,322,296,292,290,336,274,266,424,420,418,404,402,394,360,356,354,308,282,344,332,326,300,278,436,434,428,422,406,410,364,358,310,314,302,468,466,458,366,374,430,294,474,470,306,350])[47],e}(Di);const zr=Ea;var ti=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),es=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.narrowLineWidth=-1,n}return ti(e,s),e.prototype.decodeRow=function(n,a,u){var p,w,E=this.decodeStart(a),I=this.decodeEnd(a),R=new _r;e.decodeMiddle(a,E[1],I[0],R);var V=R.toString(),W=null;null!=u&&(W=u.get(Qn.ALLOWED_LENGTHS)),null==W&&(W=e.DEFAULT_ALLOWED_LENGTHS);var ee=V.length,oe=!1,Ce=0;try{for(var Ne=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(W),ot=Ne.next();!ot.done;ot=Ne.next()){var ut=ot.value;if(ee===ut){oe=!0;break}ut>Ce&&(Ce=ut)}}catch(Wt){p={error:Wt}}finally{try{ot&&!ot.done&&(w=Ne.return)&&w.call(Ne)}finally{if(p)throw p.error}}if(!oe&&ee>Ce&&(oe=!0),!oe)throw new nn;var at=[new Zn(E[1],n),new Zn(I[0],n)];return new Ze(V,null,0,at,De.ITF,(new Date).getTime())},e.decodeMiddle=function(n,a,u,p){var w=new Int32Array(10),E=new Int32Array(5),I=new Int32Array(5);for(w.fill(0),E.fill(0),I.fill(0);a<u;){Di.recordPattern(n,a,w);for(var R=0;R<5;R++){var V=2*R;E[R]=w[V],I[R]=w[V+1]}var W=e.decodeDigit(E);p.append(W.toString()),W=this.decodeDigit(I),p.append(W.toString()),w.forEach(function(ee){a+=ee})}},e.prototype.decodeStart=function(n){var a=e.skipWhiteSpace(n),u=e.findGuardPattern(n,a,e.START_PATTERN);return this.narrowLineWidth=(u[1]-u[0])/4,this.validateQuietZone(n,u[0]),u},e.prototype.validateQuietZone=function(n,a){var u=10*this.narrowLineWidth;u=u<a?u:a;for(var p=a-1;u>0&&p>=0&&!n.get(p);p--)u--;if(0!==u)throw new qt},e.skipWhiteSpace=function(n){var a=n.getSize(),u=n.getNextSet(0);if(u===a)throw new qt;return u},e.prototype.decodeEnd=function(n){n.reverse();try{var a=e.skipWhiteSpace(n),u=void 0;try{u=e.findGuardPattern(n,a,e.END_PATTERN_REVERSED[0])}catch(w){w instanceof qt&&(u=e.findGuardPattern(n,a,e.END_PATTERN_REVERSED[1]))}this.validateQuietZone(n,u[0]);var p=u[0];return u[0]=n.getSize()-u[1],u[1]=n.getSize()-p,u}finally{n.reverse()}},e.findGuardPattern=function(n,a,u){var p=u.length,w=new Int32Array(p),E=n.getSize(),I=!1,R=0,V=a;w.fill(0);for(var W=a;W<E;W++)if(n.get(W)!==I)w[R]++;else{if(R===p-1){if(Di.patternMatchVariance(w,u,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return[V,W];V+=w[0]+w[1],kn.arraycopy(w,2,w,0,R-1),w[R-1]=0,w[R]=0,R--}else R++;w[R]=1,I=!I}throw new qt},e.decodeDigit=function(n){for(var a=e.MAX_AVG_VARIANCE,u=-1,p=e.PATTERNS.length,w=0;w<p;w++){var I=Di.patternMatchVariance(n,e.PATTERNS[w],e.MAX_INDIVIDUAL_VARIANCE);I<a?(a=I,u=w):I===a&&(u=-1)}if(u>=0)return u%10;throw new qt},e.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],e.MAX_AVG_VARIANCE=.38,e.MAX_INDIVIDUAL_VARIANCE=.5,e.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],e.START_PATTERN=Int32Array.from([1,1,1,1]),e.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])],e}(Di);const Qi=es;var pa=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Fa=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.decodeRowStringBuffer="",n}return pa(e,s),e.findStartGuardPattern=function(n){for(var u,a=!1,p=0,w=Int32Array.from([0,0,0]);!a;){w=Int32Array.from([0,0,0]);var E=(u=e.findGuardPattern(n,p,!1,this.START_END_PATTERN,w))[0],I=E-((p=u[1])-E);I>=0&&(a=n.isRange(I,E,!1))}return u},e.checkChecksum=function(n){return e.checkStandardUPCEANChecksum(n)},e.checkStandardUPCEANChecksum=function(n){var a=n.length;if(0===a)return!1;var u=parseInt(n.charAt(a-1),10);return e.getStandardUPCEANChecksum(n.substring(0,a-1))===u},e.getStandardUPCEANChecksum=function(n){for(var a=n.length,u=0,p=a-1;p>=0;p-=2){if((w=n.charAt(p).charCodeAt(0)-"0".charCodeAt(0))<0||w>9)throw new nn;u+=w}for(u*=3,p=a-2;p>=0;p-=2){var w;if((w=n.charAt(p).charCodeAt(0)-"0".charCodeAt(0))<0||w>9)throw new nn;u+=w}return(1e3-u)%10},e.decodeEnd=function(n,a){return e.findGuardPattern(n,a,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e.findGuardPatternWithoutCounters=function(n,a,u,p){return this.findGuardPattern(n,a,u,p,new Int32Array(p.length))},e.findGuardPattern=function(n,a,u,p,w){for(var E=n.getSize(),I=0,R=a=u?n.getNextUnset(a):n.getNextSet(a),V=p.length,W=u,ee=a;ee<E;ee++)if(n.get(ee)!==W)w[I]++;else{if(I===V-1){if(Di.patternMatchVariance(w,p,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return Int32Array.from([R,ee]);R+=w[0]+w[1];for(var oe=w.slice(2,w.length),Ce=0;Ce<I-1;Ce++)w[Ce]=oe[Ce];w[I-1]=0,w[I]=0,I--}else I++;w[I]=1,W=!W}throw new qt},e.decodeDigit=function(n,a,u,p){this.recordPattern(n,u,a);for(var w=this.MAX_AVG_VARIANCE,E=-1,I=p.length,R=0;R<I;R++){var W=Di.patternMatchVariance(a,p[R],e.MAX_INDIVIDUAL_VARIANCE);W<w&&(w=W,E=R)}if(E>=0)return E;throw new qt},e.MAX_AVG_VARIANCE=.48,e.MAX_INDIVIDUAL_VARIANCE=.7,e.START_END_PATTERN=Int32Array.from([1,1,1]),e.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),e.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])],e}(Di);const Fo=Fa;var Ba=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ca=function(){function s(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return s.prototype.decodeRow=function(e,n,a){var u=this.decodeRowStringBuffer,p=this.decodeMiddle(n,a,u),w=u.toString(),E=s.parseExtensionString(w),I=[new Zn((a[0]+a[1])/2,e),new Zn(p,e)],R=new Ze(w,null,0,I,De.UPC_EAN_EXTENSION,(new Date).getTime());return null!=E&&R.putAllMetadata(E),R},s.prototype.decodeMiddle=function(e,n,a){var u,p,w=this.decodeMiddleCounters;w[0]=0,w[1]=0,w[2]=0,w[3]=0;for(var E=e.getSize(),I=n[1],R=0,V=0;V<5&&I<E;V++){var W=Fo.decodeDigit(e,w,I,Fo.L_AND_G_PATTERNS);a+=String.fromCharCode("0".charCodeAt(0)+W%10);try{for(var ee=(u=void 0,Ba(w)),oe=ee.next();!oe.done;oe=ee.next())I+=oe.value}catch(ot){u={error:ot}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}W>=10&&(R|=1<<4-V),4!==V&&(I=e.getNextSet(I),I=e.getNextUnset(I))}if(5!==a.length)throw new qt;var Ne=this.determineCheckDigit(R);if(s.extensionChecksum(a.toString())!==Ne)throw new qt;return I},s.extensionChecksum=function(e){for(var n=e.length,a=0,u=n-2;u>=0;u-=2)a+=e.charAt(u).charCodeAt(0)-"0".charCodeAt(0);for(a*=3,u=n-1;u>=0;u-=2)a+=e.charAt(u).charCodeAt(0)-"0".charCodeAt(0);return(a*=3)%10},s.prototype.determineCheckDigit=function(e){for(var n=0;n<10;n++)if(e===this.CHECK_DIGIT_ENCODINGS[n])return n;throw new qt},s.parseExtensionString=function(e){if(5!==e.length)return null;var n=s.parseExtension5String(e);return null==n?null:new Map([[Tt.SUGGESTED_PRICE,n]])},s.parseExtension5String=function(e){var n;switch(e.charAt(0)){case"0":n="\xa3";break;case"5":n="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}n="";break;default:n=""}var a=parseInt(e.substring(1)),p=a%100;return n+(a/100).toString()+"."+(p<10?"0"+p:p.toString())},s}();const mi=Ca;var er=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dr=function(){function s(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return s.prototype.decodeRow=function(e,n,a){var u=this.decodeRowStringBuffer,p=this.decodeMiddle(n,a,u),w=u.toString(),E=s.parseExtensionString(w),I=[new Zn((a[0]+a[1])/2,e),new Zn(p,e)],R=new Ze(w,null,0,I,De.UPC_EAN_EXTENSION,(new Date).getTime());return null!=E&&R.putAllMetadata(E),R},s.prototype.decodeMiddle=function(e,n,a){var u,p,w=this.decodeMiddleCounters;w[0]=0,w[1]=0,w[2]=0,w[3]=0;for(var E=e.getSize(),I=n[1],R=0,V=0;V<2&&I<E;V++){var W=Fo.decodeDigit(e,w,I,Fo.L_AND_G_PATTERNS);a+=String.fromCharCode("0".charCodeAt(0)+W%10);try{for(var ee=(u=void 0,er(w)),oe=ee.next();!oe.done;oe=ee.next())I+=oe.value}catch(Ne){u={error:Ne}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}W>=10&&(R|=1<<1-V),1!==V&&(I=e.getNextSet(I),I=e.getNextUnset(I))}if(2!==a.length)throw new qt;if(parseInt(a.toString())%4!==R)throw new qt;return I},s.parseExtensionString=function(e){return 2!==e.length?null:new Map([[Tt.ISSUE_NUMBER,parseInt(e)]])},s}();const ni=Dr;var cs=function(){function s(){}return s.decodeRow=function(e,n,a){var u=Fo.findGuardPattern(n,a,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new mi).decodeRow(e,n,u)}catch{return(new ni).decodeRow(e,n,u)}},s.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]),s}();const ts=cs;var Co=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Aa=function(s){function e(){var n=s.call(this)||this;n.decodeRowStringBuffer="",e.L_AND_G_PATTERNS=e.L_PATTERNS.map(function(E){return Int32Array.from(E)});for(var a=10;a<20;a++){for(var u=e.L_PATTERNS[a-10],p=new Int32Array(u.length),w=0;w<u.length;w++)p[w]=u[u.length-w-1];e.L_AND_G_PATTERNS[a]=p}return n}return Co(e,s),e.prototype.decodeRow=function(n,a,u){var p=e.findStartGuardPattern(a),w=null==u?null:u.get(Qn.NEED_RESULT_POINT_CALLBACK);if(null!=w){var E=new Zn((p[0]+p[1])/2,n);w.foundPossibleResultPoint(E)}var I=this.decodeMiddle(a,p,this.decodeRowStringBuffer),R=I.rowOffset,V=I.resultString;if(null!=w){var W=new Zn(R,n);w.foundPossibleResultPoint(W)}var ee=e.decodeEnd(a,R);if(null!=w){var oe=new Zn((ee[0]+ee[1])/2,n);w.foundPossibleResultPoint(oe)}var Ce=ee[1],Ne=Ce+(Ce-ee[0]);if(Ne>=a.getSize()||!a.isRange(Ce,Ne,!1))throw new qt;var ot=V.toString();if(ot.length<8)throw new nn;if(!e.checkChecksum(ot))throw new Wn;var ut=(p[1]+p[0])/2,at=(ee[1]+ee[0])/2,Pt=this.getBarcodeFormat(),Wt=[new Zn(ut,n),new Zn(at,n)],wn=new Ze(ot,null,0,Wt,Pt,(new Date).getTime()),Un=0;try{var Xn=ts.decodeRow(n,a,ee[1]);wn.putMetadata(Tt.UPC_EAN_EXTENSION,Xn.getText()),wn.putAllMetadata(Xn.getResultMetadata()),wn.addResultPoints(Xn.getResultPoints()),Un=Xn.getText().length}catch{}var hr=null==u?null:u.get(Qn.ALLOWED_EAN_EXTENSIONS);if(null!=hr){var Ei=!1;for(var fi in hr)if(Un.toString()===fi){Ei=!0;break}if(!Ei)throw new qt}return wn},e.checkChecksum=function(n){return e.checkStandardUPCEANChecksum(n)},e.checkStandardUPCEANChecksum=function(n){var a=n.length;if(0===a)return!1;var u=parseInt(n.charAt(a-1),10);return e.getStandardUPCEANChecksum(n.substring(0,a-1))===u},e.getStandardUPCEANChecksum=function(n){for(var a=n.length,u=0,p=a-1;p>=0;p-=2){if((w=n.charAt(p).charCodeAt(0)-"0".charCodeAt(0))<0||w>9)throw new nn;u+=w}for(u*=3,p=a-2;p>=0;p-=2){var w;if((w=n.charAt(p).charCodeAt(0)-"0".charCodeAt(0))<0||w>9)throw new nn;u+=w}return(1e3-u)%10},e.decodeEnd=function(n,a){return e.findGuardPattern(n,a,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e}(Fo);const Fr=Aa;var Ws=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ta=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Or=function(s){function e(){var n=s.call(this)||this;return n.decodeMiddleCounters=Int32Array.from([0,0,0,0]),n}return Ws(e,s),e.prototype.decodeMiddle=function(n,a,u){var p,w,E,I,R=this.decodeMiddleCounters;R[0]=0,R[1]=0,R[2]=0,R[3]=0;for(var V=n.getSize(),W=a[1],ee=0,oe=0;oe<6&&W<V;oe++){var Ce=Fr.decodeDigit(n,R,W,Fr.L_AND_G_PATTERNS);u+=String.fromCharCode("0".charCodeAt(0)+Ce%10);try{for(var Ne=(p=void 0,ta(R)),ot=Ne.next();!ot.done;ot=Ne.next())W+=ot.value}catch(wn){p={error:wn}}finally{try{ot&&!ot.done&&(w=Ne.return)&&w.call(Ne)}finally{if(p)throw p.error}}Ce>=10&&(ee|=1<<5-oe)}for(u=e.determineFirstDigit(u,ee),W=Fr.findGuardPattern(n,W,!0,Fr.MIDDLE_PATTERN,new Int32Array(Fr.MIDDLE_PATTERN.length).fill(0))[1],oe=0;oe<6&&W<V;oe++){Ce=Fr.decodeDigit(n,R,W,Fr.L_PATTERNS),u+=String.fromCharCode("0".charCodeAt(0)+Ce);try{for(var Pt=(E=void 0,ta(R)),Wt=Pt.next();!Wt.done;Wt=Pt.next())W+=Wt.value}catch(Xn){E={error:Xn}}finally{try{Wt&&!Wt.done&&(I=Pt.return)&&I.call(Pt)}finally{if(E)throw E.error}}}return{rowOffset:W,resultString:u}},e.prototype.getBarcodeFormat=function(){return De.EAN_13},e.determineFirstDigit=function(n,a){for(var u=0;u<10;u++)if(a===this.FIRST_DIGIT_ENCODINGS[u])return String.fromCharCode("0".charCodeAt(0)+u)+n;throw new qt},e.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],e}(Fr);const zs=Or;var ms=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Xr=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lo=function(s){function e(){var n=s.call(this)||this;return n.decodeMiddleCounters=Int32Array.from([0,0,0,0]),n}return ms(e,s),e.prototype.decodeMiddle=function(n,a,u){var p,w,E,I,R=this.decodeMiddleCounters;R[0]=0,R[1]=0,R[2]=0,R[3]=0;for(var V=n.getSize(),W=a[1],ee=0;ee<4&&W<V;ee++){var oe=Fr.decodeDigit(n,R,W,Fr.L_PATTERNS);u+=String.fromCharCode("0".charCodeAt(0)+oe);try{for(var Ce=(p=void 0,Xr(R)),Ne=Ce.next();!Ne.done;Ne=Ce.next())W+=Ne.value}catch(Wt){p={error:Wt}}finally{try{Ne&&!Ne.done&&(w=Ce.return)&&w.call(Ce)}finally{if(p)throw p.error}}}for(W=Fr.findGuardPattern(n,W,!0,Fr.MIDDLE_PATTERN,new Int32Array(Fr.MIDDLE_PATTERN.length).fill(0))[1],ee=0;ee<4&&W<V;ee++){oe=Fr.decodeDigit(n,R,W,Fr.L_PATTERNS),u+=String.fromCharCode("0".charCodeAt(0)+oe);try{for(var at=(E=void 0,Xr(R)),Pt=at.next();!Pt.done;Pt=at.next())W+=Pt.value}catch(Un){E={error:Un}}finally{try{Pt&&!Pt.done&&(I=at.return)&&I.call(at)}finally{if(E)throw E.error}}}return{rowOffset:W,resultString:u}},e.prototype.getBarcodeFormat=function(){return De.EAN_8},e}(Fr);const na=lo;var Da=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Es=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.ean13Reader=new zs,n}return Da(e,s),e.prototype.getBarcodeFormat=function(){return De.UPC_A},e.prototype.decode=function(n,a){return this.maybeReturnResult(this.ean13Reader.decode(n))},e.prototype.decodeRow=function(n,a,u){return this.maybeReturnResult(this.ean13Reader.decodeRow(n,a,u))},e.prototype.decodeMiddle=function(n,a,u){return this.ean13Reader.decodeMiddle(n,a,u)},e.prototype.maybeReturnResult=function(n){var a=n.getText();if("0"===a.charAt(0)){var u=new Ze(a.substring(1),null,null,n.getResultPoints(),De.UPC_A);return null!=n.getResultMetadata()&&u.putAllMetadata(n.getResultMetadata()),u}throw new qt},e.prototype.reset=function(){this.ean13Reader.reset()},e}(Fr);const ns=Es;var Xa=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),_s=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Us=function(s){function e(){var n=s.call(this)||this;return n.decodeMiddleCounters=new Int32Array(4),n}return Xa(e,s),e.prototype.decodeMiddle=function(n,a,u){var p,w,E=this.decodeMiddleCounters.map(function(ot){return ot});E[0]=0,E[1]=0,E[2]=0,E[3]=0;for(var I=n.getSize(),R=a[1],V=0,W=0;W<6&&R<I;W++){var ee=e.decodeDigit(n,E,R,e.L_AND_G_PATTERNS);u+=String.fromCharCode("0".charCodeAt(0)+ee%10);try{for(var oe=(p=void 0,_s(E)),Ce=oe.next();!Ce.done;Ce=oe.next())R+=Ce.value}catch(ot){p={error:ot}}finally{try{Ce&&!Ce.done&&(w=oe.return)&&w.call(oe)}finally{if(p)throw p.error}}ee>=10&&(V|=1<<5-W)}return e.determineNumSysAndCheckDigit(new _r(u),V),R},e.prototype.decodeEnd=function(n,a){return e.findGuardPatternWithoutCounters(n,a,!0,e.MIDDLE_END_PATTERN)},e.prototype.checkChecksum=function(n){return Fr.checkChecksum(e.convertUPCEtoUPCA(n))},e.determineNumSysAndCheckDigit=function(n,a){for(var u=0;u<=1;u++)for(var p=0;p<10;p++)if(a===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[u][p])return n.insert(0,"0"+u),void n.append("0"+p);throw qt.getNotFoundInstance()},e.prototype.getBarcodeFormat=function(){return De.UPC_E},e.convertUPCEtoUPCA=function(n){var a=n.slice(1,7).split("").map(function(w){return w.charCodeAt(0)}),u=new _r;u.append(n.charAt(0));var p=a[5];switch(p){case 0:case 1:case 2:u.appendChars(a,0,2),u.append(p),u.append("0000"),u.appendChars(a,2,3);break;case 3:u.appendChars(a,0,3),u.append("00000"),u.appendChars(a,3,2);break;case 4:u.appendChars(a,0,4),u.append("00000"),u.append(a[4]);break;default:u.appendChars(a,0,5),u.append("0000"),u.append(p)}return n.length>=8&&u.append(n.charAt(7)),u.toString()},e.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])],e}(Fr);const ra=Us;var ia=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Wr=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vl=function(s){function e(n){var a=s.call(this)||this,u=null==n?null:n.get(Qn.POSSIBLE_FORMATS),p=[];return null!=u&&(u.indexOf(De.EAN_13)>-1&&p.push(new zs),u.indexOf(De.UPC_A)>-1&&p.push(new ns),u.indexOf(De.EAN_8)>-1&&p.push(new na),u.indexOf(De.UPC_E)>-1&&p.push(new ra)),0===p.length&&(p.push(new zs),p.push(new ns),p.push(new na),p.push(new ra)),a.readers=p,a}return ia(e,s),e.prototype.decodeRow=function(n,a,u){var p,w;try{for(var E=Wr(this.readers),I=E.next();!I.done;I=E.next()){var R=I.value;try{var V=R.decodeRow(n,a,u),W=V.getBarcodeFormat()===De.EAN_13&&"0"===V.getText().charAt(0),ee=null==u?null:u.get(Qn.POSSIBLE_FORMATS),oe=null==ee||ee.includes(De.UPC_A);if(W&&oe){var Ce=V.getRawBytes(),Ne=new Ze(V.getText().substring(1),Ce,Ce?Ce.length:null,V.getResultPoints(),De.UPC_A);return Ne.putAllMetadata(V.getResultMetadata()),Ne}return V}catch{}}}catch(ot){p={error:ot}}finally{try{I&&!I.done&&(w=E.return)&&w.call(E)}finally{if(p)throw p.error}}throw new qt},e.prototype.reset=function(){var n,a;try{for(var u=Wr(this.readers),p=u.next();!p.done;p=u.next())p.value.reset()}catch(E){n={error:E}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}},e}(Di);const Ya=vl;var za=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),oa=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.CODA_BAR_CHAR_SET={nnnnnww:"0",nnnnwwn:"1",nnnwnnw:"2",wwnnnnn:"3",nnwnnwn:"4",wnnnnwn:"5",nwnnnnw:"6",nwnnwnn:"7",nwwnnnn:"8",wnnwnnn:"9",nnnwwnn:"-",nnwwnnn:"$",wnnnwnw:":",wnwnnnw:"/",wnwnwnn:".",nnwwwww:"+",nnwwnwn:"A",nwnwnnw:"B",nnnwnww:"C",nnnwwwn:"D"},n}return za(e,s),e.prototype.decodeRow=function(n,a,u){var p=this.getValidRowData(a);if(!p)throw new qt;var w=this.codaBarDecodeRow(p.row);if(!w)throw new qt;return new Ze(w,null,0,[new Zn(p.left,n),new Zn(p.right,n)],De.CODABAR,(new Date).getTime())},e.prototype.getValidRowData=function(n){var a=n.toArray(),u=a.indexOf(!0);if(-1===u)return null;var p=a.lastIndexOf(!0);if(p<=u)return null;for(var w=[],E=(a=a.slice(u,p+1))[0],I=1,R=1;R<a.length;R++)a[R]===E?I++:(E=a[R],w.push(I),I=1);return w.push(I),w.length<23&&(w.length+1)%8!=0?null:{row:w,left:u,right:p}},e.prototype.codaBarDecodeRow=function(n){for(var a=[],u=Math.ceil(n.reduce(function(I,R){return(I+R)/2},0));n.length>0;){var w=n.splice(0,8).splice(0,7).map(function(I){return I<u?"n":"w"}).join("");if(void 0===this.CODA_BAR_CHAR_SET[w])return null;a.push(this.CODA_BAR_CHAR_SET[w])}var E=a.join("");return this.validCodaBarString(E)?E:null},e.prototype.validCodaBarString=function(n){return/^[A-D].{1,}[A-D]$/.test(n)},e}(Di);const vs=oa;var Ua=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),us=function(s){function e(){var n=s.call(this)||this;return n.decodeFinderCounters=new Int32Array(4),n.dataCharacterCounters=new Int32Array(8),n.oddRoundingErrors=new Array(4),n.evenRoundingErrors=new Array(4),n.oddCounts=new Array(n.dataCharacterCounters.length/2),n.evenCounts=new Array(n.dataCharacterCounters.length/2),n}return Ua(e,s),e.prototype.getDecodeFinderCounters=function(){return this.decodeFinderCounters},e.prototype.getDataCharacterCounters=function(){return this.dataCharacterCounters},e.prototype.getOddRoundingErrors=function(){return this.oddRoundingErrors},e.prototype.getEvenRoundingErrors=function(){return this.evenRoundingErrors},e.prototype.getOddCounts=function(){return this.oddCounts},e.prototype.getEvenCounts=function(){return this.evenCounts},e.prototype.parseFinderValue=function(n,a){for(var u=0;u<a.length;u++)if(Di.patternMatchVariance(n,a[u],e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return u;throw new qt},e.count=function(n){return vr.sum(new Int32Array(n))},e.increment=function(n,a){for(var u=0,p=a[0],w=1;w<n.length;w++)a[w]>p&&(p=a[w],u=w);n[u]++},e.decrement=function(n,a){for(var u=0,p=a[0],w=1;w<n.length;w++)a[w]<p&&(p=a[w],u=w);n[u]--},e.isFinderPattern=function(n){var a,u,p=n[0]+n[1],E=p/(p+n[2]+n[3]);if(E>=e.MIN_FINDER_PATTERN_RATIO&&E<=e.MAX_FINDER_PATTERN_RATIO){var I=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER;try{for(var V=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),W=V.next();!W.done;W=V.next()){var ee=W.value;ee>R&&(R=ee),ee<I&&(I=ee)}}catch(oe){a={error:oe}}finally{try{W&&!W.done&&(u=V.return)&&u.call(V)}finally{if(a)throw a.error}}return R<10*I}return!1},e.MAX_AVG_VARIANCE=.2,e.MAX_INDIVIDUAL_VARIANCE=.45,e.MIN_FINDER_PATTERN_RATIO=9.5/12,e.MAX_FINDER_PATTERN_RATIO=12.5/14,e}(Di);const ri=us;var ie=function(){function s(e,n){this.value=e,this.checksumPortion=n}return s.prototype.getValue=function(){return this.value},s.prototype.getChecksumPortion=function(){return this.checksumPortion},s.prototype.toString=function(){return this.value+"("+this.checksumPortion+")"},s.prototype.equals=function(e){return e instanceof s&&(this.value===e.value&&this.checksumPortion===e.checksumPortion)},s.prototype.hashCode=function(){return this.value^this.checksumPortion},s}();const K=ie;var le=function(){function s(e,n,a,u,p){this.value=e,this.startEnd=n,this.value=e,this.startEnd=n,this.resultPoints=new Array,this.resultPoints.push(new Zn(a,p)),this.resultPoints.push(new Zn(u,p))}return s.prototype.getValue=function(){return this.value},s.prototype.getStartEnd=function(){return this.startEnd},s.prototype.getResultPoints=function(){return this.resultPoints},s.prototype.equals=function(e){return e instanceof s&&this.value===e.value},s.prototype.hashCode=function(){return this.value},s}();const Ie=le;var yt=function(){function s(){}return s.getRSSvalue=function(e,n,a){var u,p,w=0;try{for(var E=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),I=E.next();!I.done;I=E.next())w+=I.value}catch(at){u={error:at}}finally{try{I&&!I.done&&(p=E.return)&&p.call(E)}finally{if(u)throw u.error}}for(var V=0,W=0,ee=e.length,oe=0;oe<ee-1;oe++){var Ce=void 0;for(Ce=1,W|=1<<oe;Ce<e[oe];Ce++,W&=~(1<<oe)){var Ne=s.combins(w-Ce-1,ee-oe-2);if(a&&0===W&&w-Ce-(ee-oe-1)>=ee-oe-1&&(Ne-=s.combins(w-Ce-(ee-oe),ee-oe-2)),ee-oe-1>1){for(var ot=0,ut=w-Ce-(ee-oe-2);ut>n;ut--)ot+=s.combins(w-Ce-ut-1,ee-oe-3);Ne-=ot*(ee-1-oe)}else w-Ce>n&&Ne--;V+=Ne}w-=Ce}return V},s.combins=function(e,n){var a,u;e-n>n?(u=n,a=e-n):(u=e-n,a=n);for(var p=1,w=1,E=e;E>a;E--)p*=E,w<=u&&(p/=w,w++);for(;w<=u;)p/=w,w++;return p},s}();const vn=yt;var Sn=function(){function s(){}return s.buildBitArray=function(e){var n=2*e.length-1;null==e[e.length-1].getRightChar()&&(n-=1);for(var u=new _n(12*n),p=0,E=e[0].getRightChar().getValue(),I=11;I>=0;--I)E&1<<I&&u.set(p),p++;for(I=1;I<e.length;++I){for(var R=e[I],V=R.getLeftChar().getValue(),W=11;W>=0;--W)V&1<<W&&u.set(p),p++;if(null!==R.getRightChar()){var ee=R.getRightChar().getValue();for(W=11;W>=0;--W)ee&1<<W&&u.set(p),p++}}return u},s}();const re=Sn;var ue=function(){function s(e,n){n?this.decodedInformation=null:(this.finished=e,this.decodedInformation=n)}return s.prototype.getDecodedInformation=function(){return this.decodedInformation},s.prototype.isFinished=function(){return this.finished},s}();const X=ue;var be=function(){function s(e){this.newPosition=e}return s.prototype.getNewPosition=function(){return this.newPosition},s}();const qe=be;var On=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),lr=function(s){function e(n,a){var u=s.call(this,n)||this;return u.value=a,u}return On(e,s),e.prototype.getValue=function(){return this.value},e.prototype.isFNC1=function(){return this.value===e.FNC1},e.FNC1="$",e}(qe);const Br=lr;var ii=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ti=function(s){function e(n,a,u){var p=s.call(this,n)||this;return u?(p.remaining=!0,p.remainingValue=p.remainingValue):(p.remaining=!1,p.remainingValue=0),p.newString=a,p}return ii(e,s),e.prototype.getNewString=function(){return this.newString},e.prototype.isRemaining=function(){return this.remaining},e.prototype.getRemainingValue=function(){return this.remainingValue},e}(qe);const ki=Ti;var eo=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Qr=function(s){function e(n,a,u){var p=s.call(this,n)||this;if(a<0||a>10||u<0||u>10)throw new nn;return p.firstDigit=a,p.secondDigit=u,p}return eo(e,s),e.prototype.getFirstDigit=function(){return this.firstDigit},e.prototype.getSecondDigit=function(){return this.secondDigit},e.prototype.getValue=function(){return 10*this.firstDigit+this.secondDigit},e.prototype.isFirstDigitFNC1=function(){return this.firstDigit===e.FNC1},e.prototype.isSecondDigitFNC1=function(){return this.secondDigit===e.FNC1},e.prototype.isAnyFNC1=function(){return this.firstDigit===e.FNC1||this.secondDigit===e.FNC1},e.FNC1=10,e}(qe);const Gr=Qr;var Bi=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Bo=function(){function s(){}return s.parseFieldsInGeneralPurpose=function(e){var n,a,u,p,w,E,I,R;if(!e)return null;if(e.length<2)throw new qt;var V=e.substring(0,2);try{for(var W=Bi(s.TWO_DIGIT_DATA_LENGTH),ee=W.next();!ee.done;ee=W.next())if((oe=ee.value)[0]===V)return oe[1]===s.VARIABLE_LENGTH?s.processVariableAI(2,oe[2],e):s.processFixedAI(2,oe[1],e)}catch(Un){n={error:Un}}finally{try{ee&&!ee.done&&(a=W.return)&&a.call(W)}finally{if(n)throw n.error}}if(e.length<3)throw new qt;var Ce=e.substring(0,3);try{for(var Ne=Bi(s.THREE_DIGIT_DATA_LENGTH),ot=Ne.next();!ot.done;ot=Ne.next())if((oe=ot.value)[0]===Ce)return oe[1]===s.VARIABLE_LENGTH?s.processVariableAI(3,oe[2],e):s.processFixedAI(3,oe[1],e)}catch(Un){u={error:Un}}finally{try{ot&&!ot.done&&(p=Ne.return)&&p.call(Ne)}finally{if(u)throw u.error}}try{for(var ut=Bi(s.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH),at=ut.next();!at.done;at=ut.next())if((oe=at.value)[0]===Ce)return oe[1]===s.VARIABLE_LENGTH?s.processVariableAI(4,oe[2],e):s.processFixedAI(4,oe[1],e)}catch(Un){w={error:Un}}finally{try{at&&!at.done&&(E=ut.return)&&E.call(ut)}finally{if(w)throw w.error}}if(e.length<4)throw new qt;var Pt=e.substring(0,4);try{for(var Wt=Bi(s.FOUR_DIGIT_DATA_LENGTH),wn=Wt.next();!wn.done;wn=Wt.next()){var oe;if((oe=wn.value)[0]===Pt)return oe[1]===s.VARIABLE_LENGTH?s.processVariableAI(4,oe[2],e):s.processFixedAI(4,oe[1],e)}}catch(Un){I={error:Un}}finally{try{wn&&!wn.done&&(R=Wt.return)&&R.call(Wt)}finally{if(I)throw I.error}}throw new qt},s.processFixedAI=function(e,n,a){if(a.length<e)throw new qt;var u=a.substring(0,e);if(a.length<e+n)throw new qt;var p=a.substring(e,e+n),w=a.substring(e+n),E="("+u+")"+p,I=s.parseFieldsInGeneralPurpose(w);return null==I?E:E+I},s.processVariableAI=function(e,n,a){var p,u=a.substring(0,e),w=a.substring(e,p=a.length<e+n?a.length:e+n),E=a.substring(p),I="("+u+")"+w,R=s.parseFieldsInGeneralPurpose(E);return null==R?I:I+R},s.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",s.VARIABLE_LENGTH=[],20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",s.VARIABLE_LENGTH,20],["22",s.VARIABLE_LENGTH,29],["30",s.VARIABLE_LENGTH,8],["37",s.VARIABLE_LENGTH,8],["90",s.VARIABLE_LENGTH,30],["91",s.VARIABLE_LENGTH,30],["92",s.VARIABLE_LENGTH,30],["93",s.VARIABLE_LENGTH,30],["94",s.VARIABLE_LENGTH,30],["95",s.VARIABLE_LENGTH,30],["96",s.VARIABLE_LENGTH,30],["97",s.VARIABLE_LENGTH,3],["98",s.VARIABLE_LENGTH,30],["99",s.VARIABLE_LENGTH,30]],s.THREE_DIGIT_DATA_LENGTH=[["240",s.VARIABLE_LENGTH,30],["241",s.VARIABLE_LENGTH,30],["242",s.VARIABLE_LENGTH,6],["250",s.VARIABLE_LENGTH,30],["251",s.VARIABLE_LENGTH,30],["253",s.VARIABLE_LENGTH,17],["254",s.VARIABLE_LENGTH,20],["400",s.VARIABLE_LENGTH,30],["401",s.VARIABLE_LENGTH,30],["402",17],["403",s.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",s.VARIABLE_LENGTH,20],["421",s.VARIABLE_LENGTH,15],["422",3],["423",s.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],s.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",s.VARIABLE_LENGTH,15],["391",s.VARIABLE_LENGTH,18],["392",s.VARIABLE_LENGTH,15],["393",s.VARIABLE_LENGTH,18],["703",s.VARIABLE_LENGTH,30]],s.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",s.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",s.VARIABLE_LENGTH,20],["8003",s.VARIABLE_LENGTH,30],["8004",s.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",s.VARIABLE_LENGTH,30],["8008",s.VARIABLE_LENGTH,12],["8018",18],["8020",s.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",s.VARIABLE_LENGTH,70],["8200",s.VARIABLE_LENGTH,70]],s}();const zo=Bo;var Wo=function(){function s(e){this.buffer=new _r,this.information=e}return s.prototype.decodeAllCodes=function(e,n){for(var a=n,u=null;;){var p=this.decodeGeneralPurposeField(a,u),w=zo.parseFieldsInGeneralPurpose(p.getNewString());if(null!=w&&e.append(w),u=p.isRemaining()?""+p.getRemainingValue():null,a===p.getNewPosition())break;a=p.getNewPosition()}return e.toString()},s.prototype.isStillNumeric=function(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(var n=e;n<e+3;++n)if(this.information.get(n))return!0;return this.information.get(e+3)},s.prototype.decodeNumeric=function(e){if(e+7>this.information.getSize()){var n=this.extractNumericValueFromBitArray(e,4);return new Gr(this.information.getSize(),0===n?Gr.FNC1:n-1,Gr.FNC1)}var a=this.extractNumericValueFromBitArray(e,7);return new Gr(e+7,(a-8)/11,(a-8)%11)},s.prototype.extractNumericValueFromBitArray=function(e,n){return s.extractNumericValueFromBitArray(this.information,e,n)},s.extractNumericValueFromBitArray=function(e,n,a){for(var u=0,p=0;p<a;++p)e.get(n+p)&&(u|=1<<a-p-1);return u},s.prototype.decodeGeneralPurposeField=function(e,n){this.buffer.setLengthToZero(),null!=n&&this.buffer.append(n),this.current.setPosition(e);var a=this.parseBlocks();return null!=a&&a.isRemaining()?new ki(this.current.getPosition(),this.buffer.toString(),a.getRemainingValue()):new ki(this.current.getPosition(),this.buffer.toString())},s.prototype.parseBlocks=function(){var e,n;do{var a=this.current.getPosition();if(e=this.current.isAlpha()?(n=this.parseAlphaBlock()).isFinished():this.current.isIsoIec646()?(n=this.parseIsoIec646Block()).isFinished():(n=this.parseNumericBlock()).isFinished(),a===this.current.getPosition()&&!e)break}while(!e);return n.getDecodedInformation()},s.prototype.parseNumericBlock=function(){for(;this.isStillNumeric(this.current.getPosition());){var e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){var n=void 0;return n=e.isSecondDigitFNC1()?new ki(this.current.getPosition(),this.buffer.toString()):new ki(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new X(!0,n)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1())return n=new ki(this.current.getPosition(),this.buffer.toString()),new X(!0,n);this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new X(!1)},s.prototype.parseIsoIec646Block=function(){for(;this.isStillIsoIec646(this.current.getPosition());){var e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var n=new ki(this.current.getPosition(),this.buffer.toString());return new X(!0,n)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new X(!1)},s.prototype.parseAlphaBlock=function(){for(;this.isStillAlpha(this.current.getPosition());){var e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var n=new ki(this.current.getPosition(),this.buffer.toString());return new X(!0,n)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new X(!1)},s.prototype.isStillIsoIec646=function(e){if(e+5>this.information.getSize())return!1;var n=this.extractNumericValueFromBitArray(e,5);if(n>=5&&n<16)return!0;if(e+7>this.information.getSize())return!1;var a=this.extractNumericValueFromBitArray(e,7);if(a>=64&&a<116)return!0;if(e+8>this.information.getSize())return!1;var u=this.extractNumericValueFromBitArray(e,8);return u>=232&&u<253},s.prototype.decodeIsoIec646=function(e){var n=this.extractNumericValueFromBitArray(e,5);if(15===n)return new Br(e+5,Br.FNC1);if(n>=5&&n<15)return new Br(e+5,"0"+(n-5));var p,a=this.extractNumericValueFromBitArray(e,7);if(a>=64&&a<90)return new Br(e+7,""+(a+1));if(a>=90&&a<116)return new Br(e+7,""+(a+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:p="!";break;case 233:p='"';break;case 234:p="%";break;case 235:p="&";break;case 236:p="'";break;case 237:p="(";break;case 238:p=")";break;case 239:p="*";break;case 240:p="+";break;case 241:p=",";break;case 242:p="-";break;case 243:p=".";break;case 244:p="/";break;case 245:p=":";break;case 246:p=";";break;case 247:p="<";break;case 248:p="=";break;case 249:p=">";break;case 250:p="?";break;case 251:p="_";break;case 252:p=" ";break;default:throw new nn}return new Br(e+8,p)},s.prototype.isStillAlpha=function(e){if(e+5>this.information.getSize())return!1;var n=this.extractNumericValueFromBitArray(e,5);if(n>=5&&n<16)return!0;if(e+6>this.information.getSize())return!1;var a=this.extractNumericValueFromBitArray(e,6);return a>=16&&a<63},s.prototype.decodeAlphanumeric=function(e){var n=this.extractNumericValueFromBitArray(e,5);if(15===n)return new Br(e+5,Br.FNC1);if(n>=5&&n<15)return new Br(e+5,"0"+(n-5));var u,a=this.extractNumericValueFromBitArray(e,6);if(a>=32&&a<58)return new Br(e+6,""+(a+33));switch(a){case 58:u="*";break;case 59:u=",";break;case 60:u="-";break;case 61:u=".";break;case 62:u="/";break;default:throw new Fi("Decoding invalid alphanumeric value: "+a)}return new Br(e+6,u)},s.prototype.isAlphaTo646ToAlphaLatch=function(e){if(e+1>this.information.getSize())return!1;for(var n=0;n<5&&n+e<this.information.getSize();++n)if(2===n){if(!this.information.get(e+2))return!1}else if(this.information.get(e+n))return!1;return!0},s.prototype.isAlphaOr646ToNumericLatch=function(e){if(e+3>this.information.getSize())return!1;for(var n=e;n<e+3;++n)if(this.information.get(n))return!1;return!0},s.prototype.isNumericToAlphaNumericLatch=function(e){if(e+1>this.information.getSize())return!1;for(var n=0;n<4&&n+e<this.information.getSize();++n)if(this.information.get(e+n))return!1;return!0},s}();const Uo=Wo;var qs=function(){function s(e){this.information=e,this.generalDecoder=new Uo(e)}return s.prototype.getInformation=function(){return this.information},s.prototype.getGeneralDecoder=function(){return this.generalDecoder},s}();const sa=qs;var vo=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Cs=function(s){function e(n){return s.call(this,n)||this}return vo(e,s),e.prototype.encodeCompressedGtin=function(n,a){n.append("(01)");var u=n.length();n.append("9"),this.encodeCompressedGtinWithoutAI(n,a,u)},e.prototype.encodeCompressedGtinWithoutAI=function(n,a,u){for(var p=0;p<4;++p){var w=this.getGeneralDecoder().extractNumericValueFromBitArray(a+10*p,10);w/100==0&&n.append("0"),w/10==0&&n.append("0"),n.append(w)}e.appendCheckDigit(n,u)},e.appendCheckDigit=function(n,a){for(var u=0,p=0;p<13;p++){var w=n.charAt(p+a).charCodeAt(0)-"0".charCodeAt(0);u+=1&p?w:3*w}10==(u=10-u%10)&&(u=0),n.append(u)},e.GTIN_SIZE=40,e}(sa);const As=Cs;var aa=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),to=function(s){function e(n){return s.call(this,n)||this}return aa(e,s),e.prototype.parseInformation=function(){var n=new _r;n.append("(01)");var a=n.length(),u=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE,4);return n.append(u),this.encodeCompressedGtinWithoutAI(n,e.HEADER_SIZE+4,a),this.getGeneralDecoder().decodeAllCodes(n,e.HEADER_SIZE+44)},e.HEADER_SIZE=4,e}(As);const Ka=to;var Oo=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ja=function(s){function e(n){return s.call(this,n)||this}return Oo(e,s),e.prototype.parseInformation=function(){var n=new _r;return this.getGeneralDecoder().decodeAllCodes(n,e.HEADER_SIZE)},e.HEADER_SIZE=5,e}(sa);const Kl=Ja;var Qa=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),jl=function(s){function e(n){return s.call(this,n)||this}return Qa(e,s),e.prototype.encodeCompressedWeight=function(n,a,u){var p=this.getGeneralDecoder().extractNumericValueFromBitArray(a,u);this.addWeightCode(n,p);for(var w=this.checkWeight(p),E=1e5,I=0;I<5;++I)w/E==0&&n.append("0"),E/=10;n.append(w)},e}(As);const ys=jl;var el=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),fl=function(s){function e(n){return s.call(this,n)||this}return el(e,s),e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+ys.GTIN_SIZE+e.WEIGHT_SIZE)throw new qt;var n=new _r;return this.encodeCompressedGtin(n,e.HEADER_SIZE),this.encodeCompressedWeight(n,e.HEADER_SIZE+ys.GTIN_SIZE,e.WEIGHT_SIZE),n.toString()},e.HEADER_SIZE=5,e.WEIGHT_SIZE=15,e}(ys);const yl=fl;var xl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),sc=function(s){function e(n){return s.call(this,n)||this}return xl(e,s),e.prototype.addWeightCode=function(n,a){n.append("(3103)")},e.prototype.checkWeight=function(n){return n},e}(yl);const wc=sc;var pl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ga=function(s){function e(n){return s.call(this,n)||this}return pl(e,s),e.prototype.addWeightCode=function(n,a){n.append(a<1e4?"(3202)":"(3203)")},e.prototype.checkWeight=function(n){return n<1e4?n:n-1e4},e}(yl);const wl=ga;var bc=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),bl=function(s){function e(n){return s.call(this,n)||this}return bc(e,s),e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+As.GTIN_SIZE)throw new qt;var n=new _r;this.encodeCompressedGtin(n,e.HEADER_SIZE);var a=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+As.GTIN_SIZE,e.LAST_DIGIT_SIZE);n.append("(392"),n.append(a),n.append(")");var u=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+As.GTIN_SIZE+e.LAST_DIGIT_SIZE,null);return n.append(u.getNewString()),n.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e}(As);const El=bl;var Ta=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),j=function(s){function e(n){return s.call(this,n)||this}return Ta(e,s),e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+As.GTIN_SIZE)throw new qt;var n=new _r;this.encodeCompressedGtin(n,e.HEADER_SIZE);var a=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+As.GTIN_SIZE,e.LAST_DIGIT_SIZE);n.append("(393"),n.append(a),n.append(")");var u=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+As.GTIN_SIZE+e.LAST_DIGIT_SIZE,e.FIRST_THREE_DIGITS_SIZE);u/100==0&&n.append("0"),u/10==0&&n.append("0"),n.append(u);var p=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+As.GTIN_SIZE+e.LAST_DIGIT_SIZE+e.FIRST_THREE_DIGITS_SIZE,null);return n.append(p.getNewString()),n.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e.FIRST_THREE_DIGITS_SIZE=10,e}(As);const me=j;var te=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),fe=function(s){function e(n,a,u){var p=s.call(this,n)||this;return p.dateCode=u,p.firstAIdigits=a,p}return te(e,s),e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE+e.DATE_SIZE)throw new qt;var n=new _r;return this.encodeCompressedGtin(n,e.HEADER_SIZE),this.encodeCompressedWeight(n,e.HEADER_SIZE+e.GTIN_SIZE,e.WEIGHT_SIZE),this.encodeCompressedDate(n,e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE),n.toString()},e.prototype.encodeCompressedDate=function(n,a){var u=this.getGeneralDecoder().extractNumericValueFromBitArray(a,e.DATE_SIZE);if(38400!==u){n.append("("),n.append(this.dateCode),n.append(")");var p=u%32,w=(u/=32)%12+1,E=u/=12;E/10==0&&n.append("0"),n.append(E),w/10==0&&n.append("0"),n.append(w),p/10==0&&n.append("0"),n.append(p)}},e.prototype.addWeightCode=function(n,a){n.append("("),n.append(this.firstAIdigits),n.append(a/1e5),n.append(")")},e.prototype.checkWeight=function(n){return n%1e5},e.HEADER_SIZE=8,e.WEIGHT_SIZE=20,e.DATE_SIZE=16,e}(ys);const He=fe;var Ut=function(){function s(e,n,a,u){this.leftchar=e,this.rightchar=n,this.finderpattern=a,this.maybeLast=u}return s.prototype.mayBeLast=function(){return this.maybeLast},s.prototype.getLeftChar=function(){return this.leftchar},s.prototype.getRightChar=function(){return this.rightchar},s.prototype.getFinderPattern=function(){return this.finderpattern},s.prototype.mustBeLast=function(){return null==this.rightchar},s.prototype.toString=function(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"},s.equals=function(e,n){return e instanceof s&&s.equalsOrNull(e.leftchar,n.leftchar)&&s.equalsOrNull(e.rightchar,n.rightchar)&&s.equalsOrNull(e.finderpattern,n.finderpattern)},s.equalsOrNull=function(e,n){return null===e?null===n:s.equals(e,n)},s.prototype.hashCode=function(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()},s}();const pr=Ut;var io=function(){function s(e,n,a){this.pairs=e,this.rowNumber=n,this.wasReversed=a}return s.prototype.getPairs=function(){return this.pairs},s.prototype.getRowNumber=function(){return this.rowNumber},s.prototype.isReversed=function(){return this.wasReversed},s.prototype.isEquivalent=function(e){return this.checkEqualitity(this,e)},s.prototype.toString=function(){return"{ "+this.pairs+" }"},s.prototype.equals=function(e,n){return e instanceof s&&this.checkEqualitity(e,n)&&e.wasReversed===n.wasReversed},s.prototype.checkEqualitity=function(e,n){var a;if(e&&n)return e.forEach(function(u,p){n.forEach(function(w){u.getLeftChar().getValue()===w.getLeftChar().getValue()&&u.getRightChar().getValue()===w.getRightChar().getValue()&&u.getFinderPatter().getValue()===w.getFinderPatter().getValue()&&(a=!0)})}),a},s}();const Hi=io;var wi=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Yr=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ao=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.pairs=new Array(e.MAX_PAIRS),n.rows=new Array,n.startEnd=[2],n}return wi(e,s),e.prototype.decodeRow=function(n,a,u){this.pairs.length=0,this.startFromEven=!1;try{return e.constructResult(this.decodeRow2pairs(n,a))}catch{}return this.pairs.length=0,this.startFromEven=!0,e.constructResult(this.decodeRow2pairs(n,a))},e.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},e.prototype.decodeRow2pairs=function(n,a){for(var u=!1;!u;)try{this.pairs.push(this.retrieveNextPair(a,this.pairs,n))}catch(E){if(E instanceof qt){if(!this.pairs.length)throw new qt;u=!0}}if(this.checkChecksum())return this.pairs;var p;if(p=!!this.rows.length,this.storeRow(n,!1),p){var w=this.checkRowsBoolean(!1);if(null!=w||null!=(w=this.checkRowsBoolean(!0)))return w}throw new qt},e.prototype.checkRowsBoolean=function(n){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,n&&(this.rows=this.rows.reverse());var a=null;try{a=this.checkRows(new Array,0)}catch(u){console.log(u)}return n&&(this.rows=this.rows.reverse()),a},e.prototype.checkRows=function(n,a){for(var u,p,w=a;w<this.rows.length;w++){var E=this.rows[w];this.pairs.length=0;try{for(var I=(u=void 0,Yr(n)),R=I.next();!R.done;R=I.next())this.pairs.push(R.value.getPairs())}catch(ee){u={error:ee}}finally{try{R&&!R.done&&(p=I.return)&&p.call(I)}finally{if(u)throw u.error}}if(this.pairs.push(E.getPairs()),e.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var W=new Array(n);W.push(E);try{return this.checkRows(W,w+1)}catch(ee){console.log(ee)}}}throw new qt},e.isValidSequence=function(n){var a,u;try{for(var p=Yr(e.FINDER_PATTERN_SEQUENCES),w=p.next();!w.done;w=p.next()){var E=w.value;if(!(n.length>E.length)){for(var I=!0,R=0;R<n.length;R++)if(n[R].getFinderPattern().getValue()!==E[R]){I=!1;break}if(I)return!0}}}catch(V){a={error:V}}finally{try{w&&!w.done&&(u=p.return)&&u.call(p)}finally{if(a)throw a.error}}return!1},e.prototype.storeRow=function(n,a){for(var u=0,p=!1,w=!1;u<this.rows.length;){var E=this.rows[u];if(E.getRowNumber()>n){w=E.isEquivalent(this.pairs);break}p=E.isEquivalent(this.pairs),u++}w||p||e.isPartialRow(this.pairs,this.rows)||(this.rows.push(u,new Hi(this.pairs,n,a)),this.removePartialRows(this.pairs,this.rows))},e.prototype.removePartialRows=function(n,a){var u,p,w,E,I,R;try{for(var V=Yr(a),W=V.next();!W.done;W=V.next()){var ee=W.value;if(ee.getPairs().length!==n.length)try{for(var Ce=(w=void 0,Yr(ee.getPairs())),Ne=Ce.next();!Ne.done;Ne=Ce.next()){var ot=Ne.value;try{for(var at=(I=void 0,Yr(n)),Pt=at.next();!Pt.done;Pt=at.next())if(pr.equals(ot,Pt.value)){!0;break}}catch(wn){I={error:wn}}finally{try{Pt&&!Pt.done&&(R=at.return)&&R.call(at)}finally{if(I)throw I.error}}}}catch(wn){w={error:wn}}finally{try{Ne&&!Ne.done&&(E=Ce.return)&&E.call(Ce)}finally{if(w)throw w.error}}}}catch(wn){u={error:wn}}finally{try{W&&!W.done&&(p=V.return)&&p.call(V)}finally{if(u)throw u.error}}},e.isPartialRow=function(n,a){var u,p,w,E,I,R;try{for(var V=Yr(a),W=V.next();!W.done;W=V.next()){var ee=W.value,oe=!0;try{for(var Ce=(w=void 0,Yr(n)),Ne=Ce.next();!Ne.done;Ne=Ce.next()){var ot=Ne.value,ut=!1;try{for(var at=(I=void 0,Yr(ee.getPairs())),Pt=at.next();!Pt.done;Pt=at.next())if(ot.equals(Pt.value)){ut=!0;break}}catch(wn){I={error:wn}}finally{try{Pt&&!Pt.done&&(R=at.return)&&R.call(at)}finally{if(I)throw I.error}}if(!ut){oe=!1;break}}}catch(wn){w={error:wn}}finally{try{Ne&&!Ne.done&&(E=Ce.return)&&E.call(Ce)}finally{if(w)throw w.error}}if(oe)return!0}}catch(wn){u={error:wn}}finally{try{W&&!W.done&&(p=V.return)&&p.call(V)}finally{if(u)throw u.error}}return!1},e.prototype.getRows=function(){return this.rows},e.constructResult=function(n){var u=function Gt(s){try{if(s.get(1))return new Ka(s);if(!s.get(2))return new Kl(s);switch(Uo.extractNumericValueFromBitArray(s,1,4)){case 4:return new wc(s);case 5:return new wl(s)}switch(Uo.extractNumericValueFromBitArray(s,1,5)){case 12:return new El(s);case 13:return new me(s)}switch(Uo.extractNumericValueFromBitArray(s,1,7)){case 56:return new He(s,"310","11");case 57:return new He(s,"320","11");case 58:return new He(s,"310","13");case 59:return new He(s,"320","13");case 60:return new He(s,"310","15");case 61:return new He(s,"320","15");case 62:return new He(s,"310","17");case 63:return new He(s,"320","17")}}catch(u){throw console.log(u),new Fi("unknown decoder: "+s)}}(re.buildBitArray(n)),p=u.parseInformation(),w=n[0].getFinderPattern().getResultPoints(),E=n[n.length-1].getFinderPattern().getResultPoints();return new Ze(p,null,null,[w[0],w[1],E[0],E[1]],De.RSS_EXPANDED,null)},e.prototype.checkChecksum=function(){var n=this.pairs.get(0),a=n.getLeftChar(),u=n.getRightChar();if(null===u)return!1;for(var p=u.getChecksumPortion(),w=2,E=1;E<this.pairs.size();++E){var I=this.pairs.get(E);p+=I.getLeftChar().getChecksumPortion(),w++;var R=I.getRightChar();null!=R&&(p+=R.getChecksumPortion(),w++)}return 211*(w-4)+(p%=211)===a.getValue()},e.getNextSecondBar=function(n,a){var u;return n.get(a)?(u=n.getNextUnset(a),u=n.getNextSet(u)):(u=n.getNextSet(a),u=n.getNextUnset(u)),u},e.prototype.retrieveNextPair=function(n,a,u){var p=a.length%2==0;this.startFromEven&&(p=!p);var w,E=!0,I=-1;do{this.findNextPair(n,a,I),null===(w=this.parseFoundFinderPattern(n,u,p))?I=e.getNextSecondBar(n,this.startEnd[0]):E=!1}while(E);var V,R=this.decodeDataCharacter(n,w,p,!0);if(!this.isEmptyPair(a)&&a[a.length-1].mustBeLast())throw new qt;try{V=this.decodeDataCharacter(n,w,p,!1)}catch(W){V=null,console.log(W)}return new pr(R,V,w,!0)},e.prototype.isEmptyPair=function(n){return 0===n.length},e.prototype.findNextPair=function(n,a,u){var p=this.getDecodeFinderCounters();p[0]=0,p[1]=0,p[2]=0,p[3]=0;var E,w=n.getSize();E=u>=0?u:this.isEmptyPair(a)?0:a[a.length-1].getFinderPattern().getStartEnd()[1];var R=a.length%2!=0;this.startFromEven&&(R=!R);for(var V=!1;E<w&&(V=!n.get(E));)E++;for(var W=0,ee=E,oe=E;oe<w;oe++)if(n.get(oe)!==V)p[W]++;else{if(3===W){if(R&&e.reverseCounters(p),e.isFinderPattern(p))return this.startEnd[0]=ee,void(this.startEnd[1]=oe);R&&e.reverseCounters(p),ee+=p[0]+p[1],p[0]=p[2],p[1]=p[3],p[2]=0,p[3]=0,W--}else W++;p[W]=1,V=!V}throw new qt},e.reverseCounters=function(n){for(var a=n.length,u=0;u<a/2;++u){var p=n[u];n[u]=n[a-u-1],n[a-u-1]=p}},e.prototype.parseFoundFinderPattern=function(n,a,u){var p,w,E;if(u){for(var I=this.startEnd[0]-1;I>=0&&!n.get(I);)I--;I++,p=this.startEnd[0]-I,w=I,E=this.startEnd[1]}else w=this.startEnd[0],p=(E=n.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];var V,R=this.getDecodeFinderCounters();kn.arraycopy(R,0,R,1,R.length-1),R[0]=p;try{V=this.parseFinderValue(R,e.FINDER_PATTERNS)}catch{return null}return new Ie(V,[w,E],w,E,a)},e.prototype.decodeDataCharacter=function(n,a,u,p){for(var w=this.getDataCharacterCounters(),E=0;E<w.length;E++)w[E]=0;if(p)e.recordPatternInReverse(n,a.getStartEnd()[0],w);else{e.recordPattern(n,a.getStartEnd()[1],w);for(var I=0,R=w.length-1;I<R;I++,R--){var V=w[I];w[I]=w[R],w[R]=V}}var ee=vr.sum(new Int32Array(w))/17,oe=(a.getStartEnd()[1]-a.getStartEnd()[0])/15;if(Math.abs(ee-oe)/oe>.3)throw new qt;var Ce=this.getOddCounts(),Ne=this.getEvenCounts(),ot=this.getOddRoundingErrors(),ut=this.getEvenRoundingErrors();for(I=0;I<w.length;I++){var at=1*w[I]/ee,Pt=at+.5;if(Pt<1){if(at<.3)throw new qt;Pt=1}else if(Pt>8){if(at>8.7)throw new qt;Pt=8}var Wt=I/2;1&I?(Ne[Wt]=Pt,ut[Wt]=at-Pt):(Ce[Wt]=Pt,ot[Wt]=at-Pt)}this.adjustOddEvenCounts(17);var wn=4*a.getValue()+(u?0:2)+(p?0:1)-1,Un=0,Xn=0;for(I=Ce.length-1;I>=0;I--)e.isNotA1left(a,u,p)&&(Xn+=Ce[I]*e.WEIGHTS[wn][2*I]),Un+=Ce[I];var Ei=0;for(I=Ne.length-1;I>=0;I--)e.isNotA1left(a,u,p)&&(Ei+=Ne[I]*e.WEIGHTS[wn][2*I+1]);var fi=Xn+Ei;if(1&Un||Un>13||Un<4)throw new qt;var xa=(13-Un)/2,so=e.SYMBOL_WIDEST[xa],xs=9-so,fc=vn.getRSSvalue(Ce,so,!0),ed=vn.getRSSvalue(Ne,xs,!1);return new K(fc*e.EVEN_TOTAL_SUBSET[xa]+ed+e.GSUM[xa],fi)},e.isNotA1left=function(n,a,u){return!(0===n.getValue()&&a&&u)},e.prototype.adjustOddEvenCounts=function(n){var a=vr.sum(new Int32Array(this.getOddCounts())),u=vr.sum(new Int32Array(this.getEvenCounts())),p=!1,w=!1;a>13?w=!0:a<4&&(p=!0);var E=!1,I=!1;u>13?I=!0:u<4&&(E=!0);var R=a+u-n,V=1==(1&a),W=0==(1&u);if(1===R)if(V){if(W)throw new qt;w=!0}else{if(!W)throw new qt;I=!0}else if(-1===R)if(V){if(W)throw new qt;p=!0}else{if(!W)throw new qt;E=!0}else{if(0!==R)throw new qt;if(V){if(!W)throw new qt;a<u?(p=!0,I=!0):(w=!0,E=!0)}else if(W)throw new qt}if(p){if(w)throw new qt;e.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(w&&e.decrement(this.getOddCounts(),this.getOddRoundingErrors()),E){if(I)throw new qt;e.increment(this.getEvenCounts(),this.getOddRoundingErrors())}I&&e.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.SYMBOL_WIDEST=[7,5,4,3,1],e.EVEN_TOTAL_SUBSET=[4,20,52,104,204],e.GSUM=[0,348,1388,2948,3988],e.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],e.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],e.FINDER_PATTERN_SEQUENCES=[[e.FINDER_PAT_A=0,e.FINDER_PAT_A],[e.FINDER_PAT_A,e.FINDER_PAT_B=1,e.FINDER_PAT_B],[e.FINDER_PAT_A,e.FINDER_PAT_C=2,e.FINDER_PAT_B,e.FINDER_PAT_D=3],[e.FINDER_PAT_A,e.FINDER_PAT_E=4,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_C],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_F=5],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F]],e.MAX_PAIRS=11,e}(ri);const bi=Ao;var ds=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),tl=function(s){function e(n,a,u){var p=s.call(this,n,a)||this;return p.count=0,p.finderPattern=u,p}return ds(e,s),e.prototype.getFinderPattern=function(){return this.finderPattern},e.prototype.getCount=function(){return this.count},e.prototype.incrementCount=function(){this.count++},e}(K);const ma=tl;var Sa=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Os=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},nl=function(s){function e(){var n=null!==s&&s.apply(this,arguments)||this;return n.possibleLeftPairs=[],n.possibleRightPairs=[],n}return Sa(e,s),e.prototype.decodeRow=function(n,a,u){var p,w,E,I,R=this.decodePair(a,!1,n,u);e.addOrTally(this.possibleLeftPairs,R),a.reverse();var V=this.decodePair(a,!0,n,u);e.addOrTally(this.possibleRightPairs,V),a.reverse();try{for(var W=Os(this.possibleLeftPairs),ee=W.next();!ee.done;ee=W.next()){var oe=ee.value;if(oe.getCount()>1)try{for(var Ce=(E=void 0,Os(this.possibleRightPairs)),Ne=Ce.next();!Ne.done;Ne=Ce.next()){var ot=Ne.value;if(ot.getCount()>1&&e.checkChecksum(oe,ot))return e.constructResult(oe,ot)}}catch(ut){E={error:ut}}finally{try{Ne&&!Ne.done&&(I=Ce.return)&&I.call(Ce)}finally{if(E)throw E.error}}}}catch(ut){p={error:ut}}finally{try{ee&&!ee.done&&(w=W.return)&&w.call(W)}finally{if(p)throw p.error}}throw new qt},e.addOrTally=function(n,a){var u,p;if(null!=a){var w=!1;try{for(var E=Os(n),I=E.next();!I.done;I=E.next()){var R=I.value;if(R.getValue()===a.getValue()){R.incrementCount(),w=!0;break}}}catch(V){u={error:V}}finally{try{I&&!I.done&&(p=E.return)&&p.call(E)}finally{if(u)throw u.error}}w||n.push(a)}},e.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},e.constructResult=function(n,a){for(var u=4537077*n.getValue()+a.getValue(),p=new String(u).toString(),w=new _r,E=13-p.length;E>0;E--)w.append("0");w.append(p);var I=0;for(E=0;E<13;E++){var R=w.charAt(E).charCodeAt(0)-"0".charCodeAt(0);I+=1&E?R:3*R}10==(I=10-I%10)&&(I=0),w.append(I.toString());var V=n.getFinderPattern().getResultPoints(),W=a.getFinderPattern().getResultPoints();return new Ze(w.toString(),null,0,[V[0],V[1],W[0],W[1]],De.RSS_14,(new Date).getTime())},e.checkChecksum=function(n,a){var u=(n.getChecksumPortion()+16*a.getChecksumPortion())%79,p=9*n.getFinderPattern().getValue()+a.getFinderPattern().getValue();return p>72&&p--,p>8&&p--,u===p},e.prototype.decodePair=function(n,a,u,p){try{var w=this.findFinderPattern(n,a),E=this.parseFoundFinderPattern(n,u,a,w),I=null==p?null:p.get(Qn.NEED_RESULT_POINT_CALLBACK);if(null!=I){var R=(w[0]+w[1])/2;a&&(R=n.getSize()-1-R),I.foundPossibleResultPoint(new Zn(R,u))}var V=this.decodeDataCharacter(n,E,!0),W=this.decodeDataCharacter(n,E,!1);return new ma(1597*V.getValue()+W.getValue(),V.getChecksumPortion()+4*W.getChecksumPortion(),E)}catch{return null}},e.prototype.decodeDataCharacter=function(n,a,u){for(var p=this.getDataCharacterCounters(),w=0;w<p.length;w++)p[w]=0;if(u)Di.recordPatternInReverse(n,a.getStartEnd()[0],p);else{Di.recordPattern(n,a.getStartEnd()[1]+1,p);for(var E=0,I=p.length-1;E<I;E++,I--){var R=p[E];p[E]=p[I],p[I]=R}}var V=u?16:15,W=vr.sum(new Int32Array(p))/V,ee=this.getOddCounts(),oe=this.getEvenCounts(),Ce=this.getOddRoundingErrors(),Ne=this.getEvenRoundingErrors();for(E=0;E<p.length;E++){var ot=p[E]/W,ut=Math.floor(ot+.5);ut<1?ut=1:ut>8&&(ut=8);var at=Math.floor(E/2);1&E?(oe[at]=ut,Ne[at]=ot-ut):(ee[at]=ut,Ce[at]=ot-ut)}this.adjustOddEvenCounts(u,V);var Pt=0,Wt=0;for(E=ee.length-1;E>=0;E--)Wt*=9,Wt+=ee[E],Pt+=ee[E];var wn=0,Un=0;for(E=oe.length-1;E>=0;E--)wn*=9,wn+=oe[E],Un+=oe[E];var hr,Ei,Xn=Wt+3*wn;if(u){if(1&Pt||Pt>12||Pt<4)throw new qt;var fi=9-(Ei=e.OUTSIDE_ODD_WIDEST[hr=(12-Pt)/2]),xa=vn.getRSSvalue(ee,Ei,!1),so=vn.getRSSvalue(oe,fi,!0);return new K(xa*e.OUTSIDE_EVEN_TOTAL_SUBSET[hr]+so+e.OUTSIDE_GSUM[hr],Xn)}if(1&Un||Un>10||Un<4)throw new qt;return fi=9-(Ei=e.INSIDE_ODD_WIDEST[hr=(10-Un)/2]),xa=vn.getRSSvalue(ee,Ei,!0),so=vn.getRSSvalue(oe,fi,!1),new K(so*e.INSIDE_ODD_TOTAL_SUBSET[hr]+xa+e.INSIDE_GSUM[hr],Xn)},e.prototype.findFinderPattern=function(n,a){var u=this.getDecodeFinderCounters();u[0]=0,u[1]=0,u[2]=0,u[3]=0;for(var p=n.getSize(),w=!1,E=0;E<p&&a!==(w=!n.get(E));)E++;for(var I=0,R=E,V=E;V<p;V++)if(n.get(V)!==w)u[I]++;else{if(3===I){if(ri.isFinderPattern(u))return[R,V];R+=u[0]+u[1],u[0]=u[2],u[1]=u[3],u[2]=0,u[3]=0,I--}else I++;u[I]=1,w=!w}throw new qt},e.prototype.parseFoundFinderPattern=function(n,a,u,p){for(var w=n.get(p[0]),E=p[0]-1;E>=0&&w!==n.get(E);)E--;E++;var I=p[0]-E,R=this.getDecodeFinderCounters(),V=new Int32Array(R.length);kn.arraycopy(R,0,V,1,R.length-1),V[0]=I;var W=this.parseFinderValue(V,e.FINDER_PATTERNS),ee=E,oe=p[1];return u&&(ee=n.getSize()-1-ee,oe=n.getSize()-1-oe),new Ie(W,[E,p[1]],ee,oe,a)},e.prototype.adjustOddEvenCounts=function(n,a){var u=vr.sum(new Int32Array(this.getOddCounts())),p=vr.sum(new Int32Array(this.getEvenCounts())),w=!1,E=!1,I=!1,R=!1;n?(u>12?E=!0:u<4&&(w=!0),p>12?R=!0:p<4&&(I=!0)):(u>11?E=!0:u<5&&(w=!0),p>10?R=!0:p<4&&(I=!0));var V=u+p-a,W=(1&u)==(n?1:0),ee=1==(1&p);if(1===V)if(W){if(ee)throw new qt;E=!0}else{if(!ee)throw new qt;R=!0}else if(-1===V)if(W){if(ee)throw new qt;w=!0}else{if(!ee)throw new qt;I=!0}else{if(0!==V)throw new qt;if(W){if(!ee)throw new qt;u<p?(w=!0,R=!0):(E=!0,I=!0)}else if(ee)throw new qt}if(w){if(E)throw new qt;ri.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(E&&ri.decrement(this.getOddCounts(),this.getOddRoundingErrors()),I){if(R)throw new qt;ri.increment(this.getEvenCounts(),this.getOddRoundingErrors())}R&&ri.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],e.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],e.OUTSIDE_GSUM=[0,161,961,2015,2715],e.INSIDE_GSUM=[0,336,1036,1516],e.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],e.INSIDE_ODD_WIDEST=[2,4,6,8],e.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],e}(ri);const Ia=nl;var rl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),qc=function(s){function e(n){var a=s.call(this)||this;a.readers=[];var u=n?n.get(Qn.POSSIBLE_FORMATS):null,p=n&&void 0!==n.get(Qn.ASSUME_CODE_39_CHECK_DIGIT);return u&&((u.includes(De.EAN_13)||u.includes(De.UPC_A)||u.includes(De.EAN_8)||u.includes(De.UPC_E))&&a.readers.push(new Ya(n)),u.includes(De.CODE_39)&&a.readers.push(new hl(p)),u.includes(De.CODE_93)&&a.readers.push(new zr),u.includes(De.CODE_128)&&a.readers.push(new dl),u.includes(De.ITF)&&a.readers.push(new Qi),u.includes(De.CODABAR)&&a.readers.push(new vs),u.includes(De.RSS_14)&&a.readers.push(new Ia),u.includes(De.RSS_EXPANDED)&&(console.warn("RSS Expanded reader IS NOT ready for production yet! use at your own risk."),a.readers.push(new bi))),0===a.readers.length&&(a.readers.push(new Ya(n)),a.readers.push(new hl),a.readers.push(new zr),a.readers.push(new Ya(n)),a.readers.push(new dl),a.readers.push(new Qi),a.readers.push(new Ia)),a}return rl(e,s),e.prototype.decodeRow=function(n,a,u){for(var p=0;p<this.readers.length;p++)try{return this.readers[p].decodeRow(n,a,u)}catch{}throw new qt},e.prototype.reset=function(){this.readers.forEach(function(n){return n.reset()})},e}(Di);const Hn=qc;var Cl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ac=(function(s){Cl(function e(n,a){return void 0===n&&(n=500),s.call(this,new Hn(a),n,a)||this},s)}(pn),function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}),Yi=function(){function s(e,n,a){this.ecCodewords=e,this.ecBlocks=[n],a&&this.ecBlocks.push(a)}return s.prototype.getECCodewords=function(){return this.ecCodewords},s.prototype.getECBlocks=function(){return this.ecBlocks},s}(),$r=function(){function s(e,n){this.count=e,this.dataCodewords=n}return s.prototype.getCount=function(){return this.count},s.prototype.getDataCodewords=function(){return this.dataCodewords},s}(),Ec=function(){function s(e,n,a,u,p,w){var E,I;this.versionNumber=e,this.symbolSizeRows=n,this.symbolSizeColumns=a,this.dataRegionSizeRows=u,this.dataRegionSizeColumns=p,this.ecBlocks=w;var R=0,V=w.getECCodewords(),W=w.getECBlocks();try{for(var ee=ac(W),oe=ee.next();!oe.done;oe=ee.next()){var Ce=oe.value;R+=Ce.getCount()*(Ce.getDataCodewords()+V)}}catch(Ne){E={error:Ne}}finally{try{oe&&!oe.done&&(I=ee.return)&&I.call(ee)}finally{if(E)throw E.error}}this.totalCodewords=R}return s.prototype.getVersionNumber=function(){return this.versionNumber},s.prototype.getSymbolSizeRows=function(){return this.symbolSizeRows},s.prototype.getSymbolSizeColumns=function(){return this.symbolSizeColumns},s.prototype.getDataRegionSizeRows=function(){return this.dataRegionSizeRows},s.prototype.getDataRegionSizeColumns=function(){return this.dataRegionSizeColumns},s.prototype.getTotalCodewords=function(){return this.totalCodewords},s.prototype.getECBlocks=function(){return this.ecBlocks},s.getVersionForDimensions=function(e,n){var a,u;if(1&e||1&n)throw new nn;try{for(var p=ac(s.VERSIONS),w=p.next();!w.done;w=p.next()){var E=w.value;if(E.symbolSizeRows===e&&E.symbolSizeColumns===n)return E}}catch(I){a={error:I}}finally{try{w&&!w.done&&(u=p.return)&&u.call(p)}finally{if(a)throw a.error}}throw new nn},s.prototype.toString=function(){return""+this.versionNumber},s.buildVersions=function(){return[new s(1,10,10,8,8,new Yi(5,new $r(1,3))),new s(2,12,12,10,10,new Yi(7,new $r(1,5))),new s(3,14,14,12,12,new Yi(10,new $r(1,8))),new s(4,16,16,14,14,new Yi(12,new $r(1,12))),new s(5,18,18,16,16,new Yi(14,new $r(1,18))),new s(6,20,20,18,18,new Yi(18,new $r(1,22))),new s(7,22,22,20,20,new Yi(20,new $r(1,30))),new s(8,24,24,22,22,new Yi(24,new $r(1,36))),new s(9,26,26,24,24,new Yi(28,new $r(1,44))),new s(10,32,32,14,14,new Yi(36,new $r(1,62))),new s(11,36,36,16,16,new Yi(42,new $r(1,86))),new s(12,40,40,18,18,new Yi(48,new $r(1,114))),new s(13,44,44,20,20,new Yi(56,new $r(1,144))),new s(14,48,48,22,22,new Yi(68,new $r(1,174))),new s(15,52,52,24,24,new Yi(42,new $r(2,102))),new s(16,64,64,14,14,new Yi(56,new $r(2,140))),new s(17,72,72,16,16,new Yi(36,new $r(4,92))),new s(18,80,80,18,18,new Yi(48,new $r(4,114))),new s(19,88,88,20,20,new Yi(56,new $r(4,144))),new s(20,96,96,22,22,new Yi(68,new $r(4,174))),new s(21,104,104,24,24,new Yi(56,new $r(6,136))),new s(22,120,120,18,18,new Yi(68,new $r(6,175))),new s(23,132,132,20,20,new Yi(62,new $r(8,163))),new s(24,144,144,22,22,new Yi(62,new $r(8,156),new $r(2,155))),new s(25,8,18,6,16,new Yi(7,new $r(1,5))),new s(26,8,32,6,14,new Yi(11,new $r(1,10))),new s(27,12,26,10,24,new Yi(14,new $r(1,16))),new s(28,12,36,10,16,new Yi(18,new $r(1,22))),new s(29,16,36,14,16,new Yi(24,new $r(1,32))),new s(30,16,48,14,22,new Yi(28,new $r(1,49)))]},s.VERSIONS=s.buildVersions(),s}();const il=Ec;var du=function(){function s(e){var n=e.getHeight();if(n<8||n>144||1&n)throw new nn;this.version=s.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new ur(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}return s.prototype.getVersion=function(){return this.version},s.readVersion=function(e){var n=e.getHeight(),a=e.getWidth();return il.getVersionForDimensions(n,a)},s.prototype.readCodewords=function(){var e=new Int8Array(this.version.getTotalCodewords()),n=0,a=4,u=0,p=this.mappingBitMatrix.getHeight(),w=this.mappingBitMatrix.getWidth(),E=!1,I=!1,R=!1,V=!1;do{if(a!==p||0!==u||E)if(a===p-2&&0===u&&3&w&&!I)e[n++]=255&this.readCorner2(p,w),a-=2,u+=2,I=!0;else if(a!==p+4||2!==u||7&w||R)if(a!==p-2||0!==u||4!=(7&w)||V){do{a<p&&u>=0&&!this.readMappingMatrix.get(u,a)&&(e[n++]=255&this.readUtah(a,u,p,w)),a-=2,u+=2}while(a>=0&&u<w);a+=1,u+=3;do{a>=0&&u<w&&!this.readMappingMatrix.get(u,a)&&(e[n++]=255&this.readUtah(a,u,p,w)),a+=2,u-=2}while(a<p&&u>=0);a+=3,u+=1}else e[n++]=255&this.readCorner4(p,w),a-=2,u+=2,V=!0;else e[n++]=255&this.readCorner3(p,w),a-=2,u+=2,R=!0;else e[n++]=255&this.readCorner1(p,w),a-=2,u+=2,E=!0}while(a<p||u<w);if(n!==this.version.getTotalCodewords())throw new nn;return e},s.prototype.readModule=function(e,n,a,u){return e<0&&(e+=a,n+=4-(a+4&7)),n<0&&(n+=u,e+=4-(u+4&7)),this.readMappingMatrix.set(n,e),this.mappingBitMatrix.get(n,e)},s.prototype.readUtah=function(e,n,a,u){var p=0;return this.readModule(e-2,n-2,a,u)&&(p|=1),p<<=1,this.readModule(e-2,n-1,a,u)&&(p|=1),p<<=1,this.readModule(e-1,n-2,a,u)&&(p|=1),p<<=1,this.readModule(e-1,n-1,a,u)&&(p|=1),p<<=1,this.readModule(e-1,n,a,u)&&(p|=1),p<<=1,this.readModule(e,n-2,a,u)&&(p|=1),p<<=1,this.readModule(e,n-1,a,u)&&(p|=1),p<<=1,this.readModule(e,n,a,u)&&(p|=1),p},s.prototype.readCorner1=function(e,n){var a=0;return this.readModule(e-1,0,e,n)&&(a|=1),a<<=1,this.readModule(e-1,1,e,n)&&(a|=1),a<<=1,this.readModule(e-1,2,e,n)&&(a|=1),a<<=1,this.readModule(0,n-2,e,n)&&(a|=1),a<<=1,this.readModule(0,n-1,e,n)&&(a|=1),a<<=1,this.readModule(1,n-1,e,n)&&(a|=1),a<<=1,this.readModule(2,n-1,e,n)&&(a|=1),a<<=1,this.readModule(3,n-1,e,n)&&(a|=1),a},s.prototype.readCorner2=function(e,n){var a=0;return this.readModule(e-3,0,e,n)&&(a|=1),a<<=1,this.readModule(e-2,0,e,n)&&(a|=1),a<<=1,this.readModule(e-1,0,e,n)&&(a|=1),a<<=1,this.readModule(0,n-4,e,n)&&(a|=1),a<<=1,this.readModule(0,n-3,e,n)&&(a|=1),a<<=1,this.readModule(0,n-2,e,n)&&(a|=1),a<<=1,this.readModule(0,n-1,e,n)&&(a|=1),a<<=1,this.readModule(1,n-1,e,n)&&(a|=1),a},s.prototype.readCorner3=function(e,n){var a=0;return this.readModule(e-1,0,e,n)&&(a|=1),a<<=1,this.readModule(e-1,n-1,e,n)&&(a|=1),a<<=1,this.readModule(0,n-3,e,n)&&(a|=1),a<<=1,this.readModule(0,n-2,e,n)&&(a|=1),a<<=1,this.readModule(0,n-1,e,n)&&(a|=1),a<<=1,this.readModule(1,n-3,e,n)&&(a|=1),a<<=1,this.readModule(1,n-2,e,n)&&(a|=1),a<<=1,this.readModule(1,n-1,e,n)&&(a|=1),a},s.prototype.readCorner4=function(e,n){var a=0;return this.readModule(e-3,0,e,n)&&(a|=1),a<<=1,this.readModule(e-2,0,e,n)&&(a|=1),a<<=1,this.readModule(e-1,0,e,n)&&(a|=1),a<<=1,this.readModule(0,n-2,e,n)&&(a|=1),a<<=1,this.readModule(0,n-1,e,n)&&(a|=1),a<<=1,this.readModule(1,n-1,e,n)&&(a|=1),a<<=1,this.readModule(2,n-1,e,n)&&(a|=1),a<<=1,this.readModule(3,n-1,e,n)&&(a|=1),a},s.prototype.extractDataRegion=function(e){var n=this.version.getSymbolSizeRows(),a=this.version.getSymbolSizeColumns();if(e.getHeight()!==n)throw new Xt("Dimension of bitMatrix must match the version size");for(var u=this.version.getDataRegionSizeRows(),p=this.version.getDataRegionSizeColumns(),w=n/u|0,E=a/p|0,V=new ur(E*p,w*u),W=0;W<w;++W)for(var ee=W*u,oe=0;oe<E;++oe)for(var Ce=oe*p,Ne=0;Ne<u;++Ne)for(var ot=W*(u+2)+1+Ne,ut=ee+Ne,at=0;at<p;++at)e.get(oe*(p+2)+1+at,ot)&&V.set(Ce+at,ut);return V},s}();const Yc=du;var Do=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Xs=function(){function s(e,n){this.numDataCodewords=e,this.codewords=n}return s.getDataBlocks=function(e,n){var a,u,p,w,E=n.getECBlocks(),I=0,R=E.getECBlocks();try{for(var V=Do(R),W=V.next();!W.done;W=V.next())I+=(ee=W.value).getCount()}catch(fc){a={error:fc}}finally{try{W&&!W.done&&(u=V.return)&&u.call(V)}finally{if(a)throw a.error}}var oe=new Array(I),Ce=0;try{for(var Ne=Do(R),ot=Ne.next();!ot.done;ot=Ne.next())for(var ee=ot.value,ut=0;ut<ee.getCount();ut++){var at=ee.getDataCodewords(),Pt=E.getECCodewords()+at;oe[Ce++]=new s(at,new Uint8Array(Pt))}}catch(fc){p={error:fc}}finally{try{ot&&!ot.done&&(w=Ne.return)&&w.call(Ne)}finally{if(p)throw p.error}}var wn=oe[0].codewords.length-E.getECCodewords(),Un=wn-1,Xn=0;for(ut=0;ut<Un;ut++)for(var hr=0;hr<Ce;hr++)oe[hr].codewords[ut]=e[Xn++];var Ei=24===n.getVersionNumber(),fi=Ei?8:Ce;for(hr=0;hr<fi;hr++)oe[hr].codewords[wn-1]=e[Xn++];var xa=oe[0].codewords.length;for(ut=wn;ut<xa;ut++)for(hr=0;hr<Ce;hr++){var so=Ei?(hr+8)%Ce:hr;oe[so].codewords[Ei&&so>7?ut-1:ut]=e[Xn++]}if(Xn!==e.length)throw new Xt;return oe},s.prototype.getNumDataCodewords=function(){return this.numDataCodewords},s.prototype.getCodewords=function(){return this.codewords},s}();const Hl=Xs;var la=function(){function s(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}return s.prototype.getBitOffset=function(){return this.bitOffset},s.prototype.getByteOffset=function(){return this.byteOffset},s.prototype.readBits=function(e){if(e<1||e>32||e>this.available())throw new Xt(""+e);var n=0,a=this.bitOffset,u=this.byteOffset,p=this.bytes;if(a>0){var w=8-a,E=e<w?e:w;n=(p[u]&255>>8-E<<(I=w-E))>>I,e-=E,8===(a+=E)&&(a=0,u++)}if(e>0){for(;e>=8;)n=n<<8|255&p[u],u++,e-=8;var I;e>0&&(n=n<<e|(p[u]&255>>(I=8-e)<<I)>>I,a+=e)}return this.bitOffset=a,this.byteOffset=u,n},s.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},s}();const Kc=la;var Ds=function(s){return s[s.PAD_ENCODE=0]="PAD_ENCODE",s[s.ASCII_ENCODE=1]="ASCII_ENCODE",s[s.C40_ENCODE=2]="C40_ENCODE",s[s.TEXT_ENCODE=3]="TEXT_ENCODE",s[s.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",s[s.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",s[s.BASE256_ENCODE=6]="BASE256_ENCODE",s}(Ds||{}),Al=function(){function s(){}return s.decode=function(e){var n=new Kc(e),a=new _r,u=new _r,p=new Array,w=Ds.ASCII_ENCODE;do{if(w===Ds.ASCII_ENCODE)w=this.decodeAsciiSegment(n,a,u);else{switch(w){case Ds.C40_ENCODE:this.decodeC40Segment(n,a);break;case Ds.TEXT_ENCODE:this.decodeTextSegment(n,a);break;case Ds.ANSIX12_ENCODE:this.decodeAnsiX12Segment(n,a);break;case Ds.EDIFACT_ENCODE:this.decodeEdifactSegment(n,a);break;case Ds.BASE256_ENCODE:this.decodeBase256Segment(n,a,p);break;default:throw new nn}w=Ds.ASCII_ENCODE}}while(w!==Ds.PAD_ENCODE&&n.available()>0);return u.length()>0&&a.append(u.toString()),new Bn(e,a.toString(),0===p.length?null:p,null)},s.decodeAsciiSegment=function(e,n,a){var u=!1;do{var p=e.readBits(8);if(0===p)throw new nn;if(p<=128)return u&&(p+=128),n.append(String.fromCharCode(p-1)),Ds.ASCII_ENCODE;if(129===p)return Ds.PAD_ENCODE;if(p<=229){var w=p-130;w<10&&n.append("0"),n.append(""+w)}else switch(p){case 230:return Ds.C40_ENCODE;case 231:return Ds.BASE256_ENCODE;case 232:n.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:u=!0;break;case 236:n.append("[)>\x1e05\x1d"),a.insert(0,"\x1e\x04");break;case 237:n.append("[)>\x1e06\x1d"),a.insert(0,"\x1e\x04");break;case 238:return Ds.ANSIX12_ENCODE;case 239:return Ds.TEXT_ENCODE;case 240:return Ds.EDIFACT_ENCODE;default:if(254!==p||0!==e.available())throw new nn}}while(e.available()>0);return Ds.ASCII_ENCODE},s.decodeC40Segment=function(e,n){var a=!1,u=[],p=0;do{if(8===e.available())return;var w=e.readBits(8);if(254===w)return;this.parseTwoBytes(w,e.readBits(8),u);for(var E=0;E<3;E++){var I=u[E];switch(p){case 0:if(I<3)p=I+1;else{if(!(I<this.C40_BASIC_SET_CHARS.length))throw new nn;var R=this.C40_BASIC_SET_CHARS[I];a?(n.append(String.fromCharCode(R.charCodeAt(0)+128)),a=!1):n.append(R)}break;case 1:a?(n.append(String.fromCharCode(I+128)),a=!1):n.append(String.fromCharCode(I)),p=0;break;case 2:if(I<this.C40_SHIFT2_SET_CHARS.length)R=this.C40_SHIFT2_SET_CHARS[I],a?(n.append(String.fromCharCode(R.charCodeAt(0)+128)),a=!1):n.append(R);else switch(I){case 27:n.append(String.fromCharCode(29));break;case 30:a=!0;break;default:throw new nn}p=0;break;case 3:a?(n.append(String.fromCharCode(I+224)),a=!1):n.append(String.fromCharCode(I+96)),p=0;break;default:throw new nn}}}while(e.available()>0)},s.decodeTextSegment=function(e,n){var a=!1,u=[],p=0;do{if(8===e.available())return;var w=e.readBits(8);if(254===w)return;this.parseTwoBytes(w,e.readBits(8),u);for(var E=0;E<3;E++){var I=u[E];switch(p){case 0:if(I<3)p=I+1;else{if(!(I<this.TEXT_BASIC_SET_CHARS.length))throw new nn;var R=this.TEXT_BASIC_SET_CHARS[I];a?(n.append(String.fromCharCode(R.charCodeAt(0)+128)),a=!1):n.append(R)}break;case 1:a?(n.append(String.fromCharCode(I+128)),a=!1):n.append(String.fromCharCode(I)),p=0;break;case 2:if(I<this.TEXT_SHIFT2_SET_CHARS.length)R=this.TEXT_SHIFT2_SET_CHARS[I],a?(n.append(String.fromCharCode(R.charCodeAt(0)+128)),a=!1):n.append(R);else switch(I){case 27:n.append(String.fromCharCode(29));break;case 30:a=!0;break;default:throw new nn}p=0;break;case 3:if(!(I<this.TEXT_SHIFT3_SET_CHARS.length))throw new nn;R=this.TEXT_SHIFT3_SET_CHARS[I],a?(n.append(String.fromCharCode(R.charCodeAt(0)+128)),a=!1):n.append(R),p=0;break;default:throw new nn}}}while(e.available()>0)},s.decodeAnsiX12Segment=function(e,n){var a=[];do{if(8===e.available())return;var u=e.readBits(8);if(254===u)return;this.parseTwoBytes(u,e.readBits(8),a);for(var p=0;p<3;p++){var w=a[p];switch(w){case 0:n.append("\r");break;case 1:n.append("*");break;case 2:n.append(">");break;case 3:n.append(" ");break;default:if(w<14)n.append(String.fromCharCode(w+44));else{if(!(w<40))throw new nn;n.append(String.fromCharCode(w+51))}}}}while(e.available()>0)},s.parseTwoBytes=function(e,n,a){var u=(e<<8)+n-1,p=Math.floor(u/1600);a[0]=p,u-=1600*p,p=Math.floor(u/40),a[1]=p,a[2]=u-40*p},s.decodeEdifactSegment=function(e,n){do{if(e.available()<=16)return;for(var a=0;a<4;a++){var u=e.readBits(6);if(31===u){var p=8-e.getBitOffset();return void(8!==p&&e.readBits(p))}32&u||(u|=64),n.append(String.fromCharCode(u))}}while(e.available()>0)},s.decodeBase256Segment=function(e,n,a){var w,u=1+e.getByteOffset(),p=this.unrandomize255State(e.readBits(8),u++);if((w=0===p?e.available()/8|0:p<250?p:250*(p-249)+this.unrandomize255State(e.readBits(8),u++))<0)throw new nn;for(var E=new Uint8Array(w),I=0;I<w;I++){if(e.available()<8)throw new nn;E[I]=this.unrandomize255State(e.readBits(8),u++)}a.push(E);try{n.append(Ai.decode(E,Pr.ISO88591))}catch(R){throw new Fi("Platform does not support required encoding: "+R.message)}},s.unrandomize255State=function(e,n){var u=e-(149*n%255+1);return u>=0?u:u+256},s.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],s.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],s.TEXT_SHIFT2_SET_CHARS=s.C40_SHIFT2_SET_CHARS,s.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)],s}();const _a=Al;var ud=function(){function s(){this.rsDecoder=new Jo(en.DATA_MATRIX_FIELD_256)}return s.prototype.decode=function(e){var n,a,u=new Yc(e),p=u.getVersion(),w=u.readCodewords(),E=Hl.getDataBlocks(w,p),I=0;try{for(var R=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(E),V=R.next();!V.done;V=R.next())I+=V.value.getNumDataCodewords()}catch(Pt){n={error:Pt}}finally{try{V&&!V.done&&(a=R.return)&&a.call(R)}finally{if(n)throw n.error}}for(var ee=new Uint8Array(I),oe=E.length,Ce=0;Ce<oe;Ce++){var Ne=E[Ce],ot=Ne.getCodewords(),ut=Ne.getNumDataCodewords();this.correctErrors(ot,ut);for(var at=0;at<ut;at++)ee[at*oe+Ce]=ot[at]}return _a.decode(ee)},s.prototype.correctErrors=function(e,n){var a=new Int32Array(e);try{this.rsDecoder.decode(a,e.length-n)}catch{throw new Wn}for(var u=0;u<n;u++)e[u]=a[u]},s}();const hu=ud;var Va=function(){function s(e){this.image=e,this.rectangleDetector=new bo(this.image)}return s.prototype.detect=function(){var e=this.rectangleDetector.detect(),n=this.detectSolid1(e);if((n=this.detectSolid2(n))[3]=this.correctTopRight(n),!n[3])throw new qt;var a=(n=this.shiftToModuleCenter(n))[0],u=n[1],p=n[2],w=n[3],E=this.transitionsBetween(a,w)+1,I=this.transitionsBetween(p,w)+1;1==(1&E)&&(E+=1),1==(1&I)&&(I+=1),4*E<7*I&&4*I<7*E&&(E=I=Math.max(E,I));var R=s.sampleGrid(this.image,a,u,p,w,E,I);return new Go(R,[a,u,p,w])},s.shiftPoint=function(e,n,a){var u=(n.getX()-e.getX())/(a+1),p=(n.getY()-e.getY())/(a+1);return new Zn(e.getX()+u,e.getY()+p)},s.moveAway=function(e,n,a){var u=e.getX(),p=e.getY();return u<n?u-=1:u+=1,p<a?p-=1:p+=1,new Zn(u,p)},s.prototype.detectSolid1=function(e){var n=e[0],a=e[1],u=e[3],p=e[2],w=this.transitionsBetween(n,a),E=this.transitionsBetween(a,u),I=this.transitionsBetween(u,p),R=this.transitionsBetween(p,n),V=w,W=[p,n,a,u];return V>E&&(V=E,W[0]=n,W[1]=a,W[2]=u,W[3]=p),V>I&&(V=I,W[0]=a,W[1]=u,W[2]=p,W[3]=n),V>R&&(W[0]=u,W[1]=p,W[2]=n,W[3]=a),W},s.prototype.detectSolid2=function(e){var n=e[0],a=e[1],u=e[2],p=e[3],w=this.transitionsBetween(n,p),E=s.shiftPoint(a,u,4*(w+1)),I=s.shiftPoint(u,a,4*(w+1));return this.transitionsBetween(E,n)<this.transitionsBetween(I,p)?(e[0]=n,e[1]=a,e[2]=u,e[3]=p):(e[0]=a,e[1]=u,e[2]=p,e[3]=n),e},s.prototype.correctTopRight=function(e){var n=e[0],a=e[1],u=e[2],p=e[3],w=this.transitionsBetween(n,p),E=this.transitionsBetween(a,p),I=s.shiftPoint(n,a,4*(E+1)),R=s.shiftPoint(u,a,4*(w+1));w=this.transitionsBetween(I,p),E=this.transitionsBetween(R,p);var V=new Zn(p.getX()+(u.getX()-a.getX())/(w+1),p.getY()+(u.getY()-a.getY())/(w+1)),W=new Zn(p.getX()+(n.getX()-a.getX())/(E+1),p.getY()+(n.getY()-a.getY())/(E+1));return this.isValid(V)?this.isValid(W)?this.transitionsBetween(I,V)+this.transitionsBetween(R,V)>this.transitionsBetween(I,W)+this.transitionsBetween(R,W)?V:W:V:this.isValid(W)?W:null},s.prototype.shiftToModuleCenter=function(e){var n=e[0],a=e[1],u=e[2],p=e[3],w=this.transitionsBetween(n,p)+1,E=this.transitionsBetween(u,p)+1,I=s.shiftPoint(n,a,4*E),R=s.shiftPoint(u,a,4*w);1==(1&(w=this.transitionsBetween(I,p)+1))&&(w+=1),1==(1&(E=this.transitionsBetween(R,p)+1))&&(E+=1);var ee,oe,V=(n.getX()+a.getX()+u.getX()+p.getX())/4,W=(n.getY()+a.getY()+u.getY()+p.getY())/4;return n=s.moveAway(n,V,W),a=s.moveAway(a,V,W),u=s.moveAway(u,V,W),p=s.moveAway(p,V,W),I=s.shiftPoint(n,a,4*E),I=s.shiftPoint(I,p,4*w),ee=s.shiftPoint(a,n,4*E),ee=s.shiftPoint(ee,u,4*w),R=s.shiftPoint(u,p,4*E),R=s.shiftPoint(R,a,4*w),oe=s.shiftPoint(p,u,4*E),[I,ee,R,oe=s.shiftPoint(oe,n,4*w)]},s.prototype.isValid=function(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()},s.sampleGrid=function(e,n,a,u,p,w,E){return ji.getInstance().sampleGrid(e,w,E,.5,.5,w-.5,.5,w-.5,E-.5,.5,E-.5,n.getX(),n.getY(),p.getX(),p.getY(),u.getX(),u.getY(),a.getX(),a.getY())},s.prototype.transitionsBetween=function(e,n){var a=Math.trunc(e.getX()),u=Math.trunc(e.getY()),p=Math.trunc(n.getX()),w=Math.trunc(n.getY()),E=Math.abs(w-u)>Math.abs(p-a);if(E){var I=a;a=u,u=I,I=p,p=w,w=I}for(var R=Math.abs(p-a),V=Math.abs(w-u),W=-R/2,ee=u<w?1:-1,oe=a<p?1:-1,Ce=0,Ne=this.image.get(E?u:a,E?a:u),ot=a,ut=u;ot!==p;ot+=oe){var at=this.image.get(E?ut:ot,E?ot:ut);if(at!==Ne&&(Ce++,Ne=at),(W+=V)>0){if(ut===w)break;ut+=ee,W-=R}}return Ce},s}();const lc=Va;var dd=function(){function s(){this.decoder=new hu}return s.prototype.decode=function(e,n){var a,u;if(void 0===n&&(n=null),null!=n&&n.has(Qn.PURE_BARCODE)){var p=s.extractPureBits(e.getBlackMatrix());a=this.decoder.decode(p),u=s.NO_POINTS}else{var w=new lc(e.getBlackMatrix()).detect();a=this.decoder.decode(w.getBits()),u=w.getPoints()}var E=a.getRawBytes(),I=new Ze(a.getText(),E,8*E.length,u,De.DATA_MATRIX,kn.currentTimeMillis()),R=a.getByteSegments();null!=R&&I.putMetadata(Tt.BYTE_SEGMENTS,R);var V=a.getECLevel();return null!=V&&I.putMetadata(Tt.ERROR_CORRECTION_LEVEL,V),I},s.prototype.reset=function(){},s.extractPureBits=function(e){var n=e.getTopLeftOnBit(),a=e.getBottomRightOnBit();if(null==n||null==a)throw new qt;var u=this.moduleSize(n,e),p=n[1],E=n[0],R=(a[0]-E+1)/u,V=(a[1]-p+1)/u;if(R<=0||V<=0)throw new qt;var W=u/2;p+=W,E+=W;for(var ee=new ur(R,V),oe=0;oe<V;oe++)for(var Ce=p+oe*u,Ne=0;Ne<R;Ne++)e.get(E+Ne*u,Ce)&&ee.set(Ne,oe);return ee},s.moduleSize=function(e,n){for(var a=n.getWidth(),u=e[0],p=e[1];u<a&&n.get(u,p);)u++;if(u===a)throw new qt;var w=u-e[0];if(0===w)throw new qt;return w},s.NO_POINTS=[],s}();const cc=dd;var gl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Dl=(function(s){gl(function e(n){return void 0===n&&(n=500),s.call(this,new cc,n)||this},s)}(pn),function(s){return s[s.L=0]="L",s[s.M=1]="M",s[s.Q=2]="Q",s[s.H=3]="H",s}(Dl||{})),ei=function(){function s(e,n,a){this.value=e,this.stringValue=n,this.bits=a,s.FOR_BITS.set(a,this),s.FOR_VALUE.set(e,this)}return s.prototype.getValue=function(){return this.value},s.prototype.getBits=function(){return this.bits},s.fromString=function(e){switch(e){case"L":return s.L;case"M":return s.M;case"Q":return s.Q;case"H":return s.H;default:throw new jn(e+"not available")}},s.prototype.toString=function(){return this.stringValue},s.prototype.equals=function(e){return e instanceof s&&this.value===e.value},s.forBits=function(e){if(e<0||e>=s.FOR_BITS.size)throw new Xt;return s.FOR_BITS.get(e)},s.FOR_BITS=new Map,s.FOR_VALUE=new Map,s.L=new s(Dl.L,"L",1),s.M=new s(Dl.M,"M",0),s.Q=new s(Dl.Q,"Q",3),s.H=new s(Dl.H,"H",2),s}();const Nl=ei;var Ru=function(){function s(e){this.errorCorrectionLevel=Nl.forBits(e>>3&3),this.dataMask=7&e}return s.numBitsDiffering=function(e,n){return mt.bitCount(e^n)},s.decodeFormatInformation=function(e,n){var a=s.doDecodeFormatInformation(e,n);return null!==a?a:s.doDecodeFormatInformation(e^s.FORMAT_INFO_MASK_QR,n^s.FORMAT_INFO_MASK_QR)},s.doDecodeFormatInformation=function(e,n){var a,u,p=Number.MAX_SAFE_INTEGER,w=0;try{for(var E=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s.FORMAT_INFO_DECODE_LOOKUP),I=E.next();!I.done;I=E.next()){var R=I.value,V=R[0];if(V===e||V===n)return new s(R[1]);var W=s.numBitsDiffering(e,V);W<p&&(w=R[1],p=W),e!==n&&(W=s.numBitsDiffering(n,V))<p&&(w=R[1],p=W)}}catch(ee){a={error:ee}}finally{try{I&&!I.done&&(u=E.return)&&u.call(E)}finally{if(a)throw a.error}}return p<=3?new s(w):null},s.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},s.prototype.getDataMask=function(){return this.dataMask},s.prototype.hashCode=function(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask},s.prototype.equals=function(e){return e instanceof s&&(this.errorCorrectionLevel===e.errorCorrectionLevel&&this.dataMask===e.dataMask)},s.FORMAT_INFO_MASK_QR=21522,s.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])],s}();const Cc=Ru;var Lu=function(){function s(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];this.ecCodewordsPerBlock=e,this.ecBlocks=n}return s.prototype.getECCodewordsPerBlock=function(){return this.ecCodewordsPerBlock},s.prototype.getNumBlocks=function(){var e,n,a=0,u=this.ecBlocks;try{for(var p=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(u),w=p.next();!w.done;w=p.next())a+=w.value.getCount()}catch(I){e={error:I}}finally{try{w&&!w.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}return a},s.prototype.getTotalECCodewords=function(){return this.ecCodewordsPerBlock*this.getNumBlocks()},s.prototype.getECBlocks=function(){return this.ecBlocks},s}();const Ct=Lu;var pd=function(){function s(e,n){this.count=e,this.dataCodewords=n}return s.prototype.getCount=function(){return this.count},s.prototype.getDataCodewords=function(){return this.dataCodewords},s}();const Fe=pd;var Dh=function(){function s(e,n){for(var a,u,p=[],w=2;w<arguments.length;w++)p[w-2]=arguments[w];this.versionNumber=e,this.alignmentPatternCenters=n,this.ecBlocks=p;var E=0,I=p[0].getECCodewordsPerBlock(),R=p[0].getECBlocks();try{for(var V=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(R),W=V.next();!W.done;W=V.next()){var ee=W.value;E+=ee.getCount()*(ee.getDataCodewords()+I)}}catch(oe){a={error:oe}}finally{try{W&&!W.done&&(u=V.return)&&u.call(V)}finally{if(a)throw a.error}}this.totalCodewords=E}return s.prototype.getVersionNumber=function(){return this.versionNumber},s.prototype.getAlignmentPatternCenters=function(){return this.alignmentPatternCenters},s.prototype.getTotalCodewords=function(){return this.totalCodewords},s.prototype.getDimensionForVersion=function(){return 17+4*this.versionNumber},s.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.getValue()]},s.getProvisionalVersionForDimension=function(e){if(e%4!=1)throw new nn;try{return this.getVersionForNumber((e-17)/4)}catch{throw new nn}},s.getVersionForNumber=function(e){if(e<1||e>40)throw new Xt;return s.VERSIONS[e-1]},s.decodeVersionInformation=function(e){for(var n=Number.MAX_SAFE_INTEGER,a=0,u=0;u<s.VERSION_DECODE_INFO.length;u++){var p=s.VERSION_DECODE_INFO[u];if(p===e)return s.getVersionForNumber(u+7);var w=Cc.numBitsDiffering(e,p);w<n&&(a=u+7,n=w)}return n<=3?s.getVersionForNumber(a):null},s.prototype.buildFunctionPattern=function(){var e=this.getDimensionForVersion(),n=new ur(e);n.setRegion(0,0,9,9),n.setRegion(e-8,0,8,9),n.setRegion(0,e-8,9,8);for(var a=this.alignmentPatternCenters.length,u=0;u<a;u++)for(var p=this.alignmentPatternCenters[u]-2,w=0;w<a;w++)0===u&&(0===w||w===a-1)||u===a-1&&0===w||n.setRegion(this.alignmentPatternCenters[w]-2,p,5,5);return n.setRegion(6,9,1,e-17),n.setRegion(9,6,e-17,1),this.versionNumber>6&&(n.setRegion(e-11,0,3,6),n.setRegion(0,e-11,6,3)),n},s.prototype.toString=function(){return""+this.versionNumber},s.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),s.VERSIONS=[new s(1,new Int32Array(0),new Ct(7,new Fe(1,19)),new Ct(10,new Fe(1,16)),new Ct(13,new Fe(1,13)),new Ct(17,new Fe(1,9))),new s(2,Int32Array.from([6,18]),new Ct(10,new Fe(1,34)),new Ct(16,new Fe(1,28)),new Ct(22,new Fe(1,22)),new Ct(28,new Fe(1,16))),new s(3,Int32Array.from([6,22]),new Ct(15,new Fe(1,55)),new Ct(26,new Fe(1,44)),new Ct(18,new Fe(2,17)),new Ct(22,new Fe(2,13))),new s(4,Int32Array.from([6,26]),new Ct(20,new Fe(1,80)),new Ct(18,new Fe(2,32)),new Ct(26,new Fe(2,24)),new Ct(16,new Fe(4,9))),new s(5,Int32Array.from([6,30]),new Ct(26,new Fe(1,108)),new Ct(24,new Fe(2,43)),new Ct(18,new Fe(2,15),new Fe(2,16)),new Ct(22,new Fe(2,11),new Fe(2,12))),new s(6,Int32Array.from([6,34]),new Ct(18,new Fe(2,68)),new Ct(16,new Fe(4,27)),new Ct(24,new Fe(4,19)),new Ct(28,new Fe(4,15))),new s(7,Int32Array.from([6,22,38]),new Ct(20,new Fe(2,78)),new Ct(18,new Fe(4,31)),new Ct(18,new Fe(2,14),new Fe(4,15)),new Ct(26,new Fe(4,13),new Fe(1,14))),new s(8,Int32Array.from([6,24,42]),new Ct(24,new Fe(2,97)),new Ct(22,new Fe(2,38),new Fe(2,39)),new Ct(22,new Fe(4,18),new Fe(2,19)),new Ct(26,new Fe(4,14),new Fe(2,15))),new s(9,Int32Array.from([6,26,46]),new Ct(30,new Fe(2,116)),new Ct(22,new Fe(3,36),new Fe(2,37)),new Ct(20,new Fe(4,16),new Fe(4,17)),new Ct(24,new Fe(4,12),new Fe(4,13))),new s(10,Int32Array.from([6,28,50]),new Ct(18,new Fe(2,68),new Fe(2,69)),new Ct(26,new Fe(4,43),new Fe(1,44)),new Ct(24,new Fe(6,19),new Fe(2,20)),new Ct(28,new Fe(6,15),new Fe(2,16))),new s(11,Int32Array.from([6,30,54]),new Ct(20,new Fe(4,81)),new Ct(30,new Fe(1,50),new Fe(4,51)),new Ct(28,new Fe(4,22),new Fe(4,23)),new Ct(24,new Fe(3,12),new Fe(8,13))),new s(12,Int32Array.from([6,32,58]),new Ct(24,new Fe(2,92),new Fe(2,93)),new Ct(22,new Fe(6,36),new Fe(2,37)),new Ct(26,new Fe(4,20),new Fe(6,21)),new Ct(28,new Fe(7,14),new Fe(4,15))),new s(13,Int32Array.from([6,34,62]),new Ct(26,new Fe(4,107)),new Ct(22,new Fe(8,37),new Fe(1,38)),new Ct(24,new Fe(8,20),new Fe(4,21)),new Ct(22,new Fe(12,11),new Fe(4,12))),new s(14,Int32Array.from([6,26,46,66]),new Ct(30,new Fe(3,115),new Fe(1,116)),new Ct(24,new Fe(4,40),new Fe(5,41)),new Ct(20,new Fe(11,16),new Fe(5,17)),new Ct(24,new Fe(11,12),new Fe(5,13))),new s(15,Int32Array.from([6,26,48,70]),new Ct(22,new Fe(5,87),new Fe(1,88)),new Ct(24,new Fe(5,41),new Fe(5,42)),new Ct(30,new Fe(5,24),new Fe(7,25)),new Ct(24,new Fe(11,12),new Fe(7,13))),new s(16,Int32Array.from([6,26,50,74]),new Ct(24,new Fe(5,98),new Fe(1,99)),new Ct(28,new Fe(7,45),new Fe(3,46)),new Ct(24,new Fe(15,19),new Fe(2,20)),new Ct(30,new Fe(3,15),new Fe(13,16))),new s(17,Int32Array.from([6,30,54,78]),new Ct(28,new Fe(1,107),new Fe(5,108)),new Ct(28,new Fe(10,46),new Fe(1,47)),new Ct(28,new Fe(1,22),new Fe(15,23)),new Ct(28,new Fe(2,14),new Fe(17,15))),new s(18,Int32Array.from([6,30,56,82]),new Ct(30,new Fe(5,120),new Fe(1,121)),new Ct(26,new Fe(9,43),new Fe(4,44)),new Ct(28,new Fe(17,22),new Fe(1,23)),new Ct(28,new Fe(2,14),new Fe(19,15))),new s(19,Int32Array.from([6,30,58,86]),new Ct(28,new Fe(3,113),new Fe(4,114)),new Ct(26,new Fe(3,44),new Fe(11,45)),new Ct(26,new Fe(17,21),new Fe(4,22)),new Ct(26,new Fe(9,13),new Fe(16,14))),new s(20,Int32Array.from([6,34,62,90]),new Ct(28,new Fe(3,107),new Fe(5,108)),new Ct(26,new Fe(3,41),new Fe(13,42)),new Ct(30,new Fe(15,24),new Fe(5,25)),new Ct(28,new Fe(15,15),new Fe(10,16))),new s(21,Int32Array.from([6,28,50,72,94]),new Ct(28,new Fe(4,116),new Fe(4,117)),new Ct(26,new Fe(17,42)),new Ct(28,new Fe(17,22),new Fe(6,23)),new Ct(30,new Fe(19,16),new Fe(6,17))),new s(22,Int32Array.from([6,26,50,74,98]),new Ct(28,new Fe(2,111),new Fe(7,112)),new Ct(28,new Fe(17,46)),new Ct(30,new Fe(7,24),new Fe(16,25)),new Ct(24,new Fe(34,13))),new s(23,Int32Array.from([6,30,54,78,102]),new Ct(30,new Fe(4,121),new Fe(5,122)),new Ct(28,new Fe(4,47),new Fe(14,48)),new Ct(30,new Fe(11,24),new Fe(14,25)),new Ct(30,new Fe(16,15),new Fe(14,16))),new s(24,Int32Array.from([6,28,54,80,106]),new Ct(30,new Fe(6,117),new Fe(4,118)),new Ct(28,new Fe(6,45),new Fe(14,46)),new Ct(30,new Fe(11,24),new Fe(16,25)),new Ct(30,new Fe(30,16),new Fe(2,17))),new s(25,Int32Array.from([6,32,58,84,110]),new Ct(26,new Fe(8,106),new Fe(4,107)),new Ct(28,new Fe(8,47),new Fe(13,48)),new Ct(30,new Fe(7,24),new Fe(22,25)),new Ct(30,new Fe(22,15),new Fe(13,16))),new s(26,Int32Array.from([6,30,58,86,114]),new Ct(28,new Fe(10,114),new Fe(2,115)),new Ct(28,new Fe(19,46),new Fe(4,47)),new Ct(28,new Fe(28,22),new Fe(6,23)),new Ct(30,new Fe(33,16),new Fe(4,17))),new s(27,Int32Array.from([6,34,62,90,118]),new Ct(30,new Fe(8,122),new Fe(4,123)),new Ct(28,new Fe(22,45),new Fe(3,46)),new Ct(30,new Fe(8,23),new Fe(26,24)),new Ct(30,new Fe(12,15),new Fe(28,16))),new s(28,Int32Array.from([6,26,50,74,98,122]),new Ct(30,new Fe(3,117),new Fe(10,118)),new Ct(28,new Fe(3,45),new Fe(23,46)),new Ct(30,new Fe(4,24),new Fe(31,25)),new Ct(30,new Fe(11,15),new Fe(31,16))),new s(29,Int32Array.from([6,30,54,78,102,126]),new Ct(30,new Fe(7,116),new Fe(7,117)),new Ct(28,new Fe(21,45),new Fe(7,46)),new Ct(30,new Fe(1,23),new Fe(37,24)),new Ct(30,new Fe(19,15),new Fe(26,16))),new s(30,Int32Array.from([6,26,52,78,104,130]),new Ct(30,new Fe(5,115),new Fe(10,116)),new Ct(28,new Fe(19,47),new Fe(10,48)),new Ct(30,new Fe(15,24),new Fe(25,25)),new Ct(30,new Fe(23,15),new Fe(25,16))),new s(31,Int32Array.from([6,30,56,82,108,134]),new Ct(30,new Fe(13,115),new Fe(3,116)),new Ct(28,new Fe(2,46),new Fe(29,47)),new Ct(30,new Fe(42,24),new Fe(1,25)),new Ct(30,new Fe(23,15),new Fe(28,16))),new s(32,Int32Array.from([6,34,60,86,112,138]),new Ct(30,new Fe(17,115)),new Ct(28,new Fe(10,46),new Fe(23,47)),new Ct(30,new Fe(10,24),new Fe(35,25)),new Ct(30,new Fe(19,15),new Fe(35,16))),new s(33,Int32Array.from([6,30,58,86,114,142]),new Ct(30,new Fe(17,115),new Fe(1,116)),new Ct(28,new Fe(14,46),new Fe(21,47)),new Ct(30,new Fe(29,24),new Fe(19,25)),new Ct(30,new Fe(11,15),new Fe(46,16))),new s(34,Int32Array.from([6,34,62,90,118,146]),new Ct(30,new Fe(13,115),new Fe(6,116)),new Ct(28,new Fe(14,46),new Fe(23,47)),new Ct(30,new Fe(44,24),new Fe(7,25)),new Ct(30,new Fe(59,16),new Fe(1,17))),new s(35,Int32Array.from([6,30,54,78,102,126,150]),new Ct(30,new Fe(12,121),new Fe(7,122)),new Ct(28,new Fe(12,47),new Fe(26,48)),new Ct(30,new Fe(39,24),new Fe(14,25)),new Ct(30,new Fe(22,15),new Fe(41,16))),new s(36,Int32Array.from([6,24,50,76,102,128,154]),new Ct(30,new Fe(6,121),new Fe(14,122)),new Ct(28,new Fe(6,47),new Fe(34,48)),new Ct(30,new Fe(46,24),new Fe(10,25)),new Ct(30,new Fe(2,15),new Fe(64,16))),new s(37,Int32Array.from([6,28,54,80,106,132,158]),new Ct(30,new Fe(17,122),new Fe(4,123)),new Ct(28,new Fe(29,46),new Fe(14,47)),new Ct(30,new Fe(49,24),new Fe(10,25)),new Ct(30,new Fe(24,15),new Fe(46,16))),new s(38,Int32Array.from([6,32,58,84,110,136,162]),new Ct(30,new Fe(4,122),new Fe(18,123)),new Ct(28,new Fe(13,46),new Fe(32,47)),new Ct(30,new Fe(48,24),new Fe(14,25)),new Ct(30,new Fe(42,15),new Fe(32,16))),new s(39,Int32Array.from([6,26,54,82,110,138,166]),new Ct(30,new Fe(20,117),new Fe(4,118)),new Ct(28,new Fe(40,47),new Fe(7,48)),new Ct(30,new Fe(43,24),new Fe(22,25)),new Ct(30,new Fe(10,15),new Fe(67,16))),new s(40,Int32Array.from([6,30,58,86,114,142,170]),new Ct(30,new Fe(19,118),new Fe(6,119)),new Ct(28,new Fe(18,47),new Fe(31,48)),new Ct(30,new Fe(34,24),new Fe(34,25)),new Ct(30,new Fe(20,15),new Fe(61,16)))],s}();const ca=Dh;var hn=function(s){return s[s.DATA_MASK_000=0]="DATA_MASK_000",s[s.DATA_MASK_001=1]="DATA_MASK_001",s[s.DATA_MASK_010=2]="DATA_MASK_010",s[s.DATA_MASK_011=3]="DATA_MASK_011",s[s.DATA_MASK_100=4]="DATA_MASK_100",s[s.DATA_MASK_101=5]="DATA_MASK_101",s[s.DATA_MASK_110=6]="DATA_MASK_110",s[s.DATA_MASK_111=7]="DATA_MASK_111",s}(hn||{}),no=function(){function s(e,n){this.value=e,this.isMasked=n}return s.prototype.unmaskBitMatrix=function(e,n){for(var a=0;a<n;a++)for(var u=0;u<n;u++)this.isMasked(a,u)&&e.flip(u,a)},s.values=new Map([[hn.DATA_MASK_000,new s(hn.DATA_MASK_000,function(e,n){return 0==(e+n&1)})],[hn.DATA_MASK_001,new s(hn.DATA_MASK_001,function(e,n){return 0==(1&e)})],[hn.DATA_MASK_010,new s(hn.DATA_MASK_010,function(e,n){return n%3==0})],[hn.DATA_MASK_011,new s(hn.DATA_MASK_011,function(e,n){return(e+n)%3==0})],[hn.DATA_MASK_100,new s(hn.DATA_MASK_100,function(e,n){return 0==(Math.floor(e/2)+Math.floor(n/3)&1)})],[hn.DATA_MASK_101,new s(hn.DATA_MASK_101,function(e,n){return e*n%6==0})],[hn.DATA_MASK_110,new s(hn.DATA_MASK_110,function(e,n){return e*n%6<3})],[hn.DATA_MASK_111,new s(hn.DATA_MASK_111,function(e,n){return 0==(e+n+e*n%3&1)})]]),s}();const ja=no;var Tl=function(){function s(e){var n=e.getHeight();if(n<21||1!=(3&n))throw new nn;this.bitMatrix=e}return s.prototype.readFormatInformation=function(){if(null!=this.parsedFormatInfo)return this.parsedFormatInfo;for(var e=0,n=0;n<6;n++)e=this.copyBit(n,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var a=5;a>=0;a--)e=this.copyBit(8,a,e);var u=this.bitMatrix.getHeight(),p=0,w=u-7;for(a=u-1;a>=w;a--)p=this.copyBit(8,a,p);for(n=u-8;n<u;n++)p=this.copyBit(n,8,p);if(this.parsedFormatInfo=Cc.decodeFormatInformation(e,p),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new nn},s.prototype.readVersion=function(){if(null!=this.parsedVersion)return this.parsedVersion;var e=this.bitMatrix.getHeight(),n=Math.floor((e-17)/4);if(n<=6)return ca.getVersionForNumber(n);for(var a=0,u=e-11,p=5;p>=0;p--)for(var w=e-9;w>=u;w--)a=this.copyBit(w,p,a);var E=ca.decodeVersionInformation(a);if(null!==E&&E.getDimensionForVersion()===e)return this.parsedVersion=E,E;for(a=0,w=5;w>=0;w--)for(p=e-9;p>=u;p--)a=this.copyBit(w,p,a);if(null!==(E=ca.decodeVersionInformation(a))&&E.getDimensionForVersion()===e)return this.parsedVersion=E,E;throw new nn},s.prototype.copyBit=function(e,n,a){return(this.isMirror?this.bitMatrix.get(n,e):this.bitMatrix.get(e,n))?a<<1|1:a<<1},s.prototype.readCodewords=function(){var e=this.readFormatInformation(),n=this.readVersion(),a=ja.values.get(e.getDataMask()),u=this.bitMatrix.getHeight();a.unmaskBitMatrix(this.bitMatrix,u);for(var p=n.buildFunctionPattern(),w=!0,E=new Uint8Array(n.getTotalCodewords()),I=0,R=0,V=0,W=u-1;W>0;W-=2){6===W&&W--;for(var ee=0;ee<u;ee++)for(var oe=w?u-1-ee:ee,Ce=0;Ce<2;Ce++)p.get(W-Ce,oe)||(V++,R<<=1,this.bitMatrix.get(W-Ce,oe)&&(R|=1),8===V&&(E[I++]=R,V=0,R=0));w=!w}if(I!==n.getTotalCodewords())throw new nn;return E},s.prototype.remask=function(){if(null!==this.parsedFormatInfo){var e=ja.values[this.parsedFormatInfo.getDataMask()],n=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,n)}},s.prototype.setMirror=function(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e},s.prototype.mirror=function(){for(var e=this.bitMatrix,n=0,a=e.getWidth();n<a;n++)for(var u=n+1,p=e.getHeight();u<p;u++)e.get(n,u)!==e.get(u,n)&&(e.flip(u,n),e.flip(n,u))},s}();const hs=Tl;var Ac=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kn=function(){function s(e,n){this.numDataCodewords=e,this.codewords=n}return s.getDataBlocks=function(e,n,a){var u,p,w,E;if(e.length!==n.getTotalCodewords())throw new Xt;var I=n.getECBlocksForLevel(a),R=0,V=I.getECBlocks();try{for(var W=Ac(V),ee=W.next();!ee.done;ee=W.next())R+=(oe=ee.value).getCount()}catch(xs){u={error:xs}}finally{try{ee&&!ee.done&&(p=W.return)&&p.call(W)}finally{if(u)throw u.error}}var Ce=new Array(R),Ne=0;try{for(var ot=Ac(V),ut=ot.next();!ut.done;ut=ot.next())for(var oe=ut.value,at=0;at<oe.getCount();at++){var Pt=oe.getDataCodewords(),Wt=I.getECCodewordsPerBlock()+Pt;Ce[Ne++]=new s(Pt,new Uint8Array(Wt))}}catch(xs){w={error:xs}}finally{try{ut&&!ut.done&&(E=ot.return)&&E.call(ot)}finally{if(w)throw w.error}}for(var wn=Ce[0].codewords.length,Un=Ce.length-1;Un>=0&&Ce[Un].codewords.length!==wn;)Un--;Un++;var hr=wn-I.getECCodewordsPerBlock(),Ei=0;for(at=0;at<hr;at++)for(var fi=0;fi<Ne;fi++)Ce[fi].codewords[at]=e[Ei++];for(fi=Un;fi<Ne;fi++)Ce[fi].codewords[hr]=e[Ei++];var xa=Ce[0].codewords.length;for(at=hr;at<xa;at++)for(fi=0;fi<Ne;fi++)Ce[fi].codewords[fi<Un?at:at+1]=e[Ei++];return Ce},s.prototype.getNumDataCodewords=function(){return this.numDataCodewords},s.prototype.getCodewords=function(){return this.codewords},s}();const ml=Kn;var Ma=function(s){return s[s.TERMINATOR=0]="TERMINATOR",s[s.NUMERIC=1]="NUMERIC",s[s.ALPHANUMERIC=2]="ALPHANUMERIC",s[s.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",s[s.BYTE=4]="BYTE",s[s.ECI=5]="ECI",s[s.KANJI=6]="KANJI",s[s.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",s[s.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",s[s.HANZI=9]="HANZI",s}(Ma||{}),Jl=function(){function s(e,n,a,u){this.value=e,this.stringValue=n,this.characterCountBitsForVersions=a,this.bits=u,s.FOR_BITS.set(u,this),s.FOR_VALUE.set(e,this)}return s.forBits=function(e){var n=s.FOR_BITS.get(e);if(void 0===n)throw new Xt;return n},s.prototype.getCharacterCountBits=function(e){var n=e.getVersionNumber();return this.characterCountBitsForVersions[n<=9?0:n<=26?1:2]},s.prototype.getValue=function(){return this.value},s.prototype.getBits=function(){return this.bits},s.prototype.equals=function(e){return e instanceof s&&this.value===e.value},s.prototype.toString=function(){return this.stringValue},s.FOR_BITS=new Map,s.FOR_VALUE=new Map,s.TERMINATOR=new s(Ma.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),s.NUMERIC=new s(Ma.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),s.ALPHANUMERIC=new s(Ma.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),s.STRUCTURED_APPEND=new s(Ma.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),s.BYTE=new s(Ma.BYTE,"BYTE",Int32Array.from([8,16,16]),4),s.ECI=new s(Ma.ECI,"ECI",Int32Array.from([0,0,0]),7),s.KANJI=new s(Ma.KANJI,"KANJI",Int32Array.from([8,10,12]),8),s.FNC1_FIRST_POSITION=new s(Ma.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),s.FNC1_SECOND_POSITION=new s(Ma.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),s.HANZI=new s(Ma.HANZI,"HANZI",Int32Array.from([8,10,12]),13),s}();const co=Jl;var $n=function(){function s(){}return s.decode=function(e,n,a,u){var p=new Kc(e),w=new _r,E=new Array,I=-1,R=-1;try{var V=null,W=!1,ee=void 0;do{if(p.available()<4)ee=co.TERMINATOR;else{var oe=p.readBits(4);ee=co.forBits(oe)}switch(ee){case co.TERMINATOR:break;case co.FNC1_FIRST_POSITION:case co.FNC1_SECOND_POSITION:W=!0;break;case co.STRUCTURED_APPEND:if(p.available()<16)throw new nn;I=p.readBits(8),R=p.readBits(8);break;case co.ECI:var Ce=s.parseECIValue(p);if(null===(V=vi.getCharacterSetECIByValue(Ce)))throw new nn;break;case co.HANZI:var Ne=p.readBits(4),ot=p.readBits(ee.getCharacterCountBits(n));Ne===s.GB2312_SUBSET&&s.decodeHanziSegment(p,w,ot);break;default:var ut=p.readBits(ee.getCharacterCountBits(n));switch(ee){case co.NUMERIC:s.decodeNumericSegment(p,w,ut);break;case co.ALPHANUMERIC:s.decodeAlphanumericSegment(p,w,ut,W);break;case co.BYTE:s.decodeByteSegment(p,w,ut,V,E,u);break;case co.KANJI:s.decodeKanjiSegment(p,w,ut);break;default:throw new nn}}}while(ee!==co.TERMINATOR)}catch{throw new nn}return new Bn(e,w.toString(),0===E.length?null:E,null===a?null:a.toString(),I,R)},s.decodeHanziSegment=function(e,n,a){if(13*a>e.available())throw new nn;for(var u=new Uint8Array(2*a),p=0;a>0;){var w=e.readBits(13),E=w/96<<8&4294967295|w%96;u[p]=(E+=E<959?41377:42657)>>8&255,u[p+1]=255&E,p+=2,a--}try{n.append(Ai.decode(u,Pr.GB2312))}catch(I){throw new nn(I)}},s.decodeKanjiSegment=function(e,n,a){if(13*a>e.available())throw new nn;for(var u=new Uint8Array(2*a),p=0;a>0;){var w=e.readBits(13),E=w/192<<8&4294967295|w%192;u[p]=(E+=E<7936?33088:49472)>>8,u[p+1]=E,p+=2,a--}try{n.append(Ai.decode(u,Pr.SHIFT_JIS))}catch(I){throw new nn(I)}},s.decodeByteSegment=function(e,n,a,u,p,w){if(8*a>e.available())throw new nn;for(var E=new Uint8Array(a),I=0;I<a;I++)E[I]=e.readBits(8);var R;R=null===u?Pr.guessEncoding(E,w):u.getName();try{n.append(Ai.decode(E,R))}catch(V){throw new nn(V)}p.push(E)},s.toAlphaNumericChar=function(e){if(e>=s.ALPHANUMERIC_CHARS.length)throw new nn;return s.ALPHANUMERIC_CHARS[e]},s.decodeAlphanumericSegment=function(e,n,a,u){for(var p=n.length();a>1;){if(e.available()<11)throw new nn;var w=e.readBits(11);n.append(s.toAlphaNumericChar(Math.floor(w/45))),n.append(s.toAlphaNumericChar(w%45)),a-=2}if(1===a){if(e.available()<6)throw new nn;n.append(s.toAlphaNumericChar(e.readBits(6)))}if(u)for(var E=p;E<n.length();E++)"%"===n.charAt(E)&&(E<n.length()-1&&"%"===n.charAt(E+1)?n.deleteCharAt(E+1):n.setCharAt(E,String.fromCharCode(29)))},s.decodeNumericSegment=function(e,n,a){for(;a>=3;){if(e.available()<10)throw new nn;var u=e.readBits(10);if(u>=1e3)throw new nn;n.append(s.toAlphaNumericChar(Math.floor(u/100))),n.append(s.toAlphaNumericChar(Math.floor(u/10)%10)),n.append(s.toAlphaNumericChar(u%10)),a-=3}if(2===a){if(e.available()<7)throw new nn;var p=e.readBits(7);if(p>=100)throw new nn;n.append(s.toAlphaNumericChar(Math.floor(p/10))),n.append(s.toAlphaNumericChar(p%10))}else if(1===a){if(e.available()<4)throw new nn;var w=e.readBits(4);if(w>=10)throw new nn;n.append(s.toAlphaNumericChar(w))}},s.parseECIValue=function(e){var n=e.readBits(8);if(!(128&n))return 127&n;if(128==(192&n))return(63&n)<<8&4294967295|e.readBits(8);if(192==(224&n))return(31&n)<<16&4294967295|e.readBits(16);throw new nn},s.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",s.GB2312_SUBSET=1,s}();const fu=$n;var Ha=function(){function s(e){this.mirrored=e}return s.prototype.isMirrored=function(){return this.mirrored},s.prototype.applyMirroredCorrection=function(e){if(this.mirrored&&null!==e&&!(e.length<3)){var n=e[0];e[0]=e[2],e[2]=n}},s}();const kl=Ha;var pu=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dc=function(){function s(){this.rsDecoder=new Jo(en.QR_CODE_FIELD_256)}return s.prototype.decodeBooleanArray=function(e,n){return this.decodeBitMatrix(ur.parseFromBooleanArray(e),n)},s.prototype.decodeBitMatrix=function(e,n){var a=new hs(e),u=null;try{return this.decodeBitMatrixParser(a,n)}catch(w){u=w}try{a.remask(),a.setMirror(!0),a.readVersion(),a.readFormatInformation(),a.mirror();var p=this.decodeBitMatrixParser(a,n);return p.setOther(new kl(!0)),p}catch(w){throw null!==u?u:w}},s.prototype.decodeBitMatrixParser=function(e,n){var a,u,p,w,E=e.readVersion(),I=e.readFormatInformation().getErrorCorrectionLevel(),R=e.readCodewords(),V=ml.getDataBlocks(R,E,I),W=0;try{for(var ee=pu(V),oe=ee.next();!oe.done;oe=ee.next())W+=(Ce=oe.value).getNumDataCodewords()}catch(Un){a={error:Un}}finally{try{oe&&!oe.done&&(u=ee.return)&&u.call(ee)}finally{if(a)throw a.error}}var Ne=new Uint8Array(W),ot=0;try{for(var ut=pu(V),at=ut.next();!at.done;at=ut.next()){var Ce,Pt=(Ce=at.value).getCodewords(),Wt=Ce.getNumDataCodewords();this.correctErrors(Pt,Wt);for(var wn=0;wn<Wt;wn++)Ne[ot++]=Pt[wn]}}catch(Un){p={error:Un}}finally{try{at&&!at.done&&(w=ut.return)&&w.call(ut)}finally{if(p)throw p.error}}return fu.decode(Ne,E,I,n)},s.prototype.correctErrors=function(e,n){var a=new Int32Array(e);try{this.rsDecoder.decode(a,e.length-n)}catch{throw new Wn}for(var u=0;u<n;u++)e[u]=a[u]},s}();const Gl=Dc;var Th=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),B=function(s){function e(n,a,u){var p=s.call(this,n,a)||this;return p.estimatedModuleSize=u,p}return Th(e,s),e.prototype.aboutEquals=function(n,a,u){if(Math.abs(a-this.getY())<=n&&Math.abs(u-this.getX())<=n){var p=Math.abs(n-this.estimatedModuleSize);return p<=1||p<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(n,a,u){return new e((this.getX()+a)/2,(this.getY()+n)/2,(this.estimatedModuleSize+u)/2)},e}(Zn);const $=B;var q=function(){function s(e,n,a,u,p,w,E){this.image=e,this.startX=n,this.startY=a,this.width=u,this.height=p,this.moduleSize=w,this.resultPointCallback=E,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}return s.prototype.find=function(){for(var e=this.startX,n=this.height,u=e+this.width,p=this.startY+n/2,w=new Int32Array(3),E=this.image,I=0;I<n;I++){var R=p+(1&I?-Math.floor((I+1)/2):Math.floor((I+1)/2));w[0]=0,w[1]=0,w[2]=0;for(var V=e;V<u&&!E.get(V,R);)V++;for(var W=0;V<u;){if(E.get(V,R))if(1===W)w[1]++;else if(2===W){var ee;if(this.foundPatternCross(w)&&null!==(ee=this.handlePossibleCenter(w,R,V)))return ee;w[0]=w[2],w[1]=1,w[2]=0,W=1}else w[++W]++;else 1===W&&W++,w[W]++;V++}if(this.foundPatternCross(w)&&null!==(ee=this.handlePossibleCenter(w,R,u)))return ee}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new qt},s.centerFromEnd=function(e,n){return n-e[2]-e[1]/2},s.prototype.foundPatternCross=function(e){for(var n=this.moduleSize,a=n/2,u=0;u<3;u++)if(Math.abs(n-e[u])>=a)return!1;return!0},s.prototype.crossCheckVertical=function(e,n,a,u){var p=this.image,w=p.getHeight(),E=this.crossCheckStateCount;E[0]=0,E[1]=0,E[2]=0;for(var I=e;I>=0&&p.get(n,I)&&E[1]<=a;)E[1]++,I--;if(I<0||E[1]>a)return NaN;for(;I>=0&&!p.get(n,I)&&E[0]<=a;)E[0]++,I--;if(E[0]>a)return NaN;for(I=e+1;I<w&&p.get(n,I)&&E[1]<=a;)E[1]++,I++;if(I===w||E[1]>a)return NaN;for(;I<w&&!p.get(n,I)&&E[2]<=a;)E[2]++,I++;return E[2]>a||5*Math.abs(E[0]+E[1]+E[2]-u)>=2*u?NaN:this.foundPatternCross(E)?s.centerFromEnd(E,I):NaN},s.prototype.handlePossibleCenter=function(e,n,a){var u,p,w=e[0]+e[1]+e[2],E=s.centerFromEnd(e,a),I=this.crossCheckVertical(n,E,2*e[1],w);if(!isNaN(I)){var R=(e[0]+e[1]+e[2])/3;try{for(var V=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.possibleCenters),W=V.next();!W.done;W=V.next()){var ee=W.value;if(ee.aboutEquals(R,I,E))return ee.combineEstimate(I,E,R)}}catch(Ce){u={error:Ce}}finally{try{W&&!W.done&&(p=V.return)&&p.call(V)}finally{if(u)throw u.error}}var oe=new $(E,I,R);this.possibleCenters.push(oe),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(oe)}return null},s}();const se=q;var _=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),i=function(s){function e(n,a,u,p){var w=s.call(this,n,a)||this;return w.estimatedModuleSize=u,w.count=p,void 0===p&&(w.count=1),w}return _(e,s),e.prototype.getEstimatedModuleSize=function(){return this.estimatedModuleSize},e.prototype.getCount=function(){return this.count},e.prototype.aboutEquals=function(n,a,u){if(Math.abs(a-this.getY())<=n&&Math.abs(u-this.getX())<=n){var p=Math.abs(n-this.estimatedModuleSize);return p<=1||p<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(n,a,u){var p=this.count+1;return new e((this.count*this.getX()+a)/p,(this.count*this.getY()+n)/p,(this.count*this.estimatedModuleSize+u)/p,p)},e}(Zn);const g=i;var y=function(){function s(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}return s.prototype.getBottomLeft=function(){return this.bottomLeft},s.prototype.getTopLeft=function(){return this.topLeft},s.prototype.getTopRight=function(){return this.topRight},s}();const A=y;var T=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},N=function(){function s(e,n){this.image=e,this.resultPointCallback=n,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=n}return s.prototype.getImage=function(){return this.image},s.prototype.getPossibleCenters=function(){return this.possibleCenters},s.prototype.find=function(e){var n=null!=e&&void 0!==e.get(Qn.TRY_HARDER),a=null!=e&&void 0!==e.get(Qn.PURE_BARCODE),u=this.image,p=u.getHeight(),w=u.getWidth(),E=Math.floor(3*p/(4*s.MAX_MODULES));(E<s.MIN_SKIP||n)&&(E=s.MIN_SKIP);for(var I=!1,R=new Int32Array(5),V=E-1;V<p&&!I;V+=E){R[0]=0,R[1]=0,R[2]=0,R[3]=0,R[4]=0;for(var W=0,ee=0;ee<w;ee++)if(u.get(ee,V))1==(1&W)&&W++,R[W]++;else if(1&W)R[W]++;else if(4===W)if(s.foundPatternCross(R)){if(!0!==this.handlePossibleCenter(R,V,ee,a)){R[0]=R[2],R[1]=R[3],R[2]=R[4],R[3]=1,R[4]=0,W=3;continue}if(E=2,!0===this.hasSkipped)I=this.haveMultiplyConfirmedCenters();else{var Ce=this.findRowSkip();Ce>R[2]&&(V+=Ce-R[2]-E,ee=w-1)}W=0,R[0]=0,R[1]=0,R[2]=0,R[3]=0,R[4]=0}else R[0]=R[2],R[1]=R[3],R[2]=R[4],R[3]=1,R[4]=0,W=3;else R[++W]++;s.foundPatternCross(R)&&!0===this.handlePossibleCenter(R,V,w,a)&&(E=R[0],this.hasSkipped&&(I=this.haveMultiplyConfirmedCenters()))}var Ne=this.selectBestPatterns();return Zn.orderBestPatterns(Ne),new A(Ne)},s.centerFromEnd=function(e,n){return n-e[4]-e[3]-e[2]/2},s.foundPatternCross=function(e){for(var n=0,a=0;a<5;a++){var u=e[a];if(0===u)return!1;n+=u}if(n<7)return!1;var p=n/7,w=p/2;return Math.abs(p-e[0])<w&&Math.abs(p-e[1])<w&&Math.abs(3*p-e[2])<3*w&&Math.abs(p-e[3])<w&&Math.abs(p-e[4])<w},s.prototype.getCrossCheckStateCount=function(){var e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e},s.prototype.crossCheckDiagonal=function(e,n,a,u){for(var p=this.getCrossCheckStateCount(),w=0,E=this.image;e>=w&&n>=w&&E.get(n-w,e-w);)p[2]++,w++;if(e<w||n<w)return!1;for(;e>=w&&n>=w&&!E.get(n-w,e-w)&&p[1]<=a;)p[1]++,w++;if(e<w||n<w||p[1]>a)return!1;for(;e>=w&&n>=w&&E.get(n-w,e-w)&&p[0]<=a;)p[0]++,w++;if(p[0]>a)return!1;var I=E.getHeight(),R=E.getWidth();for(w=1;e+w<I&&n+w<R&&E.get(n+w,e+w);)p[2]++,w++;if(e+w>=I||n+w>=R)return!1;for(;e+w<I&&n+w<R&&!E.get(n+w,e+w)&&p[3]<a;)p[3]++,w++;if(e+w>=I||n+w>=R||p[3]>=a)return!1;for(;e+w<I&&n+w<R&&E.get(n+w,e+w)&&p[4]<a;)p[4]++,w++;return!(p[4]>=a)&&Math.abs(p[0]+p[1]+p[2]+p[3]+p[4]-u)<2*u&&s.foundPatternCross(p)},s.prototype.crossCheckVertical=function(e,n,a,u){for(var p=this.image,w=p.getHeight(),E=this.getCrossCheckStateCount(),I=e;I>=0&&p.get(n,I);)E[2]++,I--;if(I<0)return NaN;for(;I>=0&&!p.get(n,I)&&E[1]<=a;)E[1]++,I--;if(I<0||E[1]>a)return NaN;for(;I>=0&&p.get(n,I)&&E[0]<=a;)E[0]++,I--;if(E[0]>a)return NaN;for(I=e+1;I<w&&p.get(n,I);)E[2]++,I++;if(I===w)return NaN;for(;I<w&&!p.get(n,I)&&E[3]<a;)E[3]++,I++;if(I===w||E[3]>=a)return NaN;for(;I<w&&p.get(n,I)&&E[4]<a;)E[4]++,I++;return E[4]>=a||5*Math.abs(E[0]+E[1]+E[2]+E[3]+E[4]-u)>=2*u?NaN:s.foundPatternCross(E)?s.centerFromEnd(E,I):NaN},s.prototype.crossCheckHorizontal=function(e,n,a,u){for(var p=this.image,w=p.getWidth(),E=this.getCrossCheckStateCount(),I=e;I>=0&&p.get(I,n);)E[2]++,I--;if(I<0)return NaN;for(;I>=0&&!p.get(I,n)&&E[1]<=a;)E[1]++,I--;if(I<0||E[1]>a)return NaN;for(;I>=0&&p.get(I,n)&&E[0]<=a;)E[0]++,I--;if(E[0]>a)return NaN;for(I=e+1;I<w&&p.get(I,n);)E[2]++,I++;if(I===w)return NaN;for(;I<w&&!p.get(I,n)&&E[3]<a;)E[3]++,I++;if(I===w||E[3]>=a)return NaN;for(;I<w&&p.get(I,n)&&E[4]<a;)E[4]++,I++;return E[4]>=a||5*Math.abs(E[0]+E[1]+E[2]+E[3]+E[4]-u)>=u?NaN:s.foundPatternCross(E)?s.centerFromEnd(E,I):NaN},s.prototype.handlePossibleCenter=function(e,n,a,u){var p=e[0]+e[1]+e[2]+e[3]+e[4],w=s.centerFromEnd(e,a),E=this.crossCheckVertical(n,Math.floor(w),e[2],p);if(!isNaN(E)&&(w=this.crossCheckHorizontal(Math.floor(w),Math.floor(E),e[2],p),!isNaN(w)&&(!u||this.crossCheckDiagonal(Math.floor(E),Math.floor(w),e[2],p)))){for(var I=p/7,R=!1,V=this.possibleCenters,W=0,ee=V.length;W<ee;W++){var oe=V[W];if(oe.aboutEquals(I,E,w)){V[W]=oe.combineEstimate(E,w,I),R=!0;break}}if(!R){var Ce=new g(w,E,I);V.push(Ce),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(Ce)}return!0}return!1},s.prototype.findRowSkip=function(){var e,n;if(this.possibleCenters.length<=1)return 0;var u=null;try{for(var p=T(this.possibleCenters),w=p.next();!w.done;w=p.next()){var E=w.value;if(E.getCount()>=s.CENTER_QUORUM){if(null!=u)return this.hasSkipped=!0,Math.floor((Math.abs(u.getX()-E.getX())-Math.abs(u.getY()-E.getY()))/2);u=E}}}catch(I){e={error:I}}finally{try{w&&!w.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}return 0},s.prototype.haveMultiplyConfirmedCenters=function(){var e,n,a,u,p=0,w=0,E=this.possibleCenters.length;try{for(var I=T(this.possibleCenters),R=I.next();!R.done;R=I.next())(V=R.value).getCount()>=s.CENTER_QUORUM&&(p++,w+=V.getEstimatedModuleSize())}catch(Ne){e={error:Ne}}finally{try{R&&!R.done&&(n=I.return)&&n.call(I)}finally{if(e)throw e.error}}if(p<3)return!1;var W=w/E,ee=0;try{for(var oe=T(this.possibleCenters),Ce=oe.next();!Ce.done;Ce=oe.next()){var V=Ce.value;ee+=Math.abs(V.getEstimatedModuleSize()-W)}}catch(Ne){a={error:Ne}}finally{try{Ce&&!Ce.done&&(u=oe.return)&&u.call(oe)}finally{if(a)throw a.error}}return ee<=.05*w},s.prototype.selectBestPatterns=function(){var e,n,a,u,p=this.possibleCenters.length;if(p<3)throw new qt;var E,w=this.possibleCenters;if(p>3){var I=0,R=0;try{for(var V=T(this.possibleCenters),W=V.next();!W.done;W=V.next()){var oe=W.value.getEstimatedModuleSize();I+=oe,R+=oe*oe}}catch(wn){e={error:wn}}finally{try{W&&!W.done&&(n=V.return)&&n.call(V)}finally{if(e)throw e.error}}E=I/p;var Ce=Math.sqrt(R/p-E*E);w.sort(function(wn,Un){var Xn=Math.abs(Un.getEstimatedModuleSize()-E),hr=Math.abs(wn.getEstimatedModuleSize()-E);return Xn<hr?-1:Xn>hr?1:0});for(var Ne=Math.max(.2*E,Ce),ot=0;ot<w.length&&w.length>3;ot++)Math.abs(w[ot].getEstimatedModuleSize()-E)>Ne&&(w.splice(ot,1),ot--)}if(w.length>3){I=0;try{for(var at=T(w),Pt=at.next();!Pt.done;Pt=at.next())I+=Pt.value.getEstimatedModuleSize()}catch(Un){a={error:Un}}finally{try{Pt&&!Pt.done&&(u=at.return)&&u.call(at)}finally{if(a)throw a.error}}E=I/w.length,w.sort(function(Un,Xn){if(Xn.getCount()===Un.getCount()){var hr=Math.abs(Xn.getEstimatedModuleSize()-E),Ei=Math.abs(Un.getEstimatedModuleSize()-E);return hr<Ei?1:hr>Ei?-1:0}return Xn.getCount()-Un.getCount()}),w.splice(3)}return[w[0],w[1],w[2]]},s.CENTER_QUORUM=2,s.MIN_SKIP=3,s.MAX_MODULES=57,s}();const k=N;var H=function(){function s(e){this.image=e}return s.prototype.getImage=function(){return this.image},s.prototype.getResultPointCallback=function(){return this.resultPointCallback},s.prototype.detect=function(e){this.resultPointCallback=null==e?null:e.get(Qn.NEED_RESULT_POINT_CALLBACK);var a=new k(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(a)},s.prototype.processFinderPatternInfo=function(e){var n=e.getTopLeft(),a=e.getTopRight(),u=e.getBottomLeft(),p=this.calculateModuleSize(n,a,u);if(p<1)throw new qt("No pattern found in proccess finder.");var w=s.computeDimension(n,a,u,p),E=ca.getProvisionalVersionForDimension(w),I=E.getDimensionForVersion()-7,R=null;if(E.getAlignmentPatternCenters().length>0)for(var V=a.getX()-n.getX()+u.getX(),W=a.getY()-n.getY()+u.getY(),ee=1-3/I,oe=Math.floor(n.getX()+ee*(V-n.getX())),Ce=Math.floor(n.getY()+ee*(W-n.getY())),Ne=4;Ne<=16;Ne<<=1)try{R=this.findAlignmentInRegion(p,oe,Ce,Ne);break}catch(Pt){if(!(Pt instanceof qt))throw Pt}var ot=s.createTransform(n,a,u,R,w),ut=s.sampleGrid(this.image,ot,w);return new Go(ut,null===R?[u,n,a]:[u,n,a,R])},s.createTransform=function(e,n,a,u,p){var E,I,R,V,w=p-3.5;return null!==u?(E=u.getX(),I=u.getY(),V=R=w-3):(E=n.getX()-e.getX()+a.getX(),I=n.getY()-e.getY()+a.getY(),R=w,V=w),fa.quadrilateralToQuadrilateral(3.5,3.5,w,3.5,R,V,3.5,w,e.getX(),e.getY(),n.getX(),n.getY(),E,I,a.getX(),a.getY())},s.sampleGrid=function(e,n,a){return ji.getInstance().sampleGridWithTransform(e,a,a,n)},s.computeDimension=function(e,n,a,u){var p=vr.round(Zn.distance(e,n)/u),w=vr.round(Zn.distance(e,a)/u),E=Math.floor((p+w)/2)+7;switch(3&E){case 0:E++;break;case 2:E--;break;case 3:throw new qt("Dimensions could be not found.")}return E},s.prototype.calculateModuleSize=function(e,n,a){return(this.calculateModuleSizeOneWay(e,n)+this.calculateModuleSizeOneWay(e,a))/2},s.prototype.calculateModuleSizeOneWay=function(e,n){var a=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(n.getX()),Math.floor(n.getY())),u=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(n.getX()),Math.floor(n.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(a)?u/7:isNaN(u)?a/7:(a+u)/14},s.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,n,a,u){var p=this.sizeOfBlackWhiteBlackRun(e,n,a,u),w=1,E=e-(a-e);E<0?(w=e/(e-E),E=0):E>=this.image.getWidth()&&(w=(this.image.getWidth()-1-e)/(E-e),E=this.image.getWidth()-1);var I=Math.floor(n-(u-n)*w);return w=1,I<0?(w=n/(n-I),I=0):I>=this.image.getHeight()&&(w=(this.image.getHeight()-1-n)/(I-n),I=this.image.getHeight()-1),E=Math.floor(e+(E-e)*w),(p+=this.sizeOfBlackWhiteBlackRun(e,n,E,I))-1},s.prototype.sizeOfBlackWhiteBlackRun=function(e,n,a,u){var p=Math.abs(u-n)>Math.abs(a-e);if(p){var w=e;e=n,n=w,w=a,a=u,u=w}for(var E=Math.abs(a-e),I=Math.abs(u-n),R=-E/2,V=e<a?1:-1,W=n<u?1:-1,ee=0,oe=a+V,Ce=e,Ne=n;Ce!==oe;Ce+=V){if(1===ee===this.image.get(p?Ne:Ce,p?Ce:Ne)){if(2===ee)return vr.distance(Ce,Ne,e,n);ee++}if((R+=I)>0){if(Ne===u)break;Ne+=W,R-=E}}return 2===ee?vr.distance(a+V,u,e,n):NaN},s.prototype.findAlignmentInRegion=function(e,n,a,u){var p=Math.floor(u*e),w=Math.max(0,n-p),E=Math.min(this.image.getWidth()-1,n+p);if(E-w<3*e)throw new qt("Alignment top exceeds estimated module size.");var I=Math.max(0,a-p),R=Math.min(this.image.getHeight()-1,a+p);if(R-I<3*e)throw new qt("Alignment bottom exceeds estimated module size.");return new se(this.image,w,I,E-w,R-I,e,this.resultPointCallback).find()},s}();const Q=H;var J=function(){function s(){this.decoder=new Gl}return s.prototype.getDecoder=function(){return this.decoder},s.prototype.decode=function(e,n){var a,u;if(null!=n&&void 0!==n.get(Qn.PURE_BARCODE)){var p=s.extractPureBits(e.getBlackMatrix());a=this.decoder.decodeBitMatrix(p,n),u=s.NO_POINTS}else{var w=new Q(e.getBlackMatrix()).detect(n);a=this.decoder.decodeBitMatrix(w.getBits(),n),u=w.getPoints()}a.getOther()instanceof kl&&a.getOther().applyMirroredCorrection(u);var E=new Ze(a.getText(),a.getRawBytes(),void 0,u,De.QR_CODE,void 0),I=a.getByteSegments();null!==I&&E.putMetadata(Tt.BYTE_SEGMENTS,I);var R=a.getECLevel();return null!==R&&E.putMetadata(Tt.ERROR_CORRECTION_LEVEL,R),a.hasStructuredAppend()&&(E.putMetadata(Tt.STRUCTURED_APPEND_SEQUENCE,a.getStructuredAppendSequenceNumber()),E.putMetadata(Tt.STRUCTURED_APPEND_PARITY,a.getStructuredAppendParity())),E},s.prototype.reset=function(){},s.extractPureBits=function(e){var n=e.getTopLeftOnBit(),a=e.getBottomRightOnBit();if(null===n||null===a)throw new qt;var u=this.moduleSize(n,e),p=n[1],w=a[1],E=n[0],I=a[0];if(E>=I||p>=w)throw new qt;if(w-p!=I-E&&(I=E+(w-p))>=e.getWidth())throw new qt;var R=Math.round((I-E+1)/u),V=Math.round((w-p+1)/u);if(R<=0||V<=0)throw new qt;if(V!==R)throw new qt;var W=Math.floor(u/2);p+=W;var ee=(E+=W)+Math.floor((R-1)*u)-I;if(ee>0){if(ee>W)throw new qt;E-=ee}var oe=p+Math.floor((V-1)*u)-w;if(oe>0){if(oe>W)throw new qt;p-=oe}for(var Ce=new ur(R,V),Ne=0;Ne<V;Ne++)for(var ot=p+Math.floor(Ne*u),ut=0;ut<R;ut++)e.get(E+Math.floor(ut*u),ot)&&Ce.set(ut,Ne);return Ce},s.moduleSize=function(e,n){for(var a=n.getHeight(),u=n.getWidth(),p=e[0],w=e[1],E=!0,I=0;p<u&&w<a;){if(E!==n.get(p,w)){if(5==++I)break;E=!E}p++,w++}if(p===u||w===a)throw new qt;return(p-e[0])/7},s.NO_POINTS=new Array,s}();const de=J;var Ae=function(){function s(){}return s.prototype.PDF417Common=function(){},s.getBitCountSum=function(e){return vr.sum(e)},s.toIntArray=function(e){var n,a;if(null==e||!e.length)return s.EMPTY_INT_ARRAY;var u=new Int32Array(e.length),p=0;try{for(var w=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),E=w.next();!E.done;E=w.next())u[p++]=E.value}catch(R){n={error:R}}finally{try{E&&!E.done&&(a=w.return)&&a.call(w)}finally{if(n)throw n.error}}return u},s.getCodeword=function(e){var n=Nt.binarySearch(s.SYMBOL_TABLE,262143&e);return n<0?-1:(s.CODEWORD_TABLE[n]-1)%s.NUMBER_OF_CODEWORDS},s.MAX_CODEWORDS_IN_BARCODE=(s.NUMBER_OF_CODEWORDS=929)-1,s.MIN_ROWS_IN_BARCODE=3,s.MAX_ROWS_IN_BARCODE=90,s.MODULES_IN_CODEWORD=17,s.MODULES_IN_STOP_PATTERN=18,s.BARS_IN_MODULE=8,s.EMPTY_INT_ARRAY=new Int32Array([]),s.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),s.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]),s}();const we=Ae;var Se=function(){function s(e,n){this.bits=e,this.points=n}return s.prototype.getBits=function(){return this.bits},s.prototype.getPoints=function(){return this.points},s}();const Me=Se;var he=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Te=function(){function s(){}return s.detectMultiple=function(e,n,a){var u=e.getBlackMatrix(),p=s.detect(a,u);return p.length||((u=u.clone()).rotate180(),p=s.detect(a,u)),new Me(u,p)},s.detect=function(e,n){for(var a,u,p=new Array,w=0,E=0,I=!1;w<n.getHeight();){var R=s.findVertices(n,w,E);if(null!=R[0]||null!=R[3]){if(I=!0,p.push(R),!e)break;null!=R[2]?(E=Math.trunc(R[2].getX()),w=Math.trunc(R[2].getY())):(E=Math.trunc(R[4].getX()),w=Math.trunc(R[4].getY()))}else{if(!I)break;I=!1,E=0;try{for(var V=(a=void 0,he(p)),W=V.next();!W.done;W=V.next()){var ee=W.value;null!=ee[1]&&(w=Math.trunc(Math.max(w,ee[1].getY()))),null!=ee[3]&&(w=Math.max(w,Math.trunc(ee[3].getY())))}}catch(oe){a={error:oe}}finally{try{W&&!W.done&&(u=V.return)&&u.call(V)}finally{if(a)throw a.error}}w+=s.ROW_STEP}}return p},s.findVertices=function(e,n,a){var u=e.getHeight(),p=e.getWidth(),w=new Array(8);return s.copyToResult(w,s.findRowsWithPattern(e,u,p,n,a,s.START_PATTERN),s.INDEXES_START_PATTERN),null!=w[4]&&(a=Math.trunc(w[4].getX()),n=Math.trunc(w[4].getY())),s.copyToResult(w,s.findRowsWithPattern(e,u,p,n,a,s.STOP_PATTERN),s.INDEXES_STOP_PATTERN),w},s.copyToResult=function(e,n,a){for(var u=0;u<a.length;u++)e[a[u]]=n[u]},s.findRowsWithPattern=function(e,n,a,u,p,w){for(var E=new Array(4),I=!1,R=new Int32Array(w.length);u<n;u+=s.ROW_STEP)if(null!=(V=s.findGuardPattern(e,p,u,a,!1,w,R))){for(;u>0;){if(null==(W=s.findGuardPattern(e,p,--u,a,!1,w,R))){u++;break}V=W}E[0]=new Zn(V[0],u),E[1]=new Zn(V[1],u),I=!0;break}var ee=u+1;if(I){for(var oe=0,W=Int32Array.from([Math.trunc(E[0].getX()),Math.trunc(E[1].getX())]);ee<n;ee++){var V;if(null!=(V=s.findGuardPattern(e,W[0],ee,a,!1,w,R))&&Math.abs(W[0]-V[0])<s.MAX_PATTERN_DRIFT&&Math.abs(W[1]-V[1])<s.MAX_PATTERN_DRIFT)W=V,oe=0;else{if(oe>s.SKIPPED_ROW_COUNT_MAX)break;oe++}}E[2]=new Zn(W[0],ee-=oe+1),E[3]=new Zn(W[1],ee)}return ee-u<s.BARCODE_MIN_HEIGHT&&Nt.fill(E,null),E},s.findGuardPattern=function(e,n,a,u,p,w,E){Nt.fillWithin(E,0,E.length,0);for(var I=n,R=0;e.get(I,a)&&I>0&&R++<s.MAX_PIXEL_DRIFT;)I--;for(var V=I,W=0,ee=w.length,oe=p;V<u;V++)if(e.get(V,a)!==oe)E[W]++;else{if(W===ee-1){if(s.patternMatchVariance(E,w,s.MAX_INDIVIDUAL_VARIANCE)<s.MAX_AVG_VARIANCE)return new Int32Array([I,V]);I+=E[0]+E[1],kn.arraycopy(E,2,E,0,W-1),E[W-1]=0,E[W]=0,W--}else W++;E[W]=1,oe=!oe}return W===ee-1&&s.patternMatchVariance(E,w,s.MAX_INDIVIDUAL_VARIANCE)<s.MAX_AVG_VARIANCE?new Int32Array([I,V-1]):null},s.patternMatchVariance=function(e,n,a){for(var u=e.length,p=0,w=0,E=0;E<u;E++)p+=e[E],w+=n[E];if(p<w)return 1/0;var I=p/w;a*=I;for(var R=0,V=0;V<u;V++){var W=e[V],ee=n[V]*I,oe=W>ee?W-ee:ee-W;if(oe>a)return 1/0;R+=oe}return R/p},s.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),s.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),s.MAX_AVG_VARIANCE=.42,s.MAX_INDIVIDUAL_VARIANCE=.8,s.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),s.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),s.MAX_PIXEL_DRIFT=3,s.MAX_PATTERN_DRIFT=5,s.SKIPPED_ROW_COUNT_MAX=25,s.ROW_STEP=5,s.BARCODE_MIN_HEIGHT=10,s}();const Be=Te;var tt=function(){function s(e,n){if(0===n.length)throw new Xt;this.field=e;var a=n.length;if(a>1&&0===n[0]){for(var u=1;u<a&&0===n[u];)u++;u===a?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(a-u),kn.arraycopy(n,u,this.coefficients,0,this.coefficients.length))}else this.coefficients=n}return s.prototype.getCoefficients=function(){return this.coefficients},s.prototype.getDegree=function(){return this.coefficients.length-1},s.prototype.isZero=function(){return 0===this.coefficients[0]},s.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},s.prototype.evaluateAt=function(e){var n,a;if(0===e)return this.getCoefficient(0);if(1===e){var u=0;try{for(var p=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.coefficients),w=p.next();!w.done;w=p.next())u=this.field.add(u,w.value)}catch(W){n={error:W}}finally{try{w&&!w.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return u}for(var I=this.coefficients[0],R=this.coefficients.length,V=1;V<R;V++)I=this.field.add(this.field.multiply(e,I),this.coefficients[V]);return I},s.prototype.add=function(e){if(!this.field.equals(e.field))throw new Xt("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;var n=this.coefficients,a=e.coefficients;if(n.length>a.length){var u=n;n=a,a=u}var p=new Int32Array(a.length),w=a.length-n.length;kn.arraycopy(a,0,p,0,w);for(var E=w;E<a.length;E++)p[E]=this.field.add(n[E-w],a[E]);return new s(this.field,p)},s.prototype.subtract=function(e){if(!this.field.equals(e.field))throw new Xt("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())},s.prototype.multiply=function(e){return e instanceof s?this.multiplyOther(e):this.multiplyScalar(e)},s.prototype.multiplyOther=function(e){if(!this.field.equals(e.field))throw new Xt("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new s(this.field,new Int32Array([0]));for(var n=this.coefficients,a=n.length,u=e.coefficients,p=u.length,w=new Int32Array(a+p-1),E=0;E<a;E++)for(var I=n[E],R=0;R<p;R++)w[E+R]=this.field.add(w[E+R],this.field.multiply(I,u[R]));return new s(this.field,w)},s.prototype.negative=function(){for(var e=this.coefficients.length,n=new Int32Array(e),a=0;a<e;a++)n[a]=this.field.subtract(0,this.coefficients[a]);return new s(this.field,n)},s.prototype.multiplyScalar=function(e){if(0===e)return new s(this.field,new Int32Array([0]));if(1===e)return this;for(var n=this.coefficients.length,a=new Int32Array(n),u=0;u<n;u++)a[u]=this.field.multiply(this.coefficients[u],e);return new s(this.field,a)},s.prototype.multiplyByMonomial=function(e,n){if(e<0)throw new Xt;if(0===n)return new s(this.field,new Int32Array([0]));for(var a=this.coefficients.length,u=new Int32Array(a+e),p=0;p<a;p++)u[p]=this.field.multiply(this.coefficients[p],n);return new s(this.field,u)},s.prototype.toString=function(){for(var e=new _r,n=this.getDegree();n>=0;n--){var a=this.getCoefficient(n);0!==a&&(a<0?(e.append(" - "),a=-a):e.length()>0&&e.append(" + "),(0===n||1!==a)&&e.append(a),0!==n&&(1===n?e.append("x"):(e.append("x^"),e.append(n))))}return e.toString()},s}();const Qe=tt;var nt=function(){function s(){}return s.prototype.add=function(e,n){return(e+n)%this.modulus},s.prototype.subtract=function(e,n){return(this.modulus+e-n)%this.modulus},s.prototype.exp=function(e){return this.expTable[e]},s.prototype.log=function(e){if(0===e)throw new Xt;return this.logTable[e]},s.prototype.inverse=function(e){if(0===e)throw new Je;return this.expTable[this.modulus-this.logTable[e]-1]},s.prototype.multiply=function(e,n){return 0===e||0===n?0:this.expTable[(this.logTable[e]+this.logTable[n])%(this.modulus-1)]},s.prototype.getSize=function(){return this.modulus},s.prototype.equals=function(e){return e===this},s}();const vt=nt;var pt=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Lt=function(s){function e(n,a){var u=s.call(this)||this;u.modulus=n,u.expTable=new Int32Array(n),u.logTable=new Int32Array(n);for(var p=1,w=0;w<n;w++)u.expTable[w]=p,p=p*a%n;for(w=0;w<n-1;w++)u.logTable[u.expTable[w]]=w;return u.zero=new Qe(u,new Int32Array([0])),u.one=new Qe(u,new Int32Array([1])),u}return pt(e,s),e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(n,a){if(n<0)throw new Xt;if(0===a)return this.zero;var u=new Int32Array(n+1);return u[0]=a,new Qe(this,u)},e.PDF417_GF=new e(we.NUMBER_OF_CODEWORDS,3),e}(vt);const En=Lt;var sn=function(){function s(){this.field=En.PDF417_GF}return s.prototype.decode=function(e,n,a){for(var u,p,w=new Qe(this.field,e),E=new Int32Array(n),I=!1,R=n;R>0;R--){var V=w.evaluateAt(this.field.exp(R));E[n-R]=V,0!==V&&(I=!0)}if(!I)return 0;var W=this.field.getOne();if(null!=a)try{for(var ee=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),oe=ee.next();!oe.done;oe=ee.next()){var Ne=this.field.exp(e.length-1-oe.value),ot=new Qe(this.field,new Int32Array([this.field.subtract(0,Ne),1]));W=W.multiply(ot)}}catch(hr){u={error:hr}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}var ut=new Qe(this.field,E),at=this.runEuclideanAlgorithm(this.field.buildMonomial(n,1),ut,n),Pt=at[0],Wt=at[1],wn=this.findErrorLocations(Pt),Un=this.findErrorMagnitudes(Wt,Pt,wn);for(R=0;R<wn.length;R++){var Xn=e.length-1-this.field.log(wn[R]);if(Xn<0)throw Wn.getChecksumInstance();e[Xn]=this.field.subtract(e[Xn],Un[R])}return wn.length},s.prototype.runEuclideanAlgorithm=function(e,n,a){if(e.getDegree()<n.getDegree()){var u=e;e=n,n=u}for(var p=e,w=n,E=this.field.getZero(),I=this.field.getOne();w.getDegree()>=Math.round(a/2);){var R=p,V=E;if(E=I,(p=w).isZero())throw Wn.getChecksumInstance();w=R;for(var W=this.field.getZero(),ee=p.getCoefficient(p.getDegree()),oe=this.field.inverse(ee);w.getDegree()>=p.getDegree()&&!w.isZero();){var Ce=w.getDegree()-p.getDegree(),Ne=this.field.multiply(w.getCoefficient(w.getDegree()),oe);W=W.add(this.field.buildMonomial(Ce,Ne)),w=w.subtract(p.multiplyByMonomial(Ce,Ne))}I=W.multiply(E).subtract(V).negative()}var ot=I.getCoefficient(0);if(0===ot)throw Wn.getChecksumInstance();var ut=this.field.inverse(ot);return[I.multiply(ut),w.multiply(ut)]},s.prototype.findErrorLocations=function(e){for(var n=e.getDegree(),a=new Int32Array(n),u=0,p=1;p<this.field.getSize()&&u<n;p++)0===e.evaluateAt(p)&&(a[u]=this.field.inverse(p),u++);if(u!==n)throw Wn.getChecksumInstance();return a},s.prototype.findErrorMagnitudes=function(e,n,a){for(var u=n.getDegree(),p=new Int32Array(u),w=1;w<=u;w++)p[u-w]=this.field.multiply(w,n.getCoefficient(w));var E=new Qe(this.field,p),I=a.length,R=new Int32Array(I);for(w=0;w<I;w++){var V=this.field.inverse(a[w]),W=this.field.subtract(0,e.evaluateAt(V)),ee=this.field.inverse(E.evaluateAt(V));R[w]=this.field.multiply(W,ee)}return R},s}();const jt=sn;var yn=function(){function s(e,n,a,u,p){e instanceof s?this.constructor_2(e):this.constructor_1(e,n,a,u,p)}return s.prototype.constructor_1=function(e,n,a,u,p){var w=null==n||null==a,E=null==u||null==p;if(w&&E)throw new qt;w?(n=new Zn(0,u.getY()),a=new Zn(0,p.getY())):E&&(u=new Zn(e.getWidth()-1,n.getY()),p=new Zn(e.getWidth()-1,a.getY())),this.image=e,this.topLeft=n,this.bottomLeft=a,this.topRight=u,this.bottomRight=p,this.minX=Math.trunc(Math.min(n.getX(),a.getX())),this.maxX=Math.trunc(Math.max(u.getX(),p.getX())),this.minY=Math.trunc(Math.min(n.getY(),u.getY())),this.maxY=Math.trunc(Math.max(a.getY(),p.getY()))},s.prototype.constructor_2=function(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()},s.merge=function(e,n){return null==e?n:null==n?e:new s(e.image,e.topLeft,e.bottomLeft,n.topRight,n.bottomRight)},s.prototype.addMissingRows=function(e,n,a){var u=this.topLeft,p=this.bottomLeft,w=this.topRight,E=this.bottomRight;if(e>0){var I=a?this.topLeft:this.topRight,R=Math.trunc(I.getY()-e);R<0&&(R=0);var V=new Zn(I.getX(),R);a?u=V:w=V}if(n>0){var W=a?this.bottomLeft:this.bottomRight,ee=Math.trunc(W.getY()+n);ee>=this.image.getHeight()&&(ee=this.image.getHeight()-1);var oe=new Zn(W.getX(),ee);a?p=oe:E=oe}return new s(this.image,u,p,w,E)},s.prototype.getMinX=function(){return this.minX},s.prototype.getMaxX=function(){return this.maxX},s.prototype.getMinY=function(){return this.minY},s.prototype.getMaxY=function(){return this.maxY},s.prototype.getTopLeft=function(){return this.topLeft},s.prototype.getTopRight=function(){return this.topRight},s.prototype.getBottomLeft=function(){return this.bottomLeft},s.prototype.getBottomRight=function(){return this.bottomRight},s}();const It=yn;var on=function(){function s(e,n,a,u){this.columnCount=e,this.errorCorrectionLevel=u,this.rowCountUpperPart=n,this.rowCountLowerPart=a,this.rowCount=n+a}return s.prototype.getColumnCount=function(){return this.columnCount},s.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},s.prototype.getRowCount=function(){return this.rowCount},s.prototype.getRowCountUpperPart=function(){return this.rowCountUpperPart},s.prototype.getRowCountLowerPart=function(){return this.rowCountLowerPart},s}();const Cn=on;var gn=function(){function s(){this.buffer=""}return s.form=function(e,n){var a=-1;return e.replace(/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g,function u(w,E,I,R,V,W){if("%%"===w)return"%";if(void 0!==n[++a]){w=R?parseInt(R.substr(1)):void 0;var oe,ee=V?parseInt(V.substr(1)):void 0;switch(W){case"s":oe=n[a];break;case"c":oe=n[a][0];break;case"f":oe=parseFloat(n[a]).toFixed(w);break;case"p":oe=parseFloat(n[a]).toPrecision(w);break;case"e":oe=parseFloat(n[a]).toExponential(w);break;case"x":oe=parseInt(n[a]).toString(ee||16);break;case"d":oe=parseFloat(parseInt(n[a],ee||10).toPrecision(w)).toFixed(0)}oe="object"==typeof oe?JSON.stringify(oe):(+oe).toString(ee);for(var Ce=parseInt(I),Ne=I&&I[0]+""=="0"?"0":" ";oe.length<Ce;)oe=void 0!==E?oe+Ne:Ne+oe;return oe}})},s.prototype.format=function(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];this.buffer+=s.form(e,n)},s.prototype.toString=function(){return this.buffer},s}();const An=gn;var Kr=function(){function s(e){this.boundingBox=new It(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}return s.prototype.getCodewordNearby=function(e){var n=this.getCodeword(e);if(null!=n)return n;for(var a=1;a<s.MAX_NEARBY_DISTANCE;a++){var u=this.imageRowToCodewordIndex(e)-a;if(u>=0&&null!=(n=this.codewords[u])||(u=this.imageRowToCodewordIndex(e)+a)<this.codewords.length&&null!=(n=this.codewords[u]))return n}return null},s.prototype.imageRowToCodewordIndex=function(e){return e-this.boundingBox.getMinY()},s.prototype.setCodeword=function(e,n){this.codewords[this.imageRowToCodewordIndex(e)]=n},s.prototype.getCodeword=function(e){return this.codewords[this.imageRowToCodewordIndex(e)]},s.prototype.getBoundingBox=function(){return this.boundingBox},s.prototype.getCodewords=function(){return this.codewords},s.prototype.toString=function(){var e,n,a=new An,u=0;try{for(var p=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.codewords),w=p.next();!w.done;w=p.next()){var E=w.value;null!=E?a.format("%3d: %3d|%3d%n",u++,E.getRowNumber(),E.getValue()):a.format("%3d:    |   %n",u++)}}catch(I){e={error:I}}finally{try{w&&!w.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}return a.toString()},s.MAX_NEARBY_DISTANCE=5,s}();const sr=Kr;var _i=function(s,e){var n="function"==typeof Symbol&&s[Symbol.iterator];if(!n)return s;var u,w,a=n.call(s),p=[];try{for(;(void 0===e||e-- >0)&&!(u=a.next()).done;)p.push(u.value)}catch(E){w={error:E}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(w)throw w.error}}return p},oi=function(){function s(){this.values=new Map}return s.prototype.setValue=function(e){e=Math.trunc(e);var n=this.values.get(e);null==n&&(n=0),n++,this.values.set(e,n)},s.prototype.getValue=function(){var e,n,a=-1,u=new Array,p=function(W,ee){var oe_getKey=function(){return W},oe_getValue=function(){return ee};oe_getValue()>a?(a=oe_getValue(),(u=[]).push(oe_getKey())):oe_getValue()===a&&u.push(oe_getKey())};try{for(var w=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.values.entries()),E=w.next();!E.done;E=w.next()){var I=_i(E.value,2);p(I[0],I[1])}}catch(W){e={error:W}}finally{try{E&&!E.done&&(n=w.return)&&n.call(w)}finally{if(e)throw e.error}}return we.toIntArray(u)},s.prototype.getConfidence=function(e){return this.values.get(e)},s}();const dr=oi;var Gi=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),oo=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},uo=function(s){function e(n,a){var u=s.call(this,n)||this;return u._isLeft=a,u}return Gi(e,s),e.prototype.setRowNumbers=function(){var n,a;try{for(var u=oo(this.getCodewords()),p=u.next();!p.done;p=u.next()){var w=p.value;w?.setRowNumberAsRowIndicatorColumn()}}catch(E){n={error:E}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}},e.prototype.adjustCompleteIndicatorColumnRowNumbers=function(n){var a=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(a,n);for(var u=this.getBoundingBox(),p=this._isLeft?u.getTopLeft():u.getTopRight(),w=this._isLeft?u.getBottomLeft():u.getBottomRight(),E=this.imageRowToCodewordIndex(Math.trunc(p.getY())),I=this.imageRowToCodewordIndex(Math.trunc(w.getY())),R=-1,V=1,W=0,ee=E;ee<I;ee++)if(null!=a[ee]){var oe=a[ee],Ce=oe.getRowNumber()-R;if(0===Ce)W++;else if(1===Ce)V=Math.max(V,W),W=1,R=oe.getRowNumber();else if(Ce<0||oe.getRowNumber()>=n.getRowCount()||Ce>ee)a[ee]=null;else{for(var Ne,ot=(Ne=V>2?(V-2)*Ce:Ce)>=ee,ut=1;ut<=Ne&&!ot;ut++)ot=null!=a[ee-ut];ot?a[ee]=null:(R=oe.getRowNumber(),W=1)}}},e.prototype.getRowHeights=function(){var n,a,u=this.getBarcodeMetadata();if(null==u)return null;this.adjustIncompleteIndicatorColumnRowNumbers(u);var p=new Int32Array(u.getRowCount());try{for(var w=oo(this.getCodewords()),E=w.next();!E.done;E=w.next()){var I=E.value;if(null!=I){var R=I.getRowNumber();if(R>=p.length)continue;p[R]++}}}catch(V){n={error:V}}finally{try{E&&!E.done&&(a=w.return)&&a.call(w)}finally{if(n)throw n.error}}return p},e.prototype.adjustIncompleteIndicatorColumnRowNumbers=function(n){for(var a=this.getBoundingBox(),u=this._isLeft?a.getTopLeft():a.getTopRight(),p=this._isLeft?a.getBottomLeft():a.getBottomRight(),w=this.imageRowToCodewordIndex(Math.trunc(u.getY())),E=this.imageRowToCodewordIndex(Math.trunc(p.getY())),I=this.getCodewords(),R=-1,V=1,W=0,ee=w;ee<E;ee++)if(null!=I[ee]){var oe=I[ee];oe.setRowNumberAsRowIndicatorColumn();var Ce=oe.getRowNumber()-R;0===Ce?W++:1===Ce?(V=Math.max(V,W),W=1,R=oe.getRowNumber()):oe.getRowNumber()>=n.getRowCount()?I[ee]=null:(R=oe.getRowNumber(),W=1)}},e.prototype.getBarcodeMetadata=function(){var n,a,u=this.getCodewords(),p=new dr,w=new dr,E=new dr,I=new dr;try{for(var R=oo(u),V=R.next();!V.done;V=R.next()){var W=V.value;if(null!=W){W.setRowNumberAsRowIndicatorColumn();var ee=W.getValue()%30,oe=W.getRowNumber();switch(this._isLeft||(oe+=2),oe%3){case 0:w.setValue(3*ee+1);break;case 1:I.setValue(ee/3),E.setValue(ee%3);break;case 2:p.setValue(ee+1)}}}}catch(Ne){n={error:Ne}}finally{try{V&&!V.done&&(a=R.return)&&a.call(R)}finally{if(n)throw n.error}}if(0===p.getValue().length||0===w.getValue().length||0===E.getValue().length||0===I.getValue().length||p.getValue()[0]<1||w.getValue()[0]+E.getValue()[0]<we.MIN_ROWS_IN_BARCODE||w.getValue()[0]+E.getValue()[0]>we.MAX_ROWS_IN_BARCODE)return null;var Ce=new Cn(p.getValue()[0],w.getValue()[0],E.getValue()[0],I.getValue()[0]);return this.removeIncorrectCodewords(u,Ce),Ce},e.prototype.removeIncorrectCodewords=function(n,a){for(var u=0;u<n.length;u++){var p=n[u];if(null!=n[u]){var w=p.getValue()%30,E=p.getRowNumber();if(E>a.getRowCount()){n[u]=null;continue}switch(this._isLeft||(E+=2),E%3){case 0:3*w+1!==a.getRowCountUpperPart()&&(n[u]=null);break;case 1:(Math.trunc(w/3)!==a.getErrorCorrectionLevel()||w%3!==a.getRowCountLowerPart())&&(n[u]=null);break;case 2:w+1!==a.getColumnCount()&&(n[u]=null)}}}},e.prototype.isLeft=function(){return this._isLeft},e.prototype.toString=function(){return"IsLeft: "+this._isLeft+"\n"+s.prototype.toString.call(this)},e}(sr);const To=uo;var ua=function(){function s(e,n){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=n,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}return s.prototype.getDetectionResultColumns=function(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);var n,e=we.MAX_CODEWORDS_IN_BARCODE;do{n=e,e=this.adjustRowNumbersAndGetCount()}while(e>0&&e<n);return this.detectionResultColumns},s.prototype.adjustIndicatorColumnRowNumbers=function(e){e?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)},s.prototype.adjustRowNumbersAndGetCount=function(){var e=this.adjustRowNumbersByRow();if(0===e)return 0;for(var n=1;n<this.barcodeColumnCount+1;n++)for(var a=this.detectionResultColumns[n].getCodewords(),u=0;u<a.length;u++)null!=a[u]&&(a[u].hasValidRowNumber()||this.adjustRowNumbers(n,u,a));return e},s.prototype.adjustRowNumbersByRow=function(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()},s.prototype.adjustRowNumbersFromBothRI=function(){if(null!=this.detectionResultColumns[0]&&null!=this.detectionResultColumns[this.barcodeColumnCount+1])for(var e=this.detectionResultColumns[0].getCodewords(),n=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),a=0;a<e.length;a++)if(null!=e[a]&&null!=n[a]&&e[a].getRowNumber()===n[a].getRowNumber())for(var u=1;u<=this.barcodeColumnCount;u++){var p=this.detectionResultColumns[u].getCodewords()[a];null!=p&&(p.setRowNumber(e[a].getRowNumber()),p.hasValidRowNumber()||(this.detectionResultColumns[u].getCodewords()[a]=null))}},s.prototype.adjustRowNumbersFromRRI=function(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;for(var e=0,n=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),a=0;a<n.length;a++)if(null!=n[a])for(var u=n[a].getRowNumber(),p=0,w=this.barcodeColumnCount+1;w>0&&p<this.ADJUST_ROW_NUMBER_SKIP;w--){var E=this.detectionResultColumns[w].getCodewords()[a];null!=E&&(p=s.adjustRowNumberIfValid(u,p,E),E.hasValidRowNumber()||e++)}return e},s.prototype.adjustRowNumbersFromLRI=function(){if(null==this.detectionResultColumns[0])return 0;for(var e=0,n=this.detectionResultColumns[0].getCodewords(),a=0;a<n.length;a++)if(null!=n[a])for(var u=n[a].getRowNumber(),p=0,w=1;w<this.barcodeColumnCount+1&&p<this.ADJUST_ROW_NUMBER_SKIP;w++){var E=this.detectionResultColumns[w].getCodewords()[a];null!=E&&(p=s.adjustRowNumberIfValid(u,p,E),E.hasValidRowNumber()||e++)}return e},s.adjustRowNumberIfValid=function(e,n,a){return null==a||a.hasValidRowNumber()||(a.isValidRowNumber(e)?(a.setRowNumber(e),n=0):++n),n},s.prototype.adjustRowNumbers=function(e,n,a){var u,p;if(null!=this.detectionResultColumns[e-1]){var w=a[n],E=this.detectionResultColumns[e-1].getCodewords(),I=E;null!=this.detectionResultColumns[e+1]&&(I=this.detectionResultColumns[e+1].getCodewords());var R=new Array(14);R[2]=E[n],R[3]=I[n],n>0&&(R[0]=a[n-1],R[4]=E[n-1],R[5]=I[n-1]),n>1&&(R[8]=a[n-2],R[10]=E[n-2],R[11]=I[n-2]),n<a.length-1&&(R[1]=a[n+1],R[6]=E[n+1],R[7]=I[n+1]),n<a.length-2&&(R[9]=a[n+2],R[12]=E[n+2],R[13]=I[n+2]);try{for(var V=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(R),W=V.next();!W.done;W=V.next())if(s.adjustRowNumber(w,W.value))return}catch(oe){u={error:oe}}finally{try{W&&!W.done&&(p=V.return)&&p.call(V)}finally{if(u)throw u.error}}}},s.adjustRowNumber=function(e,n){return!(null==n||!n.hasValidRowNumber()||n.getBucket()!==e.getBucket()||(e.setRowNumber(n.getRowNumber()),0))},s.prototype.getBarcodeColumnCount=function(){return this.barcodeColumnCount},s.prototype.getBarcodeRowCount=function(){return this.barcodeMetadata.getRowCount()},s.prototype.getBarcodeECLevel=function(){return this.barcodeMetadata.getErrorCorrectionLevel()},s.prototype.setBoundingBox=function(e){this.boundingBox=e},s.prototype.getBoundingBox=function(){return this.boundingBox},s.prototype.setDetectionResultColumn=function(e,n){this.detectionResultColumns[e]=n},s.prototype.getDetectionResultColumn=function(e){return this.detectionResultColumns[e]},s.prototype.toString=function(){var e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);for(var n=new An,a=0;a<e.getCodewords().length;a++){n.format("CW %3d:",a);for(var u=0;u<this.barcodeColumnCount+2;u++)if(null!=this.detectionResultColumns[u]){var p=this.detectionResultColumns[u].getCodewords()[a];null!=p?n.format(" %3d|%3d",p.getRowNumber(),p.getValue()):n.format("    |   ")}else n.format("    |   ");n.format("%n")}return n.toString()},s}();const Fl=ua;var da=function(){function s(e,n,a,u){this.rowNumber=s.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(n),this.bucket=Math.trunc(a),this.value=Math.trunc(u)}return s.prototype.hasValidRowNumber=function(){return this.isValidRowNumber(this.rowNumber)},s.prototype.isValidRowNumber=function(e){return e!==s.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3},s.prototype.setRowNumberAsRowIndicatorColumn=function(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))},s.prototype.getWidth=function(){return this.endX-this.startX},s.prototype.getStartX=function(){return this.startX},s.prototype.getEndX=function(){return this.endX},s.prototype.getBucket=function(){return this.bucket},s.prototype.getValue=function(){return this.value},s.prototype.getRowNumber=function(){return this.rowNumber},s.prototype.setRowNumber=function(e){this.rowNumber=e},s.prototype.toString=function(){return this.rowNumber+"|"+this.value},s.BARCODE_ROW_UNKNOWN=-1,s}();const rs=da;var ho=function(){function s(){}return s.initialize=function(){for(var e=0;e<we.SYMBOL_TABLE.length;e++)for(var n=we.SYMBOL_TABLE[e],a=1&n,u=0;u<we.BARS_IN_MODULE;u++){for(var p=0;(1&n)===a;)p+=1,n>>=1;a=1&n,s.RATIOS_TABLE[e]||(s.RATIOS_TABLE[e]=new Array(we.BARS_IN_MODULE)),s.RATIOS_TABLE[e][we.BARS_IN_MODULE-u-1]=Math.fround(p/we.MODULES_IN_CODEWORD)}this.bSymbolTableReady=!0},s.getDecodedValue=function(e){var n=s.getDecodedCodewordValue(s.sampleBitCounts(e));return-1!==n?n:s.getClosestDecodedValue(e)},s.sampleBitCounts=function(e){for(var n=vr.sum(e),a=new Int32Array(we.BARS_IN_MODULE),u=0,p=0,w=0;w<we.MODULES_IN_CODEWORD;w++)p+e[u]<=n/(2*we.MODULES_IN_CODEWORD)+w*n/we.MODULES_IN_CODEWORD&&(p+=e[u],u++),a[u]++;return a},s.getDecodedCodewordValue=function(e){var n=s.getBitValue(e);return-1===we.getCodeword(n)?-1:n},s.getBitValue=function(e){for(var n=0,a=0;a<e.length;a++)for(var u=0;u<e[a];u++)n=n<<1|(a%2==0?1:0);return Math.trunc(n)},s.getClosestDecodedValue=function(e){var n=vr.sum(e),a=new Array(we.BARS_IN_MODULE);if(n>1)for(var u=0;u<a.length;u++)a[u]=Math.fround(e[u]/n);var p=ai.MAX_VALUE,w=-1;this.bSymbolTableReady||s.initialize();for(var E=0;E<s.RATIOS_TABLE.length;E++){for(var I=0,R=s.RATIOS_TABLE[E],V=0;V<we.BARS_IN_MODULE;V++){var W=Math.fround(R[V]-a[V]);if((I+=Math.fround(W*W))>=p)break}I<p&&(p=I,w=we.SYMBOL_TABLE[E])}return w},s.bSymbolTableReady=!1,s.RATIOS_TABLE=new Array(we.SYMBOL_TABLE.length).map(function(e){return new Array(we.BARS_IN_MODULE)}),s}();const $i=ho;var Ps=function(){function s(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}return s.prototype.getSegmentIndex=function(){return this.segmentIndex},s.prototype.setSegmentIndex=function(e){this.segmentIndex=e},s.prototype.getFileId=function(){return this.fileId},s.prototype.setFileId=function(e){this.fileId=e},s.prototype.getOptionalData=function(){return this.optionalData},s.prototype.setOptionalData=function(e){this.optionalData=e},s.prototype.isLastSegment=function(){return this.lastSegment},s.prototype.setLastSegment=function(e){this.lastSegment=e},s.prototype.getSegmentCount=function(){return this.segmentCount},s.prototype.setSegmentCount=function(e){this.segmentCount=e},s.prototype.getSender=function(){return this.sender||null},s.prototype.setSender=function(e){this.sender=e},s.prototype.getAddressee=function(){return this.addressee||null},s.prototype.setAddressee=function(e){this.addressee=e},s.prototype.getFileName=function(){return this.fileName},s.prototype.setFileName=function(e){this.fileName=e},s.prototype.getFileSize=function(){return this.fileSize},s.prototype.setFileSize=function(e){this.fileSize=e},s.prototype.getChecksum=function(){return this.checksum},s.prototype.setChecksum=function(e){this.checksum=e},s.prototype.getTimestamp=function(){return this.timestamp},s.prototype.setTimestamp=function(e){this.timestamp=e},s}();const va=Ps;var Po=function(){function s(){}return s.parseLong=function(e,n){return void 0===n&&(n=void 0),parseInt(e,n)},s}();const ol=Po;var Nu=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Tc=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Nu(e,s),e.kind="NullPointerException",e}(Bt);const gu=Tc;var Ql=function(){function s(){}return s.prototype.writeBytes=function(e){this.writeBytesOffset(e,0,e.length)},s.prototype.writeBytesOffset=function(e,n,a){if(null==e)throw new gu;if(n<0||n>e.length||a<0||n+a>e.length||n+a<0)throw new xr;if(0!==a)for(var u=0;u<a;u++)this.write(e[n+u])},s.prototype.flush=function(){},s.prototype.close=function(){},s}();const Sc=Ql;var ec=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),tc=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return ec(e,s),e}(Bt);const ku=tc;var gd=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),vf=function(s){function e(n){void 0===n&&(n=32);var a=s.call(this)||this;if(a.count=0,n<0)throw new Xt("Negative initial size: "+n);return a.buf=new Uint8Array(n),a}return gd(e,s),e.prototype.ensureCapacity=function(n){n-this.buf.length>0&&this.grow(n)},e.prototype.grow=function(n){var u=this.buf.length<<1;if(u-n<0&&(u=n),u<0){if(n<0)throw new ku;u=mt.MAX_VALUE}this.buf=Nt.copyOfUint8Array(this.buf,u)},e.prototype.write=function(n){this.ensureCapacity(this.count+1),this.buf[this.count]=n,this.count+=1},e.prototype.writeBytesOffset=function(n,a,u){if(a<0||a>n.length||u<0||a+u-n.length>0)throw new xr;this.ensureCapacity(this.count+u),kn.arraycopy(n,a,this.buf,this.count,u),this.count+=u},e.prototype.writeTo=function(n){n.writeBytesOffset(this.buf,0,this.count)},e.prototype.reset=function(){this.count=0},e.prototype.toByteArray=function(){return Nt.copyOfUint8Array(this.buf,this.count)},e.prototype.size=function(){return this.count},e.prototype.toString=function(n){return n?"string"==typeof n?this.toString_string(n):this.toString_number(n):this.toString_void()},e.prototype.toString_void=function(){return new String(this.buf).toString()},e.prototype.toString_string=function(n){return new String(this.buf).toString()},e.prototype.toString_number=function(n){return new String(this.buf).toString()},e.prototype.close=function(){},e}(Sc);const md=vf;var Fu,fs=function(s){return s[s.ALPHA=0]="ALPHA",s[s.LOWER=1]="LOWER",s[s.MIXED=2]="MIXED",s[s.PUNCT=3]="PUNCT",s[s.ALPHA_SHIFT=4]="ALPHA_SHIFT",s[s.PUNCT_SHIFT=5]="PUNCT_SHIFT",s}(fs||{});function Ga(){if(typeof window<"u")return window.BigInt||null;if(typeof global<"u")return global.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}function Ic(s){if(typeof Fu>"u"&&(Fu=Ga()),null===Fu)throw new Error("BigInt is not supported!");return Fu(s)}var Sh=function(){function s(){}return s.decode=function(e,n){var a=new _r(""),u=vi.ISO8859_1;a.enableDecoding(u);for(var p=1,w=e[p++],E=new va;p<e[0];){switch(w){case s.TEXT_COMPACTION_MODE_LATCH:p=s.textCompaction(e,p,a);break;case s.BYTE_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH_6:p=s.byteCompaction(w,e,u,p,a);break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(e[p++]);break;case s.NUMERIC_COMPACTION_MODE_LATCH:p=s.numericCompaction(e,p,a);break;case s.ECI_CHARSET:vi.getCharacterSetECIByValue(e[p++]);break;case s.ECI_GENERAL_PURPOSE:p+=2;break;case s.ECI_USER_DEFINED:p++;break;case s.BEGIN_MACRO_PDF417_CONTROL_BLOCK:p=s.decodeMacroBlock(e,p,E);break;case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case s.MACRO_PDF417_TERMINATOR:throw new nn;default:p--,p=s.textCompaction(e,p,a)}if(!(p<e.length))throw nn.getFormatInstance();w=e[p++]}if(0===a.length())throw nn.getFormatInstance();var R=new Bn(null,a.toString(),null,n);return R.setOther(E),R},s.decodeMacroBlock=function(e,n,a){if(n+s.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw nn.getFormatInstance();for(var u=new Int32Array(s.NUMBER_OF_SEQUENCE_CODEWORDS),p=0;p<s.NUMBER_OF_SEQUENCE_CODEWORDS;p++,n++)u[p]=e[n];a.setSegmentIndex(mt.parseInt(s.decodeBase900toBase10(u,s.NUMBER_OF_SEQUENCE_CODEWORDS)));var w=new _r;n=s.textCompaction(e,n,w),a.setFileId(w.toString());var E=-1;for(e[n]===s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(E=n+1);n<e[0];)switch(e[n]){case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++n]){case s.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var I=new _r;n=s.textCompaction(e,n+1,I),a.setFileName(I.toString());break;case s.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var R=new _r;n=s.textCompaction(e,n+1,R),a.setSender(R.toString());break;case s.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var V=new _r;n=s.textCompaction(e,n+1,V),a.setAddressee(V.toString());break;case s.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var W=new _r;n=s.numericCompaction(e,n+1,W),a.setSegmentCount(mt.parseInt(W.toString()));break;case s.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var ee=new _r;n=s.numericCompaction(e,n+1,ee),a.setTimestamp(ol.parseLong(ee.toString()));break;case s.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var oe=new _r;n=s.numericCompaction(e,n+1,oe),a.setChecksum(mt.parseInt(oe.toString()));break;case s.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var Ce=new _r;n=s.numericCompaction(e,n+1,Ce),a.setFileSize(ol.parseLong(Ce.toString()));break;default:throw nn.getFormatInstance()}break;case s.MACRO_PDF417_TERMINATOR:n++,a.setLastSegment(!0);break;default:throw nn.getFormatInstance()}if(-1!==E){var Ne=n-E;a.isLastSegment()&&Ne--,a.setOptionalData(Nt.copyOfRange(e,E,E+Ne))}return n},s.textCompaction=function(e,n,a){for(var u=new Int32Array(2*(e[0]-n)),p=new Int32Array(2*(e[0]-n)),w=0,E=!1;n<e[0]&&!E;){var I=e[n++];if(I<s.TEXT_COMPACTION_MODE_LATCH)u[w]=I/30,u[w+1]=I%30,w+=2;else switch(I){case s.TEXT_COMPACTION_MODE_LATCH:u[w++]=s.TEXT_COMPACTION_MODE_LATCH;break;case s.BYTE_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH_6:case s.NUMERIC_COMPACTION_MODE_LATCH:case s.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case s.MACRO_PDF417_TERMINATOR:n--,E=!0;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u[w]=s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,I=e[n++],p[w]=I,w++}}return s.decodeTextCompaction(u,p,w,a),n},s.decodeTextCompaction=function(e,n,a,u){for(var p=fs.ALPHA,w=fs.ALPHA,E=0;E<a;){var I=e[E],R="";switch(p){case fs.ALPHA:if(I<26)R=String.fromCharCode(65+I);else switch(I){case 26:R=" ";break;case s.LL:p=fs.LOWER;break;case s.ML:p=fs.MIXED;break;case s.PS:w=p,p=fs.PUNCT_SHIFT;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(n[E]);break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}break;case fs.LOWER:if(I<26)R=String.fromCharCode(97+I);else switch(I){case 26:R=" ";break;case s.AS:w=p,p=fs.ALPHA_SHIFT;break;case s.ML:p=fs.MIXED;break;case s.PS:w=p,p=fs.PUNCT_SHIFT;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(n[E]);break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}break;case fs.MIXED:if(I<s.PL)R=s.MIXED_CHARS[I];else switch(I){case s.PL:p=fs.PUNCT;break;case 26:R=" ";break;case s.LL:p=fs.LOWER;break;case s.AL:p=fs.ALPHA;break;case s.PS:w=p,p=fs.PUNCT_SHIFT;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(n[E]);break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}break;case fs.PUNCT:if(I<s.PAL)R=s.PUNCT_CHARS[I];else switch(I){case s.PAL:p=fs.ALPHA;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(n[E]);break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}break;case fs.ALPHA_SHIFT:if(p=w,I<26)R=String.fromCharCode(65+I);else switch(I){case 26:R=" ";break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}break;case fs.PUNCT_SHIFT:if(p=w,I<s.PAL)R=s.PUNCT_CHARS[I];else switch(I){case s.PAL:p=fs.ALPHA;break;case s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:u.append(n[E]);break;case s.TEXT_COMPACTION_MODE_LATCH:p=fs.ALPHA}}""!==R&&u.append(R),E++}},s.byteCompaction=function(e,n,a,u,p){var w=new md,E=0,I=0,R=!1;switch(e){case s.BYTE_COMPACTION_MODE_LATCH:for(var V=new Int32Array(6),W=n[u++];u<n[0]&&!R;)switch(V[E++]=W,I=900*I+W,W=n[u++],W){case s.TEXT_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH:case s.NUMERIC_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH_6:case s.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case s.MACRO_PDF417_TERMINATOR:u--,R=!0;break;default:if(E%5==0&&E>0){for(var ee=0;ee<6;++ee)w.write(Number(Ic(I)>>Ic(8*(5-ee))));I=0,E=0}}u===n[0]&&W<s.TEXT_COMPACTION_MODE_LATCH&&(V[E++]=W);for(var oe=0;oe<E;oe++)w.write(V[oe]);break;case s.BYTE_COMPACTION_MODE_LATCH_6:for(;u<n[0]&&!R;){var Ce=n[u++];if(Ce<s.TEXT_COMPACTION_MODE_LATCH)E++,I=900*I+Ce;else switch(Ce){case s.TEXT_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH:case s.NUMERIC_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH_6:case s.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case s.MACRO_PDF417_TERMINATOR:u--,R=!0}if(E%5==0&&E>0){for(ee=0;ee<6;++ee)w.write(Number(Ic(I)>>Ic(8*(5-ee))));I=0,E=0}}}return p.append(Ai.decode(w.toByteArray(),a)),u},s.numericCompaction=function(e,n,a){for(var u=0,p=!1,w=new Int32Array(s.MAX_NUMERIC_CODEWORDS);n<e[0]&&!p;){var E=e[n++];if(n===e[0]&&(p=!0),E<s.TEXT_COMPACTION_MODE_LATCH)w[u]=E,u++;else switch(E){case s.TEXT_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH:case s.BYTE_COMPACTION_MODE_LATCH_6:case s.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case s.MACRO_PDF417_TERMINATOR:n--,p=!0}(u%s.MAX_NUMERIC_CODEWORDS==0||E===s.NUMERIC_COMPACTION_MODE_LATCH||p)&&u>0&&(a.append(s.decodeBase900toBase10(w,u)),u=0)}return n},s.decodeBase900toBase10=function(e,n){for(var a=Ic(0),u=0;u<n;u++)a+=s.EXP900[n-u-1]*Ic(e[u]);var p=a.toString();if("1"!==p.charAt(0))throw new nn;return p.substring(1)},s.TEXT_COMPACTION_MODE_LATCH=900,s.BYTE_COMPACTION_MODE_LATCH=901,s.NUMERIC_COMPACTION_MODE_LATCH=902,s.BYTE_COMPACTION_MODE_LATCH_6=924,s.ECI_USER_DEFINED=925,s.ECI_GENERAL_PURPOSE=926,s.ECI_CHARSET=927,s.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,s.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,s.MACRO_PDF417_TERMINATOR=922,s.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,s.MAX_NUMERIC_CODEWORDS=15,s.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,s.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,s.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,s.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,s.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,s.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,s.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,s.PL=25,s.LL=27,s.AS=27,s.ML=28,s.AL=28,s.PS=29,s.PAL=29,s.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",s.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",s.EXP900=Ga()?function jd(){var s=[];s[0]=Ic(1);var e=Ic(900);s[1]=e;for(var n=2;n<16;n++)s[n]=s[n-1]*e;return s}():[],s.NUMBER_OF_SEQUENCE_CODEWORDS=2,s}();const Mc=Sh;var Oc=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Bu=function(){function s(){}return s.decode=function(e,n,a,u,p,w,E){for(var W,I=new It(e,n,a,u,p),R=null,V=null,ee=!0;;ee=!1){if(null!=n&&(R=s.getRowIndicatorColumn(e,I,n,!0,w,E)),null!=u&&(V=s.getRowIndicatorColumn(e,I,u,!1,w,E)),null==(W=s.merge(R,V)))throw qt.getNotFoundInstance();var oe=W.getBoundingBox();if(!ee||null==oe||!(oe.getMinY()<I.getMinY()||oe.getMaxY()>I.getMaxY()))break;I=oe}W.setBoundingBox(I);var Ce=W.getBarcodeColumnCount()+1;W.setDetectionResultColumn(0,R),W.setDetectionResultColumn(Ce,V);for(var Ne=null!=R,ot=1;ot<=Ce;ot++){var ut=Ne?ot:Ce-ot;if(void 0===W.getDetectionResultColumn(ut)){var at=void 0;at=0===ut||ut===Ce?new To(I,0===ut):new sr(I),W.setDetectionResultColumn(ut,at);for(var Pt=-1,Wt=Pt,wn=I.getMinY();wn<=I.getMaxY();wn++){if((Pt=s.getStartColumn(W,ut,wn,Ne))<0||Pt>I.getMaxX()){if(-1===Wt)continue;Pt=Wt}var Un=s.detectCodeword(e,I.getMinX(),I.getMaxX(),Ne,Pt,wn,w,E);null!=Un&&(at.setCodeword(wn,Un),Wt=Pt,w=Math.min(w,Un.getWidth()),E=Math.max(E,Un.getWidth()))}}}return s.createDecoderResult(W)},s.merge=function(e,n){if(null==e&&null==n)return null;var a=s.getBarcodeMetadata(e,n);if(null==a)return null;var u=It.merge(s.adjustBoundingBox(e),s.adjustBoundingBox(n));return new Fl(a,u)},s.adjustBoundingBox=function(e){var n,a;if(null==e)return null;var u=e.getRowHeights();if(null==u)return null;var p=s.getMax(u),w=0;try{for(var E=Oc(u),I=E.next();!I.done;I=E.next()){var R=I.value;if(w+=p-R,R>0)break}}catch(oe){n={error:oe}}finally{try{I&&!I.done&&(a=E.return)&&a.call(E)}finally{if(n)throw n.error}}for(var V=e.getCodewords(),W=0;w>0&&null==V[W];W++)w--;var ee=0;for(W=u.length-1;W>=0&&(ee+=p-u[W],!(u[W]>0));W--);for(W=V.length-1;ee>0&&null==V[W];W--)ee--;return e.getBoundingBox().addMissingRows(w,ee,e.isLeft())},s.getMax=function(e){var n,a,u=-1;try{for(var p=Oc(e),w=p.next();!w.done;w=p.next())u=Math.max(u,w.value)}catch(I){n={error:I}}finally{try{w&&!w.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return u},s.getBarcodeMetadata=function(e,n){var a,u;return null==e||null==(a=e.getBarcodeMetadata())?null==n?null:n.getBarcodeMetadata():null==n||null==(u=n.getBarcodeMetadata())?a:a.getColumnCount()!==u.getColumnCount()&&a.getErrorCorrectionLevel()!==u.getErrorCorrectionLevel()&&a.getRowCount()!==u.getRowCount()?null:a},s.getRowIndicatorColumn=function(e,n,a,u,p,w){for(var E=new To(n,u),I=0;I<2;I++)for(var R=0===I?1:-1,V=Math.trunc(Math.trunc(a.getX())),W=Math.trunc(Math.trunc(a.getY()));W<=n.getMaxY()&&W>=n.getMinY();W+=R){var ee=s.detectCodeword(e,0,e.getWidth(),u,V,W,p,w);null!=ee&&(E.setCodeword(W,ee),V=u?ee.getStartX():ee.getEndX())}return E},s.adjustCodewordCount=function(e,n){var a=n[0][1],u=a.getValue(),p=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-s.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===u.length){if(p<1||p>we.MAX_CODEWORDS_IN_BARCODE)throw qt.getNotFoundInstance();a.setValue(p)}else u[0]!==p&&a.setValue(p)},s.createDecoderResult=function(e){var n=s.createBarcodeMatrix(e);s.adjustCodewordCount(e,n);for(var a=new Array,u=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),p=[],w=new Array,E=0;E<e.getBarcodeRowCount();E++)for(var I=0;I<e.getBarcodeColumnCount();I++){var R=n[E][I+1].getValue(),V=E*e.getBarcodeColumnCount()+I;0===R.length?a.push(V):1===R.length?u[V]=R[0]:(w.push(V),p.push(R))}for(var W=new Array(p.length),ee=0;ee<W.length;ee++)W[ee]=p[ee];return s.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),u,we.toIntArray(a),we.toIntArray(w),W)},s.createDecoderResultFromAmbiguousValues=function(e,n,a,u,p){for(var w=new Int32Array(u.length),E=100;E-- >0;){for(var I=0;I<w.length;I++)n[u[I]]=p[I][w[I]];try{return s.decodeCodewords(n,e,a)}catch(V){if(!(V instanceof Wn))throw V}if(0===w.length)throw Wn.getChecksumInstance();for(I=0;I<w.length;I++){if(w[I]<p[I].length-1){w[I]++;break}if(w[I]=0,I===w.length-1)throw Wn.getChecksumInstance()}}throw Wn.getChecksumInstance()},s.createBarcodeMatrix=function(e){for(var n,a,u,p,w=Array.from({length:e.getBarcodeRowCount()},function(){return new Array(e.getBarcodeColumnCount()+2)}),E=0;E<w.length;E++)for(var I=0;I<w[E].length;I++)w[E][I]=new dr;var R=0;try{for(var V=Oc(e.getDetectionResultColumns()),W=V.next();!W.done;W=V.next()){var ee=W.value;if(null!=ee)try{for(var oe=(u=void 0,Oc(ee.getCodewords())),Ce=oe.next();!Ce.done;Ce=oe.next()){var Ne=Ce.value;if(null!=Ne){var ot=Ne.getRowNumber();if(ot>=0){if(ot>=w.length)continue;w[ot][R].setValue(Ne.getValue())}}}}catch(ut){u={error:ut}}finally{try{Ce&&!Ce.done&&(p=oe.return)&&p.call(oe)}finally{if(u)throw u.error}}R++}}catch(ut){n={error:ut}}finally{try{W&&!W.done&&(a=V.return)&&a.call(V)}finally{if(n)throw n.error}}return w},s.isValidBarcodeColumn=function(e,n){return n>=0&&n<=e.getBarcodeColumnCount()+1},s.getStartColumn=function(e,n,a,u){var p,w,E=u?1:-1,I=null;if(s.isValidBarcodeColumn(e,n-E)&&(I=e.getDetectionResultColumn(n-E).getCodeword(a)),null!=I)return u?I.getEndX():I.getStartX();if(null!=(I=e.getDetectionResultColumn(n).getCodewordNearby(a)))return u?I.getStartX():I.getEndX();if(s.isValidBarcodeColumn(e,n-E)&&(I=e.getDetectionResultColumn(n-E).getCodewordNearby(a)),null!=I)return u?I.getEndX():I.getStartX();for(var R=0;s.isValidBarcodeColumn(e,n-E);){n-=E;try{for(var V=(p=void 0,Oc(e.getDetectionResultColumn(n).getCodewords())),W=V.next();!W.done;W=V.next()){var ee=W.value;if(null!=ee)return(u?ee.getEndX():ee.getStartX())+E*R*(ee.getEndX()-ee.getStartX())}}catch(oe){p={error:oe}}finally{try{W&&!W.done&&(w=V.return)&&w.call(V)}finally{if(p)throw p.error}}R++}return u?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()},s.detectCodeword=function(e,n,a,u,p,w,E,I){p=s.adjustCodewordStartColumn(e,n,a,u,p,w);var R=s.getModuleBitCount(e,n,a,u,p,w);if(null==R)return null;var V,W=vr.sum(R);if(u)V=p+W;else{for(var ee=0;ee<R.length/2;ee++){var oe=R[ee];R[ee]=R[R.length-1-ee],R[R.length-1-ee]=oe}p=(V=p)-W}if(!s.checkCodewordSkew(W,E,I))return null;var Ce=$i.getDecodedValue(R),Ne=we.getCodeword(Ce);return-1===Ne?null:new rs(p,V,s.getCodewordBucketNumber(Ce),Ne)},s.getModuleBitCount=function(e,n,a,u,p,w){for(var E=p,I=new Int32Array(8),R=0,V=u?1:-1,W=u;(u?E<a:E>=n)&&R<I.length;)e.get(E,w)===W?(I[R]++,E+=V):(R++,W=!W);return R===I.length||E===(u?a:n)&&R===I.length-1?I:null},s.getNumberOfECCodeWords=function(e){return 2<<e},s.adjustCodewordStartColumn=function(e,n,a,u,p,w){for(var E=p,I=u?-1:1,R=0;R<2;R++){for(;(u?E>=n:E<a)&&u===e.get(E,w);){if(Math.abs(p-E)>s.CODEWORD_SKEW_SIZE)return p;E+=I}I=-I,u=!u}return E},s.checkCodewordSkew=function(e,n,a){return n-s.CODEWORD_SKEW_SIZE<=e&&e<=a+s.CODEWORD_SKEW_SIZE},s.decodeCodewords=function(e,n,a){if(0===e.length)throw nn.getFormatInstance();var u=1<<n+1,p=s.correctErrors(e,a,u);s.verifyCodewordCount(e,u);var w=Mc.decode(e,""+n);return w.setErrorsCorrected(p),w.setErasures(a.length),w},s.correctErrors=function(e,n,a){if(null!=n&&n.length>a/2+s.MAX_ERRORS||a<0||a>s.MAX_EC_CODEWORDS)throw Wn.getChecksumInstance();return s.errorCorrection.decode(e,a,n)},s.verifyCodewordCount=function(e,n){if(e.length<4)throw nn.getFormatInstance();var a=e[0];if(a>e.length)throw nn.getFormatInstance();if(0===a){if(!(n<e.length))throw nn.getFormatInstance();e[0]=e.length-n}},s.getBitCountForCodeword=function(e){for(var n=new Int32Array(8),a=0,u=n.length-1;!((1&e)!==a&&(a=1&e,u--,u<0));)n[u]++,e>>=1;return n},s.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},s.getCodewordBucketNumber_number=function(e){return s.getCodewordBucketNumber(s.getBitCountForCodeword(e))},s.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},s.toString=function(e){for(var n=new An,a=0;a<e.length;a++){n.format("Row %2d: ",a);for(var u=0;u<e[a].length;u++){var p=e[a][u];0===p.getValue().length?n.format("        ",null):n.format("%4d(%2d)",p.getValue()[0],p.getConfidence(p.getValue()[0]))}n.format("%n")}return n.toString()},s.CODEWORD_SKEW_SIZE=2,s.MAX_ERRORS=3,s.MAX_EC_CODEWORDS=512,s.errorCorrection=new jt,s}();const zu=Bu;var ap=function(){function s(){}return s.prototype.decode=function(e,n){void 0===n&&(n=null);var a=s.decode(e,n,!1);if(null==a||0===a.length||null==a[0])throw qt.getNotFoundInstance();return a[0]},s.prototype.decodeMultiple=function(e,n){void 0===n&&(n=null);try{return s.decode(e,n,!0)}catch(a){throw a instanceof nn||a instanceof Wn?qt.getNotFoundInstance():a}},s.decode=function(e,n,a){var u,p,w=new Array,E=Be.detectMultiple(e,n,a);try{for(var I=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(E.getPoints()),R=I.next();!R.done;R=I.next()){var V=R.value,W=zu.decode(E.getBits(),V[4],V[5],V[6],V[7],s.getMinCodewordWidth(V),s.getMaxCodewordWidth(V)),ee=new Ze(W.getText(),W.getRawBytes(),void 0,V,De.PDF_417);ee.putMetadata(Tt.ERROR_CORRECTION_LEVEL,W.getECLevel());var oe=W.getOther();null!=oe&&ee.putMetadata(Tt.PDF417_EXTRA_METADATA,oe),w.push(ee)}}catch(Ce){u={error:Ce}}finally{try{R&&!R.done&&(p=I.return)&&p.call(I)}finally{if(u)throw u.error}}return w.map(function(Ce){return Ce})},s.getMaxWidth=function(e,n){return null==e||null==n?0:Math.trunc(Math.abs(e.getX()-n.getX()))},s.getMinWidth=function(e,n){return null==e||null==n?mt.MAX_VALUE:Math.trunc(Math.abs(e.getX()-n.getX()))},s.getMaxCodewordWidth=function(e){return Math.floor(Math.max(Math.max(s.getMaxWidth(e[0],e[4]),s.getMaxWidth(e[6],e[2])*we.MODULES_IN_CODEWORD/we.MODULES_IN_STOP_PATTERN),Math.max(s.getMaxWidth(e[1],e[5]),s.getMaxWidth(e[7],e[3])*we.MODULES_IN_CODEWORD/we.MODULES_IN_STOP_PATTERN)))},s.getMinCodewordWidth=function(e){return Math.floor(Math.min(Math.min(s.getMinWidth(e[0],e[4]),s.getMinWidth(e[6],e[2])*we.MODULES_IN_CODEWORD/we.MODULES_IN_STOP_PATTERN),Math.min(s.getMinWidth(e[1],e[5]),s.getMinWidth(e[7],e[3])*we.MODULES_IN_CODEWORD/we.MODULES_IN_STOP_PATTERN)))},s.prototype.reset=function(){},s}();const vd=ap;var mu=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ih=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return mu(e,s),e.kind="ReaderException",e}(Bt);const Uu=Ih;var Jc=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Pc=function(){function s(){}return s.prototype.decode=function(e,n){return this.setHints(n),this.decodeInternal(e)},s.prototype.decodeWithState=function(e){return null==this.readers&&this.setHints(null),this.decodeInternal(e)},s.prototype.setHints=function(e){this.hints=e;var n=null!=e&&void 0!==e.get(Qn.TRY_HARDER),a=null==e?null:e.get(Qn.POSSIBLE_FORMATS),u=new Array;if(null!=a){var p=a.some(function(w){return w===De.UPC_A||w===De.UPC_E||w===De.EAN_13||w===De.EAN_8||w===De.CODABAR||w===De.CODE_39||w===De.CODE_93||w===De.CODE_128||w===De.ITF||w===De.RSS_14||w===De.RSS_EXPANDED});p&&!n&&u.push(new Hn(e)),a.includes(De.QR_CODE)&&u.push(new de),a.includes(De.DATA_MATRIX)&&u.push(new cc),a.includes(De.AZTEC)&&u.push(new ba),a.includes(De.PDF_417)&&u.push(new vd),p&&n&&u.push(new Hn(e))}0===u.length&&(n||u.push(new Hn(e)),u.push(new de),u.push(new cc),u.push(new ba),u.push(new vd),n&&u.push(new Hn(e))),this.readers=u},s.prototype.reset=function(){var e,n;if(null!==this.readers)try{for(var a=Jc(this.readers),u=a.next();!u.done;u=a.next())u.value.reset()}catch(w){e={error:w}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},s.prototype.decodeInternal=function(e){var n,a;if(null===this.readers)throw new Uu("No readers where selected, nothing can be read.");try{for(var u=Jc(this.readers),p=u.next();!p.done;p=u.next()){var w=p.value;try{return w.decode(e,this.hints)}catch(E){if(E instanceof Uu)continue}}}catch(E){n={error:E}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}throw new qt("No MultiFormat Readers were able to detect the code.")},s}();const _u=Pc;var Vu=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),km=(function(s){function e(n,a){void 0===n&&(n=null),void 0===a&&(a=500);var p=new _u;return p.setHints(n),s.call(this,p,a)||this}Vu(e,s),e.prototype.decodeBitmap=function(n){return this.reader.decodeWithState(n)}}(pn),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),_g=(function(s){km(function e(n){return void 0===n&&(n=500),s.call(this,new vd,n)||this},s)}(pn),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),ha=(function(s){_g(function e(n){return void 0===n&&(n=500),s.call(this,new de,n)||this},s)}(pn),function(s){return s[s.ERROR_CORRECTION=0]="ERROR_CORRECTION",s[s.CHARACTER_SET=1]="CHARACTER_SET",s[s.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",s[s.DATA_MATRIX_COMPACT=3]="DATA_MATRIX_COMPACT",s[s.MIN_SIZE=4]="MIN_SIZE",s[s.MAX_SIZE=5]="MAX_SIZE",s[s.MARGIN=6]="MARGIN",s[s.PDF417_COMPACT=7]="PDF417_COMPACT",s[s.PDF417_COMPACTION=8]="PDF417_COMPACTION",s[s.PDF417_DIMENSIONS=9]="PDF417_DIMENSIONS",s[s.AZTEC_LAYERS=10]="AZTEC_LAYERS",s[s.QR_VERSION=11]="QR_VERSION",s[s.GS1_FORMAT=12]="GS1_FORMAT",s[s.FORCE_C40=13]="FORCE_C40",s}(ha||{}));const Ki=ha;var Sl=function(){function s(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new zi(e,Int32Array.from([1])))}return s.prototype.buildGenerator=function(e){var n=this.cachedGenerators;if(e>=n.length)for(var a=n[n.length-1],u=this.field,p=n.length;p<=e;p++){var w=a.multiply(new zi(u,Int32Array.from([1,u.exp(p-1+u.getGeneratorBase())])));n.push(w),a=w}return n[e]},s.prototype.encode=function(e,n){if(0===n)throw new Xt("No error correction bytes");var a=e.length-n;if(a<=0)throw new Xt("No data bytes provided");var u=this.buildGenerator(n),p=new Int32Array(a);kn.arraycopy(e,0,p,0,a);for(var w=new zi(this.field,p),I=(w=w.multiplyByMonomial(n,1)).divide(u)[1].getCoefficients(),R=n-I.length,V=0;V<R;V++)e[a+V]=0;kn.arraycopy(I,0,e,a+R,I.length)},s}();const lp=Sl;var nc=function(){function s(){}return s.applyMaskPenaltyRule1=function(e){return s.applyMaskPenaltyRule1Internal(e,!0)+s.applyMaskPenaltyRule1Internal(e,!1)},s.applyMaskPenaltyRule2=function(e){for(var n=0,a=e.getArray(),u=e.getWidth(),p=e.getHeight(),w=0;w<p-1;w++)for(var E=a[w],I=0;I<u-1;I++){var R=E[I];R===E[I+1]&&R===a[w+1][I]&&R===a[w+1][I+1]&&n++}return s.N2*n},s.applyMaskPenaltyRule3=function(e){for(var n=0,a=e.getArray(),u=e.getWidth(),p=e.getHeight(),w=0;w<p;w++)for(var E=0;E<u;E++){var I=a[w];E+6<u&&1===I[E]&&0===I[E+1]&&1===I[E+2]&&1===I[E+3]&&1===I[E+4]&&0===I[E+5]&&1===I[E+6]&&(s.isWhiteHorizontal(I,E-4,E)||s.isWhiteHorizontal(I,E+7,E+11))&&n++,w+6<p&&1===a[w][E]&&0===a[w+1][E]&&1===a[w+2][E]&&1===a[w+3][E]&&1===a[w+4][E]&&0===a[w+5][E]&&1===a[w+6][E]&&(s.isWhiteVertical(a,E,w-4,w)||s.isWhiteVertical(a,E,w+7,w+11))&&n++}return n*s.N3},s.isWhiteHorizontal=function(e,n,a){n=Math.max(n,0),a=Math.min(a,e.length);for(var u=n;u<a;u++)if(1===e[u])return!1;return!0},s.isWhiteVertical=function(e,n,a,u){a=Math.max(a,0),u=Math.min(u,e.length);for(var p=a;p<u;p++)if(1===e[p][n])return!1;return!0},s.applyMaskPenaltyRule4=function(e){for(var n=0,a=e.getArray(),u=e.getWidth(),p=e.getHeight(),w=0;w<p;w++)for(var E=a[w],I=0;I<u;I++)1===E[I]&&n++;var R=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*n-R)/R)*s.N4},s.getDataMaskBit=function(e,n,a){var u,p;switch(e){case 0:u=a+n&1;break;case 1:u=1&a;break;case 2:u=n%3;break;case 3:u=(a+n)%3;break;case 4:u=Math.floor(a/2)+Math.floor(n/3)&1;break;case 5:u=(1&(p=a*n))+p%3;break;case 6:u=(1&(p=a*n))+p%3&1;break;case 7:u=(p=a*n)%3+(a+n&1)&1;break;default:throw new Xt("Invalid mask pattern: "+e)}return 0===u},s.applyMaskPenaltyRule1Internal=function(e,n){for(var a=0,u=n?e.getHeight():e.getWidth(),p=n?e.getWidth():e.getHeight(),w=e.getArray(),E=0;E<u;E++){for(var I=0,R=-1,V=0;V<p;V++){var W=n?w[E][V]:w[V][E];W===R?I++:(I>=5&&(a+=s.N1+(I-5)),I=1,R=W)}I>=5&&(a+=s.N1+(I-5))}return a},s.N1=3,s.N2=3,s.N3=40,s.N4=10,s}();const So=nc;var uc=function(){function s(e,n){this.width=e,this.height=n;for(var a=new Array(n),u=0;u!==n;u++)a[u]=new Uint8Array(e);this.bytes=a}return s.prototype.getHeight=function(){return this.height},s.prototype.getWidth=function(){return this.width},s.prototype.get=function(e,n){return this.bytes[n][e]},s.prototype.getArray=function(){return this.bytes},s.prototype.setNumber=function(e,n,a){this.bytes[n][e]=a},s.prototype.setBoolean=function(e,n,a){this.bytes[n][e]=a?1:0},s.prototype.clear=function(e){var n,a;try{for(var u=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.bytes),p=u.next();!p.done;p=u.next())Nt.fill(p.value,e)}catch(E){n={error:E}}finally{try{p&&!p.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}},s.prototype.equals=function(e){if(!(e instanceof s))return!1;var n=e;if(this.width!==n.width||this.height!==n.height)return!1;for(var a=0,u=this.height;a<u;++a)for(var p=this.bytes[a],w=n.bytes[a],E=0,I=this.width;E<I;++E)if(p[E]!==w[E])return!1;return!0},s.prototype.toString=function(){for(var e=new _r,n=0,a=this.height;n<a;++n){for(var u=this.bytes[n],p=0,w=this.width;p<w;++p)switch(u[p]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()},s}();const Qc=uc;var Bl=function(){function s(){this.maskPattern=-1}return s.prototype.getMode=function(){return this.mode},s.prototype.getECLevel=function(){return this.ecLevel},s.prototype.getVersion=function(){return this.version},s.prototype.getMaskPattern=function(){return this.maskPattern},s.prototype.getMatrix=function(){return this.matrix},s.prototype.toString=function(){var e=new _r;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()},s.prototype.setMode=function(e){this.mode=e},s.prototype.setECLevel=function(e){this.ecLevel=e},s.prototype.setVersion=function(e){this.version=e},s.prototype.setMaskPattern=function(e){this.maskPattern=e},s.prototype.setMatrix=function(e){this.matrix=e},s.isValidMaskPattern=function(e){return e>=0&&e<s.NUM_MASK_PATTERNS},s.NUM_MASK_PATTERNS=8,s}();const yf=Bl;var cp=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Rc=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return cp(e,s),e.kind="WriterException",e}(Bt);const Wi=Rc;var eu=function(){function s(){}return s.clearMatrix=function(e){e.clear(255)},s.buildMatrix=function(e,n,a,u,p){s.clearMatrix(p),s.embedBasicPatterns(a,p),s.embedTypeInfo(n,u,p),s.maybeEmbedVersionInfo(a,p),s.embedDataBits(e,u,p)},s.embedBasicPatterns=function(e,n){s.embedPositionDetectionPatternsAndSeparators(n),s.embedDarkDotAtLeftBottomCorner(n),s.maybeEmbedPositionAdjustmentPatterns(e,n),s.embedTimingPatterns(n)},s.embedTypeInfo=function(e,n,a){var u=new _n;s.makeTypeInfoBits(e,n,u);for(var p=0,w=u.getSize();p<w;++p){var E=u.get(u.getSize()-1-p),I=s.TYPE_INFO_COORDINATES[p];if(a.setBoolean(I[0],I[1],E),p<8){var W=a.getWidth()-p-1;a.setBoolean(W,ee=8,E)}else{W=8;var ee=a.getHeight()-7+(p-8);a.setBoolean(W,ee,E)}}},s.maybeEmbedVersionInfo=function(e,n){if(!(e.getVersionNumber()<7)){var a=new _n;s.makeVersionInfoBits(e,a);for(var u=17,p=0;p<6;++p)for(var w=0;w<3;++w){var E=a.get(u);u--,n.setBoolean(p,n.getHeight()-11+w,E),n.setBoolean(n.getHeight()-11+w,p,E)}}},s.embedDataBits=function(e,n,a){for(var u=0,p=-1,w=a.getWidth()-1,E=a.getHeight()-1;w>0;){for(6===w&&(w-=1);E>=0&&E<a.getHeight();){for(var I=0;I<2;++I){var R=w-I;if(s.isEmpty(a.get(R,E))){var V=void 0;u<e.getSize()?(V=e.get(u),++u):V=!1,255!==n&&So.getDataMaskBit(n,R,E)&&(V=!V),a.setBoolean(R,E,V)}}E+=p}E+=p=-p,w-=2}if(u!==e.getSize())throw new Wi("Not all bits consumed: "+u+"/"+e.getSize())},s.findMSBSet=function(e){return 32-mt.numberOfLeadingZeros(e)},s.calculateBCHCode=function(e,n){if(0===n)throw new Xt("0 polynomial");var a=s.findMSBSet(n);for(e<<=a-1;s.findMSBSet(e)>=a;)e^=n<<s.findMSBSet(e)-a;return e},s.makeTypeInfoBits=function(e,n,a){if(!yf.isValidMaskPattern(n))throw new Wi("Invalid mask pattern");var u=e.getBits()<<3|n;a.appendBits(u,5);var p=s.calculateBCHCode(u,s.TYPE_INFO_POLY);a.appendBits(p,10);var w=new _n;if(w.appendBits(s.TYPE_INFO_MASK_PATTERN,15),a.xor(w),15!==a.getSize())throw new Wi("should not happen but we got: "+a.getSize())},s.makeVersionInfoBits=function(e,n){n.appendBits(e.getVersionNumber(),6);var a=s.calculateBCHCode(e.getVersionNumber(),s.VERSION_INFO_POLY);if(n.appendBits(a,12),18!==n.getSize())throw new Wi("should not happen but we got: "+n.getSize())},s.isEmpty=function(e){return 255===e},s.embedTimingPatterns=function(e){for(var n=8;n<e.getWidth()-8;++n){var a=(n+1)%2;s.isEmpty(e.get(n,6))&&e.setNumber(n,6,a),s.isEmpty(e.get(6,n))&&e.setNumber(6,n,a)}},s.embedDarkDotAtLeftBottomCorner=function(e){if(0===e.get(8,e.getHeight()-8))throw new Wi;e.setNumber(8,e.getHeight()-8,1)},s.embedHorizontalSeparationPattern=function(e,n,a){for(var u=0;u<8;++u){if(!s.isEmpty(a.get(e+u,n)))throw new Wi;a.setNumber(e+u,n,0)}},s.embedVerticalSeparationPattern=function(e,n,a){for(var u=0;u<7;++u){if(!s.isEmpty(a.get(e,n+u)))throw new Wi;a.setNumber(e,n+u,0)}},s.embedPositionAdjustmentPattern=function(e,n,a){for(var u=0;u<5;++u)for(var p=s.POSITION_ADJUSTMENT_PATTERN[u],w=0;w<5;++w)a.setNumber(e+w,n+u,p[w])},s.embedPositionDetectionPattern=function(e,n,a){for(var u=0;u<7;++u)for(var p=s.POSITION_DETECTION_PATTERN[u],w=0;w<7;++w)a.setNumber(e+w,n+u,p[w])},s.embedPositionDetectionPatternsAndSeparators=function(e){var n=s.POSITION_DETECTION_PATTERN[0].length;s.embedPositionDetectionPattern(0,0,e),s.embedPositionDetectionPattern(e.getWidth()-n,0,e),s.embedPositionDetectionPattern(0,e.getWidth()-n,e),s.embedHorizontalSeparationPattern(0,7,e),s.embedHorizontalSeparationPattern(e.getWidth()-8,7,e),s.embedHorizontalSeparationPattern(0,e.getWidth()-8,e),s.embedVerticalSeparationPattern(7,0,e),s.embedVerticalSeparationPattern(e.getHeight()-7-1,0,e),s.embedVerticalSeparationPattern(7,e.getHeight()-7,e)},s.maybeEmbedPositionAdjustmentPatterns=function(e,n){if(!(e.getVersionNumber()<2))for(var a=e.getVersionNumber()-1,u=s.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[a],p=0,w=u.length;p!==w;p++){var E=u[p];if(E>=0)for(var I=0;I!==w;I++){var R=u[I];R>=0&&s.isEmpty(n.get(R,E))&&s.embedPositionAdjustmentPattern(R-2,E-2,n)}}},s.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),s.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),s.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),s.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),s.VERSION_INFO_POLY=7973,s.TYPE_INFO_POLY=1335,s.TYPE_INFO_MASK_PATTERN=21522,s}();const dc=eu;var yd=function(){function s(e,n){this.dataBytes=e,this.errorCorrectionBytes=n}return s.prototype.getDataBytes=function(){return this.dataBytes},s.prototype.getErrorCorrectionBytes=function(){return this.errorCorrectionBytes},s}();const Mh=yd;var $d=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},up=function(){function s(){}return s.calculateMaskPenalty=function(e){return So.applyMaskPenaltyRule1(e)+So.applyMaskPenaltyRule2(e)+So.applyMaskPenaltyRule3(e)+So.applyMaskPenaltyRule4(e)},s.encode=function(e,n,a){void 0===a&&(a=null);var u=s.DEFAULT_BYTE_MODE_ENCODING,p=null!==a&&void 0!==a.get(Ki.CHARACTER_SET);p&&(u=a.get(Ki.CHARACTER_SET).toString());var w=this.chooseMode(e,u),E=new _n;if(w===co.BYTE&&(p||s.DEFAULT_BYTE_MODE_ENCODING!==u)){var I=vi.getCharacterSetECIByName(u);void 0!==I&&this.appendECI(I,E)}this.appendModeInfo(w,E);var V,R=new _n;if(this.appendBytes(e,w,R,u),null!==a&&void 0!==a.get(Ki.QR_VERSION)){var W=Number.parseInt(a.get(Ki.QR_VERSION).toString(),10);V=ca.getVersionForNumber(W);var ee=this.calculateBitsNeeded(w,E,R,V);if(!this.willFit(ee,V,n))throw new Wi("Data too big for requested version")}else V=this.recommendVersion(n,w,E,R);var oe=new _n;oe.appendBitArray(E);var Ce=w===co.BYTE?R.getSizeInBytes():e.length;this.appendLengthInfo(Ce,V,w,oe),oe.appendBitArray(R);var Ne=V.getECBlocksForLevel(n),ot=V.getTotalCodewords()-Ne.getTotalECCodewords();this.terminateBits(ot,oe);var ut=this.interleaveWithECBytes(oe,V.getTotalCodewords(),ot,Ne.getNumBlocks()),at=new yf;at.setECLevel(n),at.setMode(w),at.setVersion(V);var Pt=V.getDimensionForVersion(),Wt=new Qc(Pt,Pt),wn=this.chooseMaskPattern(ut,n,V,Wt);return at.setMaskPattern(wn),dc.buildMatrix(ut,n,V,wn,Wt),at.setMatrix(Wt),at},s.recommendVersion=function(e,n,a,u){var p=this.calculateBitsNeeded(n,a,u,ca.getVersionForNumber(1)),w=this.chooseVersion(p,e),E=this.calculateBitsNeeded(n,a,u,w);return this.chooseVersion(E,e)},s.calculateBitsNeeded=function(e,n,a,u){return n.getSize()+e.getCharacterCountBits(u)+a.getSize()},s.getAlphanumericCode=function(e){return e<s.ALPHANUMERIC_TABLE.length?s.ALPHANUMERIC_TABLE[e]:-1},s.chooseMode=function(e,n){if(void 0===n&&(n=null),vi.SJIS.getName()===n&&this.isOnlyDoubleByteKanji(e))return co.KANJI;for(var a=!1,u=!1,p=0,w=e.length;p<w;++p){var E=e.charAt(p);if(s.isDigit(E))a=!0;else{if(-1===this.getAlphanumericCode(E.charCodeAt(0)))return co.BYTE;u=!0}}return u?co.ALPHANUMERIC:a?co.NUMERIC:co.BYTE},s.isOnlyDoubleByteKanji=function(e){var n;try{n=Ai.encode(e,vi.SJIS)}catch{return!1}var a=n.length;if(a%2!=0)return!1;for(var u=0;u<a;u+=2){var p=255&n[u];if((p<129||p>159)&&(p<224||p>235))return!1}return!0},s.chooseMaskPattern=function(e,n,a,u){for(var p=Number.MAX_SAFE_INTEGER,w=-1,E=0;E<yf.NUM_MASK_PATTERNS;E++){dc.buildMatrix(e,n,a,E,u);var I=this.calculateMaskPenalty(u);I<p&&(p=I,w=E)}return w},s.chooseVersion=function(e,n){for(var a=1;a<=40;a++){var u=ca.getVersionForNumber(a);if(s.willFit(e,u,n))return u}throw new Wi("Data too big")},s.willFit=function(e,n,a){return n.getTotalCodewords()-n.getECBlocksForLevel(a).getTotalECCodewords()>=(e+7)/8},s.terminateBits=function(e,n){var a=8*e;if(n.getSize()>a)throw new Wi("data bits cannot fit in the QR Code"+n.getSize()+" > "+a);for(var u=0;u<4&&n.getSize()<a;++u)n.appendBit(!1);var p=7&n.getSize();if(p>0)for(u=p;u<8;u++)n.appendBit(!1);var w=e-n.getSizeInBytes();for(u=0;u<w;++u)n.appendBits(1&u?17:236,8);if(n.getSize()!==a)throw new Wi("Bits size does not equal capacity")},s.getNumDataBytesAndNumECBytesForBlockID=function(e,n,a,u,p,w){if(u>=a)throw new Wi("Block ID too large");var E=e%a,I=a-E,R=Math.floor(e/a),V=R+1,W=Math.floor(n/a),ee=W+1,oe=R-W,Ce=V-ee;if(oe!==Ce)throw new Wi("EC bytes mismatch");if(a!==I+E)throw new Wi("RS blocks mismatch");if(e!==(W+oe)*I+(ee+Ce)*E)throw new Wi("Total bytes mismatch");u<I?(p[0]=W,w[0]=oe):(p[0]=ee,w[0]=Ce)},s.interleaveWithECBytes=function(e,n,a,u){var p,w,E,I;if(e.getSizeInBytes()!==a)throw new Wi("Number of bits and data bytes does not match");for(var R=0,V=0,W=0,ee=new Array,oe=0;oe<u;++oe){var Ce=new Int32Array(1),Ne=new Int32Array(1);s.getNumDataBytesAndNumECBytesForBlockID(n,a,u,oe,Ce,Ne);var ot=Ce[0],ut=new Uint8Array(ot);e.toBytes(8*R,ut,0,ot);var at=s.generateECBytes(ut,Ne[0]);ee.push(new Mh(ut,at)),V=Math.max(V,ot),W=Math.max(W,at.length),R+=Ce[0]}if(a!==R)throw new Wi("Data bytes does not match offset");var Pt=new _n;for(oe=0;oe<V;++oe)try{for(var Wt=(p=void 0,$d(ee)),wn=Wt.next();!wn.done;wn=Wt.next())oe<(ut=wn.value.getDataBytes()).length&&Pt.appendBits(ut[oe],8)}catch(fi){p={error:fi}}finally{try{wn&&!wn.done&&(w=Wt.return)&&w.call(Wt)}finally{if(p)throw p.error}}for(oe=0;oe<W;++oe)try{for(var Xn=(E=void 0,$d(ee)),hr=Xn.next();!hr.done;hr=Xn.next())oe<(at=hr.value.getErrorCorrectionBytes()).length&&Pt.appendBits(at[oe],8)}catch(fi){E={error:fi}}finally{try{hr&&!hr.done&&(I=Xn.return)&&I.call(Xn)}finally{if(E)throw E.error}}if(n!==Pt.getSizeInBytes())throw new Wi("Interleaving error: "+n+" and "+Pt.getSizeInBytes()+" differ.");return Pt},s.generateECBytes=function(e,n){for(var a=e.length,u=new Int32Array(a+n),p=0;p<a;p++)u[p]=255&e[p];new lp(en.QR_CODE_FIELD_256).encode(u,n);var w=new Uint8Array(n);for(p=0;p<n;p++)w[p]=u[a+p];return w},s.appendModeInfo=function(e,n){n.appendBits(e.getBits(),4)},s.appendLengthInfo=function(e,n,a,u){var p=a.getCharacterCountBits(n);if(e>=1<<p)throw new Wi(e+" is bigger than "+((1<<p)-1));u.appendBits(e,p)},s.appendBytes=function(e,n,a,u){switch(n){case co.NUMERIC:s.appendNumericBytes(e,a);break;case co.ALPHANUMERIC:s.appendAlphanumericBytes(e,a);break;case co.BYTE:s.append8BitBytes(e,a,u);break;case co.KANJI:s.appendKanjiBytes(e,a);break;default:throw new Wi("Invalid mode: "+n)}},s.getDigit=function(e){return e.charCodeAt(0)-48},s.isDigit=function(e){var n=s.getDigit(e);return n>=0&&n<=9},s.appendNumericBytes=function(e,n){for(var a=e.length,u=0;u<a;){var p=s.getDigit(e.charAt(u));if(u+2<a){var w=s.getDigit(e.charAt(u+1)),E=s.getDigit(e.charAt(u+2));n.appendBits(100*p+10*w+E,10),u+=3}else u+1<a?(w=s.getDigit(e.charAt(u+1)),n.appendBits(10*p+w,7),u+=2):(n.appendBits(p,4),u++)}},s.appendAlphanumericBytes=function(e,n){for(var a=e.length,u=0;u<a;){var p=s.getAlphanumericCode(e.charCodeAt(u));if(-1===p)throw new Wi;if(u+1<a){var w=s.getAlphanumericCode(e.charCodeAt(u+1));if(-1===w)throw new Wi;n.appendBits(45*p+w,11),u+=2}else n.appendBits(p,6),u++}},s.append8BitBytes=function(e,n,a){var u;try{u=Ai.encode(e,a)}catch(I){throw new Wi(I)}for(var p=0,w=u.length;p!==w;p++)n.appendBits(u[p],8)},s.appendKanjiBytes=function(e,n){var a;try{a=Ai.encode(e,vi.SJIS)}catch(W){throw new Wi(W)}for(var u=a.length,p=0;p<u;p+=2){var I=(255&a[p])<<8&4294967295|255&a[p+1],R=-1;if(I>=33088&&I<=40956?R=I-33088:I>=57408&&I<=60351&&(R=I-49472),-1===R)throw new Wi("Invalid byte sequence");n.appendBits(192*(R>>8)+(255&R),13)}},s.appendECI=function(e,n){n.appendBits(co.ECI.getBits(),4),n.appendBits(e.getValue(),8)},s.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),s.DEFAULT_BYTE_MODE_ENCODING=vi.UTF8.getName(),s}();const Wd=up;!function(){function s(){}s.prototype.write=function(e,n,a,u){if(void 0===u&&(u=null),0===e.length)throw new Xt("Found empty contents");if(n<0||a<0)throw new Xt("Requested dimensions are too small: "+n+"x"+a);var p=Nl.L,w=s.QUIET_ZONE_SIZE;null!==u&&(void 0!==u.get(Ki.ERROR_CORRECTION)&&(p=Nl.fromString(u.get(Ki.ERROR_CORRECTION).toString())),void 0!==u.get(Ki.MARGIN)&&(w=Number.parseInt(u.get(Ki.MARGIN).toString(),10)));var E=Wd.encode(e,p,u);return this.renderResult(E,n,a,w)},s.prototype.writeToDom=function(e,n,a,u,p){void 0===p&&(p=null),"string"==typeof e&&(e=document.querySelector(e));var w=this.write(n,a,u,p);e&&e.appendChild(w)},s.prototype.renderResult=function(e,n,a,u){var p=e.getMatrix();if(null===p)throw new Fi;for(var w=p.getWidth(),E=p.getHeight(),I=w+2*u,R=E+2*u,V=Math.max(n,I),W=Math.max(a,R),ee=Math.min(Math.floor(V/I),Math.floor(W/R)),oe=Math.floor((V-w*ee)/2),Ce=Math.floor((W-E*ee)/2),Ne=this.createSVGElement(V,W),ot=0,ut=Ce;ot<E;ot++,ut+=ee)for(var at=0,Pt=oe;at<w;at++,Pt+=ee)if(1===p.get(at,ot)){var Wt=this.createSvgRectElement(Pt,ut,ee,ee);Ne.appendChild(Wt)}return Ne},s.prototype.createSVGElement=function(e,n){var a=document.createElementNS(s.SVG_NS,"svg");return a.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width",n.toString()),a},s.prototype.createSvgRectElement=function(e,n,a,u){var p=document.createElementNS(s.SVG_NS,"rect");return p.setAttributeNS(null,"x",e.toString()),p.setAttributeNS(null,"y",n.toString()),p.setAttributeNS(null,"height",a.toString()),p.setAttributeNS(null,"width",u.toString()),p.setAttributeNS(null,"fill","#000000"),p},s.QUIET_ZONE_SIZE=4,s.SVG_NS="http://www.w3.org/2000/svg"}();!function(){function s(){}s.prototype.encode=function(e,n,a,u,p){if(0===e.length)throw new Xt("Found empty contents");if(n!==De.QR_CODE)throw new Xt("Can only encode QR_CODE, but got "+n);if(a<0||u<0)throw new Xt("Requested dimensions are too small: "+a+"x"+u);var w=Nl.L,E=s.QUIET_ZONE_SIZE;null!==p&&(void 0!==p.get(Ki.ERROR_CORRECTION)&&(w=Nl.fromString(p.get(Ki.ERROR_CORRECTION).toString())),void 0!==p.get(Ki.MARGIN)&&(E=Number.parseInt(p.get(Ki.MARGIN).toString(),10)));var I=Wd.encode(e,w,p);return s.renderResult(I,a,u,E)},s.renderResult=function(e,n,a,u){var p=e.getMatrix();if(null===p)throw new Fi;for(var w=p.getWidth(),E=p.getHeight(),I=w+2*u,R=E+2*u,V=Math.max(n,I),W=Math.max(a,R),ee=Math.min(Math.floor(V/I),Math.floor(W/R)),oe=Math.floor((V-w*ee)/2),Ce=Math.floor((W-E*ee)/2),Ne=new ur(V,W),ot=0,ut=Ce;ot<E;ot++,ut+=ee)for(var at=0,Pt=oe;at<w;at++,Pt+=ee)1===p.get(at,ot)&&Ne.setRegion(Pt,ut,ee,ee);return Ne},s.QUIET_ZONE_SIZE=4}();var tu=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();!function(s){function e(n,a,u,p,w,E,I,R){var V=s.call(this,E,I)||this;if(V.yuvData=n,V.dataWidth=a,V.dataHeight=u,V.left=p,V.top=w,p+E>a||w+I>u)throw new Xt("Crop rectangle does not fit within image data.");return R&&V.reverseHorizontal(E,I),V}tu(e,s),e.prototype.getRow=function(n,a){if(n<0||n>=this.getHeight())throw new Xt("Requested row is outside the image: "+n);var u=this.getWidth();return(null==a||a.length<u)&&(a=new Uint8ClampedArray(u)),kn.arraycopy(this.yuvData,(n+this.top)*this.dataWidth+this.left,a,0,u),a},e.prototype.getMatrix=function(){var n=this.getWidth(),a=this.getHeight();if(n===this.dataWidth&&a===this.dataHeight)return this.yuvData;var u=n*a,p=new Uint8ClampedArray(u),w=this.top*this.dataWidth+this.left;if(n===this.dataWidth)return kn.arraycopy(this.yuvData,w,p,0,u),p;for(var E=0;E<a;E++)kn.arraycopy(this.yuvData,w,p,E*n,n),w+=this.dataWidth;return p},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(n,a,u,p){return new e(this.yuvData,this.dataWidth,this.dataHeight,this.left+n,this.top+a,u,p,!1)},e.prototype.renderThumbnail=function(){for(var n=this.getWidth()/e.THUMBNAIL_SCALE_FACTOR,a=this.getHeight()/e.THUMBNAIL_SCALE_FACTOR,u=new Int32Array(n*a),p=this.yuvData,w=this.top*this.dataWidth+this.left,E=0;E<a;E++){for(var I=E*n,R=0;R<n;R++)u[I+R]=4278190080|65793*(255&p[w+R*e.THUMBNAIL_SCALE_FACTOR]);w+=this.dataWidth*e.THUMBNAIL_SCALE_FACTOR}return u},e.prototype.getThumbnailWidth=function(){return this.getWidth()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.getThumbnailHeight=function(){return this.getHeight()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.reverseHorizontal=function(n,a){for(var u=this.yuvData,p=0,w=this.top*this.dataWidth+this.left;p<a;p++,w+=this.dataWidth)for(var E=w+n/2,I=w,R=w+n-1;I<E;I++,R--){var V=u[I];u[I]=u[R],u[R]=V}},e.prototype.invert=function(){return new Re(this)},e.THUMBNAIL_SCALE_FACTOR=2}(Ue);var yu=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();!function(s){function e(n,a,u,p,w,E,I){var R=s.call(this,a,u)||this;if(R.dataWidth=p,R.dataHeight=w,R.left=E,R.top=I,4===n.BYTES_PER_ELEMENT){for(var V=a*u,W=new Uint8ClampedArray(V),ee=0;ee<V;ee++){var oe=n[ee];W[ee]=((oe>>16&255)+(oe>>7&510)+(255&oe))/4&255}R.luminances=W}else R.luminances=n;if(void 0===p&&(R.dataWidth=a),void 0===w&&(R.dataHeight=u),void 0===E&&(R.left=0),void 0===I&&(R.top=0),R.left+a>R.dataWidth||R.top+u>R.dataHeight)throw new Xt("Crop rectangle does not fit within image data.");return R}yu(e,s),e.prototype.getRow=function(n,a){if(n<0||n>=this.getHeight())throw new Xt("Requested row is outside the image: "+n);var u=this.getWidth();return(null==a||a.length<u)&&(a=new Uint8ClampedArray(u)),kn.arraycopy(this.luminances,(n+this.top)*this.dataWidth+this.left,a,0,u),a},e.prototype.getMatrix=function(){var n=this.getWidth(),a=this.getHeight();if(n===this.dataWidth&&a===this.dataHeight)return this.luminances;var u=n*a,p=new Uint8ClampedArray(u),w=this.top*this.dataWidth+this.left;if(n===this.dataWidth)return kn.arraycopy(this.luminances,w,p,0,u),p;for(var E=0;E<a;E++)kn.arraycopy(this.luminances,w,p,E*n,n),w+=this.dataWidth;return p},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(n,a,u,p){return new e(this.luminances,u,p,this.dataWidth,this.dataHeight,this.left+n,this.top+a)},e.prototype.invert=function(){return new Re(this)}}(Ue);var ju=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Pa=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return ju(e,s),e.forName=function(n){return this.getCharacterSetECIByName(n)},e}(vi);const Il=Pa;var wf=function(){function s(){}return s.ISO_8859_1=vi.ISO8859_1,s}();const Ts=wf;var Hu=function(){function s(e,n,a){this.codewords=e,this.numcols=n,this.numrows=a,this.bits=new Uint8Array(n*a),Nt.fill(this.bits,2)}return s.prototype.getNumrows=function(){return this.numrows},s.prototype.getNumcols=function(){return this.numcols},s.prototype.getBits=function(){return this.bits},s.prototype.getBit=function(e,n){return 1===this.bits[n*this.numcols+e]},s.prototype.setBit=function(e,n,a){this.bits[n*this.numcols+e]=a?1:0},s.prototype.noBit=function(e,n){return 2===this.bits[n*this.numcols+e]},s.prototype.place=function(){var e=0,n=4,a=0;do{n===this.numrows&&0===a&&this.corner1(e++),n===this.numrows-2&&0===a&&this.numcols%4!=0&&this.corner2(e++),n===this.numrows-2&&0===a&&this.numcols%8==4&&this.corner3(e++),n===this.numrows+4&&2===a&&this.numcols%8==0&&this.corner4(e++);do{n<this.numrows&&a>=0&&this.noBit(a,n)&&this.utah(n,a,e++),n-=2,a+=2}while(n>=0&&a<this.numcols);n++,a+=3;do{n>=0&&a<this.numcols&&this.noBit(a,n)&&this.utah(n,a,e++),n+=2,a-=2}while(n<this.numrows&&a>=0);n+=3,a++}while(n<this.numrows||a<this.numcols);this.noBit(this.numcols-1,this.numrows-1)&&(this.setBit(this.numcols-1,this.numrows-1,!0),this.setBit(this.numcols-2,this.numrows-2,!0))},s.prototype.module=function(e,n,a,u){e<0&&(e+=this.numrows,n+=4-(this.numrows+4)%8),n<0&&(n+=this.numcols,e+=4-(this.numcols+4)%8);var p=this.codewords.charCodeAt(a);this.setBit(n,e,0!=(p&=1<<8-u))},s.prototype.utah=function(e,n,a){this.module(e-2,n-2,a,1),this.module(e-2,n-1,a,2),this.module(e-1,n-2,a,3),this.module(e-1,n-1,a,4),this.module(e-1,n,a,5),this.module(e,n-2,a,6),this.module(e,n-1,a,7),this.module(e,n,a,8)},s.prototype.corner1=function(e){this.module(this.numrows-1,0,e,1),this.module(this.numrows-1,1,e,2),this.module(this.numrows-1,2,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-1,e,6),this.module(2,this.numcols-1,e,7),this.module(3,this.numcols-1,e,8)},s.prototype.corner2=function(e){this.module(this.numrows-3,0,e,1),this.module(this.numrows-2,0,e,2),this.module(this.numrows-1,0,e,3),this.module(0,this.numcols-4,e,4),this.module(0,this.numcols-3,e,5),this.module(0,this.numcols-2,e,6),this.module(0,this.numcols-1,e,7),this.module(1,this.numcols-1,e,8)},s.prototype.corner3=function(e){this.module(this.numrows-3,0,e,1),this.module(this.numrows-2,0,e,2),this.module(this.numrows-1,0,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-1,e,6),this.module(2,this.numcols-1,e,7),this.module(3,this.numcols-1,e,8)},s.prototype.corner4=function(e){this.module(this.numrows-1,0,e,1),this.module(this.numrows-1,this.numcols-1,e,2),this.module(0,this.numcols-3,e,3),this.module(0,this.numcols-2,e,4),this.module(0,this.numcols-1,e,5),this.module(1,this.numcols-3,e,6),this.module(1,this.numcols-2,e,7),this.module(1,this.numcols-1,e,8)},s}();const nu=Hu;var Wl,yg=[5,7,10,11,12,14,18,20,24,28,36,42,48,56,62,68],hp=[[228,48,15,111,62],[23,68,144,134,240,92,254],[28,24,185,166,223,248,116,255,110,61],[175,138,205,12,194,168,39,245,60,97,120],[41,153,158,91,61,42,142,213,97,178,100,242],[156,97,192,252,95,9,157,119,138,45,18,186,83,185],[83,195,100,39,188,75,66,61,241,213,109,129,94,254,225,48,90,188],[15,195,244,9,233,71,168,2,188,160,153,145,253,79,108,82,27,174,186,172],[52,190,88,205,109,39,176,21,155,197,251,223,155,21,5,172,254,124,12,181,184,96,50,193],[211,231,43,97,71,96,103,174,37,151,170,53,75,34,249,121,17,138,110,213,141,136,120,151,233,168,93,255],[245,127,242,218,130,250,162,181,102,120,84,179,220,251,80,182,229,18,2,4,68,33,101,137,95,119,115,44,175,184,59,25,225,98,81,112],[77,193,137,31,19,38,22,153,247,105,122,2,245,133,242,8,175,95,100,9,167,105,214,111,57,121,21,1,253,57,54,101,248,202,69,50,150,177,226,5,9,5],[245,132,172,223,96,32,117,22,238,133,238,231,205,188,237,87,191,106,16,147,118,23,37,90,170,205,131,88,120,100,66,138,186,240,82,44,176,87,187,147,160,175,69,213,92,253,225,19],[175,9,223,238,12,17,220,208,100,29,175,170,230,192,215,235,150,159,36,223,38,200,132,54,228,146,218,234,117,203,29,232,144,238,22,150,201,117,62,207,164,13,137,245,127,67,247,28,155,43,203,107,233,53,143,46],[242,93,169,50,144,210,39,118,202,188,201,189,143,108,196,37,185,112,134,230,245,63,197,190,250,106,185,221,175,64,114,71,161,44,147,6,27,218,51,63,87,10,40,130,188,17,163,31,176,170,4,107,232,7,94,166,224,124,86,47,11,204],[220,228,173,89,251,149,159,56,89,33,147,244,154,36,73,127,213,136,248,180,234,197,158,177,68,122,93,213,15,160,227,236,66,139,153,185,202,167,179,25,220,232,96,210,231,136,223,239,181,241,59,52,172,25,49,232,211,189,64,54,108,153,132,63,96,103,82,186]],Lc=(Wl=function(s,e){for(var n=1,a=0;a<255;a++)e[a]=n,s[n]=a,(n*=2)>=256&&(n^=301);return{LOG:s,ALOG:e}}([],[]),Wl.LOG),bf=Wl.ALOG,qd="[)>\x1e05\x1d",$u="[)>\x1e06\x1d",Wu=function(){function s(){}return s.encodeECC200=function(e,n){if(e.length!==n.getDataCapacity())throw new Error("The number of codewords does not match the selected symbol");var a=new _r;a.append(e);var u=n.getInterleavedBlockCount();if(1===u){var p=this.createECCBlock(e,n.getErrorCodewords());a.append(p)}else{for(var w=[],E=[],I=0;I<u;I++)w[I]=n.getDataLengthForInterleavedBlock(I+1),E[I]=n.getErrorLengthForInterleavedBlock(I+1);for(var R=0;R<u;R++){for(var V=new _r,W=R;W<n.getDataCapacity();W+=u)V.append(e.charAt(W));p=this.createECCBlock(V.toString(),E[R]);for(var ee=0,oe=R;oe<E[R]*u;oe+=u)a.setCharAt(n.getDataCapacity()+oe,p.charAt(ee++))}}return a.toString()},s.createECCBlock=function(e,n){for(var a=-1,u=0;u<yg.length;u++)if(yg[u]===n){a=u;break}if(a<0)throw new Error("Illegal number of error correction codewords specified: "+n);var p=hp[a],w=[];for(u=0;u<n;u++)w[u]=0;for(u=0;u<e.length;u++){for(var E=w[n-1]^e.charAt(u).charCodeAt(0),I=n-1;I>0;I--)w[I]=0!==E&&0!==p[I]?w[I-1]^bf[(Lc[E]+Lc[p[I]])%255]:w[I-1];w[0]=0!==E&&0!==p[0]?bf[(Lc[E]+Lc[p[0]])%255]:0}var R=[];for(u=0;u<n;u++)R[u]=w[n-u-1];return R.map(function(V){return String.fromCharCode(V)}).join("")},s}();const Df=Wu;var mp=function(){function s(){}return s.prototype.getEncodingMode=function(){return 0},s.prototype.encode=function(e){if(Zi.determineConsecutiveDigitCount(e.getMessage(),e.pos)>=2)e.writeCodeword(this.encodeASCIIDigits(e.getMessage().charCodeAt(e.pos),e.getMessage().charCodeAt(e.pos+1))),e.pos+=2;else{var a=e.getCurrentChar(),u=Zi.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(u!==this.getEncodingMode())switch(u){case 5:return e.writeCodeword(231),void e.signalEncoderChange(5);case 1:return e.writeCodeword(230),void e.signalEncoderChange(1);case 3:e.writeCodeword(238),e.signalEncoderChange(3);break;case 2:e.writeCodeword(239),e.signalEncoderChange(2);break;case 4:e.writeCodeword(240),e.signalEncoderChange(4);break;default:throw new Error("Illegal mode: "+u)}else Zi.isExtendedASCII(a)?(e.writeCodeword(235),e.writeCodeword(a-128+1),e.pos++):(e.writeCodeword(a+1),e.pos++)}},s.prototype.encodeASCIIDigits=function(e,n){if(Zi.isDigit(e)&&Zi.isDigit(n))return 10*(e-48)+(n-48)+130;throw new Error("not digits: "+e+n)},s}(),Lh=function(){function s(){}return s.prototype.getEncodingMode=function(){return 5},s.prototype.encode=function(e){var n=new _r;for(n.append(0);e.hasMoreCharacters();){var a=e.getCurrentChar();if(n.append(a),e.pos++,Zi.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}var p=n.length()-1,E=e.getCodewordCount()+p+1;e.updateSymbolInfo(E);var I=e.getSymbolInfo().getDataCapacity()-E>0;if(e.hasMoreCharacters()||I)if(p<=249)n.setCharAt(0,Pr.getCharAt(p));else{if(!(p<=1555))throw new Error("Message length not in valid ranges: "+p);n.setCharAt(0,Pr.getCharAt(Math.floor(p/250)+249)),n.insert(1,Pr.getCharAt(p%250))}var R=0;for(a=n.length();R<a;R++)e.writeCodeword(this.randomize255State(n.charAt(R).charCodeAt(0),e.getCodewordCount()+1))},s.prototype.randomize255State=function(e,n){var u=e+(149*n%255+1);return u<=255?u:u-256},s}(),sl=function(){function s(){}return s.prototype.getEncodingMode=function(){return 1},s.prototype.encodeMaximal=function(e){for(var n=new _r,a=0,u=e.pos,p=0;e.hasMoreCharacters();){var w=e.getCurrentChar();e.pos++,a=this.encodeChar(w,n),n.length()%3==0&&(u=e.pos,p=n.length())}if(p!==n.length()){var E=Math.floor(n.length()/3*2),I=Math.floor(e.getCodewordCount()+E+1);e.updateSymbolInfo(I);var R=e.getSymbolInfo().getDataCapacity()-I,V=Math.floor(n.length()%3);(2===V&&2!==R||1===V&&(a>3||1!==R))&&(e.pos=u)}n.length()>0&&e.writeCodeword(230),this.handleEOD(e,n)},s.prototype.encode=function(e){for(var n=new _r;e.hasMoreCharacters();){var a=e.getCurrentChar();e.pos++;var u=this.encodeChar(a,n),p=2*Math.floor(n.length()/3),w=e.getCodewordCount()+p;e.updateSymbolInfo(w);var E=e.getSymbolInfo().getDataCapacity()-w;if(!e.hasMoreCharacters()){var I=new _r;for(n.length()%3==2&&2!==E&&(u=this.backtrackOneCharacter(e,n,I,u));n.length()%3==1&&(u>3||1!==E);)u=this.backtrackOneCharacter(e,n,I,u);break}if(n.length()%3==0&&Zi.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}this.handleEOD(e,n)},s.prototype.backtrackOneCharacter=function(e,n,a,u){var p=n.length(),w=n.toString().substring(0,p-u);n.setLengthToZero(),n.append(w),e.pos--;var E=e.getCurrentChar();return u=this.encodeChar(E,a),e.resetSymbolInfo(),u},s.prototype.writeNextTriplet=function(e,n){e.writeCodewords(this.encodeToCodewords(n.toString()));var a=n.toString().substring(3);n.setLengthToZero(),n.append(a)},s.prototype.handleEOD=function(e,n){var a=Math.floor(n.length()/3*2),u=n.length()%3,p=e.getCodewordCount()+a;e.updateSymbolInfo(p);var w=e.getSymbolInfo().getDataCapacity()-p;if(2===u){for(n.append("\0");n.length()>=3;)this.writeNextTriplet(e,n);e.hasMoreCharacters()&&e.writeCodeword(254)}else if(1===w&&1===u){for(;n.length()>=3;)this.writeNextTriplet(e,n);e.hasMoreCharacters()&&e.writeCodeword(254),e.pos--}else{if(0!==u)throw new Error("Unexpected case. Please report!");for(;n.length()>=3;)this.writeNextTriplet(e,n);(w>0||e.hasMoreCharacters())&&e.writeCodeword(254)}e.signalEncoderChange(0)},s.prototype.encodeChar=function(e,n){return e===" ".charCodeAt(0)?(n.append(3),1):e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)?(n.append(e-48+4),1):e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)?(n.append(e-65+14),1):e<" ".charCodeAt(0)?(n.append(0),n.append(e),2):e<="/".charCodeAt(0)?(n.append(1),n.append(e-33),2):e<="@".charCodeAt(0)?(n.append(1),n.append(e-58+15),2):e<="_".charCodeAt(0)?(n.append(1),n.append(e-91+22),2):e<=127?(n.append(2),n.append(e-96),2):(n.append("1\x1e"),2+this.encodeChar(e-128,n))},s.prototype.encodeToCodewords=function(e){var n=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,a=n/256,u=n%256,p=new _r;return p.append(a),p.append(u),p.toString()},s}(),xu=function(){function s(){}return s.prototype.getEncodingMode=function(){return 4},s.prototype.encode=function(e){for(var n=new _r;e.hasMoreCharacters();){var a=e.getCurrentChar();if(this.encodeChar(a,n),e.pos++,n.length()>=4){e.writeCodewords(this.encodeToCodewords(n.toString()));var p=n.toString().substring(4);if(n.setLengthToZero(),n.append(p),Zi.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(0);break}}}n.append(Pr.getCharAt(31)),this.handleEOD(e,n)},s.prototype.handleEOD=function(e,n){try{var a=n.length();if(0===a)return;if(1===a){e.updateSymbolInfo();var u=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount(),p=e.getRemainingCharacters();if(p>u&&(e.updateSymbolInfo(e.getCodewordCount()+1),u=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount()),p<=u&&u<=2)return}if(a>4)throw new Error("Count must not exceed 4");var w=a-1,E=this.encodeToCodewords(n.toString()),R=!e.hasMoreCharacters()&&w<=2;w<=2&&(e.updateSymbolInfo(e.getCodewordCount()+w),(u=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount())>=3&&(R=!1,e.updateSymbolInfo(e.getCodewordCount()+E.length))),R?(e.resetSymbolInfo(),e.pos-=w):e.writeCodewords(E)}finally{e.signalEncoderChange(0)}},s.prototype.encodeChar=function(e,n){e>=" ".charCodeAt(0)&&e<="?".charCodeAt(0)?n.append(e):e>="@".charCodeAt(0)&&e<="^".charCodeAt(0)?n.append(Pr.getCharAt(e-64)):Zi.illegalCharacter(Pr.getCharAt(e))},s.prototype.encodeToCodewords=function(e){var n=e.length;if(0===n)throw new Error("StringBuilder must not be empty");var E=(e.charAt(0).charCodeAt(0)<<18)+((n>=2?e.charAt(1).charCodeAt(0):0)<<12)+((n>=3?e.charAt(2).charCodeAt(0):0)<<6)+(n>=4?e.charAt(3).charCodeAt(0):0),I=E>>16&255,R=E>>8&255,V=255&E,W=new _r;return W.append(I),n>=2&&W.append(R),n>=3&&W.append(V),W.toString()},s}(),Tf=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),mo=function(){function s(e,n,a,u,p,w,E,I){void 0===E&&(E=0),void 0===I&&(I=0),this.rectangular=e,this.dataCapacity=n,this.errorCodewords=a,this.matrixWidth=u,this.matrixHeight=p,this.dataRegions=w,this.rsBlockData=E,this.rsBlockError=I}return s.lookup=function(e,n,a,u,p){var w,E;void 0===n&&(n=0),void 0===a&&(a=null),void 0===u&&(u=null),void 0===p&&(p=!0);try{for(var I=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(bd),R=I.next();!R.done;R=I.next()){var V=R.value;if((1!==n||!V.rectangular)&&(2!==n||V.rectangular)&&(null==a||!(V.getSymbolWidth()<a.getWidth()||V.getSymbolHeight()<a.getHeight()))&&(null==u||!(V.getSymbolWidth()>u.getWidth()||V.getSymbolHeight()>u.getHeight()))&&e<=V.dataCapacity)return V}}catch(W){w={error:W}}finally{try{R&&!R.done&&(E=I.return)&&E.call(I)}finally{if(w)throw w.error}}if(p)throw new Error("Can't find a symbol arrangement that matches the message. Data codewords: "+e);return null},s.prototype.getHorizontalDataRegions=function(){switch(this.dataRegions){case 1:return 1;case 2:case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},s.prototype.getVerticalDataRegions=function(){switch(this.dataRegions){case 1:case 2:return 1;case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},s.prototype.getSymbolDataWidth=function(){return this.getHorizontalDataRegions()*this.matrixWidth},s.prototype.getSymbolDataHeight=function(){return this.getVerticalDataRegions()*this.matrixHeight},s.prototype.getSymbolWidth=function(){return this.getSymbolDataWidth()+2*this.getHorizontalDataRegions()},s.prototype.getSymbolHeight=function(){return this.getSymbolDataHeight()+2*this.getVerticalDataRegions()},s.prototype.getCodewordCount=function(){return this.dataCapacity+this.errorCodewords},s.prototype.getInterleavedBlockCount=function(){return this.rsBlockData?this.dataCapacity/this.rsBlockData:1},s.prototype.getDataCapacity=function(){return this.dataCapacity},s.prototype.getErrorCodewords=function(){return this.errorCodewords},s.prototype.getDataLengthForInterleavedBlock=function(e){return this.rsBlockData},s.prototype.getErrorLengthForInterleavedBlock=function(e){return this.rsBlockError},s}();const wu=mo;var Sf=function(s){function e(){return s.call(this,!1,1558,620,22,22,36,-1,62)||this}return Tf(e,s),e.prototype.getInterleavedBlockCount=function(){return 10},e.prototype.getDataLengthForInterleavedBlock=function(n){return n<=8?156:155},e}(mo),bd=[new mo(!1,3,5,8,8,1),new mo(!1,5,7,10,10,1),new mo(!0,5,7,16,6,1),new mo(!1,8,10,12,12,1),new mo(!0,10,11,14,6,2),new mo(!1,12,12,14,14,1),new mo(!0,16,14,24,10,1),new mo(!1,18,14,16,16,1),new mo(!1,22,18,18,18,1),new mo(!0,22,18,16,10,2),new mo(!1,30,20,20,20,1),new mo(!0,32,24,16,14,2),new mo(!1,36,24,22,22,1),new mo(!1,44,28,24,24,1),new mo(!0,49,28,22,14,2),new mo(!1,62,36,14,14,4),new mo(!1,86,42,16,16,4),new mo(!1,114,48,18,18,4),new mo(!1,144,56,20,20,4),new mo(!1,174,68,22,22,4),new mo(!1,204,84,24,24,4,102,42),new mo(!1,280,112,14,14,16,140,56),new mo(!1,368,144,16,16,16,92,36),new mo(!1,456,192,18,18,16,114,48),new mo(!1,576,224,20,20,16,144,56),new mo(!1,696,272,22,22,16,174,68),new mo(!1,816,336,24,24,16,136,56),new mo(!1,1050,408,18,18,36,175,68),new mo(!1,1304,496,20,20,36,163,62),new Sf],Ed=function(){function s(e){this.msg=e,this.pos=0,this.skipAtEnd=0;for(var n=e.split("").map(function(E){return E.charCodeAt(0)}),a=new _r,u=0,p=n.length;u<p;u++){var w=String.fromCharCode(255&n[u]);if("?"===w&&"?"!==e.charAt(u))throw new Error("Message contains characters outside ISO-8859-1 encoding.");a.append(w)}this.msg=a.toString(),this.shape=0,this.codewords=new _r,this.newEncoding=-1}return s.prototype.setSymbolShape=function(e){this.shape=e},s.prototype.setSizeConstraints=function(e,n){this.minSize=e,this.maxSize=n},s.prototype.getMessage=function(){return this.msg},s.prototype.setSkipAtEnd=function(e){this.skipAtEnd=e},s.prototype.getCurrentChar=function(){return this.msg.charCodeAt(this.pos)},s.prototype.getCurrent=function(){return this.msg.charCodeAt(this.pos)},s.prototype.getCodewords=function(){return this.codewords},s.prototype.writeCodewords=function(e){this.codewords.append(e)},s.prototype.writeCodeword=function(e){this.codewords.append(e)},s.prototype.getCodewordCount=function(){return this.codewords.length()},s.prototype.getNewEncoding=function(){return this.newEncoding},s.prototype.signalEncoderChange=function(e){this.newEncoding=e},s.prototype.resetEncoderSignal=function(){this.newEncoding=-1},s.prototype.hasMoreCharacters=function(){return this.pos<this.getTotalMessageCharCount()},s.prototype.getTotalMessageCharCount=function(){return this.msg.length-this.skipAtEnd},s.prototype.getRemainingCharacters=function(){return this.getTotalMessageCharCount()-this.pos},s.prototype.getSymbolInfo=function(){return this.symbolInfo},s.prototype.updateSymbolInfo=function(e){void 0===e&&(e=this.getCodewordCount()),(null==this.symbolInfo||e>this.symbolInfo.getDataCapacity())&&(this.symbolInfo=wu.lookup(e,this.shape,this.minSize,this.maxSize,!0))},s.prototype.resetSymbolInfo=function(){this.symbolInfo=null},s}(),Cd=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Ad=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Cd(e,s),e.prototype.getEncodingMode=function(){return 3},e.prototype.encode=function(n){for(var a=new _r;n.hasMoreCharacters();){var u=n.getCurrentChar();if(n.pos++,this.encodeChar(u,a),a.length()%3==0&&(this.writeNextTriplet(n,a),Zi.lookAheadTest(n.getMessage(),n.pos,this.getEncodingMode())!==this.getEncodingMode())){n.signalEncoderChange(0);break}}this.handleEOD(n,a)},e.prototype.encodeChar=function(n,a){switch(n){case 13:a.append(0);break;case"*".charCodeAt(0):a.append(1);break;case">".charCodeAt(0):a.append(2);break;case" ".charCodeAt(0):a.append(3);break;default:n>="0".charCodeAt(0)&&n<="9".charCodeAt(0)?a.append(n-48+4):n>="A".charCodeAt(0)&&n<="Z".charCodeAt(0)?a.append(n-65+14):Zi.illegalCharacter(Pr.getCharAt(n))}return 1},e.prototype.handleEOD=function(n,a){n.updateSymbolInfo();var u=n.getSymbolInfo().getDataCapacity()-n.getCodewordCount(),p=a.length();n.pos-=p,(n.getRemainingCharacters()>1||u>1||n.getRemainingCharacters()!==u)&&n.writeCodeword(254),n.getNewEncoding()<0&&n.signalEncoderChange(0)},e}(sl),_p=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Yd=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return _p(e,s),e.prototype.getEncodingMode=function(){return 2},e.prototype.encodeChar=function(n,a){return n===" ".charCodeAt(0)?(a.append(3),1):n>="0".charCodeAt(0)&&n<="9".charCodeAt(0)?(a.append(n-48+4),1):n>="a".charCodeAt(0)&&n<="z".charCodeAt(0)?(a.append(n-97+14),1):n<" ".charCodeAt(0)?(a.append(0),a.append(n),2):n<="/".charCodeAt(0)?(a.append(1),a.append(n-33),2):n<="@".charCodeAt(0)?(a.append(1),a.append(n-58+15),2):n>="[".charCodeAt(0)&&n<="_".charCodeAt(0)?(a.append(1),a.append(n-91+22),2):n==="`".charCodeAt(0)?(a.append(2),a.append(0),2):n<="Z".charCodeAt(0)?(a.append(2),a.append(n-65+1),2):n<=127?(a.append(2),a.append(n-123+27),2):(a.append("1\x1e"),2+this.encodeChar(n-128,a))},e}(sl),If=function(){function s(){}return s.randomize253State=function(e){var a=149*e%253+1+129;return a<=254?a:a-254},s.encodeHighLevel=function(e,n,a,u,p){void 0===n&&(n=0),void 0===a&&(a=null),void 0===u&&(u=null),void 0===p&&(p=!1);var w=new sl,E=[new mp,w,new Yd,new Ad,new xu,new Lh],I=new Ed(e);I.setSymbolShape(n),I.setSizeConstraints(a,u),e.startsWith(qd)&&e.endsWith("\x1e\x04")?(I.writeCodeword(236),I.setSkipAtEnd(2),I.pos+=7):e.startsWith($u)&&e.endsWith("\x1e\x04")&&(I.writeCodeword(237),I.setSkipAtEnd(2),I.pos+=7);var R=0;for(p&&(w.encodeMaximal(I),R=I.getNewEncoding(),I.resetEncoderSignal());I.hasMoreCharacters();)E[R].encode(I),I.getNewEncoding()>=0&&(R=I.getNewEncoding(),I.resetEncoderSignal());var V=I.getCodewordCount();I.updateSymbolInfo();var W=I.getSymbolInfo().getDataCapacity();V<W&&0!==R&&5!==R&&4!==R&&I.writeCodeword("\xfe");var ee=I.getCodewords();for(ee.length()<W&&ee.append(129);ee.length()<W;)ee.append(this.randomize253State(ee.length()+1));return I.getCodewords().toString()},s.lookAheadTest=function(e,n,a){var u=this.lookAheadTestIntern(e,n,a);if(3===a&&3===u){for(var p=Math.min(n+3,e.length),w=n;w<p;w++)if(!this.isNativeX12(e.charCodeAt(w)))return 0}else if(4===a&&4===u)for(p=Math.min(n+4,e.length),w=n;w<p;w++)if(!this.isNativeEDIFACT(e.charCodeAt(w)))return 0;return u},s.lookAheadTestIntern=function(e,n,a){if(n>=e.length)return a;var u;0===a?u=[0,1,1,1,1,1.25]:(u=[1,2,2,2,2,2.25])[a]=0;for(var p=0,w=new Uint8Array(6),E=[];;){if(n+p===e.length){Nt.fill(w,0),Nt.fill(E,0);var I=this.findMinimums(u,E,mt.MAX_VALUE,w),R=this.getMinimumCount(w);if(E[0]===I)return 0;if(1===R){if(w[5]>0)return 5;if(w[4]>0)return 4;if(w[2]>0)return 2;if(w[3]>0)return 3}return 1}var V=e.charCodeAt(n+p);if(p++,this.isDigit(V)?u[0]+=.5:this.isExtendedASCII(V)?(u[0]=Math.ceil(u[0]),u[0]+=2):(u[0]=Math.ceil(u[0]),u[0]++),this.isNativeC40(V)?u[1]+=2/3:this.isExtendedASCII(V)?u[1]+=8/3:u[1]+=4/3,this.isNativeText(V)?u[2]+=2/3:this.isExtendedASCII(V)?u[2]+=8/3:u[2]+=4/3,this.isNativeX12(V)?u[3]+=2/3:this.isExtendedASCII(V)?u[3]+=13/3:u[3]+=10/3,this.isNativeEDIFACT(V)?u[4]+=3/4:this.isExtendedASCII(V)?u[4]+=4.25:u[4]+=3.25,this.isSpecialB256(V)?u[5]+=4:u[5]++,p>=4){if(Nt.fill(w,0),Nt.fill(E,0),this.findMinimums(u,E,mt.MAX_VALUE,w),E[0]<this.min(E[5],E[1],E[2],E[3],E[4]))return 0;if(E[5]<E[0]||E[5]+1<this.min(E[1],E[2],E[3],E[4]))return 5;if(E[4]+1<this.min(E[5],E[1],E[2],E[3],E[0]))return 4;if(E[2]+1<this.min(E[5],E[1],E[4],E[3],E[0]))return 2;if(E[3]+1<this.min(E[5],E[1],E[4],E[2],E[0]))return 3;if(E[1]+1<this.min(E[0],E[5],E[4],E[2])){if(E[1]<E[3])return 1;if(E[1]===E[3]){for(var W=n+p+1;W<e.length;){var ee=e.charCodeAt(W);if(this.isX12TermSep(ee))return 3;if(!this.isNativeX12(ee))break;W++}return 1}}}}},s.min=function(e,n,a,u,p){var w=Math.min(e,Math.min(n,Math.min(a,u)));return void 0===p?w:Math.min(w,p)},s.findMinimums=function(e,n,a,u){for(var p=0;p<6;p++){var w=n[p]=Math.ceil(e[p]);a>w&&(a=w,Nt.fill(u,0)),a===w&&(u[p]=u[p]+1)}return a},s.getMinimumCount=function(e){for(var n=0,a=0;a<6;a++)n+=e[a];return n||0},s.isDigit=function(e){return e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)},s.isExtendedASCII=function(e){return e>=128&&e<=255},s.isNativeC40=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},s.isNativeText=function(e){return e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="a".charCodeAt(0)&&e<="z".charCodeAt(0)},s.isNativeX12=function(e){return this.isX12TermSep(e)||e===" ".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0)||e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)},s.isX12TermSep=function(e){return 13===e||e==="*".charCodeAt(0)||e===">".charCodeAt(0)},s.isNativeEDIFACT=function(e){return e>=" ".charCodeAt(0)&&e<="^".charCodeAt(0)},s.isSpecialB256=function(e){return!1},s.determineConsecutiveDigitCount=function(e,n){void 0===n&&(n=0);for(var a=e.length,u=n;u<a&&this.isDigit(e.charCodeAt(u));)u++;return u-n},s.illegalCharacter=function(e){var n=mt.toHexString(e.charCodeAt(0));throw n="0000".substring(0,4-n.length)+n,new Error("Illegal character: "+e+" (0x"+n+")")},s}();const Zi=If;var bu=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Mf=function(){function s(e){this.charset=e,this.name=e.name}return s.prototype.canEncode=function(e){try{return null!=Ai.encode(e,this.charset)}catch{return!1}},s}(),_l=function(){function s(e,n,a){var u,p,w,E,I,R;this.ENCODERS=["IBM437","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16","windows-1250","windows-1251","windows-1252","windows-1256","Shift_JIS"].map(function(Ei){return new Mf(Il.forName(Ei))}),this.encoders=[];var V=[];V.push(new Mf(Ts.ISO_8859_1));for(var W=null!=n&&n.name.startsWith("UTF"),ee=0;ee<e.length;ee++){var oe=!1;try{for(var Ce=(u=void 0,bu(V)),Ne=Ce.next();!Ne.done;Ne=Ce.next()){var ot=Ne.value,ut=e.charAt(ee);if(ut.charCodeAt(0)===a||ot.canEncode(ut)){oe=!0;break}}}catch(Ei){u={error:Ei}}finally{try{Ne&&!Ne.done&&(p=Ce.return)&&p.call(Ce)}finally{if(u)throw u.error}}if(!oe)try{for(var Pt=(w=void 0,bu(this.ENCODERS)),Wt=Pt.next();!Wt.done;Wt=Pt.next())if((ot=Wt.value).canEncode(e.charAt(ee))){V.push(ot),oe=!0;break}}catch(Ei){w={error:Ei}}finally{try{Wt&&!Wt.done&&(E=Pt.return)&&E.call(Pt)}finally{if(w)throw w.error}}oe||(W=!0)}if(1!==V.length||W){this.encoders=[];var wn=0;try{for(var Un=bu(V),Xn=Un.next();!Xn.done;Xn=Un.next())this.encoders[wn++]=ot=Xn.value}catch(Ei){I={error:Ei}}finally{try{Xn&&!Xn.done&&(R=Un.return)&&R.call(Un)}finally{if(I)throw I.error}}}else this.encoders=[V[0]];var hr=-1;if(null!=n)for(ee=0;ee<this.encoders.length;ee++)if(null!=this.encoders[ee]&&n.name===this.encoders[ee].name){hr=ee;break}this.priorityEncoderIndex=hr}return s.prototype.length=function(){return this.encoders.length},s.prototype.getCharsetName=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].name},s.prototype.getCharset=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].charset},s.prototype.getECIValue=function(e){return this.encoders[e].charset.getValueIdentifier()},s.prototype.getPriorityEncoderIndex=function(){return this.priorityEncoderIndex},s.prototype.canEncode=function(e,n){if(!(n<this.length()))throw new Error("index must be less than length");return!0},s.prototype.encode=function(e,n){if(!(n<this.length()))throw new Error("index must be less than length");return Ai.encode(Pr.getCharAt(e),this.encoders[n].name)},s}(),vp=function(){function s(e,n,a){this.fnc1=a;var u=new _l(e,n,a);if(1===u.length())for(var p=0;p<this.bytes.length;p++){var w=e.charAt(p).charCodeAt(0);this.bytes[p]=w===a?1e3:w}else this.bytes=this.encodeMinimally(e,u,a)}return s.prototype.getFNC1Character=function(){return this.fnc1},s.prototype.length=function(){return this.bytes.length},s.prototype.haveNCharacters=function(e,n){if(e+n-1>=this.bytes.length)return!1;for(var a=0;a<n;a++)if(this.isECI(e+a))return!1;return!0},s.prototype.charAt=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(this.isECI(e))throw new Error("value at "+e+" is not a character but an ECI");return this.isFNC1(e)?this.fnc1:this.bytes[e]},s.prototype.subSequence=function(e,n){if(e<0||e>n||n>this.length())throw new Error(""+e);for(var a=new _r,u=e;u<n;u++){if(this.isECI(u))throw new Error("value at "+u+" is not a character but an ECI");a.append(this.charAt(u))}return a.toString()},s.prototype.isECI=function(e){if(e<0||e>=this.length())throw new Error(""+e);return this.bytes[e]>255&&this.bytes[e]<=999},s.prototype.isFNC1=function(e){if(e<0||e>=this.length())throw new Error(""+e);return 1e3===this.bytes[e]},s.prototype.getECIValue=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(!this.isECI(e))throw new Error("value at "+e+" is not an ECI but a character");return this.bytes[e]-256},s.prototype.addEdge=function(e,n,a){(null==e[n][a.encoderIndex]||e[n][a.encoderIndex].cachedTotalSize>a.cachedTotalSize)&&(e[n][a.encoderIndex]=a)},s.prototype.addEdges=function(e,n,a,u,p,w){var E=e.charAt(u).charCodeAt(0),I=0,R=n.length();n.getPriorityEncoderIndex()>=0&&(E===w||n.canEncode(E,n.getPriorityEncoderIndex()))&&(R=(I=n.getPriorityEncoderIndex())+1);for(var V=I;V<R;V++)(E===w||n.canEncode(E,V))&&this.addEdge(a,u+1,new kh(E,n,V,p,w))},s.prototype.encodeMinimally=function(e,n,a){var u=e.length,p=new(kh[u+1][n.length()]);this.addEdges(e,n,p,0,null,a);for(var w=1;w<=u;w++){for(var E=0;E<n.length();E++)null!=p[w][E]&&w<u&&this.addEdges(e,n,p,w,p[w][E],a);for(E=0;E<n.length();E++)p[w-1][E]=null}var I=-1,R=mt.MAX_VALUE;for(E=0;E<n.length();E++)if(null!=p[u][E]){var V=p[u][E];V.cachedTotalSize<R&&(R=V.cachedTotalSize,I=E)}if(I<0)throw new Error('Failed to encode "'+e+'"');for(var W=[],ee=p[u][I];null!=ee;){if(ee.isFNC1())W.unshift(1e3);else{var oe=n.encode(ee.c,ee.encoderIndex);for(w=oe.length-1;w>=0;w--)W.unshift(255&oe[w])}(null===ee.previous?0:ee.previous.encoderIndex)!==ee.encoderIndex&&W.unshift(256+n.getECIValue(ee.encoderIndex)),ee=ee.previous}var Ne=[];for(w=0;w<Ne.length;w++)Ne[w]=W[w];return Ne},s}(),kh=function(){function s(e,n,a,u,p){this.c=e,this.encoderSet=n,this.encoderIndex=a,this.previous=u,this.fnc1=p,this.c=e===p?1e3:e;var w=this.isFNC1()?1:n.encode(e,a).length;(null===u?0:u.encoderIndex)!==a&&(w+=3),null!=u&&(w+=u.cachedTotalSize),this.cachedTotalSize=w}return s.prototype.isFNC1=function(){return 1e3===this.c},s}(),ya=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Nc=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ru=function(s,e){var n="function"==typeof Symbol&&s[Symbol.iterator];if(!n)return s;var u,w,a=n.call(s),p=[];try{for(;(void 0===e||e-- >0)&&!(u=a.next()).done;)p.push(u.value)}catch(E){w={error:E}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(w)throw w.error}}return p},or=function(s){return s[s.ASCII=0]="ASCII",s[s.C40=1]="C40",s[s.TEXT=2]="TEXT",s[s.X12=3]="X12",s[s.EDF=4]="EDF",s[s.B256=5]="B256",s}(or||{}),hc=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],Vs=function(){function s(){}return s.isExtendedASCII=function(e,n){return e!==n&&e>=128&&e<=255},s.isInC40Shift1Set=function(e){return e<=31},s.isInC40Shift2Set=function(e,n){var a,u;try{for(var p=Nc(hc),w=p.next();!w.done;w=p.next())if(w.value.charCodeAt(0)===e)return!0}catch(I){a={error:I}}finally{try{w&&!w.done&&(u=p.return)&&u.call(p)}finally{if(a)throw a.error}}return e===n},s.isInTextShift1Set=function(e){return this.isInC40Shift1Set(e)},s.isInTextShift2Set=function(e,n){return this.isInC40Shift2Set(e,n)},s.encodeHighLevel=function(e,n,a,u){void 0===n&&(n=null),void 0===a&&(a=-1),void 0===u&&(u=0);var p=0;return e.startsWith(qd)&&e.endsWith("\x1e\x04")?(p=5,e=e.substring(7,e.length-2)):e.startsWith($u)&&e.endsWith("\x1e\x04")&&(p=6,e=e.substring(7,e.length-2)),decodeURIComponent(escape(String.fromCharCode.apply(String,function(){for(var s=[],e=0;e<arguments.length;e++)s=s.concat(ru(arguments[e]));return s}(this.encode(e,n,a,u,p)))))},s.encode=function(e,n,a,u,p){return this.encodeMinimally(new La(e,n,a,u,p)).getBytes()},s.addEdge=function(e,n){var a=n.fromPosition+n.characterLength;(null===e[a][n.getEndMode()]||e[a][n.getEndMode()].cachedTotalSize>n.cachedTotalSize)&&(e[a][n.getEndMode()]=n)},s.getNumberOfC40Words=function(e,n,a,u){for(var p=0,w=n;w<e.length();w++){if(e.isECI(w))return u[0]=0,0;var E=e.charAt(w);if(a&&Zi.isNativeC40(E)||!a&&Zi.isNativeText(E))p++;else if(s.isExtendedASCII(E,e.getFNC1Character())){var I=255&E;I>=128&&(a&&Zi.isNativeC40(I-128)||!a&&Zi.isNativeText(I-128))?p+=3:p+=4}else p+=2;if(p%3==0||(p-2)%3==0&&w+1===e.length())return u[0]=w-n+1,Math.ceil(p/3)}return u[0]=0,0},s.addEdges=function(e,n,a,u){var p,w;if(e.isECI(a))this.addEdge(n,new Rs(e,or.ASCII,a,1,u));else{var oe,E=e.charAt(a);if(null===u||u.getEndMode()!==or.EDF){Zi.isDigit(E)&&e.haveNCharacters(a,2)&&Zi.isDigit(e.charAt(a+1))?this.addEdge(n,new Rs(e,or.ASCII,a,2,u)):this.addEdge(n,new Rs(e,or.ASCII,a,1,u));var I=[or.C40,or.TEXT];try{for(var R=Nc(I),V=R.next();!V.done;V=R.next()){var W=V.value,ee=[];s.getNumberOfC40Words(e,a,W===or.C40,ee)>0&&this.addEdge(n,new Rs(e,W,a,ee[0],u))}}catch(Ne){p={error:Ne}}finally{try{V&&!V.done&&(w=R.return)&&w.call(R)}finally{if(p)throw p.error}}e.haveNCharacters(a,3)&&Zi.isNativeX12(e.charAt(a))&&Zi.isNativeX12(e.charAt(a+1))&&Zi.isNativeX12(e.charAt(a+2))&&this.addEdge(n,new Rs(e,or.X12,a,3,u)),this.addEdge(n,new Rs(e,or.B256,a,1,u))}for(oe=0;oe<3;oe++){var Ce=a+oe;if(!e.haveNCharacters(Ce,1)||!Zi.isNativeEDIFACT(e.charAt(Ce)))break;this.addEdge(n,new Rs(e,or.EDF,a,oe+1,u))}3===oe&&e.haveNCharacters(a,4)&&Zi.isNativeEDIFACT(e.charAt(a+3))&&this.addEdge(n,new Rs(e,or.EDF,a,4,u))}},s.encodeMinimally=function(e){var n=e.length(),a=Array(n+1).fill(null).map(function(){return Array(6).fill(0)});this.addEdges(e,a,0,null);for(var u=1;u<=n;u++){for(var p=0;p<6;p++)null!==a[u][p]&&u<n&&this.addEdges(e,a,u,a[u][p]);for(p=0;p<6;p++)a[u-1][p]=null}var w=-1,E=mt.MAX_VALUE;for(p=0;p<6;p++)if(null!==a[n][p]){var I=a[n][p],R=p>=1&&p<=3?I.cachedTotalSize+1:I.cachedTotalSize;R<E&&(E=R,w=p)}if(w<0)throw new Error('Failed to encode "'+e+'"');return new ic(a[n][w])},s}(),ic=function(){function s(e){var n=e.input,a=0,u=[],p=[],w=[];(e.mode===or.C40||e.mode===or.TEXT||e.mode===or.X12)&&e.getEndMode()!==or.ASCII&&(a+=this.prepend(Rs.getBytes(254),u));for(var E=e;null!==E;)a+=this.prepend(E.getDataBytes(),u),(null===E.previous||E.getPreviousStartMode()!==E.getMode())&&(E.getMode()===or.B256&&(a<=249?(u.unshift(a),a++):(u.unshift(a%250),u.unshift(a/250+249),a+=2),p.push(u.length),w.push(a)),this.prepend(E.getLatchBytes(),u),a=0),E=E.previous;5===n.getMacroId()?a+=this.prepend(Rs.getBytes(236),u):6===n.getMacroId()&&(a+=this.prepend(Rs.getBytes(237),u)),n.getFNC1Character()>0&&(a+=this.prepend(Rs.getBytes(232),u));for(var I=0;I<p.length;I++)this.applyRandomPattern(u,u.length-p[I],w[I]);var R=e.getMinSymbolSize(u.length);for(u.length<R&&u.push(129);u.length<R;)u.push(this.randomize253State(u.length+1));for(this.bytes=new Uint8Array(u.length),I=0;I<this.bytes.length;I++)this.bytes[I]=u[I]}return s.prototype.prepend=function(e,n){for(var a=e.length-1;a>=0;a--)n.unshift(e[a]);return e.length},s.prototype.randomize253State=function(e){var a=149*e%253+1+129;return a<=254?a:a-254},s.prototype.applyRandomPattern=function(e,n,a){for(var u=0;u<a;u++){var p=n+u,I=149*(p+1)%255+1+(255&e[p]);e[p]=I<=255?I:I-256}},s.prototype.getBytes=function(){return this.bytes},s}(),Rs=function(){function s(e,n,a,u,p){if(this.input=e,this.mode=n,this.fromPosition=a,this.characterLength=u,this.previous=p,this.allCodewordCapacities=[3,5,8,10,12,16,18,22,30,32,36,44,49,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.squareCodewordCapacities=[3,5,8,12,18,22,30,36,44,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.rectangularCodewordCapacities=[5,10,16,33,32,49],!(a+u<=e.length()))throw new Error("Invalid edge");var w=null!==p?p.cachedTotalSize:0,E=this.getPreviousMode();switch(n){case or.ASCII:w++,(e.isECI(a)||Vs.isExtendedASCII(e.charAt(a),e.getFNC1Character()))&&w++,(E===or.C40||E===or.TEXT||E===or.X12)&&w++;break;case or.B256:w++,(E!==or.B256||250===this.getB256Size())&&w++,E===or.ASCII?w++:(E===or.C40||E===or.TEXT||E===or.X12)&&(w+=2);break;case or.C40:case or.TEXT:case or.X12:w+=n===or.X12?2:2*Vs.getNumberOfC40Words(e,a,n===or.C40,[]),E===or.ASCII||E===or.B256?w++:E!==n&&(E===or.C40||E===or.TEXT||E===or.X12)&&(w+=2);break;case or.EDF:w+=3,E===or.ASCII||E===or.B256?w++:(E===or.C40||E===or.TEXT||E===or.X12)&&(w+=2)}this.cachedTotalSize=w}return s.prototype.getB256Size=function(){for(var e=0,n=this;null!==n&&n.mode===or.B256&&e<=250;)e++,n=n.previous;return e},s.prototype.getPreviousStartMode=function(){return null===this.previous?or.ASCII:this.previous.mode},s.prototype.getPreviousMode=function(){return null===this.previous?or.ASCII:this.previous.getEndMode()},s.prototype.getEndMode=function(){if(this.mode===or.EDF){if(this.characterLength<4)return or.ASCII;if((e=this.getLastASCII())>0&&this.getCodewordsRemaining(this.cachedTotalSize+e)<=2-e)return or.ASCII}if(this.mode===or.C40||this.mode===or.TEXT||this.mode===or.X12){if(this.fromPosition+this.characterLength>=this.input.length()&&0===this.getCodewordsRemaining(this.cachedTotalSize))return or.ASCII;var e;if(1===(e=this.getLastASCII())&&0===this.getCodewordsRemaining(this.cachedTotalSize+1))return or.ASCII}return this.mode},s.prototype.getMode=function(){return this.mode},s.prototype.getLastASCII=function(){var e=this.input.length(),n=this.fromPosition+this.characterLength;return e-n>4||n>=e?0:e-n==1?Vs.isExtendedASCII(this.input.charAt(n),this.input.getFNC1Character())?0:1:e-n==2?Vs.isExtendedASCII(this.input.charAt(n),this.input.getFNC1Character())||Vs.isExtendedASCII(this.input.charAt(n+1),this.input.getFNC1Character())?0:Zi.isDigit(this.input.charAt(n))&&Zi.isDigit(this.input.charAt(n+1))?1:2:e-n==3?Zi.isDigit(this.input.charAt(n))&&Zi.isDigit(this.input.charAt(n+1))&&!Vs.isExtendedASCII(this.input.charAt(n+2),this.input.getFNC1Character())||Zi.isDigit(this.input.charAt(n+1))&&Zi.isDigit(this.input.charAt(n+2))&&!Vs.isExtendedASCII(this.input.charAt(n),this.input.getFNC1Character())?2:0:Zi.isDigit(this.input.charAt(n))&&Zi.isDigit(this.input.charAt(n+1))&&Zi.isDigit(this.input.charAt(n+2))&&Zi.isDigit(this.input.charAt(n+3))?2:0},s.prototype.getMinSymbolSize=function(e){var n,a,u,p,w,E;switch(this.input.getShapeHint()){case 1:try{for(var I=Nc(this.squareCodewordCapacities),R=I.next();!R.done;R=I.next())if((V=R.value)>=e)return V}catch(Ne){n={error:Ne}}finally{try{R&&!R.done&&(a=I.return)&&a.call(I)}finally{if(n)throw n.error}}break;case 2:try{for(var W=Nc(this.rectangularCodewordCapacities),ee=W.next();!ee.done;ee=W.next())if((V=ee.value)>=e)return V}catch(Ne){u={error:Ne}}finally{try{ee&&!ee.done&&(p=W.return)&&p.call(W)}finally{if(u)throw u.error}}}try{for(var oe=Nc(this.allCodewordCapacities),Ce=oe.next();!Ce.done;Ce=oe.next()){var V;if((V=Ce.value)>=e)return V}}catch(Ne){w={error:Ne}}finally{try{Ce&&!Ce.done&&(E=oe.return)&&E.call(oe)}finally{if(w)throw w.error}}return this.allCodewordCapacities[this.allCodewordCapacities.length-1]},s.prototype.getCodewordsRemaining=function(e){return this.getMinSymbolSize(e)-e},s.getBytes=function(e,n){var a=new Uint8Array(n?2:1);return a[0]=e,n&&(a[1]=n),a},s.prototype.setC40Word=function(e,n,a,u,p){var w=1600*(255&a)+40*(255&u)+(255&p)+1;e[n]=w/256,e[n+1]=w%256},s.prototype.getX12Value=function(e){return 13===e?0:42===e?1:62===e?2:32===e?3:e>=48&&e<=57?e-44:e>=65&&e<=90?e-51:e},s.prototype.getX12Words=function(){if(this.characterLength%3!=0)throw new Error("X12 words must be a multiple of 3");for(var e=new Uint8Array(this.characterLength/3*2),n=0;n<e.length;n+=2)this.setC40Word(e,n,this.getX12Value(this.input.charAt(this.fromPosition+n/2*3)),this.getX12Value(this.input.charAt(this.fromPosition+n/2*3+1)),this.getX12Value(this.input.charAt(this.fromPosition+n/2*3+2)));return e},s.prototype.getShiftValue=function(e,n,a){return n&&Vs.isInC40Shift1Set(e)||!n&&Vs.isInTextShift1Set(e)?0:n&&Vs.isInC40Shift2Set(e,a)||!n&&Vs.isInTextShift2Set(e,a)?1:2},s.prototype.getC40Value=function(e,n,a,u){if(a===u){if(2!==n)throw new Error("FNC1 cannot be used in C40 shift 2");return 27}return e?a<=31?a:32===a?3:a<=47?a-33:a<=57?a-44:a<=64?a-43:a<=90?a-51:a<=95?a-69:a<=127?a-96:a:0===a?0:0===n&&a<=3?a-1:1===n&&a<=31?a:32===a?3:a>=33&&a<=47?a-33:a>=48&&a<=57?a-44:a>=58&&a<=64?a-43:a>=65&&a<=90?a-64:a>=91&&a<=95?a-69:96===a?0:a>=97&&a<=122?a-83:a>=123&&a<=127?a-96:a},s.prototype.getC40Words=function(e,n){for(var a=[],u=0;u<this.characterLength;u++){var p=this.input.charAt(this.fromPosition+u);if(e&&Zi.isNativeC40(p)||!e&&Zi.isNativeText(p))a.push(this.getC40Value(e,0,p,n));else if(Vs.isExtendedASCII(p,n)){var E=(255&p)-128;if(e&&Zi.isNativeC40(E)||!e&&Zi.isNativeText(E))a.push(1),a.push(30),a.push(this.getC40Value(e,0,E,n));else{a.push(1),a.push(30);var w=this.getShiftValue(E,e,n);a.push(w),a.push(this.getC40Value(e,w,E,n))}}else w=this.getShiftValue(p,e,n),a.push(w),a.push(this.getC40Value(e,w,p,n))}if(a.length%3!=0){if((a.length-2)%3!=0||this.fromPosition+this.characterLength!==this.input.length())throw new Error("C40 words must be a multiple of 3");a.push(0)}var I=new Uint8Array(a.length/3*2),R=0;for(u=0;u<a.length;u+=3)this.setC40Word(I,R,255&a[u],255&a[u+1],255&a[u+2]),R+=2;return I},s.prototype.getEDFBytes=function(){for(var e=Math.ceil(this.characterLength/4),n=new Uint8Array(3*e),a=this.fromPosition,u=Math.min(this.fromPosition+this.characterLength-1,this.input.length()-1),p=0;p<e;p+=3){for(var w=[],E=0;E<4;E++)w[E]=a<=u?63&this.input.charAt(a++):a===u+1?31:0;var I=w[0]<<18;I|=w[1]<<12,I|=w[2]<<6,n[p]=(I|=w[3])>>16&255,n[p+1]=I>>8&255,n[p+2]=255&I}return n},s.prototype.getLatchBytes=function(){switch(this.getPreviousMode()){case or.ASCII:case or.B256:switch(this.mode){case or.B256:return s.getBytes(231);case or.C40:return s.getBytes(230);case or.TEXT:return s.getBytes(239);case or.X12:return s.getBytes(238);case or.EDF:return s.getBytes(240)}break;case or.C40:case or.TEXT:case or.X12:if(this.mode!==this.getPreviousMode())switch(this.mode){case or.ASCII:return s.getBytes(254);case or.B256:return s.getBytes(254,231);case or.C40:return s.getBytes(254,230);case or.TEXT:return s.getBytes(254,239);case or.X12:return s.getBytes(254,238);case or.EDF:return s.getBytes(254,240)}break;case or.EDF:if(this.mode!==or.EDF)throw new Error("Cannot switch from EDF to "+this.mode)}return new Uint8Array(0)},s.prototype.getDataBytes=function(){switch(this.mode){case or.ASCII:return this.input.isECI(this.fromPosition)?s.getBytes(241,this.input.getECIValue(this.fromPosition)+1):Vs.isExtendedASCII(this.input.charAt(this.fromPosition),this.input.getFNC1Character())?s.getBytes(235,this.input.charAt(this.fromPosition)-127):2===this.characterLength?s.getBytes(10*this.input.charAt(this.fromPosition)+this.input.charAt(this.fromPosition+1)+130):this.input.isFNC1(this.fromPosition)?s.getBytes(232):s.getBytes(this.input.charAt(this.fromPosition)+1);case or.B256:return s.getBytes(this.input.charAt(this.fromPosition));case or.C40:return this.getC40Words(!0,this.input.getFNC1Character());case or.TEXT:return this.getC40Words(!1,this.input.getFNC1Character());case or.X12:return this.getX12Words();case or.EDF:return this.getEDFBytes()}},s}(),La=function(s){function e(n,a,u,p,w){var E=s.call(this,n,a,u)||this;return E.shape=p,E.macroId=w,E}return ya(e,s),e.prototype.getMacroId=function(){return this.macroId},e.prototype.getShapeHint=function(){return this.shape},e}(vp);!function(){function s(){}s.prototype.encode=function(e,n,a,u,p){if(void 0===p&&(p=null),""===e.trim())throw new Error("Found empty contents");if(n!==De.DATA_MATRIX)throw new Error("Can only encode DATA_MATRIX, but got "+n);if(a<0||u<0)throw new Error("Requested dimensions can't be negative: "+a+"x"+u);var ee,w=0,E=null,I=null;if(null!=p){var R=p.get(Ki.DATA_MATRIX_SHAPE);null!=R&&(w=R);var V=p.get(Ki.MIN_SIZE);null!=V&&(E=V);var W=p.get(Ki.MAX_SIZE);null!=W&&(I=W)}if(null!=p&&p.has(Ki.DATA_MATRIX_COMPACT)&&p.get(Ki.DATA_MATRIX_COMPACT).toString()){var Ce=p.has(Ki.GS1_FORMAT)&&!!p.get(Ki.GS1_FORMAT).toString(),Ne=null;p.has(Ki.CHARACTER_SET)&&(Ne=Il.forName(p.get(Ki.CHARACTER_SET).toString())),ee=Vs.encodeHighLevel(e,Ne,Ce?29:-1,w)}else{var ut=null!=p&&p.has(Ki.FORCE_C40)&&!!p.get(Ki.FORCE_C40).toString();ee=Zi.encodeHighLevel(e,w,E,I,ut)}var at=wu.lookup(ee.length,w,E,I,!0),Pt=Df.encodeECC200(ee,at),Wt=new nu(Pt,at.getSymbolDataWidth(),at.getSymbolDataHeight());return Wt.place(),this.encodeLowLevel(Wt,at,a,u)},s.prototype.encodeLowLevel=function(e,n,a,u){for(var p=n.getSymbolDataWidth(),w=n.getSymbolDataHeight(),E=new Qc(n.getSymbolWidth(),n.getSymbolHeight()),I=0,R=0;R<w;R++){var V=void 0;if(R%n.matrixHeight==0){V=0;for(var W=0;W<n.getSymbolWidth();W++)E.setBoolean(V,I,W%2==0),V++;I++}for(V=0,W=0;W<p;W++)W%n.matrixWidth==0&&(E.setBoolean(V,I,!0),V++),E.setBoolean(V,I,e.getBit(W,R)),V++,W%n.matrixWidth==n.matrixWidth-1&&(E.setBoolean(V,I,R%2==0),V++);if(I++,R%n.matrixHeight==n.matrixHeight-1){for(V=0,W=0;W<n.getSymbolWidth();W++)E.setBoolean(V,I,!0),V++;I++}}return this.convertByteMatrixToBitMatrix(E,a,u)},s.prototype.convertByteMatrixToBitMatrix=function(e,n,a){var W,u=e.getWidth(),p=e.getHeight(),w=Math.max(n,u),E=Math.max(a,p),I=Math.min(w/u,E/p),R=(w-u*I)/2,V=(E-p*I)/2;a<p||n<u?(R=0,V=0,W=new ur(u,p)):W=new ur(n,a),W.clear();for(var ee=0,oe=V;ee<p;ee++,oe+=I)for(var Ce=0,Ne=R;Ce<u;Ce++,Ne+=I)1===e.get(Ce,ee)&&W.setRegion(Ne,oe,I,I);return W}}();var Fh=function(){function s(){}return s.prototype.isCompact=function(){return this.compact},s.prototype.setCompact=function(e){this.compact=e},s.prototype.getSize=function(){return this.size},s.prototype.setSize=function(e){this.size=e},s.prototype.getLayers=function(){return this.layers},s.prototype.setLayers=function(e){this.layers=e},s.prototype.getCodeWords=function(){return this.codeWords},s.prototype.setCodeWords=function(e){this.codeWords=e},s.prototype.getMatrix=function(){return this.matrix},s.prototype.setMatrix=function(e){this.matrix=e},s}();const Eu=Fh;var Of=function(){function s(){}return s.singletonList=function(e){return[e]},s.min=function(e,n){return e.sort(n)[0]},s}();const Zu=Of;var Pf=function(){function s(e){this.previous=e}return s.prototype.getPrevious=function(){return this.previous},s}();const Cg=Pf;var Bh=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Rf=function(s){function e(n,a,u){var p=s.call(this,n)||this;return p.value=a,p.bitCount=u,p}return Bh(e,s),e.prototype.appendTo=function(n,a){n.appendBits(this.value,this.bitCount)},e.prototype.add=function(n,a){return new e(this,n,a)},e.prototype.addBinaryShift=function(n,a){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new e(this,n,a)},e.prototype.toString=function(){var n=this.value&(1<<this.bitCount)-1;return"<"+mt.toBinaryString((n|=1<<this.bitCount)|1<<this.bitCount).substring(1)+">"},e}(Cg);const zh=Rf;var zl=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)u.hasOwnProperty(p)&&(a[p]=u[p])})(e,n)};return function(e,n){function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),kc=function(s){function e(n,a,u){var p=s.call(this,n,0,0)||this;return p.binaryShiftStart=a,p.binaryShiftByteCount=u,p}return zl(e,s),e.prototype.appendTo=function(n,a){for(var u=0;u<this.binaryShiftByteCount;u++)(0===u||31===u&&this.binaryShiftByteCount<=62)&&(n.appendBits(31,5),this.binaryShiftByteCount>62?n.appendBits(this.binaryShiftByteCount-31,16):n.appendBits(0===u?Math.min(this.binaryShiftByteCount,31):this.binaryShiftByteCount-31,5)),n.appendBits(a[this.binaryShiftStart+u],8)},e.prototype.addBinaryShift=function(n,a){return new e(this,n,a)},e.prototype.toString=function(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"},e}(zh);const Kd=kc;function Fc(s,e,n){return new zh(s,e,n)}var yp=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Vh=new zh(null,0,0),qu=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])],Lf=function iu(s){var e,n;try{for(var a=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(s),u=a.next();!u.done;u=a.next())Nt.fill(u.value,-1)}catch(w){e={error:w}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return s[0][4]=0,s[1][4]=0,s[1][0]=28,s[3][4]=0,s[2][4]=0,s[2][0]=15,s}(Nt.createInt32Array(6,6)),Au=function(){function s(e,n,a,u){this.token=e,this.mode=n,this.binaryShiftByteCount=a,this.bitCount=u}return s.prototype.getMode=function(){return this.mode},s.prototype.getToken=function(){return this.token},s.prototype.getBinaryShiftByteCount=function(){return this.binaryShiftByteCount},s.prototype.getBitCount=function(){return this.bitCount},s.prototype.latchAndAppend=function(e,n){var a=this.bitCount,u=this.token;if(e!==this.mode){var p=qu[this.mode][e];u=Fc(u,65535&p,p>>16),a+=p>>16}var w=2===e?4:5;return new s(u=Fc(u,n,w),e,0,a+w)},s.prototype.shiftAndAppend=function(e,n){var a=this.token,u=2===this.mode?4:5;return a=Fc(a,Lf[this.mode][e],u),new s(a=Fc(a,n,5),this.mode,0,this.bitCount+u+5)},s.prototype.addBinaryShiftChar=function(e){var n=this.token,a=this.mode,u=this.bitCount;if(4===this.mode||2===this.mode){var p=qu[a][0];n=Fc(n,65535&p,p>>16),u+=p>>16,a=0}var E=new s(n,a,this.binaryShiftByteCount+1,u+(0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8));return 2078===E.binaryShiftByteCount&&(E=E.endBinaryShift(e+1)),E},s.prototype.endBinaryShift=function(e){if(0===this.binaryShiftByteCount)return this;var n=this.token;return n=function Dd(s,e,n){return new Kd(s,e,n)}(n,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new s(n,this.mode,0,this.bitCount)},s.prototype.isBetterThanOrEqualTo=function(e){var n=this.bitCount+(qu[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?n+=s.calculateBinaryShiftCost(e)-s.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(n+=10),n<=e.bitCount},s.prototype.toBitArray=function(e){for(var n,a,u=[],p=this.endBinaryShift(e.length).token;null!==p;p=p.getPrevious())u.unshift(p);var w=new _n;try{for(var E=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(u),I=E.next();!I.done;I=E.next())I.value.appendTo(w,e)}catch(V){n={error:V}}finally{try{I&&!I.done&&(a=E.return)&&a.call(E)}finally{if(n)throw n.error}}return w},s.prototype.toString=function(){return Pr.format("%s bits=%d bytes=%d",yp[this.mode],this.bitCount,this.binaryShiftByteCount)},s.calculateBinaryShiftCost=function(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0},s.INITIAL_STATE=new s(Vh,0,0,0),s}();const Qd=Au;var eh=function Du(s){var e=Pr.getCharCode(" "),n=Pr.getCharCode("."),a=Pr.getCharCode(",");s[0][e]=1;for(var u=Pr.getCharCode("Z"),p=Pr.getCharCode("A"),w=p;w<=u;w++)s[0][w]=w-p+2;s[1][e]=1;var E=Pr.getCharCode("z"),I=Pr.getCharCode("a");for(w=I;w<=E;w++)s[1][w]=w-I+2;s[2][e]=1;var R=Pr.getCharCode("9"),V=Pr.getCharCode("0");for(w=V;w<=R;w++)s[2][w]=w-V+2;s[2][a]=12,s[2][n]=13;for(var W=["\0"," ","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\b","\t","\n","\v","\f","\r","\x1b","\x1c","\x1d","\x1e","\x1f","@","\\","^","_","`","|","~","\x7f"],ee=0;ee<W.length;ee++)s[3][Pr.getCharCode(W[ee])]=ee;var oe=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(ee=0;ee<oe.length;ee++)Pr.getCharCode(oe[ee])>0&&(s[4][Pr.getCharCode(oe[ee])]=ee);return s}(Nt.createInt32Array(5,256)),th=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dg=function(){function s(e){this.text=e}return s.prototype.encode=function(){for(var e=Pr.getCharCode(" "),n=Pr.getCharCode("\n"),a=Zu.singletonList(Qd.INITIAL_STATE),u=0;u<this.text.length;u++){var p=void 0,w=u+1<this.text.length?this.text[u+1]:0;switch(this.text[u]){case Pr.getCharCode("\r"):p=w===n?2:0;break;case Pr.getCharCode("."):p=w===e?3:0;break;case Pr.getCharCode(","):p=w===e?4:0;break;case Pr.getCharCode(":"):p=w===e?5:0;break;default:p=0}p>0?(a=s.updateStateListForPair(a,u,p),u++):a=this.updateStateListForChar(a,u)}return Zu.min(a,function(I,R){return I.getBitCount()-R.getBitCount()}).toBitArray(this.text)},s.prototype.updateStateListForChar=function(e,n){var a,u,p=[];try{for(var w=th(e),E=w.next();!E.done;E=w.next())this.updateStateForChar(E.value,n,p)}catch(R){a={error:R}}finally{try{E&&!E.done&&(u=w.return)&&u.call(w)}finally{if(a)throw a.error}}return s.simplifyStates(p)},s.prototype.updateStateForChar=function(e,n,a){for(var u=255&this.text[n],p=eh[e.getMode()][u]>0,w=null,E=0;E<=4;E++){var I=eh[E][u];if(I>0){if(null==w&&(w=e.endBinaryShift(n)),!p||E===e.getMode()||2===E){var R=w.latchAndAppend(E,I);a.push(R)}if(!p&&Lf[e.getMode()][E]>=0){var V=w.shiftAndAppend(E,I);a.push(V)}}}if(e.getBinaryShiftByteCount()>0||0===eh[e.getMode()][u]){var W=e.addBinaryShiftChar(n);a.push(W)}},s.updateStateListForPair=function(e,n,a){var u,p,w=[];try{for(var E=th(e),I=E.next();!I.done;I=E.next())this.updateStateForPair(I.value,n,a,w)}catch(V){u={error:V}}finally{try{I&&!I.done&&(p=E.return)&&p.call(E)}finally{if(u)throw u.error}}return this.simplifyStates(w)},s.updateStateForPair=function(e,n,a,u){var p=e.endBinaryShift(n);if(u.push(p.latchAndAppend(4,a)),4!==e.getMode()&&u.push(p.shiftAndAppend(4,a)),3===a||4===a){var w=p.latchAndAppend(2,16-a).latchAndAppend(2,1);u.push(w)}if(e.getBinaryShiftByteCount()>0){var E=e.addBinaryShiftChar(n).addBinaryShiftChar(n+1);u.push(E)}},s.simplifyStates=function(e){var n,a,u,p,w=[];try{for(var E=th(e),I=E.next();!I.done;I=E.next()){var R=I.value,V=!0,W=function(ot){if(ot.isBetterThanOrEqualTo(R))return V=!1,"break";R.isBetterThanOrEqualTo(ot)&&(w=w.filter(function(ut){return ut!==ot}))};try{for(var ee=(u=void 0,th(w)),oe=ee.next();!oe.done&&"break"!==W(oe.value);oe=ee.next());}catch(ot){u={error:ot}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}V&&w.push(R)}}catch(ot){n={error:ot}}finally{try{I&&!I.done&&(a=E.return)&&a.call(E)}finally{if(n)throw n.error}}return w},s}();const Tg=Dg;var xp=function(){function s(){}return s.encodeBytes=function(e){return s.encode(e,s.DEFAULT_EC_PERCENT,s.DEFAULT_AZTEC_LAYERS)},s.encode=function(e,n,a){var E,I,R,V,W,u=new Tg(e).encode(),p=mt.truncDivision(u.getSize()*n,100)+11,w=u.getSize()+p;if(a!==s.DEFAULT_AZTEC_LAYERS){if(E=a<0,(I=Math.abs(a))>(E?s.MAX_NB_BITS_COMPACT:s.MAX_NB_BITS))throw new Xt(Pr.format("Illegal value %s for layers",a));var ee=(R=s.totalBitsInLayer(I,E))-R%(V=s.WORD_SIZE[I]);if((W=s.stuffBits(u,V)).getSize()+p>ee)throw new Xt("Data to large for user specified layer");if(E&&W.getSize()>64*V)throw new Xt("Data to large for user specified layer")}else{V=0,W=null;for(var oe=0;;oe++){if(oe>s.MAX_NB_BITS)throw new Xt("Data too large for an Aztec code");if(!(w>(R=s.totalBitsInLayer(I=(E=oe<=3)?oe+1:oe,E)))&&((null==W||V!==s.WORD_SIZE[I])&&(W=s.stuffBits(u,V=s.WORD_SIZE[I])),ee=R-R%V,!(E&&W.getSize()>64*V)&&W.getSize()+p<=ee))break}}var Pt,Ce=s.generateCheckWords(W,R,V),Ne=W.getSize()/V,ot=s.generateModeMessage(E,I,Ne),ut=(E?11:14)+4*I,at=new Int32Array(ut);if(E)for(Pt=ut,oe=0;oe<at.length;oe++)at[oe]=oe;else{Pt=ut+1+2*mt.truncDivision(mt.truncDivision(ut,2)-1,15);var Wt=mt.truncDivision(ut,2),wn=mt.truncDivision(Pt,2);for(oe=0;oe<Wt;oe++){var Un=oe+mt.truncDivision(oe,15);at[Wt-oe-1]=wn-Un-1,at[Wt+oe]=wn+Un+1}}for(var Xn=new ur(Pt),hr=(oe=0,0);oe<I;oe++){for(var Ei=4*(I-oe)+(E?9:12),fi=0;fi<Ei;fi++)for(var xa=2*fi,so=0;so<2;so++)Ce.get(hr+xa+so)&&Xn.set(at[2*oe+so],at[2*oe+fi]),Ce.get(hr+2*Ei+xa+so)&&Xn.set(at[2*oe+fi],at[ut-1-2*oe-so]),Ce.get(hr+4*Ei+xa+so)&&Xn.set(at[ut-1-2*oe-so],at[ut-1-2*oe-fi]),Ce.get(hr+6*Ei+xa+so)&&Xn.set(at[ut-1-2*oe-fi],at[2*oe+so]);hr+=8*Ei}if(s.drawModeMessage(Xn,E,Pt,ot),E)s.drawBullsEye(Xn,mt.truncDivision(Pt,2),5);else for(s.drawBullsEye(Xn,mt.truncDivision(Pt,2),7),oe=0,fi=0;oe<mt.truncDivision(ut,2)-1;oe+=15,fi+=16)for(so=1&mt.truncDivision(Pt,2);so<Pt;so+=2)Xn.set(mt.truncDivision(Pt,2)-fi,so),Xn.set(mt.truncDivision(Pt,2)+fi,so),Xn.set(so,mt.truncDivision(Pt,2)-fi),Xn.set(so,mt.truncDivision(Pt,2)+fi);var xs=new Eu;return xs.setCompact(E),xs.setSize(Pt),xs.setLayers(I),xs.setCodeWords(Ne),xs.setMatrix(Xn),xs},s.drawBullsEye=function(e,n,a){for(var u=0;u<a;u+=2)for(var p=n-u;p<=n+u;p++)e.set(p,n-u),e.set(p,n+u),e.set(n-u,p),e.set(n+u,p);e.set(n-a,n-a),e.set(n-a+1,n-a),e.set(n-a,n-a+1),e.set(n+a,n-a),e.set(n+a,n-a+1),e.set(n+a,n+a-1)},s.generateModeMessage=function(e,n,a){var u=new _n;return e?(u.appendBits(n-1,2),u.appendBits(a-1,6),u=s.generateCheckWords(u,28,4)):(u.appendBits(n-1,5),u.appendBits(a-1,11),u=s.generateCheckWords(u,40,4)),u},s.drawModeMessage=function(e,n,a,u){var p=mt.truncDivision(a,2);if(n)for(var w=0;w<7;w++){var E=p-3+w;u.get(w)&&e.set(E,p-5),u.get(w+7)&&e.set(p+5,E),u.get(20-w)&&e.set(E,p+5),u.get(27-w)&&e.set(p-5,E)}else for(w=0;w<10;w++)E=p-5+w+mt.truncDivision(w,5),u.get(w)&&e.set(E,p-7),u.get(w+10)&&e.set(p+7,E),u.get(29-w)&&e.set(E,p+7),u.get(39-w)&&e.set(p-7,E)},s.generateCheckWords=function(e,n,a){var u,p,w=e.getSize()/a,E=new lp(s.getGF(a)),I=mt.truncDivision(n,a),R=s.bitsToWords(e,a,I);E.encode(R,I-w);var V=n%a,W=new _n;W.appendBits(0,V);try{for(var ee=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Array.from(R)),oe=ee.next();!oe.done;oe=ee.next())W.appendBits(oe.value,a)}catch(Ne){u={error:Ne}}finally{try{oe&&!oe.done&&(p=ee.return)&&p.call(ee)}finally{if(u)throw u.error}}return W},s.bitsToWords=function(e,n,a){var p,w,u=new Int32Array(a);for(p=0,w=e.getSize()/n;p<w;p++){for(var E=0,I=0;I<n;I++)E|=e.get(p*n+I)?1<<n-I-1:0;u[p]=E}return u},s.getGF=function(e){switch(e){case 4:return en.AZTEC_PARAM;case 6:return en.AZTEC_DATA_6;case 8:return en.AZTEC_DATA_8;case 10:return en.AZTEC_DATA_10;case 12:return en.AZTEC_DATA_12;default:throw new Xt("Unsupported word size "+e)}},s.stuffBits=function(e,n){for(var a=new _n,u=e.getSize(),p=(1<<n)-2,w=0;w<u;w+=n){for(var E=0,I=0;I<n;I++)(w+I>=u||e.get(w+I))&&(E|=1<<n-1-I);(E&p)===p?(a.appendBits(E&p,n),w--):E&p?a.appendBits(E,n):(a.appendBits(1|E,n),w--)}return a},s.totalBitsInLayer=function(e,n){return((n?88:112)+16*e)*e},s.DEFAULT_EC_PERCENT=33,s.DEFAULT_AZTEC_LAYERS=0,s.MAX_NB_BITS=32,s.MAX_NB_BITS_COMPACT=4,s.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]),s}();const Gh=xp;!function(){function s(){}s.prototype.encode=function(e,n,a,u){return this.encodeWithHints(e,n,a,u,null)},s.prototype.encodeWithHints=function(e,n,a,u,p){var w=Ts.ISO_8859_1,E=Gh.DEFAULT_EC_PERCENT,I=Gh.DEFAULT_AZTEC_LAYERS;return null!=p&&(p.has(Ki.CHARACTER_SET)&&(w=Il.forName(p.get(Ki.CHARACTER_SET).toString())),p.has(Ki.ERROR_CORRECTION)&&(E=mt.parseInt(p.get(Ki.ERROR_CORRECTION).toString())),p.has(Ki.AZTEC_LAYERS)&&(I=mt.parseInt(p.get(Ki.AZTEC_LAYERS).toString()))),s.encodeLayers(e,n,a,u,w,E,I)},s.encodeLayers=function(e,n,a,u,p,w,E){if(n!==De.AZTEC)throw new Xt("Can only encode AZTEC, but got "+n);var I=Gh.encode(Pr.getBytes(e,p),w,E);return s.renderResult(I,a,u)},s.renderResult=function(e,n,a){var u=e.getMatrix();if(null==u)throw new Fi;for(var p=u.getWidth(),w=u.getHeight(),E=Math.max(n,p),I=Math.max(a,w),R=Math.min(E/p,I/w),V=(E-p*R)/2,W=(I-w*R)/2,ee=new ur(E,I),oe=0,Ce=W;oe<w;oe++,Ce+=R)for(var Ne=0,ot=V;Ne<p;Ne++,ot+=R)u.get(Ne,oe)&&ee.setRegion(ot,Ce,R,R);return ee}}();var $h=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Nf=function(s){function e(n){var a=s.call(this,n.width,n.height)||this;return a.canvas=n,a.tempCanvasElement=null,a.buffer=e.makeBufferFromCanvasImageData(n),a}return $h(e,s),e.makeBufferFromCanvasImageData=function(n){var a=n.getContext("2d");if(!a)throw new Error("Couldn't get canvas context.");var u=a.getImageData(0,0,n.width,n.height);return e.toGrayscaleBuffer(u.data,n.width,n.height)},e.toGrayscaleBuffer=function(n,a,u){for(var p=new Uint8ClampedArray(a*u),w=0,E=0,I=n.length;w<I;w+=4,E++){p[E]=0===n[w+3]?255:306*n[w]+601*n[w+1]+117*n[w+2]+512>>10}return p},e.prototype.getRow=function(n,a){if(n<0||n>=this.getHeight())throw new Xt("Requested row is outside the image: "+n);var u=this.getWidth(),p=n*u;return null===a?a=this.buffer.slice(p,p+u):(a.length<u&&(a=new Uint8ClampedArray(u)),a.set(this.buffer.slice(p,p+u))),a},e.prototype.getMatrix=function(){return this.buffer},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(n,a,u,p){return s.prototype.crop.call(this,n,a,u,p),this},e.prototype.isRotateSupported=function(){return!0},e.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},e.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},e.prototype.invert=function(){return new Re(this)},e.prototype.getTempCanvasElement=function(){if(null===this.tempCanvasElement){var n=this.canvas.ownerDocument.createElement("canvas");n.width=this.canvas.width,n.height=this.canvas.height,this.tempCanvasElement=n}return this.tempCanvasElement},e.prototype.rotate=function(n){var a=this.getTempCanvasElement();if(!a)throw new Error("Could not create a Canvas element.");var u=n*e.DEGREE_TO_RADIANS,p=this.canvas.width,w=this.canvas.height,E=Math.ceil(Math.abs(Math.cos(u))*p+Math.abs(Math.sin(u))*w),I=Math.ceil(Math.abs(Math.sin(u))*p+Math.abs(Math.cos(u))*w);a.width=E,a.height=I;var R=a.getContext("2d");if(!R)throw new Error("Could not create a Canvas Context element.");return R.translate(E/2,I/2),R.rotate(u),R.drawImage(this.canvas,p/-2,w/-2),this.buffer=e.makeBufferFromCanvasImageData(a),this},e.DEGREE_TO_RADIANS=Math.PI/180,e}(Ue);function Xu(){return typeof navigator<"u"}var Tu=function(){return Tu=Object.assign||function(s){for(var e,n=1,a=arguments.length;n<a;n++)for(var u in e=arguments[n])Object.prototype.hasOwnProperty.call(e,u)&&(s[u]=e[u]);return s},Tu.apply(this,arguments)},os=function(s,e,n,a){return new(n||(n=Promise))(function(p,w){function E(V){try{R(a.next(V))}catch(W){w(W)}}function I(V){try{R(a.throw(V))}catch(W){w(W)}}function R(V){V.done?p(V.value):function u(p){return p instanceof n?p:new n(function(w){w(p)})}(V.value).then(E,I)}R((a=a.apply(s,e||[])).next())})},Ls=function(s,e){var a,u,p,w,n={label:0,sent:function(){if(1&p[0])throw p[1];return p[1]},trys:[],ops:[]};return w={next:E(0),throw:E(1),return:E(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w;function E(R){return function(V){return function I(R){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,u&&(p=2&R[0]?u.return:R[0]?u.throw||((p=u.return)&&p.call(u),0):u.next)&&!(p=p.call(u,R[1])).done)return p;switch(u=0,p&&(R=[2&R[0],p.value]),R[0]){case 0:case 1:p=R;break;case 4:return n.label++,{value:R[1],done:!1};case 5:n.label++,u=R[1],R=[0];continue;case 7:R=n.ops.pop(),n.trys.pop();continue;default:if(!(p=(p=n.trys).length>0&&p[p.length-1])&&(6===R[0]||2===R[0])){n=0;continue}if(3===R[0]&&(!p||R[1]>p[0]&&R[1]<p[3])){n.label=R[1];break}if(6===R[0]&&n.label<p[1]){n.label=p[1],p=R;break}if(p&&n.label<p[2]){n.label=p[2],n.ops.push(R);break}p[2]&&n.ops.pop(),n.trys.pop();continue}R=e.call(s,n)}catch(V){R=[6,V],u=0}finally{a=p=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([R,V])}}},nh=function(s){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&s[e],a=0;if(n)return n.call(s);if(s&&"number"==typeof s.length)return{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},rh={delayBetweenScanAttempts:500,delayBetweenScanSuccess:500,tryPlayVideoTimeout:5e3},zc=function(){function s(e,n,a){void 0===n&&(n=new Map),void 0===a&&(a={}),this.reader=e,this.hints=n,this.options=Tu(Tu({},rh),a)}return Object.defineProperty(s.prototype,"possibleFormats",{set:function(e){this.hints.set(Qn.POSSIBLE_FORMATS,e)},enumerable:!1,configurable:!0}),s.addVideoSource=function(e,n){try{e.srcObject=n}catch{console.error("got interrupted by new loading request")}},s.mediaStreamSetTorch=function(e,n){return os(this,void 0,void 0,function(){return Ls(this,function(a){switch(a.label){case 0:return[4,e.applyConstraints({advanced:[{fillLightMode:n?"flash":"off",torch:!!n}]})];case 1:return a.sent(),[2]}})})},s.mediaStreamIsTorchCompatible=function(e){var n,a,u=e.getVideoTracks();try{for(var p=nh(u),w=p.next();!w.done;w=p.next())if(s.mediaStreamIsTorchCompatibleTrack(w.value))return!0}catch(I){n={error:I}}finally{try{w&&!w.done&&(a=p.return)&&a.call(p)}finally{if(n)throw n.error}}return!1},s.mediaStreamIsTorchCompatibleTrack=function(e){try{return"torch"in e.getCapabilities()}catch(a){return console.error(a),console.warn("Your browser may be not fully compatible with WebRTC and/or ImageCapture specs. Torch will not be available."),!1}},s.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&e.readyState>2},s.getMediaElement=function(e,n){var a=document.getElementById(e);if(!a)throw new jn("element with id '".concat(e,"' not found"));if(a.nodeName.toLowerCase()!==n.toLowerCase())throw new jn("element with id '".concat(e,"' must be an ").concat(n," element"));return a},s.createVideoElement=function(e){if(e instanceof HTMLVideoElement)return e;if("string"==typeof e)return s.getMediaElement(e,"video");if(!e&&typeof document<"u"){var n=document.createElement("video");return n.width=200,n.height=200,n}throw new Error("Couldn't get videoElement from videoSource!")},s.prepareImageElement=function(e){if(e instanceof HTMLImageElement)return e;if("string"==typeof e)return s.getMediaElement(e,"img");if(typeof e>"u"){var n=document.createElement("img");return n.width=200,n.height=200,n}throw new Error("Couldn't get imageElement from imageSource!")},s.prepareVideoElement=function(e){var n=s.createVideoElement(e);return n.setAttribute("autoplay","true"),n.setAttribute("muted","true"),n.setAttribute("playsinline","true"),n},s.isImageLoaded=function(e){return!(!e.complete||0===e.naturalWidth)},s.createBinaryBitmapFromCanvas=function(e){var n=new Nf(e),a=new nr(n);return new kt(a)},s.drawImageOnCanvas=function(e,n){e.drawImage(n,0,0)},s.getMediaElementDimensions=function(e){if(e instanceof HTMLVideoElement)return{height:e.videoHeight,width:e.videoWidth};if(e instanceof HTMLImageElement)return{height:e.naturalHeight||e.height,width:e.naturalWidth||e.width};throw new Error("Couldn't find the Source's dimensions!")},s.createCaptureCanvas=function(e){if(!e)throw new jn("Cannot create a capture canvas without a media element.");if(typeof document>"u")throw new Error('The page "Document" is undefined, make sure you\'re running in a browser.');var n=document.createElement("canvas"),a=s.getMediaElementDimensions(e),u=a.width,p=a.height;return n.style.width=u+"px",n.style.height=p+"px",n.width=u,n.height=p,n},s.tryPlayVideo=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(a){switch(a.label){case 0:if(e?.ended)return console.error("Trying to play video that has ended."),[2,!1];if(s.isVideoPlaying(e))return console.warn("Trying to play video that is already playing."),[2,!0];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.play()];case 2:return a.sent(),[2,!0];case 3:return n=a.sent(),console.warn("It was not possible to play the video.",n),[2,!1];case 4:return[2]}})})},s.createCanvasFromMediaElement=function(e){var n=s.createCaptureCanvas(e),a=n.getContext("2d");if(!a)throw new Error("Couldn't find Canvas 2D Context.");return s.drawImageOnCanvas(a,e),n},s.createBinaryBitmapFromMediaElem=function(e){var n=s.createCanvasFromMediaElement(e);return s.createBinaryBitmapFromCanvas(n)},s.destroyImageElement=function(e){e.src="",e.removeAttribute("src"),e=void 0},s.listVideoInputDevices=function(){return os(this,void 0,void 0,function(){var e,n,a,u,p,w,E,I,W,ee;return Ls(this,function(oe){switch(oe.label){case 0:if(!Xu())throw new Error("Can't enumerate devices, navigator is not present.");if(!function Ol(){return!(!function Zl(){return Xu()&&!!navigator.mediaDevices}()||!navigator.mediaDevices.enumerateDevices)}())throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=oe.sent(),n=[];try{for(a=nh(e),u=a.next();!u.done;u=a.next())"videoinput"===(w="video"===(p=u.value).kind?"videoinput":p.kind)&&(E=p.deviceId||p.id,I=p.label||"Video device ".concat(n.length+1),n.push({deviceId:E,label:I,kind:w,groupId:p.groupId}))}catch(Ce){W={error:Ce}}finally{try{u&&!u.done&&(ee=a.return)&&ee.call(a)}finally{if(W)throw W.error}}return[2,n]}})})},s.findDeviceById=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(a){switch(a.label){case 0:return[4,s.listVideoInputDevices()];case 1:return(n=a.sent())?[2,n.find(function(u){return u.deviceId===e})]:[2]}})})},s.cleanVideoSource=function(e){if(e){try{e.srcObject=null}catch{e.src=""}e&&e.removeAttribute("src")}},s.releaseAllStreams=function(){0!==s.streamTracker.length&&s.streamTracker.forEach(function(e){e.getTracks().forEach(function(n){return n.stop()})}),s.streamTracker=[]},s.playVideoOnLoadAsync=function(e,n){return os(this,void 0,void 0,function(){return Ls(this,function(u){switch(u.label){case 0:return[4,s.tryPlayVideo(e)];case 1:return u.sent()?[2,!0]:[2,new Promise(function(p,w){var E=setTimeout(function(){s.isVideoPlaying(e)||(w(!1),e.removeEventListener("canplay",I))},n),I=function(){s.tryPlayVideo(e).then(function(R){clearTimeout(E),e.removeEventListener("canplay",I),p(R)})};e.addEventListener("canplay",I)})]}})})},s.attachStreamToVideo=function(e,n,a){return void 0===a&&(a=5e3),os(this,void 0,void 0,function(){var u;return Ls(this,function(p){switch(p.label){case 0:return u=s.prepareVideoElement(n),s.addVideoSource(u,e),[4,s.playVideoOnLoadAsync(u,a)];case 1:return p.sent(),[2,u]}})})},s._waitImageLoad=function(e){return new Promise(function(n,a){var p=setTimeout(function(){s.isImageLoaded(e)||(e.removeEventListener("load",w),a())},1e4),w=function(){clearTimeout(p),e.removeEventListener("load",w),n()};e.addEventListener("load",w)})},s.checkCallbackFnOrThrow=function(e){if(!e)throw new jn("`callbackFn` is a required parameter, you cannot capture results without it.")},s.disposeMediaStream=function(e){e.getVideoTracks().forEach(function(n){return n.stop()}),e=void 0},s.prototype.decode=function(e){var n=s.createCanvasFromMediaElement(e);return this.decodeFromCanvas(n)},s.prototype.decodeBitmap=function(e){return this.reader.decode(e,this.hints)},s.prototype.decodeFromCanvas=function(e){var n=s.createBinaryBitmapFromCanvas(e);return this.decodeBitmap(n)},s.prototype.decodeFromImageElement=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(a){switch(a.label){case 0:if(!e)throw new jn("An image element must be provided.");return n=s.prepareImageElement(e),[4,this._decodeOnLoadImage(n)];case 1:return[2,a.sent()]}})})},s.prototype.decodeFromImageUrl=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(a){switch(a.label){case 0:if(!e)throw new jn("An URL must be provided.");(n=s.prepareImageElement()).src=e,a.label=1;case 1:return a.trys.push([1,,3,4]),[4,this.decodeFromImageElement(n)];case 2:return[2,a.sent()];case 3:return s.destroyImageElement(n),[7];case 4:return[2]}})})},s.prototype.decodeFromConstraints=function(e,n,a){return os(this,void 0,void 0,function(){var u,p;return Ls(this,function(w){switch(w.label){case 0:return s.checkCallbackFnOrThrow(a),[4,this.getUserMedia(e)];case 1:u=w.sent(),w.label=2;case 2:return w.trys.push([2,4,,5]),[4,this.decodeFromStream(u,n,a)];case 3:return[2,w.sent()];case 4:throw p=w.sent(),s.disposeMediaStream(u),p;case 5:return[2]}})})},s.prototype.decodeFromStream=function(e,n,a){return os(this,void 0,void 0,function(){var p,E,I,R,W,ee,oe=this;return Ls(this,function(Ce){switch(Ce.label){case 0:return s.checkCallbackFnOrThrow(a),[4,s.attachStreamToVideo(e,n,this.options.tryPlayVideoTimeout)];case 1:return p=Ce.sent(),E=this.scan(p,a,function(){s.disposeMediaStream(e),s.cleanVideoSource(p)}),I=e.getVideoTracks(),R=Tu(Tu({},E),{stop:function(){E.stop()},streamVideoConstraintsApply:function(Ne,ot){return os(this,void 0,void 0,function(){var ut,at,Pt,wn,Un,Xn;return Ls(this,function(hr){switch(hr.label){case 0:ut=ot?I.filter(ot):I,hr.label=1;case 1:hr.trys.push([1,6,7,8]),at=nh(ut),Pt=at.next(),hr.label=2;case 2:return Pt.done?[3,5]:[4,Pt.value.applyConstraints(Ne)];case 3:hr.sent(),hr.label=4;case 4:return Pt=at.next(),[3,2];case 5:return[3,8];case 6:return wn=hr.sent(),Un={error:wn},[3,8];case 7:try{Pt&&!Pt.done&&(Xn=at.return)&&Xn.call(at)}finally{if(Un)throw Un.error}return[7];case 8:return[2]}})})},streamVideoConstraintsGet:function(Ne){return I.find(Ne).getConstraints()},streamVideoSettingsGet:function(Ne){return I.find(Ne).getSettings()},streamVideoCapabilitiesGet:function(Ne){return I.find(Ne).getCapabilities()}}),s.mediaStreamIsTorchCompatible(e)&&(W=I?.find(function(Ne){return s.mediaStreamIsTorchCompatibleTrack(Ne)}),R.switchTorch=ee=function(Ne){return os(oe,void 0,void 0,function(){return Ls(this,function(ot){switch(ot.label){case 0:return[4,s.mediaStreamSetTorch(W,Ne)];case 1:return ot.sent(),[2]}})})},R.stop=function(){return os(oe,void 0,void 0,function(){return Ls(this,function(Ne){switch(Ne.label){case 0:return E.stop(),[4,ee(!1)];case 1:return Ne.sent(),[2]}})})}),[2,R]}})})},s.prototype.decodeFromVideoDevice=function(e,n,a){return os(this,void 0,void 0,function(){return Ls(this,function(w){switch(w.label){case 0:return s.checkCallbackFnOrThrow(a),[4,this.decodeFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},n,a)];case 1:return[2,w.sent()]}})})},s.prototype.decodeFromVideoElement=function(e,n){return os(this,void 0,void 0,function(){var a;return Ls(this,function(p){switch(p.label){case 0:if(s.checkCallbackFnOrThrow(n),!e)throw new jn("A video element must be provided.");return a=s.prepareVideoElement(e),[4,s.playVideoOnLoadAsync(a,this.options.tryPlayVideoTimeout)];case 1:return p.sent(),[2,this.scan(a,n)]}})})},s.prototype.decodeFromVideoUrl=function(e,n){return os(this,void 0,void 0,function(){var a,u;return Ls(this,function(E){switch(E.label){case 0:if(s.checkCallbackFnOrThrow(n),!e)throw new jn("An URL must be provided.");return(a=s.prepareVideoElement()).src=e,u=function(){s.cleanVideoSource(a)},[4,s.playVideoOnLoadAsync(a,this.options.tryPlayVideoTimeout)];case 1:return E.sent(),[2,this.scan(a,n,u)]}})})},s.prototype.decodeOnceFromConstraints=function(e,n){return os(this,void 0,void 0,function(){var a;return Ls(this,function(u){switch(u.label){case 0:return[4,this.getUserMedia(e)];case 1:return a=u.sent(),[4,this.decodeOnceFromStream(a,n)];case 2:return[2,u.sent()]}})})},s.prototype.decodeOnceFromStream=function(e,n){return os(this,void 0,void 0,function(){var a,u;return Ls(this,function(w){switch(w.label){case 0:return a=!!n,[4,s.attachStreamToVideo(e,n)];case 1:u=w.sent(),w.label=2;case 2:return w.trys.push([2,,4,5]),[4,this.scanOneResult(u)];case 3:return[2,w.sent()];case 4:return a||s.cleanVideoSource(u),[7];case 5:return[2]}})})},s.prototype.decodeOnceFromVideoDevice=function(e,n){return os(this,void 0,void 0,function(){return Ls(this,function(p){switch(p.label){case 0:return[4,this.decodeOnceFromConstraints({video:e?{deviceId:{exact:e}}:{facingMode:"environment"}},n)];case 1:return[2,p.sent()]}})})},s.prototype.decodeOnceFromVideoElement=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(u){switch(u.label){case 0:if(!e)throw new jn("A video element must be provided.");return n=s.prepareVideoElement(e),[4,s.playVideoOnLoadAsync(n,this.options.tryPlayVideoTimeout)];case 1:return u.sent(),[4,this.scanOneResult(n)];case 2:return[2,u.sent()]}})})},s.prototype.decodeOnceFromVideoUrl=function(e){return os(this,void 0,void 0,function(){var n,a;return Ls(this,function(u){switch(u.label){case 0:if(!e)throw new jn("An URL must be provided.");(n=s.prepareVideoElement()).src=e,a=this.decodeOnceFromVideoElement(n),u.label=1;case 1:return u.trys.push([1,,3,4]),[4,a];case 2:return[2,u.sent()];case 3:return s.cleanVideoSource(n),[7];case 4:return[2]}})})},s.prototype.scanOneResult=function(e,n,a,u){var p=this;return void 0===n&&(n=!0),void 0===a&&(a=!0),void 0===u&&(u=!0),new Promise(function(w,E){p.scan(e,function(I,R,V){if(I)return w(I),void V.stop();if(R){if(R instanceof qt&&n||R instanceof Wn&&a||R instanceof nn&&u)return;V.stop(),E(R)}})})},s.prototype.scan=function(e,n,a){var u=this;s.checkCallbackFnOrThrow(n);var p=s.createCaptureCanvas(e),w=p.getContext("2d");if(!w)throw new Error("Couldn't create canvas for visual element scan.");var R,E=function(){w=void 0,p=void 0},I=!1,W={stop:function(){I=!0,clearTimeout(R),E(),a&&a()}},ee=function(){if(!I)try{s.drawImageOnCanvas(w,e);var oe=u.decodeFromCanvas(p);n(oe,void 0,W),R=setTimeout(ee,u.options.delayBetweenScanSuccess)}catch(ut){if(n(void 0,ut,W),ut instanceof Wn||ut instanceof nn||ut instanceof qt)return void(R=setTimeout(ee,u.options.delayBetweenScanAttempts));E(),a&&a(ut)}};return ee(),W},s.prototype._decodeOnLoadImage=function(e){return os(this,void 0,void 0,function(){return Ls(this,function(a){switch(a.label){case 0:return s.isImageLoaded(e)?[3,2]:[4,s._waitImageLoad(e)];case 1:a.sent(),a.label=2;case 2:return[2,this.decode(e)]}})})},s.prototype.getUserMedia=function(e){return os(this,void 0,void 0,function(){var n;return Ls(this,function(a){switch(a.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return n=a.sent(),s.streamTracker.push(n),[2,n]}})})},s.streamTracker=[],s}(),ih=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Yu=(function(s){ih(function e(n,a){return s.call(this,new ba,n,a)||this},s)}(zc),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),bp=(function(s){Yu(function e(n,a){return s.call(this,new Hn(n),n,a)||this},s)}(zc),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),Zh=(function(s){bp(function e(n,a){return s.call(this,new cc,n,a)||this},s)}(zc),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),kf=function(s){function e(n,a){var u=this,p=new _u;return p.setHints(n),(u=s.call(this,p,n,a)||this).reader=p,u}return Zh(e,s),Object.defineProperty(e.prototype,"possibleFormats",{set:function(n){this.hints.set(Qn.POSSIBLE_FORMATS,n),this.reader.setHints(this.hints)},enumerable:!1,configurable:!0}),e.prototype.decodeBitmap=function(n){return this.reader.decodeWithState(n)},e.prototype.setHints=function(n){this.hints=n,this.reader.setHints(this.hints)},e}(zc),Td=function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),Og=(function(s){Td(function e(n,a){return s.call(this,new vd,n,a)||this},s)}(zc),function(){var s=function(e,n){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,u){a.__proto__=u}||function(a,u){for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(a[p]=u[p])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function a(){this.constructor=e}s(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}()),ou=(function(s){Og(function e(n,a){return s.call(this,new de,n,a)||this},s)}(zc),"http://www.w3.org/2000/svg"),Ep=(function(){function s(e){if("string"==typeof e){var n=document.getElementById(e);if(!n)throw new Error("Could not find a Container element with '".concat(e,"'."));this.containerElement=n}else this.containerElement=e}s.prototype.write=function(e,n,a,u){if(0===e.length)throw new Xt("Found empty contents");if(n<0||a<0)throw new Xt("Requested dimensions are too small: "+n+"x"+a);var p=u&&void 0!==u.get(Ki.MARGIN)?Number.parseInt(u.get(Ki.MARGIN).toString(),10):s.QUIET_ZONE_SIZE,w=this.encode(u,e);return this.renderResult(w,n,a,p)},s.prototype.createSVGElement=function(e,n){var a=document.createElementNS(s.SVG_NS,"svg");return a.setAttributeNS(ou,"width",n.toString()),a.setAttributeNS(ou,"height",e.toString()),a},s.prototype.createSvgPathPlaceholderElement=function(e,n){var a=document.createElementNS(s.SVG_NS,"path");return a.setAttributeNS(ou,"d","M0 0h".concat(e,"v").concat(n,"H0z")),a.setAttributeNS(ou,"fill","none"),a},s.prototype.createSvgRectElement=function(e,n,a,u){var p=document.createElementNS(s.SVG_NS,"rect");return p.setAttributeNS(ou,"x",e.toString()),p.setAttributeNS(ou,"y",n.toString()),p.setAttributeNS(ou,"height",a.toString()),p.setAttributeNS(ou,"width",u.toString()),p.setAttributeNS(ou,"fill","#000000"),p},s.prototype.encode=function(e,n){var a=Nl.L;if(e&&void 0!==e.get(Ki.ERROR_CORRECTION)){var u=e.get(Ki.ERROR_CORRECTION).toString();a=Nl.fromString(u)}return Wd.encode(n,a,e)},s.prototype.renderResult=function(e,n,a,u){var p=e.getMatrix();if(null===p)throw new Fi;var w=p.getWidth(),E=p.getHeight(),I=w+2*u,R=E+2*u,V=Math.max(n,I),W=Math.max(a,R),ee=Math.min(Math.floor(V/I),Math.floor(W/R)),oe=Math.floor((V-w*ee)/2),Ce=Math.floor((W-E*ee)/2),Ne=this.createSVGElement(V,W),ot=this.createSvgPathPlaceholderElement(n,a);Ne.appendChild(ot),this.containerElement.appendChild(Ne);for(var ut=0,at=Ce;ut<E;ut++,at+=ee)for(var Pt=0,Wt=oe;Pt<w;Pt++,Wt+=ee)if(1===p.get(Pt,ut)){var wn=this.createSvgRectElement(Wt,at,ee,ee);Ne.appendChild(wn)}return Ne},s.QUIET_ZONE_SIZE=4,s.SVG_NS="http://www.w3.org/2000/svg"}(),"http://www.w3.org/2000/svg"),Ju=(function(){function s(){}s.prototype.write=function(e,n,a,u){if(0===e.length)throw new Xt("Found empty contents");if(n<0||a<0)throw new Xt("Requested dimensions are too small: "+n+"x"+a);var p=Nl.L,w=s.QUIET_ZONE_SIZE;if(u){if(void 0!==u.get(Ki.ERROR_CORRECTION)){var E=u.get(Ki.ERROR_CORRECTION).toString();p=Nl.fromString(E)}void 0!==u.get(Ki.MARGIN)&&(w=Number.parseInt(u.get(Ki.MARGIN).toString(),10))}var I=Wd.encode(e,p,u);return this.renderResult(I,n,a,w)},s.prototype.writeToDom=function(e,n,a,u,p){if("string"==typeof e){var w=document.querySelector(e);if(!w)throw new Error("Could no find the target HTML element.");e=w}var E=this.write(n,a,u,p);e instanceof HTMLElement&&e.appendChild(E)},s.prototype.renderResult=function(e,n,a,u){var p=e.getMatrix();if(null===p)throw new Fi;for(var w=p.getWidth(),E=p.getHeight(),I=w+2*u,R=E+2*u,V=Math.max(n,I),W=Math.max(a,R),ee=Math.min(Math.floor(V/I),Math.floor(W/R)),oe=Math.floor((V-w*ee)/2),Ce=Math.floor((W-E*ee)/2),Ne=this.createSVGElement(V,W),ot=0,ut=Ce;ot<E;ot++,ut+=ee)for(var at=0,Pt=oe;at<w;at++,Pt+=ee)if(1===p.get(at,ot)){var Wt=this.createSvgRectElement(Pt,ut,ee,ee);Ne.appendChild(Wt)}return Ne},s.prototype.createSVGElement=function(e,n){var a=document.createElementNS(Ep,"svg"),u=e.toString(),p=n.toString();return a.setAttribute("height",p),a.setAttribute("width",u),a.setAttribute("viewBox","0 0 "+u+" "+p),a},s.prototype.createSvgRectElement=function(e,n,a,u){var p=document.createElementNS(Ep,"rect");return p.setAttribute("x",e.toString()),p.setAttribute("y",n.toString()),p.setAttribute("height",a.toString()),p.setAttribute("width",u.toString()),p.setAttribute("fill","#000000"),p},s.QUIET_ZONE_SIZE=4}(),_e(5619));const qh=["preview"];class Qu extends kf{getScannerControls(){if(!this.scannerControls)throw new Error("No scanning is running at the time.");return this.scannerControls}scanFromDeviceObservable(e,n){var a=this;return(0,O.Z)(function*(){const u=new Ju.X({});let p;try{p=yield a.decodeFromVideoDevice(e,n,(w,E)=>{if(!E)return void u.next({result:w});const I=E.name;I===qt.name||I===Wn.name||I===nn.name||E.message.includes("No MultiFormat Readers were able to detect the code.")?u.next({error:E}):(u.error(E),a.scannerControls.stop(),a.scannerControls=void 0)}),a.scannerControls={...p,stop(){p.stop(),u.complete()}}}catch(w){u.error(w),a.scannerControls?.stop(),a.scannerControls=void 0}return u.asObservable()})()}}let oh=(()=>{class s{get codeReader(){return this._codeReader}set device(n){this._ready?this.isAutostarting?console.warn("Avoid setting a device during auto-start."):this.isCurrentDevice(n)?console.warn("Setting the same device is not allowed."):this.hasPermission?this.setDevice(n):console.warn("Permissions not set yet, waiting for them to be set to apply device change."):this._devicePreStart=n}get device(){return this._device}get formats(){return this.hints.get(Qn.POSSIBLE_FORMATS)}set formats(n){if("string"==typeof n)throw new Error("Invalid formats, make sure the [formats] input is a binding.");const a=n.map(p=>this.getBarcodeFormatOrFail(p)),u=this.hints;u.set(Qn.POSSIBLE_FORMATS,a),this.hints=u}get hints(){return this._hints}set hints(n){this._hints=n,this.codeReader?.setHints(this._hints)}set videoConstraints(n){const a=this.codeReader?.getScannerControls();a&&a?.streamVideoConstraintsApply(n)}set isAutostarting(n){this._isAutostarting=n,this.autostarting.next(n)}get isAutostarting(){return this._isAutostarting}set torch(n){try{this.getCodeReader().getScannerControls().switchTorch(n)}catch{}}set enable(n){this._enabled=!!n,this._enabled?this.device?this.scanFromDevice(this.device.deviceId):this.init():(this.reset(),Qu.releaseAllStreams())}get enabled(){return this._enabled}get tryHarder(){return this.hints.get(Qn.TRY_HARDER)}set tryHarder(n){const a=this.hints;n?a.set(Qn.TRY_HARDER,!0):a.delete(Qn.TRY_HARDER),this.hints=a}constructor(){this.timeBetweenScans=500,this.delayBetweenScanSuccess=500,this.previewFitMode="cover",this.poster="",this._ready=!1,this.autostarted=new St.vpe,this.autostarting=new St.vpe,this.torchCompatible=new St.vpe(!1),this.scanSuccess=new St.vpe,this.scanFailure=new St.vpe,this.scanError=new St.vpe,this.scanComplete=new St.vpe,this.camerasFound=new St.vpe,this.camerasNotFound=new St.vpe,this.permissionResponse=new St.vpe(!0),this.hasDevices=new St.vpe,this.deviceChange=new St.vpe,this._enabled=!0,this._hints=new Map,this.autofocusEnabled=!0,this.autostart=!0,this.formats=[De.QR_CODE],this.hasNavigator=typeof navigator<"u",this.isMediaDevicesSupported=this.hasNavigator&&!!navigator.mediaDevices}askForPermission(){var n=this;return(0,O.Z)(function*(){if(!n.hasNavigator)return console.error("@zxing/ngx-scanner","Can't ask permission, navigator is not present."),n.setPermission(null),n.hasPermission;if(!n.isMediaDevicesSupported)return console.error("@zxing/ngx-scanner","Can't get user media, this is not supported."),n.setPermission(null),n.hasPermission;let a,u;try{a=yield n.getAnyVideoDevice(),u=!!a}catch(p){return n.handlePermissionException(p)}finally{n.terminateStream(a)}return n.setPermission(u),u})()}getAnyVideoDevice(){return navigator.mediaDevices.getUserMedia({video:!0})}terminateStream(n){n&&n.getTracks().forEach(a=>a.stop()),n=void 0}init(){var n=this;return(0,O.Z)(function*(){if(!n.autostart)return console.warn("Feature 'autostart' disabled. Permissions and devices recovery has to be run manually."),n.initAutostartOff(),void(n._ready=!0);yield n.initAutostartOn(),n._ready=!0})()}initAutostartOff(){this.isAutostarting=!1,this.updateVideoInputDevices(),this._device&&this._devicePreStart&&this.setDevice(this._devicePreStart)}initAutostartOn(){var n=this;return(0,O.Z)(function*(){let a;n.isAutostarting=!0;try{a=yield n.askForPermission()}catch(u){return void console.error("Exception occurred while asking for permission:",u)}if(a){const u=yield n.updateVideoInputDevices();yield n.autostartScanner([...u])}n.isAutostarting=!1,n.autostarted.next()})()}isCurrentDevice(n){return n?.deviceId===this._device?.deviceId}ngOnDestroy(){this.reset(),Qu.releaseAllStreams()}ngOnInit(){this.init()}scanStop(){this._scanSubscription&&(this.codeReader?.getScannerControls().stop(),this._scanSubscription?.unsubscribe(),this._scanSubscription=void 0),this.torchCompatible.next(!1)}scanStart(){if(this._scanSubscription)throw new Error("There is already a scan process running.");if(!this._device)throw new Error("No device defined, cannot start scan, please define a device.");this.scanFromDevice(this._device.deviceId)}restart(){this._codeReader=void 0;const n=this._reset();n&&(this.device=n)}updateVideoInputDevices(){var n=this;return(0,O.Z)(function*(){const a=(yield zc.listVideoInputDevices())||[],u=a&&a.length>0;return n.hasDevices.next(u),n.camerasFound.next([...a]),u||n.camerasNotFound.next(null),a})()}autostartScanner(n){var a=this;return(0,O.Z)(function*(){const p=n.find(({label:w})=>/back|tr\xe1s|rear|traseira|environment|ambiente/gi.test(w))||n.pop();if(!p)throw new Error("Impossible to autostart, no input devices available.");yield a.setDevice(p),a.deviceChange.next(p)})()}dispatchScanSuccess(n){this.scanSuccess.next(n.getText())}dispatchScanFailure(n){this.scanFailure.next(n)}dispatchScanError(n){this.scanError.observed||(console.error(`zxing scanner component: ${n.name}`,n),console.warn("Use the `(scanError)` property to handle errors like this!")),this.scanError.next(n)}dispatchScanComplete(n){this.scanComplete.next(n)}handlePermissionException(n){let a;switch(console.error("@zxing/ngx-scanner","Error when asking for permission.",n),n.name){case"NotSupportedError":console.warn("@zxing/ngx-scanner",n.message),a=null,this.hasDevices.next(null);break;case"NotAllowedError":console.warn("@zxing/ngx-scanner",n.message),a=!1,this.hasDevices.next(!0);break;case"NotFoundError":console.warn("@zxing/ngx-scanner",n.message),a=null,this.hasDevices.next(!1),this.camerasNotFound.next(n);break;case"NotReadableError":console.warn("@zxing/ngx-scanner","Couldn't read the device(s)'s stream, it's probably in use by another app."),a=null,this.hasDevices.next(!1),this.camerasNotFound.next(n);break;default:console.warn("@zxing/ngx-scanner","I was not able to define if I have permissions for camera or not.",n),a=null}return this.setPermission(a),this.permissionResponse.error(n),a}getBarcodeFormatOrFail(n){return"string"==typeof n?De[n.trim().toUpperCase()]:n}getCodeReader(){return this._codeReader||(this._codeReader=new Qu(this.hints,{delayBetweenScanAttempts:this.timeBetweenScans,delayBetweenScanSuccess:this.delayBetweenScanSuccess})),this._codeReader}scanFromDevice(n){var a=this;return(0,O.Z)(function*(){const u=a.previewElemRef.nativeElement,p=a.getCodeReader(),w=yield p.scanFromDeviceObservable(n,u);if(!w)throw new Error("Undefined decoding stream, aborting.");if(a._scanSubscription=w.subscribe(ee=>a._onDecodeResult(ee.result,ee.error),ee=>a._onDecodeError(ee),()=>{}),a._scanSubscription.closed)return;const W=typeof p.getScannerControls().switchTorch<"u";a.torchCompatible.next(W)})()}_onDecodeError(n){this.dispatchScanError(n)}_onDecodeResult(n,a){n?this.dispatchScanSuccess(n):this.dispatchScanFailure(a),this.dispatchScanComplete(n)}_reset(){if(!this._codeReader)return;this._codeReader=void 0;const n=this._device;return this.device=void 0,n}reset(){this._reset(),this.deviceChange.emit(null)}setDevice(n){var a=this;return(0,O.Z)(function*(){a.scanStop(),a._device=n||void 0,a._device||zc.cleanVideoSource(a.previewElemRef.nativeElement),a._enabled&&n&&(yield a.scanFromDevice(n.deviceId))})()}setPermission(n){this.hasPermission=n,this.permissionResponse.next(n)}static#e=this.\u0275fac=function(a){return new(a||s)};static#t=this.\u0275cmp=St.Xpm({type:s,selectors:[["zxing-scanner"]],viewQuery:function(a,u){if(1&a&&St.Gf(qh,7),2&a){let p;St.iGM(p=St.CRH())&&(u.previewElemRef=p.first)}},inputs:{autofocusEnabled:"autofocusEnabled",timeBetweenScans:"timeBetweenScans",delayBetweenScanSuccess:"delayBetweenScanSuccess",autostart:"autostart",previewFitMode:"previewFitMode",poster:"poster",device:"device",formats:"formats",videoConstraints:"videoConstraints",torch:"torch",enable:"enable",tryHarder:"tryHarder"},outputs:{autostarted:"autostarted",autostarting:"autostarting",torchCompatible:"torchCompatible",scanSuccess:"scanSuccess",scanFailure:"scanFailure",scanError:"scanError",scanComplete:"scanComplete",camerasFound:"camerasFound",camerasNotFound:"camerasNotFound",permissionResponse:"permissionResponse",hasDevices:"hasDevices",deviceChange:"deviceChange"},decls:6,vars:3,consts:[[3,"poster"],["preview",""]],template:function(a,u){1&a&&(St.TgZ(0,"video",0,1)(2,"p"),St._uU(3," Your browser does not support this feature, please try to upgrade it. "),St.qZA(),St.TgZ(4,"p"),St._uU(5," Seu navegador n\xe3o suporta este recurso, por favor tente atualiz\xe1-lo. "),St.qZA()()),2&a&&(St.Udp("object-fit",u.previewFitMode),St.Q6J("poster",u.poster,St.LSH))},styles:["[_nghost-%COMP%]{display:block}video[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:contain}"],changeDetection:0})}return s})(),Sd=(()=>{class s{static#e=this.\u0275fac=function(a){return new(a||s)};static#t=this.\u0275mod=St.oAB({type:s});static#n=this.\u0275inj=St.cJS({imports:[bt.ez,f.u5]})}return s})()},5861:(yr,Qt,_e)=>{"use strict";function O(St,f,ze,ke,Vt,$t,xt){try{var ft=St[$t](xt),it=ft.value}catch(dt){return void ze(dt)}ft.done?f(it):Promise.resolve(it).then(ke,Vt)}function bt(St){return function(){var f=this,ze=arguments;return new Promise(function(ke,Vt){var $t=St.apply(f,ze);function xt(it){O($t,ke,Vt,xt,ft,"next",it)}function ft(it){O($t,ke,Vt,xt,ft,"throw",it)}xt(void 0)})}}_e.d(Qt,{Z:()=>bt})},7582:(yr,Qt,_e)=>{"use strict";function dt(At,Nt,Zt,mt){return new(Zt||(Zt=Promise))(function(_n,gr){function Qn(nn){try{ir(mt.next(nn))}catch(Oi){gr(Oi)}}function tr(nn){try{ir(mt.throw(nn))}catch(Oi){gr(Oi)}}function ir(nn){nn.done?_n(nn.value):function rn(_n){return _n instanceof Zt?_n:new Zt(function(gr){gr(_n)})}(nn.value).then(Qn,tr)}ir((mt=mt.apply(At,Nt||[])).next())})}function kt(At){return this instanceof kt?(this.v=At,this):new kt(At)}function gt(At,Nt,Zt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var rn,mt=Zt.apply(At,Nt||[]),_n=[];return rn={},gr("next"),gr("throw"),gr("return"),rn[Symbol.asyncIterator]=function(){return this},rn;function gr(Gn){mt[Gn]&&(rn[Gn]=function(Pi){return new Promise(function(vi,qr){_n.push([Gn,Pi,vi,qr])>1||Qn(Gn,Pi)})})}function Qn(Gn,Pi){try{!function tr(Gn){Gn.value instanceof kt?Promise.resolve(Gn.value.v).then(ir,nn):Oi(_n[0][2],Gn)}(mt[Gn](Pi))}catch(vi){Oi(_n[0][3],vi)}}function ir(Gn){Qn("next",Gn)}function nn(Gn){Qn("throw",Gn)}function Oi(Gn,Pi){Gn(Pi),_n.shift(),_n.length&&Qn(_n[0][0],_n[0][1])}}function Wn(At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Zt,Nt=At[Symbol.asyncIterator];return Nt?Nt.call(At):(At=function jn(At){var Nt="function"==typeof Symbol&&Symbol.iterator,Zt=Nt&&At[Nt],mt=0;if(Zt)return Zt.call(At);if(At&&"number"==typeof At.length)return{next:function(){return At&&mt>=At.length&&(At=void 0),{value:At&&At[mt++],done:!At}}};throw new TypeError(Nt?"Object is not iterable.":"Symbol.iterator is not defined.")}(At),Zt={},mt("next"),mt("throw"),mt("return"),Zt[Symbol.asyncIterator]=function(){return this},Zt);function mt(_n){Zt[_n]=At[_n]&&function(gr){return new Promise(function(Qn,tr){!function rn(_n,gr,Qn,tr){Promise.resolve(tr).then(function(ir){_n({value:ir,done:Qn})},gr)}(Qn,tr,(gr=At[_n](gr)).done,gr.value)})}}}_e.d(Qt,{FC:()=>gt,KL:()=>Wn,mG:()=>dt,qq:()=>kt}),"function"==typeof SuppressedError&&SuppressedError}},yr=>{yr(yr.s=1694)}]);